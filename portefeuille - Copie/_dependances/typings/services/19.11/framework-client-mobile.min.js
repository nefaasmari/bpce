"use strict";var IndependantLogger,MyWay,__extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){!function(e){var o=function(e,t,n){this.codeLibelle=e,this.valeurs=t,this.causes=n};e.Erreur=o;var t=(n.prototype.all=function(e){return this.innerService.all(e)},n.prototype.defer=function(t){return new s(this.innerService.defer(),function(e){t&&t(e)})},n.prototype.reject=function(e){return this.innerService.reject(e)},n.prototype.when=function(e){return this.innerService.when(e)},n);function n(e){this.innerService=e}e.MonServiceDePromesse=t;var r=(i.prototype.then=function(e,t,n){return this.innerPromesse.then(e,t,n)},i.prototype.catch=function(e){return this._catchHappened=!0,this.innerPromesse.catch(e)},i.prototype.finally=function(e){return!this._catchHappened&&this.erreurCallback&&this.erreurCallback(this.lastReason),this.innerPromesse.finally(e)},i);function i(e,t){this.innerPromesse=e,this.erreurCallback=t,this._catchHappened=!1}e.MaPromesse=r;var s=(Object.defineProperty(a.prototype,"promise",{get:function(){return this.promesse},enumerable:!0,configurable:!0}),a);function a(e,t){var n=this;this.innerDeferred=e,this.erreurCallback=t,this.resolve=function(e){return n.innerDeferred.resolve(e)},this.reject=function(e){return n.promesse.lastReason=e,n.innerDeferred.reject(e)},this.notify=function(e){return n.innerDeferred.notify(e)},this.promesse=new r(this.innerDeferred.promise,this.erreurCallback)}e.MonDeferred=s;var c=(u.getServiceDePromesse=function(){return u.ServiceDePromesse||(u.ServiceDePromesse="undefined"!=typeof angular?new t(angular.injector(["ng"]).get("$q")):(console.debug("[Framework Technique MyWay - Promesses - init] Angular n'est pas disponible"),new t(Q))),u.ServiceDePromesse},u.getPromesseSelfResoved=function(){if(!u.promesseSelfResolved){var e=u.getServiceDePromesse().defer();e.resolve(),u.promesseSelfResolved=e.promise}return u.promesseSelfResolved},u.createPromiseSelfResolved=function(e){var t=u.getServiceDePromesse().defer();return t.resolve(e),t.promise},u.createPromiseSelfError=function(e){var t=u.getServiceDePromesse().defer();return t.reject(e),t.promise},u.promesseTryCatch=function(e,t){var n=u.getServiceDePromesse().defer();try{e(n)}catch(e){t?t(e,n):n.reject(e)}return n.promise},u.prototype.promesseTryCatch=function(e,t){return u.promesseTryCatch(e,t)},u.executePromisesSequentially=function(r){return u.promesseTryCatch(function(t){var n=function(e){try{if(r.length<=e)return void t.resolve();r[e]().then(function(){n(e+1)},function(e){t.reject(e)})}catch(e){t.reject(new o(e))}};n(0)})},u.executePromisesSimultaneous=function(t){return u.promesseTryCatch(function(e){u.getServiceDePromesse().all(t).then(function(){e.resolve()},e.reject)})},u.all=function(e){return u.getServiceDePromesse().all(e)},u.executePromisesSimultaneousAndWaitAllResolves=function(e){var t=[];return e.forEach(function(e){t.push(u.promesseTryCatch(function(t){e.then(function(e){t.resolve({result:e,isError:!1})},function(e){t.resolve({result:e,isError:!0})})}))}),u.getServiceDePromesse().all(t).then(function(e){e.forEach(function(e){if(e.isError)throw e.result})})},u.promesseSelfResolved=null,u);function u(){}e.Promesses=c}(e.Services||(e.Services={}))}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),(r=n.LEVEL||(n.LEVEL={}))[r.DEBUG="DEBUG"]="DEBUG",r[r.INFO="INFO"]="INFO",r[r.WARN="WARN"]="WARN",r[r.ERROR="ERROR"]="ERROR",r[r.NONE="NONE"]="NONE"}(MyWay=MyWay||{}),function(e){var t,i,n;function s(){this.isInit=!1,this.LOGGER_ACTUEL=null,this.appenders={},this.waitingAppenders={}}t=e.Services||(e.Services={}),i=t.Loggers||(t.Loggers={}),Object.defineProperty(s,"INSTANCE",{get:function(){return s._INSTANCE||(s._INSTANCE=new s),s._INSTANCE},enumerable:!0,configurable:!0}),s.prototype.declareAppender=function(e,t){this.appenders[e]=t,this.waitingAppenders[e]&&(this.waitingAppenders[e].forEach(function(e){e.setInternalAppender(t)}),delete this.waitingAppenders[e])},s.prototype.getClassByName=function(e){var t=window;return e.split(".").forEach(function(e){t=t[e]}),t},s.prototype.getClass=function(e){return i.loggersParNom[e]?i.loggersParNom[e]:new i.Logger(e)},s.prototype.addAppender=function(e){var t=this.appenders[e.class];if(t){var n=new t(e.type,e.level,e.config);i.appenders.push(n)}else{var r=new i.WaitingAppender(e.type,e.level,e.config);this.waitingAppenders[e.class]||(this.waitingAppenders[e.class]=[]),this.waitingAppenders[e.class].push(r),i.appenders.push(r)}},s.prototype.addLogger=function(e){var n={name:e.name,level:e.level,appenders:[]};e.appenders.forEach(function(t){i.appenders.forEach(function(e){e.name===t&&n.appenders.push(e)})}),i.categories.push(n)},s.prototype.appenderToConfigAppender=function(e){return{class:e.class,config:e.getConfig(),level:e.level,type:e.name}},s.prototype.loggerToConfigLogger=function(e){var t=[];return e.appenders.forEach(function(e){t.push(e.name)}),{appenders:t,level:e.level,name:e.name}},s.prototype.rechargerConfigurationsLoggers=function(){for(var e in i.loggersParNom)i.loggersParNom[e].verifierNiveauMinimum()},s.prototype.setConfigActual=function(e){var t=this;i.appenders=[],i.categories=[],e.appenders.forEach(function(e){t.addAppender(e)}),e.loggers.forEach(function(e){t.addLogger(e)}),this.isInit=!0,this.rechargerConfigurationsLoggers()},s.prototype.setConfigDB=function(e,t){localStorage.setItem("logger."+e+".config",JSON.stringify(t))},s.prototype.getConfigurationActual=function(){var t=this,n={appenders:[],loggers:[]};return i.appenders.forEach(function(e){n.appenders.push(t.appenderToConfigAppender(e))}),i.categories.forEach(function(e){n.loggers.push(t.loggerToConfigLogger(e))}),n},s.prototype.getConfigurationDB=function(e){return JSON.parse(localStorage.getItem("logger."+e+".config"))},s.prototype.saveConfiguration=function(e){var t=this.getConfigurationActual();localStorage.setItem("logger."+e+".config",JSON.stringify(t)),localStorage.setItem("logger."+e+".version","1"),this.LOGGER_ACTUEL=e},s.prototype.loadConfiguration=function(e){var t="";if(t=i.DEFAULT_CONFIGURATION_PORTAIL?"portail_":"agent_",!e)if(localStorage.getItem(t+"loggerActuel.name"))e=localStorage.getItem(t+"loggerActuel.name");else if(i.DEFAULT_CONFIGURATION_PORTAIL)e=s.LOGGER_PORTAIL;else{if(!i.DEFAULT_CONFIGURATION_AGENTS)throw"Aucune configuration de LOG trouvée";e=s.LOGGER_AGENTS}var n=localStorage.getItem("logger."+e+".config");if(n){var r=localStorage.getItem("logger."+e+".version");if("1"!==r)switch(e){case s.LOGGER_PORTAIL:this.setConfigActual(i.DEFAULT_CONFIGURATION_PORTAIL),this.LOGGER_ACTUEL=s.LOGGER_PORTAIL,e=s.LOGGER_PORTAIL;break;case s.LOGGER_AGENTS:this.setConfigActual(i.DEFAULT_CONFIGURATION_AGENTS),this.LOGGER_ACTUEL=s.LOGGER_AGENTS,e=s.LOGGER_AGENTS;break;default:throw"La configuration "+e+" est en version "+r+" alors que les logs sont en version 1 maximum"}else{var o=JSON.parse(n);this.setConfigActual(o),this.LOGGER_ACTUEL=e}}else switch(e){case s.LOGGER_PORTAIL:this.setConfigActual(i.DEFAULT_CONFIGURATION_PORTAIL),this.LOGGER_ACTUEL=s.LOGGER_PORTAIL,e=s.LOGGER_PORTAIL;break;case s.LOGGER_AGENTS:this.setConfigActual(i.DEFAULT_CONFIGURATION_AGENTS),this.LOGGER_ACTUEL=s.LOGGER_AGENTS,e=s.LOGGER_AGENTS;break;default:if(i.DEFAULT_CONFIGURATION_PORTAIL)this.setConfigActual(i.DEFAULT_CONFIGURATION_PORTAIL),this.LOGGER_ACTUEL=s.LOGGER_PORTAIL,e=s.LOGGER_PORTAIL;else{if(!i.DEFAULT_CONFIGURATION_AGENTS)throw"Impossible de charger une configuration de log";this.setConfigActual(i.DEFAULT_CONFIGURATION_AGENTS),this.LOGGER_ACTUEL=s.LOGGER_AGENTS,e=s.LOGGER_AGENTS}}localStorage.setItem(t+"loggerActuel.name",e)},s.prototype.getNomConfigActuelle=function(){return this.LOGGER_ACTUEL},s.prototype.getAllLogggersNames=function(){var e=[];e.push(s.LOGGER_PORTAIL),e.push(s.LOGGER_AGENTS);for(var t=localStorage.length;t--;){var n=localStorage.key(t),r=/^logger\.([^.]+)\.config$/.exec(n);if(r){var o=r[1];o!==s.LOGGER_PORTAIL&&o!==s.LOGGER_AGENTS&&e.push(o)}}return e},s.prototype.supprimerConfiguration=function(e){localStorage.removeItem("logger."+e+".config"),localStorage.removeItem("logger."+e+".version")},s.prototype.clearConfigurations=function(){var t=this;localStorage.removeItem("portail_loggerActuel.name"),localStorage.removeItem("agent_loggerActuel.name"),this.getAllLogggersNames().forEach(function(e){t.supprimerConfiguration(e)})},s.LOGGER_PORTAIL="portail",s.LOGGER_AGENTS="agent",s._INSTANCE=null,n=s,i.LoggerFactory=n}(MyWay=MyWay||{}),function(e){var n;(function(s){s.appenders=[],s.categories=[],s.loggers=[],s.loggersParNom={};var e=(Object.defineProperty(t,"INSTANCE",{get:function(){return t._INSTANCE||(t._INSTANCE=new t),t._INSTANCE},enumerable:!0,configurable:!0}),t.prototype.testLevel=function(e,t){if(n.PrivatePortalServiceParameters&&n.PrivatePortalServiceParameters.Instance()&&n.PrivatePortalServiceParameters.Instance().ModeDebug)return!0;switch(t){case s.LEVEL.DEBUG:if(e===s.LEVEL.DEBUG)return!0;case s.LEVEL.INFO:if(e===s.LEVEL.INFO)return!0;case s.LEVEL.WARN:if(e===s.LEVEL.WARN)return!0;case s.LEVEL.ERROR:if(e===s.LEVEL.ERROR)return!0}return!1},t.prototype.getAppenders=function(n){for(var r=[],o={},e=s.categories.length;e--;){var i=s.categories[e];i.appenders.forEach(function(e){if("*"===i.name||new RegExp("^"+i.name.replace(".","\\.")).test(n))if(o[e.name]){if(o[e.name].packagename.length>i.name.length)return;o[e.name].levelMin=i.level,o[e.name].packagename=i.name}else{var t={appender:e,levelMin:i.level,packagename:i.name};o[e.name]=t,r.push(t)}})}return r},t.prototype.getContext=function(){var e=s.MDC.INSTANCE.getAll(),t=s.FLASH.INSTANCE.getAll();for(var n in t)e[n]=t[n];return e},t._INSTANCE=null,t);function t(){}s.LoggerHelper=e})((n=e.Services||(e.Services={})).Loggers||(n.Loggers={}))}(MyWay=MyWay||{}),function(e){var t,i,n;function r(e){this.packageName=null,this.levelMinimum=i.LEVEL.DEBUG,this.appenders=[],this._cache=[],this.packageName=e,i.loggers.push(this),(i.loggersParNom[e]=this).verifierNiveauMinimum()}t=e.Services||(e.Services={}),i=t.Loggers||(t.Loggers={}),r.prototype.internalLog=function(e,t,n){var r=i.FLASH.INSTANCE.getValue("dateLog");r=r||new Date;var o={arguments:n,context:i.LoggerHelper.INSTANCE.getContext(),date:r.getTime(),message:t,niveau:e,packageName:this.packageName};i.LoggerFactory.INSTANCE.isInit?this.tracer(o):this._cache.push(o)},r.prototype.tracer=function(t){i.LoggerHelper.INSTANCE.testLevel(t.niveau,this.levelMinimum)&&this.appenders.forEach(function(e){e.appender.append(t)})},r.prototype.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.internalLog(i.LEVEL.DEBUG,e,t)},r.prototype.info=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.internalLog(i.LEVEL.INFO,e,t)},r.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.internalLog(i.LEVEL.WARN,e,t)},r.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.internalLog(i.LEVEL.ERROR,e,t)},r.prototype.verifierNiveauMinimum=function(){var t=this;this.appenders=i.LoggerHelper.INSTANCE.getAppenders(this.packageName),this.levelMinimum=null,this.appenders.forEach(function(e){null!==t.levelMinimum&&!i.LoggerHelper.INSTANCE.testLevel(t.levelMinimum,e.levelMin)||(t.levelMinimum=e.levelMin)}),this.clearCache()},r.prototype.clearCache=function(){var t=this;i.LoggerFactory.INSTANCE.isInit&&this._cache&&0<this._cache.length&&(this._cache.forEach(function(e){t.tracer(e)}),this._cache=[])},n=r,i.Logger=n}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){this.mdc={},this.stringify=null}t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),Object.defineProperty(o,"INSTANCE",{get:function(){return o._INSTANCE||(o._INSTANCE=new o),o._INSTANCE},enumerable:!0,configurable:!0}),o.prototype.setValue=function(e,t){if(void 0!==t)this.mdc[e]=t;else{if(!this.mdc[e])return;delete this.mdc[e]}this.stringify=null},o.prototype.getValue=function(e){return this.mdc[e]},o.prototype.remove=function(e){delete this.mdc[e],this.stringify=null},o.prototype.getAll=function(){return null===this.stringify&&(this.stringify=JSON.stringify(this.mdc)),JSON.parse(this.stringify)},o._INSTANCE=null,r=o,n.MDC=r}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){this.flash={}}t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),Object.defineProperty(o,"INSTANCE",{get:function(){return o._INSTANCE||(o._INSTANCE=new o),o._INSTANCE},enumerable:!0,configurable:!0}),o.prototype.setValue=function(e,t){void 0!==t?this.flash[e]=t:delete this.flash[e]},o.prototype.getValue=function(e){var t=this.flash[e];return delete this.flash[e],t},o.prototype.setAll=function(e){this.flash=e},o.prototype.getAll=function(){var e=JSON.parse(JSON.stringify(this.flash));return this.flash={},e},o._INSTANCE=null,r=o,n.FLASH=r}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(e,t,n,r){this.name=e,this.level=n,this.config=r,this.class=null,this.class=t}t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),r=n.Appenders||(n.Appenders={}),i.prototype.getConfig=function(){return this.config},i.prototype.append=function(e){return!!n.LoggerHelper.INSTANCE.testLevel(e.niveau,this.level)&&(this.onAppend(e),!0)},i.prototype.onAppend=function(e){throw'La méthode "onAppend" n\'a pas été surchargée'},o=i,r.AbstractAppender=o}(MyWay=MyWay||{}),function(e){var t,o,n,i,r;function s(e,t,n){var r=i.call(this,e,s.CLASSNAME,t,n)||this;return r.format=null,r.parse(n.format),r}t=e.Services||(e.Services={}),o=t.Loggers||(t.Loggers={}),n=o.Appenders||(o.Appenders={}),i=n.AbstractAppender,__extends(s,i),s.prototype.onAppend=function(t){var n="";switch(this.format.forEach(function(e){n+=e.format(t)}),t.niveau){case o.LEVEL.DEBUG:console.debug(n);break;case o.LEVEL.INFO:console.info(n);break;case o.LEVEL.WARN:console.warn(n);break;case o.LEVEL.ERROR:console.error(n)}},s.prototype.parse=function(e){var r=this,t=e.split(/%([^ ]+)/g);this.format=[],t.forEach(function(t){if(0!==t.length){if(/^d/.test(t)){var e=t.split(/d{([^}]+)}/);return 3!==e.length?void r.format.push(new o.Formaters.DateFormater):void r.format.push(new o.Formaters.DateFormater(e[1]))}if(/^level$/.test(t))r.format.push({format:function(e){return e.niveau.toString()}});else if(/^class/.test(t))r.format.push({format:function(e){return e.packageName?e.packageName:""}});else if(/^msg/.test(t))r.format.push(new o.Formaters.MessageFormater);else{if(/^X/.test(t)){var n=t.split(/X{([^}]+)}/);if(3===n.length)return void r.format.push({format:function(e){return e.context[n[1]]?"string"==typeof e.context[n[1]]?e.context[n[1]]:JSON.stringify(e.context[n[1]]):""}})}r.format.push({format:function(e){return t}})}}})},s.CLASSNAME="MyWay.Services.Loggers.Appenders.ConsoleAppender",r=s,n.ConsoleAppender=r,o.LoggerFactory.INSTANCE.declareAppender(r.CLASSNAME,r)}(MyWay=MyWay||{}),function(e){var t,n,o,r;function i(e,t,n){var r=o.call(this,e,i.CLASSNAME,t,n)||this;return r.internalAppender=null,r.messagesEnAttente=[],r}t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),o=n.Appenders.AbstractAppender,__extends(i,o),i.prototype.setInternalAppender=function(e){var t=this;this.internalAppender=new e(this.name,this.level,this.getConfig()),this.class=this.internalAppender.class,this.messagesEnAttente.forEach(function(e){t.internalAppender.append(e)}),this.messagesEnAttente.length=0},i.prototype.onAppend=function(e){return this.internalAppender?this.internalAppender.append(e):(this.messagesEnAttente.push(e),!0)},i.CLASSNAME="MyWay.Services.Loggers.WaitingAppender",r=i,n.WaitingAppender=r}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(e,t,n){for(var r=e.toString();r.length<n;)r=t+r;return r}function s(e){this.formatter=null,this.parse(e)}t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),r=n.Formaters||(n.Formaters={}),s.prototype.format=function(t){var n="";return this.formatter.forEach(function(e){n+=e(new Date(t.date))}),n},s.prototype.parse=function(n){var r=this;if(this.formatter=[],n){var e=n.split(""),o=0;e.forEach(function(t,e){if(0<o)o--;else switch(t){case"H":"H"===n.charAt(e+1)?(r.formatter.push(function(e){return i(e.getHours().toString(),"0",2)}),o=1):r.formatter.push(function(e){return e.getHours().toString()});break;case"m":"m"===n.charAt(e+1)?(r.formatter.push(function(e){return i(e.getMinutes().toString(),"0",2)}),o=1):r.formatter.push(function(e){return e.getMinutes().toString()});break;case"s":"s"===n.charAt(e+1)?(r.formatter.push(function(e){return i(e.getSeconds().toString(),"0",2)}),o=1):r.formatter.push(function(e){return e.getSeconds().toString()});break;case"S":"S"===n.charAt(e+1)&&"S"===n.charAt(e+2)?(r.formatter.push(function(e){return i(e.getMilliseconds().toString(),"0",3)}),o=2):r.formatter.push(function(e){return e.getMilliseconds().toString()});break;case"Y":"Y"===n.charAt(e+1)?o="Y"===n.charAt(e+2)&&"Y"===n.charAt(e+3)?(r.formatter.push(function(e){return i(e.getFullYear().toString(),"0",4)}),4):(r.formatter.push(function(e){return e.getFullYear().toString().substring(2,4)}),2):r.formatter.push(function(e){return parseInt(e.getFullYear().toString().substring(2,4),10).toString()});break;case"M":"M"===n.charAt(e+1)?(r.formatter.push(function(e){return i((e.getMonth()+1).toString(),"0",2)}),o=1):r.formatter.push(function(e){return(e.getMonth()+1).toString()});break;case"D":"D"===n.charAt(e+1)?(r.formatter.push(function(e){return i(e.getDate().toString(),"0",2)}),o=1):r.formatter.push(function(e){return e.getDate().toString()});break;default:r.formatter.push(function(e){return t})}})}else this.formatter.push(function(e){return e.getTime().toString()})},o=s,r.DateFormater=o}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){}t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),r=n.Formaters||(n.Formaters={}),i.prototype.format=function(e){if(!e.arguments||0===e.arguments.length)return e.message;var n=e.message;return e.arguments.forEach(function(e,t){n=n.replace(new RegExp("%"+(t+1),"g"),e)}),n},o=i,r.MessageFormater=o}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),(r=n.Messages||(n.Messages={})).NOM_BIBLIOTHEQUE="Loggers",(o=r.TYPE||(r.TYPE={}))[o.GET_CONFIG_ACTUAL="GET_CONFIG_ACTUAL"]="GET_CONFIG_ACTUAL",o[o.SET_CONFIG_ACTUAL="SET_CONFIG_ACTUAL"]="SET_CONFIG_ACTUAL",o[o.GET_CONFIG_DB="GET_CONFIG_DB"]="GET_CONFIG_DB",o[o.SET_CONFIG_DB="SET_CONFIG_DB"]="SET_CONFIG_DB",o[o.SAVE_CONFIG="SAVE_CONFIG"]="SAVE_CONFIG",o[o.LOAD_CONFIG="LOAD_CONFIG"]="LOAD_CONFIG",o[o.GET_LOGGERS="GET_LOGGERS"]="GET_LOGGERS",o[o.GET_NOM_CONFIG_ACTUELLE="GET_NOM_CONFIG_ACTUELLE"]="GET_NOM_CONFIG_ACTUELLE",o[o.IS_CLASS_EXISTS="IS_CLASS_EXISTS"]="IS_CLASS_EXISTS",o[o.RESET="RESET"]="RESET"}(MyWay=MyWay||{}),function(e){var t,o;t=e.Services||(e.Services={}),(o=t.Loggers||(t.Loggers={})).loggerToTrace=function(r){return{debug:function(e,t,n){t&&o.FLASH.INSTANCE.setValue("action",t),n&&o.FLASH.INSTANCE.setValue("details",n),r.debug(e)},info:function(e,t,n){t&&o.FLASH.INSTANCE.setValue("action",t),n&&o.FLASH.INSTANCE.setValue("details",n),r.info(e)},warning:function(e,t,n){t&&o.FLASH.INSTANCE.setValue("action",t),n&&o.FLASH.INSTANCE.setValue("details",n),r.warn(e)},error:function(e,t,n){t&&o.FLASH.INSTANCE.setValue("action",t),n&&o.FLASH.INSTANCE.setValue("details",n),r.error(e)}}}}(MyWay=MyWay||{}),function(e){var t=(n.NAME="Framework Technique",n.VERSION="1",n.BUILD="Local",n);function n(){}e.Framework=t}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.Core||(t.Core={})).override=function(e,t,n){e.prototype[t],e.prototype[t]=function(){return n.apply(this,arguments)}},n.defineProperty=function(e,t,n){Object.defineProperty(e.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0})}}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Context||(t.Context={}),(r=n.ScopeType||(n.ScopeType={}))[r.View=1]="View",r[r.Root=2]="Root",r[r.Service=3]="Service"}(MyWay=MyWay||{}),function(e){var r;(function(e){e.RegistryType||(e.RegistryType={});var t=(n.prototype.register=function(e){this._components.push(e)},Object.defineProperty(n.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),n.prototype.reset=function(){this._components.length=0},n.prototype.getComponentInstance=function(e){return this._componentsInstancesByKey[e]},n.prototype.getComponentsInstances=function(){return this._componentsInstances},n.prototype.getLibrary=function(){return this._componentsInstancesByKey},Object.defineProperty(n.prototype,"registryType",{get:function(){return this._registryType},enumerable:!0,configurable:!0}),n.prototype.init=function(e){this.createInstances();var t=this._componentsInstancesByKey[e];return t?this.initializeComponent(t):r.CoreCommon.getPromesseSelfResoved()},n.prototype.createInstances=function(){var n=this;this._components.forEach(function(e){var t=new e;n._componentsInstances.push(t),n._componentsInstancesByKey[t.name]=t}),this._components.length=0},Object.defineProperty(n.prototype,"dependencies",{get:function(){return this._dependencies},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dependenciesInstances",{set:function(e){this._dependenciesInstances=e},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var t=[];return this._componentsInstances.forEach(function(e){t.push(e.dispose())}),r.CoreCommon.executePromisesSimultaneous(t)},n);function n(e,t){this._components=[],this._componentsInstances=[],this._componentsInstancesByKey={},this._dependenciesInstances=null,this._registryType=e,this._dependencies=t}e.AbstractRegistry=t})((r=e.Services||(e.Services={})).Components||(r.Components={}))}(MyWay=MyWay||{}),function(e){var i,t,n;function o(){this.registries=[],this.registriesByKeys={},this.dependencies=[]}i=e.Services||(e.Services={}),t=i.Components||(i.Components={}),o.getInstance=function(){return null===o.INSTANCE&&(o.INSTANCE=new o),o.INSTANCE},o.prototype.reorderRegistries=function(){var t=this,n=new i.Toposort;this.registries.forEach(function(e){n.add(e.registryType,e.dependencies)});var e=n.sort();this.registries.length=0,e.forEach(function(e){t.registriesByKeys[e]&&t.registries.push(t.registriesByKeys[e])})},o.prototype.reorderComponents=function(){var t=this,n=new i.Toposort,r={};this.dependencies.forEach(function(e){r[e.name]=e,n.add(e.name,e.dependencies)});var e=n.sort();this.dependencies.length=0,e.forEach(function(e){r[e]&&t.dependencies.push(r[e])})},o.prototype.init=function(){var e=this;this.reorderRegistries(),this.reorderComponents(),this.injectDependencies();var r=[];return this.dependencies.forEach(function(n){e.registries.forEach(function(t){r.push(function(){return t.init(n.name).then(function(){},function(e){throw o.logger.debug("Registry : %1, initialisation du composant %2 => Erreur!",t.registryType,n.name),e})})})}),i.CoreCommon.executePromisesSequentially(r).then(function(){},console.error)},o.prototype.injectDependencies=function(){var o=this;this.registries.forEach(function(e){var t=e.dependencies,r=[];t.forEach(function(t){var n=null;if(o.registries.every(function(e){return e.registryType===t&&(n=e),null===n}),null===n)throw new i.Erreur("Le registry de type "+t+" n'a pas été trouvé!");r.push(n)}),e.dependenciesInstances=r})},o.prototype.dispose=function(){var t=[];return this.registries.forEach(function(e){t.push(function(){return e.dispose()})}),i.CoreCommon.executePromisesSequentially(t)},o.prototype.addRegistry=function(e){this.registries.push(e),this.registriesByKeys[e.registryType]=e},o.prototype.declareComponent=function(t,n){if(void 0===t)throw new i.Erreur("Tentative d'enregistrement de composant avant sa déclaration");n.forEach(function(e){if(void 0===e)throw new i.Erreur("Tentative d'enregistrement des dépendances du composant avant sa déclaration pour "+t+". Dependances :"+JSON.stringify(n))}),this.dependencies.push({dependencies:n,name:t})},o.prototype.getRegistryInstance=function(e){return this.registriesByKeys[e]},o.INSTANCE=null,o.CLASS_NAME="MyWay.Services.Components.FactoryRegistries",o.logger=i.Loggers.LoggerFactory.INSTANCE.getClass(o.CLASS_NAME),n=o,t.FactoryRegistries=n}(MyWay=MyWay||{}),function(e){var t;(function(e){var t;(t=e.RegistryType||(e.RegistryType={})).COMMON="COMMON";var n,r=(n=e.AbstractRegistry,__extends(o,n),o.getInstance=function(){return null===o.instance&&(o.instance=new o,e.FactoryRegistries.getInstance().addRegistry(o.instance)),o.instance},o.prototype.initializeComponent=function(e){return e.init(this._componentsInstances)},o.instance=null,o);function o(){return n.call(this,t.COMMON,[])||this}e.RegistryCommon=r})((t=e.Services||(e.Services={})).Components||(t.Components={}))}(MyWay=MyWay||{}),function(e){var t,n,r;function o(e){this._name=e}t=e.Services||(e.Services={}),n=t.Components||(t.Components={}),Object.defineProperty(o.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),o.CLASS_NAMEBase="MyWay.Services.ComponentBase",o.loggerBase=t.Loggers.LoggerFactory.INSTANCE.getClass(o.CLASS_NAMEBase),r=o,n.ComponentBase=r}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Controle="Controle"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.Controle||(t.Controle={})).ControleMessageSubject||(n.ControleMessageSubject={}),t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Controle,[])}(MyWay=MyWay||{}),function(e){var t;(function(e){var t=(n.isNotUndefinedAndNotNull=function(e){return null!=e},n);function n(){}e.StaticAnyControle=t;var r=(o.prototype.isNotUndefinedAndNotNull=function(e){return t.isNotUndefinedAndNotNull(e)},o);function o(){}e.AnyControle=r})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t;(function(e){var t=(n.isArray=function(e){return null!=e&&"[object Array]"===Object.prototype.toString.call(e)},n);function n(){}e.StaticArrayControle=t;var r=(o.prototype.isArray=function(e){return t.isArray(e)},o);function o(){}e.ArrayControle=r})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t;(function(e){var t=(n.isDate=function(e){return null!=e&&"[object Date]"===Object.prototype.toString.call(e)},n);function n(){}e.StaticDateControle=t;var r=(o.prototype.isDate=function(e){return t.isDate(e)},o);function o(){}e.DateControle=r})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t;(function(r){var n=(o.isAnEnumValueOrNullOrUndefined=function(e,t){return!r.StaticAnyControle.isNotUndefinedAndNotNull(e)||o.isAnEnumValue(e,t)},o.isAnEnumValue=function(e,t){if(r.StaticNumberControle.isInt(e)&&r.StaticObjectControle.isObject(t)){for(var n in t)if("number"==typeof t[n]&&t[n]===e)return!0;return!1}return!1},o.isAnEnumMember=function(e,t){if(r.StaticStringControle.isString(e)&&r.StaticObjectControle.isObject(t)){for(var n in t)if("number"==typeof t[n]&&n===e)return!0;return!1}return!1},o);function o(){}r.StaticEnumControle=n;var e=(t.prototype.isAnEnumValueOrNullOrUndefined=function(e,t){return n.isAnEnumValueOrNullOrUndefined(e,t)},t.prototype.isAnEnumValue=function(e,t){return n.isAnEnumValue(e,t)},t.prototype.isAnEnumMember=function(e,t){return n.isAnEnumMember(e,t)},t);function t(){}r.EnumControle=e})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t;(function(e){var t=(n.isFunction=function(e){return null!=e&&"function"==typeof e},n.isFunctionOrNull=function(e){return null===e||this.isFunction(e)},n);function n(){}e.StaticFunctionControle=t;var r=(o.prototype.isFunction=function(e){return t.isFunction(e)},o.prototype.isFunctionOrNull=function(e){return t.isFunctionOrNull(e)},o);function o(){}e.FunctionControle=r})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t;(function(e){var t=(n.isNumber=function(e){return null!=e&&"number"==typeof e},n.isInt=function(e){return!!this.isNumber(e)&&e%1==0},n);function n(){}e.StaticNumberControle=t;var r=(o.prototype.isNumber=function(e){return t.isNumber(e)},o.prototype.isInt=function(e){return t.isInt(e)},o);function o(){}e.NumberControle=r})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t;(function(n){var r=(e.isObject=function(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)},e.isObjectOrNull=function(e){return null===e||this.isObject(e)},e.isObjectOrNullOrUndefined=function(e){return void 0===e||this.isObjectOrNull(e)},e.isObjectSpecified=function(e,t){return!!n.StaticStringControle.isStringNotEmpty(t)&&null!=e&&Object.prototype.toString.call(e)==="[object "+t+"]"},e);function e(){}n.StaticObjectControle=r;var t=(o.prototype.isObject=function(e){return r.isObject(e)},o.prototype.isObjectOrNull=function(e){return r.isObjectOrNull(e)},o.prototype.isObjectOrNullOrUndefined=function(e){return r.isObjectOrNullOrUndefined(e)},o.prototype.isObjectSpecified=function(e,t){return r.isObjectSpecified(e,t)},o);function o(){}n.ObjectControle=t})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t;(function(e){var t=(n.isString=function(e){return null!=e&&"string"==typeof e},n.isStringOrNull=function(e){return null===e||this.isString(e)},n.isStringOrNullOrUndefined=function(e){return void 0===e||this.isStringOrNull(e)},n.isStringNotEmpty=function(e){return""!==e&&this.isString(e)},n.isStringNotEmptyOrNull=function(e){return""!==e&&this.isStringOrNull(e)},n.isStringNotEmptyOrNullOrUndefined=function(e){return void 0===e||this.isStringNotEmptyOrNull(e)},n);function n(){}e.StaticStringControle=t;var r=(o.prototype.isString=function(e){return t.isString(e)},o.prototype.isStringOrNull=function(e){return t.isStringOrNull(e)},o.prototype.isStringOrNullOrUndefined=function(e){return t.isStringOrNullOrUndefined(e)},o.prototype.isStringNotEmpty=function(e){return t.isStringNotEmpty(e)},o.prototype.isStringNotEmptyOrNull=function(e){return t.isStringNotEmptyOrNull(e)},o.prototype.isStringNotEmptyOrNullOrUndefined=function(e){return t.isStringNotEmptyOrNullOrUndefined(e)},o);function o(){}e.StringControle=r})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t;(function(e){var t=(n.isBoolean=function(e){return null!=e&&"[object Boolean]"===Object.prototype.toString.call(e)},n);function n(){}e.StaticBooleanControle=t;var r=(o.prototype.isBoolean=function(e){return t.isBoolean(e)},o);function o(){}e.BooleanControle=r})((t=e.Services||(e.Services={})).Controle||(t.Controle={}))}(MyWay=MyWay||{}),function(e){var t,r,o,n,i;function s(){}t=e.Services||(e.Services={}),r=t.Controle||(t.Controle={}),s.checkParameters=function(e){var t,n="";for(t=0;t<e.length;t++)switch(e[t].controle){case o.isNotUndefinedAndNotNull:r.StaticAnyControle.isNotUndefinedAndNotNull(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' ne doit être ni null ni undefined / ");break;case o.isArray:r.StaticArrayControle.isArray(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être un tableau / ");break;case o.isBoolean:r.StaticBooleanControle.isBoolean(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être un booléen / ");break;case o.isDate:r.StaticDateControle.isDate(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une date / ");break;case o.isAnEnumValue:r.StaticEnumControle.isAnEnumValue(e[t].value,e[t].enumObject)||(n=n+"Le paramètre '"+e[t].name+"' doit être une valeur de l'enum '"+e[t].enumName+"' / ");break;case o.isAnEnumMember:r.StaticEnumControle.isAnEnumMember(e[t].value,e[t].enumObject)||(n=n+"Le paramètre '"+e[t].name+"' doit être un membre de l'enum '"+e[t].enumName+"' / ");break;case o.isAnEnumValueOrNullOrUndefined:r.StaticEnumControle.isAnEnumValueOrNullOrUndefined(e[t].value,e[t].enumObject)||(n=n+"Le paramètre '"+e[t].name+"' doit être une valeur de l'enum '"+e[t].enumName+"' ou null ou undefined / ");break;case o.isFunction:r.StaticFunctionControle.isFunction(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une fonction / ");break;case o.isFunctionOrNull:r.StaticFunctionControle.isFunctionOrNull(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une fonction ou null / ");break;case o.isNumber:r.StaticNumberControle.isNumber(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être un nombre / ");break;case o.isInt:r.StaticNumberControle.isInt(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être un nombre entier / ");break;case o.isObject:r.StaticObjectControle.isObject(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être un objet / ");break;case o.isObjectOrNull:r.StaticObjectControle.isObjectOrNull(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être un objet ou null / ");break;case o.isObjectOrNullOrUndefined:r.StaticObjectControle.isObjectOrNullOrUndefined(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être un objet ou null ou undefined / ");break;case o.isObjectSpecified:r.StaticObjectControle.isObjectSpecified(e[t].value,e[t].objectType)||(n=n+"Le paramètre '"+e[t].name+"' doit être un objet de type '"+e[t].objectType+"' / ");break;case o.isString:r.StaticStringControle.isString(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une chaine de caractères / ");break;case o.isStringOrNull:r.StaticStringControle.isStringOrNull(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une chaine de caractères ou null / ");break;case o.isStringOrNullOrUndefined:r.StaticStringControle.isStringOrNullOrUndefined(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une chaine de caractères ou null ou undefined / ");break;case o.isStringNotEmpty:r.StaticStringControle.isStringNotEmpty(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une chaine de caractères non vide / ");break;case o.isStringNotEmptyOrNull:r.StaticStringControle.isStringNotEmptyOrNull(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une chaine de caractères non vide ou null / ");break;case o.isStringNotEmptyOrNullOrUndefined:r.StaticStringControle.isStringNotEmptyOrNullOrUndefined(e[t].value)||(n=n+"Le paramètre '"+e[t].name+"' doit être une chaine de caractères non vide ou null ou undefined / ")}return""!=n&&(n=n.substring(0,n.lastIndexOf("/")-1)),n},i=s,r.StaticParametresControle=i,(n=o=r.CONTROLES||(r.CONTROLES={}))[n.isNotUndefinedAndNotNull=0]="isNotUndefinedAndNotNull",n[n.isArray=100]="isArray",n[n.isBoolean=200]="isBoolean",n[n.isDate=300]="isDate",n[n.isAnEnumValue=400]="isAnEnumValue",n[n.isAnEnumMember=401]="isAnEnumMember",n[n.isAnEnumValueOrNullOrUndefined=402]="isAnEnumValueOrNullOrUndefined",n[n.isFunction=500]="isFunction",n[n.isFunctionOrNull=501]="isFunctionOrNull",n[n.isNumber=600]="isNumber",n[n.isInt=601]="isInt",n[n.isObject=700]="isObject",n[n.isObjectOrNull=701]="isObjectOrNull",n[n.isObjectOrNullOrUndefined=702]="isObjectOrNullOrUndefined",n[n.isObjectSpecified=703]="isObjectSpecified",n[n.isString=800]="isString",n[n.isStringOrNull=801]="isStringOrNull",n[n.isStringOrNullOrUndefined=802]="isStringOrNullOrUndefined",n[n.isStringNotEmpty=803]="isStringNotEmpty",n[n.isStringNotEmptyOrNull=804]="isStringNotEmptyOrNull",n[n.isStringNotEmptyOrNullOrUndefined=805]="isStringNotEmptyOrNullOrUndefined"}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Message="Message",n.FactoryRegistries.getInstance().declareComponent(n.ComponentType.Message,[])}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.CommonEventType||(t.CommonEventType={}))[n.BriqueCommunication=1]="BriqueCommunication"}(MyWay=MyWay||{}),function(e){var t,n;function r(){if(r._instance)throw new Error("Error: Instantiation failed: Use PortalServiceParameters.Instance() instead of new.");r._instance=this}t=e.Services||(e.Services={}),r.Instance=function(){return null===r._instance&&(r._instance=new r),r._instance},r._instance=null,n=r,t.PortalServiceParameters=n}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Evennements="Evennements"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Core="Core"}(MyWay=MyWay||{}),function(D){!function(u){var e=(t.prototype._classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.prototype.add=function(e,t){if("string"!=typeof e||!e)throw new TypeError("Dependent name must be given as a not empty string");if(0<(t=Array.isArray(t)?t:[t]).length){var n=t,r=Array.isArray(n),o=0;for(n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if((o=n.next()).done)break;i=o.value}var s=i;if("string"!=typeof s||!s)throw new TypeError("Dependency name must be given as a not empty string");this.edges.push([e,s])}}else this.edges.push([e]);return this},t.prototype.sort=function(){var l=this,p=[],e=this.edges,t=Array.isArray(e),n=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(n>=e.length)break;r=e[n++]}else{if((n=e.next()).done)break;r=n.value}var o=C=r,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var a;if(i){if(s>=o.length)break;a=o[s++]}else{if((s=o.next()).done)break;a=s.value}var c=a;-1===p.indexOf(c)&&p.push(c)}}for(var f=p.length,g=new Array(p.length),u=function e(t,n){if(0!==n.length&&-1!==n.indexOf(t))throw new Error("Cyclic dependency found. "+t+" is dependent of itself.\nDependency chain: "+n.join(" -> ")+" => "+t);var r=p.indexOf(t);if(-1!==r){var o=!1;p[r]=!1;var i=l.edges,s=Array.isArray(i),a=0;for(i=s?i:i[Symbol.iterator]();;){var c;if(s){if(a>=i.length)break;c=i[a++]}else{if((a=i.next()).done)break;c=a.value}var u=c;u[0]===t&&(o=o||n.concat([t]),e(u[1],o))}g[--f]=t}},h=0;h<p.length;h++)if(!1!==(c=p[h])){p[h]=!1;var d=this.edges,m=Array.isArray(d),y=0;for(d=m?d:d[Symbol.iterator]();;){var v,C;if(m){if(y>=d.length)break;v=d[y++]}else{if((y=d.next()).done)break;v=y.value}(C=v)[0]===c&&u(C[1],[c])}g[--f]=c}return g.reverse()},t.prototype.clear=function(){return this.edges=[],this},t);function t(){this._classCallCheck(this,t),this.edges=[]}u.Toposort=e;var n=(r.prototype.createInstance=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Object.create(this.$parse(e)(window).prototype);return r.constructor.apply(r,t),r},r.$inject=["$parse"],r);function r(e){this.$parse=e}u.InstanceLoaderService=n;var o,i=(o=u.Components.ComponentBase,__extends(l,o),Object.defineProperty(l,"ServiceDePromesse",{get:function(){return u.Promesses.getServiceDePromesse()},enumerable:!0,configurable:!0}),l.prototype.init=function(){return this.getPromesseSelfResoved()},l.prototype.getServiceDePromesse=function(){return u.Promesses.getServiceDePromesse()},l.getPromesseSelfResoved=function(){return u.Promesses.getPromesseSelfResoved()},l.prototype.dispose=function(){return this.getPromesseSelfResoved()},l.prototype.getPromesseSelfResoved=function(){return u.Promesses.getPromesseSelfResoved()},l.prototype.createPromiseSelfResolved=function(e){return u.Promesses.createPromiseSelfResolved(e)},l.prototype.createPromiseSelfError=function(e){return u.Promesses.createPromiseSelfError(e)},l.createPromiseSelfResolved=function(e){return u.Promesses.createPromiseSelfResolved(e)},l.createPromiseSelfError=function(e){return u.Promesses.createPromiseSelfError(e)},l.executePromisesSequentially=function(e){return u.Promesses.executePromisesSequentially(e)},l.executePromisesSimultaneous=function(e){return u.Promesses.executePromisesSimultaneous(e)},l.executePromisesSimultaneousAndWaitAllResolves=function(e){return u.Promesses.executePromisesSimultaneousAndWaitAllResolves(e)},l.prototype.FindKeysToReplace=function(e){for(var t=[],n=0,r=!1;!r;){var o=e.indexOf("[",n);if(0<=o){var i=e.indexOf("]",o);if(0<i){-1!=e.indexOf("[",o+1)&&e.indexOf("[",o+1)<i&&(o=e.indexOf("[",o+1));var s=e.substring(o+1,i);'"'!==s[0]&&t.push(s)}else r=!0;n=i}else r=!0}return t},l.prototype.GetBrowser=function(){return l.GetBrowserStatic()},l.GetBrowserStatic=function(){if(!navigator&&!navigator.platform)return null;var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?"Opera "+e[1]:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n[0])},l.prototype.GetBrowserVersion=function(){return l.GetBrowserVersionStatic()},l.GetBrowserVersionStatic=function(){if(!navigator&&!navigator.platform)return null;var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?"Opera "+e[1]:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n[1])},l.IsMobileBrowser=function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},l.prototype.SerializeScope=function(e){var t={};return this.ApplyProperties(e,t),JSON.stringify(t)},l.prototype.ApplyProperties=function(e,t){for(var n in e)e.hasOwnProperty(n)&&"$"!==n.substring(0,1)&&(l.IsFunction(e[n])||(t[n]=e[n]))},l.IsFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},l.checkIsIE=function(){return-1<D.Services.CoreCommon.getInternetExplorerVersion()},l.prototype.serviceLocalDisponible=function(){return this._serviceLocalDisponible},l.getInternetExplorerVersion=function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}else"Netscape"==navigator.appName&&(t=navigator.userAgent,null!=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1)));return e},l.prototype.SwapArrayElements=function(e,t,n){if(!e)throw"arrayObject null";if(t<0||t>e.length-1)throw"index_a non valide";if(n<0||n>e.length-1)throw"index_b non valide";if(t!==n){var r=e[t];e[t]=e[n],e[n]=r}},l.SendRequestWithPromise=function(e){var t=l.ServiceDePromesse.defer();try{l.SendRequest(e,t.resolve,t.reject)}catch(e){t.reject(new u.Erreur(e))}return t.promise},l.prototype.sendRequest=function(t){return this.promesseTryCatch(function(e){l.SendRequest(t,e.resolve,e.reject)})},l.SendRequest=function(e,n,r){var o=this;l.CheckSettings(e);var t=e.url,i="";u.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.params)&&(i=l.GetParams(e.params)),t&&""!==i&&(t=t+"?"+i);var s,a={};if(a.url=t||"ceciestuntest?"+i,a.async=e.async,a.headers={},e.additionalHeaders)for(s in e.additionalHeaders){var c=e.additionalHeaders[s];a.headers[s]=c}if(e.method===C.DELETE?a.method="DELETE":e.method===C.GET?a.method="GET":e.method===C.POST?a.method="POST":e.method===C.PUT&&(a.method="PUT"),e.accept===y.ALL?a.headers.Accept="*/*":e.accept===y.JSON&&(a.headers.Accept="application/json"),l.AddMyWayHeaders(a,e),e.data)if(e.contentType===g.JSON)a.data=JSON.stringify(e.data),a.headers["Content-Type"]="application/json";else{if(e.contentType!==g.URL_ENCODED)throw"data is not null and settings is unknown";a.data=l.GetParams(e.data),a.headers["Content-Type"]="application/x-www-form-urlencoded"}switch(e.responseType){case d.BLOB:a.responseType="blob";break;case d.JSON:a.responseType="json";break;case d.EMPTY:a.responseType="";break;default:e.method===C.GET?a.responseType="json":a.responseType=""}return e.timeout&&(a.timeout=e.timeout),!0===e.originalResponse&&(a.originalResponse=!0),a.success=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n&&n.apply(o,e),u.Loggers.FLASH.INSTANCE.setValue("details",a.url),l.logger.debug("SendRequest success")},a.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r&&r.apply(o,e),u.Loggers.FLASH.INSTANCE.setValue("details",a.url),l.logger.warn("SendRequest failed")},t?l.Send(a,u.Loggers.loggerToTrace(e.logger),e.withHeaders):(u.Loggers.FLASH.INSTANCE.setValue("action","SendRequest"),l.logger.warn("Aucune URL n'a été fournie"),r(new u.Erreur("Aucune URL n'a été fournie"))),a},l.FixedEncodeURIComponent=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})},l.GetParams=function(e){var n="",t=!0;if(!u.Controle.StaticObjectControle.isObject(e))return n;for(var r in e)u.Controle.StaticStringControle.isStringNotEmpty(r)&&e.hasOwnProperty(r)&&(t||(n+="&"),t=!1,u.Controle.StaticObjectControle.isObject(e[r])?n+=r+"="+this.FixedEncodeURIComponent(JSON.stringify(e[r])):Array.isArray(e[r])?e[r].forEach(function(e,t){n+=(0<t?"&":"")+r+"="+e}):n+=r+"="+e[r]);return n},l.addListenerOnAddMyWayHeaders=function(e){l.listenersOnAddMyWayHeaders.push(e)},l.removeListenerOnAddMyWayHeaders=function(t){l.ArrayUtils.remove(l.listenersOnAddMyWayHeaders,function(e){return e===t})},l.AddMyWayHeaders=function(t,n){n.withHeaders&&(t.headers["X-versionComposant"]=n.versionComposant,t.headers["X-typeOrigineComposant"]="1",t.headers["X-dateHeureInstanciation"]=Date.now().toString(),t.headers["X-typeCanal"]="01",t.headers["X-typeDevice"]="01",l.listenersOnAddMyWayHeaders.forEach(function(e){e(t.headers,n)})),n.cache||(t.headers["Cache-Control"]="no-cache",t.headers.Pragma="no-cache")},l.Send=function(n,r,e){l.logger.debug("Debut envoi requete: %1",n.url);var o=!1;if(l.PreventMultipleJSONCalls&&5<n.url.length&&".json"===n.url.substring(n.url.length-5)&&(o=!0,l.SavedJSON[n.url]))n.success(l.SavedJSON[n.url]);else{var i=new XMLHttpRequest;for(var t in n=n,i.open(n.method,n.url,n.async),e&&!0===n.async&&(i.withCredentials=!0),!0===n.async&&(n.timeout?i.timeout=n.timeout:i.timeout=3e4),i.ontimeout=function(){l.traiterErreur(i,n,r,null,!0)},i.onload=function(e){if(i.status<400){if(l.logger.debug("Success requete: %1",n.url),u.Controle.StaticFunctionControle.isFunction(n.success))if(n.originalResponse)n.success(i);else{var t=l.GetResponse(i,n.responseType,r);l.PreventMultipleJSONCalls&&o&&(l.SavedJSON[n.url]=t),n.success(t)}}else l.traiterErreur(i,n,r)},n.headers){var s=n.headers[t];i.setRequestHeader(t,s)}if(n.async)i.onerror=function(e){l.traiterErreur(i,n,r)},i.send(n.data);else try{i.send(n.data)}catch(e){l.traiterErreur(i,n,r,e)}}},l.GetResponse=function(t,e,n){var r=t.response;if(u.Controle.StaticStringControle.isString(t.response)&&""!==t.response&&("json"===t.responseType||"json"===e))try{r=JSON.parse(t.response)}catch(e){var o="une erreur (";e&&(o+=e.message),o+=") est survenue en déserialisant le json suivant : '"+t.response+"'",l.logger.warn(o)}return r},l.traiterErreur=function(e,t,n,r,o){if(n){var i={};e.response&&u.Controle.StaticStringControle.isString(e.response)&&(i={text:e.response}),o?(i.clientTimeout=!0,u.Loggers.FLASH.INSTANCE.setValue("action","traiterErreur"),u.Loggers.FLASH.INSTANCE.setValue("details",i),l.logger.error("Erreur requete (timeout client): %1",t.url)):0==e.status?(u.Loggers.FLASH.INSTANCE.setValue("action","traiterErreur"),u.Loggers.FLASH.INSTANCE.setValue("details",i),l.logger.error("Erreur requete (acces serveur impossible): %1",t.url)):(u.Loggers.FLASH.INSTANCE.setValue("action","traiterErreur"),u.Loggers.FLASH.INSTANCE.setValue("details",i),l.logger.error("Erreur requete (%1): %2",e.status,t.url))}var s;if(u.Controle.StaticFunctionControle.isFunction(t.error)){if(r)s=new c(u.Libelle.LibelleModel.COM.ERREUR_SERVEUR,[e.statusText+"\nErreur levée : "+r.toString()],r);else{var a=l.GetResponse(e,"json",n);u.Controle.StaticObjectControle.isObject(a)&&a.codeLibelle?(s=a).codeHttp=e.status:s=o?new E(e.status,u.Libelle.LibelleModel.COM.ERREUR_TIMEOUT_CLIENT,e.statusText):504===e.status?new E(e.status,u.Libelle.LibelleModel.COM.ERREUR_TIMEOUT_SERVEUR,e.statusText):0===e.status?new E(e.status,u.Libelle.LibelleModel.COM.ERREUR_ACCES_SERVEUR,e.statusText):new E(e.status,u.Libelle.LibelleModel.COM.ERREUR_SERVEUR,e.statusText)}t.error(s)}},l.addListenerOnCheckSettings=function(e){this.listenersOnCheckSettings.push(e)},l.removeListenerOnCheckSettings=function(t){l.ArrayUtils.remove(this.listenersOnCheckSettings,function(e){return e===t})},l.CheckSettings=function(t){if(!u.Controle.StaticObjectControle.isObject(t))throw"settings doit être un objet non null!";u.Controle.StaticEnumControle.isAnEnumValue(t.method,C)||(u.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.data)?t.method=C.POST:t.method=C.GET),u.Controle.StaticBooleanControle.isBoolean(t.async)||(t.async=!0),u.Controle.StaticEnumControle.isAnEnumValue(t.contentType,g)||(u.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.data)?t.contentType=g.JSON:t.contentType=g.NONE),u.Controle.StaticEnumControle.isAnEnumValue(t.accept,y)||(t.accept=y.ALL),u.Controle.StaticBooleanControle.isBoolean(t.cache)||(t.cache=!0),u.Controle.StaticBooleanControle.isBoolean(t.withHeaders)||(t.withHeaders=!0),u.Controle.StaticEnumControle.isAnEnumValue(t.responseType,d)||(t.responseType=d.NOT_DEFINED),!t.versionComposant&&l.VersionMySys&&(t.versionComposant=l.VersionMySys),l.listenersOnCheckSettings.forEach(function(e){e(t)})},l.creerChaineAleatoire=function(e){for(var t=Math.random().toString(36).substring(2);t.length<e;)t+=Math.random().toString(36).substring(2);return t.length>e&&(t=t.substring(0,e)),t},l.prototype.creerChaineAleatoire=function(e){return l.creerChaineAleatoire(e)},l.applyProperties=function(e,t,n){if(D.Services.Controle.StaticObjectControle.isObject(e[n]))for(var r in t[n]||(t[n]={}),e[n])D.Services.Controle.StaticObjectControle.isObject(e[n][r])?this.applyProperties(e[n],t[n],r):t[n][r]=e[n][r];else t[n]=e[n]},l.loadCdnServiceScript=function(e){var t=l.getBaseFolder(e);t&&l.loadScript(t+"/"+e)},l.loadCdnAddonsServiceScript=function(e){var t=l.getBaseFolder(e);t&&l.loadScript(t+"/../services-addons/"+e)},l.getBaseFolder=function(e){var t=document.getElementsByTagName("script"),n=null;for(var r in t){var o=t[r];if(o&&o.src&&0<o.src.indexOf("framework-client-")){n=o.src;break}}if(n){for(var i="",s=n.split("/"),a=0;a<s.length-1;a++)i+=s[a]+"/";return i.substr(0,i.length-1)}return null},l.loadScript=function(e){var t=document.getElementsByTagName("body")[0],n=document.createElement("script");n.type="text/javascript",n.src=e,t.appendChild(n)},l.encoderURL=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})},l.promesseTryCatch=function(e,t){return u.Promesses.promesseTryCatch(e,t)},l.prototype.promesseTryCatch=function(e,t){return u.Promesses.promesseTryCatch(e,t)},l.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&null!==e},l.CLASS_NAME="MyWay.Services.CoreCommon",l.logger=u.Loggers.LoggerFactory.INSTANCE.getClass(l.CLASS_NAME),l.PreventMultipleJSONCalls=!1,l.VersionMySys=null,l.listenersOnAddMyWayHeaders=[],l.SavedJSON=[],l.listenersOnCheckSettings=[],l.StringUtils={leftPad:function(e,t,n){for(var r=e.toString();r.length<n;)r=t+r;return r},rightPad:function(e,t,n){for(var r=e.toString();r.length<n;)r+=t;return r}},l.ArrayUtils={remove:function(e,t){if(!e)return e;for(var n=e.length,r=[],o=0;o<n;o++){var i=e[o];t(i)||r.push(i)}for(n=r.length,o=0;o<n;o++)e[o]=r[o];return e.length=r.length,e},keyExists:function(e,t){if(!t||t.constructor!==Array&&t.constructor!==Object)return!1;for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return e in t},getOne:function(e,t){for(var n=e.length;n--;)if(t(e[n]))return e[n];return null}},l.EnumUtils={getNamesAndValues:function(t){return l.EnumUtils.getNames(t).map(function(e){return{name:e,value:t[e]}})},getNames:function(e){return l.EnumUtils.getObjValues(e).filter(function(e){return"string"==typeof e})},getValues:function(e){return l.EnumUtils.getObjValues(e).filter(function(e){return"number"==typeof e})},getObjValues:function(t){return Object.keys(t).map(function(e){return t[e]})},listerEnums:function(e){var t=[];for(var n in e)"number"==typeof e[n]&&t.push(n);return t},getName:function(e,t){var n=null;for(var r in e)"number"==typeof e[r]&&e[r]===t&&(n=r);return n}},l.ObjectUtils={hasKeys:function(e,t,n){void 0===n&&(n=!1);var r=!0;return(!n||e.length==Object.keys(t).length)&&(e.forEach(function(e){D.Services.CoreCommon.ArrayUtils.keyExists(e,t)||(r=!1)}),r)},objectExistsByKeyValueList:function(e,t){for(var n=0;n<t.length;n++)if(D.Services.CoreCommon.ObjectUtils.hasKeyValuePairList(t[n],e))return t[n];return null},hasKeyValuePairList:function(e,t){for(var n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n].Key)||e[t[n].Key]!=t[n].Value)return!1;return!0},objectToArray:function(e){var t=[];for(var n in e)t.push({Key:n,Value:e[n]});return t},merge:function(t,n){for(var r in n)try{D.Services.CoreCommon.isObject(n[r])?t[r]=D.Services.CoreCommon.ObjectUtils.merge(t[r],n[r]):t[r]=n[r]}catch(e){t[r]=n[r]}return t},deepEquals:function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return!1;for(var n in e)if(!l.ObjectUtils.deepEquals(e[n],t[n]))return!1;for(var n in t)if(void 0!==t[n]&&void 0===e[n])return!1;return!0}},l);function l(){var e=o.call(this,u.Components.ComponentType.Core)||this;return e._serviceLocalDisponible=!1,e.StringUtils=l.StringUtils,e.ObjectUtils=l.ObjectUtils,e}u.CoreCommon=i;function s(e,t,n,r){this.CodeRetour=e,this.MessageRetour=t,this.DonneesRetour=n,this.Pid=r}u.ExecutionAppliExt=s;var a,c=(a=u.Erreur,__extends(p,a),p);function p(e,t,n){var r=a.call(this,e,t)||this;return r.error=n,r}u.ErreurClient=c;var f,g,h,d,m,y,v,C,S,E=(f=u.Erreur,__extends(A,f),A);function A(e,t,n,r,o){var i=f.call(this,t,r)||this;return i.codeHttp=e,i.libelle=n,i.causes=o,i}u.ErreurServeur=E,(h=g=u.ContentTypeEnum||(u.ContentTypeEnum={}))[h.NONE=0]="NONE",h[h.URL_ENCODED=1]="URL_ENCODED",h[h.JSON=2]="JSON",(m=d=u.ResponseTypeEnum||(u.ResponseTypeEnum={}))[m.BLOB=0]="BLOB",m[m.JSON=1]="JSON",m[m.EMPTY=2]="EMPTY",m[m.NOT_DEFINED=3]="NOT_DEFINED",(v=y=u.AcceptEnum||(u.AcceptEnum={}))[v.ALL=0]="ALL",v[v.JSON=1]="JSON",(S=C=u.MethodEnum||(u.MethodEnum={}))[S.DELETE=0]="DELETE",S[S.GET=1]="GET",S[S.POST=2]="POST",S[S.PUT=3]="PUT";var b=(Object.defineProperty(M.prototype,"previousStepEndTime",{set:function(e){this._previousStepEndTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"stepStartTime",{set:function(e){this._previousStepEndTime&&e<this._previousStepEndTime&&(e=this._previousStepEndTime),this._stepStartTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"displayTime",{set:function(e){this._stepStartTime&&e<this._stepStartTime&&(e=this._stepStartTime),this._displayTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"initTime",{set:function(e){this._displayTime&&e<this._displayTime&&(e=this._displayTime),this._initTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"userTime",{set:function(e){0===e?this._userTime=0:(this._initTime&&e<this._initTime&&(e=this._initTime),this._userTime=e)},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"lastDigestCycleTime",{set:function(e){this._initTime&&e<this._initTime&&(e=this._initTime),this._lastDigestCycleTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"stepStartDuration",{get:function(){return this._displayTime-this._previousStepEndTime},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"staticFilesLoadDuration",{get:function(){return this._initTime-this._displayTime},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"digestDuration",{get:function(){return this._lastDigestCycleTime-this._initTime},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"userDuration",{get:function(){return this.userDurationEnabled?this._userTime-this._displayTime:this._lastDigestCycleTime-this._displayTime},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"totalDisplayDuration",{get:function(){return this.staticFilesLoadDuration+this.digestDuration},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"totalStartDuration",{get:function(){return this.stepStartDuration+this.totalDisplayDuration},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"totalUserDuration",{get:function(){return this.stepStartDuration+this.userDuration},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"userDurationEnabled",{get:function(){return 0<this._userTime},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"startStatus",{get:function(){return 1e4<this.totalDisplayDuration?"danger":5e3<this.totalDisplayDuration?"warn":""},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"watchersStatus",{get:function(){return 2e3<this.watchers?"danger":1e3<this.watchers?"warn":""},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"digestStatus",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"contextStatus",{get:function(){return 1e5<this.contextSize?"danger":5e4<this.contextSize?"warn":""},enumerable:!0,configurable:!0}),M.prototype.clone=function(e){this.codeApplication=e.codeApplication,this.stepId=e.stepId,this.stepPath=e.stepPath,this._previousStepEndTime=e._previousStepEndTime,this._stepStartTime=e._stepStartTime,this._displayTime=e._displayTime,this._initTime=e._initTime,this._lastDigestCycleTime=e._lastDigestCycleTime,this.watchers=e.watchers,this.digestCycles=e.digestCycles,this.contextSize=e.contextSize,this.finalDiagnostic=e.finalDiagnostic},M);function M(){this.codeApplication="inconnu",this.stepId="inconnu",this.stepPath="inconnu",this._previousStepEndTime=0,this._stepStartTime=0,this._displayTime=0,this._initTime=0,this._lastDigestCycleTime=0,this.watchers=0,this.digestCycles=0,this.contextSize=0,this._userTime=-1,this.finalDiagnostic=!1}u.ApplicationDiagnostic=b;function T(e,t){this.Header=e,this.Payload=t}var P;u.MessageAppliExterne=T,(P=u.PayloadType||(u.PayloadType={}))[P.CONNECT=0]="CONNECT",P[P.DISCONNECT=1]="DISCONNECT",P[P.SEND=2]="SEND";function I(){}u.Header=I;function N(){}u.Sender=N;function L(){}u.Receiver=L;function _(){}u.Entity=_;function x(e,t){this.Sujet=e,this.Contenu=t}u.Payload=x,u.Components.RegistryCommon.getInstance().register(i)}(D.Services||(D.Services={}))}(MyWay=MyWay||{}),function(){var p;Date.prototype.toPrunedJSON=Date.prototype.toJSON,String.prototype.toPrunedJSON=String.prototype.toJSON;var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function f(e){return t.lastIndex=0,t.test(e)?'"'+e.replace(t,function(e){var t=n[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}JSON.pruned=function(e,t,n){return p=[],function e(t,n,r,o){var i,s,a,c,u,l=n[t];if(l&&"object"==typeof l&&"function"==typeof l.toPrunedJSON&&(l=l.toPrunedJSON(t)),null==l)return String(l);switch(typeof l){case"string":return f(l);case"number":return isFinite(l)?String(l):"null";case"boolean":return String(l);case"object":if(!l)return"null";if(r<=0||-1!==p.indexOf(l))return console.warn("... oh oh, it seems this object is too deep... depth max is "+r),'"-pruned-"';if(p.push(l),u=[],"[object Array]"===Object.prototype.toString.apply(l)){for(c=Math.min(l.length,o),i=0;i<c;i+=1)u[i]=e(i,l,r-1,o)||"null";return a=0===u.length?"[]":"["+u.join(",")+"]"}for(s in l)if(Object.prototype.hasOwnProperty.call(l,s))try{(a=e(s,l,r-1,o))&&u.push(f(s)+":"+a)}catch(e){}return a=0===u.length?"{}":"{"+u.join(",")+"}"}}("",{"":e},t=t||6,n=n||50)}}(),function(e){function t(){}(e.Services||(e.Services={})).NotificationMessage=t}(MyWay=MyWay||{}),function(e){var t,n,r;function o(e,t){this._doublonsPossibles=!1,this._nombreElements=0,this._fonctionCompare=e,this._doublonsPossibles=t}t=e.Services||(e.Services={}),n=t.Common||(t.Common={}),o.prototype.testerElements=function(e,t){return this._fonctionCompare(e,t)},Object.defineProperty(o.prototype,"doublonsPossibles",{get:function(){return this._doublonsPossibles},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"nombreElements",{get:function(){return this._nombreElements},enumerable:!0,configurable:!0}),o.prototype.ajouter=function(e){return this._racine?!!this.placerElement(e,this._racine)&&(this._nombreElements++,!0):(this._racine={parent:null,precedent:null,suivant:null,valeur:e},this._nombreElements=1,!0)},o.prototype.retirer=function(e){if(this._racine){var t=this.getMinimum(this._racine);if(null!==t)for(;t;)e(t.valeur)&&(this.retirerElement(t),this._nombreElements--),t=this.getSuivant(t)}},o.prototype.inferieurAAsc=function(e,t,n){if(this._racine){var r=this.getMinimum(this._racine),o=this.getPlusGrandInferieurA(e,t,this._racine);if(null!==r&&null!==o){for(;r!==o;)n(r.valeur),r=this.getSuivant(r);n(r.valeur)}}},o.prototype.inferieurADesc=function(e,t,n){if(this._racine){var r=this.getPlusGrandInferieurA(e,t,this._racine);if(null!=r)for(;null!=r;)n(r.valeur),r=this.getPrecedent(r)}},o.prototype.superieurAAsc=function(e,t,n){if(this._racine){var r=this.getPlusPetitSuperieurA(e,t,this._racine);if(null!=r)for(;null!=r;)n(r.valeur),r=this.getSuivant(r)}},o.prototype.superieurADesc=function(e,t,n){if(this._racine){var r=this.getMaximum(this._racine),o=this.getPlusPetitSuperieurA(e,t,this._racine);if(null!==r&&null!==o){for(;r!==o;)n(r.valeur),r=this.getPrecedent(r);n(r.valeur)}}},o.prototype.entreBornesAsc=function(e,t,n,r,o){if(this._racine){var i=this.getPlusPetitSuperieurA(e,t,this._racine),s=this.getPlusGrandInferieurA(n,r,this._racine);if(null!==i&&null!==s){for(var a=i;a!==s;)o(a.valeur),a=this.getSuivant(a);o(a.valeur)}}},o.prototype.entreBornesDesc=function(e,t,n,r,o){if(this._racine){var i=this.getPlusPetitSuperieurA(e,t,this._racine),s=this.getPlusGrandInferieurA(n,r,this._racine);if(null!==i&&null!==s){for(var a=s;a!==i;)o(a.valeur),a=this.getPrecedent(a);o(a.valeur)}}},o.prototype.toutParcourir=function(e){if(this._racine)for(var t=this.getMinimum(this._racine);null!=t;)e(t.valeur),t=this.getSuivant(t)},o.prototype.getParCritere=function(e,t){if(this._racine)for(var n=this.getMinimum(this._racine);null!=n;)e(n.valeur)&&t(n.valeur),n=this.getSuivant(n)},o.prototype.isExists=function(e){return null!==this.getElementInternal(e,this._racine)},o.prototype.getElement=function(e){return this.getElementInternal(e,this._racine)},o.prototype.getElementInternal=function(e,t){if(!t)return null;var n=this._fonctionCompare(t.valeur,e);return 0===n?t.valeur:n<0?t.suivant?this.getElementInternal(e,t.suivant):null:t.precedent?this.getElementInternal(e,t.precedent):null},o.prototype.getPlusGrandInferieurA=function(e,t,n){var r=this._fonctionCompare(n.valeur,e);if(r<0||0===r&&t){if(n.suivant){var o=this.getPlusGrandInferieurA(e,t,n.suivant);return o||n}return n}return n.precedent?this.getPlusGrandInferieurA(e,t,n.precedent):null},o.prototype.getPlusPetitSuperieurA=function(e,t,n){var r=this._fonctionCompare(n.valeur,e);if(0<r||0===r&&t){if(n.precedent){var o=this.getPlusPetitSuperieurA(e,t,n.precedent);return o||n}return n}return n.suivant?this.getPlusPetitSuperieurA(e,t,n.suivant):null},o.prototype.getMinimum=function(e){for(var t=e;t.precedent;)t=t.precedent;return t},o.prototype.getMaximum=function(e){for(var t=e;t.suivant;)t=t.suivant;return t},o.prototype.getSuivant=function(e){if(e.suivant)return this.getMinimum(e.suivant);if(e.parent){if(e.parent.precedent===e)return e.parent;for(var t=e;t.parent&&t.parent.suivant===t;)t=t.parent;return t.parent?t.parent:null}return null},o.prototype.getPrecedent=function(e){if(e.precedent)return this.getMaximum(e.precedent);if(e.parent){if(e.parent.suivant===e)return e.parent;for(var t=e;t.parent&&t.parent.precedent===t;)t=t.parent;return t.parent?t.parent:null}return null},o.prototype.placerElement=function(e,t){var n=this._fonctionCompare(t.valeur,e);return n<=0?!(0===n&&!this._doublonsPossibles)&&(t.suivant?this.placerElement(e,t.suivant):(t.suivant={valeur:e,precedent:null,suivant:null,parent:t},!0)):t.precedent?this.placerElement(e,t.precedent):(t.precedent={valeur:e,precedent:null,suivant:null,parent:t},!0)},o.prototype.retirerElement=function(e){var t,n=null,r=!e.parent;if(e.precedent)if(e.suivant){for(n=e.suivant,r||e.parent.precedent!==e?r||(e.parent.suivant=e.suivant,e.suivant.parent=e.parent):(e.parent.precedent=e.suivant,e.suivant.parent=e.parent),t=e.suivant;t.precedent;)t=t.precedent;t.precedent=e.precedent,t.precedent.parent=t}else n=e.precedent,r||e.parent.precedent!==e?r||(e.parent.suivant=e.precedent,e.precedent.parent=e.parent):(e.parent.precedent=e.precedent,e.precedent.parent=e.parent);else e.suivant?(n=e.suivant,r||e.parent.precedent!==e?r||(e.parent.suivant=e.suivant,e.suivant.parent=e.parent):(e.parent.precedent=e.suivant,e.suivant.parent=e.parent)):(n=null,r||e.parent.precedent!==e?r||(e.parent.suivant=null):e.parent.precedent=null);r&&(null===n?this._racine=null:(this._racine=n).parent=null)},r=o,n.ArbreBinaire=r}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Loggers="Loggers"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),(r=n.LoggersMessageSubject||(n.LoggersMessageSubject={}))[r.GetConfigActual=0]="GetConfigActual",r[r.SetConfigActual=1]="SetConfigActual",r[r.GetConfigDB=2]="GetConfigDB",r[r.SetConfigDB=3]="SetConfigDB",r[r.SaveConfig=4]="SaveConfig",r[r.LoadConfig=5]="LoadConfig",r[r.GetLoggers=6]="GetLoggers",r[r.GetNomConfigAcuelle=7]="GetNomConfigAcuelle",r[r.IsClassExists=8]="IsClassExists",r[r.Reset=9]="Reset",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Loggers,[t.Components.ComponentType.Core,t.Components.ComponentType.Evennements])}(MyWay=MyWay||{}),function(e){var p,t,r,n;function s(e,t,n,r,o,i,s,a){var c=this;this.canReceiveResponses=s,this.canReceiveNewMessages=a,this._currentIndex=0,this._callbackArray=[],this._me=null,this._ReceiveMessage=function(e){var t=e.data;if(t.RecipientZone===c._zoneName){if(null===t.Subject||void 0===t.Subject)throw"Subject is null - "+JSON.stringify(t);t.Subject.substring&&"Response - "===t.Subject.substring(0,11)?c.canReceiveResponses&&c.handleResponse(e):c.canReceiveNewMessages&&c.handleReception(e)}},this._SendResponse=function(e,t,n){var r=e.data,o={RequestId:r.RequestId,RecipientZone:r.SenderZone,RecipientComponent:null,SenderZone:c._zoneName,Subject:"Response - "+r.Subject,Content:t,CallbackIndex:r.CallbackIndex,ErreurCallbackIndex:r.ErreurCallbackIndex,Error:null};return p.CoreCommon.getPromesseSelfResoved().then(function(){if(n&&"Manager"===c._zoneName&&c._library.Libelle&&n.codeLibelle&&!n.libelle)return c._library.Libelle.constituerLibelle(n.codeLibelle,n.valeurs).then(function(e){n.libelle=e})}).then(function(){n&&JSON&&(o.Error=JSON.parse(JSON.stringify(n))),c.ValidateMessage(o),e.source&&c.postMessage(o,e.source,e.origin,null)})},this._targetWindow=e,this._targetDomain=t,this._authorizedDomains=n,this._recipientZone=r,this._zoneName=o,this._me=Math.random().toString(36).substring(2),this._library=i}p=e.Services||(e.Services={}),t=p.Message||(p.Message={}),r=function(){},s.prototype.createMessage=function(e,t,n,r,o){return{RequestId:"",SenderZone:this._zoneName,RecipientZone:this._recipientZone,RecipientComponent:e,Subject:t,Content:n,CallbackIndex:r,ErreurCallbackIndex:o,Error:null}},s.prototype.send=function(e,t,n,r,o,i){return this.sendWithResponse(e,t,n,r,o,i)},s.prototype.sendWithResponse=function(n,r,o,i,s,a){var c=this,u=null,l=null;return p.CoreCommon.promesseTryCatch(function(e){u=c._AddCallback(e.resolve),l=c._AddCallback(e.reject),i=i||c._targetWindow,s=s||c._targetDomain;var t=c.createMessage(n,r,o,u,l);c.ValidateMessage(t),s&&i?c.postMessage(t,i,s,a):(e.reject(new p.Erreur('Impossible d\'envoyer le message, la "target domain" et la "target window" n\'existent pas')),c._RemoveCallback(u),c._RemoveCallback(l))}).catch(function(e){throw c._RemoveCallback(u),c._RemoveCallback(l),e})},s.prototype._AddCallback=function(e){return this._currentIndex++,this._callbackArray[this._currentIndex]=e,this._currentIndex},s._getBaseDomain=function(e){var t=new r;if(0===e.indexOf("http://")){t.Root="http://";var n=e.replace("http://","").split("/")[0].split(":");t.Name=n[0],2==n.length?t.Port=n[1]:t.Port="80"}else 0===e.indexOf("https://")&&(t.Root="https://",n=e.replace("https://","").split("/")[0].split(":"),t.Name=n[0],2==n.length?t.Port=n[1]:(t.Root="http://",t.Port="443"));return t},s.prototype.handleReception=function(e){e.data,this.transmettreMessage(e)},s.prototype.transmettreMessage=function(t){var n=this,e=t.data;if(!s.IsDomainAuthorized(t.origin,this._authorizedDomains))throw t.origin+" is not authorized at Reception : "+JSON.stringify(e)+";"+JSON.stringify(this._authorizedDomains);var r=e.RecipientComponent,o=this._library[r];if(o){var i=t.data;try{o.reception({iframe:t.source,message:i.Content,subject:i.Subject}).then(function(e){n._SendResponse(t,e,null)},function(e){n._SendResponse(t,null,e)})}catch(e){console.error(e)}}else s.loggerMessageBase.warn("%1 can't be found. Message : %2",r,JSON.stringify(e)),this._SendResponse(t,null,new p.Erreur("not delivered"))},s.prototype.handleResponse=function(e){var t=e.data;if(!s.IsDomainAuthorized(e.origin,this._authorizedDomains))throw e.origin+" is not authorized at Response : "+JSON.stringify(t)+";"+JSON.stringify(this._authorizedDomains);t.Error?(t.CallbackIndex&&this._RemoveCallback(t.CallbackIndex),t.ErreurCallbackIndex&&this._ExecuteCallback(t.ErreurCallbackIndex,t.Error)):(t.ErreurCallbackIndex&&this._RemoveCallback(t.ErreurCallbackIndex),t.CallbackIndex&&this._ExecuteCallback(t.CallbackIndex,t.Content))},s.IsDomainAuthorized=function(e,t){var n=!1,r=s._getBaseDomain(e);for(var o in t){var i=s._getBaseDomain(t[o]);if(r.Root&&i.Root&&r.Root.toLowerCase()===i.Root.toLowerCase()&&r.Name&&i.Name&&r.Name.toLowerCase()===i.Name.toLowerCase()&&(r.Port===i.Port||"*"===i.Port)){n=!0;break}}return n},s.prototype._ExecuteCallback=function(e,t){var n=this._callbackArray[e];n&&(this._RemoveCallback(e),n(t))},s.prototype._RemoveCallback=function(e){this._callbackArray[e]&&delete this._callbackArray[e]},s.prototype.ValidateMessage=function(e){if(!e.Subject&&0!==e.Subject)throw"Subject is empty";if(e.RecipientZone===e.SenderZone)throw"recipient zone and sender zone are identical : "+e.RecipientZone+" - "+JSON.stringify(e)},s.CLASS_NAMEMessageBase="MyWay.Services.Message.MessageBase",s.loggerMessageBase=p.Loggers.LoggerFactory.INSTANCE.getClass(s.CLASS_NAMEMessageBase),n=s,t.MessageBase=n}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.Core||(t.Core={})).CoreMessageSubject||(n.CoreMessageSubject={}),t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Core,[]),t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Evennements,[])}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).RegistryType||(n.RegistryType={})).MANAGER="MANAGER"}(MyWay=MyWay||{}),function(s){var e,t,n,r;e=s.Test||(s.Test={}),t=e.V1||(e.V1={}),(n=t.Services||(t.Services={})).Erreur=s.Services.Erreur,n.Promesses=s.Services.Promesses,n.generateEmptyLibraryCommon=function(){return{Core:{createPromiseSelfResolved:s.Services.CoreCommon.createPromiseSelfResolved,createPromiseSelfError:s.Services.CoreCommon.createPromiseSelfError,promesseTryCatch:s.Services.CoreCommon.promesseTryCatch,getPromesseSelfResoved:s.Services.CoreCommon.getPromesseSelfResoved}}},n.override=function(e,t,n){if(void 0===e[t])throw new s.Services.Erreur("La méthode "+t+" n'existe pas sur l'objet "+e.constructor);e[t]=n},n.generateMessageService=function(){return{dispose:function(){s.Services.CoreCommon.getPromesseSelfResoved()},send:function(e,t,n,r,o,i){return s.Services.CoreCommon.createPromiseSelfError(new s.Services.Erreur("Send method not overrided for tests"))},sendWithResponse:function(e,t,n,r,o,i){return s.Services.CoreCommon.createPromiseSelfError(new s.Services.Erreur("SendWithResponse method not overrided for tests"))}}},(r=n.TestMode||(n.TestMode={}))[r.DeepEquals=0]="DeepEquals",r[r.StrictEquals=1]="StrictEquals",r[r.NoCheck=2]="NoCheck",r[r.ObjectPropertiesEquals=3]="ObjectPropertiesEquals",r[r.ArrayObjectPropertiesEquals=4]="ArrayObjectPropertiesEquals"}(MyWay=MyWay||{}),function(e){var i;(function(e){var t;(t=e.RegistryType||(e.RegistryType={})).AGENT="AGENT";var n,r=(n=e.AbstractRegistry,__extends(o,n),o.getInstance=function(){return null===o.instance&&(o.instance=new o,e.FactoryRegistries.getInstance().addRegistry(o.instance)),o.instance},Object.defineProperty(o.prototype,"managerInitializer",{set:function(e){this._agentInitializer=e},enumerable:!0,configurable:!0}),o.prototype.getRegistryCommon=function(){return this._dependenciesInstances[0]},o.prototype.init=function(e){var t=this;return this.getRegistryCommon().getComponentsInstances().forEach(function(e){t._componentsInstancesByKey[e.name]||(t._componentsInstances.push(e),t._componentsInstancesByKey[e.name]=e)}),this.messageService||(this.messageService=i.Message.MessageAgentFactory.createMessageAgent(this.getLibrary())),n.prototype.init.call(this,e)},o.prototype.initializeComponent=function(e){return e.init(this._componentsInstancesByKey,this.messageService,this._agentInitializer)},o.instance=null,o);function o(){var e=n.call(this,t.AGENT,[t.COMMON])||this;return e.messageService=null,e._agentInitializer=null,e}e.RegistryAgent=r})((i=e.Services||(e.Services={})).Components||(i.Components={}))}(MyWay=MyWay||{}),function(e){var r,t,n,o;function i(e){return n.call(this,e)||this}r=e.Services||(e.Services={}),t=r.Components||(r.Components={}),n=t.ComponentBase,__extends(i,n),i.prototype.init=function(e,t,n){return this.library=e,this.messageService=t,r.Promesses.getPromesseSelfResoved()},i.prototype.reception=function(t){var n=this;return r.Promesses.promesseTryCatch(function(e){e.reject(new r.Erreur("Subject "+t.subject+" not implemented on "+n.name+" agent"))})},i.prototype.dispose=function(){return r.Promesses.getPromesseSelfResoved()},i.prototype.sendMessage=function(e,t){return this.messageService.sendWithResponse(this.name,e,t)},o=i,t.ComponentAgentBase=o}(MyWay=MyWay||{}),function(e){var t,n,r,o,i;function s(e,t,n){return o.call(this,e,s.CLASSNAME,t,n)||this}t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),r=n.Appenders||(n.Appenders={}),o=r.AbstractAppender,__extends(s,o),Object.defineProperty(s,"METHODE_PURGE_TRACES",{set:function(e){(s._METHODE_PURGE_TRACES=e)&&(s.logs.forEach(function(e){s._METHODE_PURGE_TRACES(e)}),s.logs.length=0)},enumerable:!0,configurable:!0}),s.prototype.onAppend=function(e){s._METHODE_PURGE_TRACES?s._METHODE_PURGE_TRACES(e):s.logs.push(e)},s.CLASSNAME="MyWay.Services.Loggers.Appenders.BroadcastAppender",s.logs=[],s._METHODE_PURGE_TRACES=null,i=s,r.BroadcastAppender=i,n.LoggerFactory.INSTANCE.declareAppender(i.CLASSNAME,i)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Controle)||this}t=e.Services||(e.Services={}),n=t.Controle||(t.Controle={}),r=t.Components.ComponentAgentBase,__extends(i,r),Object.defineProperty(i.prototype,"Any",{get:function(){return i.logger.info("Méthode à surveiller - AnyControle"),new n.AnyControle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Array",{get:function(){return i.logger.info("Méthode à surveiller - AnyControleArrayControle"),new n.ArrayControle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Boolean",{get:function(){return i.logger.info("Méthode à surveiller - BooleanControle"),new n.BooleanControle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Date",{get:function(){return i.logger.info("Méthode à surveiller - DateControle"),new n.DateControle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Enum",{get:function(){return i.logger.info("Méthode à surveiller - EnumControle"),new n.EnumControle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Function",{get:function(){return i.logger.info("Méthode à surveiller - FunctionControle"),new n.FunctionControle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Number",{get:function(){return i.logger.info("Méthode à surveiller - NumberControle"),new n.NumberControle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Object",{get:function(){return i.logger.info("Méthode à surveiller - ObjectControle"),new n.ObjectControle},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"String",{get:function(){return i.logger.info("Méthode à surveiller - StringControle"),new n.StringControle},enumerable:!0,configurable:!0}),i.CLASS_NAME="MyWay.Services.Controle.ControleAgent",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.ControleAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var d;(function(e){var r,t=(r=e.MessageBase,__extends(n,r),n.prototype.replaceLibrary=function(e){this._library=e},n.prototype.dispose=function(){},n);function n(e,t,n){return r.call(this,t,n,["file:\\",n],"Manager","Agent",e,!0,!0)||this}e.MessageAgentBase=t;var i,o=(__extends(s,i=t),s.prototype.dispose=function(){window.removeEventListener("message",this._ReceiveMessage)},s.prototype.postMessage=function(e,t,n,r){t.postMessage(e,n)},s.CLASS_NAME="MyWay.Services.Message.MessageAgent",s.logger=d.Loggers.LoggerFactory.INSTANCE.getClass(s.CLASS_NAME),s);function s(e){var t,n,r;if(parent!==window)return n=parent,r=d.AppServiceParameters.Instance().PortalDomain,t=i.call(this,e,n,r)||this,window.addEventListener("message",t._ReceiveMessage),t;var o="MessageAgent ne fonctionne que si l'application est intégrée dans un portail";throw s.logger.error(o),o}e.MessageAgent=o;var a=(c.createMessageAgent=function(e){return parent!==window?new o(e):d.ServiceManager&&d.ServiceManager.Instance()?new g(e):new l(e)},c);function c(){}e.MessageAgentFactory=a;var u,l=(__extends(p,u=t),p.prototype.SendMessage=function(e,t,n,r,o,i,s){p.logger.error("l'application n'est pas hébergée dans une iframe, les services techniques ne peuvent pas fonctionner : tentative de d'envoi de message vers [%1] au sujet de [%2] a échoué",e,t),console.warn("l'application n'est pas hébergée dans une iframe, les services techniques ne peuvent pas fonctionner : tentative de d'envoi de message vers ["+e+"] au sujet de ["+t+"] a échoué")},p.prototype.postMessage=function(e,t,n,r){t.postMessage(e,n)},p.CLASS_NAME="MyWay.Services.Message.SelfMessageManager",p.logger=d.Loggers.LoggerFactory.INSTANCE.getClass(p.CLASS_NAME),p);function p(e){return u.call(this,e,window,window.location.protocol+"//"+window.location.host)||this}e.SelfMessageManager=l;var f,g=(__extends(h,f=t),h.prototype.postMessage=function(e,t,n,r){var o={};o.data=e,o.origin=n,o.source=t,d.ServiceManager.Instance().Library.Message._ReceiveMessage(o)},h.CLASS_NAME="MyWay.Services.Message.MobileMessageAgent",h.logger=d.Loggers.LoggerFactory.INSTANCE.getClass(h.CLASS_NAME),h);function h(e){var t=f.call(this,e,window,window.location.protocol+"//"+window.location.host)||this;return h.Instance=t}e.MobileMessageAgent=g})((d=e.Services||(e.Services={})).Message||(d.Message={}))}(MyWay=MyWay||{}),function(e){!function(s){s.onInitUsableLoggerForServiceAgent=null;var e=(Object.defineProperty(a.prototype,"Library",{get:function(){return this._serviceLibrary},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"idServiceAgent",{get:function(){return this._idServiceAgent},enumerable:!0,configurable:!0}),a.prototype.init=function(n){var r=this;if("IZIVENTE"===n.codeApplication){var o=s.CoreCommon.ServiceDePromesse.defer(),i=new s.Message.MessageAgent({});return this.Context={AddToContext:function(e,t){var n=s.CoreCommon.ServiceDePromesse.defer();return i.send(s.Components.ComponentType.Context,s.Context.ContextMessageSubject.AddToContext,{key:e,value:t}),n.resolve(!0),n.promise}},this.Lisa={Next:function(e){var t=s.CoreCommon.ServiceDePromesse.defer();return i.send(s.Components.ComponentType.Lisa,s.Lisa.Messages.LisaMessageSubject.Next,{valeurSortie:e}),t.resolve(null),t.promise}},o.resolve(this),o.promise}this._idServiceAgent=Math.random().toString(36).substring(2),o=s.CoreCommon.ServiceDePromesse.defer();var e=[];if(this.IsInitInProgress)o.reject(new s.Erreur("Initialisation du serviceAgent déjà lancée... Il ne peut pas y avoir deux initialisations simultanées."));else{this.IsInitInProgress=!0;var t=JSON.stringify(n);this.IsInitDone&&this._serializedInitialisationValues===t?a.logger.warn("serviceAgent déjà initialisé"):(this._serializedInitialisationValues=t,(n=n||{codeApplication:null,onNotification:null}).onGlobalError||(n.onGlobalError=this._displayError),o.promise.catch(n.onGlobalError),s.Components.RegistryAgent.getInstance().managerInitializer={applicationVersion:"",codeApplication:n.codeApplication,disableGetStepInfo:n.disableGetStepInfo,disableScopeSave:n.disableScopeSave,donneesScopeASauvegarder:n.donneesScopeASauvegarder,scopeType:n.scopeType},e.push(function(){return s.Components.FactoryRegistries.getInstance().init().then(function(){for(var e in r._serviceLibrary=s.Components.RegistryAgent.getInstance().getLibrary(),r._serviceLibrary)r[e]=r._serviceLibrary[e];for(var t in r.Library)r[t]=r.Library[t];return s.AppServiceParameters.Instance().MessageAgent||r.IsInitDone?r._initAgents(n,n.onGlobalError):r._initAgents(n,o.reject)})}),this.IsInitDone||e.push(function(){return r.onNotificationForSPA&&(r.Library.Core.removeListenerOnNotification(r.onNotificationForSPA),r.onNotificationForSPA=null),r.Library.Core.getPromesseSelfResoved()})),n.disableGetStepInfo&&!0===n.disableGetStepInfo?e.push(function(){return r.Library.Context?r.Library.Context.SetMyWayCompatible():r.Library.Core.getPromesseSelfResoved()}):e.push(function(){if(r.Library.Context)return r.Library.Context.GetCurrentStepInfo().then(function(e){r.Library.Context.StepInfo=e})}),n.capacitesChat&&e.push(function(){return r.Library.Core.promesseTryCatch(function(e){r.Library.Chat&&r.Library.Chat.addChatCapacity(),e.resolve()})}),e.push(function(){return r._initTerminee(n.onNotification)}),s.Promesses.executePromisesSequentially(e).then(function(){o.resolve(r)},o.reject)}return o.promise},a.prototype._initAgents=function(t,e){var n=this;return s.CoreCommon.promesseTryCatch(function(e){s.CoreCommon.loadCdnAddonsServiceScript("framework-client-app-addon.js"),s.onInitUsableLoggerForServiceAgent&&s.onInitUsableLoggerForServiceAgent(n,t.codeApplication),e.resolve()})},a.prototype.SendRequest=function(n){return s.CoreCommon.promesseTryCatch(function(t){var e=n;e.logger=a.logger,s.CoreCommon.SendRequest(e,function(e){t.resolve(e)},function(e){t.reject(e)})})},a.prototype.SubscribeToNotification=function(t){var n=this;null!==this.onNotificationForSPA&&this.Library.Core.removeListenerOnNotification(this.onNotificationForSPA),this.onNotificationForSPA=function(e){t(e,n)},this.Library.Core.addListenerOnNotification(this.onNotificationForSPA)},a.prototype.Dispose=function(){return s.Components.FactoryRegistries.getInstance().dispose()},a.prototype.OnNotification=function(e,t){},a.staticInit=function(){window.onerror=function(e,t,n,r,o){if(-1<e.toString().toLowerCase().indexOf("script error"))console.error("Script Error: See Browser Console for Detail");else{var i=["Message: "+e,"URL: "+t,"Line: "+n,"Column: "+r,"Error object: "+JSON.stringify(o)].join(" - ");console.error(i)}return!1},window.addEventListener("error",function(e){console.error(JSON.stringify(e)),a.logger.error(JSON.stringify(e))},!1)},a.CLASS_NAME="MyWay.Services.ServiceAgent",a.logger=s.Loggers.LoggerFactory.INSTANCE.getClass(a.CLASS_NAME),a);function a(){var n=this;this.$$framework="$$framework",this.IsInitDone=!1,this.IsInitInProgress=!1,this.onNotificationForSPA=null,this._initTerminee=function(t){return n.Library.Core.addListenerOnNotification(function(e){n.OnNotification(e,n),t&&t(e,n)}),n.IsInitDone=!0,n.IsInitInProgress=!1,n.Library.Core.getPromesseSelfResoved()},this._displayError=function(e){a.logger.warn(e.codeLibelle)}}(s.ServiceAgent=e).staticInit()}(e.Services||(e.Services={}))}(MyWay=MyWay||{}),function(e){var t,n;function r(){if(r._instance)throw new Error("Error: Instantiation failed: Use AppServiceParameters.Instance() instead of new.");r._instance=this}t=e.Services||(e.Services={}),r.Instance=function(){return null===r._instance&&(r._instance=new r),r._instance},r._instance=null,n=r,t.AppServiceParameters=n}(MyWay=MyWay||{}),function(e){!function(e){"undefined"!=typeof angular&&e.moduleAgent.service("instanceLoaderService",e.InstanceLoaderService);var o=(i.Instance=function(e,t,n,r){return null===i._serviceAgentExtended&&(i._serviceAgentExtended=new a(e,t,n,r)),i._serviceAgentExtended},i.prototype.init=function(e){var t=this,n=this.$q.defer();return i.Instance(this.$q,this.instanceLoaderService,this.$timeout,this.$rootScope).init(e).then(function(){n.resolve(i.Instance(t.$q,t.instanceLoaderService,t.$timeout,t.$rootScope))},function(){n.reject()}),n.promise},i.$inject=["$q","instanceLoaderService","$timeout","$rootScope"],i._serviceAgentExtended=null,i);function i(e,t,n,r){this.$q=e,this.instanceLoaderService=t,this.$timeout=n,this.$rootScope=r}e.ServiceAgentProvider=o;var s,a=(s=e.ServiceAgent,__extends(c,s),c.onNewInstance=function(e){c.onNewInstanceTraitements.push(e)},c.prototype.init=function(t){var n=this,r=this.$q.defer(),o=Date.now();t=t||{codeApplication:""},this.listenersBeforeInitialization.forEach(function(e){e.call(n)});var e=this;return s.prototype.init.call(this,t).then(function(){n.listenersAfterInitialization.forEach(function(e){e.call(n,t,o)}),r.resolve(e)},function(e){r.reject(e)}),r.promise},c.prototype.addListenerBeforeInitialization=function(e){this.listenersBeforeInitialization.push(e)},c.prototype.addListenerAfterInitialization=function(e){this.listenersAfterInitialization.push(e)},c.prototype.removeListenerBeforeInitialization=function(t){e.CoreCommon.ArrayUtils.remove(this.listenersBeforeInitialization,function(e){return e===t})},c.prototype.removeListenerAfterInitialization=function(t){e.CoreCommon.ArrayUtils.remove(this.listenersAfterInitialization,function(e){return e===t})},c.prototype.sendRequest=function(e,t){var n=this,r=this.$q.defer();return s.prototype.SendRequest.call(this,e).then(function(e){t&&(e=n.instanceLoaderService.createInstance(t,e)),e&&"string"==typeof e&&(e=JSON.parse(e)),r.resolve(e)},function(e){r.reject(e)}),r.promise},c.prototype.LogDemarrage=function(){var e=this;c.logger_extended.debug("Début demarrage"),this.$timeout&&this.$timeout(function(){c.logger_extended.debug("Fin render")}),this.$rootScope&&this.$rootScope.$evalAsync(function(){c.logger_extended.debug("Fin digest"),e.$timeout&&e.$timeout(function(){c.logger_extended.debug("Fin render")})})},c.prototype.OnNotification=function(e,t){"FrameHidden"===e.Sujet?window.clearTimeout(this._watcherCountTimeout):"FrameShown"===e.Sujet&&t&&t.countWatchers&&t.countWatchers(),s.prototype.OnNotification.call(this,e,t)},c.CLASS_NAME_EXTENDED="MyWay.Services.ServiceAgentExtended",c.logger_extended=e.Loggers.LoggerFactory.INSTANCE.getClass(c.CLASS_NAME_EXTENDED),c.onNewInstanceTraitements=[],c.$inject=["$q","instanceLoaderService","$timeout","$rootScope"],c);function c(e,t,n,r){var o=s.call(this)||this;return o.$q=e,o.instanceLoaderService=t,o.$timeout=n,o.$rootScope=r,o._lastDigestTimerHandle=null,o.listenersBeforeInitialization=[],o.listenersAfterInitialization=[],c.onNewInstanceTraitements.forEach(function(e){e(o)}),o}e.ServiceAgentExtended=a,"undefined"!=typeof angular&&(e.moduleAgent.provider("serviceAgentExtended",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return o.Instance(e,t,n,r)}]}),e.moduleAgent.provider("serviceAgent",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return o.Instance(e,t,n,r)}]}),e.moduleAgent.provider("serviceAgentProvider",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return o.Instance(e,t,n,r)}]}))}(e.Services||(e.Services={}))}(MyWay=MyWay||{}),function(e){var r,t,o,n;function i(){var e=o.call(this)||this;return e._listenersOnNotification=[],e}r=e.Services||(e.Services={}),t=r.Core||(r.Core={}),o=r.CoreCommon,__extends(i,o),i.prototype.addListenerOnNotification=function(e){this._listenersOnNotification.push(e)},i.prototype.removeListenerOnNotification=function(t){r.CoreCommon.ArrayUtils.remove(this._listenersOnNotification,function(e){return t===e})},i.prototype.sendNotification=function(t){this._listenersOnNotification.forEach(function(e){e(t)})},i.prototype.init=function(e,t,n){return this.library=e,this.messageService=t,o.prototype.getPromesseSelfResoved.call(this)},i.prototype.reception=function(t){var n=this;return o.prototype.promesseTryCatch.call(this,function(e){e.reject(new r.Erreur("Subject "+t.subject+" not implemented on "+n.name+" agent"))})},i.prototype.dispose=function(){return o.prototype.getPromesseSelfResoved.call(this)},i.prototype.sendMessage=function(e,t){return this.messageService.sendWithResponse(this.name,e,t)},n=i,t.CoreAgent=n,r.Components.RegistryAgent.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).BaseDeDonnees="BaseDeDonnees"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.BaseDeDonnees||(t.BaseDeDonnees={}),r=n.Messages||(n.Messages={}),(o=r.BaseDeDonneesMessageSubject||(r.BaseDeDonneesMessageSubject={}))[o.GetBases=0]="GetBases",o[o.Get=1]="Get",o[o.GetAll=2]="GetAll",o[o.Find=3]="Find",o[o.Count=4]="Count",o[o.Ajouter=5]="Ajouter",o[o.Supprimer=6]="Supprimer",o[o.MettreAJour=7]="MettreAJour",o[o.ResetAll=8]="ResetAll",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.BaseDeDonnees,[])}(MyWay=MyWay||{}),function(e){var t,n,r,o,i,s,a,c,u;t=e.Services||(e.Services={}),n=t.BaseDeDonnees||(t.BaseDeDonnees={}),(r=n.messages||(n.messages={})).NOM_BIBLIOTHEQUE="BaseDeDonnees",(o=r.DB_UPGRADE_TYPE||(r.DB_UPGRADE_TYPE={}))[o.TABLE_CREER="tableCreer"]="TABLE_CREER",o[o.TABLE_SUPPRIMER="tableSupprimer"]="TABLE_SUPPRIMER",o[o.INDEX_CREER="indexCreer"]="INDEX_CREER",o[o.INDEX_SUPPRIMER="indexSupprimer"]="INDEX_SUPPRIMER",(i=r.CAPACITE||(r.CAPACITE={}))[i.VOLATILE=1]="VOLATILE",i[i.MONO_ENREGISTREMENT=2]="MONO_ENREGISTREMENT",i[i.MULTI_ENREGISTREMENT=3]="MULTI_ENREGISTREMENT",(s=r.TYPE_BASE||(r.TYPE_BASE={}))[s.INDEXEDDB="indexeddb"]="INDEXEDDB",s[s.LOCALSTORAGE="localstorage"]="LOCALSTORAGE",s[s.MEMORY="memory"]="MEMORY",(a=r.CLE_TYPE||(r.CLE_TYPE={}))[a.AUTOINCREMENT="autoincrement"]="AUTOINCREMENT",a[a.PATH="path"]="PATH",(c=r.CRITERE_TYPE||(r.CRITERE_TYPE={}))[c.EGAL="egal"]="EGAL",c[c.INFERIEUR="inferieur"]="INFERIEUR",c[c.SUPERIEUR="superieur"]="SUPERIEUR",c[c.BORNES="bornes"]="BORNES",(u=r.CRITERE_DIRECTION||(r.CRITERE_DIRECTION={}))[u.PRECEDENT="precedent"]="PRECEDENT",u[u.PRECEDENT_UNIQUE="precedent_unique"]="PRECEDENT_UNIQUE",u[u.SUIVANT="suivant"]="SUIVANT",u[u.SUIVANT_UNIQUE="suivant_unique"]="SUIVANT_UNIQUE"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Dates="Dates"}(MyWay=MyWay||{}),function(e){var l;(function(e){var o,t;(t=o=e.FORMATS_DATE||(e.FORMATS_DATE={}))[t.aaaammjj=10]="aaaammjj";var n,r=(n=l.Components.ComponentBase,__extends(u,n),u.prototype.init=function(){return l.CoreCommon.getPromesseSelfResoved()},u.prototype.dispose=function(){return l.CoreCommon.getPromesseSelfResoved()},u.prototype.getDateDuJour=function(e){var t="";if(l.Controle.StaticEnumControle.isAnEnumValue(e,o)||(t+="Le paramètre 'format' est obligatoire et sa valeur doit faire partie de l'enum 'FORMATS_DATE' / "),""!=t)return t=t.substring(0,t.lastIndexOf("/")-1),l.Loggers.FLASH.INSTANCE.setValue("action","getDateDuJour"),void u.logger.error(t);var n=new Date;switch(e){case o.aaaammjj:return n.getFullYear()+("0"+(n.getMonth()+1)).substr(-2,2)+("0"+n.getDate()).substr(-2,2);default:var r="Le format '"+e+"' n'est pas reconnu!";return l.Loggers.FLASH.INSTANCE.setValue("action","getDateDuJour"),u.logger.error(r),r}},u.prototype.isBissextile=function(){var e=(new Date).getFullYear();return e%4==0&&e%100!=0||e%400==0},u.prototype.getNbJoursMois=function(e,t){return[31,this.isBissextile()?29:28,31,30,31,30,31,31,30,31,30,31][t]},u.prototype.CompareDates=function(e,t,n){var r,o=Math.round(Math.abs((e.getTime()-t.getTime())/864e5));switch(n){case"d":r=1;break;case"m":r=30;break;case"y":r=365;break;default:r=1}return Math.floor(o/r)},u.prototype.addDate=function(e,t,n,r){var o="";if(l.Controle.StaticDateControle.isDate(e)||(o+="Le paramètre 'd' est obligatoire et doit être un objet date / "),l.Controle.StaticNumberControle.isInt(t)||(o+="Le paramètre 'jours' est obligatoire et doit être un nombre entier / "),l.Controle.StaticAnyControle.isNotUndefinedAndNotNull(n)&&!l.Controle.StaticNumberControle.isInt(n)&&(o+="Le paramètre 'mois' doit être un nombre entier / "),l.Controle.StaticAnyControle.isNotUndefinedAndNotNull(r)&&!l.Controle.StaticNumberControle.isInt(r)&&(o+="Le paramètre 'annees' doit être un nombre entier / "),""!=o)return o=o.substring(0,o.lastIndexOf("/")-1),l.Loggers.FLASH.INSTANCE.setValue("action","addDate"),void u.logger.error(o);var i=e.getTime(),s=new Date;if(0<t&&(i+=864e5*t),s.setTime(i),null!=n&&0<n){var a=s.getDate();s.setDate(1),s.setMonth(s.getMonth()+n);var c=this.getNbJoursMois(s.getFullYear(),s.getMonth());s.setDate(Math.min(a,c))}return null!=r&&0<r&&s.setFullYear(s.getFullYear()+r),s},u.CLASS_NAME="MyWay.Services.Dates.DatesCommon",u.logger=l.Loggers.LoggerFactory.INSTANCE.getClass(u.CLASS_NAME),u);function u(){return n.call(this,l.Components.ComponentType.Dates)||this}e.DatesCommon=r,l.Components.RegistryCommon.getInstance().register(r),l.Components.FactoryRegistries.getInstance().declareComponent(l.Components.ComponentType.Dates,[])})((l=e.Services||(e.Services={})).Dates||(l.Dates={}))}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Export="Export"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Export||(t.Export={}),(r=n.ExportMessageSubject||(n.ExportMessageSubject={}))[r.ExporterFichier=0]="ExporterFichier",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Export,[t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Export||(t.Export={}),(r=n.FORMAT_FICHIER||(n.FORMAT_FICHIER={}))[r.CSV="csv"]="CSV",(o=n.LOCALISATION||(n.LOCALISATION={}))[o.EN=0]="EN",o[o.FR=1]="FR"}(MyWay=MyWay||{}),function(e){var i;(function(e){var r;(r=e.RegistryType||(e.RegistryType={})).API="API";var o,t=(o=e.AbstractRegistry,__extends(n,o),n.getInstance=function(){return null===n.instance&&(n.instance=new n(e.FactoryRegistries.getInstance(),new i.ServiceApiFactory),e.FactoryRegistries.getInstance().addRegistry(n.instance)),n.instance},n.prototype.init=function(t){var n=this;return this.getRegistryCommon().getComponentsInstances().forEach(function(e){n._componentsInstancesByKey[e.name]||(n._componentsInstances.push(e),n._componentsInstancesByKey[e.name]=e)}),this.capabilities?o.prototype.init.call(this,t):this.serviceApiFactory.GetServiceLocalCapabilities().then(function(e){return n.capabilities=e,o.prototype.init.call(n,t)})},n.prototype.initializeComponent=function(e){return e.init(this.capabilities,this.factoryRegistries.getRegistryInstance(r.MANAGER).getLibrary(),this.apiInitializer)},n.prototype.getRegistryCommon=function(){return this._dependenciesInstances[0]},n.prototype.setApiInitializer=function(e){this.apiInitializer=e},n.instance=null,n);function n(e,t){var n=o.call(this,r.API,[r.COMMON])||this;return n.factoryRegistries=e,n.serviceApiFactory=t,n.capabilities=null,n.apiInitializer=null,n}e.RegistryApi=t})((i=e.Services||(e.Services={})).Components||(i.Components={}))}(MyWay=MyWay||{}),function(e){var r,t,n;function o(e){this._name=e,this.libraryManager=null,this.privatePortalServiceParameters=null,this.portalServiceParameters=null}r=e.Services||(e.Services={}),t=r.Components||(r.Components={}),o.prototype.init=function(e,t,n){return this.libraryManager=t,this.privatePortalServiceParameters=n.privatePortalServiceParameters,this.portalServiceParameters=n.portalServiceParameters,r.CoreCommon.getPromesseSelfResoved()},o.prototype.dispose=function(){return r.CoreCommon.getPromesseSelfResoved()},Object.defineProperty(o.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),o.prototype.WarnLocalServiceUnavailability=function(){o.loggerBase.warn("Le service local n'a pu être joint et a été désactivé. Veuillez redémarrer le service local et recharger le portail")},o.CLASS_NAMEBase="MyWay.Services.Component.ComponentApiBase",o.loggerBase=r.Loggers.LoggerFactory.INSTANCE.getClass(o.CLASS_NAMEBase),n=o,t.ComponentApiBase=n}(MyWay=MyWay||{}),function(e){var t,n;function r(){if(r._instance)throw new Error("Error: Instantiation failed: Use PrivatePortalServiceParameters.Instance() instead of new.");r._instance=this}t=e.Services||(e.Services={}),r.Instance=function(){return null===r._instance&&(r._instance=new r),r._instance},r.prototype.init=function(){this.AideUrl=t.PortalServiceParameters.Instance().RestUrl+"/aideenligne/v1",this.ApplicationUrl=t.PortalServiceParameters.Instance().RestUrl+"/portailmyway-v1/application",this.DonneesDelocaliseesUrl=t.PortalServiceParameters.Instance().RestUrl+"/donneesDelocalisees/v1/",this.TraceUrl=t.PortalServiceParameters.Instance().TraceUrl+"/trace/v2/trace",this.ConfigurationPosteUrl=t.PortalServiceParameters.Instance().RestUrl+"/configuration-poste/v1/configuration",this.PreferencesUrl=t.PortalServiceParameters.Instance().RestUrl+"/preferenceUtilisateur/v1",this.TraceSuiviUrl=t.PortalServiceParameters.Instance().TraceUrl+"/trace-suivis/v1/",this.AuthentificationUrl=t.PortalServiceParameters.Instance().RestUrl+"/infos-poste/v1/configuration",this.NumerotationTelephoniqueUrl=t.PortalServiceParameters.Instance().RestUrl+"/boiteoutil/v1/numerotationTelephonique",this.GetFichierFromGEDUrl=t.PortalServiceParameters.Instance().RestUrl+"/document-v1/contenu",this.HabilitationUrl=t.PortalServiceParameters.Instance().RestUrl+"/habilitation/v2",this.RADLADUrl=t.PortalServiceParameters.Instance().RestUrl+"/document-v1/reconnaissance",this.StockageUrl=t.PortalServiceParameters.Instance().RestUrl+"/document-v1/stockage",this.GedUrl=t.PortalServiceParameters.Instance().RestUrl+"/document/v1/contenu",this.ReferentielProcessusSiUrl=t.PortalServiceParameters.Instance().RestUrl+"/referentielprocessussi/v1",this.PortalInfoUrl=t.PortalServiceParameters.Instance().RestUrl+"/portailmyway/v1",this.LisaUrl=t.PortalServiceParameters.Instance().SpaUrl+"/lisa/v2",this.PortsServiceUrl=t.PortalServiceParameters.Instance().PortsServiceUrl,this.LocalServiceUrl=t.PortalServiceParameters.Instance().ServiceLocaleUrl,this.ImpressionUrl=t.PortalServiceParameters.Instance().ImpressionUrl,this.FichierMessage="/v1/data/MessagesMyWay_fr.json",this._lisaPlaceHolders={VERS:t.PortalServiceParameters.Instance().Version,"URL-SPA":t.PortalServiceParameters.Instance().SpaUrl,"URL-SPA-NEW":"##URL-SPA##",URL_SERVICE_LOCAL:t.PortalServiceParameters.Instance().ServiceLocaleUrl,PORT:"",ALIASTESTAPPS:"/myway.test-apps","ALIASTESTAPPS-CAPACITES":"/myway.utilitaires-socle-technique.capacites","ALIASTESTAPPS-CONTEXTVIEWER":"/myway.utilitaires-socle-technique.context-viewer","ALIASTESTAPPS-DATABASEVIEWER":"/myway.utilitaires-socle-technique.database-viewer","ALIASTESTAPPS-EXPORT":"/myway.utilitaires-socle-technique.export",ALIASPORTAIL:"/portail",PRESPMM:t.PortalServiceParameters.Instance().PresPMM,ENVPMM:t.PortalServiceParameters.Instance().EnvPMM,DOMPMM:t.PortalServiceParameters.Instance().DomainePMM},t.PortalServiceParameters.Instance().LisaFilePath&&(this.LisaFileUrl=t.PortalServiceParameters.Instance().CDNUrl+t.PortalServiceParameters.Instance().LisaFilePath),this.AuthorizedDomains=t.PortalServiceParameters.Instance().AuthorizedDomains,this.Environnement=t.PortalServiceParameters.Instance().Environnement,this.KofaxUrl="http://127.0.0.1:23023/session"},Object.defineProperty(r.prototype,"ModeDebug",{get:function(){return!!(this.TTLModeDebug&&this.TTLModeDebug>Date.now())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"LisaPlaceholders",{get:function(){return this._lisaPlaceHolders},set:function(e){this._lisaPlaceHolders=e},enumerable:!0,configurable:!0}),r._instance=null,n=r,t.PrivatePortalServiceParameters=n}(MyWay=MyWay||{}),function(e){!function(n){var e=(r.prototype.GetServiceLocalCapabilities=function(){var t=this;return n.CoreCommon.SendRequestWithPromise({url:n.PrivatePortalServiceParameters.Instance().PortsServiceUrl+"/ports/GetPortUtilisateur",cache:!1,timeout:3e3}).then(function(e){n.PrivatePortalServiceParameters.Instance().LocalServiceUrl="http://localhost:"+e+"/"}).catch(function(){return t.DeviceCapabilities}).finally(function(){return n.CoreCommon.SendRequestWithPromise({url:n.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/contexte/GetCompetencesSL",cache:!1,timeout:3e3}).then(function(e){t.DeviceCapabilities.ServiceLocal=!0,t.DeviceCapabilities.SIRIS=e.SIRIS,t.DeviceCapabilities.InteropAppliBancaire=e.interopApplicationBancaire,r.logger.info("GetCompetencesSL : SIRIS=%1;InteropAppliBancaire=%2",e.SIRIS,e.interopApplicationBancaire)}).catch(function(e){t.DeviceCapabilities.ServiceLocal=!1,t.DeviceCapabilities.SIRIS=!1,t.DeviceCapabilities.InteropAppliBancaire=!1,r.logger.info("GetCompetencesSL pas disponible : %1",e.codeLibelle)}).finally(function(){t.DeviceCapabilities.MobileBrowser=n.CoreCommon.IsMobileBrowser()})}).then(function(){return t.DeviceCapabilities})},r.CLASS_NAME="MyWay.Services.ServiceApiFactory",r.logger=n.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),r);function r(){this.DeviceCapabilities=new t}n.ServiceApiFactory=e;var t=function(){};n.DeviceCapabilities=t;function o(){}n.CompetencesServiceLocal=o}(e.Services||(e.Services={}))}(MyWay=MyWay||{}),function(e){var c;(function(e){var n=(t.filtrer=function(e,t){var n="";if(c.Controle.StaticArrayControle.isArray(e)||(n+="Le paramètre 'collection' est obligatoire et doit être un tableau / "),c.Controle.StaticFunctionControle.isFunction(t)||(n+="Le paramètre 'predicat' est obligatoire et doit être une fonction / "),""!=n)throw n=n.substring(0,n.lastIndexOf("/")-1);for(var r=[],o=-1,i=e.length;++o<i;){var s=e[o],a=t(s);if(!c.Controle.StaticBooleanControle.isBoolean(a)){r=null;break}a&&r.push(s)}return r},t);function t(){}e.StaticArrayExtension=n;var r=(o.prototype.filtrer=function(e,t){return n.filtrer(e,t)},o);function o(){}e.ArrayExtension=r})((c=e.Services||(e.Services={})).Donnees||(c.Donnees={}))}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Donnees="Donnees"}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){var e=r.call(this,t.Components.ComponentType.Donnees)||this;return e.Enum=new n.EnumExtension,e.Array=new n.ArrayExtension,e.Object=new n.ObjectExtension,e.String=new n.StringExtension,e}t=e.Services||(e.Services={}),n=t.Donnees||(t.Donnees={}),r=t.Components.ComponentBase,__extends(i,r),i.prototype.init=function(){return t.CoreCommon.getPromesseSelfResoved()},i.prototype.dispose=function(){return t.CoreCommon.getPromesseSelfResoved()},o=i,n.DonneesCommon=o,t.Components.RegistryCommon.getInstance().register(o),t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Donnees,[])}(MyWay=MyWay||{}),function(e){var t;(function(e){var n=(t.getNames=function(e){var t=[];for(var n in e)"number"==typeof e[n]&&t.push(n);return t},t.getName=function(e,t){var n=null;for(var r in e)"number"==typeof e[r]&&e[r]===t&&(n=r);return n},t.getValues=function(e){var t=[];for(var n in e)"number"!=typeof e[n]&&t.push(parseInt(n,10));return t},t.getValue=function(e,t){var n=null;for(var r in e)"number"!=typeof e[r]&&e[r]===t&&(n=Number(r));return n},t.getValuesAndNames=function(e){var t=[];for(var n in e)"number"!=typeof e[n]&&t.push({value:Number(n),name:e[Number(n)]});return t},t);function t(){}e.StaticEnumExtension=n;var r=(o.prototype.getNames=function(e){return n.getNames(e)},o.prototype.getName=function(e,t){return n.getName(e,t)},o.prototype.getValues=function(e){return n.getValues(e)},o.prototype.getValue=function(e,t){return n.getValue(e,t)},o.prototype.getValuesAndNames=function(e){return n.getValuesAndNames(e)},o);function o(){}e.EnumExtension=r})((t=e.Services||(e.Services={})).Donnees||(t.Donnees={}))}(MyWay=MyWay||{}),function(e){var i;(function(e){var t=(n.getTaille=function(e){return i.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e)?JSON.stringify(e).length:0},n);function n(){}e.StaticObjectExtension=t;var r=(o.prototype.getTaille=function(e){return t.getTaille(e)},o);function o(){}e.ObjectExtension=r})((i=e.Services||(e.Services={})).Donnees||(i.Donnees={}))}(MyWay=MyWay||{}),function(e){var i;(function(e){var t=(n.getEmptyStringIfNotStringOrGetItSelf=function(e){return i.Controle.StaticStringControle.isStringNotEmpty(e)?e:""},n);function n(){}e.StaticStringExtension=t;var r=(o.prototype.getEmptyStringIfNotStringOrGetItSelf=function(e){return t.getEmptyStringIfNotStringOrGetItSelf(e)},o);function o(){}e.StringExtension=r})((i=e.Services||(e.Services={})).Donnees||(i.Donnees={}))}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Fichier||(t.Fichier={}),(r=n.TYPE_FICHIER||(n.TYPE_FICHIER={}))[r.PDF=0]="PDF",r[r.PDF_EMBED=5]="PDF_EMBED",r[r.PDFA_1A=10]="PDFA_1A",r[r.PDFA_1B=15]="PDFA_1B",r[r.PDFX_1_2001=20]="PDFX_1_2001",r[r.PDFX_1A_2001=25]="PDFX_1A_2001",r[r.PDFX_1A_2003=30]="PDFX_1A_2003",r[r.PDFX_3_2002=35]="PDFX_3_2002",r[r.PDFX_3_2003=40]="PDFX_3_2003",r[r.JSON=105]="JSON",r[r.TAR_GZ=110]="TAR_GZ",r[r.WORDML=100]="WORDML",(o=n.TYPE_DONNEES_A_SAUVER||(n.TYPE_DONNEES_A_SAUVER={}))[o.BLOB=0]="BLOB",o[o.BASE64=1]="BASE64"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Fichier="Fichier"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Fichier||(t.Fichier={}),(r=n.FichierMessageSubject||(n.FichierMessageSubject={}))[r.SaveAs=0]="SaveAs",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Fichier,[])}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Persistence="Persistence"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.Persistence||(t.Persistence={})).PersistenceMessageSubject||(n.PersistenceMessageSubject={}),t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Persistence,[])}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).TraitementNsdk="TraitementNsdk"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.TraitementNsdk||(t.TraitementNsdk={}),(r=n.TraitementNsdkMessageSubject||(n.TraitementNsdkMessageSubject={}))[r.Lancer=0]="Lancer",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.TraitementNsdk,[t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).JAB="JAB"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.JAB||(t.JAB={}),(r=n.JABMessageSubject||(n.JABMessageSubject={}))[r.Enregistrer=0]="Enregistrer",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.JAB,[t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Loggers)||this}t=e.Services||(e.Services={}),n=t.Loggers||(t.Loggers={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.getConfigurationDB=function(e){return this.sendMessage(n.LoggersMessageSubject.GetConfigDB,{nom:e}).then(function(e){return e.config})},i.prototype.setConfigurationDB=function(e,t){return this.sendMessage(n.LoggersMessageSubject.SetConfigDB,{nom:e,config:t})},i.prototype.getConfigurationActual=function(){return this.sendMessage(n.LoggersMessageSubject.GetConfigActual,{}).then(function(e){return e.config})},i.prototype.setConfigurationActual=function(e){return this.sendMessage(n.LoggersMessageSubject.SetConfigActual,{config:e})},i.prototype.loadConfiguration=function(e){return this.sendMessage(n.LoggersMessageSubject.LoadConfig,{nom:e})},i.prototype.saveConfiguration=function(e){return this.sendMessage(n.LoggersMessageSubject.SaveConfig,{nom:e})},i.prototype.getLoggers=function(){return this.sendMessage(n.LoggersMessageSubject.GetLoggers,{}).then(function(e){return e.loggers})},i.prototype.getNomConfigActuelle=function(){return this.sendMessage(n.LoggersMessageSubject.GetNomConfigAcuelle,{}).then(function(e){return e.nom})},i.prototype.isClassExists=function(e){return this.sendMessage(n.LoggersMessageSubject.IsClassExists,{nom:e}).then(function(e){return e.isExists})},i.prototype.reset=function(){return this.sendMessage(n.LoggersMessageSubject.Reset,{})},o=i,n.LoggerTechAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){!function(o){var i=(s.Instance=function(e,t,n,r){return null===s._techAgentExtended&&(s._techAgentExtended=new l(e,t,n,r)),s._techAgentExtended},s.prototype.init=function(e){var t=this,n=this.$q.defer();return s.Instance(this.$q,this.instanceLoaderService,this.$timeout,this.$rootScope).init(e).then(function(){n.resolve(s.Instance(t.$q,t.instanceLoaderService,t.$timeout,t.$rootScope))},function(){n.reject()}),n.promise},s.$inject=["$q","instanceLoaderService","$timeout","$rootScope"],s._techAgentExtended=null,s);function s(e,t,n,r){this.$q=e,this.instanceLoaderService=t,this.$timeout=n,this.$rootScope=r}o.TechAgentProvider=i;var a=(c.addInitListener=function(e){c.onInitListener.push(e)},c.removeInitListener=function(t){o.CoreCommon.ArrayUtils.remove(c.onInitListener,function(e){return e===t})},c.prototype.init=function(t,e){var n=this,r=o.CoreCommon.ServiceDePromesse.defer();return this._errorCallback=r.reject,this.LoggerTechAgent=t.Loggers,c.onInitListener.forEach(function(e){e(n,t)}),r.resolve(),r.promise},c.onInitListener=[],c);function c(){}o.TechLibrary=a;var r,e=(r=o.ServiceAgent,__extends(t,r),t.prototype.init=function(e){var t=this,n=o.CoreCommon.ServiceDePromesse.defer();return r.prototype.init.call(this,e).then(function(){return t._techLibrary.init(t.Library,e)}).then(function(){n.resolve()}).catch(n.reject),n.promise},Object.defineProperty(t.prototype,"LoggerTechAgent",{get:function(){return this._techLibrary.LoggerTechAgent},enumerable:!0,configurable:!0}),t.prototype.SendRequest=function(e){return r.prototype.SendRequest.call(this,e)},t);function t(){var e=r.call(this)||this;return e._techLibrary=new a,e}o.TechAgent=e;var u,l=(u=o.ServiceAgentExtended,__extends(n,u),n.prototype.init=function(e){var t=this,n=o.CoreCommon.ServiceDePromesse.defer();return u.prototype.init.call(this,e).then(function(){return t._techLibrary.init(t.Library,e)}).then(function(){n.resolve()}).catch(n.reject),n.promise},Object.defineProperty(n.prototype,"LoggerTechAgent",{get:function(){return this._techLibrary.LoggerTechAgent},enumerable:!0,configurable:!0}),n.prototype.SendRequest=function(e){return u.prototype.SendRequest.call(this,e)},n.$inject=["$q","instanceLoaderService","$timeout","$rootScope"],n);function n(e,t,n,r){var o=u.call(this,e,t,n,r)||this;return o._techLibrary=new a,o}o.TechAgentExtended=l,"undefined"!=typeof angular&&(o.moduleAgent.provider("techAgentExtended",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return i.Instance(e,t,n,r)}]}),o.moduleAgent.provider("techAgent",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return i.Instance(e,t,n,r)}]}),o.moduleAgent.provider("serviceAgent",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return i.Instance(e,t,n,r)}]}),o.moduleAgent.provider("serviceAgentExtended",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return i.Instance(e,t,n,r)}]}))}(e.Services||(e.Services={}))}(MyWay=MyWay||{}),function(h){var e,t;e=h.Test||(h.Test={}),function(p){function f(){return{Core:{createPromiseSelfResolved:h.Services.CoreCommon.createPromiseSelfResolved,createPromiseSelfError:h.Services.CoreCommon.createPromiseSelfError,promesseTryCatch:h.Services.CoreCommon.promesseTryCatch,getPromesseSelfResoved:h.Services.CoreCommon.getPromesseSelfResoved},Context:{}}}p.generateEmptyLibraryAgent=f;var g=(e.getInstance=function(){return null===e.INSTANCE&&(e.INSTANCE=new e).init(),e.INSTANCE},e.prototype.init=function(){var n=this;this.componentsByKey={},h.Services.Components.RegistryAgent.getInstance().components.forEach(function(e){var t=new e;n.componentsByKey[t.name.toString()]=e})},e.prototype.getClass=function(e){return this.componentsByKey[e.toString()]},e.INSTANCE=null,e);function e(){}p.declareAgentVersExterieurATester=function(l){var e=[];return{execute:function(){describe("Lorsque j'utilise l'agent "+l.classAgentName+" vers l'exterieur",function(){e.forEach(function(e){e()})})},test:function(u){var t="";t="Si j'appelle la méthode "+u.agentMethod+" de l'agent correctement j'ai bien le comportement attendu",u.testMethodSuffix&&(t+=" [cas : "+u.testMethodSuffix+"]"),e.push(function(){var e=it;!0===u.only&&(e=fit),e(t,function(e){var t=p.generateMessageService(),n=f(),r={},o=g.getInstance().getClass(l.component);if(o){expect(!0).toBe(!0,"La class agent du type "+l.component+" est enregistrée auprès du RegistryAgent");var i=new o,s=!1,a=void 0,c=void 0;return p.override(t,"sendWithResponse",function(e,t,n){return s=!0,a=t,c=n,e!==l.component?h.Services.Promesses.createPromiseSelfError(new h.Services.Erreur("L'agent n'envoie pas un message au bon composant. Il est de type "+l.component+" mais il envoie un message au composant "+e)):u.hasResponseMessage?h.Services.Promesses.createPromiseSelfResolved(u.responseMessage):h.Services.Promesses.getPromesseSelfResoved()}),h.Services.CoreCommon.getPromesseSelfResoved().then(function(){if(l.beforeEach){var e={agentLibrary:n,instance:i,isErrorMode:!1};return l.beforeEach(e)}}).then(function(){var e={agentLibrary:n,instance:i,isErrorMode:!1};return u.before?u.before(e):void 0}).then(function(){return i.init(n,t,r)}).then(function(){return u.agentHasMethodParams?i[u.agentMethod].apply(i,u.agentMethodParams):i[u.agentMethod].call(i)}).then(function(e){if(expect(s).toBe(!0,"Le sendMessage doit être appelé"),expect(a).toBe(u.typeMessage,"Le message "+l.enumTypeMessage[u.typeMessage]+" doit être envoyé, et pas "+l.enumTypeMessage[a]),u.hasRequestMessage)switch(u.requestMessageTestMode){case p.TestMode.NoCheck:expect(!0).toBe(!0,"Vérification du message que l'agent a envoyé au manager [test ignoré]");break;case p.TestMode.StrictEquals:expect(c).toBe(u.requestMessage,"Vérification du message que l'agent a envoyé au manager");break;case p.TestMode.DeepEquals:default:expect(c).toEqual(u.requestMessage,"Vérification du message que l'agent a envoyé au manager")}else expect(c).toBe(void 0,"Vérification du message que l'agent a envoyé au manager");if(u.agentHasResult)switch(u.agentResultTestMode){case p.TestMode.NoCheck:expect(!0).toBe(!0,"Vérification du résultat retourné par l'agent [test ignoré]");break;case p.TestMode.StrictEquals:expect(e).toBe(u.agentResult,"Vérification du résultat retourné par l'agent");break;case p.TestMode.ObjectPropertiesEquals:expect(e).toEqual(jasmine.objectContaining(u.agentResult),"Vérification du résultat retourné par l'agent");break;case p.TestMode.ArrayObjectPropertiesEquals:expect(e.length).toEqual(u.agentResult.length,"Vérification du résultat retourné par l'agent - Test du nombre de résutlats dans le tableau de réponse"),e.length===u.agentResult.length&&e.forEach(function(e,t){expect(e).toEqual(jasmine.objectContaining(u.agentResult[t]),"Vérification du résultat retourné par l'agent - Vérification de l'élément "+t)});break;case p.TestMode.DeepEquals:default:expect(e).toEqual(u.agentResult,"Vérification du résultat retourné par l'agent")}else expect(e).toBe(void 0,"Vérification du résultat retourné par l'agent")},function(e){fail("Une erreur s'est produite! Details : "+e.codeLibelle),console.error(e)}).then(function(){if(l.afterEach){var e={agentLibrary:n,instance:i,isErrorMode:!1};return l.afterEach(e)}}).then(function(){var e={agentLibrary:n,instance:i,isErrorMode:!1};return u.after?u.after(e):void 0}).finally(e)}fail("La class agent du type "+l.component+" n'est pas enregistrée auprès du RegistryAgent")})}),e.push(function(){t="Si j'appelle la méthode "+u.agentMethod+" de l'agent de manière incorrecte j'ai bien une erreur qui remonte",u.testMethodSuffix&&(t+=" [cas : "+u.testMethodSuffix+"]"),it(t,function(e){var t=p.generateMessageService(),r=f(),n={},o=g.getInstance().getClass(l.component);if(o){expect(!0).toBe(!0,"La class agent du type "+l.component+" est enregistrée auprès du RegistryAgent");var i=new o,s=!1,a=void 0,c=void 0;p.override(t,"sendWithResponse",function(e,t,n){return s=!0,a=t,c=n,e!==l.component?r.Core.createPromiseSelfError(new h.Services.Erreur("L'agent n'envoie pas un message au bon composant. Il est de type "+l.component+" mais il envoie un message au composant "+e)):h.Services.Promesses.createPromiseSelfError(new h.Services.Erreur("Erreur de test"))}),h.Services.CoreCommon.getPromesseSelfResoved().then(function(){if(l.beforeEach){var e={agentLibrary:r,instance:i,isErrorMode:!0};return l.beforeEach(e)}}).then(function(){var e={agentLibrary:r,instance:i,isErrorMode:!0};return u.before?u.before(e):void 0}).then(function(){return i.init(r,t,n)}).then(function(){return u.agentHasMethodParams?i[u.agentMethod].apply(i,u.agentMethodParams):i[u.agentMethod].call(i)}).then(function(e){fail("Une erreur aurait dû se produire!")},function(e){if(expect(s).toBe(!0,"Le sendMessage doit être appelé"),expect(a).toBe(u.typeMessage,"Le message "+l.enumTypeMessage[u.typeMessage]+" doit être envoyé"),u.hasRequestMessage)switch(u.requestMessageTestMode){case p.TestMode.NoCheck:expect(!0).toBe(!0,"Vérification du message que l'agent a envoyé au manager [test ignoré]");break;case p.TestMode.StrictEquals:expect(c).toBe(u.requestMessage,"Vérification du message que l'agent a envoyé au manager");break;case p.TestMode.DeepEquals:default:expect(c).toEqual(u.requestMessage,"Vérification du message que l'agent a envoyé au manager")}else expect(c).toBe(void 0,"Vérification du message que l'agent a envoyé au manager");expect(e.codeLibelle).toBe(u.agentResultErreur,"Vérification de l'erreur renvoyée par l'agent")}).then(function(){if(l.afterEach){var e={agentLibrary:r,instance:i,isErrorMode:!0};return l.afterEach(e)}}).then(function(){var e={agentLibrary:r,instance:i,isErrorMode:!0};return u.after?u.after(e):void 0}).finally(e)}else fail("La class agent du type "+l.component+" n'est pas enregistrée auprès du RegistryAgent")})})}}}}((t=e.V1||(e.V1={})).Services||(t.Services={}))}(MyWay=MyWay||{}),function(e){var s,t,n,r;function o(e){var t=n.call(this,e)||this;return t.listenersEvennement=[],t}s=e.Services||(e.Services={}),t=s.Components||(s.Components={}),n=t.ComponentBase,__extends(o,n),o.prototype.init=function(e,t,n,r){return this.library=e,this.messageService=t,this.managerInitializer=n,s.CoreCommon.getPromesseSelfResoved()},o.prototype.SendEvent=function(e){this.library&&this.library.Evennements&&(e.ComponentName=this.name,this.library.Evennements.notifier(e))},o.prototype.sendMessage=function(e,t){return this.messageService.sendWithResponse(this.name,e,t)},o.prototype.sendMessageWithFrame=function(e,t,n){var r=s.CoreCommon.ServiceDePromesse.defer();if(this.messageService){var o,i;if(n.SimulateAppIFrame)o=window,i=window.location.protocol+"//"+window.location.host;else{if(!n||!n.IsMyWayUrl||n.IsProducteur)return r.resolve(null),r.promise;o=n.GetWindow(),i=n.FrameUrl}i?this.messageService.sendWithResponse(this.name,e,t,o,i,n.FrameId).then(r.resolve,r.reject):r.resolve(null)}else r.resolve(null);return r.promise},o.prototype.dispose=function(){var t=this;return this.library.Core.promesseTryCatch(function(e){t.listenersEvennement.forEach(function(e){t.library.Evennements.retirerListener(e)}),e.resolve()})},o.prototype.ajouterListenerEvent=function(e,t){this.listenersEvennement.push(t),this.library.Evennements.ajouterListener(t,e)},r=o,t.ComponentManagerBase=r}(MyWay=MyWay||{}),function(e){var i;(function(e){var t;t=e.RegistryType||(e.RegistryType={});var n,r=(n=e.AbstractRegistry,__extends(o,n),o.getInstance=function(){return null===o.instance&&(o.instance=new o,e.FactoryRegistries.getInstance().addRegistry(o.instance)),o.instance},Object.defineProperty(o.prototype,"managerInitializer",{set:function(e){this._managerInitializer=e},enumerable:!0,configurable:!0}),o.prototype.init=function(e){var t=this;return this.getRegistryCommon().getComponentsInstances().forEach(function(e){t._componentsInstancesByKey[e.name]||(t._componentsInstances.push(e),t._componentsInstancesByKey[e.name]=e)}),this.messageService||(this.messageService=i.Message.MessageManagerFactory.createMessageManager(this.getLibrary())),n.prototype.init.call(this,e)},o.prototype.getRegistryCommon=function(){return this._dependenciesInstances[0]},o.prototype.getRegistryApi=function(){return this._dependenciesInstances[1]},o.prototype.initializeComponent=function(e){return e.init(this._componentsInstancesByKey,this.messageService,this._managerInitializer,this.getRegistryApi().getComponentInstance(e.name))},o.instance=null,o);function o(){var e=n.call(this,t.MANAGER,[t.COMMON,t.API])||this;return e._managerInitializer=null,e.messageService=null,e}e.RegistryManager=r})((i=e.Services||(e.Services={})).Components||(i.Components={}))}(MyWay=MyWay||{}),function(e){var o,i,t;function n(){var e=i.call(this,o.Components.ComponentType.Evennements)||this;return e.listenersParEvenement={},e.typesEvenements=null,e}o=e.Services||(e.Services={}),i=o.Components.ComponentManagerBase,__extends(n,i),n.prototype.init=function(e,t,n,r){return this.typesEvenements=o.CoreCommon.EnumUtils.getValues(o.Component.ManagerEventType),i.prototype.init.call(this,e,t,n,r)},n.prototype.SendEvent=function(e){return i.prototype.SendEvent.call(this,e)},n.prototype.ajouterListener=function(t){for(var n=this,e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];t&&(0===e.length&&(e=this.typesEvenements),e.forEach(function(e){n.listenersParEvenement[e]||(n.listenersParEvenement[e]=[]),n.listenersParEvenement[e].push(t)}))},n.prototype.retirerListener=function(t){for(var e in this.listenersParEvenement){var n=this.listenersParEvenement[e],r=[];n.forEach(function(e){e!==t&&r.push(e)}),this.listenersParEvenement[e]=r}},n.prototype.notifier=function(t){t&&t.EventType&&this.listenersParEvenement[t.EventType]&&this.listenersParEvenement[t.EventType].forEach(function(e){try{e(t)}catch(e){n.logger.error("Erreur lors de la remise d'un evennement : %1",JSON.pruned(t))}})},n.CLASS_NAME="MyWay.Services.Evennements",n.logger=o.Loggers.LoggerFactory.INSTANCE.getClass(n.CLASS_NAME),t=n,o.Evennements=t,o.Components.RegistryManager.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var t,n;function r(e){this.$q=e}t=e.Services||(e.Services={}),r.Instance=function(){return null===r._phantomAgent&&(r._phantomAgent=new t.PhantomAgent),r._phantomAgent},r.prototype.init=function(e){var t=this.$q.defer();return t.resolve(r.Instance()),t.promise},r.$inject=["$q"],r._phantomAgent=null,n=r,t.PhantomAgentProvider=n,"undefined"!=typeof angular&&(t.moduleManager=angular.module("moduleManager",["ng"]),t.moduleManager.provider("serviceAgent",function(){this.$get=["$q",function(e){return n.Instance()}]}))}(MyWay=MyWay||{}),function(e){var r,t;function o(){this._serviceManager=r.ServiceManager.Instance()}r=e.Services||(e.Services={}),Object.defineProperty(o.prototype,"Core",{get:function(){return this._serviceManager.Library.Core},enumerable:!0,configurable:!0}),o.addListenerOnInit=function(e){o.onInitListeners.push(e)},o.removeListenerOnInit=function(t){r.CoreCommon.ArrayUtils.remove(o.onInitListeners,function(e){return t===e})},o.prototype.SendRequest=function(n){return r.CoreCommon.promesseTryCatch(function(t){var e=n;e.logger=o.logger,r.CoreCommon.SendRequest(e,function(e){t.resolve(e)},function(e){t.reject(e)})})},o.prototype.init=function(e){var t=this;return r.Promesses.getPromesseSelfResoved().then(function(){o.onInitListeners.forEach(function(e){e(t,t._serviceManager)})})},o.prototype.DisplayMessage=function(e){},o.prototype.SubscribeToNotification=function(e){},o.prototype.Dispose=function(){},o.prototype.OnNotification=function(e,t){},o.CLASS_NAME="MyWay.Services.PhantomAgent",o.logger=r.Loggers.LoggerFactory.INSTANCE.getClass(o.CLASS_NAME),o.onInitListeners=[],t=o,r.PhantomAgent=t}(MyWay=MyWay||{}),function(e){!function(a){var e;(e=a.ModeVerificationProcessus||(a.ModeVerificationProcessus={}))[e.Aucun=0]="Aucun",e[e.Warning=1]="Warning",e[e.Erreur=2]="Erreur";var t=(c.Instance=function(){return c._instance},Object.defineProperty(c.prototype,"Library",{get:function(){return this.library},enumerable:!0,configurable:!0}),c.prototype.init=function(e){var t=this;c.logger.info("ServiceManager constructor init begin",Date.now(),!0),a.CoreCommon.VersionMySys=versionMySys;var n=a.Components.RegistryManager.getInstance();return n.managerInitializer={delegationPortail:e.delegationPortail,IFrameId:e.IFrameId,isTotemCapable:e.isTotemCapable,LogOnUrl:e.LogOnUrl,ModeVerificationProcessus:e.ModeVerificationProcessus,PortalType:e.PortalType},a.Components.RegistryApi.getInstance().setApiInitializer({privatePortalServiceParameters:a.PrivatePortalServiceParameters.Instance(),portalServiceParameters:a.PortalServiceParameters.Instance()}),a.Components.FactoryRegistries.getInstance().init().then(function(){t.library=n.getLibrary(),t.OnEvent=e.OnEvent,c.logger.info("ServiceManager StartManagers end",Date.now(),!1)})},Object.defineProperty(c.prototype,"OnEvent",{set:function(e){this.listenerEventFromPortail&&this.library.Evennements.retirerListener(this.listenerEventFromPortail),this.listenerEventFromPortail=e,this.library.Evennements.ajouterListener(e)},enumerable:!0,configurable:!0}),c.staticInit=function(){"undefined"!=typeof $&&$.ajaxSetup?$.ajaxSetup({cache:!1}):console.info("[Framework Technique MyWay - CoreCommon - init] JQuery n'est pas disponible"),window.onerror=function(e,t,n,r,o){if(-1<e.toString().toLowerCase().indexOf("script error"))c.logger.error("Script Error: See Browser Console for Detail");else{var i=["Message: "+e,"URL: "+t,"Line: "+n,"Column: "+r,"Error object: "+JSON.stringify(o)].join(" - ");c.logger.error(i)}return!1}},c.prototype.Dispose=function(){var t=this;return a.CoreCommon.promesseTryCatch(function(e){return t.listenerEventFromPortail&&t.library.Evennements.retirerListener(t.listenerEventFromPortail),a.Components.FactoryRegistries.getInstance().dispose().then(function(){})})},c.addActionOnInitialize=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];c.actionsOnInitialize.push({name:e,callback:t,actionsRequises:n||[]})},c.prototype.Initialize=function(){var e=this,o={},i={},s=[];return c.actionsOnInitialize.forEach(function(e){o[e.name]=a.CoreCommon.ServiceDePromesse.defer()}),c.actionsOnInitialize.forEach(function(n){c.logger.debug("Prépare l'action %1",n.name);var r=[];n.actionsRequises.forEach(function(e){c.logger.debug("Ajoute comme condition %1",e);var t=o[e];if(!t)throw new a.Erreur("L'action "+e+", requise pour l'action "+n.name+" n'a jamais été définie!");r.push(t.promise)});var t=o[n.name];i[n.name]=t.promise,a.CoreCommon.executePromisesSimultaneousAndWaitAllResolves(r).then(function(){c.logger.debug("Initialize - Lancement de l'action %1",n.name),n.callback(e.library).then(function(){t.resolve()},function(e){c.logger.debug("Action "+n.name+" en erreur ",e),t.reject(e)}).finally(function(){c.logger.debug("Initialize - Fin de l'action %1",n.name)})},t.reject),s.push(t.promise)}),a.CoreCommon.executePromisesSimultaneousAndWaitAllResolves(s).then(function(){},function(e){})},c.CLASS_NAME="MyWay.Services.ServiceManager",c.logger=a.Loggers.LoggerFactory.INSTANCE.getClass(c.CLASS_NAME),c.actionsOnInitialize=[],c);function c(){this.listenerEventFromPortail=null,c.logger.info("ServiceManager constructor begin"),c._instance=this}(a.ServiceManager=t).staticInit()}(e.Services||(e.Services={}))}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(e,t){this.EventType=e,this.Detail=t}t=e.Services||(e.Services={}),n=t.Component||(t.Component={}),i.prototype.onSend=function(e){return!0},o=i,n.ManagerEvent=o,(r=n.ManagerEventType||(n.ManagerEventType={}))[r.PortalContextChanged=1]="PortalContextChanged",r[r.FinDeTransition=2]="FinDeTransition",r[r.FinDeProcessus=3]="FinDeProcessus",r[r.NouvelleEtape=4]="NouvelleEtape",r[r.NouveauProcess=5]="NouveauProcess",r[r.NouveauSousProcess=6]="NouveauSousProcess",r[r.NouvelleAppliExterne=7]="NouvelleAppliExterne",r[r.BasculeProcess=8]="BasculeProcess",r[r.ChangementNomProcess=9]="ChangementNomProcess",r[r.DemandeDeDemarrageDeProcessus=10]="DemandeDeDemarrageDeProcessus",r[r.AcceptPhase=11]="AcceptPhase",r[r.ConnectionSignalR=12]="ConnectionSignalR",r[r.AfficherLogOn=13]="AfficherLogOn",r[r.MasquerLogOn=14]="MasquerLogOn",r[r.Extraction=15]="Extraction",r[r.Diagnostic=16]="Diagnostic",r[r.MiseAJourContexteClient=17]="MiseAJourContexteClient",r[r.Log=18]="Log",r[r.ChangementAuthentificationInfo=19]="ChangementAuthentificationInfo",r[r.BriqueCommunication=20]="BriqueCommunication",r[r.ContextRecharge=21]="ContextRecharge",r[r.ResetHabilitations=22]="ResetHabilitations",r[r.Communication=23]="Communication"}(MyWay=MyWay||{}),function(e){var t,i,s,n;function r(){return s.call(this,t.Components.ComponentType.Loggers)||this}t=e.Services||(e.Services={}),i=t.Loggers||(t.Loggers={}),s=t.Components.ComponentManagerBase,__extends(r,s),r.prototype.init=function(e,t,n,r){var o=this;return s.prototype.init.call(this,e,t,n,r).then(function(){o.loggerFactory=i.LoggerFactory.INSTANCE})},r.prototype.getClassByName=function(e){var t=window;return e.split(".").forEach(function(e){t=t[e]}),t},r.prototype.getConfigurationActual=function(){return this.loggerFactory.getConfigurationActual()},r.prototype.setConfigActual=function(e){this.loggerFactory.setConfigActual(e)},r.prototype.getConfigurationDB=function(e){var t=this.loggerFactory.getConfigurationDB(e);if(!t)switch(e){case i.LoggerFactory.LOGGER_PORTAIL:t=i.DEFAULT_CONFIGURATION_PORTAIL}return t},r.prototype.setConfigDB=function(e,t){return this.loggerFactory.setConfigDB(e,t)},r.prototype.saveConfiguration=function(e){return this.loggerFactory.saveConfiguration(e)},r.prototype.loadConfiguration=function(e){return this.loggerFactory.loadConfiguration(e)},r.prototype.getAllLogggersNames=function(){return this.loggerFactory.getAllLogggersNames()},r.prototype.getNomConfigActuelle=function(){return this.loggerFactory.getNomConfigActuelle()},r.prototype.clearConfigurations=function(){return this.loggerFactory.clearConfigurations()},n=r,i.LoggerManager=n,t.Components.RegistryManager.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.Loggers||(t.Loggers={})).DEFAULT_CONFIGURATION_PORTAIL={appenders:[{type:"CONSOLE",level:n.LEVEL.DEBUG,class:"MyWay.Services.Loggers.Appenders.ConsoleAppender",config:{format:"%d{HH:mm:ss,SSS} %class %X{action} : %msg, Details : %X{details}"}},{type:"DB",level:n.LEVEL.DEBUG,class:"MyWay.Services.Loggers.Appenders.DBAppender",config:{}},{type:"PORTAL",level:n.LEVEL.DEBUG,class:"MyWay.Services.Loggers.Appenders.PortalAppender",config:{format:"%d{HH:mm:ss,SSS} %class %X{action} : %msg, Details : %X{details}"}}],loggers:[{name:"MyWay.Services",level:n.LEVEL.INFO,appenders:["CONSOLE","PORTAL"]},{name:"MyWay.Services",level:n.LEVEL.INFO,appenders:["DB"]},{name:"*",level:n.LEVEL.INFO,appenders:["CONSOLE","DB"]}]},n.LoggerFactory.INSTANCE.loadConfiguration()}(MyWay=MyWay||{}),function(f){var g;(function(i){var r,e=(r=i.MessageBase,__extends(t,r),t);function t(e,t,n){return r.call(this,t,n,g.PrivatePortalServiceParameters.Instance().AuthorizedDomains,"Agent","Manager",e,!0,!1)||this}i.MessageManagerBase=e;var n,o=(__extends(s,n=e),s.prototype.dispose=function(){window.removeEventListener("message",this._ReceiveMessage)},s.prototype.postMessage=function(e,t,n,r){t.postMessage(e,n)},s);function s(e){var t=n.call(this,e,null,null)||this;return window.addEventListener("message",t._ReceiveMessage),t}i.MessageManager=o;var a,c=(__extends(u,a=e),u.prototype.dispose=function(){},u.prototype.postMessage=function(e,t,n,r){var o={};o.data=e,o.origin=n,o.source=t,i.MobileMessageAgent&&i.MobileMessageAgent.Instance&&i.MobileMessageAgent.Instance._ReceiveMessage(o)},u);function u(e){return a.call(this,e,null,null)||this}i.MobileMessageManager=c;var l=(p.createMessageManager=function(e){return f.Services.isMobile?new c(e):new o(e)},p);function p(){}i.MessageManagerFactory=l})((g=f.Services||(f.Services={})).Message||(g.Message={}))}(MyWay=MyWay||{}),function(e){var t,n;t=e.Test||(e.Test={}),((n=t.V1||(t.V1={})).Services||(n.Services={})).generateEmptyLibraryManagerForApi=function(){var t=0;return{Core:{createPromiseSelfResolved:e.Services.CoreCommon.createPromiseSelfResolved,createPromiseSelfError:e.Services.CoreCommon.createPromiseSelfError,promesseTryCatch:e.Services.CoreCommon.promesseTryCatch,getPromesseSelfResoved:e.Services.CoreCommon.getPromesseSelfResoved,creerChaineAleatoire:function(e){return"abcde"+ ++t}},Context:{},ContexteClient:{},Display:{},Lisa:{},Evennements:{},Libelle:{}}}}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Context="Context"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Context||(t.Context={}),(r=n.ContextMessageSubject||(n.ContextMessageSubject={}))[r.AddToContext=0]="AddToContext",r[r.AddToContextTech=1]="AddToContextTech",r[r.ClearContext=2]="ClearContext",r[r.AddToSharedContext=3]="AddToSharedContext",r[r.RemoveFromSharedContext=4]="RemoveFromSharedContext",r[r.AddToProcessStepContext=5]="AddToProcessStepContext",r[r.AddToGlobalContext=6]="AddToGlobalContext",r[r.AddToTempoContext=7]="AddToTempoContext",r[r.AddListToContext=8]="AddListToContext",r[r.AddToMainProcessContext=9]="AddToMainProcessContext",r[r.GetFromMainProcessContext=10]="GetFromMainProcessContext",r[r.ChangeMainProcessName=11]="ChangeMainProcessName",r[r.GetFromContext=12]="GetFromContext",r[r.GetObjectFromContext=13]="GetObjectFromContext",r[r.GetTypedObjectFromContext=14]="GetTypedObjectFromContext",r[r.ReinitialisationServiceAgent=15]="ReinitialisationServiceAgent",r[r.GetCurrentStepInfo=16]="GetCurrentStepInfo",r[r.GetSharedStorage=17]="GetSharedStorage",r[r.GetWaitingProcesses=18]="GetWaitingProcesses",r[r.GetPortals=19]="GetPortals",r[r.GetGlobalStorage=20]="GetGlobalStorage",r[r.SetMyWayCompatible=21]="SetMyWayCompatible",r[r.GetListFromContext=22]="GetListFromContext",r[r.GetAuthentificationInfo=23]="GetAuthentificationInfo",r[r.GetParametresComptables=24]="GetParametresComptables",r[r.PutProcessInPortalContext=25]="PutProcessInPortalContext",r[r.PutTaskInPortalContext=26]="PutTaskInPortalContext",r[r.GetCurrentProcessId=27]="GetCurrentProcessId",r[r.GetCurrentMainProcess=28]="GetCurrentMainProcess",r[r.GetCurrentStepId=29]="GetCurrentStepId",r[r.Notification=30]="Notification",r[r.AnalyseApp=31]="AnalyseApp",r[r.RemoveFromContext=32]="RemoveFromContext",r[r.RemoveFromSharedContextContext=33]="RemoveFromSharedContextContext",r[r.GetPortalContext=34]="GetPortalContext",r[r.SwitchProcess=35]="SwitchProcess",r[r.EndProcess=36]="EndProcess",r[r.EndAllProcess=37]="EndAllProcess",r[r.Inconnu=38]="Inconnu",r[r.GetFromSharedContext=39]="GetFromSharedContext",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Context,[t.Components.ComponentType.Persistence])}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Context||(t.Context={}),t.CoreCommon.addListenerOnAddMyWayHeaders(function(e,t){t.stepInfo?(e["X-identifiantProcessus"]=t.stepInfo.CurrentParentProcessId,e["X-nomComposant"]=t.stepInfo.NomComposant,e["X-niveauTrace"]=t.stepInfo.NiveauTrace.toString()):(e["X-identifiantProcessus"]="",e["X-nomComposant"]="",e["X-niveauTrace"]=""),t.authentificationInfo&&(e["X-codeEtablissement"]=t.authentificationInfo.codeEtablissement,e["X-identifiantPoste"]=t.authentificationInfo.numeroStationTravail,e["X-identifiantConnexionAgent"]=t.authentificationInfo.agentConnecte.referenceExterneAgent,e["X-identifiantNationalAgent"]=t.authentificationInfo.agentConnecte.adresseMessagerie,t.oldHeader&&(e.authentificationInfo=JSON.stringify(t.authentificationInfo)),t.authentificationInfo.agentConnecte.referenceExterneEdsRattachemen?e["X-agenceRattachement"]=t.authentificationInfo.agentConnecte.referenceExterneEdsRattachemen:e["X-agenceRattachement"]="0000000",t.authentificationInfo.agentConnecte.numeroInterneEds?e["X-posteFonctionnelAgent"]=t.authentificationInfo.agentConnecte.numeroInterneEds:e["X-posteFonctionnelAgent"]="0000000"),t.parametresComptables&&(e["X-identifiantGuichetOperation"]=t.parametresComptables.edsInterneGuichetComptable)})}(MyWay=MyWay||{}),function(e){var t;(function(e){var t,n,r;function o(){}function i(){}(t=e.StorageLevel||(e.StorageLevel={}))[t.Global=0]="Global",t[t.Process=1]="Process",t[t.Step=2]="Step",t[t.Shared=3]="Shared",t[t.Tempo=4]="Tempo",t[t.MainProcess=5]="MainProcess",(n=e.PATH_PART||(e.PATH_PART={}))[n.MAIN_PROCESS_ID=0]="MAIN_PROCESS_ID",n[n.LAST_PROCESS_ID=1]="LAST_PROCESS_ID",n[n.PREVIOUS_PROCESS_ID=2]="PREVIOUS_PROCESS_ID",n[n.STEP_ID=3]="STEP_ID",(r=e.EtatEtape||(e.EtatEtape={}))[r.NONE=0]="NONE",r[r.STARTED=1]="STARTED",r[r.RESET=2]="RESET",e.IStepAction=o,e.IStepContrat=i;var s=(a.prototype.ToString=function(){return JSON.stringify(this)},a);function a(){this.TotalWatchers=0,this.TotalWatchers2=0,this.TotalWatchers3=0,this.WatcherByScope=[]}function c(e,t){this.Name=e,this.WatcherCount=t}e.AnalyseResult=s,e.AnalyseScope=c})((t=e.Services||(e.Services={})).Context||(t.Context={}))}(MyWay=MyWay||{}),function(e){var t;(function(e){function t(){this.Contrats=[],this.AuthorizedOutputs=[]}e.StepInfo=t;var n,r=(__extends(o,n=t),o);function o(){return n.call(this)||this}function i(){}function s(){}function a(){this.agentConnecte=new p,this.guichetAgent=new f}function c(){}function u(){}function l(){}e.StepInfoExtended=r,e.ContratInfo=i,e.DonneesLocales=s,e.AuthentificationInfo=a,e.ParametresComptables=c,e.ParametresNumerisation=u,e.ParametresServeurPoste=l;var p=function(){};e.AgentConnecte=p;var f=function(){};function g(){}e.GuichetAgent=f,e.InfosUserPoste=g})((t=e.Services||(e.Services={})).Context||(t.Context={}))}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Display="Display"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Display||(t.Display={}),(r=n.DisplayMessageSubject||(n.DisplayMessageSubject={}))[r.Redirect=0]="Redirect",r[r.RedirectInStep=1]="RedirectInStep",r[r.PrepareSubmit=2]="PrepareSubmit",r[r.DisplayMessage=3]="DisplayMessage",r[r.GetMyIFrameId=4]="GetMyIFrameId",r[r.Refresh=5]="Refresh",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Display,[t.Components.ComponentType.Context,t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){}t=e.Services||(e.Services={}),n=t.ContexteClient||(t.ContexteClient={}),o.RELOAD_FLAG_NAME="indicateurSynchroSynthese",o.RELOAD_FLAG_VALUE_NONE="0",o.RELOAD_FLAG_VALUE_SYNCHRO="1",o.RELOAD_FLAG_VALUE_RELOAD="2",r=o,n.ContexteClientStatusFlag=r}(MyWay=MyWay||{}),function(e){var t;function n(){}((t=e.Services||(e.Services={})).Application||(t.Application={})).ApplicationDTO=n}(MyWay=MyWay||{}),function(e){var t,n,r;function o(e,t,n,r){this.callbackToDisposeListener=null,this.callbackToSave=null,this.callbackOnEvent=null,this.keyStorage=e,this.callbackToDisposeListener=t,this.callbackToSave=n,this.callbackOnEvent=r}t=e.Services||(e.Services={}),n=t.Persistence||(t.Persistence={}),o.prototype.saveValue=function(e){this.callbackToSave(e)},o.prototype.getValue=function(){var e=window.localStorage.getItem(this.keyStorage);if(!e||0===e.length)return null;var t=JSON.parse(e);return t&&t.data?t.data:null},o.prototype.onEvent=function(e){this.callbackOnEvent(e)},o.prototype.disposeListener=function(){this.callbackToDisposeListener()},r=o,n.StorageInstance=r}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.BaseDeDonnees)||this}t=e.Services||(e.Services={}),n=t.BaseDeDonnees||(t.BaseDeDonnees={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.getBases=function(){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.GetBases,{})},i.prototype.get=function(e){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.Get,{base:e.base,cle:e.cle,table:e.table})},i.prototype.getAll=function(e){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.GetAll,{base:e.base,table:e.table})},i.prototype.find=function(e){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.Find,{table:e.table})},i.prototype.count=function(e){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.Count,{base:e.base,table:e.table})},i.prototype.ajouter=function(e){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.Ajouter,{base:e.base,elements:[e.element],table:e.table})},i.prototype.supprimer=function(e){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.Supprimer,{base:e.base,cles:[e.cle],table:e.table})},i.prototype.modifier=function(e){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.MettreAJour,{base:e.base,elements:[{cle:e.cle,element:e.element}],table:e.table})},i.prototype.resetAll=function(){return this.sendMessage(n.Messages.BaseDeDonneesMessageSubject.ResetAll,{})},o=i,n.BaseDeDonneesAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,o,n,r;function i(){return n.call(this,t.Components.ComponentType.Export)||this}t=e.Services||(e.Services={}),o=t.Export||(t.Export={}),n=t.Components.ComponentAgentBase,__extends(i,n),i.prototype.exporterFichier=function(e,t,n){var r={donnees:e,format:t,options:n};return this.sendMessage(o.ExportMessageSubject.ExporterFichier,r)},i.CLASS_NAME="MyWay.Services.Export.ExportAgent",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),r=i,o.ExportAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.JAB)||this}t=e.Services||(e.Services={}),n=t.JAB||(t.JAB={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.Enregistrer=function(e){return this.sendMessage(n.JABMessageSubject.Enregistrer,{data:e})},o=i,n.JABAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,i,n,r;function o(){return n.call(this,t.Components.ComponentType.Fichier)||this}t=e.Services||(e.Services={}),i=t.Fichier||(t.Fichier={}),n=t.Components.ComponentAgentBase,__extends(o,n),o.prototype.saveAs=function(e,t,n,r){var o={data:e,type:t,nomFichier:n,typeDonnees:r};return this.sendMessage(i.FichierMessageSubject.SaveAs,o)},r=o,i.FichierAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.TraitementNsdk)||this}t=e.Services||(e.Services={}),n=t.TraitementNsdk||(t.TraitementNsdk={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.Lancer=function(e,t){return this.sendMessage(n.TraitementNsdkMessageSubject.Lancer,{traitement:e,data:t})},o=i,n.TraitementNsdkAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r;function o(e){this._name=e}t=e.Services||(e.Services={}),n=t.Components||(t.Components={}),o.prototype.init=function(e,t){return this.library=t,this.manager=e,this.library.Core.getPromesseSelfResoved()},o.prototype.dispose=function(){return this.library.Core.getPromesseSelfResoved()},Object.defineProperty(o.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),r=o,n.ComponentManagerExtendedBase=r}(MyWay=MyWay||{}),function(e){var t;(function(e){var t;(t=e.RegistryType||(e.RegistryType={})).MANAGER_EXTENDED="MANAGER_EXTENDED";var n,r=(n=e.AbstractRegistry,__extends(o,n),o.getInstance=function(){return null===o.instance&&(o.instance=new o,e.FactoryRegistries.getInstance().addRegistry(o.instance)),o.instance},o.prototype.init=function(e){var t=this;return this.getRegistryCommon().getComponentsInstances().forEach(function(e){t._componentsInstancesByKey[e.name]||(t._componentsInstances.push(e),t._componentsInstancesByKey[e.name]=e)}),n.prototype.init.call(this,e)},o.prototype.initializeComponent=function(e){return e.init(this.getRegistryManager().getComponentInstance(e.name),this.getRegistryCommon().getLibrary())},o.prototype.getRegistryCommon=function(){return this._dependenciesInstances[1]},o.prototype.getRegistryManager=function(){return this._dependenciesInstances[0]},o.instance=null,o);function o(){return n.call(this,t.MANAGER_EXTENDED,[t.MANAGER,t.COMMON])||this}e.RegistryManagerExtended=r})((t=e.Services||(e.Services={})).Components||(t.Components={}))}(MyWay=MyWay||{}),function(e){var n,t;function r(){this.library=null,this.libraryExtended=null,this._serviceManager=new n.ServiceManager}n=e.Services||(e.Services={}),r.setListenerOnInitContext=function(e){r.listenerOnInitContext=e},r.prototype.init=function(e){var t=this;return n.PrivatePortalServiceParameters.Instance().init(),this._serviceManager.init(e).then(function(){for(var e in t.libraryExtended=n.Components.RegistryManagerExtended.getInstance().getLibrary(),t.library=n.Components.RegistryManager.getInstance().getLibrary(),t.libraryExtended)t[e]=t.libraryExtended[e];return r.listenerOnInitContext?r.listenerOnInitContext(t.libraryExtended):n.CoreCommon.createPromiseSelfResolved(null)})},r.prototype.Initialize=function(){return this._serviceManager.Initialize()},Object.defineProperty(r.prototype,"OnEvent",{set:function(e){this._serviceManager.OnEvent=e},enumerable:!0,configurable:!0}),r.prototype.Dispose=function(){return this._serviceManager.Dispose()},r.prototype.VersionMySys=function(){return n.CoreCommon.VersionMySys},r.CLASS_NAME="MyWay.Services.ServiceManagerExtended",r.logger=n.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),r.listenerOnInitContext=null,t=r,n.ServiceManagerExtended=t}(MyWay=MyWay||{}),function(e){var t,n;function r(e){this.$q=e}t=e.Services||(e.Services={}),r.Instance=function(){return null===r._serviceManager&&(r._serviceManager=new t.ServiceManagerExtended),r._serviceManager},r.prototype.init=function(e){var t=this.$q.defer();return r.Instance().init(e).then(function(){r.logger.info("Fin d'initialisation du serviceManager"),t.resolve(r.Instance())},function(){t.reject()}),t.promise},r.CLASS_NAME="MyWay.Services.ServiceManagerProvider",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),r.$inject=["$q"],r._serviceManager=null,n=r,t.ServiceManagerProvider=n,"undefined"!=typeof angular&&(t.moduleManager=angular.module("moduleManager",["ng"]),t.moduleManager.provider("serviceManager",function(){this.$get=["$q",function(e){return n.Instance()}]}))}(MyWay=MyWay||{}),function(e){var r,t,n,o;function i(e){return n.call(this,e)||this}r=e.Services||(e.Services={}),t=r.Components||(r.Components={}),n=t.ComponentBase,__extends(i,n),i.prototype.init=function(e,t){return this.managerInstance=e,this.library=t,r.CoreCommon.getPromesseSelfResoved()},i.prototype.reception=function(t){var n=this;return r.CoreCommon.promesseTryCatch(function(e){e.reject(new r.Erreur("Subject "+t.subject+" not implemented on "+n.name+" manager-message"))})},i.prototype.dispose=function(){return r.CoreCommon.getPromesseSelfResoved()},o=i,t.ComponentManagerMessageBase=o}(MyWay=MyWay||{}),function(e){var i;(function(e){var t;(t=e.RegistryType||(e.RegistryType={})).MANAGER_MESSAGE="MANAGER_MESSAGE";var n,r=(n=e.AbstractRegistry,__extends(o,n),o.getInstance=function(){return null===o.instance&&(o.instance=new o,e.FactoryRegistries.getInstance().addRegistry(o.instance)),o.instance},o.prototype.init=function(e){var t=this;return this.getRegistryCommon().getComponentsInstances().forEach(function(e){t._componentsInstancesByKey[e.name]||(t._componentsInstances.push(e),t._componentsInstancesByKey[e.name]=e)}),this.messageService||(this.messageService=i.Message.MessageManagerMessageFactory.createMessageManager(this.getLibrary())),n.prototype.init.call(this,e)},o.prototype.getRegistryCommon=function(){return this._dependenciesInstances[0]},o.prototype.getRegistryManager=function(){return this._dependenciesInstances[1]},o.prototype.initializeComponent=function(e){var t=this.getRegistryManager().getComponentInstance(e.name);return e.init(t,this.getRegistryCommon().getLibrary())},o.instance=null,o);function o(){var e=n.call(this,t.MANAGER_MESSAGE,[t.COMMON,t.MANAGER])||this;return e.messageService=null,e}e.RegistryManagerMessage=r})((i=e.Services||(e.Services={})).Components||(i.Components={}))}(MyWay=MyWay||{}),function(f){var g;(function(e){var r,t=(r=e.MessageBase,__extends(n,r),n);function n(e,t,n){return r.call(this,t,n,g.PrivatePortalServiceParameters.Instance().AuthorizedDomains,"Agent","Manager",e,!1,!0)||this}e.MessageManagerMessageBase=t;var o,i=(__extends(s,o=t),s.prototype.dispose=function(){window.removeEventListener("message",this._ReceiveMessage)},s.prototype.postMessage=function(e,t,n,r){t.postMessage(e,n)},s);function s(e){var t=o.call(this,e,null,null)||this;return window.addEventListener("message",t._ReceiveMessage),t}e.MessageManagerMessage=i;var a,c=(__extends(u,a=t),u.prototype.postMessage=function(e,t,n,r){var o={};o.data=e,o.origin=n,o.source=t,g.MobileMessageAgent&&g.MobileMessageAgent.Instance&&g.MobileMessageAgent.Instance._ReceiveMessage(o)},u.prototype.dispose=function(){},u);function u(e){return a.call(this,e,null,null)||this}e.MobileMessageManagerMessage=c;var l=(p.createMessageManager=function(e){return f.Services.isMobile?new c(e):new i(e)},p);function p(){}e.MessageManagerMessageFactory=l})((g=f.Services||(f.Services={})).Message||(g.Message={}))}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){return i.call(this,t.Components.ComponentType.Loggers)||this}t=e.Services||(e.Services={}),o=t.Loggers||(t.Loggers={}),i=t.Components.ComponentManagerMessageBase,__extends(r,i),r.prototype.reception=function(e){switch(e.subject){case o.LoggersMessageSubject.GetConfigActual:var t=e.message,n=this.managerInstance.getConfigurationActual();return this.library.Core.createPromiseSelfResolved({config:n});case o.LoggersMessageSubject.SetConfigActual:t=e.message,this.managerInstance.setConfigActual(t.config),this.library.Core.getPromesseSelfResoved();case o.LoggersMessageSubject.GetConfigDB:return t=e.message,n=this.managerInstance.getConfigurationDB(t.nom),this.library.Core.createPromiseSelfResolved({config:n});case o.LoggersMessageSubject.SetConfigDB:t=e.message,this.managerInstance.setConfigDB(t.nom,t.config),this.library.Core.getPromesseSelfResoved();case o.LoggersMessageSubject.SaveConfig:t=e.message,this.managerInstance.saveConfiguration(t.nom),this.library.Core.getPromesseSelfResoved();case o.LoggersMessageSubject.LoadConfig:t=e.message,this.managerInstance.loadConfiguration(t.nom),this.library.Core.getPromesseSelfResoved();case o.LoggersMessageSubject.GetLoggers:return t=e.message,this.library.Core.createPromiseSelfResolved({loggers:this.managerInstance.getAllLogggersNames()});case o.LoggersMessageSubject.GetNomConfigAcuelle:t=e.message;var r=this.managerInstance.getNomConfigActuelle();return this.library.Core.createPromiseSelfResolved({nom:r});case o.LoggersMessageSubject.IsClassExists:t=e.message;try{return this.managerInstance.getClassByName(t.nom),this.library.Core.createPromiseSelfResolved({isExists:!0})}catch(e){return this.library.Core.createPromiseSelfResolved({isExists:!1})}case o.LoggersMessageSubject.Reset:t=e.message,this.managerInstance.clearConfigurations(),this.library.Core.getPromesseSelfResoved();default:return i.prototype.reception.call(this,e)}},n=r,o.LoggerManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(a){var e;(function(e){var t=(s.prototype.Set=function(e){if(this.Get()!==e){var t={};t.rev=a.Services.CoreCommon.creerChaineAleatoire(5),t.value=e;var n=JSON.stringify(t);this.onInternalStorageChanged&&this.onInternalStorageChanged(t.rev),localStorage[this.Key]=n,s.EvaluateStorageSize(this.onStorageLimit)}},s.prototype.Get=function(){var e=localStorage[this.Key];if(e)return JSON.parse(e).value},s.EvaluateStorageSize=function(e){var t,n=0,r=0;for(t in localStorage)n+=2*localStorage[t].length,"IDB/"===t.substring(0,4)&&(r+=parseInt(localStorage[t]));if(e){var o=0,i=0;1024*s.LocalStorageLimitInKb<n&&(o=n/1024),1024*s.IndexedDBStorageLimitInKb<r&&(i=r/1024),e(o,i)}},s);function s(e){this.Key=e,s.LocalStorageLimitInKb=4096,s.IndexedDBStorageLimitInKb=40960}e.BaseStorage=t;var n=(Object.defineProperty(r,"Key",{get:function(){return r._baseStorage.Key},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onInternalStorageChanged",{set:function(e){r._baseStorage.onInternalStorageChanged=e},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onStorageLimit",{set:function(e){r._baseStorage.onStorageLimit=e},enumerable:!0,configurable:!0}),r.Set=function(e){r._baseStorage.Set(e)},r.Get=function(){return r._baseStorage.Get()},r._baseStorage=new t("context"),r);function r(){}e.ContextStorage=n;var o=(Object.defineProperty(i,"Key",{get:function(){return i._baseStorage.Key},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onInternalStorageChanged",{set:function(e){i._baseStorage.onInternalStorageChanged=e},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onStorageLimit",{set:function(e){i._baseStorage.onStorageLimit=e},enumerable:!0,configurable:!0}),i.Set=function(e){i._baseStorage.Set(e)},i.Get=function(){return i._baseStorage.Get()},i._baseStorage=new t("interop-message-bus"),i);function i(){}e.InteropMessageBusStorage=o})((e=a.Services||(a.Services={})).Storage||(e.Storage={}))}(MyWay=MyWay||{}),function(o){var e,t;e=o.Test||(o.Test={}),((t=e.V1||(e.V1={})).Services||(t.Services={})).generateEmptyLibraryManager=function(){var t=0,n=null,r={};return{BaseDeDonnees:{},Core:{createPromiseSelfResolved:o.Services.CoreCommon.createPromiseSelfResolved,createPromiseSelfError:o.Services.CoreCommon.createPromiseSelfError,promesseTryCatch:o.Services.CoreCommon.promesseTryCatch,getPromesseSelfResoved:o.Services.CoreCommon.getPromesseSelfResoved,creerChaineAleatoire:function(e){return"abcde"+ ++t}},Context:{},Dates:{},Display:{},Libelle:{},Persistence:{addStorage:function(e,t){return{getValue:function(){return n},saveValue:function(e){n=e}}}},Evennements:{notifier:function(t){t&&t.EventType&&r[t.EventType]&&r[t.EventType].forEach(function(e){try{e(t)}catch(e){}})},ajouterListener:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];e.forEach(function(e){r[e]||(r[e]=[]),r[e].push(t)})},retirerListener:function(t){for(var e in r)o.Services.CoreCommon.ArrayUtils.remove(r[e],function(e){return e===t})}}}}}(MyWay=MyWay||{}),function(e){var t,n,o,r;function i(){return o.call(this,t.Components.ComponentType.JAB)||this}t=e.Services||(e.Services={}),n=t.JAB||(t.JAB={}),o=t.Components.ComponentApiBase,__extends(i,o),i.prototype.init=function(e,t,n){var r=this;return o.prototype.init.call(this,e,t,n).then(function(){r._jabUrl=r.privatePortalServiceParameters.LocalServiceUrl+"/contexte/EnregistrerJournalBancaireNSDK"})},i.prototype.enregistrer=function(e){return this.libraryManager.Core.sendRequest({url:this._jabUrl+"?data="+e,method:t.MethodEnum.POST})},r=i,n.JABApi=r,t.Components.RegistryApi.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){this.currentFileName="telechargement",this.currentMimeType="application/octet-stream",this._responseData={},this._strFileName="",this._strMimeType="",this.toString=function(e){return String(e)}}t=e.Services||(e.Services={}),n=t.Fichier||(t.Fichier={}),Object.defineProperty(o.prototype,"responseData",{get:function(){return this._responseData},set:function(e){this._responseData=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"strFileName",{get:function(){return this._strFileName},set:function(e){this._strFileName=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"strMimeType",{get:function(){return this._strMimeType},set:function(e){this._strMimeType=e},enumerable:!0,configurable:!0}),o.prototype.initSaveFile=function(){var t=this;if(this.self=window,this.currentBlob=this.self.Blob||this.self.MozBlob||this.self.WebKitBlob||this.toString,this.currentBlob=this.currentBlob.call?this.currentBlob.bind(this.self):Blob,this.anchor=document.createElement("a"),0<this.strMimeType.length&&(this.currentMimeType=this.strMimeType),0<this.strFileName.length&&(this.currentFileName=this.strFileName),this.isSafari()&&this.checkSafariVersion())this.saveSafariFile();else{if(/^this.responseData\:[\w+\-]+\/[\w+\-]+[,;]/.test(this.responseData)){if(!(2096103.424<this.responseData.length&&this.currentBlob!==this.toString))return void(navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(this.dataUrlToBlob(this.responseData),this.currentFileName):(this.url=this.responseData,this.saver()));this.responseData=this.dataUrlToBlob(this.responseData)}if(this.responseData instanceof this.currentBlob?this.blob=this.responseData:this.blob=new this.currentBlob([this.responseData],{type:this.currentMimeType}),navigator.msSaveOrOpenBlob)return void navigator.msSaveOrOpenBlob(this.blob,this.currentFileName);if(!this.self.URL){if("string"==typeof this.blob||this.blob.constructor===this.toString)try{this.url="data:"+this.currentMimeType+";base64,"+this.self.btoa(this.blob)}catch(e){this.url="data:"+this.currentMimeType+","+encodeURIComponent(this.blob)}else this.reader=new FileReader,this.reader.onload=function(e){t.url=e.result},this.reader.readAsDataURL(this.blob),this.saver();return}this.url=this.self.URL.createObjectURL(this.blob),this.saver(!0)}},o.prototype.dataUrlToBlob=function(e){for(var t=e.split(/[:;,]/),n=t[1],r=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),o=r.length,i=0,s=new Uint8Array(o);i<o;++i)s[i]=r.charCodeAt(i);return new this.currentBlob([s],{type:n})},o.prototype.saver=function(e){if("download"in this.anchor)this.downloadFile(e);else{var t=document.createElement("iframe");document.body.appendChild(t),e||(this.url="data:"+this.url.replace(/^this.responseData:([\w\/\-\+]+)/,this.currentMimeType)),t.src=this.url,setTimeout(function(){document.body.removeChild(t)},333)}},o.prototype.saveSafariFile=function(){for(var e=new Uint8Array(this.responseData),t=e.length,n=new Array(t);t--;)n[t]=String.fromCharCode(e[t]);this.url="data:"+this.currentMimeType+";base64,"+window.btoa(n.join("")),window.open(this.url)||(window.location.href=this.url)},o.prototype.downloadFile=function(e){var t=this;this.anchor.href=this.url,this.anchor.setAttribute("download",this.currentFileName),this.anchor.className="download-js-link",this.anchor.innerHTML="téléchargement en cours...",this.anchor.style.display="none",document.body.appendChild(this.anchor),setTimeout(function(){t.anchor.click(),document.body.removeChild(t.anchor),e&&setTimeout(function(){t.self.URL.revokeObjectURL(t.anchor.href)},250)},66)},o.prototype.isSafari=function(){return!!/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.Safari\//.test(navigator.userAgent)},o.prototype.checkSafariVersion=function(){var e=navigator.userAgent.match(/version\/(\d+).(\d+)/i);return Number(e[1]+e[2])<=61},r=o,n.FileSaver=r}(MyWay=MyWay||{}),function(e){var o,i,r,t;function n(){return r.call(this,o.Components.ComponentType.Fichier)||this}o=e.Services||(e.Services={}),i=o.Fichier||(o.Fichier={}),r=o.Components.ComponentApiBase,__extends(n,r),n.prototype.init=function(e,t,n){return this._isIE=o.CoreCommon.checkIsIE(),r.prototype.init.call(this,e,t,n)},n.prototype.saveAs=function(e,t,n){var r=new i.FileSaver;return r.responseData=e,r.strMimeType=t,r.strFileName=n,r.initSaveFile(),o.Promesses.createPromiseSelfResolved()},n.prototype.save=function(e,t,n){return this.saveAs(e,t,n),o.Promesses.createPromiseSelfResolved()},t=n,i.FichierApi=t,o.Components.RegistryApi.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var n,t,r,o;function i(){return r.call(this,n.Components.ComponentType.TraitementNsdk)||this}n=e.Services||(e.Services={}),t=n.TraitementNsdk||(n.TraitementNsdk={}),r=n.Components.ComponentApiBase,__extends(i,r),i.prototype.lancer=function(e,t){return this.libraryManager.Core.sendRequest({url:n.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/contexte/LancerTraitementNSDK?data="+t+"&traitement="+e,cache:!1,async:!1,method:n.MethodEnum.GET})},o=i,t.TraitementNsdkApi=o,n.Components.RegistryApi.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).BriqueCommunication="BriqueCommunication"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.BriqueCommunication||(t.BriqueCommunication={})).BriqueCommunicationMessageSubject||(n.BriqueCommunicationMessageSubject={})}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),r=n.Messages||(n.Messages={}),(o=r.EVENT_TYPE||(r.EVENT_TYPE={}))[o.CHAT=1]="CHAT",o[o.NOTIFICATION=2]="NOTIFICATION"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Chat="Chat"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),r=n.Chat||(n.Chat={}),(o=r.ChatMessageSubject||(r.ChatMessageSubject={}))[o.OpenChatroom=0]="OpenChatroom",o[o.OpenChat=1]="OpenChat",o[o.SendMessage=2]="SendMessage",o[o.CloseChat=3]="CloseChat",o[o.GetUtilisateurs=4]="GetUtilisateurs",o[o.EnvoyerMessageVideoroom=5]="EnvoyerMessageVideoroom",o[o.ReceptionMessageVideoroom=6]="ReceptionMessageVideoroom",o[o.GetChatrooms=7]="GetChatrooms",o[o.GetChatroom=8]="GetChatroom",o[o.PrendreLaMainVideoroom=9]="PrendreLaMainVideoroom",o[o.DemarrerVideoChatroom=10]="DemarrerVideoChatroom",o[o.ArreterVideoChatroom=11]="ArreterVideoChatroom",o[o.AccepterDemanderExpert=12]="AccepterDemanderExpert",o[o.InviterPersonnesAUneChatroom=13]="InviterPersonnesAUneChatroom",o[o.SetStatut=14]="SetStatut",o[o.AddChatCapacity=15]="AddChatCapacity",o[o.WebRTC=16]="WebRTC",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.BriqueCommunication,[t.Components.ComponentType.Context]),t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Chat,[t.Components.ComponentType.BriqueCommunication,t.Components.ComponentType.Context,t.Components.ComponentType.Core,t.Components.ComponentType.Display,t.Components.ComponentType.Evennements,t.Components.ComponentType.Persistence])}(MyWay=MyWay||{}),function(e){var t,n,r,o,i,s,a,c;t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),r=n.Chat||(n.Chat={}),o=r.Messages||(r.Messages={}),(i=o.TYPE||(o.TYPE={}))[i.OPEN_CHATROOM=1]="OPEN_CHATROOM",i[i.OPEN_CHAT=2]="OPEN_CHAT",i[i.SEND_MESSAGE=3]="SEND_MESSAGE",i[i.CLOSE_CHAT=4]="CLOSE_CHAT",i[i.GET_UTILISATEURS=5]="GET_UTILISATEURS",i[i.ENVOYER_MESSAGE_VIDEOROOM=6]="ENVOYER_MESSAGE_VIDEOROOM",i[i.RECEPTION_MESSAGE_VIDEOROOM=7]="RECEPTION_MESSAGE_VIDEOROOM",i[i.GET_CHATROOMS=8]="GET_CHATROOMS",i[i.GET_CHATROOM=16]="GET_CHATROOM",i[i.PRENDRE_LA_MAIN_VIDEOROOM=9]="PRENDRE_LA_MAIN_VIDEOROOM",i[i.DEMARRER_VIDEO_CHATROOM=10]="DEMARRER_VIDEO_CHATROOM",i[i.ARRETER_VIDEO_CHATROOM=11]="ARRETER_VIDEO_CHATROOM",i[i.ACCEPTER_DEMANDE_EXPERT=12]="ACCEPTER_DEMANDE_EXPERT",i[i.INVITER_PERSONNES_A_UNE_CHATROOM=13]="INVITER_PERSONNES_A_UNE_CHATROOM",i[i.SET_STATUT=14]="SET_STATUT",i[i.ADD_CHAT_CAPACITY=15]="ADD_CHAT_CAPACITY",(s=o.EVENT_TYPE||(o.EVENT_TYPE={}))[s.MESSAGE_RECU=1]="MESSAGE_RECU",s[s.CHAT_FERME=2]="CHAT_FERME",s[s.CHAT_OUVERT=3]="CHAT_OUVERT",s[s.MISE_A_JOUR_LISTE_UTILISATEURS=4]="MISE_A_JOUR_LISTE_UTILISATEURS",s[s.UTILISATEUR_CONNECTE_A_CHAT=5]="UTILISATEUR_CONNECTE_A_CHAT",s[s.UTILISATEUR_DECONNECTE_A_CHAT=6]="UTILISATEUR_DECONNECTE_A_CHAT",s[s.CHANGEMENT_MAIN_CHATROOM=7]="CHANGEMENT_MAIN_CHATROOM",s[s.DEMANDE_EXPERT=8]="DEMANDE_EXPERT",s[s.FIN_DEMANDE_EXPERT=9]="FIN_DEMANDE_EXPERT",s[s.CHAT_DIV_ELEMENT=10]="CHAT_DIV_ELEMENT",s[s.FIN_VIDEOROOM=11]="FIN_VIDEOROOM",(a=o.UTILISATEUR_TYPE||(o.UTILISATEUR_TYPE={}))[a.CONSEILLER=0]="CONSEILLER",a[a.EXPERT=1]="EXPERT",a[a.CLIENT=2]="CLIENT",a[a.PROSPECT=3]="PROSPECT",(c=o.UTILISATEUR_STATUT||(o.UTILISATEUR_STATUT={}))[c.CONNECTE=1]="CONNECTE",c[c.DECONNECTE=2]="DECONNECTE"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),function(e){var t,n;function r(){}function o(){}function i(){}(t=e.TYPE||(e.TYPE={}))[t.ABONNEMENT=1]="ABONNEMENT",t[t.DESABONNEMENT=2]="DESABONNEMENT",t[t.GET_LISTE_SUJETS=3]="GET_LISTE_SUJETS",e.INotificationMessageAbonnementRequest=r,e.INotificationMessageDesabonnementRequest=o,e.INotificationMessageListeSujetsResponse=i,(n=e.EVENT_TYPE||(e.EVENT_TYPE={}))[n.NOUVEL_ABONNEMENT=1]="NOUVEL_ABONNEMENT",n[n.DESABONNEMENT=2]="DESABONNEMENT",n[n.NOTIFICATION_MESSAGE=3]="NOTIFICATION_MESSAGE"}((r=n.Notification||(n.Notification={})).Messages||(r.Messages={}))}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Notification="Notification"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),r=n.Notification||(n.Notification={}),(o=r.NotificationMessageSubject||(r.NotificationMessageSubject={}))[o.Abonnement=0]="Abonnement",o[o.Desabonnement=1]="Desabonnement",o[o.GetListeSubjects=2]="GetListeSubjects",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Notification,[t.Components.ComponentType.BriqueCommunication,t.Components.ComponentType.Context,t.Components.ComponentType.Core,t.Components.ComponentType.Evennements,t.Components.ComponentType.Persistence])}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Acquisition="Acquisition"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Acquisition||(t.Acquisition={}),(r=n.Messages||(n.Messages={})).START_STATE="start",r.END_STATE="finish",r.ERROR="error",(o=r.AcquisitionMessageSubject||(r.AcquisitionMessageSubject={}))[o.AppelRADLAD=0]="AppelRADLAD",o[o.ChangeState=1]="ChangeState",o[o.ConvertBase64ToBin=2]="ConvertBase64ToBin",o[o.ConvertFileToImg=3]="ConvertFileToImg",o[o.FermetureSpiFactory=4]="FermetureSpiFactory",o[o.GetDocumentGEDAtAndOpen=5]="GetDocumentGEDAtAndOpen",o[o.GetDocumentGEDAndOpen=6]="GetDocumentGEDAndOpen",o[o.GetDocumentGEDAndSave=7]="GetDocumentGEDAndSave",o[o.GetProcessingTask=8]="GetProcessingTask",o[o.MergeAndOpenPDF=9]="MergeAndOpenPDF",o[o.MergerEtArchiver=10]="MergerEtArchiver",o[o.MergerEtUploader=11]="MergerEtUploader",o[o.OuvrirListeDocumentGED=12]="OuvrirListeDocumentGED",o[o.Purge=13]="Purge",o[o.RecupereListeDocumentGED=14]="RecupereListeDocumentGED",o[o.SetConfigurationScanner=15]="SetConfigurationScanner",o[o.GetListeScanner=16]="GetListeScanner",o[o.IsPrisEnMainADistance=17]="IsPrisEnMainADistance",o[o.UploadDocumentFrom=18]="UploadDocumentFrom",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Acquisition,[t.Components.ComponentType.Context])}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Acquisition||(t.Acquisition={}),(r=n.ACQUISITION_TYPE||(n.ACQUISITION_TYPE={}))[r.BINARY=0]="BINARY",r[r.BASE64=1]="BASE64"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Acquisition||(t.Acquisition={}),(r=n.BINARIZE_METHOD||(n.BINARIZE_METHOD={}))[r.SIMPLE_THRESHOLD=0]="SIMPLE_THRESHOLD",r[r.GLOBAL_THRESHOLD=1]="GLOBAL_THRESHOLD",r[r.ADAPTIVE_THRESHOLD=2]="ADAPTIVE_THRESHOLD",r[r.DYNAMIC_THRESHOLD=3]="DYNAMIC_THRESHOLD"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Acquisition||(t.Acquisition={}),(r=n.FILE_FORMAT||(n.FILE_FORMAT={}))[r.BMP=0]="BMP",r[r.PNG=1]="PNG",r[r.GIF=2]="GIF",r[r.JPG_JPEG=3]="JPG_JPEG",r[r.PDF=4]="PDF",r[r.TIF_TIFF=5]="TIF_TIFF"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Acquisition||(t.Acquisition={}),(r=n.ROTATION_VALUES||(n.ROTATION_VALUES={}))[r.ANGLE_90=90]="ANGLE_90",r[r.ANGLE_180=180]="ANGLE_180",r[r.ANGLE_270=270]="ANGLE_270"}(MyWay=MyWay||{}),function(e){var t;function n(){}((t=e.Services||(e.Services={})).Acquisition||(t.Acquisition={})).IConvertFileParams=n}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;function n(){}((t=e.Services||(e.Services={})).Acquisition||(t.Acquisition={})).ICreerImageBitonalParams=n}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;function n(){}((t=e.Services||(e.Services={})).Acquisition||(t.Acquisition={})).IPdfParams=n}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return null!==r&&r.apply(this,arguments)||this}t=e.Services||(e.Services={}),n=t.Acquisition||(t.Acquisition={}),r=n.IPdfParams,__extends(i,r),o=i,n.IGuidParams=o}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;function n(){}((t=e.Services||(e.Services={})).Acquisition||(t.Acquisition={})).IRadladParams=n}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;function n(){}((t=e.Services||(e.Services={})).Acquisition||(t.Acquisition={})).IProcessingTasks=n}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Communication="Communication"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Communication||(t.Communication={}),(r=n.CommunicationMessageSubject||(n.CommunicationMessageSubject={}))[r.EnvoyerMail=0]="EnvoyerMail",r[r.DeclencherAppel=1]="DeclencherAppel",r[r.RaccrocherAppel=2]="RaccrocherAppel",r[r.EnvoyerMessageAppliKiosque=3]="EnvoyerMessageAppliKiosque",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Communication,[t.Components.ComponentType.Context,t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var r,t;r=e.Services||(e.Services={}),(t=r.Communication||(r.Communication={})).controleEnvoyerMail=function(e){var t="^[a-zA-Z]+[a-zA-Z0-9._-]*@[a-zA-Z0-9.-]+.[a-zA-Z]{2,3}(;[a-zA-Z]+[a-zA-Z0-9._-]*@[a-zA-Z0-9.-]+.[a-zA-Z]{2,3})*$",n="Le format de l'adresse mail du paramètre '{0}' ({1}) est incorrect";return r.Controle.StaticStringControle.isString(e.to)?e.to.match(t)?r.Controle.StaticStringControle.isString(e.cc)&&!e.cc.match(t)?n.replace("{0}","cc").replace("{1}",e.cc):r.Controle.StaticStringControle.isString(e.bcc)&&!e.bcc.match(t)?n.replace("{0}","bcc").replace("{1}",e.bcc):"":n.replace("{0}","to").replace("{1}",e.to):"Le paramètre 'to' doit être une chaine de caractères"},t.controleDeclencherAppel=function(e){return/^(0|\+33)[1-9]([-. ]?[0-9]{2}){4}$/.test(e.numeroDestinataire)?"":"Le format du numéro du destinataire ({0}) est incorrect".replace("{0}",e.numeroDestinataire)}}(MyWay=MyWay||{}),function(e){var o;(function(e){function t(e,t,n,r,o){this.to=e,this.subject=t,this.body=n,this.cc=r,this.bcc=o}function n(e){this.numeroDestinataire=e}function r(e,t,n){this.IdAgent=e,this.Payload=new o.Payload(t,n)}e.Mail=t,e.Call=n,e.MessageAgent=r})((o=e.Services||(e.Services={})).Communication||(o.Communication={}))}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).ConfigurationPoste="ConfigurationPoste"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.ConfigurationPoste||(t.ConfigurationPoste={}),(r=n.ConfigurationPosteMessageSubject||(n.ConfigurationPosteMessageSubject={}))[r.GetConfiguration=0]="GetConfiguration",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.ConfigurationPoste,[t.Components.ComponentType.Context,t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).ContexteClient="ContexteClient"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.ContexteClient||(t.ContexteClient={}),(r=n.ContextClientMessageSubject||(n.ContextClientMessageSubject={}))[r.GetContextesParClients=0]="GetContextesParClients",r[r.GetId=1]="GetId",r[r.GetClient=2]="GetClient",r[r.SetClient=3]="SetClient",r[r.GetProperty=4]="GetProperty",r[r.AddToList=5]="AddToList",r[r.SetProperty=6]="SetProperty",r[r.RemoveFromList=7]="RemoveFromList",r[r.DeleteProperty=8]="DeleteProperty",r[r.GetContenu=9]="GetContenu",r[r.SetContenu=10]="SetContenu",r[r.GetContextes=11]="GetContextes",r[r.DestroyContext=12]="DestroyContext",r[r.NewContext=13]="NewContext",r[r.ChangeContextProcess=14]="ChangeContextProcess",r[r.ChangeContextMode=15]="ChangeContextMode",r[r.DetailsContext=16]="DetailsContext",r[r.SetReloadSynthese=17]="SetReloadSynthese",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.ContexteClient,[t.Components.ComponentType.Context,t.Components.ComponentType.Core,t.Components.ComponentType.Display,t.Components.ComponentType.Persistence])}(MyWay=MyWay||{}),function(e){var t,n,r,o,i;t=e.Services||(e.Services={}),n=t.ContexteClient||(t.ContexteClient={}),r=n.Messages||(n.Messages={}),(o=r.ContexteClientMode||(r.ContexteClientMode={}))[o.AUTOMATIQUE="AUTOMATIQUE"]="AUTOMATIQUE",o[o.MANUEL="MANUEL"]="MANUEL",(i=r.MiseAJourContexteClientType||(r.MiseAJourContexteClientType={}))[i.addToList="addToList"]="addToList",i[i.removeFromList="removeFromList"]="removeFromList",i[i.deleteProperty="deleteProperty"]="deleteProperty",i[i.setProperty="setProperty"]="setProperty",i[i.setClient="setClient"]="setClient",i[i.nouveauContexte="nouveauContexte"]="nouveauContexte",i[i.detructionContexte="detructionContexte"]="detructionContexte",i[i.changementContexte="changementContexte"]="changementContexte"}(MyWay=MyWay||{}),function(m){var e;(function(e){function t(){}function n(e,t,n,r){this.ExecApp=e,this.ExecServ=n,this.ExecTransaction=t,this.ExecWeb=r}function r(e){this.Executable=e}function o(e){this.Numero=e}function i(e){this.CodeSortie=e}function s(e,t){this.Url=e,this.Libelle=t}function a(e,t){this.ProcessId=e,this.StepId=t}function c(e,t){this.NumeroClient=e,this.Plan=t}function u(e){this.Valeur=e}function l(){}e.InfoFichier=t,e.ExecutableWrapper=n,e.ExecApp=r,e.ExecTransaction=o,e.ExecServ=i,e.ExecWeb=s,e.ContexteMyway=a,e.ContexteClient=c,e.JsonStringArray=u,e.infoDataStructNSDK=l;var p=(Object.defineProperty(f.prototype,"StructData",{get:function(){return this._StructData},set:function(e){this._StructData=e,f.Size=this.CalcSize()},enumerable:!0,configurable:!0}),f.prototype.DeSerializeData=function(e){for(var t=0,n=this.StructData,r=0;r<this.StructData.length;r++)"cwlgqr"!=n[r].DataName&&(this[n[r].DataName]=e.substring(t,t+n[r].DataLength)),t+=n[r].DataLength;this.cwlgqr=t},f.prototype.SerializeData=function(){for(var e=this.StructData,t="",n=0;n<this.StructData.length;n++)"cwlgqr"!=e[n].DataName&&(t+=this[e[n].DataName]);return t},f.prototype.CalcSize=function(){for(var e=this.StructData,t=0,n=0;n<this.StructData.length;n++)t+=e[n].DataLength;return t},f);function f(e){}e.SegmentNsdkClass=p;var g,h=(g=m.Services.Interop.SegmentNsdkClass,__extends(d,g),d);function d(){var e=g.call(this)||this;return e.StructData=[{DataName:"cwlgqr",DataLength:4},{DataName:"cwlnqr",DataLength:8},{DataName:"cidfiej",DataLength:5},{DataName:"cnuf9cg",DataLength:10},{DataName:"cdtfkc0",DataLength:8},{DataName:"ccdtn",DataLength:2},{DataName:"cnocee1",DataLength:7},{DataName:"ccocee3",DataLength:7},{DataName:"cddf9tr",DataLength:8},{DataName:"cdff9tr",DataLength:8},{DataName:"cidct",DataLength:7},{DataName:"cidtiem",DataLength:9},{DataName:"cidit",DataLength:9},{DataName:"cmtf9op",DataLength:15},{DataName:"cmtf9o1",DataLength:15},{DataName:"ccdfadv",DataLength:3},{DataName:"cnsf9rq",DataLength:4},{DataName:"cdtfkcc",DataLength:8}],e}e.s_5s6f5a=h})((e=m.Services||(m.Services={})).Interop||(e.Interop={}))}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Interop="Interop"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Interop||(t.Interop={}),r=n.Messages||(n.Messages={}),(o=r.InteropMessageSubject||(r.InteropMessageSubject={}))[o.AfficherWindowParHandle=0]="AfficherWindowParHandle",o[o.AfficherWindowParPid=1]="AfficherWindowParPid",o[o.AfficherSynthese=2]="AfficherSynthese",o[o.ActiverApplicationAppelante=3]="ActiverApplicationAppelante",o[o.AddToContextInterop=4]="AddToContextInterop",o[o.AddListToContextInterop=5]="AddListToContextInterop",o[o.GetFromContextInterop=6]="GetFromContextInterop",o[o.GetListFromContextInterop=7]="GetListFromContextInterop",o[o.Lancer=8]="Lancer",o[o.EndStep=9]="EndStep",o[o.TriggerNotifications=10]="TriggerNotifications",o[o.LireFichier=11]="LireFichier",o[o.EcrireFichier=12]="EcrireFichier",o[o.ClearBus=13]="ClearBus",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Interop,[t.Components.ComponentType.Context,t.Components.ComponentType.Persistence])}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Libelle||(t.Libelle={}),(r=n.TYPE_AFFICHAGE||(n.TYPE_AFFICHAGE={}))[r.ERREUR=10]="ERREUR",r[r.AVERTISSEMENT=30]="AVERTISSEMENT",r[r.INFORMATION=50]="INFORMATION",r[r.OUI_NON=70]="OUI_NON",r[r.OUI_NON_ANNULER=90]="OUI_NON_ANNULER",r[r.VALIDER_ANNULER=110]="VALIDER_ANNULER",r[r.ANNULER=120]="ANNULER",r[r.VIDE=140]="VIDE"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Libelle="Libelle"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Libelle||(t.Libelle={}),(r=n.LibelleMessageSubject||(n.LibelleMessageSubject={}))[r.afficherMessage=0]="afficherMessage",r[r.constituerLibelle=1]="constituerLibelle",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Libelle,[t.Components.ComponentType.Context,t.Components.ComponentType.Core,t.Components.ComponentType.Display])}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){}t=e.Services||(e.Services={}),n=t.Libelle||(t.Libelle={}),o.COM={MESSAGE_SANS_VARIABLE:"COM.MESSAGE_SANS_VARIABLE",RESULTATS:"COM.RESULTATS",ERREUR_PARAMETRE_MAUVAIS_TYPE:"COM.ERREUR_PARAMETRE_MAUVAIS_TYPE",ERREUR_PARAMETRES:"COM.ERREUR_PARAMETRES",ERREUR_FRAMEWORK:"COM.ERREUR_FRAMEWORK",ERREUR_SERVEUR:"COM.ERREUR_SERVEUR",ERREUR_TIMEOUT_SERVEUR:"COM.ERREUR_TIMEOUT_SERVEUR",ERREUR_TIMEOUT_CLIENT:"COM.ERREUR_TIMEOUT_CLIENT",ERREUR_ACCES_SERVEUR:"COM.ERREUR_ACCES_SERVEUR",ERREUR_CONFIGURATION_PAS_DE_CONFIG:"COM.ERREUR_CONFIGURATION_PAS_DE_CONFIG",ERREUR_HABILITATION_MAUVAIS_FORMAT:"COM.ERREUR_HABILITATION_MAUVAIS_FORMAT",ERREUR_HABILITATION_CODE_INCONNU:"COM.ERREUR_HABILITATION_CODE_INCONNU",ERREUR_HABILITATION_PARAMETRES_INSUFFISANTS:"COM.ERREUR_HABILITATION_PARAMETRES_INSUFFISANTS",ERREUR_HABILITATION_AUTHENTIFICATION_MANQUANTE:"COM.ERREUR_HABILITATION_AUTHENTIFICATION_MANQUANTE",ERREUR_INDEXED_DB_NON_SUPPORTE:"COM.ERREUR_INDEXED_DB_NON_SUPPORTE",ERREUR_INDEXED_DB_GENERIQUE:"COM.ERREUR_INDEXED_DB_GENERIQUE",ERREUR_INDEXED_DB_SUPPRESSION_IMPOSSIBLE:"COM.ERREUR_INDEXED_DB_SUPPRESSION_IMPOSSIBLE",ERREUR_INDEXED_DB_ACCES_IMPOSSIBLE:"COM.ERREUR_INDEXED_DB_ACCES_IMPOSSIBLE",ERREUR_INDEXED_DB_LECTURE_IMPOSSIBLE:"COM.ERREUR_INDEXED_DB_LECTURE_IMPOSSIBLE",ERREUR_INDEXED_DB_AJOUT_IMPOSSIBLE:"COM.ERREUR_INDEXED_DB_AJOUT_IMPOSSIBLE",ERREUR_INDEXED_DB_MAJ_IMPOSSIBLE:"COM.ERREUR_INDEXED_DB_MAJ_IMPOSSIBLE",ERREUR_INDEXED_DB_REQUETE_IMPOSSIBLE_INDEX:"COM.ERREUR_INDEXED_DB_REQUETE_IMPOSSIBLE_INDEX",ERREUR_INDEXED_DB_REQUETE_IMPOSSIBLE_CRITERE:"COM.ERREUR_INDEXED_DB_REQUETE_IMPOSSIBLE_CRITERE",ERREUR_INDEXED_DB_CALCUL_TAILLE:"COM.ERREUR_INDEXED_DB_CALCUL_TAILLE",ERREUR_CONTEXTE_RECUP_CODE_ETAB_IMPOSSIBLE:"COM.ERREUR_CONTEXTE_RECUP_CODE_ETAB_IMPOSSIBLE",ERREUR_CONTEXTE_RECUP_ID_AGENCE_IMPOSSIBLE:"COM.ERREUR_CONTEXTE_RECUP_ID_AGENCE_IMPOSSIBLE",ERREUR_DONNEESDELOC_OBJET_MAL_FORME:"COM.ERREUR_DONNEESDELOC_OBJET_MAL_FORME",ERREUR_DONNEESDELOC_PROPRIETE_ABSENTE:"COM.ERREUR_DONNEESDELOC_PROPRIETE_ABSENTE",ERREUR_DONNEESDELOC_RECUP_DERNMAJ_IMPOSSIBLE:"COM.ERREUR_DONNEESDELOC_RECUP_DERNMAJ_IMPOSSIBLE",ERREUR_LISA_NEXT_IMPOSSIBLE:"COM.ERREUR_LISA_NEXT_IMPOSSIBLE",ERREUR_LISA_START_IMPOSSIBLE:"COM.ERREUR_LISA_START_IMPOSSIBLE",ERREUR_LISA_GETPROCESSES_IMPOSSIBLE:"COM.ERREUR_LISA_GETPROCESSES_IMPOSSIBLE",ERREUR_LISA_GETTOOLS_IMPOSSIBLE:"COM.ERREUR_LISA_GETTOOLS_IMPOSSIBLE",ERREUR_NUMERISATION_RECUP_CODE_ETAB_IMPOSSIBLE:"COM.ERREUR_NUMERISATION_RECUP_CODE_ETAB_IMPOSSIBLE",ERREUR_NUMERISATION_RECUP_DONNEES_DELOCALISEES_IMPOSSIBLE:"COM.ERREUR_NUMERISATION_RECUP_DONNEES_DELOCALISEES_IMPOSSIBLE",ERREUR_INTEROP_SERVICE_LOCAL_APPEL_IMPOSSIBLE:"COM.ERREUR_INTEROP_SERVICE_LOCAL_APPEL_IMPOSSIBLE",ERREUR_FICHIER_PARAMETRE_DATA_VIDE:"COM.ERREUR_FICHIER_PARAMETRE_DATA_VIDE",ERREUR_FICHIER_PARAMETRE_B64_VIDE:"COM.ERREUR_FICHIER_PARAMETRE_B64_VIDE",ERREUR_APPLICATION:"COM.ERREUR_APPLICATION",ERREUR_APPLICATION_CODE_NON_RENSEIGNE:"COM.ERREUR_APPLICATION_CODE_NON_RENSEIGNE",ERREUR_APPLICATION_TYPE_INCONNU:"COM.ERREUR_APPLICATION_TYPE_INCONNU",ERREUR_APPLICATION_DEMARRAGE_IMPO:"COM.ERREUR_APPLICATION_DEMARRAGE_IMPOSSIBLE",ERREUR_APPLICATION_MAINTENANCE:"COM.ERREUR_APPLICATION_MAINTENANCE",ERREUR_MOBILITE_RECUP_RESEAU_IMPOSSIBLE:"COM.ERREUR_MOBILITE_RECUP_RESEAU_IMPOSSIBLE",ERREUR_MOBILITE_RECUP_LISTE_PERIPH_IMPOSSIBLE:"COM.ERREUR_MOBILITE_RECUP_LISTE_PERIPH_IMPOSSIBLE",ERREUR_MOBILITE_RECUP_LISTE_TABLETTES_SIGNATURES_IMPOSSIBLE:"COM.ERREUR_MOBILITE_RECUP_LISTE_TABLETTES_SIGNATURES_IMPOSSIBLE",ERREUR_MOBILITE_RECUP_INFO_MACHINE_IMPOSSIBLE:"COM.ERREUR_MOBILITE_RECUP_INFO_MACHINE_IMPOSSIBLE",ERREUR_MOBILITE_RECUP_PLATEFORME_MACHINE_IMPOSSIBLE:"COM.ERREUR_MOBILITE_RECUP_PLATEFORME_MACHINE_IMPOSSIBLE",ERREUR_MOBILITE_RECUP_RESOLUTION_ECRAN_IMPOSSIBLE:"COM.ERREUR_MOBILITE_RECUP_RESOLUTION_ECRAN_IMPOSSIBLE",ERREUR_MOBILITE_RECUP_TYPE_ECRAN_IMPOSSIBLE:"COM.ERREUR_MOBILITE_RECUP_TYPE_ECRAN_IMPOSSIBLE",ERREUR_CAPACITES_REGLE_INCONNU:"COM.ERREUR_CAPACITES_REGLE_INCONNU",ERREUR_COMMUNICATION_MESSAGE_INDISPONIBLE:"COM.MESSAGE_INDISPONIBLE",ERREUR_COMMUNICATION_FORMAT_MAIL_INCORRECT:"COM.ERREUR_COMMUNICATION_FORMAT_MAIL_INCORRECT",ERREUR_COMMUNICATION_FORMAT_NUMERO_INCORRECT:"COM.ERREUR_COMMUNICATION_FORMAT_NUMERO_INCORRECT",ERREUR_COMMUNICATION_DONNEES_APPEL_MANQUANTE:"COM.ERREUR_COMMUNICATION_DONNEES_APPEL_MANQUANTE",ERREUR_COMMUNICATION_PARAMETRES_INSUFFISANTS:"COM.ERREUR_COMMUNICATION_PARAMETRES_INSUFFISANTS",ERREUR_CONTROLE_STRING_ADRESSEIP_INCORRECT:"COM.ERREUR_CONTROLE_STRING_ADRESSEIP_INCORRECT",ERREUR_ACQUISITION_PARAMETRES_INSUFFISANTS:"COM.ERREUR_ACQUISITION_PARAMETRES_INSUFFISANTS",ERREUR_EXPORT_DONNEES_ENTREES_FORMAT_INVALIDE:"COM.ERREUR_EXPORT_DONNEES_ENTREES_FORMAT_INVALIDE",ERREUR_EXPORT_DONNEES_ENTREES_VIDE:"COM.ERREUR_EXPORT_DONNEES_ENTREES_VIDE",ERREUR_EXPORT_DONNEES_ENTREES_NB_INVALIDE:"COM.ERREUR_EXPORT_DONNEES_ENTREES_NB_INVALIDE",ERREUR_EXPORT_CONVERSION_CSV_IMPOSSIBLE:"COM.ERREUR_EXPORT_CONVERSION_CSV_IMPOSSIBLE",ERREUR_EXPORT_TELECHARGEMENT_IMPOSSIBLE:"COM.ERREUR_EXPORT_TELECHARGEMENT_IMPOSSIBLE",ERREUR_EXPORT_FORMAT_FICHIER_INCONNU:"COM.ERREUR_EXPORT_FORMAT_FICHIER_INCONNU"},o.TEC={CHAINE_VIDE:"TEC.CHAINE_VIDE",VALIDATION_ARRAY:"TEC.VALIDATION_ARRAY",IMPRESSION_GENERATION_EN_COURS:"TEC.IMPRESSION_GENERATION_EN_COURS",IMPRESSION_IMPRESSION_EN_COURS:"TEC.IMPRESSION_IMPRESSION_EN_COURS",IMPRESSION_GENERATION_IMPRESSION_EN_COURS:"TEC.IMPRESSION_GENERATION_IMPRESSION_EN_COURS",NUMERISATION_EN_COURS:"TEC.NUMERISATION_EN_COURS"},r=o,n.LibelleModel=r}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Mobilite="Mobilite"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),r=n.Messages||(n.Messages={}),(o=r.MobiliteMessageSubject||(r.MobiliteMessageSubject={}))[o.GetInfoMachine=0]="GetInfoMachine",o[o.GetPeripheriques=1]="GetPeripheriques",o[o.GetPeripheriquesParType=2]="GetPeripheriquesParType",o[o.GetReseau=3]="GetReseau",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Mobilite,[t.Components.ComponentType.Context,t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var t,n;function r(){this.typePeripherique=n.TYPE_PERIPHERIQUE.CAISSE_AUTO}t=e.Services||(e.Services={}),(n=t.Mobilite||(t.Mobilite={})).CaisseAuto=r}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),(r=n.PLATEFORME||(n.PLATEFORME={}))[r.MYSYS=1]="MYSYS",r[r.WINDOWS=2]="WINDOWS",r[r.APPLE=3]="APPLE",r[r.ANDROID=4]="ANDROID",r[r.AUTRE=99]="AUTRE"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),(o=r=n.TYPE_PERIPHERIQUE||(n.TYPE_PERIPHERIQUE={}))[o.TABLETTE_SIGNATURE=0]="TABLETTE_SIGNATURE",o[o.CAISSE_AUTO=1]="CAISSE_AUTO",n.TypePeripherique=r}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),(r=n.TYPE_RESEAU||(n.TYPE_RESEAU={}))[r.DECONNECTE=0]="DECONNECTE",r[r.VPN=10]="VPN",r[r.WIFI_AGENCE=20]="WIFI_AGENCE",r[r.FILAIRE=30]="FILAIRE",r[r.CONNECTE=99]="CONNECTE",r[r.INCONNU=99]="INCONNU"}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t,r;function n(e,t,n){this.typePeripherique=r.TYPE_PERIPHERIQUE.TABLETTE_SIGNATURE,this.type=e,this.modele=t,this.codeModele=n}t=e.Services||(e.Services={}),(r=t.Mobilite||(t.Mobilite={})).TabletteSignature=n}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var o;(function(e){var t;(t=e.NIVEAUX_TRACE||(e.NIVEAUX_TRACE={}))[t.DEBUG=30]="DEBUG",t[t.INFO=50]="INFO",t[t.WARNING=70]="WARNING",t[t.ERROR=90]="ERROR";var n=(r.gererErreur=function(e){return e&&(e instanceof Error?e={message:e.message,stack:e.stack}:o.Controle.StaticObjectControle.isObjectSpecified(e,"DOMException")&&(e={code:e.code,message:e.message,name:e.name,stack:e.stack})),e},r);function r(){}e.Utils=n})((o=e.Services||(e.Services={})).Trace||(o.Trace={}))}(MyWay=MyWay||{}),function(a){var f;(function(l){var e=(t.prototype.debug=function(e,t,n){this.send(l.NIVEAUX_TRACE.DEBUG,e,t,n)},t.prototype.info=function(e,t,n){this.send(l.NIVEAUX_TRACE.INFO,e,t,n)},t.prototype.warning=function(e,t,n){this.send(l.NIVEAUX_TRACE.WARNING,e,t,n)},t.prototype.error=function(e,t,n){this.send(l.NIVEAUX_TRACE.ERROR,e,t,n)},t.prototype.send=function(e,t,n,r){var o,i;i="Application"===this._zoneName?(o=this._componentName,null):(o=void 0!==a.Framework?a.Framework.NAME+" V"+a.Framework.VERSION:"Framework inconnu",this._componentName+this._zoneName);var s=this.createTrace(e,t,window.location.href,o,i,n,r);this._library&&this._library.Trace&&this._library.Trace.send(s)},t.prototype.createTrace=function(e,t,n,r,o,i,s){var a=(new Date).getTime();"ServiceAgentExtended"===i&&s&&s.lastDigestTime&&(a=s.lastDigestTime,s=null),s=l.Utils.gererErreur(s);var c="";if(f.Controle.StaticEnumControle.isAnEnumValue(e,l.NIVEAUX_TRACE)||(c+="Le paramètre 'niveau' est obligatoire et sa valeur doit faire partie de l'enum 'NIVEAUX_TRACE' / "),f.Controle.StaticStringControle.isStringNotEmpty(t)||(c+="Le paramètre 'message' est obligatoire et doit être de type string et non vide / "),f.Controle.StaticStringControle.isStringNotEmpty(n)||(c+="Le paramètre 'url' est obligatoire et doit être de type string et non vide / "),f.Controle.StaticStringControle.isStringNotEmpty(r)||(c+="Le paramètre 'application' est obligatoire et doit être de type string et non vide / "),f.Controle.StaticStringControle.isStringNotEmptyOrNullOrUndefined(o)||(c+="Le paramètre 'composant' doit être soit null soit undefined soit de type string et non vide / "),f.Controle.StaticStringControle.isStringNotEmptyOrNullOrUndefined(i)||(c+="Le paramètre 'action' doit être soit null soit undefined soit de type string et non vide / "),""!=c)throw c=c.substring(0,c.lastIndexOf("/")-1),new Error(c);var u=new p;return u.datetime=a,u.niveau=e,u.client="",u.serveur="",u.url=n,u.application=r,f.Controle.StaticAnyControle.isNotUndefinedAndNotNull(o)?u.composant=o:u.composant="",f.Controle.StaticAnyControle.isNotUndefinedAndNotNull(i)?u.action=i:u.action="",u.message=t,f.Controle.StaticAnyControle.isNotUndefinedAndNotNull(s)?u.details=s:u.details=null,u},t);function t(e,t,n){this._componentName=e,this._zoneName=t,this._library=n}l.Logger=e;var p=function(){};l.TraceModel=p})((f=a.Services||(a.Services={})).Trace||(f.Trace={}))}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Trace="Trace"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Trace||(t.Trace={}),r=n.Messages||(n.Messages={}),(o=r.TraceMessageSubject||(r.TraceMessageSubject={}))[o.Tracer=0]="Tracer",o[o.Logger=1]="Logger",o[o.GetIntervallePurge=2]="GetIntervallePurge",o[o.GetQuotaPurge=3]="GetQuotaPurge",o[o.PurgerTraces=4]="PurgerTraces",o[o.SendDiagnostic=5]="SendDiagnostic",o[o.SetModeDebug=6]="SetModeDebug",o[o.ReInitDbTraces=7]="ReInitDbTraces",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Trace,[t.Components.ComponentType.Context,t.Components.ComponentType.Core,t.Components.ComponentType.BaseDeDonnees])}(MyWay=MyWay||{}),function(e){var u;(function(c){var r=function(){};c.ScopeData=r;var i=function(e,t){this.name=e,this.data=t};c.ServiceData=i;var o,e=(o=u.Components.ComponentAgentBase,__extends(a,o),a.prototype.init=function(e,t,n){var r=this;return this.sauvegardeScopeParam=n,this.sauvegardeScopeParam||(this.sauvegardeScopeParam={}),this.sauvegardeScopeParam.donneesScopeASauvegarder||(this.sauvegardeScopeParam.donneesScopeASauvegarder=["*"]),this.sauvegardeScopeParam.scopeType||(this.sauvegardeScopeParam.scopeType=c.ScopeType.View),null!==this.sauvegardeScopeParam.disableScopeSave&&void 0!==this.sauvegardeScopeParam.disableScopeSave||(this.sauvegardeScopeParam.disableScopeSave=!0),o.prototype.init.call(this,e,t,n).then(function(){return n&&!0===n.disableGetStepInfo?r.GetCurrentStepInfo().then(function(e){r.StepInfo=e}):r.SetMyWayCompatible().then(function(){},function(){})})},a.prototype.AddToContext=function(t,e){var n=this;return this.sendMessage(c.ContextMessageSubject.AddToContext,{key:t,value:e}).then(function(e){return n._checkKey(t),e})},a.prototype.AddToSharedContext=function(e,t){return this.sendMessage(c.ContextMessageSubject.AddToSharedContext,{key:e,value:t})},a.prototype.RemoveFromSharedContext=function(e){return this.sendMessage(c.ContextMessageSubject.RemoveFromSharedContext,{key:e})},a.prototype.AddToMainProcessContext=function(e,t){return this.sendMessage(c.ContextMessageSubject.AddToMainProcessContext,{key:e,value:t})},a.prototype.AddListToContext=function(t){var n=this;return this.sendMessage(c.ContextMessageSubject.AddListToContext,{kvp:t}).then(function(e){return n._checkKeys(t),e})},a.prototype.GetFromContext=function(e){return this.sendMessage(c.ContextMessageSubject.GetFromContext,{key:e})},a.prototype.GetFromSharedContext=function(e){return this.sendMessage(c.ContextMessageSubject.GetFromSharedContext,{key:e})},a.prototype.GetObjectFromContext=function(e){return this.sendMessage(c.ContextMessageSubject.GetObjectFromContext,{keyArray:e})},a.prototype.GetTypedObjectFromContext=function(e){return this.sendMessage(c.ContextMessageSubject.GetTypedObjectFromContext,{template:e})},a.prototype.GetListFromContext=function(e){return this.sendMessage(c.ContextMessageSubject.GetListFromContext,{keyArray:e})},a.prototype.GetAuthentificationInfo=function(){return this.sendMessage(c.ContextMessageSubject.GetAuthentificationInfo,{})},a.prototype.getAuthentificationInfo=function(){return this.GetAuthentificationInfo()},a.prototype.GetParametresComptables=function(){return this.sendMessage(c.ContextMessageSubject.GetParametresComptables,{})},a.prototype.Redirect=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=null),this.library.Display.redirect(e,t)},a.prototype.GetWaitingProcesses=function(){return this.sendMessage(c.ContextMessageSubject.GetWaitingProcesses,{})},a.prototype.PutProcessInPortalContext=function(e){return this.sendMessage(c.ContextMessageSubject.PutProcessInPortalContext,{processId:e})},a.prototype.PutTaskInPortalContext=function(e){return this.sendMessage(c.ContextMessageSubject.PutTaskInPortalContext,{taskId:e})},a.prototype.GetCurrentProcessId=function(){return this.sendMessage(c.ContextMessageSubject.GetCurrentProcessId,{})},a.prototype.GetCurrentStepId=function(){return this.sendMessage(c.ContextMessageSubject.GetCurrentStepId,{})},a.prototype.reinitialisationServiceAgent=function(e){return this.sendMessage(c.ContextMessageSubject.ReinitialisationServiceAgent,{idServiceAgentGenere:e})},a.prototype.GetCurrentStepInfo=function(){return this.sendMessage(c.ContextMessageSubject.GetCurrentStepInfo,{})},a.prototype.SetMyWayCompatible=function(){var t=this;return this.sendMessage(c.ContextMessageSubject.SetMyWayCompatible,{}).then(function(e){return t.VersionComposant=e.versionComposant,!0})},a.prototype.SubscribeToNotification=function(e,r){var o=this;return e.forEach(function(t){var n=!1;if(o.listenersNotificationsCorrespondance.every(function(e){return e.callbackExterne===t&&(n=!0),!n}),!n){var e={callbackExterne:t,callbackInterne:function(e){t(e,r)}};o.library.Core.addListenerOnNotification(e.callbackInterne),o.listenersNotificationsCorrespondance.push(e)}}),r&&this.library.Interop?this.library.Interop.triggerNotifications():u.Promesses.getPromesseSelfResoved()},a.prototype.retirerListenerNotification=function(t){var n=this;u.CoreCommon.ArrayUtils.remove(this.listenersNotificationsCorrespondance,function(e){return e.callbackExterne===t&&(n.library.Core.removeListenerOnNotification(e.callbackInterne),!0)})},a.prototype.ChangeMainProcessName=function(e){return this.sendMessage(c.ContextMessageSubject.ChangeMainProcessName,{name:e})},a.prototype.getAllElementsWithAttribute=function(e){for(var t=[],n=document.getElementsByTagName("*"),r=0,o=n.length;r<o;r++)null!==n[r].getAttribute(e)&&t.push(n[r]);return t},a.prototype.SauvegarderDonneesScope=function(){if(this.sauvegardeScopeParam.disableScopeSave||!this.StepInfo||!this.StepInfo.CurrentStepId)return null;if("undefined"==typeof angular)return null;var e=null;try{if(this.sauvegardeScopeParam.scopeType==c.ScopeType.Service){var t=this._getServiceData(this.sauvegardeScopeParam.donneesScopeASauvegarder);try{e=JSON.pruned(t)}catch(e){u.Loggers.FLASH.INSTANCE.setValue("action","SauvegarderDonneesScope"),a.logger.error("impossible de serialiser le scope")}}else{var n=this._getAngularScope();if(!n)return;var r=this._getOverallScopeContent(n);try{e=JSON.pruned(r)}catch(e){u.Loggers.FLASH.INSTANCE.setValue("action","SauvegarderDonneesScope"),a.logger.error("impossible de serialiser le scope")}}e&&(e.length<1e4?this._addToProcessStepContext("donneesScope",e,this.StepInfo.CurrentPath):(u.Loggers.FLASH.INSTANCE.setValue("action","SauvegarderDonneesScope"),a.logger.warn("Sauvegarde du scope non autorisee, le scope serialise depasse la taille limite de %1 caracteres : %2",1e4,e.length)))}catch(e){u.Loggers.FLASH.INSTANCE.setValue("action","SauvegarderDonneesScope"),a.logger.debug("impossible de récupérer le scope")}},a.prototype._addToProcessStepContext=function(e,t,n){return this.sendMessage(c.ContextMessageSubject.AddToProcessStepContext,{key:e,value:t,processStepId:n})},a.prototype._getAngularScope=function(){var e;if(this.sauvegardeScopeParam.scopeType===c.ScopeType.View){var t=this.getAllElementsWithAttribute("ng-view");if(0===t.length&&(t=this.getAllElementsWithAttribute("data-ng-view")),0===t.length)return null;e=angular.element(t).scope()}else this.sauvegardeScopeParam.scopeType===c.ScopeType.Root&&(e=angular.element(document).scope());return e},a.prototype._getOverallScopeContent=function(t){var i=this;if(this.sauvegardeScopeParam.scopeType!==c.ScopeType.View)return this.sauvegardeScopeParam.scopeType===c.ScopeType.Root?this._getScopeData(t,null):this.sauvegardeScopeParam.scopeType===c.ScopeType.Service?this._getServiceData(this.sauvegardeScopeParam.donneesScopeASauvegarder):void 0;var s={};return 1==this.sauvegardeScopeParam.donneesScopeASauvegarder.length&&"*"===this.sauvegardeScopeParam.donneesScopeASauvegarder[0]?s=this._getScopeContent(t):this.sauvegardeScopeParam.donneesScopeASauvegarder.forEach(function(e){var n=e.split(".");if(1===n.length)s[e]=i._getScopeContent(t[n[0]]);else{var r=t,o={};n.forEach(function(e,t){0===t?(s[e]||(s[e]={}),o=s[e],r=r[e]):t===n.length-1?o[e]=i._getScopeContent(r[e]):(o[e]||(o[e]={}),o=o[e],r=r[e])})}}),s},a.prototype._getScopeData=function(e,t){var n=new r;return n.id=e.$id,n.data=this._getScopeContent(e),e.$$childHead&&this._getScopeData(e.$$childHead,n),e.$$nextSibling&&this._getScopeData(e.$$nextSibling,t),t&&(t.children||(t.children=[]),t.children.push(n)),n},a.prototype._setScope=function(t,e){var n=this,r=this._getScopeById(t,e.id);if(r)for(var o in e.data)u.CoreCommon.applyProperties(e.data,r,o);e.children&&e.children.forEach(function(e){n._setScope(t,e)})},a.prototype._getServiceData=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=angular.element(document.body).injector().get(r);t.push(new i(r,o))}return t},a.prototype._setServices=function(e){for(var t=0;t<e.length;t++){var n=e[t].name,r=e[t].data,o=angular.element(document.body).injector().get(n);for(var i in r)u.CoreCommon.applyProperties(r,o,i)}},a.prototype._getScopeById=function(e,t){return e.$id===t?e:e.$$childHead&&(n=this._getScopeById(e.$$childHead,t))?n:e.$$nextSibling&&(n=this._getScopeById(e.$$nextSibling,t))?n:null;var n},a.prototype._isObject=function(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)},a.prototype._getScopeContent=function(e){if(!this._isObject(e[n]))return e;var t={};for(var n in e)if("$"!==n[0]&&"function"!=typeof e[n]&&e[n]&&e.hasOwnProperty(n))if(this._isObject(e[n])){if(e[n].$$framework)continue;t[n]=this._getScopeContent(e[n])}else t[n]=e[n];return t},a.prototype.getId=function(e){return e.id?"#"+e.id:""},a.prototype.getClasses=function(e){return e.className?"."+e.className.replace(new RegExp(" ","g"),"."):""},a.prototype.InitialiserDonneesScope=function(e){var n=this;if(this.sauvegardeScopeParam.disableScopeSave||!e||!e.CurrentStepId||"undefined"==typeof angular){var t=u.Promesses.getServiceDePromesse().defer();return u.Loggers.FLASH.INSTANCE.setValue("action","InitialiserDonneesScope"),a.logger.debug("sauvegarde scope non utilisable"),t.resolve(!1),t.promise}a.logger.warn("InitialiserDonneesScope - Restauration du scope, log pour remonter sur Kibana qui utilise cette fonctionnalité");var r=this,o=!1;return this.GetFromContext("donneesScope").then(function(e){if(e)try{var i=JSON.parse(e),s=n._getAngularScope();if(s||r.sauvegardeScopeParam.scopeType!==c.ScopeType.View&&r.sauvegardeScopeParam.scopeType!==c.ScopeType.Root){if(r.sauvegardeScopeParam.scopeType===c.ScopeType.View){if(1==n.sauvegardeScopeParam.donneesScopeASauvegarder.length&&"*"===n.sauvegardeScopeParam.donneesScopeASauvegarder[0])for(var t in i)u.CoreCommon.applyProperties(i,s,t);else n.sauvegardeScopeParam.donneesScopeASauvegarder.forEach(function(e,t){var n=e.split(".");if(1===n.length)u.CoreCommon.applyProperties(i,s,t);else{var r=s,o={};n.forEach(function(e,t){0===t?(r[e]||(r[e]={}),o=i[e],r=r[e]):t===n.length-1?u.CoreCommon.applyProperties(o,r,e):(r[e]||(r[e]={}),o=o[e],r=r[e])})}});s.$apply()}else r.sauvegardeScopeParam.scopeType===c.ScopeType.Root?(n._setScope(s,i),s.$apply()):r.sauvegardeScopeParam.scopeType===c.ScopeType.Service&&n._setServices(i);o=!0}else u.Loggers.FLASH.INSTANCE.setValue("action","InitialiserDonneesScope"),a.logger.warn("pas de scope trouvé sur la vue")}catch(e){u.Loggers.FLASH.INSTANCE.setValue("action","InitialiserDonneesScope"),a.logger.error("Problème lors de l'initialisation des données du scope : %1",e.toString())}return o})},a.prototype.sendNotification=function(e){return this.library.Core.sendNotification(e),e&&"fin d etape"===e.Sujet&&this.SauvegarderDonneesScope(),u.Promesses.getPromesseSelfResoved()},a.prototype.reception=function(e){switch(e.subject){case c.ContextMessageSubject.Notification:var t=e.message;return this.sendNotification(t);case c.ContextMessageSubject.AnalyseApp:var n=this.AnalyseApp(),r=u.Promesses.getServiceDePromesse().defer();return r.resolve(n),r.promise;default:return o.prototype.reception.call(this,e)}},a.prototype.AnalyseApp=function(){if("undefined"==typeof angular)return null;for(var e=new c.AnalyseResult,t=document.getElementsByClassName("ng-scope"),n=0,r=[].slice.call(t);n<r.length;n++){var o=r[n],i=o.localName+this.getId(o)+this.getClasses(o),s=angular.element(o).scope();if(s)if(s.$$watchers){var a=s.$$watchers.length;e.TotalWatchers+=a,e.WatcherByScope.push(new c.AnalyseScope(i,a))}else e.WatcherByScope.push(new c.AnalyseScope(i,0))}return e.TotalWatchers2=this.CountWatcher2(),e.TotalWatchers3=this.CountWatcher3(),e},a.prototype.CountWatcher2=function(){var e=angular.element(document.getElementsByTagName("body")),n=[],r=function(t){angular.forEach(["$scope","$isolateScope"],function(e){t.data()&&t.data().hasOwnProperty(e)&&angular.forEach(t.data()[e].$$watchers,function(e){n.push(e)})}),angular.forEach(t.children(),function(e){r(angular.element(e))})};r(e);var t=[];return angular.forEach(n,function(e){t.indexOf(e)<0&&t.push(e)}),t.length},a.prototype.CountWatcher3=function(){var e=this.getAllElementsWithAttribute("ng-controller"),n=0;return e&&e.forEach(function(e){var t=angular.element(e).scope();t&&t.$$watchers&&(n+=t.$$watchers.length)}),n},a.prototype.SetContextListener=function(e,t){this._listenedKey=e,this._listernerCallback=t},a.prototype._checkKey=function(e){var t=!1;return this._listenedKey&&this._listernerCallback&&e===this._listenedKey&&(this._listernerCallback(),t=!0),t},a.prototype._checkKeys=function(e){for(var t=!1,n=0,r=e;n<r.length;n++){var o=r[n];if(this._checkKey(o.Key)){t=!0;break}}return t},a.CLASS_NAME="MyWay.Services.Context.ContextAgent",a.logger=u.Loggers.LoggerFactory.INSTANCE.getClass(a.CLASS_NAME),a);function a(){var e=o.call(this,u.Components.ComponentType.Context)||this;return e.listenersNotificationsCorrespondance=[],e._listenedKey=null,e._listernerCallback=null,e}c.ContextAgent=e,u.Components.RegistryAgent.getInstance().register(e)})((u=e.Services||(e.Services={})).Context||(u.Context={}))}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).ServiceAgentExtended.prototype.OnContextEvent=function(){t.ServiceAgentExtended.logger_extended.info("Ajout au contexte de %1",this._listenedKey),t.ServiceAgentProvider._serviceAgentExtended._diagnostic.userTime=Date.now(),this.library.Context.SetContextListener(null,null)},t.ServiceAgentExtended.prototype.addToSharedContext=function(e,t){try{var n=this.$q.defer();return this.Context.AddToSharedContext(e,t).then(function(){n.resolve()},function(){n.reject()}),n.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.removeFromSharedContext=function(e){try{var t=this.$q.defer();return this.Context.RemoveFromSharedContext(e).then(function(){t.resolve()},function(){t.reject()}),t.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.addToContext=function(e,t){try{var n=this.$q.defer();return this.Context.AddToContext(e,t).then(function(){n.resolve()},function(){n.reject()}),n.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.addListToContext=function(e){try{var t=this.$q.defer(),n=[];return angular.forEach(e,function(e,t){n.push({Key:t,Value:e})}),this.Context.AddListToContext(n).then(function(){t.resolve()},function(){t.reject()}),t.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.getFromContext=function(e,t){var n=this;try{var r=this.$q.defer();return this.Context.GetFromContext(e).then(function(e){t&&(e=n.instanceLoaderService.createInstance(t,e)),r.resolve(e)},function(){r.reject()}),r.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.getFromSharedContext=function(e,t){var n=this;try{var r=this.$q.defer();return this.Context.GetFromSharedContext(e).then(function(e){t&&(e=n.instanceLoaderService.createInstance(t,e)),r.resolve(e)},function(){r.reject()}),r.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.getListFromContext=function(e){try{var t=this.$q.defer();return this.Context.GetListFromContext(e).then(function(e){t.resolve(e)},function(){t.reject()}),t.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.getAuthentificationInfo=function(){try{var t=this.$q.defer();return this.Context.GetAuthentificationInfo().then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.getParametresComptables=function(){try{var t=this.$q.defer();return this.Context.GetParametresComptables().then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}catch(e){throw new Error(e)}}}(MyWay=MyWay||{}),function(e){var i;(i=e.Services||(e.Services={})).Core.defineProperty(i.ServiceAgent,"Step",{get:function(){return this.Library.Context.StepInfo}}),i.ServiceAgent.prototype.SendRequest=function(e){var o=this;return i.Promesses.promesseTryCatch(function(t){var n=o,r=e;r.logger=i.ServiceAgent.logger,n.Library&&n.Library.Context&&n.Library.Context.StepInfo?(r.stepInfo=n.Library.Context.StepInfo,r.versionComposant=r.stepInfo.VersionComposant):n.Library&&n.Library.Context&&(r.stepInfo=null,r.versionComposant=n.Library.Context.VersionComposant),e.withHeaders?n.Context.GetAuthentificationInfo().then(function(e){r.authentificationInfo=e,n.Library.Context.GetParametresComptables().then(function(e){r.parametresComptables=e,i.CoreCommon.SendRequest(r,function(e){t.resolve(e)},function(e){t.reject(e)})}).catch(t.reject)}).catch(t.reject):i.CoreCommon.SendRequest(r,function(e){t.resolve(e)},function(e){t.reject(e)})})}}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){var e=r.call(this,t.Components.ComponentType.Display)||this;return e.myIFrameId=null,e}t=e.Services||(e.Services={}),n=t.Display||(t.Display={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.getMyIFrameId=function(){return this.myIFrameId},i.prototype.reception=function(e){switch(e.subject){case n.DisplayMessageSubject.Refresh:return e.message,this.Refresh(),t.Promesses.getPromesseSelfResoved();default:return r.prototype.reception.call(this,e)}},i.prototype.Refresh=function(){try{angular.element(document.body).injector().get("$route").reload()}catch(e){t.Loggers.FLASH.INSTANCE.setValue("details",e),i.logger.warn("Reload failed")}},i.prototype.RedirectInStep=function(e){return this.sendMessage(n.DisplayMessageSubject.RedirectInStep,{}).then(function(e){window.location.href=e})},i.prototype.PrepareSubmit=function(e){return this.sendMessage(n.DisplayMessageSubject.PrepareSubmit,{url:e})},i.prototype.redirect=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=null),this.sendMessage(n.DisplayMessageSubject.Redirect,{url:e,previousUrl:t})},i.prototype.displayMessage=function(e){return this.sendMessage(n.DisplayMessageSubject.DisplayMessage,{message:e})},i.CLASS_NAME="MyWay.Services.Display.DisplayAgent",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.DisplayAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Preferences="Preferences"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Preferences||(t.Preferences={}),(r=n.PreferencesMessageSubject||(n.PreferencesMessageSubject={}))[r.LirePreference=0]="LirePreference",r[r.EcrirePreference=1]="EcrirePreference",r[r.LireMultiPreference=2]="LireMultiPreference",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Preferences,[t.Components.ComponentType.Context,t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var n,t,r;function o(){this.libraryManager=null,this.portalServiceParameters=null}n=e.Services||(e.Services={}),t=n.Context||(n.Context={}),o.prototype.init=function(e,t){this.libraryManager=e,this.portalServiceParameters=t},o.prototype.GetDonneesLocales=function(){return n.Promesses.promesseTryCatch(function(e){e.resolve(null)})},o.prototype.ShareProcess=function(e,t){return n.Promesses.promesseTryCatch(function(e){e.resolve()})},o.prototype.RemoveProcess=function(e){return n.Promesses.promesseTryCatch(function(e){e.resolve(null)})},o.prototype.GetInfosUserApi=function(){return n.Promesses.promesseTryCatch(function(e){e.resolve(null)})},o.prototype.GetPortalInformation=function(e){var t="";return e&&(t=e.codeEtablissement),n.CoreCommon.SendRequestWithPromise({url:n.PrivatePortalServiceParameters.Instance().PortalInfoUrl+"/urlCultureNet?codeEtablissement="+t,withHeaders:!0,authentificationInfo:e}).then(function(e){return e&&e.donnee?{urlCultureNet:e.donnee}:null})},o.prototype.warnLocalServiceUnavailability=function(){return o.loggerContextApiBase.warn("Le service local n'a pu être joint et a été désactivé. Veuillez redémarrer le service local et recharger le portail"),n.Promesses.createPromiseSelfError(new n.Erreur("Le service local n'a pu être joint et a été désactivé. Veuillez redémarrer le service local et recharger le portail"))},o.CLASS_NAMEContextApiBase="MyWay.Services.Context.ContextApiWindows",o.loggerContextApiBase=n.Loggers.LoggerFactory.INSTANCE.getClass(o.CLASS_NAMEContextApiBase),r=o,t.ContextApiBase=r}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){return i.call(this,t.Components.ComponentType.Context)||this}t=e.Services||(e.Services={}),o=t.Context||(t.Context={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?this.api=new o.ContextApiWindows:this.api=new o.ContextApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){r.api.init(t,n.portalServiceParameters)})},r.prototype.GetDonneesLocales=function(){return this.api.GetDonneesLocales()},r.prototype.ShareProcess=function(e,t){return this.api.ShareProcess(e,t)},r.prototype.RemoveProcess=function(e){return this.api.RemoveProcess(e)},r.prototype.GetInfosUserApi=function(){return this.api.GetInfosUserApi()},r.prototype.GetPortalInformation=function(e){return this.api.GetPortalInformation(e)},n=r,o.ContextApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var s,t,n,r;function o(){return n.call(this)||this}s=e.Services||(e.Services={}),t=s.Context||(s.Context={}),n=t.ContextApiBase,__extends(o,n),o.prototype.infosBaseToDonneesLocales=function(e,t,n){return{AuthentificationInfo:{agentConnecte:{referenceExterneAgent:n,adresseMessagerie:null,codeCivilite:null,codeIndicateurFinStructure:null,codeInseePays:null,codeQualiteAgent:null,dateDebutValidite:null,dateDebutValiditeReferentiel:null,dateFinValidite:null,designationLongueAgent:null,designationPosteFonctionnel:null,identifiantInterneSite:null,libelleEds:null,libelleTypeEds:null,LICEE1:null,ligne2Adresse:null,ligne3Adresse:null,ligne4Adresse:null,ligne5Adresse:null,ligne6Adresse:null,NODATP:null,nomFamillePersonnePhysique:null,nomUsagePersonnePhysique:null,numeroEdsSuperieur:null,numeroExterneEds:null,numeroInterneEds:null,prenom:null,referenceExterneEdsRattachemen:null,typeEds:null,typeEdsRattachement:null,typeFonction:null},codeEtablissement:e,numeroStationTravail:t,ENVIRON:null,guichetAgent:null},ParametresComptables:null,ParametresNumerisation:null,ParametresServeurPoste:null}},o.prototype.getFromUrl=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?null:decodeURIComponent(t[1].replace(/\+/g," "))},o.prototype.GetDonneesLocales=function(){var o=this,e=this.getFromUrl("authent");if(e){var t=JSON.parse(e),n=t.codeEtablissement||null,r=t.identifiantPoste||null,i=t.identifiantConnexionAgent||null;if(n&&i&&r)return/([0-9]+)$/.test(i)&&(i=/([0-9]+)$/.exec(i)[0]),s.Promesses.createPromiseSelfResolved(this.infosBaseToDonneesLocales(n,r,i))}return this.libraryManager.Core.sendRequest({url:this.portalServiceParameters.CDNUrl+"/v1/services/config.json",originalResponse:!0}).then(function(e){var t=e.getResponseHeader("X-codeEtablissement")||null,n=e.getResponseHeader("X-identifiantPoste")||null,r=e.getResponseHeader("X-identifiantConnexionAgent")||null;return t&&r&&n?o.infosBaseToDonneesLocales(t,n,r):s.Promesses.createPromiseSelfResolved(null)},function(){return s.Promesses.createPromiseSelfResolved(null)})},o.prototype.ShareProcess=function(e,t){return s.Promesses.promesseTryCatch(function(e){e.resolve()})},o.prototype.RemoveProcess=function(e){return s.Promesses.promesseTryCatch(function(e){e.resolve(null)})},o.prototype.GetInfosUserApi=function(){return s.Promesses.promesseTryCatch(function(e){e.resolve(null)})},r=o,t.ContextApiFullWeb=r}(MyWay=MyWay||{}),function(e){var r,t,n,o;function i(){return n.call(this)||this}r=e.Services||(e.Services={}),t=r.Context||(r.Context={}),n=t.ContextApiBase,__extends(i,n),i.prototype.GetDonneesLocales=function(){return r.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():this.libraryManager.Core.sendRequest({url:r.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/contexte/GetDonneesLocales",contentType:r.ContentTypeEnum.JSON,method:r.MethodEnum.GET,async:!1,cache:!1}).catch(function(e){throw i.logger.error("Erreur de récupération des informations d'authentification de l'agent depuis le service local"),e})},i.prototype.ShareProcess=function(e,t){var n={Id:null,CodeAgent:t,Name:e.displayName,AddedDateAsLong:e.putInWaitTime,SerializedTask:JSON.stringify(e)};return this.libraryManager.Core.sendRequest({url:r.PrivatePortalServiceParameters.Instance().ShareServiceUrl+"/api/Task",method:r.MethodEnum.POST,data:n,withHeaders:!1})},i.prototype.RemoveProcess=function(e){return this.libraryManager.Core.sendRequest({url:r.PrivatePortalServiceParameters.Instance().ShareServiceUrl+"/api/Task?id="+e,method:r.MethodEnum.DELETE,withHeaders:!1}).then(function(e){return JSON.parse(e)})},i.prototype.GetInfosUserApi=function(){return r.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():this.libraryManager.Core.sendRequest({url:r.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/contexte/GetInfosUserPoste",type:"GET",async:!1,method:r.MethodEnum.GET,contentType:r.ContentTypeEnum.JSON,cache:!1})},i.CLASS_NAME="MyWay.Services.Context.ContextApiWindows",i.logger=r.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,t.ContextApiWindows=o}(MyWay=MyWay||{}),function(u){!function(r){r.isMobile=!0;var o=(i.Instance=function(e,t,n,r){return null===i._serviceAgentExtended&&(i._serviceAgentExtended=new a(e,t,n,r)),i._serviceAgentExtended},i.$inject=["$q","instanceLoaderService","$timeout","$rootScope"],i._serviceAgentExtended=null,i);function i(e,t,n,r){this.$q=e,this.instanceLoaderService=t,this.$timeout=n,this.$rootScope=r}r.ServiceAgentMobileProvider=o;var s,a=(s=r.ServiceAgentExtended,__extends(c,s),c.addActionPostInit=function(e){},c.removeActionPostInit=function(t){r.CoreCommon.ArrayUtils.remove(c.actionsPostInit,function(e){return e===t})},c.prototype.init=function(e){var t=this,n=this._$q.defer();return(new r.ServiceManagerExtended).init({IFrameId:null,LogOnUrl:null,OnEvent:null,PortalType:"single",isTotemCapable:!1,ModeVerificationProcessus:u.Services.ModeVerificationProcessus.Aucun,delegationPortail:!1}).finally(function(){return r.ServiceManager.Instance().Initialize()}).finally(function(){var t=[];return c.actionsPostInit.forEach(function(e){t.push(e(r.ServiceManager.Instance().Library))}),r.CoreCommon.ServiceDePromesse.all(t)}).finally(function(){s.prototype.init.call(t,e).then(function(){n.resolve(r.ServiceAgentProvider.Instance(t._$q,t._instanceLoaderService,t._$timeout,t._$rootScope))},function(e){n.reject(e)})}),n.promise},c.actionsPostInit=[],c);function c(e,t,n,r){var o=s.call(this,e,t,n,r)||this;return o._$q=e,o._instanceLoaderService=t,o._$timeout=n,o._$rootScope=r,o}r.ServiceAgentMobileExtended=a,"undefined"!=typeof angular&&(r.moduleAgent=angular.module("moduleAgent",["ng"]),r.moduleAgent.service("instanceLoaderService",r.InstanceLoaderService),r.moduleAgent.provider("serviceAgent",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return o.Instance(e,t,n,r)}]}),r.moduleAgent.provider("serviceAgentExtended",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return o.Instance(e,t,n,r)}]}),r.moduleAgent.provider("serviceAgentProvider",function(){this.$get=["$q","instanceLoaderService","$timeout","$rootScope",function(e,t,n,r){return o.Instance(e,t,n,r)}]}))}(u.Services||(u.Services={}))}(MyWay=MyWay||{}),function(e){var o;(function(e){var t=(n.prototype._setMessages=function(){o.Storage.InteropMessageBusStorage&&o.Storage.InteropMessageBusStorage.Get()?this._messages=JSON.parse(o.Storage.InteropMessageBusStorage.Get()):this._messages=[]},n.prototype._init=function(){this._messages=[],o.Storage.InteropMessageBusStorage.Set(JSON.stringify(this._messages)),this.Notify()},n.prototype.Notify=function(){this.StorageNotification&&this.StorageNotification.saveValue(Math.random())},n.prototype.Add=function(e){this._setMessages(),this._messages.push(e),o.Storage.InteropMessageBusStorage.Set(JSON.stringify(this._messages)),this.Notify()},n.prototype.SpliceByStepId=function(e){this._setMessages();for(var t=[],n=this._messages.length-1;0<=n;n--)this._messages[n].ProcessStepId==e&&t.push(this._messages.splice(n)[0]);return o.Storage.InteropMessageBusStorage.Set(JSON.stringify(this._messages)),0<t.length&&this.Notify(),t},n.prototype.Clear=function(){o.Storage.InteropMessageBusStorage.Set(""),this.Notify(),this._init()},Object.defineProperty(n.prototype,"Messages",{get:function(){return this._setMessages(),this._messages},enumerable:!0,configurable:!0}),n);function n(){this.StorageNotification=null,this._setMessages(),this._messages||this._init()}function r(){}e.InteropMessageBus=t,e.InteropMessageEvent=r})((o=e.Services||(e.Services={})).Interop||(o.Interop={}))}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.PhantomAgent,"Dates",{get:function(){return this._serviceManager.Library.Dates}})}(MyWay=MyWay||{}),function(e){var t,i,s,n;function r(){return s.call(this,t.Components.ComponentType.BaseDeDonnees)||this}t=e.Services||(e.Services={}),i=t.BaseDeDonnees||(t.BaseDeDonnees={}),s=t.Components.ComponentManagerBase,__extends(r,s),r.prototype.init=function(e,t,n,r){var o=this;return s.prototype.init.call(this,e,t,n,r).then(function(){o.dbs={}})},r.prototype.enregistrerDB=function(e,t){this.dbs[e]=t},r.prototype.disposeDB=function(e){delete this.dbs[e]},r.prototype.getBases=function(){function e(e){var t=o.dbs[e],n={nom:e,implementation:null,version:t.version,tables:[]};switch(t.implementation){case i.BaseDeDonneesImplementation.INDEXEDDB:n.implementation=i.messages.TYPE_BASE.INDEXEDDB;break;case i.BaseDeDonneesImplementation.LOCALSTORAGE:n.implementation=i.messages.TYPE_BASE.LOCALSTORAGE;break;case i.BaseDeDonneesImplementation.MEMORY:n.implementation=i.messages.TYPE_BASE.MEMORY}t.getTables().forEach(function(e){n.tables.push({nom:e})}),r.push(n)}var r=[],o=this;for(var t in this.dbs)e(t);return this.library.Core.createPromiseSelfResolved(r)},r.prototype.getBase=function(e){return this.dbs[e.nom]},n=r,i.BaseDeDonneesManager=n,t.Components.RegistryManager.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var n,t;n=e.Services||(e.Services={}),function(s){s.indexeddbIsSupported=!1;var e=(t.testImplementationIndexeddb=function(t){return void 0===t&&(t=!1),n.CoreCommon.promesseTryCatch(function(i){function e(o){void 0===o&&(o=!1);var t=window.indexedDB.deleteDatabase("testIndexeddb");t.onsuccess=function(){var e=indexedDB.open("testIndexeddb",1);e.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore("one",{keyPath:"key"}),t.createObjectStore("two",{keyPath:"key"})},e.onerror=function(){},e.onsuccess=function(e){var t,n=e.target.result;try{t=n.transaction(["one","two"],"readwrite")}catch(e){return s.indexeddbIsSupported=!1,void i.resolve(!1)}t.oncomplete=function(e){n.close(),s.indexeddbIsSupported=!o||s.indexeddbIsSupported,i.resolve(!0)};var r=t.objectStore("two").put({key:(new Date).valueOf()});r.onsuccess=function(e){},r.onerror=function(){}},t.onerror=function(){i.reject(new n.Erreur("Impossible de supprimer la base de test qui sert de support au test d'implémentation d'indexeddb"))}}}t?e(t):null===s.indexeddbIsSupported?"undefined"==typeof indexedDB?(s.indexeddbIsSupported=!1,i.resolve(!1)):null===window.indexedDB?(s.indexeddbIsSupported=!1,i.resolve(!1)):"undefined"==typeof IDBKeyRange?(s.indexeddbIsSupported=!1,i.resolve(!1)):e():i.resolve(s.indexeddbIsSupported)})},t.CLASS_NAME="MyWay.Services.BaseDeDonnees.Generique.Factory",t.logger=n.Loggers.LoggerFactory.INSTANCE.getClass(t.CLASS_NAME),t);function t(){}s.Factory=e}((t=n.BaseDeDonnees||(n.BaseDeDonnees={})).Generique||(t.Generique={}))}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.BaseDeDonnees||(t.BaseDeDonnees={}),(r=n.BaseDeDonneesImplementation||(n.BaseDeDonneesImplementation={}))[r.INDEXEDDB=0]="INDEXEDDB",r[r.LOCALSTORAGE=1]="LOCALSTORAGE",r[r.MEMORY=2]="MEMORY"}(MyWay=MyWay||{}),function(e){var r;(function(t){var p,e;(e=p=p||{})[e.DB_NOT_EXISTS=0]="DB_NOT_EXISTS",e[e.DB_IS_OK=1]="DB_IS_OK",e[e.DB_IS_WRONG=2]="DB_IS_WRONG";var n=(i.testEtCorrectionSchema=function(){return r.CoreCommon.promesseTryCatch(function(e){if(i.isVerified)e.resolve();else if(i.defersEnAttente.push(e),!i.estEnCours){i.estEnCours=!0;var o=function(t){t?i.defersEnAttente.forEach(function(e){e.reject(t)}):i.defersEnAttente.forEach(function(e){e.resolve()})};t.Generique.Factory.testImplementationIndexeddb().then(function(e){if(!e)return i.isVerified=!0,void o();var t=[];t.push(i.testDB("DBTraceSuivi",["tracessuivi"])),t.push(i.testDB("DonneesDelocalisees",["storeTDT","storeData"])),t.push(i.testDB("Trace",["storeTrace"])),t.push(i.testDB("_base_technique_",["referentiel"])),r.CoreCommon.ServiceDePromesse.all(t).then(function(e){var t=!0;if(e.every(function(e){return e.status===p.DB_IS_WRONG&&(t=!1),t}),t)console.log("Indexeddb OK"),i.isVerified=!0,o();else{console.log("Indexeddb WRONG, fait un reset");var n=0,r=0;e.forEach(function(e){e.status!==p.DB_NOT_EXISTS&&(r++,window.indexedDB.deleteDatabase(e.db).onsuccess=function(){r<=++n&&(console.log("Indexeddb WRONG, reset terminé"),i.isVerified=!0,o())})}),0===r&&(console.log("Indexeddb WRONG, reset terminé"),i.isVerified=!0,o())}},function(e){console.error("Erreur lors de la vérification d'indexeddb!"),console.error(e),i.isVerified=!0,o(e)})})}})},i.testDB=function(u,l){return r.CoreCommon.promesseTryCatch(function(s){var a=window.indexedDB.open(u),c=!0;a.onupgradeneeded=function(){c=!1},a.onsuccess=function(){var e=a.result;if(!c)return e.close(),window.indexedDB.deleteDatabase(u),void s.resolve({db:u,status:p.DB_NOT_EXISTS});var t=e.objectStoreNames,n=[],r=[];l.forEach(function(e){r.push({table:e,estTrouve:!1})});for(var o=0;o<t.length;o++)n.push(t.item(o));e.close(),n.forEach(function(t){r.every(function(e){return t!==e.table||!(e.estTrouve=!0)})});var i=!0;r.every(function(e){return e.estTrouve||(i=!1),i}),s.resolve({db:u,status:i?p.DB_IS_OK:p.DB_IS_WRONG})}})},i.isVerified=!1,i.estEnCours=!1,i.defersEnAttente=[],i);function i(){}t.VerificationSchemaIndexeddb=n})((r=e.Services||(e.Services={})).BaseDeDonnees||(r.BaseDeDonnees={}))}(MyWay=MyWay||{}),function(e){var t,i,s,n;function r(){var r=s.call(this,t.Components.ComponentType.Persistence)||this;return r.CURRENT_ID_EMETTEUR=null,r.keysWatched={},r.listener=function(e){var t=e.key;if(r.keysWatched[t]){var n=JSON.parse(e.newValue);n.emetteur!==r.CURRENT_ID_EMETTEUR&&r.keysWatched[t].forEach(function(e){e.onEvent(n.data)})}},r}t=e.Services||(e.Services={}),i=t.Persistence||(t.Persistence={}),s=t.Components.ComponentManagerBase,__extends(r,s),r.prototype.init=function(e,t,n,r){var o=this;return this.CURRENT_ID_EMETTEUR=Math.random().toString(),s.prototype.init.call(this,e,t,n,r).then(function(){return o.initialize()})},r.prototype.initialize=function(){window.addEventListener("storage",this.listener)},r.prototype.dispose=function(){return window.removeEventListener("storage",this.listener),s.prototype.dispose.call(this)},r.prototype.addStorage=function(t,e){var n=this,r=new i.StorageInstance(t,function(){n.removeListener(t,r)},function(e){n.addElementToStore(t,e)},e),o=this.keysWatched[t];return o||(o=[],this.keysWatched[t]=o),o.push(r),r},r.prototype.removeListener=function(e,t){if(this.keysWatched[e]){for(var n=this.keysWatched[e].length,r=!1,o=0;o<n-1;o++)r||this.keysWatched[e][o]!==t||(r=!0),r&&(this.keysWatched[e][o]=this.keysWatched[e][o+1]);!r&&this.keysWatched[e][n-1]!==t||this.keysWatched[e].length--}},r.prototype.addElementToStore=function(e,t){var n={data:t,emetteur:this.CURRENT_ID_EMETTEUR};window.localStorage.setItem(e,JSON.stringify(n))},n=r,i.PersistenceManager=n,t.Components.RegistryManager.getInstance().register(n)}(MyWay=MyWay||{}),function(c){var e,t,u;e=c.Test||(c.Test={}),t=e.V1||(e.V1={}),(u=t.Services||(t.Services={})).declareManagerExtendedATester=function(a){var t=[];return{execute:function(){describe("Lorsque j'utilise le "+a.className,function(){t.forEach(function(e){e()})})},testManagerExtended:function(s){var e=it;!0===s.only&&(e=fit),t.push(function(){e("Si j'appelle la méthode "+s.method+" correctement j'ai bien le comportement attendu",function(e){s.hasResult;var t,n={},r=new a.classManagerExtended,o=!1,i=void 0;n[s.managerMethod]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o=!0,i=e,s.managerHasResult?s.managerResult:void 0},t=u.generateEmptyLibraryCommon(),c.Services.CoreCommon.getPromesseSelfResoved().then(function(){return a.beforeEach?a.beforeEach(n,t):void 0}).then(function(){return s.beforeTest?s.beforeTest(n,t):void 0}).then(function(){return r.init(n,t)}).then(function(){return s.hasParam?r[s.method].apply(r,s.params):r[s.method].call(r)}).then(function(e){if(expect(o).toBe(!0,"La méthode doit être appelée"),s.managerHasParam?expect(i).toEqual(s.managerParams,"Vérification des paramètres passés au manager"):expect(i).toEqual([],"Vérification des paramètres passés au manager"),s.hasResult)switch(s.resultType){case u.TestMode.StrictEquals:expect(e).toBe(s.result,"Vérification du résultat retourné");break;case u.TestMode.DeepEquals:default:expect(e).toEqual(s.result,"Vérification du résultat retourné")}}).finally(function(){return s.afterTest?s.afterTest(n,t):void 0}).finally(function(){return a.afterEach?a.afterEach(n,t):void 0}).finally(e)})}),t.push(function(){e("Si j'appelle la méthode "+s.method+" de manière erronée j'ai bien une erreur qui me remonte",function(e){var t,n={},r=new a.classManagerExtended,o=!1,i=void 0;n[s.managerMethod]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw o=!0,i=e,new c.Services.Erreur("Message d'erreur de test")},t=u.generateEmptyLibraryCommon(),c.Services.CoreCommon.getPromesseSelfResoved().then(function(){return a.beforeEach?a.beforeEach(n,t):void 0}).then(function(){return s.beforeTest?s.beforeTest(n,t):void 0}).then(function(){return r.init(n,t)}).then(function(){return s.hasParam?r[s.method].apply(r,s.params):r[s.method].call(r)}).catch(function(e){expect(o).toBe(!0,"La méthode doit être appelée"),s.managerHasParam?expect(i).toEqual(s.managerParams,"Vérification des paramètres passés à la méthode"):expect(i).toEqual([],"Vérification des paramètres passés à la méthode"),expect(e.codeLibelle).toBe("Message d'erreur de test","Vérification de l'erreur retournée par la méthode")}).finally(function(){return s.afterTest?s.afterTest(n,t):void 0}).finally(function(){return a.afterEach?a.afterEach(n,t):void 0}).finally(e)})})}}}}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(u){var e,t,l,p;function n(){}e=u.Test||(u.Test={}),t=e.V1||(e.V1={}),l=t.Services||(t.Services={}),n.getInstance=function(){return null===n.INSTANCE&&(n.INSTANCE=new n).init(),n.INSTANCE},n.prototype.init=function(){var n=this;this.componentsByKey={},u.Services.Components.RegistryManagerMessage.getInstance().components.forEach(function(e){var t=new e;n.componentsByKey[t.name.toString()]=e})},n.prototype.getClass=function(e){return this.componentsByKey[e.toString()]},n.INSTANCE=null,p=n,l.declareExterieurVersManagerMessageATester=function(c){var e=[];return e.push(function(){var e=it;!0===c.onlyBadMessageTest&&(e=fit),e("Si j'envoie un message erroné (en l'occurence MAUVAIS_MESSAGE_POUR_TEST) au manager-message j'ai bien le comportement attendu",function(e){l.generateMessageService();var t=p.getInstance().getClass(c.component);if(t){expect(!0).toBe(!0,"La class manager-message du type "+c.component+" est enregistrée auprès du RegistryManagerMessage");var n=new t,r={},o=l.generateEmptyLibraryManager();return u.Services.CoreCommon.getPromesseSelfResoved().then(function(){if(c.beforeEach){var e={instance:n};return c.beforeEach(e)}}).then(function(){return n.init(r,o)}).then(function(){return n.reception({subject:"MAUVAIS_MESSAGE_POUR_TEST",message:null,iframe:null})}).then(function(e){fail("L'envoi d'un message erroné n'a pas renvoyé une erreur!")},function(e){expect(e.codeLibelle).toBe("Subject MAUVAIS_MESSAGE_POUR_TEST not implemented on "+n.name+" manager-message","Une erreur a bien été générée suite à l'envoi d'un message erroné")}).finally(e)}fail("La class manager-message du type "+c.component+" n'est pas enregistrée auprès du RegistryManagerMessage")})}),{execute:function(){describe("Lorsque j'utilise le manager-message "+c.classManagerName,function(){e.forEach(function(e){e()})})},test:function(a){var t="";t="Si j'envoie le message "+a.typeMessage+" de l'agent correctement j'ai bien le comportement attendu",a.testMethodSuffix&&(t+=" [cas : "+a.testMethodSuffix+"]"),e.push(function(){var e=it;!0===a.only&&(e=fit),e(t,function(e){l.generateMessageService();var t=p.getInstance().getClass(c.component);if(t){expect(!0).toBe(!0,"La class manager-message du type "+c.component+" est enregistrée auprès du RegistryManagerMessage");var n=new t,r={},o=l.generateEmptyLibraryManager(),i=!1,s=void 0;return r[a.managerMethod]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i=!0,s=e,a.managerHasMethodResponse?a.managerMethodResponse:void 0},u.Services.CoreCommon.getPromesseSelfResoved().then(function(){if(c.beforeEach){var e={instance:n};return c.beforeEach(e)}}).then(function(){var e={instance:n};return a.before?a.before(e):void 0}).then(function(){return n.init(r,o)}).then(function(){var e={subject:a.typeMessage,message:null,iframe:a.requestMessageIframe};return a.hasRequestMessage&&(e.message=a.requestMessage),n.reception(e)}).then(function(e){if(i?expect(!0).toBe(!0,"Le manager a été appelé!"):fail("Le manager n'a pas été appelé!"),a.managerHasMethodParams?expect(s).toEqual(a.managerMethodParams,"Vérification des paramètres passés à la méthode du manager"):expect(s).toEqual([],"Vérification des paramètres passés à la méthode du manager"),a.hasResponseMessage)switch(a.responseMessageTestMode){case l.TestMode.NoCheck:expect(!0).toBe(!0,"Vérification du message répondu par le manager-message qui est envoyé à l'agent [test ignoré]");break;case l.TestMode.StrictEquals:expect(e).toBe(a.responseMessage,"Vérification du message répondu par le manager-message qui est envoyé à l'agent");break;case l.TestMode.DeepEquals:default:expect(e).toEqual(a.responseMessage,"Vérification du message répondu par le manager-message qui est envoyé à l'agent")}else expect(e).toBe(void 0,"Vérification du message répondu par le manager-message qui est envoyé à l'agent")},function(e){fail(e),fail("Une erreur s'est produite! Details : "+e.codeLibelle),console.error(e)}).finally(e)}fail("La class manager-message du type "+c.component+" n'est pas enregistrée auprès du RegistryManagerMessage")})}),e.push(function(){t="Si j'envoie le message "+a.typeMessage+" de l'agent de manière incorrecte j'ai bien une erreur qui remonte",a.testMethodSuffix&&(t+=" [cas : "+a.testMethodSuffix+"]"),it(t,function(e){var t=p.getInstance().getClass(c.component);if(t){expect(!0).toBe(!0,"La class manager-message du type "+c.component+" est enregistrée auprès du RegistryManagerMessage");var n=new t,r={},o=l.generateEmptyLibraryManager(),i=!1,s=null;r[a.managerMethod]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(i=!0,s=e,a.managerMethodeThrowError)throw a.managerMethodeError;return a.managerMethodeError},u.Services.CoreCommon.getPromesseSelfResoved().then(function(){if(c.beforeEach){var e={instance:n};return c.beforeEach(e)}}).then(function(){var e={instance:n};return a.before?a.before(e):void 0}).then(function(){return n.init(r,o)}).then(function(){var e={subject:a.typeMessage,message:null,iframe:a.requestMessageIframe};return a.hasRequestMessage&&(e.message=a.requestMessage),n.reception(e)}).then(function(e){fail("Une erreur aurait dû se produire!")},function(e){i?expect(!0).toBe(!0,"Le manager a été appelé!"):fail("Le manager n'a pas été appelé!"),a.managerHasMethodParams?expect(s).toEqual(a.managerMethodParams,"Vérification des paramètres passés à la méthode du manager"):expect(s).toEqual([],"Vérification des paramètres passés à la méthode du manager"),expect(e.codeLibelle).toBe(a.responseMessageErreur,"Vérification de l'erreur par le manager-message")}).finally(e)}else fail("La class manager-message du type "+c.component+" n'est pas enregistrée auprès du RegistryManagerMessage")})})}}}}(MyWay=MyWay||{}),function(e){var n,t,o,r;function i(){var e=o.call(this,n.Components.ComponentType.JAB)||this;return e.api=null,e}n=e.Services||(e.Services={}),t=n.JAB||(n.JAB={}),o=n.Components.ComponentManagerBase,__extends(i,o),i.prototype.init=function(e,t,n,r){return this.api=r,o.prototype.init.call(this,e,t,n,r)},i.prototype.enregistrer=function(t){return this.api.enregistrer(t).then(function(e){return n.Loggers.FLASH.INSTANCE.setValue("details",t),i.logger.debug("JAB Enregister Success"),e},function(e){throw n.Loggers.FLASH.INSTANCE.setValue("details",t),i.logger.error("JAB Enregister Failed - %1",JSON.stringify(e)),e})},i.CLASS_NAME="MyWay.Services.JAB.JABManager",i.logger=n.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),r=i,t.JABManager=r,n.Components.RegistryManager.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var n,t,o,r;function i(){var e=o.call(this,n.Components.ComponentType.TraitementNsdk)||this;return e.api=null,e}n=e.Services||(e.Services={}),t=n.TraitementNsdk||(n.TraitementNsdk={}),o=n.Components.ComponentManagerBase,__extends(i,o),i.prototype.init=function(e,t,n,r){return this.api=r,o.prototype.init.call(this,e,t,n,r)},i.prototype.Lancer=function(e,t){return n.CoreCommon.ServiceDePromesse.defer(),this.api.lancer(e,t).then(function(e){return i.logger.debug("Lancement du traitement NSDK ok - %1",e),e},function(e){throw i.logger.error("Lancement du traitement NSDK échoué - %1",JSON.stringify(e)),e})},i.CLASS_NAME="MyWay.Services.TraitementNsdk.TraitementNsdkManager",i.logger=n.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),r=i,t.TraitementNsdkManager=r,n.Components.RegistryManager.getInstance().register(r)}(MyWay=MyWay||{}),function(r){var o,i,s,e;function t(){var e=s.call(this,o.Components.ComponentType.Acquisition)||this;return e.defers={},e}o=r.Services||(r.Services={}),i=o.Acquisition||(o.Acquisition={}),s=o.Components.ComponentAgentBase,__extends(t,s),t.prototype.appelRADLAD=function(e,t){return this.sendMessage(i.Messages.AcquisitionMessageSubject.AppelRADLAD,{fileInfos:e,params:t})},t.prototype.convertFileToImg=function(e,t){return void 0===t&&(t=null),null===t&&(t={dpi:300,quality:90,thumbQuality:30}),this.sendMessage(i.Messages.AcquisitionMessageSubject.ConvertFileToImg,{fileInfo:e,params:t})},t.prototype.mergerEtArchiver=function(e,t){return this.sendMessage(i.Messages.AcquisitionMessageSubject.MergerEtArchiver,{fileInfos:e,putDocumentInput:t})},t.prototype.mergerEtUploader=function(e){return this.sendMessage(i.Messages.AcquisitionMessageSubject.MergerEtUploader,{fileInfos:e})},t.prototype.convertBase64ToBin=function(e){return this.sendMessage(i.Messages.AcquisitionMessageSubject.ConvertBase64ToBin,{urls:e})},t.prototype.purge=function(e){return void 0===e&&(e=8),this.sendMessage(i.Messages.AcquisitionMessageSubject.Purge,{hour:e})},t.prototype.fermetureSpiFactory=function(){return this.sendMessage(i.Messages.AcquisitionMessageSubject.FermetureSpiFactory,{})},t.prototype.setConfigurationScanner=function(e){return this.sendMessage(i.Messages.AcquisitionMessageSubject.SetConfigurationScanner,{typeScanner:e})},t.prototype.mergeAndOpenPDF=function(e){var t=this;return this.sendMessage(i.Messages.AcquisitionMessageSubject.MergeAndOpenPDF,{params:e}).then(function(e){return{guid:e,promise:t.getProcessingTask(e)}},function(e){throw e})},t.prototype.recupereListeDocumentGED=function(e,t){return this.sendMessage(i.Messages.AcquisitionMessageSubject.RecupereListeDocumentGED,{params:e,formatResultat:t}).catch(function(e){throw e})},t.prototype.ouvrirListeDocumentGED=function(e,t,n){return this.sendMessage(i.Messages.AcquisitionMessageSubject.OuvrirListeDocumentGED,{params:e,formatResultat:t,formatOuverture:n}).catch(function(e){throw e})},t.prototype.getDocumentGedAndOpen=function(e){var t=this;return this.sendMessage(i.Messages.AcquisitionMessageSubject.GetDocumentGEDAndOpen,{params:e}).then(function(e){return{guid:e,promise:t.getProcessingTask(e)}},function(e){throw e})},t.prototype.getProcessingTask=function(t){var n=this;return this.defers[t]?this.defers[t].promise:o.Promesses.promesseTryCatch(function(e){n.defers[t]=e,n.sendMessage(i.Messages.AcquisitionMessageSubject.GetProcessingTask,{guid:t})})},t.prototype.getDocumentGEDAndSave=function(e){return this.sendMessage(i.Messages.AcquisitionMessageSubject.GetDocumentGEDAndSave,{params:e})},t.prototype.getListeScanner=function(){return this.sendMessage(i.Messages.AcquisitionMessageSubject.GetListeScanner,{})},t.prototype.isPrisEnMainADistance=function(){return this.sendMessage(i.Messages.AcquisitionMessageSubject.IsPrisEnMainADistance,{})},t.prototype.getDocumentGedSaveAtAndOpen=function(e){return this.sendMessage(i.Messages.AcquisitionMessageSubject.GetDocumentGEDAtAndOpen,{params:e}).catch(function(e){throw e})},t.prototype.uploadDocumentFrom=function(e){return this.sendMessage(i.Messages.AcquisitionMessageSubject.UploadDocumentFrom,{cheminDuFichierSurLePoste:e}).catch(function(e){throw e})},t.prototype.reception=function(e){if(e.subject!==i.Messages.AcquisitionMessageSubject.ChangeState)return s.prototype.reception.call(this,e);var t=e.message;if(t.state===i.Messages.END_STATE)return this.defers[t.guid].resolve(t),delete this.defers[t.guid],o.Promesses.createPromiseSelfResolved();if(t.state!==i.Messages.ERROR)return this.defers[t.guid].notify(t),o.Promesses.createPromiseSelfResolved();var n=new r.Services.Erreur(t.detail);return this.defers[t.guid].reject(n),delete this.defers[t.guid],o.Promesses.createPromiseSelfError(n)},e=t,i.AcquisitionAgent=e,o.Components.RegistryAgent.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Communication)||this}t=e.Services||(e.Services={}),n=t.Communication||(t.Communication={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.envoyerMail=function(e){return this.sendMessage(n.CommunicationMessageSubject.EnvoyerMail,{mail:e})},i.prototype.declencherAppel=function(e){return this.sendMessage(n.CommunicationMessageSubject.DeclencherAppel,{call:e})},i.prototype.raccrocherAppel=function(){return this.sendMessage(n.CommunicationMessageSubject.RaccrocherAppel,{})},o=i,n.CommunicationAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var r,t,n,o;function i(){var e=n.call(this,r.Components.ComponentType.ConfigurationPoste)||this;return e.urlServiceRest=r.PrivatePortalServiceParameters.Instance().ConfigurationPosteUrl,e}r=e.Services||(e.Services={}),t=r.ConfigurationPoste||(r.ConfigurationPoste={}),n=r.Components.ComponentApiBase,__extends(i,n),i.prototype.getConfigurationPoste=function(e){var t=this,n=this.urlServiceRest+"/"+(e.dateConfig?e.dateConfig.toString():"")+"?computer="+e.poste+"&establishment="+e.etablissement;return this.libraryManager.Core.sendRequest({withHeaders:!0,url:n,method:r.MethodEnum.GET,originalResponse:!0}).then(function(e){switch(e.status){case 200:return i.loggerConfigurationPosteApi.debug("Send request getConfigurationPoste Successed - status 200"),t.libraryManager.Core.createPromiseSelfResolved(JSON.parse(e.responseText));case 204:return i.loggerConfigurationPosteApi.debug("Send request getConfigurationPoste Successed - status 204"),t.libraryManager.Core.createPromiseSelfResolved(null);default:throw new r.Erreur("SendRequest getConfigurationPoste status incorrect ",["Status: "+e.status])}},function(e){throw i.loggerConfigurationPosteApi.error("Send request getConfigurationPoste Failed -  %1",JSON.stringify(e)),e})},i.CLASS_NAME_BASE="MyWay.Services.ConfigurationPoste.ConfigurationPosteApi",i.loggerConfigurationPosteApi=r.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME_BASE),o=i,t.ConfigurationPosteApi=o,r.Components.RegistryApi.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){return i.call(this,t.Components.ComponentType.ContexteClient)||this}t=e.Services||(e.Services={}),o=t.ContexteClient||(t.ContexteClient={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?e.InteropAppliBancaire?this.api=new o.ContexteClientApiPetra:this.api=new o.ContexteClientApiWindows:this.api=new o.ContexteClientApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.initApi(t,n)})},r.prototype.initApi=function(e,t){return this.api.initApi(e,t)},r.prototype.setContexteClientNSDK=function(e,t){return this.api.setContexteClientNSDK(e,t)},r.prototype.getContexteClientPCM=function(){return this.api.getContexteClientPCM()},n=r,o.ContexteClientApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){this.libraryManager=null}t=e.Services||(e.Services={}),n=t.ContexteClient||(t.ContexteClient={}),o.prototype.initApi=function(e,t){return this.libraryManager=e,this.libraryManager.Core.getPromesseSelfResoved()},o.prototype.setContexteClientNSDK=function(e,t){return this.libraryManager.Core.createPromiseSelfResolved(!1)},o.prototype.getContexteClientPCM=function(){return this.libraryManager.Core.createPromiseSelfResolved(null)},r=o,n.ContexteClientApiFullWeb=r}(MyWay=MyWay||{}),function(e){var n,r,t;function o(){this.libraryManager=null,this.privatePortalServiceParameters=null}n=e.Services||(e.Services={}),r=n.ContexteClient||(n.ContexteClient={}),o.prototype.initApi=function(e,t){return this.libraryManager=e,this.privatePortalServiceParameters=t.privatePortalServiceParameters,this.libraryManager.Core.getPromesseSelfResoved()},o.prototype.setContexteClientNSDK=function(e,t){switch(t[r.ContexteClientStatusFlag.RELOAD_FLAG_NAME]){case r.ContexteClientStatusFlag.RELOAD_FLAG_VALUE_NONE:return this.libraryManager.Core.createPromiseSelfResolved(!0);case r.ContexteClientStatusFlag.RELOAD_FLAG_VALUE_RELOAD:return this._reloadNSDK(e);case r.ContexteClientStatusFlag.RELOAD_FLAG_VALUE_SYNCHRO:default:return this._setContexteClientNSDK(e,t)}},o.prototype.getContexteClientPCM=function(){var o=[];return this.libraryManager.Core.sendRequest({url:this.privatePortalServiceParameters.LocalServiceUrl+"/contexte/GetListeClientIdentifiesPCM",method:n.MethodEnum.GET,contentType:n.ContentTypeEnum.JSON}).then(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];o.push(r.NumeroPersonne)}return o}).catch(function(){return o})},o.prototype._setContexteClientNSDK=function(e,t){return this.libraryManager.Core.sendRequest({url:this.privatePortalServiceParameters.LocalServiceUrl+"/contexte/SetContexteClientNSDK?numeroClient="+e,method:n.MethodEnum.POST,contentType:n.ContentTypeEnum.JSON,data:t}).then(function(){return!0})},o.prototype._reloadNSDK=function(e){return this.libraryManager.Core.sendRequest({url:this.privatePortalServiceParameters.LocalServiceUrl+"/contexte/DemandeMAJSyntheseNSDK?numeroClient="+e,method:n.MethodEnum.POST}).then(function(){return!0})},t=o,r.ContexteClientApiPetra=t}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){this.libraryManager=null}t=e.Services||(e.Services={}),n=t.ContexteClient||(t.ContexteClient={}),o.prototype.initApi=function(e,t){return this.libraryManager=e,this.libraryManager.Core.getPromesseSelfResoved()},o.prototype.setContexteClientNSDK=function(e,t){return this.libraryManager.Core.createPromiseSelfResolved(!1)},o.prototype.getContexteClientPCM=function(){return this.libraryManager.Core.createPromiseSelfResolved(null)},r=o,n.ContexteClientApiWindows=r}(MyWay=MyWay||{}),function(e){var t,i,n,r;function o(){return n.call(this,t.Components.ComponentType.Interop)||this}t=e.Services||(e.Services={}),i=t.Interop||(t.Interop={}),n=t.Components.ComponentAgentBase,__extends(o,n),o.prototype.lireFichier=function(e){var t={nomFichier:e};return this.sendMessage(i.Messages.InteropMessageSubject.LireFichier,t).then(function(e){return e.data})},o.prototype.ecrireFichier=function(e,t,n,r){var o={nomFichier:e,fluxdonnees:t,ajouter:n,creeDir:r};return this.sendMessage(i.Messages.InteropMessageSubject.EcrireFichier,o).then(function(e){return e.data})},o.prototype.triggerNotifications=function(){return this.sendMessage(i.Messages.InteropMessageSubject.TriggerNotifications)},r=o,i.InteropAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var o,t,n;function r(){this.libraryManager=null}o=e.Services||(e.Services={}),t=o.Acquisition||(o.Acquisition={}),r.prototype.initApi=function(e){this.libraryManager=e},r.prototype.recuperationImageKofax=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.creerImagesBitonales=function(e,t){var n=o.CoreCommon.ServiceDePromesse.defer();return n.resolve(),n.promise},r.prototype.traitementRADLAD=function(e,t,n){var r=o.CoreCommon.ServiceDePromesse.defer();return r.resolve(),r.promise},r.prototype.convertFileToImg=function(e,t){var n=o.CoreCommon.ServiceDePromesse.defer();return n.resolve(),n.promise},r.prototype.mergerPdfs=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.mergerDocuments=function(e,t){var n=o.CoreCommon.ServiceDePromesse.defer();return n.resolve(),n.promise},r.prototype.manipulerArchives=function(e,t,n){var r=o.CoreCommon.ServiceDePromesse.defer();return r.resolve(),r.promise},r.prototype.archiver=function(e,t){var n=o.CoreCommon.ServiceDePromesse.defer();return n.resolve(),n.promise},r.prototype.convertBase64ToBin=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.purge=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.fermetureSpiFactory=function(){var e=o.CoreCommon.ServiceDePromesse.defer();return e.resolve(),e.promise},r.prototype.setConfigurationScanner=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.retrieveGedDocument=function(e,t,n){var r=o.CoreCommon.ServiceDePromesse.defer();return r.resolve(),r.promise},r.prototype.saveDocument=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.saveDocumentGedAtAndOpen=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.uploadDocumentFrom=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.openDocument=function(e){var t=o.CoreCommon.ServiceDePromesse.defer();return t.resolve(),t.promise},r.prototype.isPrisEnMainADistance=function(){var e=o.CoreCommon.ServiceDePromesse.defer();return e.resolve(),e.promise},r.prototype.getListeScanner=function(){var e=o.CoreCommon.ServiceDePromesse.defer();return e.resolve(),e.promise},n=r,t.AcquisitionApiBase=n}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Acquisition)||this;return e.api=null,e}t=e.Services||(e.Services={}),o=t.Acquisition||(t.Acquisition={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?this.api=new o.AcquisitionApiWindows:this.api=new o.AcquisitionApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.api.initApi(t)})},r.prototype.initApi=function(e){},r.prototype.recuperationImageKofax=function(e){return this.api.recuperationImageKofax(e)},r.prototype.creerImagesBitonales=function(e,t){return this.api.creerImagesBitonales(e,t)},r.prototype.traitementRADLAD=function(e,t,n){return this.api.traitementRADLAD(e,t,n)},r.prototype.convertFileToImg=function(e,t){return this.api.convertFileToImg(e,t)},r.prototype.mergerPdfs=function(e){return this.api.mergerPdfs(e)},r.prototype.mergerDocuments=function(e,t){return this.api.mergerDocuments(e,t)},r.prototype.manipulerArchives=function(e,t,n){return this.api.manipulerArchives(e,t,n)},r.prototype.archiver=function(e,t){return this.api.archiver(e,t)},r.prototype.convertBase64ToBin=function(e){return this.api.convertBase64ToBin(e)},r.prototype.purge=function(e){return this.api.purge(e)},r.prototype.fermetureSpiFactory=function(){return this.api.fermetureSpiFactory()},r.prototype.setConfigurationScanner=function(e){return this.api.setConfigurationScanner(e)},r.prototype.retrieveGedDocument=function(e,t,n){return this.api.retrieveGedDocument(e,t,n)},r.prototype.saveDocument=function(e){return this.api.saveDocument(e)},r.prototype.saveDocumentGedAtAndOpen=function(e){return this.api.saveDocumentGedAtAndOpen(e)},r.prototype.uploadDocumentFrom=function(e){return this.api.uploadDocumentFrom(e)},r.prototype.openDocument=function(e){return this.api.openDocument(e)},r.prototype.isPrisEnMainADistance=function(){return this.api.isPrisEnMainADistance()},r.prototype.getListeScanner=function(){return this.api.getListeScanner()},n=r,o.AcquisitionApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this)||this}t=e.Services||(e.Services={}),n=t.Acquisition||(t.Acquisition={}),r=n.AcquisitionApiBase,__extends(i,r),o=i,n.AcquisitionApiFullWeb=o}(MyWay=MyWay||{}),function(e){var o,t,n,r;function i(){var e=n.call(this)||this;return e._url=o.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/acquisition/",e._RADLADUrl=o.PrivatePortalServiceParameters.Instance().RADLADUrl,e._StockageUrl=o.PrivatePortalServiceParameters.Instance().StockageUrl,e._GedUrl=o.PrivatePortalServiceParameters.Instance().GedUrl,e}o=e.Services||(e.Services={}),t=o.Acquisition||(o.Acquisition={}),n=t.AcquisitionApiBase,__extends(i,n),i.prototype.recuperationImageKofax=function(e){var t={url:this._url+"/RecuperationImageKofax",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify(e),cache:!1};return this.libraryManager.Core.sendRequest(t)},i.prototype.creerImagesBitonales=function(e,t){var n={url:this._url+"/CreerImagesBitonales",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify({base64List:JSON.parse(e),creerImageBitonalParams:t})};return this.libraryManager.Core.sendRequest(n)},i.prototype.traitementRADLAD=function(e,t,n){var r={url:this._RADLADUrl,method:o.MethodEnum.POST,data:{docElect:e,activationVRS:t.activationVRS,activationLAD:t.activationLAD},withHeaders:!0,authentificationInfo:n};return e.forEach(function(e){e.replace(/(?:\r\n|\r|\n)/g,"")}),this.libraryManager.Core.sendRequest(r)},i.prototype.convertFileToImg=function(e,t){var n={url:this._url+"/ConvertFileToImg",method:o.MethodEnum.POST,async:!0,timeout:6e4,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify({fileInfo:e,convertFileParams:t})};return this.libraryManager.Core.sendRequest(n)},i.prototype.mergerPdfs=function(e){var t={url:this._url+"/MergerPdfs",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify(e),timeout:12e4};return this.libraryManager.Core.sendRequest(t)},i.prototype.mergerDocuments=function(e,t){var n={url:this._url+"/MergerDocuments",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify({mergeFileInfo:e,formatResultatMerge:t}),timeout:12e4};return this.libraryManager.Core.sendRequest(n)},i.prototype.manipulerArchives=function(e,t,n){var r={url:this._url+"/ManipulerArchives",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify({mergeFileInfo:e,formatResultatMerge:t,systemeOuvertureArchive:n}),timeout:12e4};return this.libraryManager.Core.sendRequest(r)},i.prototype.archiver=function(e,t){var n={withHeaders:!0,url:this._StockageUrl,method:o.MethodEnum.PUT,data:e,authentificationInfo:t,timeout:12e4};return this.libraryManager.Core.sendRequest(n)},i.prototype.convertBase64ToBin=function(e){var t={url:this._url+"/ConvertBase64ToBin",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify(e)};return this.libraryManager.Core.sendRequest(t)},i.prototype.purge=function(e){var t={url:this._url+"/Purge",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify(e)};return this.libraryManager.Core.sendRequest(t)},i.prototype.fermetureSpiFactory=function(){var e={url:this._url+"/FermetureSpiFactory",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON};return this.libraryManager.Core.sendRequest(e)},i.prototype.setConfigurationScanner=function(e){var t={url:this._url+"/SetConfigurationScanner?typeScanner="+e,method:o.MethodEnum.POST};return this.libraryManager.Core.sendRequest(t)},i.prototype.retrieveGedDocument=function(e,t,n){var r={url:this._GedUrl,method:o.MethodEnum.GET,withHeaders:!0,params:{idDocument:t.id,codeApplication:e,indicateurDocument:!0}};return void 0!==t.nature&&null!==t.nature&&(r.params.codeTypeNatrDoc=t.nature),this.libraryManager.Core.sendRequest(r).catch(function(e){throw e})},i.prototype.saveDocument=function(e){var t={url:this._url+"/SaveDocument",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify(e),timeout:6e4};return this.libraryManager.Core.sendRequest(t)},i.prototype.saveDocumentGedAtAndOpen=function(e){var t={url:this._url+"/SaveDocumentGedAtAndOpen",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify(e),timeout:6e4};return this.libraryManager.Core.sendRequest(t)},i.prototype.uploadDocumentFrom=function(e){var t={url:this._url+"/UploadDocumentFrom",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify(e),timeout:6e4};return this.libraryManager.Core.sendRequest(t)},i.prototype.openDocument=function(e){var t={url:this._url+"/OpenDocument",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON,data:JSON.stringify(e),timeout:6e4};return this.libraryManager.Core.sendRequest(t)},i.prototype.getListeScanner=function(){var e={url:this._url+"/GetListeScanner",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON};return this.libraryManager.Core.sendRequest(e)},i.prototype.isPrisEnMainADistance=function(){var e={url:this._url+"/IsPrisEnMainADistance",method:o.MethodEnum.POST,async:!0,contentType:o.ContentTypeEnum.JSON};return this.libraryManager.Core.sendRequest(e)},r=i,t.AcquisitionApiWindows=r}(MyWay=MyWay||{}),function(e){var p;(function(e){var t;e.URLBASE_CONFIGURATION="ws://126.246.166.113:8000/jms",e.TOPIC_CONFIGURATION_GENERALE="/topic/BGC_CONFIGURATION",(t=e.KaazingCanalType||(e.KaazingCanalType={}))[t.JMS=0]="JMS";var n=(Object.defineProperty(r.prototype,"reader",{get:function(){return this._reader},set:function(e){this._reader=e,this._hasMessage&&this._reader(this._lastMessage)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"close",{get:function(){return this._close},enumerable:!0,configurable:!0}),r);function r(e){var t=this;this._close=e,this._reader=null,this._lastMessage=null,this._hasMessage=!1,this._reader=function(e){t._lastMessage=e,t._hasMessage=!0}}e.CanalControlerReadOnly=n;var o,i,s=(__extends(a,o=n),a);function a(e){var t=o.call(this,e)||this;return t.writer=null,t}e.CanalControler=s,(i=e.InfosAgentType||(e.InfosAgentType={}))[i.CLIENT="CLIENT"]="CLIENT",i[i.ADVISER="ADVISOR"]="ADVISER",i[i.EXPERT="EXPERT"]="EXPERT",i[i.PROSPECT="PROSPECT"]="PROSPECT";var c,u=(c=p.Components.ComponentApiBase,__extends(l,c),l.prototype.connect=function(s,t){var n=this;return p.CoreCommon.promesseTryCatch(function(r){var e=new JmsConnectionFactory(s);if(l.logger.debug("Création de la connexion vers %1",s),s.match("jmssec")){var o=n.generateToken(t);e.getWebSocketFactory().setChallengeHandler(new function(){this.canHandle=function(e){return null!=e&&"token"==e.authenticationScheme.trim().toLowerCase()},this.handle=function(e,t){var n=null;null!=e.location&&null!=o&&(n=new ChallengeResponse("Token "+o,null)),t(n)}})}var i=e.createConnection(function(){l.logger.debug("Connexion OK de %1",s);try{var t=i.getValue(),e=t.createSession(!1,Session.AUTO_ACKNOWLEDGE),n=e.close;e.close=function(e){return n(function(){t.close(e)})},t.start(function(){r.resolve(e)})}catch(e){l.logger.error("Erreur: %1",JSON.pruned(e))}})})},l.prototype.generateToken=function(e){var t=p.CoreCommon.StringUtils.leftPad(e.agentConnecte.referenceExterneAgent,"0",7);return JSON.stringify({login:"agent-S"+t,userid:"agent-S"+t,type:"CLIENT",token:"token",establishment:e.codeEtablissement})},l.CLASS_NAME="MyWay.Services.BriqueCommunication.BriqueCommunicationApi",l.logger=p.Loggers.LoggerFactory.INSTANCE.getClass(l.CLASS_NAME),l);function l(){return c.call(this,p.Components.ComponentType.BriqueCommunication)||this}e.BriqueCommunicationApi=u,p.Components.RegistryApi.getInstance().register(u)})((p=e.Services||(e.Services={})).BriqueCommunication||(p.BriqueCommunication={}))}(MyWay=MyWay||{}),function(r){var o,i,e;function t(){this.libraryManager=null,this._numerotationTelephoniqueUrl=o.PrivatePortalServiceParameters.Instance().NumerotationTelephoniqueUrl}o=r.Services||(r.Services={}),i=o.Communication||(o.Communication={}),t.prototype.initApi=function(e){this.libraryManager=e},t.prototype.declencherAppel=function(e,t){if(e.numeroDestinataire&&t.codeEtablissement&&t.agentConnecte.referenceExterneAgent){var n={url:this._numerotationTelephoniqueUrl+"?numeroDestinataire="+e.numeroDestinataire,method:o.MethodEnum.PUT,authentificationInfo:t};return this.libraryManager.Core.sendRequest(n).catch(function(e){throw i.CommunicationApiFullWeb.loggerCommunicationApiBase.error("SendRequest declencherAppel Failed - %1",JSON.stringify(e)),e})}return this.libraryManager.Core.createPromiseSelfError(new o.Erreur(r.Services.Libelle.LibelleModel.COM.ERREUR_COMMUNICATION_PARAMETRES_INSUFFISANTS))},t.prototype.raccrocherAppel=function(e){if(e.codeEtablissement&&e.agentConnecte.referenceExterneAgent){var t={url:this._numerotationTelephoniqueUrl,method:o.MethodEnum.DELETE,authentificationInfo:e};return this.libraryManager.Core.sendRequest(t).catch(function(e){throw i.CommunicationApiFullWeb.loggerCommunicationApiBase.error("SendRequest raccrocherAppel Failed - %1",JSON.stringify(e)),e})}return this.libraryManager.Core.createPromiseSelfError(new o.Erreur(r.Services.Libelle.LibelleModel.COM.ERREUR_COMMUNICATION_PARAMETRES_INSUFFISANTS))},t.prototype.envoyerMessageAppliKiosque=function(e){return o.Promesses.createPromiseSelfResolved("")},t.CLASS_NAME_BASE="MyWay.Services.Communication.CommunicationApiBase",t.loggerCommunicationApiBase=o.Loggers.LoggerFactory.INSTANCE.getClass(t.CLASS_NAME_BASE),e=t,i.CommunicationApiBase=e}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this)||this}t=e.Services||(e.Services={}),n=t.Communication||(t.Communication={}),r=n.CommunicationApiBase,__extends(i,r),o=i,n.CommunicationApiFullWeb=o}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Impression="Impression"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Impression||(t.Impression={}),r=n.Messages||(n.Messages={}),(o=r.ImpressionMessageSubject||(r.ImpressionMessageSubject={}))[o.Generer=0]="Generer",o[o.GetJsonConverti=1]="GetJsonConverti",o[o.Imprimer=2]="Imprimer",o[o.ImprimerLot=3]="ImprimerLot",o[o.GenererImprimer=4]="GenererImprimer",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Impression,[t.Components.ComponentType.Context,t.Components.ComponentType.Core,t.Components.ComponentType.Display,t.Components.ComponentType.Fichier,t.Components.ComponentType.Libelle])}(MyWay=MyWay||{}),function(e){var t,n,r,o,i,s;t=e.Services||(e.Services={}),n=t.Impression||(t.Impression={}),(r=n.RESTITUTION_VERSION||(n.RESTITUTION_VERSION={}))[r.V180=180]="V180",(o=n.GENERATION_ACTION||(n.GENERATION_ACTION={}))[o.archiver=10]="archiver",o[o.archiverAndGetFichier=20]="archiverAndGetFichier",o[o.getFichier=30]="getFichier",(i=n.GENERATION_IMPRESSION_ACTION||(n.GENERATION_IMPRESSION_ACTION={}))[i.archiverAndGetFichier=20]="archiverAndGetFichier",i[i.getFichier=30]="getFichier",(s=n.TYPE_IMAGE||(n.TYPE_IMAGE={}))[s.Id=0]="Id",s[s.Flux=1]="Flux"}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).DonneesDelocalisees="DonneesDelocalisees"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.DonneesDelocalisees||(t.DonneesDelocalisees={}),r=n.Messages||(n.Messages={}),(o=r.DonneesDelocaliseesMessageSubject||(r.DonneesDelocaliseesMessageSubject={}))[o.GetDonneesDelocalisees=0]="GetDonneesDelocalisees",o[o.GetListeDonneesDelocalisees=1]="GetListeDonneesDelocalisees",o[o.GetRubriqueLibelle=2]="GetRubriqueLibelle",o[o.GetDonneesParCriteres=3]="GetDonneesParCriteres",o[o.ReInitDbDonneesDelocalisees=4]="ReInitDbDonneesDelocalisees",o[o.GetTDTById=5]="GetTDTById",o[o.DeleteTDTById=6]="DeleteTDTById",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.DonneesDelocalisees,[t.Components.ComponentType.Context,t.Components.ComponentType.Dates,t.Components.ComponentType.Libelle,t.Components.ComponentType.BaseDeDonnees])}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.DonneesDelocalisees||(t.DonneesDelocalisees={}),(r=n.CRITERES_OPERATEUR||(n.CRITERES_OPERATEUR={}))[r.EGAL=0]="EGAL",r[r.CONTIENT=1]="CONTIENT"}(MyWay=MyWay||{}),function(e){var t,i,n,r;function s(){return n.call(this,t.Components.ComponentType.Libelle)||this}t=e.Services||(e.Services={}),i=t.Libelle||(t.Libelle={}),n=t.Components.ComponentAgentBase,__extends(s,n),s.prototype.afficherMessage=function(e,t,n,r){s.logger.info("Méthode à surveiller - afficherMessage");var o={codeLibelle:e,typeAffichage:t,valeurs:n,delai:r};return this.sendMessage(i.LibelleMessageSubject.afficherMessage,o)},s.prototype.constituerLibelle=function(e,t){s.logger.info("Méthode à surveiller - constituerLibelle");var n={codeLibelle:e,valeurs:t};return this.sendMessage(i.LibelleMessageSubject.constituerLibelle,n)},s.CLASS_NAME="MyWay.Services.Libelle.LibelleAgent",s.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(s.CLASS_NAME),r=s,i.LibelleAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var o,t,i,n;function s(){var e=i.call(this,o.Components.ComponentType.Libelle)||this;return e.messages=null,e.managerLibelleIsReady=!1,e.constituerLibellesEnAttente=[],e}o=e.Services||(e.Services={}),t=o.Libelle||(o.Libelle={}),i=o.Components.ComponentApiBase,__extends(s,i),s.prototype.constituerLibelle=function(t,n){var r=this;return this.managerLibelleIsReady?this.libraryManager.Libelle.constituerLibelle(t,n):this.libraryManager.Core.promesseTryCatch(function(e){r.constituerLibellesEnAttente.push(function(){r.libraryManager.Libelle.constituerLibelle(t,n).then(e.resolve,e.reject)})})},s.prototype.init=function(e,n,t){var r=this;return i.prototype.init.call(this,e,n,t).then(function(){var e=null;e=r.portalServiceParameters.CDNUrl?r.portalServiceParameters.CDNUrl+r.privatePortalServiceParameters.FichierMessage:r.privatePortalServiceParameters.FichierMessage;var t={};return t.method=o.MethodEnum.GET,t.url=e,t.responseType=o.ResponseTypeEnum.JSON,t.withHeaders=!1,n.Core.sendRequest(t).then(function(e){r.messages=e},function(){}).finally(function(){r.managerLibelleSetToReady()})},function(e){throw s.logger.info("ServiceApiBase constructor SendRequest callbackError : %1",e.codeLibelle),e})},s.prototype.managerLibelleSetToReady=function(){this.managerLibelleIsReady=!0,this.constituerLibellesEnAttente.forEach(function(e){return e()})},s.CLASS_NAME="MyWay.Services.Libelle.LibelleApi",s.logger=o.Loggers.LoggerFactory.INSTANCE.getClass(s.CLASS_NAME),n=s,t.LibelleApi=n,o.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Capacites="Capacites"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Capacites||(t.Capacites={}),r=n.Messages||(n.Messages={}),(o=r.CapacitesMessageSubject||(r.CapacitesMessageSubject={}))[o.GetCapacite=0]="GetCapacite",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Capacites,[t.Components.ComponentType.Context,t.Components.ComponentType.Mobilite])}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Capacites||(t.Capacites={}),(r=n.REGLE||(n.REGLE={}))[r.INTEROP_APPLI_BANCAIRE=0]="INTEROP_APPLI_BANCAIRE",r[r.INTEROP_WINDOWS=1]="INTEROP_WINDOWS",r[r.TABLETTE_SIGNATURE=2]="TABLETTE_SIGNATURE",r[r.CAISSE_AUTO=3]="CAISSE_AUTO",r[r.CONNECTE=4]="CONNECTE",r[r.MODIFIER_HABILITATION=5]="MODIFIER_HABILITATION",r[r.ECRAN_COMPATIBLE_MYWAY=6]="ECRAN_COMPATIBLE_MYWAY",r[r.RESEAU_INTERNE=7]="RESEAU_INTERNE",r[r.PORTAIL_MYWAY=8]="PORTAIL_MYWAY"}(MyWay=MyWay||{}),function(c){var u,l,t,e;function p(){var e=t.call(this,u.Components.ComponentType.Export)||this;return e.contextKey="EXPORT",e}u=c.Services||(c.Services={}),l=u.Export||(u.Export={}),t=u.Components.ComponentManagerBase,__extends(p,t),p.prototype.verificationDonneesAExporter=function(e){return null===e||void 0===e.contenu||void 0===e.entetes?this.library.Core.createPromiseSelfError(new u.Erreur(c.Services.Libelle.LibelleModel.COM.ERREUR_EXPORT_DONNEES_ENTREES_FORMAT_INVALIDE)):null===e.entetes||null===e.contenu?this.library.Core.createPromiseSelfError(new u.Erreur(c.Services.Libelle.LibelleModel.COM.ERREUR_EXPORT_DONNEES_ENTREES_VIDE)):this.library.Core.getPromesseSelfResoved()},p.prototype.convertionDonneesEnCsv=function(e,t){var s,n="",r=t&&void 0!==t.localisation?t.localisation:l.LOCALISATION.FR,a=t&&void 0!==t.columnDetails?t.columnDetails:[];s=r===l.LOCALISATION.FR?";":",";var o="";for(var i in e.entetes)o+=e.entetes[i]+s;return o=o.slice(0,-1),n+=o+"\r\n",e.contenu.forEach(function(e){var i="";e.ligne.forEach(function(t,n){function e(e){return t.cellule}var r=c.Services.CoreCommon.ArrayUtils.getOne(a,function(e){return e.index===n});null===r&&(r={index:n,addquote:!0,format:e});var o=void 0!==r.format?r.format(t.cellule):e(t.cellule);o=void 0===r.addquote||!0===r.addquote?'"'+o+'"':o,i+=o+s}),i.slice(0,i.length-1),n+=i+"\r\n"}),u.Loggers.FLASH.INSTANCE.setValue("details",n),p.logger.debug("Convertion des données en CSV - Success"),n},p.prototype.telechargerFichier=function(e,t){var n=t&&t.nomFichier?t.nomFichier.replace(/ /g,"_"):"defaut";if(u.CoreCommon.checkIsIE()){e="\ufeff"+e;var r=Blob?new Blob([e],{type:"text/csv;charset=utf-8;"}):null;return window.navigator&&window.navigator.msSaveBlob?(window.navigator.msSaveBlob(r,n+"."+l.FORMAT_FICHIER.CSV),p.logger.debug("Téléchargement fichier sous IE - Success"),this.library.Core.createPromiseSelfResolved(e)):(p.logger.error("Téléchargement fichier sous IE - Failed"),this.library.Core.createPromiseSelfError(new u.Erreur(c.Services.Libelle.LibelleModel.COM.ERREUR_EXPORT_TELECHARGEMENT_IMPOSSIBLE)))}var o="data:text/csv;charset=utf-8,%EF%BB%BF"+encodeURI(e),i=document.createElement("a");return i.href=o,i.style="visibility:hidden",i.download=n+"."+l.FORMAT_FICHIER.CSV,document.body.appendChild(i),i.click(),document.body.removeChild(i),p.logger.debug("Téléchargement fichier avec navigateur non IE - Success"),this.library.Core.createPromiseSelfResolved(e)},p.prototype.exporterFichier=function(t,n,r){var o=this;return this.verificationDonneesAExporter(t).then(function(){switch(n){case l.FORMAT_FICHIER.CSV:var e=o.convertionDonneesEnCsv(t,r);return o.telechargerFichier(e,r);default:throw p.logger.error("Format d'exportation demandé inconnu  - Success"),new u.Erreur(c.Services.Libelle.LibelleModel.COM.ERREUR_EXPORT_FORMAT_FICHIER_INCONNU)}}).catch(function(e){throw p.logger.error("Format d'exportation demandé inconnu  - Success"),e})},p.CLASS_NAME="MyWay.Services.Export.ExportManager",p.logger=u.Loggers.LoggerFactory.INSTANCE.getClass(p.CLASS_NAME),e=p,l.ExportManager=e,u.Components.RegistryManager.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Mobilite)||this}t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.getCaissesAuto=function(){return this.sendMessage(n.Messages.MobiliteMessageSubject.GetPeripheriquesParType,{typePeripherique:n.TYPE_PERIPHERIQUE.CAISSE_AUTO})},i.prototype.getInfoMachine=function(){return this.sendMessage(n.Messages.MobiliteMessageSubject.GetInfoMachine,{})},i.prototype.GetPeripheriques=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.logger.debug("Attention, cette méthode est dépréciée, Il faut utiliser la méthode mobilite.getPeripheriques()"),this.getPeripheriques.apply(this,e)},i.prototype.getPeripheriques=function(){return this.sendMessage(n.Messages.MobiliteMessageSubject.GetPeripheriques,{})},i.prototype.getReseau=function(){return this.sendMessage(n.Messages.MobiliteMessageSubject.GetReseau,{})},i.prototype.getTablettesSignature=function(){return this.sendMessage(n.Messages.MobiliteMessageSubject.GetPeripheriquesParType,{typePeripherique:n.TYPE_PERIPHERIQUE.TABLETTE_SIGNATURE})},i.CLASS_NAME="MyWay.Services.Mobilite.MobiliteAgent",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.MobiliteAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t;function n(){}((t=e.Services||(e.Services={})).TraceSuivi||(t.TraceSuivi={})).TraceSuiviModel=n}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).TraceSuivi="TraceSuivi"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.TraceSuivi||(t.TraceSuivi={}),r=n.Messages||(n.Messages={}),(o=r.TraceSuiviMessageSubject||(r.TraceSuiviMessageSubject={}))[o.SendTraceSuivi=0]="SendTraceSuivi",o[o.SendTraceSuiviForcee=1]="SendTraceSuiviForcee",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.TraceSuivi,[t.Components.ComponentType.Context,t.Components.ComponentType.Core,t.Components.ComponentType.Mobilite,t.Components.ComponentType.BaseDeDonnees])}(MyWay=MyWay||{}),function(e){var i,n,t;function r(){this._url=i.PrivatePortalServiceParameters.Instance().TraceUrl,this.libraryManager=null}i=e.Services||(e.Services={}),n=i.Trace||(i.Trace={}),r.prototype.initApi=function(e){this.libraryManager=e},r.prototype.convertirEnumNiveau=function(e){var t;switch(e){case n.NIVEAUX_TRACE.DEBUG:t="DEBUG";break;case n.NIVEAUX_TRACE.INFO:t="INFO";break;case n.NIVEAUX_TRACE.WARNING:t="WARN";break;case n.NIVEAUX_TRACE.ERROR:t="ERROR";break;default:t="INFO"}return t},r.prototype.convertirTraceModel=function(e,n){var r=this,o=[];return e.forEach(function(e){var t={level:"INFO",message:"",details:{}};t.level=r.convertirEnumNiveau(e.niveau),t.message=e.message,t.details.DateTime=e.datetime,t.details.IdentifiantPoste=n.numeroStationTravail,t.details.IdentifiantProcessus=e.idProcessus,t.details.IdentifiantEtape=e.cheminInstances,n.agentConnecte.numeroInterneEds?t.details.AgenceRattachement=n.agentConnecte.referenceExterneEdsRattachemen:t.details.AgenceRattachement="0000000",t.details.NiveauTrace="INFO",t.details.CodeEtablissement=e.COCXBQ,n.agentConnecte.numeroInterneEds?t.details.PosteFonctionnelAgent=n.agentConnecte.numeroInterneEds:t.details.PosteFonctionnelAgent="0000000",t.details.NomComposant=e.composant?e.composant:e.application,t.details.TypeCanal="01",t.details.VersionComposant=i.CoreCommon.VersionMySys,t.details.TypeDevice="01",t.details.IdentifiantConnexionAgent=n.agentConnecte.referenceExterneAgent,t.details.Autres=e.details,o.push(t)}),o},r.prototype.envoyerTraces=function(e,t){var n={};return n.url=this._url,n.method=i.MethodEnum.POST,n.async=!0,n.contentType=i.ContentTypeEnum.JSON,n.data=this.convertirTraceModel(e,t),n.cache=!1,n.withHeaders=!0,n.authentificationInfo=t,this.libraryManager.Core.sendRequest(n)},r.prototype.setModeDebug=function(e){return i.Promesses.getPromesseSelfResoved()},r.prototype.readFileModeDebug=function(){return i.Promesses.createPromiseSelfResolved(void 0)},t=r,n.TraceApiBase=t}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Trace)||this;return e.wrapped=null,e}t=e.Services||(e.Services={}),o=t.Trace||(t.Trace={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?this.wrapped=new o.TraceApiWindows:this.wrapped=new o.TraceApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.wrapped.initApi(t)})},r.prototype.initApi=function(e){},r.prototype.envoyerTraces=function(e,t){return this.wrapped.envoyerTraces(e,t)},r.prototype.setModeDebug=function(e){return this.wrapped.setModeDebug(e)},r.prototype.readFileModeDebug=function(){return this.wrapped.readFileModeDebug()},n=r,o.TraceApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this)||this}t=e.Services||(e.Services={}),n=t.Trace||(t.Trace={}),r=n.TraceApiBase,__extends(i,r),o=i,n.TraceApiFullWeb=o}(MyWay=MyWay||{}),function(e){var r,t,o,n;function i(){var e=o.call(this)||this;return e._urlLireFichier=r.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/fichier/lire",e}r=e.Services||(e.Services={}),t=r.Trace||(r.Trace={}),o=t.TraceApiBase,__extends(i,o),i.prototype.envoyerTraces=function(e,t){o.prototype.envoyerTraces.call(this,e,t);var n={};return n.method=r.MethodEnum.POST,n.url=r.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/Trace/PurgeTraces",n.async=!0,n.contentType=r.ContentTypeEnum.JSON,n.data=JSON.stringify(e),this.libraryManager.Core.sendRequest(n)},i.prototype.setModeDebug=function(e){return r.CoreCommon.SendRequestWithPromise({url:r.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/Trace/SetModeDegug?timeToLive="+e,method:r.MethodEnum.POST})},i.prototype.readFileModeDebug=function(){return this.libraryManager.Core.sendRequest({url:this._urlLireFichier+"?pathFichier=C:/perso/ModeDebugMyway.json",method:r.MethodEnum.GET,cache:!1}).then(function(e){var t;try{t=JSON.parse(e)}catch(e){throw e}return t})},n=i,t.TraceApiWindows=n}(MyWay=MyWay||{}),function(i){var a,e,c,u,o,t;function n(e,t,n,r,o,i){var s=this;this.producerConsumer=e,this.chatroom=t,this.onGetDivVideo=n,this.onCloseVideo=r,this.myUserId=o,this.userDistantId=i,this.onAcceptOffer=function(){s.aDemarre=!0,s.webRTCLib.createStream({audio:!0,video:!0},function(e){s.localStream=e,null===s.chatroom.streamLocal&&(s.chatroom.streamLocal=e,null!==s.chatroom.htmlElementStream?WebRtcCDN.WebRTCLib.attachStream(s.chatroom.streamLocal,s.chatroom.htmlElementStream):s.onGetDivVideo({cestmoi:!0,chatroom_id:s.chatroom.id,user_id:s.myUserId,doitLancerAutresVideos:!0}))},function(e){s.remoteStream=e,s.remoteStreamVideo?WebRtcCDN.WebRTCLib.attachStream(e,s.remoteStreamVideo):s.onGetDivVideo({cestmoi:!1,chatroom_id:s.chatroom.id,user_id:s.userDistantId,doitLancerAutresVideos:!0})})},this.onClose=function(){s.aDemarre=!1,s.onCloseVideo()},this.aDemarre=!1,this.webRTCLib=new WebRtcCDN.WebRTCLib(e),this.init()}function l(){var e=o.call(this,a.Components.ComponentType.Chat)||this;return e.noop=function(){},e.producersConsumers=[],e.producersConsumersById={},e.promesseCodeAgent=null,e.numMessage=0,e}a=i.Services||(i.Services={}),e=a.BriqueCommunication||(a.BriqueCommunication={}),c=e.Chat||(e.Chat={}),n.prototype.start=function(e){this.aDemarre?(this.onGetDivVideo({cestmoi:!0,chatroom_id:this.chatroom.id,user_id:this.myUserId,doitLancerAutresVideos:e}),this.onGetDivVideo({cestmoi:!1,chatroom_id:this.chatroom.id,user_id:this.userDistantId,doitLancerAutresVideos:e})):this.createOffer()},n.prototype.close=function(){this.webRTCLib.close()},n.prototype.getLocalStream=function(){return this.localStream},n.prototype.setVideoElement=function(e){this.remoteStreamVideo,this.remoteStreamVideo=e,this.remoteStream&&WebRtcCDN.WebRTCLib.attachStream(this.remoteStream,this.remoteStreamVideo)},n.prototype.init=function(){this.webRTCLib.onAcceptOffer(this.onAcceptOffer),this.webRTCLib.onClose(this.onClose)},n.prototype.createOffer=function(){var t=this;this.aDemarre=!0,this.webRTCLib.createStream({audio:!0,video:!0},function(e){t.localStream=e,null===t.chatroom.streamLocal&&(t.chatroom.streamLocal=e,null!==t.chatroom.htmlElementStream?WebRtcCDN.WebRTCLib.attachStream(t.chatroom.streamLocal,t.chatroom.htmlElementStream):t.onGetDivVideo({cestmoi:!0,chatroom_id:t.chatroom.id,user_id:t.myUserId,doitLancerAutresVideos:!0})),t.webRTCLib.createOffer()},function(e){t.remoteStream=e,t.remoteStreamVideo?WebRtcCDN.WebRTCLib.attachStream(e,t.remoteStreamVideo):t.onGetDivVideo({cestmoi:!1,chatroom_id:t.chatroom.id,user_id:t.userDistantId,doitLancerAutresVideos:!0})})},n.CLASS_NAME="MyWay.Services.BriqueCommunication.Chat.VideoRoom",n.logger=a.Loggers.LoggerFactory.INSTANCE.getClass(n.CLASS_NAME),u=n,o=a.Components.ComponentAgentBase,__extends(l,o),l.prototype.init=function(e,t,n){var r=this;return o.prototype.init.call(this,e,t,n).then(function(){r.library.Context.SubscribeToNotification([function(e){"NotificationEvent"===e.Sujet&&r.traiterEvennement(e)}],null)})},l.prototype.sendNotification=function(e){var t={mainEventType:a.BriqueCommunication.Messages.EVENT_TYPE.CHAT,event:e};this.library.Context.sendNotification({Sujet:"NotificationEvent",type:i.Services.CommonEventType.BriqueCommunication,Contenu:t})},l.prototype.addChatCapacity=function(){this.sendMessage(c.ChatMessageSubject.AddChatCapacity,{})},l.prototype.getMe=function(){var t=this;return this.promesseCodeAgent||(this.promesseCodeAgent=this.library.Context.getAuthentificationInfo().then(function(e){return t.getMyCode(e)})),this.promesseCodeAgent},l.prototype.setStatut=function(e){return this.sendMessage(c.ChatMessageSubject.SetStatut,{statut:e})},l.prototype.openChat=function(e){return this.sendMessage(c.ChatMessageSubject.OpenChat,{destinataire:e})},l.prototype.openTchatroom=function(e){return this.sendMessage(c.ChatMessageSubject.OpenChatroom,{idChat:e})},l.prototype.closeChat=function(e){var t=this.producersConsumersById[e];if(t)for(var n in t.videorooms)t.videorooms[n].close();return this.sendMessage(c.ChatMessageSubject.CloseChat,{idChat:e})},l.prototype.sendMessageChat=function(e,t){return this.sendMessage(c.ChatMessageSubject.SendMessage,{idChat:e,message:t})},l.prototype.getUtilisateurs=function(){return this.sendMessage(c.ChatMessageSubject.GetUtilisateurs,{})},l.prototype.getChatrooms=function(){return this.sendMessage(c.ChatMessageSubject.GetChatrooms,{})},l.prototype.getChatroom=function(e){return this.sendMessage(c.ChatMessageSubject.GetChatroom,{chatroom_id:e})},l.prototype.accepterInvitationExpert=function(e,t,n){return this.sendMessage(c.ChatMessageSubject.AccepterDemanderExpert,{chatroom_id:e,domaine:t,prospect_id:n})},l.prototype.inviterPersonnesAUneChatroom=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.sendMessage(c.ChatMessageSubject.InviterPersonnesAUneChatroom,{chatroom_id:e,users_id:t})},l.prototype.setHtmlElementVideo=function(e,n,r){var o=this.producersConsumersById[e];o&&this.getMe().then(function(e){if(n===e)return o.htmlElementStream=r,void(null!==o.streamLocal&&WebRtcCDN.WebRTCLib.attachStream(o.streamLocal,o.htmlElementStream));var t=o.videorooms[n];t&&t.setVideoElement(r)})},l.prototype.commencerVideo=function(e){var t=this.producersConsumersById[e];if(t){for(var n in t.videorooms)t.videorooms[n].start(!1);this.sendMessage(c.ChatMessageSubject.DemarrerVideoChatroom,{idChat:e})}},l.prototype.arreterVideo=function(e){var t=this.producersConsumersById[e];if(t){for(var n in t.videorooms)t.videorooms[n].close();this.sendMessage(c.ChatMessageSubject.ArreterVideoChatroom,{idChat:e})}},l.prototype.devenirFramePrincipalePourChatroomVideo=function(e){this.sendMessage(c.ChatMessageSubject.PrendreLaMainVideoroom,{idChat:e})},l.prototype.reception=function(e){switch(e.subject){case c.ChatMessageSubject.AddChatCapacity:var t=e.message;return this.handleMessageWebRTC(t),this.library.Core.getPromesseSelfResoved();default:return o.prototype.reception.call(this,e)}},l.prototype.traiterEvennement=function(e){switch(e.type){case i.Services.CommonEventType.BriqueCommunication:this.traiterEvennementBriqueCommunication(e)}},l.prototype.traiterEvennementBriqueCommunication=function(e){switch(e.Contenu.mainEventType){case i.Services.BriqueCommunication.Messages.EVENT_TYPE.CHAT:this.traiterEvennementChat(e.Contenu.event)}},l.prototype.traiterEvennementChat=function(e){switch(e.eventType){case i.Services.BriqueCommunication.Chat.Messages.EVENT_TYPE.CHAT_OUVERT:var t=e;this.etablirVideorooms(t.chatroom_id,t.membres,t.estFramePrincipale);break;case i.Services.BriqueCommunication.Chat.Messages.EVENT_TYPE.CHAT_FERME:t=e,this.terminerToutesVideorooms(t.chatroom_id);break;case i.Services.BriqueCommunication.Chat.Messages.EVENT_TYPE.UTILISATEUR_CONNECTE_A_CHAT:var n=e;this.ajouterVideoroom(n.chatroom_id,n.user_id,n.estFramePrincipale);break;case i.Services.BriqueCommunication.Chat.Messages.EVENT_TYPE.UTILISATEUR_DECONNECTE_A_CHAT:var r=e;this.terminerVideoroom(r.chatroom_id,r.user_id);break;case i.Services.BriqueCommunication.Chat.Messages.EVENT_TYPE.CHANGEMENT_MAIN_CHATROOM:var o=e;this.changementMainChatroom(o.chatroom_id,o.estFramePrincipale,o.videoEstEnCours)}},l.prototype.changementMainChatroom=function(n,r,e){var o=this,i=this.producersConsumersById[n];if(i){var s=[];i.membres.forEach(function(e){var t=i.videorooms[e];!r&&t?(t.close(),delete i.videorooms[e]):r&&!t&&s.push(o.ajouterVideoroom(n,e,r))}),r&&e&&a.CoreCommon.ServiceDePromesse.all(s).then(function(){o.commencerVideo(n)})}},l.prototype.ajouterVideoroom=function(o,i,e){var s=this,a=this.producersConsumersById[o];a||(a={id:o,htmlElementStream:null,streamLocal:null,videorooms:{},membres:[]},this.producersConsumersById[o]=a);var t=!1;if(a.membres.every(function(e){return e===i&&(t=!0),t}),t||a.membres.push(i),e)return this.getMe().then(function(r){if(r!==i){var e=a.videorooms[i];if(!e){var t={producer:function(e){l.logger.debug("Emission %1",JSON.pruned(e));var t=JSON.stringify(e);s.sendMessage(c.ChatMessageSubject.EnvoyerMessageVideoroom,{chatroom_id:o,user_id:i,message:t})},setConsumer:function(e){t.consumer=e},consumer:function(){}},n=new u(t,a,function(e){if(s.sendNotification({eventType:c.Messages.EVENT_TYPE.CHAT_DIV_ELEMENT,cestmoi:e.cestmoi,chatroom_id:e.chatroom_id,user_id:e.user_id}),e.doitLancerAutresVideos)for(var t in a.videorooms)if(t!==i){var n=!1;/^agent/.test(t)||(n=!0),r.localeCompare(t)<0&&(n=!0),n&&a.videorooms[t].start(!1)}},function(){if(delete a.videorooms[i],a.streamLocal===n.getLocalStream())for(var e in a.videorooms){var t=a.videorooms[e].getLocalStream();if(t){a.streamLocal=t,s.sendNotification({eventType:c.Messages.EVENT_TYPE.CHAT_DIV_ELEMENT,cestmoi:!0,chatroom_id:a.id,user_id:r});break}}s.sendNotification({eventType:c.Messages.EVENT_TYPE.FIN_VIDEOROOM,chatroom_id:a.id,user_id:i})},r,i);return a.videorooms[i]=n,a.membres.push(i),e}}})},l.prototype.terminerVideoroom=function(e,t){var n=this.producersConsumersById[e];if(n){var r=n[t];r&&(r.close(),delete n[t])}},l.prototype.getMyCode=function(e){return"agent-S"+this.library.Core.StringUtils.leftPad(e.agentConnecte.referenceExterneAgent,"0",7)},l.prototype.etablirVideorooms=function(n,e,r){var o=this;this.getMe().then(function(t){e.forEach(function(e){e!==t&&o.ajouterVideoroom(n,e,r)})})},l.prototype.terminerToutesVideorooms=function(e){var t=this.producersConsumersById[e];if(t)for(var n in t.videorooms)t.videorooms[n].close()},l.prototype.handleMessageWebRTC=function(e){var t=this.producersConsumersById[e.chatroom_id];if(t){var n=t.videorooms[e.user_id];n&&n.producerConsumer&&n.producerConsumer.consumer&&(l.logger.debug("EmissionReception %1",JSON.pruned(e)),n.producerConsumer.consumer(JSON.stringify(e.content)))}},l.CLASS_NAME="MyWay.Services.BriqueCommunication.Chat.ChatAgent",l.logger=a.Loggers.LoggerFactory.INSTANCE.getClass(l.CLASS_NAME),t=l,c.ChatAgent=t,a.Components.RegistryAgent.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var t,n,r,o,i;function s(){return o.call(this,t.Components.ComponentType.Notification)||this}t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),r=n.Notification||(n.Notification={}),o=t.Components.ComponentAgentBase,__extends(s,o),s.prototype.abonnement=function(e){return this.sendMessage(r.NotificationMessageSubject.Abonnement,{subject:e})},s.prototype.desabonnement=function(e){return this.sendMessage(r.NotificationMessageSubject.Desabonnement,{subject:e})},s.prototype.getListeSujets=function(){return this.sendMessage(r.NotificationMessageSubject.GetListeSubjects,{})},i=s,r.NotificationAgent=i,t.Components.RegistryAgent.getInstance().register(i)}(MyWay=MyWay||{}),function(e){var t,r,o,n;function i(){return o.call(this,t.Components.ComponentType.ContexteClient)||this}t=e.Services||(e.Services={}),r=t.ContexteClient||(t.ContexteClient={}),o=t.Components.ComponentAgentBase,__extends(i,o),i.prototype.init=function(e,t,n){return o.prototype.init.call(this,e,t,n)},i.prototype.getExpediteur=function(){var e="agent";return this.library.Context&&this.library.Context.StepInfo&&(e=this.library.Context.StepInfo.CurrentParentProcessId),e},i.prototype.getContextesParClients=function(){return this.sendMessage(r.ContextClientMessageSubject.GetContextesParClients).then(function(e){return e.ids})},i.prototype.getId=function(){return this.sendMessage(r.ContextClientMessageSubject.GetId).then(function(e){return e.id})},i.prototype.getClient=function(){return this.sendMessage(r.ContextClientMessageSubject.GetClient).then(function(e){return e.id})},i.prototype.setClient=function(e){var t={client:e,expediteur:this.getExpediteur()};return this.sendMessage(r.ContextClientMessageSubject.SetClient,t)},i.prototype.getProperty=function(e){var t={cle:e};return this.sendMessage(r.ContextClientMessageSubject.GetProperty,t).then(function(e){return e.valeur})},i.prototype.addToList=function(e,t){var n={cle:e,valeur:t,expediteur:this.getExpediteur()};return this.sendMessage(r.ContextClientMessageSubject.AddToList,n).then(function(e){return e.estOk})},i.prototype.setProperty=function(e,t){var n={cle:e,valeur:t,expediteur:this.getExpediteur()};return this.sendMessage(r.ContextClientMessageSubject.SetProperty,n).then(function(e){return e.estOk})},i.prototype.removeFromList=function(e){var t={cle:e,expediteur:this.getExpediteur()};return this.sendMessage(r.ContextClientMessageSubject.RemoveFromList,t).then(function(e){return e.estOk})},i.prototype.deleteProperty=function(e){var t={cle:e,expediteur:this.getExpediteur()};return this.sendMessage(r.ContextClientMessageSubject.DeleteProperty,t).then(function(e){return e.estOk})},i.prototype.getContenu=function(e){var t={idClient:e};return this.sendMessage(r.ContextClientMessageSubject.GetContenu,t).then(function(e){return e.valeur})},i.prototype.setContenu=function(e,t){var n={idClient:e,valeur:t,expediteur:this.getExpediteur()};return this.sendMessage(r.ContextClientMessageSubject.SetContenu,n).then(function(e){return e.estOk})},i.prototype.setReloadSynthese=function(e){var t={idClient:e,expediteur:this.getExpediteur()};return this.sendMessage(r.ContextClientMessageSubject.SetReloadSynthese,t).then(function(e){return e.estOk})},n=i,r.ContexteClientAgent=n,t.Components.RegistryAgent.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t;((t=e.Services||(e.Services={})).Trace||(t.Trace={})).KEY_TIME_BEFORE_TRANSITION="TempsAvantTransition"}(MyWay=MyWay||{}),function(e){var o;(o=e.Services||(e.Services={})).ServiceAgentExtended.prototype._diagnostic=null,o.ServiceAgentExtended.prototype.demarrerDiagnostic=function(e,t){var n=this;if(this._diagnostic.stepId!==this.Step.CurrentStepId)return this._diagnostic.previousStepEndTime=this.Step.PreviousStepEndTime,this._diagnostic.stepStartTime=this.Step.StartTime,this._diagnostic.displayTime=this.Step.DisplayTime,this._diagnostic.initTime=t,this._diagnostic.lastDigestCycleTime=t,this._diagnostic.userTime=0,this._diagnostic.codeApplication=e.codeApplication,this._diagnostic.stepId=this.Step.CurrentStepId,this._diagnostic.stepPath=this.Step.CurrentPath,this._diagnostic.finalDiagnostic=this.Step.DiagnosticTraceSentForStep,this._diagnostic.timeBeforeTransition=0,"Connaissance Client Particulier"!==this.Step.NomComposant||e.listenedContextKey||(e.listenedContextKey="MAJSYNTHESENSDK"),this._listenedContextKey=e.listenedContextKey,this.prepareTracesTechniques(),this.Step.Diagnostic&&this.countWatchers(),this.Library.Context.GetFromContext(o.Trace.KEY_TIME_BEFORE_TRANSITION).then(function(e){if(null!==e){var t=Number(e);isNaN(t)||(n._diagnostic.timeBeforeTransition=t),n.Library.Context.AddToContext(o.Trace.KEY_TIME_BEFORE_TRANSITION,"")}})},o.ServiceAgentExtended.prototype.prepareTracesTechniques=function(){var r=this;o.ServiceAgentExtended.logger_extended.info("Fin d'initialisation du serviceAgent"),r._clearWatchListener=r.$rootScope.$watch(function(e,t,n){r._diagnostic.digestCycles++,r._diagnostic.lastDigestCycleTime=Date.now(),r.Step&&r.Step.Diagnostic&&r.Library.Trace.sendDiagnostic(r._diagnostic),r._lastDigestTimerHandle&&window.clearTimeout(r._lastDigestTimerHandle),r._lastDigestTimerHandle=window.setTimeout(function(){r.OnPremiereAction(null)},1e4)}),r.$rootScope.$on("$includeContentLoaded",function(){o.ServiceAgentExtended.logger_extended.debug("$includeContentLoaded")}),r.$rootScope.$on("$viewContentLoaded",function(){o.ServiceAgentExtended.logger_extended.debug("$viewContentLoaded")}),this.ajouteEvenementsUtilisateurs(),this._listenedContextKey&&this.Library.Context.SetContextListener(this._listenedContextKey,this.OnContextEvent)},o.ServiceAgentExtended.prototype.ajouteEvenementsUtilisateurs=function(){var t=this;window.addEventListener("mousedown",function(e){t.OnPremiereAction(e)},!1),window.addEventListener("wheel",function(e){t.OnPremiereAction(e)},!1),window.addEventListener("scroll",function(e){t.OnPremiereAction(e)},!1),window.addEventListener("keypress",function(e){t.OnPremiereAction(e)},!1)},o.ServiceAgentExtended.prototype.retireEvenementsUtilisateurs=function(){var t=this;window.removeEventListener("mousedown",function(e){t.OnPremiereAction(e)},!1),window.removeEventListener("wheel",function(e){t.OnPremiereAction(e)},!1),window.removeEventListener("scroll",function(e){t.OnPremiereAction(e)},!1),window.removeEventListener("keypress",function(e){t.OnPremiereAction(e)},!1)},o.ServiceAgentExtended.prototype.stringify=function(e,t){var n="";return n+="|stepId|"+e.stepId,n+="|digestCycles|"+e.digestCycles,n+="|totalDisplayDuration|"+(e.totalDisplayDuration+e.timeBeforeTransition),n+="|stepStartDuration|"+e.stepStartDuration,n+="|totalStartDuration|"+e.totalStartDuration,t&&t.type?n+="|type|"+t.type:n+="|type|timer",n+="|staticFilesLoadDuration|"+e.staticFilesLoadDuration,n+="|digestDuration|"+e.digestDuration,n+="|userDuration|"+(e.userDuration+e.timeBeforeTransition),n+="|totalUserDuration|"+e.totalUserDuration,n+="|userDurationEnabled|"+e.userDurationEnabled},o.ServiceAgentExtended.prototype.OnPremiereAction=function(e){this._diagnostic.finalDiagnostic||(o.Loggers.FLASH.INSTANCE.setValue("action","ServiceAgentExtended"),o.Loggers.FLASH.INSTANCE.setValue("details",{lastDigestTime:this._diagnostic.lastDigestCycleTime}),o.ServiceAgentExtended.logger_extended.info("fin de chargement de l'application %1",this.stringify(this._diagnostic,e)),this._diagnostic.finalDiagnostic=!0,this.Library.Trace.sendDiagnostic(this._diagnostic)),this._clearWatchListener&&this._clearWatchListener(),this._lastDigestTimerHandle&&window.clearTimeout(this._lastDigestTimerHandle),this.retireEvenementsUtilisateurs()},o.ServiceAgentExtended.prototype.cleanTimers=function(){this._clearWatchListener&&this._clearWatchListener(),this._lastDigestTimerHandle&&window.clearTimeout(this._lastDigestTimerHandle),this.retireEvenementsUtilisateurs(),this._watcherCountTimeout&&window.clearTimeout(this._watcherCountTimeout)},o.ServiceAgentExtended.prototype.countWatchers=function(){var e=this,t=this.Context.AnalyseApp();this._diagnostic.watchers=Math.max(t.TotalWatchers,t.TotalWatchers2,t.TotalWatchers3),this.Library.Trace.sendDiagnostic(this._diagnostic),this._watcherCountTimeout=window.setTimeout(function(){e.countWatchers()},5e3)},o.ServiceAgentExtended.onNewInstance(function(e){e.addListenerBeforeInitialization(function(){this._diagnostic?this.cleanTimers():this._diagnostic=new o.ApplicationDiagnostic}),e.addListenerAfterInitialization(function(e,t){this.Step&&this.demarrerDiagnostic(e,t)})})}(MyWay=MyWay||{}),function(e){var r,o;(r=e.Services||(e.Services={})).Core.defineProperty(r.ServiceAgent,"Trace",{get:function(){return o},set:function(){}}),r.onInitUsableLoggerForServiceAgent=function(e,t){var n;n=t||"LocalLauncher",o=new r.Trace.Logger(n,"Application",e.Library)}}(MyWay=MyWay||{}),function(e){var o,t,i,n;function r(){var e=i.call(this,o.Components.ComponentType.Trace)||this;return e.regExpSTC=/^MyWay\.Services\./,e}o=e.Services||(e.Services={}),t=o.Trace||(o.Trace={}),i=o.Components.ComponentAgentBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return this._application=n.codeApplication,this._applicationVersion=n.applicationVersion,i.prototype.init.call(this,e,t,n).then(function(){o.Loggers.Appenders.BroadcastAppender.METHODE_PURGE_TRACES=function(e){r.sendLog(e)}})},r.prototype.dispose=function(){return o.Loggers.Appenders.BroadcastAppender.METHODE_PURGE_TRACES=null,this.library.Core.getPromesseSelfResoved()},r.prototype.send=function(e){return o.CoreCommon.ServiceDePromesse.defer(),this.regExpSTC.test(e.composant)||e.niveau!==t.NIVEAUX_TRACE.INFO||(e.niveau=t.NIVEAUX_TRACE.DEBUG),this.sendMessage(t.Messages.TraceMessageSubject.Tracer,{trace:e})},r.prototype.sendLog=function(e){return o.CoreCommon.ServiceDePromesse.defer(),this.regExpSTC.test(e.packageName)||e.niveau!==o.Loggers.LEVEL.INFO||(e.niveau=o.Loggers.LEVEL.DEBUG),this.sendMessage(t.Messages.TraceMessageSubject.Logger,{log:e})},r.prototype.sendDiagnostic=function(e){return this.sendMessage(t.Messages.TraceMessageSubject.SendDiagnostic,{diagnostic:e})},r.prototype.setTempsAvantTransition=function(e){return this.library.Context.AddToContext(t.KEY_TIME_BEFORE_TRANSITION,e.toString())},n=r,t.TraceAgent=n,o.Components.RegistryAgent.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgentExtended,"ContextTechAgent",{get:function(){return this._techLibrary.ContextTechAgent}}),t.TechAgentExtended.prototype.AddToGlobalContext=function(e){return this._techLibrary.AddToGlobalContext(e)},t.TechAgentExtended.prototype.AddToTempoContext=function(e){return this._techLibrary.AddToTempoContext(e)},t.TechAgentExtended.prototype.AddToMainProcessContext=function(e,t){return this._techLibrary.AddToMainProcessContext(e,t)},t.TechAgentExtended.prototype.GetFromMainProcessContext=function(e){return this._techLibrary.GetFromMainProcessContext(e)},t.TechAgentExtended.prototype.GetCurrentMainProcess=function(){return this._techLibrary.GetCurrentMainProcess()}}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgent,"ContextTechAgent",{get:function(){return this._techLibrary.ContextTechAgent}}),t.TechAgent.prototype.AddToGlobalContext=function(e){return this.ContextTechAgent.AddToGlobalContext(e)},t.TechAgent.prototype.AddToTempoContext=function(e){return this.ContextTechAgent.AddToTempoContext(e)},t.TechAgent.prototype.AddToMainProcessContext=function(e,t){return this.ContextTechAgent.AddToMainProcessContext(e,t)},t.TechAgent.prototype.GetFromMainProcessContext=function(e){return this.ContextTechAgent.GetFromMainProcessContext(e)},t.TechAgent.prototype.GetCurrentMainProcess=function(){return this.ContextTechAgent.GetCurrentMainProcess()}}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).TechLibrary.addInitListener(function(e,t){e.ContextTechAgent=t.Context}),t.TechLibrary.prototype.AddToGlobalContext=function(e){return this.ContextTechAgent.AddToGlobalContext(e)},t.TechLibrary.prototype.AddToTempoContext=function(e){return this.ContextTechAgent.AddToTempoContext(e)},t.TechLibrary.prototype.AddToMainProcessContext=function(e,t){return this.ContextTechAgent.AddToMainProcessContext(e,t)},t.TechLibrary.prototype.GetFromMainProcessContext=function(e){return this.ContextTechAgent.GetFromMainProcessContext(e)},t.TechLibrary.prototype.GetCurrentMainProcess=function(){return this.ContextTechAgent.GetCurrentMainProcess()}}(MyWay=MyWay||{}),function(e){var t,r,o,n;function i(){return o.call(this)||this}t=e.Services||(e.Services={}),r=t.Context||(t.Context={}),o=r.ContextAgent,__extends(i,o),i.prototype.GetSharedStorage=function(){return this.sendMessage(r.ContextMessageSubject.GetSharedStorage,{})},i.prototype.GetWaitingProcesses=function(){return this.sendMessage(r.ContextMessageSubject.GetWaitingProcesses,{})},i.prototype.GetPortals=function(){return this.sendMessage(r.ContextMessageSubject.GetPortals,{})},i.prototype.GetGlobalStorage=function(){return this.sendMessage(r.ContextMessageSubject.GetGlobalStorage,{})},i.prototype.ClearContext=function(){return this.sendMessage(r.ContextMessageSubject.ClearContext,{})},i.prototype.ClearBus=function(){return this.library.Interop?this.library.Interop.clearBus():this.library.Core.getPromesseSelfResoved()},i.prototype.AddToContext=function(e,t,n){return"string"==typeof t?o.prototype.AddToContext.call(this,e,t):this.sendMessage(r.ContextMessageSubject.AddToContextTech,{level:e,kvp:t,elementId:n})},i.prototype.AddToGlobalContext=function(e){return this.sendMessage(r.ContextMessageSubject.AddToGlobalContext,{kvp:e})},i.prototype.AddToTempoContext=function(e){return this.sendMessage(r.ContextMessageSubject.AddToTempoContext,{kvp:e})},i.prototype.AddToMainProcessContext=function(e,t){return this.sendMessage(r.ContextMessageSubject.AddToMainProcessContext,{key:e,value:t})},i.prototype.AddToProcessStepContext=function(e,t,n){return this.sendMessage(r.ContextMessageSubject.AddToProcessStepContext,{key:e,value:t,processStepId:n})},i.prototype.GetFromMainProcessContext=function(e){return this.sendMessage(r.ContextMessageSubject.GetFromMainProcessContext,{key:e})},i.prototype.GetCurrentMainProcess=function(){return this.sendMessage(r.ContextMessageSubject.GetCurrentMainProcess,{})},n=i,r.ContextTechAgent=n,t.Components.RegistryAgent.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Aide="Aide"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Aide||(t.Aide={}),r=n.Messages||(n.Messages={}),(o=r.AideMessageSubject||(r.AideMessageSubject={}))[o.GetContenuInfobulle=0]="GetContenuInfobulle",o[o.GetInfobullesAffichables=1]="GetInfobullesAffichables",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Aide,[t.Components.ComponentType.Context,t.Components.ComponentType.Display,t.Components.ComponentType.Preferences])}(MyWay=MyWay||{}),function(e){var t;(function(e){function t(e){e&&(this.ChampsDeSaisie=e.ChampsDeSaisie,this.ModalePush=e.ModalePush,this.Totem=e.Totem,this.InfobullesAffichees=e.InfobullesAffichees,this.DetailInfobulleAffichee=e.DetailInfobulleAffichee)}function n(e){e&&(this.Id=e.Id,this.IdChamp=e.IdChamp,this.MessageCommunautaire=e.MessageCommunautaire,this.MessageEtablissement=e.MessageEtablissement,this.EstUneNouveaute=e.EstUneNouveaute)}function r(e){e&&(this.Message=e.Message)}function o(e){e&&(this.Categorie=e.Categorie,this.Titre=e.Titre,this.FormatDocument=e.FormatDocument,this.Lien=e.Lien,this.EstUneNouveaute=e.EstUneNouveaute)}function i(){}e.AideResult=t,e.ChampDeSaisieResult=n,e.ModalePushResult=r,e.TotemResult=o,e.Infobulle=i;var s,a=(__extends(c,s=i),c.prototype.getNomChampLie=function(){return this._nomChampLie},c.prototype.getEstNouveaute=function(){return this._estNouveaute},c);function c(e,t){var n=s.call(this)||this;return"string"==typeof e?(n._nomChampLie=e||"",n._estNouveaute=t||!1):"object"==typeof e?(n._nomChampLie=e&&e._nomChampLie?e._nomChampLie:"",n._estNouveaute=!(!e||!e._estNouveaute)&&e._estNouveaute):(n._nomChampLie="",n._estNouveaute=!1),n}e.InfobulleAfficheeResult=a;var u,l=(__extends(p,u=a),p.prototype.getNomChampLie=function(){return u.prototype.getNomChampLie.call(this)},p.prototype.getEstNouveaute=function(){return u.prototype.getEstNouveaute.call(this)},p.prototype.getMessage=function(){return this._message},p.prototype.getImage=function(){return this._image},p);function p(e,t,n,r){var o=this;return"string"==typeof e?((o=u.call(this,e,t)||this)._message=n||"",o._image=r||null):"object"==typeof e?((o=u.call(this,e)||this)._message=e&&e._message?e._message:"",o._image=e&&e._image?e._image:null):((o=u.call(this,"",!1)||this)._message="",o._image=null),o}e.DetailInfobulleAfficheeResult=l})((t=e.Services||(e.Services={})).Aide||(t.Aide={}))}(MyWay=MyWay||{}),function(e){var t,r,n,o;function i(){return n.call(this,t.Components.ComponentType.Preferences)||this}t=e.Services||(e.Services={}),r=t.Preferences||(t.Preferences={}),n=t.Components.ComponentAgentBase,__extends(i,n),i.prototype.LirePreference=function(e,t){var n={nomVariable:e,isChargerServeur:t};return this.sendMessage(r.PreferencesMessageSubject.LirePreference,n).then(function(e){return e.valeurVariable})},i.prototype.EcrirePreference=function(e,t){var n={preferences:[{cle:e,valeur:t}]};return this.sendMessage(r.PreferencesMessageSubject.EcrirePreference,n)},i.prototype.lireMultiPreference=function(e){var t={codesPreference:e};return this.sendMessage(r.PreferencesMessageSubject.LireMultiPreference,t).then(function(e){return e.preferences})},i.prototype.ecrireMultiPreference=function(e){var t={preferences:e};return this.sendMessage(r.PreferencesMessageSubject.EcrirePreference,t)},o=i,r.PreferencesAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var o,t,n,r;function i(){return n.call(this,o.Components.ComponentType.Preferences)||this}o=e.Services||(e.Services={}),t=o.Preferences||(o.Preferences={}),n=o.Components.ComponentApiBase,__extends(i,n),i.prototype.ObtenirPreferences=function(e){return this.libraryManager.Core.sendRequest({withHeaders:!0,url:o.PrivatePortalServiceParameters.Instance().PreferencesUrl+"/multi?codeAgent="+e,method:o.MethodEnum.GET}).then(function(e){var t=[];for(var n in e)t.push({cle:n,valeur:e[n]});return t})},i.prototype.EcrirePreference=function(e,t){var n={};t.forEach(function(e){n[e.cle]=e.valeur});var r={};return r.method=o.MethodEnum.POST,r.url=o.PrivatePortalServiceParameters.Instance().PreferencesUrl+"/multi?codeAgent="+e,r.async=!0,r.data={preferences:n},r.contentType=o.ContentTypeEnum.JSON,this.libraryManager.Core.sendRequest(r)},r=i,t.PreferencesApi=r,o.Components.RegistryApi.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Interop)||this;return e.wrapped=null,e}t=e.Services||(e.Services={}),o=t.Interop||(t.Interop={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?this.wrapped=new o.InteropApiWindows:this.wrapped=new o.InteropApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.wrapped.initApi(t)})},r.prototype.initApi=function(){},r.prototype.lancer=function(e,t,n,r,o){return this.wrapped.lancer(e,t,n,r,o)},r.prototype.addToContextInterop=function(e,t,n,r,o){return this.wrapped.addToContextInterop(e,t,n,r,o)},r.prototype.addListToContextInterop=function(e,t,n,r){return this.wrapped.addListToContextInterop(e,t,n,r)},r.prototype.getVarEnv=function(e,t,n){return this.wrapped.getVarEnv(e,t,n)},r.prototype.getRegistryValue=function(e,t,n,r,o){return this.wrapped.getRegistryValue(e,t,n,r,o)},r.prototype.ecrireFichier=function(e,t,n,r){return this.wrapped.ecrireFichier(e,t,n,r)},r.prototype.lireFichier=function(e){return this.wrapped.lireFichier(e)},r.prototype.getInfoFichier=function(e,t,n){return this.wrapped.getInfoFichier(e,t,n)},r.prototype.afficherWindowParHandle=function(e,t){return this.wrapped.afficherWindowParHandle(e,t)},r.prototype.afficherWindowParPid=function(e,t){return this.wrapped.afficherWindowParPid(e,t)},r.prototype.afficherSynthese=function(e){return this.wrapped.afficherSynthese(e)},r.prototype.activerApplicationAppelante=function(e){return this.wrapped.activerApplicationAppelante(e)},r.prototype.notifierFinStep=function(e){return this.wrapped.notifierFinStep(e)},r.prototype.notifierEtatProcessus=function(e,t){return this.wrapped.notifierEtatProcessus(e,t)},r.prototype.notifierFinProcessus=function(e,t){return this.wrapped.notifierFinProcessus(e,t)},r.prototype.notifierChangementNomProcessus=function(e,t){return this.wrapped.notifierChangementNomProcessus(e,t)},r.prototype.subscribeToEvent=function(e,t,n){return this.wrapped.subscribeToEvent(e,t,n)},r.prototype.testLocalService=function(){return this.wrapped.testLocalService()},r.prototype.getListFromContextInterop=function(e,t,n,r){return this.wrapped.getListFromContextInterop(e,t,n,r)},r.prototype.getFromContextInterop=function(e,t,n,r){return this.wrapped.getFromContextInterop(e,t,n,r)},r.prototype.getCommonDataInteropToUpdate=function(){return this.wrapped.getCommonDataInteropToUpdate()},n=r,o.InteropApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){}t=e.Services||(e.Services={}),n=t.Interop||(t.Interop={}),o.prototype.initApi=function(e){this.libraryManager=e},o.prototype.lancer=function(e,t,n,r,o){},o.prototype.addToContextInterop=function(e,t,n,r,o){},o.prototype.addListToContextInterop=function(e,t,n,r){},o.prototype.getListFromContextInterop=function(e,t,n,r){},o.prototype.getFromContextInterop=function(e,t,n,r){},o.prototype.getVarEnv=function(e,t,n){},o.prototype.getRegistryValue=function(e,t,n,r,o){},o.prototype.ecrireFichier=function(e,t,n,r){return this.libraryManager.Core.createPromiseSelfResolved()},o.prototype.lireFichier=function(e){return this.libraryManager.Core.createPromiseSelfResolved()},o.prototype.getInfoFichier=function(e,t,n){},o.prototype.afficherWindowParHandle=function(e,t){},o.prototype.afficherWindowParPid=function(e,t){},o.prototype.afficherSynthese=function(e){},o.prototype.activerApplicationAppelante=function(e){},o.prototype.activerWindow=function(e){},o.prototype.notifierFinStep=function(e){},o.prototype.notifierEtatProcessus=function(e,t){},o.prototype.notifierFinProcessus=function(e,t){},o.prototype.notifierChangementNomProcessus=function(e,t){},o.prototype.activerApplication=function(e,t){},o.prototype.getHandlePetra=function(e){},o.prototype.subscribeToEvent=function(e){},o.prototype.testLocalService=function(){},o.prototype.sendConnectionInfo=function(e,t){},o.prototype.getCommonDataInteropToUpdate=function(){var e=t.CoreCommon.ServiceDePromesse.defer();return e.resolve([]),e.promise},r=o,n.InteropApiFullWeb=r}(MyWay=MyWay||{}),function(e){var a,r,t;function n(){}a=e.Services||(e.Services={}),r=a.Interop||(a.Interop={}),n.prototype.initApi=function(e){this._localServiceUrl=a.PrivatePortalServiceParameters.Instance().LocalServiceUrl,this.libraryManager=e},n.prototype.testLocalService=function(){var e=this,t={url:this._localServiceUrl+"/Contexte/GetAllVarEnv",cache:!1,async:!1};a.CoreCommon.SendRequest(t,function(){},function(){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled=!0,e.warnLocalServiceUnavailability()})},n.prototype.lancer=function(e,t,n,r,o){if(a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled)this.warnLocalServiceUnavailability();else{var i=JSON.stringify(e),s=JSON.stringify(t);a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/lancer?exec="+i+"&parametres="+n+"&contexte="+s+"&sync="+r,contentType:a.ContentTypeEnum.JSON,method:a.MethodEnum.POST},function(){},o)}},n.prototype.addToContextInterop=function(e,t,n,r,o){var i;a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():(i="/Myway/"+e+"/","process"==e.toLowerCase()&&"courant"!=t.toLowerCase()&&(i+="courant/"),t=i+t,a.CoreCommon.SendRequest({url:this._localServiceUrl+"/contexte/setvaleur?cle="+t+"&valeur="+n,method:a.MethodEnum.GET,contentType:a.ContentTypeEnum.JSON,async:!1,cache:!1},function(e){r&&r(e)},o))},n.prototype.addListToContextInterop=function(e,t,n,r){var o;a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():(o="/Myway/"+e+"/courant/",a.CoreCommon.SendRequest({url:this._localServiceUrl+"/contexte/AddListToContextInterop?racinePath="+o+"&datas="+JSON.stringify(t),method:a.MethodEnum.GET,contentType:a.ContentTypeEnum.JSON,async:!1,cache:!1},function(e){n&&n(e)},r))},n.prototype.getFromContextInterop=function(e,t,n,r){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():(t="/Myway/"+e+"/"+t,a.CoreCommon.SendRequest({url:this._localServiceUrl+"/contexte/getvaleur?cle="+t,data:void 0,method:a.MethodEnum.GET,contentType:a.ContentTypeEnum.JSON,async:!1,cache:!1},function(e){n&&n(e)},r))},n.prototype.getListFromContextInterop=function(e,t,n,r){var o;a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():(o="/Myway/"+e+"/courant/",a.CoreCommon.SendRequest({url:this._localServiceUrl+"/contexte/GetListFromContextInterop?racinePath="+o+"&datas="+JSON.stringify(t),method:a.MethodEnum.GET,contentType:a.ContentTypeEnum.JSON,async:!1,cache:!1},function(e){n&&n(e)},r))},n.prototype.getVarEnv=function(e,t,n){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/environment/getvaleur?nom="+e,data:void 0,async:!1,method:a.MethodEnum.GET,contentType:a.ContentTypeEnum.JSON,cache:!1},function(e){t&&t(e)},n)},n.prototype.getRegistryValue=function(e,t,n,r,o){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/window/GetRegistryValue?niveau="+e+"&souscle="+t+"&nom="+n,data:void 0,async:!1,method:a.MethodEnum.GET,contentType:a.ContentTypeEnum.JSON,cache:!1},function(e){r&&r(e)},o)},n.prototype.lireFichier=function(e){if(!a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled)return this.libraryManager.Core.sendRequest({url:a.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/fichier/lire?pathFichier="+e,contentType:a.ContentTypeEnum.JSON,method:a.MethodEnum.GET,async:!1,cache:!1}).then(function(e){return e});this.warnLocalServiceUnavailability()},n.prototype.getInfoFichier=function(e,t,n){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/fichier/GetInfo?pathFichier="+e,data:void 0,type:"GET",async:!1,method:a.MethodEnum.GET,contentType:a.ContentTypeEnum.JSON,cache:!1},function(e){t&&t(e)},n)},n.prototype.ecrireFichier=function(e,t,n,r){if(!a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled)return this.libraryManager.Core.sendRequest({url:a.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/fichier/ecrire?pathFichier="+e+"&ajouter="+n+"&creeDir="+r,data:t,contentType:a.ContentTypeEnum.JSON,method:a.MethodEnum.POST,type:"POST",async:!1}).then(function(e){return e});this.warnLocalServiceUnavailability()},n.prototype.afficherWindowParHandle=function(e,t){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/AfficherWindowParHandle?handle="+e+"&affiche="+t,data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(){})},n.prototype.afficherWindowParPid=function(e,t){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/AfficherWindowParPid?pid="+e+"&affiche="+t,data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(){})},n.prototype.afficherSynthese=function(e){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/AfficherSynthese?numeroClient="+e,data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(){})},n.prototype.activerApplicationAppelante=function(e){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/ActiverApplicationAppelante?numeroPlan="+e,data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(){})},n.prototype.notifierFinStep=function(e){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/NotifierFinStep?stepId="+e,data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(){})},n.prototype.notifierEtatProcessus=function(e,t){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/NotifierEtatProcessus?processId="+e+"&cId="+this._connectionId+"&Etat="+t,data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(e){console.log(e)})},n.prototype.notifierFinProcessus=function(e,t){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/NotifierFinProcessusAvecData?processId="+e+"&cId="+this._connectionId+"&datas="+JSON.stringify(t),data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(e){console.log(e)})},n.prototype.notifierChangementNomProcessus=function(e,t){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/NotifierChangementNomProcessus?processId="+e+"&nomProcessus="+encodeURIComponent(t),data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(e){console.log(e)})},n.prototype.notifierNomProcessus=function(e,t){a.PrivatePortalServiceParameters.Instance().LocalServiceDisabled?this.warnLocalServiceUnavailability():a.CoreCommon.SendRequest({url:this._localServiceUrl+"/lanceur/NotifierNomProcessus?nom="+e+"&processId="+t,data:void 0,async:!1,method:a.MethodEnum.POST,contentType:a.ContentTypeEnum.JSON},function(){},function(e){console.log(e)})},n.prototype.subscribeToEvent=function(e,t,r){this._onEvent=e,this._onAcceptEvent=t,this._onConnection=r;try{var o=this;$.getScript(this._localServiceUrl+"/signalr/hubs").done(function(e,t){$.connection.simpleEventHub.client.sendMessage=function(e){o._setConnection($.connection.hub.id),o._treatMessage(e)};var n=$.connection.hub;n.url=o._localServiceUrl+"/signalr",n.logging=!0,n.start({transport:["serverSentEvents","longPolling"]}).done(function(){o._setConnection($.connection.hub.id)}),n.disconnected(function(){setTimeout(function(){n.start({transport:["serverSentEvents","longPolling"]}).done(function(){o._connectionId=$.connection.hub.id,r(o._connectionId)})},5e3)}),window.onbeforeunload=function(e){o._disconnect()}}).fail(function(e,t,n){$("div.log").text("Triggered ajaxError handler.")})}catch(e){console.log("can't load hub evenHub: "+e)}},n.prototype.getCommonDataInteropToUpdate=function(){var e,t=[];return this._localServiceUrl?(e=this._localServiceUrl+"/donnees-interop.json",this.libraryManager.Core.sendRequest({url:e,method:a.MethodEnum.GET,withHeaders:!1,timeout:3e3}).then(function(e){return e},function(){return t})):this.libraryManager.Core.createPromiseSelfResolved(t)},n.prototype._setConnection=function(e){e!==this._connectionId&&(this._connectionId=e,this._onConnection(e))},n.prototype._treatMessage=function(e){if("accept"===e.Destinataire){(n=new r.InteropMessageEvent).ProcessStepId=e.Destinataire,n.Subject=e.Sujet,n.Contenu=e.Contenu,n.DeliverTries=0;var t=this._onAcceptEvent(n);a.CoreCommon.SendRequest({url:this._localServiceUrl+"/Evenements/AcceptMessage?connectionId="+this._connectionId+"&messageId="+e.Contenu.MessageId+"&accept="+t,method:a.MethodEnum.GET,withHeaders:!1},null,null)}else{var n;a.CoreCommon.SendRequest({url:this._localServiceUrl+"/Evenements/Acknowledge?status=SUCCESS&messageId="+e.Id+"&responseText=ok",method:a.MethodEnum.GET,withHeaders:!1},null,null),(n=new r.InteropMessageEvent).ProcessStepId=e.Destinataire,n.Subject=e.Sujet,n.Contenu=e.Contenu,n.DeliverTries=0,this._onEvent(n,null)}},n.prototype._disconnect=function(){a.CoreCommon.SendRequest({url:this._localServiceUrl+"/Evenements/Disconnect/"+this._connectionId,method:a.MethodEnum.GET,withHeaders:!1},null,null)},n.prototype.warnLocalServiceUnavailability=function(){n.logger.warn("Le service local n'a pu être joint et a été désactivé. Veuillez redémarrer le service local et recharger le portail")},n.CLASS_NAME="MyWay.Services.Interop.InteropApiWindows",n.logger=a.Loggers.LoggerFactory.INSTANCE.getClass(n.CLASS_NAME),t=n,r.InteropApiWindows=t}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.BaseDeDonnees)||this}t=e.Services||(e.Services={}),n=t.BaseDeDonnees||(t.BaseDeDonnees={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.onGetBases=function(){return this.managerInstance.getBases()},i.prototype.onGet=function(e){var t=e.base,n=e.table,r=e.cle;return this.managerInstance.getBase(t).getTable(n).get(r)},i.prototype.onGetAll=function(e){var t=e.base,n=e.table;return this.managerInstance.getBase(t).getTable(n).getAll()},i.prototype.onFind=function(e){var t=e.base,n=e.table,r=e.critere;return this.managerInstance.getBase(t).getTable(n).chercher(r)},i.prototype.onCount=function(e){var t=e.base,n=e.table,r=e.critere;return this.managerInstance.getBase(t).getTable(n).count(r)},i.prototype.onAjouter=function(e){var t=e.base,n=e.table,r=e.elements;return this.managerInstance.getBase(t).getTable(n).ajouter(r)},i.prototype.onSupprimer=function(e){var t=e.base,n=e.table,r=e.cles;return this.managerInstance.getBase(t).getTable(n).supprimer(r)},i.prototype.onModifier=function(e){var t=e.base,n=e.table,r=e.elements;return this.managerInstance.getBase(t).getTable(n).mettreAJour(r)},i.prototype.onResetAll=function(){var r=this;return this.managerInstance.getBases().then(function(e){var n=[];return e.forEach(function(e){var t=r.managerInstance.getBase(e);t.getTables().forEach(function(e){n.push(t.getTable(e).resetAll())})}),r.library.Core.getServiceDePromesse().all(n).then(function(){})})},i.prototype.reception=function(e){switch(e.subject){case n.Messages.BaseDeDonneesMessageSubject.GetBases:var t=e.message;return this.onGetBases();case n.Messages.BaseDeDonneesMessageSubject.Get:return t=e.message,this.onGet(t);case n.Messages.BaseDeDonneesMessageSubject.GetAll:return t=e.message,this.onGetAll(t);case n.Messages.BaseDeDonneesMessageSubject.Find:return t=e.message,this.onFind(t);case n.Messages.BaseDeDonneesMessageSubject.Count:return t=e.message,this.onCount(t);case n.Messages.BaseDeDonneesMessageSubject.Ajouter:return t=e.message,this.onAjouter(t);case n.Messages.BaseDeDonneesMessageSubject.Supprimer:return t=e.message,this.onSupprimer(t);case n.Messages.BaseDeDonneesMessageSubject.MettreAJour:return t=e.message,this.onModifier(t);case n.Messages.BaseDeDonneesMessageSubject.ResetAll:return t=e.message,this.onResetAll();default:return r.prototype.reception.call(this,e)}},o=i,n.BaseDeDonneesManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.JAB)||this}t=e.Services||(e.Services={}),n=t.JAB||(t.JAB={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.reception=function(e){switch(e.subject){case n.JABMessageSubject.Enregistrer:var t=e.message.data;return this.managerInstance.enregistrer(t);default:return r.prototype.reception.call(this,e)}},i.CLASS_NAME="MyWay.Services.JAB.JABManagerMessage",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.JABManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(r){var u;(function(f){u.CoreCommon.addListenerOnCheckSettings(function(e){!e.authentificationInfo&&e.withHeaders&&u.ServiceManager&&u.ServiceManager.Instance()&&u.ServiceManager.Instance().Library&&u.ServiceManager.Instance().Library.Context&&(e.authentificationInfo=u.ServiceManager.Instance().Library.Context.GetAuthentificationInfo())}),u.ServiceManager.addActionOnInitialize("Context.GetInfosUserApi",function(e){return e.Context.GetInfosUserApi()}),u.ServiceManager.addActionOnInitialize("Context.GetDonneesLocales",function(e){return e.Context.GetDonneesLocales()}),u.ServiceManager.addActionOnInitialize("Context.SetPortalInformation",function(e){return e.Context.SetPortalInformation()},"Context.GetDonneesLocales");var i,a=function(e,t){this.level=e,this.value=t},e=(i=u.Components.ComponentManagerBase,__extends(s,i),s.prototype.init=function(e,t,n,r){var o=this;return this.api=r,this._context=s._initContext(),this._portalIndex=0,this._useDiagnostic=n.isTotemCapable,this._storageNotification=e.Persistence.addStorage("notifications.context",function(){o.OnContextStorageChanged()}),i.prototype.init.call(this,e,t,n,r)},s.prototype.AddToContextAsync=function(n,r,o){var i=this;return u.CoreCommon.promesseTryCatch(function(e){var t=i.AddToContext(n,r,o);e.resolve(t)})},s.prototype.RemoveFromContextAsync=function(n,r){var o=this;return u.CoreCommon.promesseTryCatch(function(e){var t=o.RemoveFromContext(n,r);e.resolve(t)})},s.prototype.AddListToContextAsync=function(n,r,o){var i=this;return u.CoreCommon.promesseTryCatch(function(e){var t=i.AddListToContext(n,r,o);e.resolve(t)})},s.prototype.GetFromContextAsync=function(n){var r=this;return u.CoreCommon.promesseTryCatch(function(e){var t=r._getFromContext(n);t?(s.logger.debug("lecture dans le contexte %1 de %2: %3",t.level,n,t.value),e.resolve(t.value)):(s.logger.warn("echec de lecture dans le contexte de %1",n),e.resolve(null))})},s.prototype.GetFromSharedContextAsync=function(n){var r=this;return u.CoreCommon.promesseTryCatch(function(e){var t=r._getFromSharedContext(n);t?(s.logger.debug("lecture dans le contexte %1 de %2: %3",t.level,n,t.value),e.resolve(t.value)):(s.logger.warn("echec de lecture dans le contexte de %1",n),e.resolve(null))})},s.prototype.GetCurrentStepInfoAsync=function(){var n=this;return u.CoreCommon.promesseTryCatch(function(e){var t=n.GetCurrentStepInfo();e.resolve(t)})},s.prototype.GetListFromContextAsync=function(n){var r=this;return u.CoreCommon.promesseTryCatch(function(e){var t=r.GetListFromContext(n);e.resolve(t)})},s.prototype.GetAuthentificationInfoAsync=function(){var n=this;return u.CoreCommon.promesseTryCatch(function(e){var t=n.GetAuthentificationInfo(!1);e.resolve(t)})},s.prototype.GetParametresComptablesAsync=function(){var n=this;return u.CoreCommon.promesseTryCatch(function(e){var t=n.GetParametresComptables();e.resolve(t)})},s.prototype.GetWaitingProcessesAsync=function(){var n=this;return u.CoreCommon.promesseTryCatch(function(e){var t=n.GetWaitingProcesses();e.resolve(t)})},s.prototype.GetCurrentProcessIdAsync=function(){var n=this;return u.CoreCommon.promesseTryCatch(function(e){var t=n.GetCurrentProcessId();e.resolve(t)})},s.prototype.GetCurrentStepIdAsync=function(){var n=this;return u.CoreCommon.promesseTryCatch(function(e){var t=n.GetCurrentStepId();e.resolve(t)})},s.prototype.GetCurrentMainProcessAsync=function(){var n=this;return u.CoreCommon.promesseTryCatch(function(e){var t=n.GetCurrentMainProcess();e.resolve(t)})},s.prototype.setIsMyWayUrl=function(e){this.library.Display.CurrentFrame.IsMyWayUrl=e},s.prototype.SendEvent=function(e){return i.prototype.SendEvent.call(this,e)},s.prototype.InitSinglePortalContext=function(){this._singlePortalContext&&this._singlePortalContext.processes&&1<=this._singlePortalContext.processes.length&&this.SetSingleProcess(this._singlePortalContext.processes[0].id)},s._initContext=function(){var e,t=u.Storage.ContextStorage.Get();if(t&&(e=r.Services.Context.ContextImpl.clone(JSON.parse(t))),!e){(e=new r.Services.Context.ContextImpl).portals=[],e.waitingProcesses=[],e.globalStorage=[],e.sharedStorage=[];var n=s.AddNewPortalToContext(e);s._saveContext(n)}return e},s._reloadContext=function(){var e,t=u.Storage.ContextStorage.Get();return t&&(e=r.Services.Context.ContextImpl.clone(JSON.parse(t))),e},s.prototype.ReloadContext=function(){return s._reloadContext()},s._saveContext=function(e){u.Storage.ContextStorage.Set(JSON.stringify(e))},s.prototype.SaveContext=function(){s._saveContext(this._context),this._storageNotification.saveValue(Math.random())},s.AddNewPortalToContext=function(e){var t=s.CreatePortalContext();return e.portals.push(t),e},s.CreatePortalContext=function(){var e=new r.Services.Context.PortalContext;return e.temporayContextStorage=[],e.processes=[],e.currentPath=null,e},Object.defineProperty(s.prototype,"PortalCount",{get:function(){return this._context.portals.length},enumerable:!0,configurable:!0}),s.prototype.OnContextStorageChanged=function(){this._context=s._initContext();var e=this._portalIndex;e>=this._context.portals.length&&(e=this._context.portals.length-1),e!==this._portalIndex&&(this._portalIndex=e),this.InitSinglePortalContext();var t=this.GetPortalContext();this.SendPortalContext(!0,"OnContextStorageChanged"),this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.PortalContextChanged,{portalContext:t,info:"OnContextStorageChanged"})),this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.ContextRecharge,{}))},s.prototype.DisplayProcesses=function(e){void 0===e&&(e=!1),s.logger.debug("DisplayProcesses");var t=!1,n=u.CoreCommon.ServiceDePromesse.defer();this.library.Display.CleanFrames(this.GetPortalContext().processes);var r=this.GetCurrentProcess();if(r){var o=this.GetCurrentStep(r);o&&(s.logger.debug("Current step is : %1",o.getPath()),o.displayTime||(o.displayTime=Date.now()),t=!0,this.DisplayProcessUrl(o.url,null,e).then(function(e){e&&(o.displayTime=Date.now(),s.logger.info("Display Step "+o.id)),n.resolve(e)}))}return t||n.resolve(!1),n.promise},s.prototype.DisplayProcessUrl=function(e,t,n){return void 0===n&&(n=!1),s.logger.debug("DisplayProcessUrl"),t=t||this.GetMainProcessId(),this.library.Display.AfficherUrl(e,t,n)},s.prototype.GetPortalContext=function(e){return void 0===e&&(e=!0),this._singlePortalContext&&e?this._singlePortalContext:this._context.portals[this._portalIndex]},s.prototype.GetCurrentProcessId=function(){var e=this.GetCurrentProcess();return e?e.id:null},s.prototype.GetMainProcessId=function(){var e=this.GetPortalContext();return f.PortalContext.GetPathPart(e.currentPath,f.PATH_PART.MAIN_PROCESS_ID)},s.prototype.GetCurrentStepId=function(){var e=this.GetCurrentProcess();if(e){var t=this.GetCurrentStep(e);if(t)return t.id}return null},s.prototype.IsSingleProcess=function(){return!(!this._singlePortalContext||!this._singlePortalContext.currentPath)},s.prototype.GetCurrentProcess=function(){return this.GetPortalContext().GetCurrentProcess()},s.prototype.GetCurrentMainProcess=function(){return this.GetPortalContext().GetCurrentMainProcess()},s.prototype.GetParentProcess=function(e){var t=this.GetPortalContext();return f.PortalContext.GetProcessByPath(e.id,t.processes)},s.prototype.GetCurrentProcessCode=function(){var e=this.GetCurrentProcess();if(e){var t=e.getPath(),n=f.PortalContext.GetPathPart(t,f.PATH_PART.LAST_PROCESS_ID);return n&&0<n.indexOf("-")&&(n=n.split("-")[0]),n}return null},s.prototype.GetProcessById=function(e,t){for(var n in t=t||this.GetPortalContext().processes){var r=t[n];if("Process"===r.type){var o=r;if(o.id===e)return o;var i=this.GetProcessById(e,o.subElements);if(i)return i}}return null},s.prototype.GetAllProcessFromAllPortails=function(){var t=[],e=this.GetWaitingProcesses();e&&e.forEach(function(e){t.push(e)});var n=this.getPortails();return n&&n.forEach(function(e){e.processes&&e.processes.forEach(function(e){t.push(e)})}),t},s.prototype.GetProcessByIdFromAllPortails=function(t){var n=null,e=this.GetWaitingProcesses();if(e)for(var r=0,o=e;r<o.length;r++){var i=o[r];if(i.id===t){n=i;break}}if(!n){var s=this.getPortails();s&&s.every(function(e){if(e.processes)return e.processes.every(function(e){return e.id===t&&(n=e),null===n}),null===n})}return n},s.prototype.GetProcessStepById=function(e){var t=f.PortalContext.GetPathPart(e,f.PATH_PART.STEP_ID),n=e.replace("|"+t,""),r=this.GetProcessById(n);if(r)for(var o in r.subElements){var i=r.subElements[o];if(i.id===t)return i}return null},s.prototype.GetWaitingProcess=function(e){for(var t in this._context.waitingProcesses){var n=this._context.waitingProcesses[t];if(n.id===e)return n}return null},s.prototype.GetCurrentStep=function(e){if(!e)return null;for(var t in e.subElements){var n=e.subElements[t];if(n.id===e.currentInnerElementPath)return n}return null},s.prototype.SetSingleProcess=function(e){var t=!1;for(var n in this._singlePortalContext=s.CreatePortalContext(),this._singlePortalContext.isSingle=!0,this.listenerOnChangePortailType&&this.listenerOnChangePortailType("singleWithProcess"),this._context.waitingProcesses){var r=this._context.waitingProcesses[n];if(r.id===e){this._singlePortalContext.processes.push(r),this._singlePortalContext.currentPath=r.getPath(),t=!0;break}}return t},s.prototype.setOnChangePortailType=function(e){this.listenerOnChangePortailType=e},s.prototype.GetWaitingProcesses=function(){return this._context.waitingProcesses},s.prototype.getPortails=function(){return this._context.portals},s.prototype.PutProcessInWait=function(e){var t=this._context.portals[this._portalIndex],n=s._removeProcess(t,e);return n&&(n.putInWaitTime=Date.now(),this._context.waitingProcesses.push(n),this.SaveContext()),t},s.prototype.PutProcessInWaitAsync=function(t,n){var r=this,e=new u.NotificationMessage;e.Sujet="MEP",this.Notify(e).then(function(){var e=r.PutProcessInWait(t);n(e)})},s.prototype.PutProcessInPortalContext=function(e){for(var t=-1,n=0;n<this._context.waitingProcesses.length;n++)if(this._context.waitingProcesses[n].id===e){t=n;break}var r=this._context.portals[this._portalIndex];if(0<=t){var o=this._context.waitingProcesses.splice(t,1)[0];r.processes.push(o),r.currentPath=o.getPath(),this.SaveContext()}return r},s.prototype.Notify=function(e){return this.sendMessageWithFrame(f.ContextMessageSubject.Notification,e,this.library.Display.CurrentFrame)},s.prototype.NotifyFrame=function(e,t){return this.sendMessageWithFrame(f.ContextMessageSubject.Notification,e,t)},s.prototype.Share=function(t,e,n){var r=this,o=this.GetPortalContext().GetProcess(t);o&&(o.putInWaitTime=Date.now(),this.api.ShareProcess(o,e).then(function(){var e=r._context.portals[r._portalIndex];s._removeProcess(e,t),r.SaveContext(),n(e)},function(e){}))},s.prototype.PutTaskInPortalContext=function(e){var n=this;return this.api.RemoveProcess(e).then(function(e){var t=n._context.portals[n._portalIndex];return t.processes.push(e),t.currentPath=e.getPath(),n.SaveContext(),t})},s.prototype.RemoveCurrentPortal=function(){if(0==this._portalIndex)throw"can't remove first portal";var e=this.GetPortalContext();if(0<e.processes.length)throw"can't remove portal with processes";return e=this.ChangePortalIndex(this._portalIndex-1),this._context.portals.splice(this._portalIndex+1,1),this.SaveContext(),e},s.prototype.AddToContext=function(e,t,n){return this.AddListToContext(e,[{Key:t,Value:n}])},s.prototype.RemoveFromContext=function(e,t){return this.RemoveListFromContext(e,[t])},s.prototype.ClearContext=function(){u.Storage.ContextStorage.Set(""),this._context=s._initContext(),this.InitSinglePortalContext()},s.prototype.GetDonneesLocales=function(){var t=this;return this.api?(s.logger.debug("ServiceApi Start GetDonneesLocales"),this.api.GetDonneesLocales().then(function(e){s.logger.debug("ServiceApi End GetDonneesLocales"),e&&(e.AuthentificationInfo&&t.SetContextAuthentificationInfo(e.AuthentificationInfo),e.ParametresComptables&&t.AddToContext(f.StorageLevel.Global,"ParametresComptables",JSON.stringify(e.ParametresComptables)),e.ParametresNumerisation&&t.AddToContext(f.StorageLevel.Global,"ParametresNumerisation",JSON.stringify(e.ParametresNumerisation)),e.ParametresServeurPoste&&t.AddToContext(f.StorageLevel.Global,"ParametresServeurPoste",JSON.stringify(e.ParametresServeurPoste)))})):u.Promesses.getPromesseSelfResoved()},s.prototype.GetAuthentificationInfo=function(e){void 0===e&&(e=!0);var t=this._getAuthenticationInfoFromContext();return null!=t||e||this.library.Display.DisplayLogOn(),t},s.prototype.getAuthentificationInfo=function(){var o=this;return this.library.Core.promesseTryCatch(function(n){var e=o.GetAuthentificationInfo(!1);if(null!==e)n.resolve(e);else{var r=function(e){var t=o.GetAuthentificationInfo();t?(o.library.Evennements.retirerListener(r),n.resolve(t)):n.reject(new u.Erreur("Il n'a pas été possible de récupérer les informations d'authenfications."))};o.ajouterListenerEvent(u.Component.ManagerEventType.ChangementAuthentificationInfo,r)}})},s.prototype.SetContextAuthentificationInfo=function(e){this.AddToContext(f.StorageLevel.Global,"AuthentificationInfo",JSON.stringify(e)),this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.ChangementAuthentificationInfo,{}))},s.prototype._getAuthenticationInfoFromContext=function(){var e=this.GetFromContext("AuthentificationInfo");return e?JSON.parse(e):null},s.prototype.GetParametresComptables=function(){var e=this.GetFromContext("ParametresComptables");return e?JSON.parse(e):null},s.prototype.GetInfosUserApi=function(){var t=this;return this.api.GetInfosUserApi().then(function(e){e&&t.AddToContext(f.StorageLevel.Global,"InfosUser",JSON.stringify(e))})},s.prototype.GetInfosUser=function(){var e=this.GetFromContext("InfosUser");return e?JSON.parse(e):null},s.prototype.GetInfosUserOnce=function(){return this._infosUser||(this._infosUser=this.GetInfosUser()),this._infosUser},s.prototype.ClearParametresComptables=function(){this.AddToContext(f.StorageLevel.Global,"ParametresComptables","")},s.prototype.AddListToContext=function(e,t,n){var r=this._getStorage(e,n);if(r){this.CheckData(e,t);for(var o=[],i=0,s=t;i<s.length;i++){var a=s[i];a.Key&&null!==a.Value&&(o.push(a.Key),this._addToContextArray(r,{Key:a.Key,Value:a.Value}),e===f.StorageLevel.Global&&"AuthentificationInfo"===a.Key&&this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.ChangementAuthentificationInfo,{})))}if(this.SaveContext(),e===f.StorageLevel.Global&&this.SendPortalContext(!0,"Add to global context: "+JSON.stringify(o)),e===f.StorageLevel.Shared){var c=JSON.stringify(this._context.sharedStorage);u.CoreCommon.SendRequest({url:u.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/fichier/ecrire?pathFichier="+this._pathFileSharedContext+"&ajouter=false&creeDir=false",data:c,contentType:u.ContentTypeEnum.JSON,method:u.MethodEnum.POST,type:"POST",async:!1},function(e){},function(e){})}return!0}return!1},s.prototype.CheckData=function(e,t){if(e===f.StorageLevel.MainProcess||e===f.StorageLevel.Process){var n=0;for(var r in t){var o=t[r];if(o&&o.Value){var i=this.GetLength(o.Value);5e3<i&&s.logger.warn("Attention, la donnée ajoutée dans le contexte dépasse %3 caractères. Clé=%1; Taille=%2",o.Key,i,5e3),n+=i}}1e5<(n+=this.GetCurrentProcessContextSize())&&s.logger.warn("Attention, les données ajoutées dans le contexte de processus dépasse %2 caractères. Taille=%1",n,1e5)}},s.prototype.GetLength=function(e){return"object"==typeof e?JSON.stringify(e).length:"string"==typeof e?e.length:0},s.prototype.GetCurrentProcessContextSize=function(){return this.GetProcessContextSize(this.GetCurrentMainProcess())},s.prototype.GetProcessContextSize=function(e){var t=0;for(var n in e.contextStorage)e.contextStorage[n]&&e.contextStorage[n].Value&&(t+=this.GetLength(e.contextStorage[n].Value));for(var n in e.subElements){var r=e.subElements[n];"Process"==r.type&&(t+=this.GetProcessContextSize(r))}return t},s.prototype.RemoveListFromContext=function(e,o,t){var i=this,n=this._getStorage(e,t);if(n){for(var r in o)this._removeFromContextArray(n,o[r]);return e===f.StorageLevel.Shared&&u.CoreCommon.SendRequest({url:u.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/fichier/lire?pathFichier="+this._pathFileSharedContext,contentType:u.ContentTypeEnum.JSON,method:u.MethodEnum.GET,async:!1,cache:!1},function(e){var n=JSON.parse(e);for(var r in o)n.some(function(e,t){o[r]===e.Key&&n.splice(t,1)[0]});var t=JSON.stringify(n);u.CoreCommon.SendRequest({url:u.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/fichier/ecrire?pathFichier="+i._pathFileSharedContext+"&ajouter=false&creeDir=false",data:t,contentType:u.ContentTypeEnum.JSON,method:u.MethodEnum.POST,type:"POST",async:!1},function(e){},function(e){})},function(e){}),this.SaveContext(),!0}return!1},s.prototype._getStorage=function(e,t){var n;if(e===f.StorageLevel.Global)n=this._context.globalStorage;else if(e===f.StorageLevel.Shared)n=this._context.sharedStorage;else if(e===f.StorageLevel.Tempo)n=this._context.portals[this._portalIndex].temporayContextStorage;else if(e===f.StorageLevel.Process){var r=null;if(!(r=t?this.GetProcessById(t):this.GetCurrentProcess()))throw"process not found";n=r.contextStorage}else if(e===f.StorageLevel.Step){var o=null;if(!(o=t?this.GetProcessStepById(t):this.GetCurrentStep(this.GetCurrentProcess())))throw"processStep not found";n=o.contextStorage}else{if(e!==f.StorageLevel.MainProcess)throw"le niveau '"+e+"' n'est pas valable";if(!(r=this.GetCurrentProcess()))throw"no current process";for(var i=r;r;)(r=this.GetParentProcess(r))&&(i=r);n=i.contextStorage}return n},s.prototype.setContextClientIdOnProcessus=function(e,t,n){for(var r in t.contexteClientId=e,t.subElements){var o=t.subElements[r];"Process"===o.type&&this.setContextClientIdOnProcessus(e,o,!0)}n||this.SaveContext()},s.prototype.GetFromContext=function(e){var t=this._getFromContext(e);return t?t.value:null},s.prototype.ChangeMainProcessNameAsync=function(n){var r=this;return u.CoreCommon.promesseTryCatch(function(e){var t=r.ChangeMainProcessName(n);e.resolve(t)})},s.prototype.ChangeMainProcessName=function(e){return this.ChangeProcessName(e,this.GetMainProcessId())},s.prototype.ChangeProcessName=function(e,t){var n=this.GetProcessById(t,null);if(n&&(n.displayName=e,this.SaveContext()),this.onProcessNameChanged)try{this.onProcessNameChanged(t,e)}catch(e){u.Loggers.FLASH.INSTANCE.setValue("action","ChangeProcessName"),u.Loggers.FLASH.INSTANCE.setValue("details",e),s.logger.error("une erreur est survenue lors de la notification de changement de nom")}return this.GetPortalContext()},s.prototype.GetCurrentStepInfo=function(){var e=this.GetCurrentProcess();if(!e)return null;var t=this.GetCurrentStep(e);if(!t)return null;var n,r=new f.StepInfoExtended;r.StepCode=t.codeEtape,r.BusinessCode=t.codeMetier,r.ProcessCode=e.codeProcess,r.ProcessType=e.typeProcess,r.ValeurEntree=t.valeurEntree,r.PreviousStepEndTime=e.lastNextTime,r.DiagnosticTraceSentForStep=t.diagnosticTraceSentForStep,r.StartTime=t.creationDate;var o=t.displayTime;for(var i in o<e.lastNextTime&&(o=e.lastNextTime),r.DisplayTime=o,t.authorizedOutputs)r.AuthorizedOutputs.push(t.authorizedOutputs[i]);for(var s in t.contrats)(n=new f.ContratInfo).NomData=t.contrats[s].Code,n.Mode=t.contrats[s].Mode,r.Contrats.push(n);switch(r.CurrentProcessId=e.id,r.CurrentParentProcessId=f.PortalContext.GetPathPart(e.id,f.PATH_PART.MAIN_PROCESS_ID),r.CurrentStepId=t.id,r.CurrentPath=r.CurrentProcessId+"|"+r.CurrentStepId,r.NomComposant=t.nomApplication,r.VersionComposant=u.CoreCommon.VersionMySys,u.PrivatePortalServiceParameters.Instance().ModeDebug){case!0:r.NiveauTrace=4;break;default:r.NiveauTrace=3}return r.Diagnostic=this._useDiagnostic,r},s.prototype.GetObjectFromContext=function(e){for(var t={},n=0,r=this.GetListFromContext(e);n<r.length;n++){var o=r[n];t[o.Key]=o.Value}return t},s.prototype.GetTypedObjectFromContext=function(e){var t=Object.keys(e),n=this.GetListFromContext(t),r={};for(var o in n){var i=n[o];r[i.Key]=i.Value}return r},s.prototype.GetListFromContext=function(e,t,n){var r;for(var o in r=[],e){var i=e[o],s=void 0;(s=!t||i.indexOf(".")<0?this._getFromContext(i,n):this._getObjectPropFromContext(i,n))&&r.push({Key:i,Value:s.value})}return r},s.prototype.SwitchToProcess=function(e){var t,n=this._context.portals[this._portalIndex];for(var r in n.processes){var o=n.processes[r];if(o.id===e){t=o;break}}if(!t)throw"process '"+e+"' not found";return n.currentPath!==t.getPath()&&(n.currentPath=t.getPath(),this.SaveContext(),!0)},s.prototype.SwitchToProcessAsync=function(e,t){this.SwitchToProcess(e),t(this.GetPortalContext())},s.prototype.RemoveProcess=function(e){var n=this,t=this.GetPortalContext(),r=s._removeProcess(t,e);return r&&(this._singlePortalContext&&this._context.waitingProcesses.some(function(e,t){if(e.id===r.id)return n._context.waitingProcesses.splice(t,1)[0],!0}),this.SaveContext()),this.GetPortalContext()},s.prototype.RemoveCurrentProcess=function(){var n,r=this,e=this.GetCurrentProcess(),t=this.GetPortalContext();return(n=0===e.id.indexOf("|")?s._removeProcess(t,e.id):(t.isSingle,this.RemoveSubProcess(t,e.id+"|",t.processes,this.GetParentProcess(e))))&&(this._singlePortalContext&&this._context.waitingProcesses.some(function(e,t){if(e.id===n.id)return r._context.waitingProcesses.splice(t,1)[0],!0}),this.SaveContext()),this.GetPortalContext()},s.prototype.RemoveWaitingProcesses=function(){var e=[];for(var t in this._context.waitingProcesses)e.push(t);for(var n=e.length;n--;)this._context.waitingProcesses.splice(e[n],1);return this.SaveContext(),this.GetPortalContext()},s._removeProcess=function(e,t){for(var n=-1,r=0;r<e.processes.length;r++)if(e.processes[r].id===t){n=r;break}var o=null;return 0<=n&&(o=e.processes.splice(n,1)[0],0===e.processes.length?e.currentPath=null:n<=e.processes.length-1?e.currentPath=e.processes[n].getPath():e.currentPath=e.processes[e.processes.length-1].getPath()),o},s.prototype.RemoveSubProcess=function(e,t,n,r){for(var o=-1,i=f.PortalContext.GetPathPart(t,f.PATH_PART.MAIN_PROCESS_ID),s=f.PortalContext.GetPathPart(t,f.PATH_PART.LAST_PROCESS_ID),a=0;a<n.length;a++)if("Process"===(l=n[a]).type){var c=l;if(f.PortalContext.GetPathPart(c.id,f.PATH_PART.STEP_ID)===i){if(i!==s)return this.RemoveSubProcess(e,t.replace(i+"|",""),c.subElements,c);o=a;break}}var u=null;if(0<=o){u=n.splice(o,1)[0];var l,p=this.GetParentProcess(u);0<n.length?"Process"===(l=n[n.length-1]).type?e.currentPath=l.getPath():(p.currentInnerElementPath=l.id,e.currentPath=p.id+"|"+l.id):e.currentPath=""}return u},s.prototype.RemoveCurrentStep=function(e){var t;if(this.GetPortalContext(),!(t=this.GetCurrentProcess()))throw"no current process";for(var n=t.currentInnerElementPath;0<t.currentInnerElementPath.indexOf("|");){var r=f.PortalContext.GetPathPart(t.currentInnerElementPath,f.PATH_PART.MAIN_PROCESS_ID),o=this.GetProcessById(t.id+"|"+r,t.subElements);if(e&&o.codeEtape===e){n=o.id;break}n=(t=o).currentInnerElementPath}return this.RemoveStep(n,t.id)},s.prototype.RemoveStep=function(e,t){var n,r,o=this.GetPortalContext(),i=this.GetProcessById(t),s=this._getStepById(i,e);if(s&&s.boundId)r=this._getIndexesByBoundId(i,s.boundId);else{r=[];var a=this._getStepIndexById(i,e);0<=a&&r.push(a)}if(r&&0<r.length){i.subElements.splice(r[0],r.length);var c=void 0;n=0<i.subElements.length?(c=r[0]<=i.subElements.length-1?i.subElements[r[0]]:i.subElements[i.subElements.length-1],i.currentInnerElementPath=c.id,o.currentPath=i.getPath(),this.SaveContext(),o):this.RemoveProcess(i.id)}return n},s.prototype.ChangePortalIndex=function(e){return 0<=e&&e<this._context.portals.length&&(this._portalIndex=e,this.SaveContext()),this._context.portals[this._portalIndex]},s.prototype.AddAndGetNewPortal=function(){return this._context=s.AddNewPortalToContext(this._context),this._portalIndex=this._context.portals.length-1,this.SaveContext(),this._context.portals[this._portalIndex]},s.prototype.AddNewPortal=function(){return this._context=s.AddNewPortalToContext(this._context),this.SaveContext(),this._context.portals.length-1},s.prototype.GetPortalIndex=function(){return this._portalIndex},s.prototype.ClearCurrentPath=function(){this.GetPortalContext().currentPath=null,this.SaveContext()},s.prototype._getObjectPropFromContext=function(e,t){var n=e.split("."),r=this._getFromContext(n[0]);if(!r)return t?new a("unknown",""):null;var o=null;t&&(o="");try{for(var i=JSON.parse(r.value),s=1;s<n.length;s++)i=o=i[n[s]]}catch(e){}return new a(r.level,o)},s.prototype._getFromContext=function(e,t){var n=this.GetCurrentProcess(),r="",o=this._getFromContextArray(this._context.portals[this._portalIndex].temporayContextStorage,e);if(null!=o&&(r="tempo",this._removeFromContextArray(this._context.portals[this._portalIndex].temporayContextStorage,e),this.SaveContext()),null==o&&n){var i=this.GetCurrentStep(n);i&&(r="processStep",o=this._getFromContextArray(i.contextStorage,e))}for(var s=n;null==o&&s;)r="process",(o=this._getFromContextArray(s.contextStorage,e))||(s=this.GetParentProcess(s));return null==o&&(r="global",o=this._getFromContextArray(this._context.globalStorage,e)),null==o&&(r="shared",o=this._getFromContextArray(this._context.sharedStorage,e)),null!=o?new a(r,o):t?new a(r,""):null},s.prototype._getFromSharedContext=function(e,t){this.GetCurrentProcess();var n="",r=this._getFromContextArray(this._context.portals[this._portalIndex].temporayContextStorage,e);return null==r&&(n="shared",this.ReloadSharedContext(),r=this._getFromContextArray(this._context.sharedStorage,e)),null!=r?new a(n,r):t?new a(n,""):null},s.prototype.ReloadSharedContext=function(){var t=this;u.CoreCommon.SendRequest({url:u.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/fichier/lire?pathFichier="+this._pathFileSharedContext,contentType:u.ContentTypeEnum.JSON,method:u.MethodEnum.GET,async:!1,cache:!1},function(e){t._context.sharedStorage=JSON.parse(e)},function(e){})},s.prototype._addToContextArray=function(e,t){for(var n in e){var r=e[n];if(t.Key===r.Key)return void(r.Value=t.Value)}e.push(t)},s.prototype._getFromContextArray=function(e,t){for(var n in e){var r=e[n];if(t===r.Key)return r.Value}},s.prototype._removeFromContextArray=function(n,r){n.some(function(e,t){if(r===e.Key)return n.splice(t,1)[0],!0})},s.prototype._getStepById=function(e,t){if(e&&e.subElements)for(var n in e.subElements){var r=e.subElements[n];if(r.id===t)return r}return null},s.prototype._getStepIndexById=function(e,n){var r=-1;return e&&e.subElements&&e.subElements.forEach(function(e,t){e.id===n&&(r=t)}),r},s.prototype._getIndexesByBoundId=function(e,n){var r=[];return e&&e.subElements&&e.subElements.forEach(function(e,t){e.boundId===n&&r.push(t)}),r},s.prototype.SendPortalContext=function(e,t){var n=this.GetPortalContext();this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.PortalContextChanged,{portalContext:n,demandeDeDemarrageDeProcessusDetail:{onlyHeader:e},info:t}))},s.prototype.AnalyseApp=function(e){this.sendMessage(f.ContextMessageSubject.AnalyseApp).then(e)},s.prototype.SetPortalInformation=function(){var n=this,r=u.CoreCommon.ServiceDePromesse.defer();if(this.api){s.logger.debug("GetPortalInformation");var e=this.GetAuthentificationInfo();e?this.api.GetPortalInformation(e).then(function(e){if(s.logger.debug("GetPortalInformation"),e&&e.urlCultureNet)n.AddToContext(f.StorageLevel.Global,"URLCultureNet",e.urlCultureNet),r.resolve();else{var t="Aucune information trouvée. portalInformation: "+JSON.stringify(e);s.logger.error(t),r.reject(new u.Erreur(t))}},function(e){s.logger.error("Erreur lors de SetPortalInformation: %1",JSON.stringify(e)),r.reject(e)}):(s.logger.error("Aucune données d'authentification présente"),r.reject())}else r.resolve();return r.promise},s.prototype.SetDiagnosticTraceSentForStep=function(e){this.GetProcessStepById(e).diagnosticTraceSentForStep=!0,this.SaveContext()},s.prototype._portail_terminerProcess=function(e){s.logger.info("TerminerProcess");var t=u.CoreCommon.ServiceDePromesse.defer(),n=this.GetProcessByIdFromAllPortails(e);if(!n)return t.resolve(!1),t.promise;this.listenerOnTerminerProcessus.forEach(function(e){e(n)});var r=this.RemoveProcess(e);return this.library.Display.RemoveProcessIFrame(e),this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.FinDeProcessus,{portalContext:r,info:e})),0<r.processes.length&&(this.DisplayProcesses(),this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.BasculeProcess,{portalContext:r,info:e}))),t.resolve(!0),t.promise},s.prototype._portail_terminerAllProcess=function(){var t=this;s.logger.info("TerminerTousLesProcess");var e=u.CoreCommon.ServiceDePromesse.defer(),n=this.GetPortalContext(),r=[];return n?(n.processes.forEach(function(e){r.push(t._portail_terminerProcess(e.id))}),u.Promesses.all(r).then(function(){return!0},function(e){throw s.logger.warn("EndAllProcess Failed",JSON.stringify(e)),e})):(e.resolve(!1),e.promise)},s.prototype.addListenerOnTerminerProcessus=function(e){this.listenerOnTerminerProcessus.push(e)},s.prototype.removeListenerOnTerminerProcessus=function(t){u.CoreCommon.ArrayUtils.remove(this.listenerOnTerminerProcessus,function(e){return e===t})},s.prototype._portail_extraireProcess=function(e){var t=u.CoreCommon.ServiceDePromesse.defer(),n=this.PutProcessInWait(e);this.library.Display.RemoveProcessIFrame(e),this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.Extraction,{portalContext:n})),0<n.processes.length&&(this.DisplayProcesses(),this.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.BasculeProcess,{portalContext:n})));var r=u.PrivatePortalServiceParameters.Instance().LisaPlaceholders["URL-SPA"]+u.PrivatePortalServiceParameters.Instance().LisaPlaceholders.ALIASPORTAIL+"/?i="+e;return window.open(r),t.resolve(!0),t.promise},s.CLASS_NAME="MyWay.Services.Context.ContextManager",s.logger=u.Loggers.LoggerFactory.INSTANCE.getClass(s.CLASS_NAME),s);function s(){var e=i.call(this,u.Components.ComponentType.Context)||this;return e.api=null,e._portalIndex=0,e._storageNotification=null,e._useDiagnostic=!1,e.listenerOnTerminerProcessus=[],e._infosUser=null,e._pathFileSharedContext="%APPDATA%\\sharedContext.txt",e.listenerOnChangePortailType=null,e}f.ContextManager=e,u.Components.RegistryManager.getInstance().register(e)})((u=r.Services||(r.Services={})).Context||(u.Context={}))}(MyWay=MyWay||{}),function(e){var o;(function(a){function e(){}a.ContextKeyValuePair=e;var t=(s.clone=function(e){var t=new s;for(var n in t.portals=[],e.portals){var r=e.portals[n];t.portals.push(c.clone(r))}for(var n in t.globalStorage=[],e.globalStorage){var o=e.globalStorage[n];t.globalStorage.push({Key:o.Key,Value:o.Value})}for(var n in t.sharedStorage=[],e.sharedStorage)o=e.sharedStorage[n],t.sharedStorage.push({Key:o.Key,Value:o.Value});for(var n in t.waitingProcesses=[],e.waitingProcesses){var i=e.waitingProcesses[n];t.waitingProcesses.push(l.clone(i))}return t},s);function s(){}a.ContextImpl=t;var c=(u.clone=function(e){var t=new u;for(var n in t.temporayContextStorage=[],e.temporayContextStorage){var r=e.temporayContextStorage[n];t.temporayContextStorage.push({Key:r.Key,Value:r.Value})}for(var n in t.processes=[],e.processes){var o=e.processes[n];t.processes.push(l.clone(o))}return t.currentPath=e.currentPath,t.isSingle=e.isSingle,t},u.GetPathPart=function(e,t){var n=null;if(e){var r=e.split("|");switch(t){case a.PATH_PART.MAIN_PROCESS_ID:n=r[0];break;case a.PATH_PART.STEP_ID:n=r[r.length-1];break;case a.PATH_PART.LAST_PROCESS_ID:n=r[r.length-2];break;case a.PATH_PART.PREVIOUS_PROCESS_ID:n=r[r.length-3]}}return n},u.GetProcessByPath=function(e,t){var n=u.GetPathPart(e,a.PATH_PART.MAIN_PROCESS_ID),r=u.GetPathPart(e,a.PATH_PART.LAST_PROCESS_ID);for(var o in t){var i=t[o];if("Process"===i.type){var s=i;if(u.GetPathPart(s.id,a.PATH_PART.STEP_ID)===n)return n==r?s:this.GetProcessByPath(e.replace(n+"|",""),s.subElements)}}return null},u.prototype.GetProcess=function(e){if(o.Controle.StaticStringControle.isString(e))for(var t in this.processes){var n=this.processes[t];if(n.id===e)return n}return null},u.prototype.GetProcessByPathPart=function(e,t){return this.GetProcess(u.GetPathPart(e,t))},u.prototype.GetCurrentProcess=function(){return u.GetProcessByPath(this.currentPath,this.processes)},u.prototype.GetCurrentMainProcess=function(){return this.GetProcessByPathPart(this.currentPath,a.PATH_PART.MAIN_PROCESS_ID)},u.prototype.GetCurrentStep=function(e){if(!e)return null;for(var t in e.subElements){var n=e.subElements[t];if(n.id===e.currentInnerElementPath)return n}return null},u);function u(){}a.PortalContext=c;var l=(p.clone=function(e){var t=new p;for(var n in t.contextStorage=[],e.contextStorage){var r=e.contextStorage[n];t.contextStorage.push({Key:r.Key,Value:r.Value})}for(var n in t.subElements=[],e.subElements){var o=e.subElements[n];"ProcessStep"==o.type?t.subElements.push(f.clone(o)):"Process"==o.type&&t.subElements.push(p.clone(o))}for(var i in t.currentInnerElementPath=e.currentInnerElementPath,t.displayName=e.displayName,t.icon=e.icon,t.id=e.id,t.putInWaitTime=e.putInWaitTime,t.knownSteps=e.knownSteps,t.codeEtape=e.codeEtape,t.codeProcess=e.codeProcess,t.typeProcess=e.typeProcess,t.creationDate=e.creationDate,t.estApplicationExterne=e.estApplicationExterne,t.outputContracts=[],e.outputContracts)t.outputContracts.push(e.outputContracts[i]);for(var n in t.authorizedOutputs=[],e.authorizedOutputs){var s=e.authorizedOutputs[n];t.authorizedOutputs.push(s)}return t.isSubProcess=e.isSubProcess,t.contexteClientId=e.contexteClientId,t.lastNextTime=e.lastNextTime,t},p.prototype.getPath=function(){return this.id+"|"+this.currentInnerElementPath},p);function p(){this.type="Process",this.creationDate=Date.now(),this.outputContracts=[]}a.Process=l;var f=(g.clone=function(e){var t=new g;for(var n in t.contextStorage=[],e.contextStorage){var r=e.contextStorage[n];t.contextStorage.push({Key:r.Key,Value:r.Value})}for(var n in t.codeMetier=e.codeMetier,t.nomApplication=e.nomApplication,t.valeurEntree=e.valeurEntree,t.parentPath=e.parentPath,t.id=e.id,t.codeEtape=e.codeEtape,t.codeApplication=e.codeApplication,t.url=e.url,t.boundId=e.boundId,t.isEnd=e.isEnd,e.nextStep&&(t.nextStep=g.clone(e.nextStep)),t.actions=[],e.actions){var o=e.actions[n];t.actions.push(h.clone(o))}for(var n in t.contrats=[],e.contrats){var i=e.contrats[n];t.contrats.push(d.clone(i))}for(var n in t.processusMaitre=e.processusMaitre,t.processName=e.processName,t.maintienIFrame=e.maintienIFrame,t.maintienIFrameLastAction=e.maintienIFrameLastAction,t.authorizedOutputs=[],e.authorizedOutputs){var s=e.authorizedOutputs[n];t.authorizedOutputs.push(s)}return t.etapeResultAsString=e.etapeResultAsString,t.isRouteur=e.isRouteur,t.etatEtape=e.etatEtape,t.creationDate=e.creationDate,t.displayTime=e.displayTime,t.diagnosticTraceSentForStep=e.diagnosticTraceSentForStep,t},g.prototype.getPath=function(){return this.parentPath+"|"+this.id},g);function g(){this.type="ProcessStep"}a.ProcessStep=f;var h=(n.clone=function(e){var t=new n;return t.Nom=e.Nom,t.CodeEtape=e.CodeEtape,t.ValeurSortie=e.ValeurSortie,t.EstExterne=e.EstExterne,t.Options=e.Options,t},n);function n(){}a.StepAction=h;var d=(r.clone=function(e){var t=new r;return t.Code=e.Code,t.Type=e.Type,t.Longueur=e.Longueur,t.Nullable=e.Nullable,t.Mode=e.Mode,t},r);function r(){}a.StepContrat=d})((o=e.Services||(e.Services={})).Context||(o.Context={}))}(MyWay=MyWay||{}),function(e){var i;(i=e.Services||(e.Services={})).PhantomAgent.addListenerOnInit(function(e,t){e.Context=new i.Context.PhantomContextAgent(t)}),i.PhantomAgent.prototype.SendRequest=function(e){var o=this;return i.CoreCommon.promesseTryCatch(function(t){var n=o,r=e;r.logger=i.PhantomAgent.logger,n.Context&&n.Context.StepInfo?(r.stepInfo=n.Context.StepInfo,r.versionComposant=r.stepInfo.VersionComposant):n._serviceManager&&n.Context&&(r.stepInfo=null,r.versionComposant=n.Context.VersionComposant),e.withHeaders?n.Context.GetAuthentificationInfo().then(function(e){r.authentificationInfo=e,n.Context.GetParametresComptables().then(function(e){r.parametresComptables=e,i.CoreCommon.SendRequest(r,function(e){t.resolve(e)},function(e){t.reject(e)})}).catch(t.reject)}).catch(t.reject):i.CoreCommon.SendRequest(r,function(e){t.resolve(e)},function(e){t.reject(e)})})}}(MyWay=MyWay||{}),function(e){var r,o,t;function n(e){this.serviceManager=e}r=e.Services||(e.Services={}),o=r.Context||(r.Context={}),Object.defineProperty(n.prototype,"VersionComposant",{get:function(){return r.CoreCommon.VersionMySys},enumerable:!0,configurable:!0}),n.prototype.AddToContext=function(e,t){var n=r.CoreCommon.ServiceDePromesse.defer();return this.serviceManager.Library.Context.AddToContext(o.StorageLevel.Process,e,t),n.resolve(),n.promise},n.prototype.AddToMainProcessContext=function(e,t){var n=r.CoreCommon.ServiceDePromesse.defer();return this.serviceManager.Library.Context.AddToContext(o.StorageLevel.MainProcess,e,t),n.resolve(),n.promise},n.prototype.AddListToContext=function(e){var t=r.CoreCommon.ServiceDePromesse.defer();return this.serviceManager.Library.Context.AddListToContext(o.StorageLevel.Process,e),t.resolve(),t.promise},n.prototype.GetFromContext=function(e){var t=r.CoreCommon.ServiceDePromesse.defer(),n=this.serviceManager.Library.Context.GetFromContext(e);return t.resolve(n),t.promise},n.prototype.GetObjectFromContext=function(e){var t=r.CoreCommon.ServiceDePromesse.defer(),n=this.serviceManager.Library.Context.GetObjectFromContext(e);return t.resolve(n),t.promise},n.prototype.GetTypedObjectFromContext=function(e){var t=r.CoreCommon.ServiceDePromesse.defer(),n=this.serviceManager.Library.Context.GetTypedObjectFromContext(e);return t.resolve(n),t.promise},n.prototype.GetListFromContext=function(e){var t=r.CoreCommon.ServiceDePromesse.defer(),n=this.serviceManager.Library.Context.GetListFromContext(e,null,null);return t.resolve(n),t.promise},n.prototype.GetAuthentificationInfo=function(){var e=r.CoreCommon.ServiceDePromesse.defer(),t=this.serviceManager.Library.Context.GetAuthentificationInfo(!1);return e.resolve(t),e.promise},n.prototype.getAuthentificationInfo=function(){return this.GetAuthentificationInfo()},n.prototype.sendNotification=function(e,t,n){n&&n(t,null,null)},n.prototype.GetParametresComptables=function(){var e=r.CoreCommon.ServiceDePromesse.defer(),t=this.serviceManager.Library.Context.GetParametresComptables();return e.resolve(t),e.promise},n.prototype.Redirect=function(e,t){throw new r.Erreur("not implemented")},n.prototype.GetWaitingProcesses=function(){throw new r.Erreur("not implemented")},n.prototype.PutProcessInPortalContext=function(e){throw new r.Erreur("not implemented")},n.prototype.PutTaskInPortalContext=function(e){throw new r.Erreur("not implemented")},n.prototype.GetCurrentProcessId=function(){throw new r.Erreur("not implemented")},n.prototype.GetCurrentStepId=function(){throw new r.Erreur("not implemented")},n.prototype.reinitialisationServiceAgent=function(e){throw new r.Erreur("not implemented")},n.prototype.GetCurrentStepInfo=function(){throw new r.Erreur("not implemented")},n.prototype.SetMyWayCompatible=function(){throw new r.Erreur("not implemented")},n.prototype.SubscribeToNotification=function(e,t){throw new r.Erreur("not implemented")},n.prototype.retirerListenerNotification=function(e){throw new r.Erreur("not implemented")},n.prototype.AnalyseApp=function(){throw new r.Erreur("not implemented")},n.prototype.ChangeMainProcessName=function(e){throw new r.Erreur("not implemented")},n.prototype.AddToSharedContext=function(e,t){throw new r.Erreur("not implemented")},n.prototype.RemoveFromSharedContext=function(e){throw new r.Erreur("not implemented")},Object.defineProperty(n.prototype,"StepInfo",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ErreurCallback",{get:function(){return null},enumerable:!0,configurable:!0}),n.prototype.SetContextListener=function(e,t){},t=n,o.PhantomContextAgent=t}(MyWay=MyWay||{}),function(e){var f;(function(u){var l=(Object.defineProperty(n.prototype,"SimulateAppIFrame",{get:function(){return f.PrivatePortalServiceParameters.Instance().SimulateAppIFrame},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"FrameElement",{get:function(){return this._frameElement||(n.logger.debug("Tentative de récupération de _frameElement, Id %1",this.FrameId),this._frameElement=document.getElementById(this.FrameId)),this._frameElement?this._frameElement:(n.logger.debug("Impossible de récupérer _frameElement, Id %1",this.FrameId),null)},enumerable:!0,configurable:!0}),n.prototype.CreateFrameElement=function(){if(!this.SimulateAppIFrame&&!this._frameElement){var e=document.createElement("IFRAME");e.id=this.FrameId,this._baseFrameElement.parentElement.appendChild(e),this._frameElement=document.getElementById(this.FrameId),this._frameElement&&n.logger.debug("Création de la frame %1",this.FrameElement.id)}},n.prototype.RemoveFrameElement=function(){!this.SimulateAppIFrame&&this.FrameElement&&this._baseFrameElement&&this._baseFrameElement.parentElement.contains(this.FrameElement)&&(this.FrameElement&&n.logger.debug("Suppression de la frame %1",this.FrameElement.id),this._baseFrameElement.parentElement.removeChild(this.FrameElement))},n.prototype.SetUrl=function(e){var t=this.FrameElement;return t?(t.setAttribute("src",e),n.logger.debug("Changement de l'url de la frame %1: %2",t.id,e),this.FrameUrl=e,!0):!!this.SimulateAppIFrame&&(this.FrameUrl=e,!0)},n.prototype.Show=function(){var e=!1;if(!this.SimulateAppIFrame&&this.FrameElement&&this.FrameElement.hasAttribute("style")&&this.FrameElement.removeAttribute("style"),this.IsHidden){this.FrameElement&&n.logger.debug("Affichage de la frame %1",this.FrameElement.id);var t=new f.NotificationMessage;t.Sujet="FrameShown",this.displayManager.getManagerLibrary().Context.NotifyFrame(t,this),e=!(this.IsHidden=!1)}return e},n.prototype.Hide=function(){if(!this.SimulateAppIFrame&&this.FrameElement&&this.FrameElement.setAttribute("style","display:none"),!this.IsHidden){this.FrameElement&&n.logger.debug("Masquage de la frame %1",this.FrameElement.id);var e=new f.NotificationMessage;e.Sujet="FrameHidden",this.displayManager.getManagerLibrary().Context.NotifyFrame(e,this),this.IsHidden=!0}},n.prototype.SetId=function(){this.FrameElement&&(n.logger.debug("Changement de l'id de la frame %1 pour %2",this.FrameElement.id,this.FrameId),this.FrameElement.id=this.FrameId)},n.prototype.GetWindow=function(){return this.FrameElement?this.FrameElement.contentWindow:null},n.CLASS_NAME="MyWay.Services.Display.FrameModel",n.logger=f.Loggers.LoggerFactory.INSTANCE.getClass(n.CLASS_NAME),n);function n(e,t,n){this.FrameId=e,this._baseFrameElement=t,this.displayManager=n,this._frameElement=document.getElementById(this.FrameId),this.TempId="",this.Redirected=!1,this.IsHidden=!0}u.FrameModel=l;var i,e=(i=f.Components.ComponentManagerBase,__extends(p,i),p.prototype.setFormatObjectNotificationListener=function(e,t){this.formatObjectNotificationListeners[e]=t},p.prototype.init=function(e,t,n,r){var o=this;return this._logOnUrl=n.LogOnUrl||null,this.Frames=[],this.BaseFrame=new l(n.IFrameId,null,this),this.Frames.push(this.BaseFrame),this.CurrentFrame=this.BaseFrame,i.prototype.init.call(this,e,t,n,r).then(function(){o.library.Evennements.ajouterListener(function(t){if(o.Frames){var n={Contenu:null,type:null,Sujet:"NotificationEvent"};o.formatObjectNotificationListeners[t.EventType]&&(o.formatObjectNotificationListeners[t.EventType](t,n),o.Frames.forEach(function(e){t.onSend&&t.onSend(e.FrameId),o.library.Context.NotifyFrame(n,e)}))}})})},p.prototype.getManagerLibrary=function(){return this.library},p.prototype.AfficherUrl=function(e,t,n){void 0===n&&(n=!1),p.logger.debug("AfficherUrl, ulr: "+e);var r=f.CoreCommon.ServiceDePromesse.defer();return t?this.DisplayIFrameUrl(e,t,n,function(e){p.logger.debug("L'url est affiché dans la frame correspondant au processus %1",t),r.resolve(e)}):(this.DisplayBaseUrl(e),p.logger.debug("L'url est affiché dans la frame de base"),r.resolve(!0)),r.promise},p.prototype.OuvrirUrl=function(e){return p.logger.debug("L'url est affiché dans une nouvelle instance de navigateur"),window.open(e)},p.prototype.DisplayBaseFrame=function(){p.logger.debug("Masque toutes les frames sauf celle correspondant à l'id %1",this.BaseFrame.FrameId),this.ShowOnlyIFrame(this.BaseFrame.FrameId)},p.prototype.DisplayLogOn=function(){p.logger.debug("Display logon"),this.SendEvent(new f.Component.ManagerEvent(f.Component.ManagerEventType.AfficherLogOn,null)),this._logOnUrl&&(!this.BaseFrame.FrameUrl||this.BaseFrame.FrameUrl.indexOf(this._logOnUrl)<0)&&this.Redirect(this._logOnUrl,this.CurrentFrame)},p.prototype.Redirect=function(e,t,n){var r,o;void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null);var i=null;if(t&&"string"==typeof t?(r=t,o=this.CurrentFrame):t&&"object"==typeof t&&(o=t),p.logger.debug("Redirect, url: "+e+", previousUrl: "+r),o)this.SavedUrl=r||o.FrameUrl,this.SavedFrameId=o.FrameId,this.SavedProcessId=o.ProcessId,i=this.AfficherUrl(e,null,!1);else if(e)null===n||n===this.BaseFrame.FrameId?i=this.AfficherUrl(e,null,!1):(i=this.AfficherUrl(e,this.SavedProcessId,!1),this.SavedUrl=null,this.SavedFrameId=null,this.SavedProcessId=null);else if(this.SavedUrl)i=this.Redirect(this.SavedUrl,null,this.SavedFrameId);else{this.SendEvent(new f.Component.ManagerEvent(f.Component.ManagerEventType.MasquerLogOn,null));var s=f.CoreCommon.ServiceDePromesse.defer();s.resolve(!0),i=s.promise}return i},p.prototype.CleanFrames=function(e){var t=[];p.logger.debug("CleanFrames %1",JSON.stringify(e));for(var n=0;n<this.Frames.length;n++){var r=this.Frames[n];if(r.ProcessId){var o=!1;for(var i in e)if(e[i].id===r.ProcessId){o=!0;break}o||(this.RemoveProcessIFrame(r.ProcessId),t.push(n))}}var s=t.reverse();for(var a in s)n=s[a],this.Frames.splice(n,1)},p.prototype.CleanLastProcessFrame=function(){var n=this,e=this.library.Context.GetCurrentMainProcess();if(p.logger.debug("CleanLastProcessFrame %1",JSON.stringify(e)),e){var r=this.GetLastFrameModelByProcessId(e.id);r&&r.RemoveFrameElement(),this.Frames.some(function(e,t){if(e.FrameId===r.FrameId)return n.Frames.splice(t,1),!0})}},p.prototype.RemoveProcessIFrame=function(e){var n=this,t=this.GetFrameModelsByProcessId(e);for(var r in p.logger.debug("Suppression de la frame du processus %1",e),t){var o=t[r];o.RemoveFrameElement(),this.Frames.some(function(e,t){if(e.FrameId===o.FrameId)return n.Frames.splice(t,1),!0})}},p.prototype.DisplayMessage=function(e){p.logger.debug("DisplayMessage"),this.onNotificationDeMessage&&this.onNotificationDeMessage(e)},p.prototype.FermerModalMessage=function(){p.logger.debug("FermerModalMessage"),this.onFermerModalMessage&&this.onFermerModalMessage()},p.prototype.AfficherModalMessage=function(e,t,n,r,o,i){p.logger.debug("Lancement de l'évènement d'affichage d'une modale Message"),this.onAffichageModalMessage&&this.onAffichageModalMessage(e,t,n,r,o,i)},p.prototype.AfficherModalAide=function(e,t,n,r){p.logger.debug("Lancement de l'évènement d'affichage d'une modale Aide"),this.onAffichageModalAide&&this.onAffichageModalAide(e,t,n,r)},p.prototype.getMyIFrameId=function(t){var n=null;return this.Frames&&this.Frames.every(function(e){return e.GetWindow()===t&&(n=e.FrameId),null===n}),n},p.prototype.DisplayIFrameUrl=function(e,t,n,r){p.logger.debug("DisplayIFrameUrl, url: "+e);var o=this.library.Context.GetCurrentProcess(),i=null;if(o&&(i=this.library.Context.GetCurrentStep(o)),i.isRouteur)i.etatEtape==f.Context.EtatEtape.RESET&&(i.etatEtape=f.Context.EtatEtape.STARTED,this.ExecuteJS(i.url));else{var s=!1;i.etatEtape==f.Context.EtatEtape.RESET&&(i.etatEtape=f.Context.EtatEtape.STARTED,s=!0),this.AddProcessIFrame(e,t,n,!1,s),r&&r(!0)}},p.prototype.DisplayBaseUrl=function(e){return p.logger.debug("DisplayBaseUrl, url: "+e),!(!this.ShowOnlyIFrame(this.BaseFrame.FrameId)||this.BaseFrame.FrameUrl!==e)||(this.BaseFrame.FrameUrl===e&&(0<=this.BaseFrame.FrameUrl.indexOf("?")?e+="&":e+="?",e+=f.CoreCommon.creerChaineAleatoire(7)),this.BaseFrame.IsMyWayUrl=!1,!!this.BaseFrame.SetUrl(e))},p.prototype.GetFrameModelById=function(e){for(var t=0;t<this.Frames.length;t++){var n=this.Frames[t];if(n.FrameId===e)return n}return null},p.prototype.GetLastFrameModelByProcessId=function(e){for(var t=this.Frames.length-1;0<=t;t--)if((n=this.Frames[t]).ProcessId===e&&""===n.TempId)return n;for(t=this.Frames.length-1;0<=t;t--){var n;if((n=this.Frames[t]).ProcessId===e)return n}return null},p.prototype.GetFrameModelsByProcessId=function(e){for(var t=[],n=this.Frames.length-1;0<=n;n--){var r=this.Frames[n];r.ProcessId===e&&t.push(r)}return t},p.prototype.ShowOnlyIFrame=function(e,t){var n;if(!e)throw"iframeId is mandatory";if(null==(o=this.GetFrameModelById(e)))throw"can't find frame with id "+e;for(var r in n=o.Show(),this.CurrentFrame=o,this.Frames){var o;(o=this.Frames[r]).FrameId!=e&&o.Hide()}return(n||t)&&this.onShowFrame&&this.onShowFrame(this.CurrentFrame),n},p.prototype.AddProcessIFrame=function(e,t,n,r,o){p.logger.debug("AddProcessIFrame");var i,s="iframe-"+t,a=this.GetLastFrameModelByProcessId(t),c=null;a&&n?(this.AddTempId(a,t,"-"+f.CoreCommon.creerChaineAleatoire(8)),c=a,a=null):a&&a.TempId&&this.AddTempId(a,t,""),!(i=a?this.ShowOnlyIFrame(a.FrameId):((a=new l(s,this.BaseFrame.FrameElement,this)).ProcessId=t,c&&(a.PreviousFrame=c),this.Frames.push(a),a.CreateFrameElement(),this.ShowOnlyIFrame(a.FrameId,!0)))&&a.FrameUrl===e&&o&&a.IsMyWayUrl&&(p.logger.debug("refresh demandé"),this.sendMessage(u.DisplayMessageSubject.Refresh)),(!a.IsProducteur&&a.FrameUrl!=e||a.IsProducteur&&a.FrameUrlOrigine!=e)&&(a.Redirected?p.logger.warn("Frame has a Redirected flag, set url cannot be done"):(p.logger.debug("SetUrl"),a.SetUrl(e))),i||(a.Redirected=r),this.CurrentFrame=a,!i&&o&&(this.CurrentFrame.IsMyWayUrl=!1)},p.prototype.AddTempId=function(e,t,n){e.FrameId="iframe-"+t+n,e.TempId=n,e.SetId()},p.prototype.ExecuteJS=function(e){p.logger.info("execution d'une étape de routage: %1",e),f.CoreCommon.loadScript(e)},p.prototype.RedirectInStep=function(e){var t=this.library.Context.GetCurrentProcess();this.AddProcessIFrame(e,t.id,!1,!0,!0)},p.prototype.PrepareSubmit=function(e){p.logger.debug("Prepare frame for submit");var t=this.library.Context.GetCurrentMainProcess(),n=this.GetLastFrameModelByProcessId(t.id);n.FrameUrlOrigine=n.FrameUrl,n.FrameUrl=e,n.Redirected=!0,n.IsMyWayUrl=!1,n.IsProducteur=!0},p.prototype.FinishSubmit=function(){var e=this.library.Context.GetCurrentMainProcess();if(e){var t=this.GetLastFrameModelByProcessId(e.id);t&&t.Redirected&&(p.logger.debug("cancel redirected flag"),t.Redirected=!1)}},p.CLASS_NAME="MyWay.Services.Display.DisplayManager",p.logger=f.Loggers.LoggerFactory.INSTANCE.getClass(p.CLASS_NAME),p);function p(){var e=i.call(this,f.Components.ComponentType.Display)||this;return e.formatObjectNotificationListeners={},e}u.DisplayManager=e,f.Components.RegistryManager.getInstance().register(e)})((f=e.Services||(e.Services={})).Display||(f.Display={}))}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){return i.call(this,t.Components.ComponentType.TraitementNsdk)||this}t=e.Services||(e.Services={}),o=t.TraitementNsdk||(t.TraitementNsdk={}),i=t.Components.ComponentManagerMessageBase,__extends(r,i),r.prototype.reception=function(e){switch(e.subject){case o.TraitementNsdkMessageSubject.Lancer:var t=e.message,n=t.data,r=t.traitement;return this.managerInstance.Lancer(r,n);default:return i.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.TraitementNsdk.TraitementNsdkManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,o.TraitementNsdkManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgentExtended,"InteropTechAgent",{get:function(){return this._techLibrary.InteropTechAgent}}),t.TechAgentExtended.prototype.Lancer=function(e,t,n,r,o){return this._techLibrary.Lancer(e,t,n,r,o)},t.TechAgentExtended.prototype.AddToContextInterop=function(e,t,n,r,o){return this._techLibrary.AddToContextInterop(e,t,n,r,o)},t.TechAgentExtended.prototype.AddListToContextInterop=function(e,t,n,r){return this._techLibrary.AddListToContextInterop(e,t,n,r)},t.TechAgentExtended.prototype.GetListFromContextInterop=function(e,t,n,r){return this._techLibrary.GetListFromContextInterop(e,t,n,r)},t.TechAgentExtended.prototype.GetFromContextInterop=function(e,t,n,r,o){return this._techLibrary.GetFromContextInterop(e,t,n,r,o)},t.TechAgentExtended.prototype.EndStep=function(){return this._techLibrary.EndStep()},t.TechAgentExtended.prototype.AfficherWindowParHandle=function(e,t){return this._techLibrary.AfficherWindowParHandle(e,t)},t.TechAgentExtended.prototype.AfficherWindowParPid=function(e,t){return this._techLibrary.AfficherWindowParPid(e,t)},t.TechAgentExtended.prototype.AfficherSynthese=function(e){return this._techLibrary.AfficherSynthese(e)},t.TechAgentExtended.prototype.ActiverApplicationAppelante=function(e){return this.InteropTechAgent.ActiverApplicationAppelante(e)}}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgent,"InteropTechAgent",{get:function(){return this._techLibrary.InteropTechAgent}}),t.TechAgent.prototype.Lancer=function(e,t,n,r,o){return this.InteropTechAgent.Lancer(e,t,n,r,o)},t.TechAgent.prototype.AddToContextInterop=function(e,t,n,r,o){return this.InteropTechAgent.AddToContextInterop(e,t,n,r,o)},t.TechAgent.prototype.AddListToContextInterop=function(e,t,n,r){return this.InteropTechAgent.AddListToContextInterop(e,t,n,r)},t.TechAgent.prototype.GetListFromContextInterop=function(e,t,n,r){return this.InteropTechAgent.GetListFromContextInterop(e,t,n,r)},t.TechAgent.prototype.GetFromContextInterop=function(e,t,n,r,o){return this.InteropTechAgent.GetFromContextInterop(e,t,n,r,o)},t.TechAgent.prototype.EndStep=function(){return this.InteropTechAgent.EndStep()},t.TechAgent.prototype.AfficherWindowParHandle=function(e,t){return this.InteropTechAgent.AfficherWindowParHandle(e,t)},t.TechAgent.prototype.AfficherWindowParPid=function(e,t){return this.InteropTechAgent.AfficherWindowParPid(e,t)},t.TechAgent.prototype.AfficherSynthese=function(e){return this.InteropTechAgent.AfficherSynthese(e)},t.TechAgent.prototype.ActiverApplicationAppelante=function(e){return this.InteropTechAgent.ActiverApplicationAppelante(e)}}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).TechLibrary.addInitListener(function(e,t){e.InteropTechAgent=t.Interop}),t.TechLibrary.prototype.Lancer=function(e,t,n,r,o){return this.InteropTechAgent.Lancer(e,t,n,r,o)},t.TechLibrary.prototype.AddToContextInterop=function(e,t,n,r,o){return this.InteropTechAgent.AddToContextInterop(e,t,n,r,o)},t.TechLibrary.prototype.AddListToContextInterop=function(e,t,n,r){return this.InteropTechAgent.AddListToContextInterop(e,t,n,r)},t.TechLibrary.prototype.GetListFromContextInterop=function(e,t,n,r){return this.InteropTechAgent.GetListFromContextInterop(e,t,n,r)},t.TechLibrary.prototype.GetFromContextInterop=function(e,t,n,r,o){return this.InteropTechAgent.GetFromContextInterop(e,t,n,r,o)},t.TechLibrary.prototype.EndStep=function(){return this.InteropTechAgent.EndStep()},t.TechLibrary.prototype.AfficherWindowParHandle=function(e,t){return this.InteropTechAgent.AfficherWindowParHandle(e,t)},t.TechLibrary.prototype.AfficherWindowParPid=function(e,t){return this.InteropTechAgent.AfficherWindowParPid(e,t)},t.TechLibrary.prototype.AfficherSynthese=function(e){return this.InteropTechAgent.AfficherSynthese(e)},t.TechLibrary.prototype.ActiverApplicationAppelante=function(e){return this.InteropTechAgent.ActiverApplicationAppelante(e)}}(MyWay=MyWay||{}),function(e){var t,i,n,r;function o(){return n.call(this)||this}t=e.Services||(e.Services={}),i=t.Interop||(t.Interop={}),n=i.InteropAgent,__extends(o,n),o.prototype.Lancer=function(e,t,n,r,o){return this.sendMessage(i.Messages.InteropMessageSubject.Lancer,{executableWrapper:e,contexte:t,parametres:n,sync:r}).catch(function(e){throw o&&o(e),e})},o.prototype.AddToContextInterop=function(e,t,n,r,o){return this.sendMessage(i.Messages.InteropMessageSubject.AddToContextInterop,{level:e,key:t,value:n}).then(function(e){return r&&r(e),e},function(e){throw o&&o(e),e})},o.prototype.AddListToContextInterop=function(e,t,n,r){return this.sendMessage(i.Messages.InteropMessageSubject.AddListToContextInterop,{level:e,datas:t}).then(function(e){return n&&n(e),e},function(e){throw r&&r(e),e})},o.prototype.GetListFromContextInterop=function(e,t,n,r){return this.sendMessage(i.Messages.InteropMessageSubject.GetListFromContextInterop,{level:e,datas:t}).then(function(e){return n&&n(e),e},function(e){throw r&&r(e),e})},o.prototype.GetFromContextInterop=function(e,t,n,r,o){return this.sendMessage(i.Messages.InteropMessageSubject.GetFromContextInterop,{level:e,key:t,value:n}).then(function(e){return r&&r(e),e},function(e){throw o&&o(e),e})},o.prototype.EndStep=function(){return this.sendMessage(i.Messages.InteropMessageSubject.EndStep,{})},o.prototype.AfficherWindowParHandle=function(e,t){return this.sendMessage(i.Messages.InteropMessageSubject.AfficherWindowParHandle,{handle:e,affiche:t})},o.prototype.AfficherWindowParPid=function(e,t){return this.sendMessage(i.Messages.InteropMessageSubject.AfficherWindowParPid,{pid:e,affiche:t})},o.prototype.AfficherSynthese=function(e){return this.sendMessage(i.Messages.InteropMessageSubject.AfficherSynthese,{numeroClient:e})},o.prototype.ActiverApplicationAppelante=function(e){return this.sendMessage(i.Messages.InteropMessageSubject.ActiverApplicationAppelante,{numeroPlan:e})},o.prototype.LireFichier=function(e,t,n){return this.sendMessage(i.Messages.InteropMessageSubject.LireFichier,{nomFichier:e}).then(function(e){return t&&t(e),e},function(e){throw n&&n(e),e})},o.prototype.clearBus=function(){return this.sendMessage(i.Messages.InteropMessageSubject.ClearBus,{})},r=o,i.InteropTechAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(r){var o,i;function s(e){var t;return e.hasOwnProperty("typeName")?"Le paramètre impressionParams doit être du nouveau type ImpressionParams":""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"obligatoires",value:e.obligatoires,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}]))?t:""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"nomFichier",value:e.obligatoires.nomFichier,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}]))?t:""}function a(e){var t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX)){if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX.annul)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"annul",value:e.optionnels.parametreActiveX.annul,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX.voir)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"voir",value:e.optionnels.parametreActiveX.voir,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX.enregistrer)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"enregistrer",value:e.optionnels.parametreActiveX.enregistrer,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX.blocnbex)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"blocnbex",value:e.optionnels.parametreActiveX.blocnbex,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX.nbcopiesdef)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"nbcopiesdef",value:e.optionnels.parametreActiveX.nbcopiesdef,controle:r.Services.Controle.CONTROLES.isNumber}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX.mincop)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"mincop",value:e.optionnels.parametreActiveX.mincop,controle:r.Services.Controle.CONTROLES.isNumber}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX.maxcop)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"maxcop",value:e.optionnels.parametreActiveX.maxcop,controle:r.Services.Controle.CONTROLES.isNumber}])))return t}return""}function n(e){var t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels)&&o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametresActiveXIndividuels)){if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametresActiveXIndividuels.voir)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"voir",value:e.optionnels.parametresActiveXIndividuels.voir,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametresActiveXIndividuels.enregistrer)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"enregistrer",value:e.optionnels.parametresActiveXIndividuels.enregistrer,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametresActiveXIndividuels.blocnbex)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"blocnbex",value:e.optionnels.parametresActiveXIndividuels.enregistrer,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametresActiveXIndividuels.nbcopiesdef)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"nbcopiesdef",value:e.optionnels.parametresActiveXIndividuels.nbcopiesdef,controle:r.Services.Controle.CONTROLES.isNumber}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametresActiveXIndividuels.mincop)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"mincop",value:e.optionnels.parametresActiveXIndividuels.mincop,controle:r.Services.Controle.CONTROLES.isNumber}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametresActiveXIndividuels.maxcop)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"maxcop",value:e.optionnels.parametresActiveXIndividuels.maxcop,controle:r.Services.Controle.CONTROLES.isNumber}])))return t}return""}function c(e){var t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e)){if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.annul)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"annul",value:e.annul,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.impdef)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"impdef",value:e.impdef,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.affred)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"affred",value:e.affred,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.reimp)&&""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"reimp",value:e.reimp,controle:r.Services.Controle.CONTROLES.isBoolean}])))return t}return""}o=r.Services||(r.Services={}),(i=o.Impression||(o.Impression={})).controleGenerer=function(e,t){var n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"data",value:e,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull},{name:"generationParams",value:t,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}])))return n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"systeme",value:t.systeme,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull},{name:"obligatoires",value:t.obligatoires,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}])))return n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"typeName",value:t.systeme.typeName,controle:r.Services.Controle.CONTROLES.isStringNotEmpty},{name:"typeFullName",value:t.systeme.typeFullName,controle:r.Services.Controle.CONTROLES.isStringNotEmpty},{name:"librairie",value:t.systeme.librairie,controle:r.Services.Controle.CONTROLES.isStringNotEmpty}])))return n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"action",value:t.obligatoires.action,controle:r.Services.Controle.CONTROLES.isAnEnumValue,enumName:"Impression.GENERATION_ACTION",enumObject:i.GENERATION_ACTION},{name:"parametresGenerationFichier",value:t.obligatoires.parametresGenerationFichier,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}])))return n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"typeFichier",value:t.obligatoires.parametresGenerationFichier.typeFichier,controle:r.Services.Controle.CONTROLES.isAnEnumValue,enumName:"Fichier.TYPE_FICHIER",enumObject:o.Fichier.TYPE_FICHIER},{name:"restitutionVersion",value:t.obligatoires.parametresGenerationFichier.restitutionVersion,controle:r.Services.Controle.CONTROLES.isAnEnumValue,enumName:"Impression.RESTITUTION_VERSION",enumObject:i.RESTITUTION_VERSION},{name:"sousRepModele",value:t.obligatoires.parametresGenerationFichier.sousRepModele,controle:r.Services.Controle.CONTROLES.isString}])))return n;if((t.obligatoires.action==i.GENERATION_ACTION.archiverAndGetFichier||t.obligatoires.action==i.GENERATION_ACTION.getFichier)&&!o.Controle.StaticStringControle.isStringNotEmpty(t.optionnels.nomFichier))return"L'action demandée implique que le nom du fichier soit renseigné";if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.mentionsLegales)&&""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"numEtablissement",value:t.optionnels.mentionsLegales.numEtablissement,controle:r.Services.Controle.CONTROLES.isStringNotEmptyOrNull}])))return n;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage)){if(!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc))return"Le paramètre aQstnCreerDoc de l'archivage doit être renseigné";if(!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.donnCntx)||!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.document))return"Les paramètres document et donnCntx de l'aQstnCreerDoc doivent être renseignés";if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"idntCmpstApplf",value:t.optionnels.archivage.aQstnCreerDoc.donnCntx.idntCmpstApplf,controle:r.Services.Controle.CONTROLES.isString}])))return n;if(!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.document.fichierDoc)||!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc))return"Les paramètres fichierDoc et proprietesDoc de document doivent être renseignés";if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"nomFich",value:t.optionnels.archivage.aQstnCreerDoc.document.fichierDoc.nomFich,controle:r.Services.Controle.CONTROLES.isString},{name:"codeTypeNatrDoc",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeNatrDoc,controle:r.Services.Controle.CONTROLES.isString},{name:"codeTypeAttrb",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeAttrb,controle:r.Services.Controle.CONTROLES.isString},{name:"idntAttrb",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb,controle:r.Services.Controle.CONTROLES.isString},{name:"dateDeliv",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateDeliv,controle:r.Services.Controle.CONTROLES.isDate},{name:"dateNumr",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateNumr,controle:r.Services.Controle.CONTROLES.isDate},{name:"inttAttr",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.inttAttr,controle:r.Services.Controle.CONTROLES.isString}])))return n;if((!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeStck)||"A"===t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeStck)&&""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"codeTypeModeAcqs",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeModeAcqs,controle:r.Services.Controle.CONTROLES.isString},{name:"codeTypeOrigAcqs",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeOrigAcqs,controle:r.Services.Controle.CONTROLES.isString},{name:"codeTypeSign",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeSign,controle:r.Services.Controle.CONTROLES.isString}])))return n}return""},i.controleImprimer=function(e,t){var n;return""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"data",value:e,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull},{name:"impressionParams",value:t,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}]))?n:""!==(n=s(t))?n:a(t)},i.controleImprimerLot=function(e,t){var n;return""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"data",value:e,controle:r.Services.Controle.CONTROLES.isArray}]))?n:e.length<=0?"Le lot de documents à imprimer est vide":c(t)},i.controleDocumentImpressionLot=function(e){var t;return""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"data",value:e,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}]))?t:o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.fichier)||o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.idGed)?""!==(t=o.Controle.StaticParametresControle.checkParameters([{name:"numeroOrdre",value:e.numeroOrdre,controle:r.Services.Controle.CONTROLES.isNumber}]))?t:""!==(t=s(e.impressionParams))?t:n(e.impressionParams):'L\'un des paramètres "fichier" ou "idGed" de DocumentImpressionLot doit être renseigné'},i.controleImpressionParams=s,i.controleGenererImprimer=function(e,t){var n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"data",value:e,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull},{name:"generationImpressionParams",value:t,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}])))return n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"systeme",value:t.systeme,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull},{name:"obligatoires",value:t.obligatoires,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}])))return n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"typeName",value:t.systeme.typeName,controle:r.Services.Controle.CONTROLES.isStringNotEmpty},{name:"typeFullName",value:t.systeme.typeFullName,controle:r.Services.Controle.CONTROLES.isStringNotEmpty},{name:"librairie",value:t.systeme.librairie,controle:r.Services.Controle.CONTROLES.isStringNotEmpty}])))return n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"action",value:t.obligatoires.action,controle:r.Services.Controle.CONTROLES.isAnEnumValue,enumName:"Impression.GENERATION_ACTION",enumObject:i.GENERATION_ACTION},{name:"parametresGenerationFichier",value:t.obligatoires.parametresGenerationFichier,controle:r.Services.Controle.CONTROLES.isNotUndefinedAndNotNull}])))return n;if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"typeFichier",value:t.obligatoires.parametresGenerationFichier.typeFichier,controle:r.Services.Controle.CONTROLES.isAnEnumValue,enumName:"Fichier.TYPE_FICHIER",enumObject:o.Fichier.TYPE_FICHIER},{name:"restitutionVersion",value:t.obligatoires.parametresGenerationFichier.restitutionVersion,controle:r.Services.Controle.CONTROLES.isAnEnumValue,enumName:"Impression.RESTITUTION_VERSION",enumObject:i.RESTITUTION_VERSION},{name:"sousRepModele",value:t.obligatoires.parametresGenerationFichier.sousRepModele,controle:r.Services.Controle.CONTROLES.isString}])))return n;if(o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage)){if(!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc))return"Le paramètre aQstnCreerDoc de l'archivage doit être renseigné";if(!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.donnCntx)||!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.document))return"Les paramètres document et donnCntx de l'aQstnCreerDoc doivent être renseignés";if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"idntCmpstApplf",value:t.optionnels.archivage.aQstnCreerDoc.donnCntx.idntCmpstApplf,controle:r.Services.Controle.CONTROLES.isString}])))return n;if(!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.document.fichierDoc)||!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc))return"Les paramètres fichierDoc et proprietesDoc de document doivent être renseignés";if(""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"nomFich",value:t.optionnels.archivage.aQstnCreerDoc.document.fichierDoc.nomFich,controle:r.Services.Controle.CONTROLES.isString},{name:"codeTypeNatrDoc",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeNatrDoc,controle:r.Services.Controle.CONTROLES.isString},{name:"codeTypeAttrb",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeAttrb,controle:r.Services.Controle.CONTROLES.isString},{name:"idntAttrb",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb,controle:r.Services.Controle.CONTROLES.isString},{name:"dateDeliv",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateDeliv,controle:r.Services.Controle.CONTROLES.isDate},{name:"dateNumr",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateNumr,controle:r.Services.Controle.CONTROLES.isDate},{name:"inttAttr",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.inttAttr,controle:r.Services.Controle.CONTROLES.isString}])))return n;if((!o.Controle.StaticAnyControle.isNotUndefinedAndNotNull(t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeStck)||"A"===t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeStck)&&""!==(n=o.Controle.StaticParametresControle.checkParameters([{name:"codeTypeModeAcqs",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeModeAcqs,controle:r.Services.Controle.CONTROLES.isString},{name:"codeTypeOrigAcqs",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeOrigAcqs,controle:r.Services.Controle.CONTROLES.isString},{name:"codeTypeSign",value:t.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeSign,controle:r.Services.Controle.CONTROLES.isString}])))return n}return a(t)},i.controleParametreActiveX=a,i.controleParametreActiveXIndividuels=n,i.controleParametreActiveXGlobaux=c}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Impression)||this}t=e.Services||(e.Services={}),n=t.Impression||(t.Impression={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.generer=function(e,t){return this.sendMessage(n.Messages.ImpressionMessageSubject.Generer,{data:e,generationParams:t})},i.prototype.imprimer=function(e,t){return this.sendMessage(n.Messages.ImpressionMessageSubject.Imprimer,{data:e,impressionParams:t})},i.prototype.imprimerLot=function(e,t){return this.sendMessage(n.Messages.ImpressionMessageSubject.ImprimerLot,{data:e,parametresActiveXGlobaux:t})},i.prototype.genererImprimer=function(e,t){return this.sendMessage(n.Messages.ImpressionMessageSubject.GenererImprimer,{data:e,generationImpressionParams:t})},i.prototype.getJsonConverti=function(e){return this.sendMessage(n.Messages.ImpressionMessageSubject.GetJsonConverti,{data:e})},i.prototype.imprimerEcran=function(){return window.print()},o=i,n.ImpressionAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,r,n,o;function i(){return n.call(this,t.Components.ComponentType.DonneesDelocalisees)||this}t=e.Services||(e.Services={}),r=t.DonneesDelocalisees||(t.DonneesDelocalisees={}),n=t.Components.ComponentAgentBase,__extends(i,n),i.prototype.getDonneesDelocalisees=function(e,t){return this.sendMessage(r.Messages.DonneesDelocaliseesMessageSubject.GetDonneesDelocalisees,{numEtablissement:e,objectDataName:t})},i.prototype.getListeDonneesDelocalisees=function(e,t){return this.sendMessage(r.Messages.DonneesDelocaliseesMessageSubject.GetListeDonneesDelocalisees,{numEtablissement:e,objectDataNames:t})},i.prototype.getRubriqueLibelle=function(e,t,n){return this.sendMessage(r.Messages.DonneesDelocaliseesMessageSubject.GetRubriqueLibelle,{numEtablissement:e,objectDataName:t,code:n})},i.prototype.getDonneesParCriteres=function(e,t,n){return this.sendMessage(r.Messages.DonneesDelocaliseesMessageSubject.GetDonneesParCriteres,{numEtablissement:e,objectDataName:t,criteres:n})},o=i,r.DonneesDelocaliseesAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).ServiceAgentExtended.prototype.getDonneesDelocalisees=function(e,t){try{var n=this.$q.defer();return this.DonneesDelocalisees.getDonneesDelocalisees(e,t).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}catch(e){throw new Error("context pas initialise !")}},t.ServiceAgentExtended.prototype.getListDonneesDelocalisees=function(t,n){var r=this;try{var o=this.$q.defer();return this.getAuthentificationInfo().then(function(e){r.DonneesDelocalisees.getDonneesDelocalisees(e.codeEtablissement,t).then(function(e){var t=[];n&&void 0!==e.donnees?e.donnees.forEach(function(e){t.push(r.instanceLoaderService.createInstance(n,e))}):t=e.donnees,o.resolve(t)},function(e){o.reject(e)})}),o.promise}catch(e){throw new Error("utilisateur pas authentifie ou service local pas demarre !")}}}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.DonneesDelocalisees)||this}t=e.Services||(e.Services={}),n=t.DonneesDelocalisees||(t.DonneesDelocalisees={}),r=t.Components.ComponentApiBase,__extends(i,r),i.prototype.getDistantObjectData=function(e){return this.sendRequest(e)},i.prototype.getDistantTDT=function(e){return this.sendRequest(e)},i.prototype.getTDTById=function(e){return this.sendRequest(e)},i.prototype.sendRequest=function(e){return this.libraryManager.Core.sendRequest(e)},o=i,n.DonneesDelocaliseesApi=o,t.Components.RegistryApi.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Capacites)||this}t=e.Services||(e.Services={}),n=t.Capacites||(t.Capacites={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.getCapacite=function(e){return this.sendMessage(n.Messages.CapacitesMessageSubject.GetCapacite,{regle:e})},o=i,n.CapacitesAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Numerisation="Numerisation"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Numerisation||(t.Numerisation={}),(r=n.NumerisationMessageSubject||(n.NumerisationMessageSubject={}))[r.Numeriser=0]="Numeriser",r[r.GetSpiFactoryActivationStatut=1]="GetSpiFactoryActivationStatut",r[r.NumeriserArcade=2]="NumeriserArcade",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Numerisation,[t.Components.ComponentType.Context,t.Components.ComponentType.Core,t.Components.ComponentType.Display,t.Components.ComponentType.DonneesDelocalisees,t.Components.ComponentType.Libelle])}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Habilitation="Habilitation"}(MyWay=MyWay||{}),function(e){var t,n,r;t=e.Services||(e.Services={}),n=t.Habilitation||(t.Habilitation={}),(r=n.HabilitationMessageSubject||(n.HabilitationMessageSubject={}))[r.EstHabilite=0]="EstHabilite",r[r.ChargerHabilitations=1]="ChargerHabilitations",r[r.ObtenirHabilitations=2]="ObtenirHabilitations",r[r.ObtenirHabilitation=3]="ObtenirHabilitation",r[r.ModifierHabilitation=4]="ModifierHabilitation",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Habilitation,[t.Components.ComponentType.Capacites,t.Components.ComponentType.Context,t.Components.ComponentType.Core])}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(function(e){var t,n;function r(e,t){this[e]=t}(t=e.DOMAIN||(e.DOMAIN={}))[t.MYSYS="mysys"]="MYSYS",t[t.IAM="iam"]="IAM",t[t.CULTURENET="cultureNet"]="CULTURENET",e.HabilitationModel=r,(n=e.EHabilitationType||(e.EHabilitationType={}))[n.MYSYS=0]="MYSYS",n[n.IAM=1]="IAM",n[n.CULTURENET=2]="CULTURENET"})((t=e.Services||(e.Services={})).Habilitation||(t.Habilitation={}))}(MyWay=MyWay||{}),function(e){var t,i,s,n;function r(){return s.call(this,t.Components.ComponentType.Export)||this}t=e.Services||(e.Services={}),i=t.Export||(t.Export={}),s=t.Components.ComponentManagerMessageBase,__extends(r,s),r.prototype.reception=function(e){switch(e.subject){case i.ExportMessageSubject.ExporterFichier:var t=e.message,n=t.donnees,r=t.format,o=t.options;return this.managerInstance.exporterFichier(n,r,o);default:return s.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.Export.ExportManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,i.ExportManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var r,t,o,n;function i(){var e=o.call(this,r.Components.ComponentType.TraceSuivi)||this;return e._isSiris=null,e}r=e.Services||(e.Services={}),t=r.TraceSuivi||(r.TraceSuivi={}),o=r.Components.ComponentApiBase,__extends(i,o),i.prototype.init=function(e,t,n){return this._url=r.PrivatePortalServiceParameters.Instance().TraceSuiviUrl,this._isSiris=e.SIRIS,o.prototype.init.call(this,e,t,n)},i.prototype.envoyerTracesSuivi=function(e,t){if(0==e.length)return this.libraryManager.Core.getPromesseSelfResoved();var n={method:r.MethodEnum.POST,url:this._url,async:!0,contentType:r.ContentTypeEnum.JSON,data:e,withHeaders:!0,authentificationInfo:t};return this.libraryManager.Core.sendRequest(n)},i.prototype.isSiris=function(){return this._isSiris},n=i,t.TraceSuiviApiBase=n,r.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.TraceSuivi)||this}t=e.Services||(e.Services={}),n=t.TraceSuivi||(t.TraceSuivi={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.tracer=function(e){return this.sendMessage(n.Messages.TraceSuiviMessageSubject.SendTraceSuivi,{trace:e})},o=i,n.TraceSuiviAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgentExtended,"ContexteClientTechAgent",{get:function(){return this._techLibrary.ContexteClientTechAgent}})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgent,"ContexteClientTechAgent",{get:function(){return this._techLibrary.ContexteClientTechAgent}})}(MyWay=MyWay||{}),function(e){(e.Services||(e.Services={})).TechLibrary.addInitListener(function(e,t){e.ContexteClientTechAgent=t.ContexteClient})}(MyWay=MyWay||{}),function(e){var t,o,n,r;function i(){return null!==n&&n.apply(this,arguments)||this}t=e.Services||(e.Services={}),o=t.ContexteClient||(t.ContexteClient={}),n=o.ContexteClientAgent,__extends(i,n),i.prototype.getContextes=function(){return this.sendMessage(o.ContextClientMessageSubject.GetContextes).then(function(e){return e.idContextes})},i.prototype.detruireContexte=function(e){var t={idContexte:e,expediteur:this.getExpediteur()};return this.sendMessage(o.ContextClientMessageSubject.DestroyContext,t).then(function(e){return e.isDestroy})},i.prototype.nouveauContexte=function(e){var t={idClient:e,expediteur:this.getExpediteur()};return this.sendMessage(o.ContextClientMessageSubject.NewContext,t).then(function(e){return e.idContexte})},i.prototype.changerContexteDuProcessus=function(e,t){var n={idContexte:e,codeProcessus:t,expediteur:this.getExpediteur()};return this.sendMessage(o.ContextClientMessageSubject.ChangeContextProcess,n)},i.prototype.changerModeContexteClient=function(e,t){var n={idContexte:e,mode:t};return this.sendMessage(o.ContextClientMessageSubject.ChangeContextMode,n)},i.prototype.getDetailsContexte=function(e){var t={idContexte:e};return this.sendMessage(o.ContextClientMessageSubject.DetailsContext,t)},i.prototype.setClientOfContexteSpecifique=function(e,t){var n={idContexteClient:e,client:t,expediteur:this.getExpediteur()};return this.sendMessage(o.ContextClientMessageSubject.SetClient,n)},i.prototype.getPropertyOfContexteSpecifique=function(e,t){var n={idContexteClient:e,cle:t};return this.sendMessage(o.ContextClientMessageSubject.GetProperty,n).then(function(e){return e.valeur})},i.prototype.addToListOfContexteSpecifique=function(e,t,n){var r={idContexteClient:e,cle:t,valeur:n,expediteur:this.getExpediteur()};return this.sendMessage(o.ContextClientMessageSubject.AddToList,r).then(function(e){return e.estOk})},i.prototype.setPropertyOfContexteSpecifique=function(e,t,n){var r={idContexteClient:e,cle:t,valeur:n,expediteur:"tech-agent"};return this.sendMessage(o.ContextClientMessageSubject.SetProperty,r).then(function(e){return e.estOk})},i.prototype.removeFromListOfContexteSpecifique=function(e,t){var n={idContexteClient:e,cle:t,expediteur:this.getExpediteur()};return this.sendMessage(o.ContextClientMessageSubject.RemoveFromList,n).then(function(e){return e.estOk})},i.prototype.deletePropertyOfContexteSpecifique=function(e,t){var n={idContexteClient:e,cle:t,expediteur:this.getExpediteur()};return this.sendMessage(o.ContextClientMessageSubject.DeleteProperty,n).then(function(e){return e.estOk})},r=i,o.ContexteClientTechAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgentExtended,"TraceTechAgent",{get:function(){return this._techLibrary.TraceTechAgent}}),t.TechAgentExtended.prototype.purgerTraces=function(){return this.Library.Trace.purgeTrace()}}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgent,"TraceTechAgent",{get:function(){return this._techLibrary.TraceTechAgent}}),t.TechAgent.prototype.purgerTraces=function(){return this.Library.Trace.purgeTrace()}}(MyWay=MyWay||{}),function(e){(e.Services||(e.Services={})).TechLibrary.addInitListener(function(e,t){e.TraceTechAgent=t.Trace})}(MyWay=MyWay||{}),function(e){var r,o,t,n;function i(){return t.call(this)||this}r=e.Services||(e.Services={}),o=r.Trace||(r.Trace={}),t=o.TraceAgent,__extends(i,t),i.prototype.getIntervallePurge=function(t,e){return this.sendMessage(o.Messages.TraceMessageSubject.GetIntervallePurge,{}).then(function(e){return t&&t(e),e},e)},i.prototype.getQuotaPurge=function(t,e){return this.sendMessage(o.Messages.TraceMessageSubject.GetQuotaPurge,{}).then(function(e){return t&&t(e),e},e)},i.prototype.getEnregistrerTracesDansBD=function(e,t){return t&&t(new r.Erreur("Not implemented")),this.library.Core.createPromiseSelfError(new r.Erreur("Not implemented"))},i.prototype.setNiveauMinimumTraceConsole=function(e,t,n){return n&&n(new r.Erreur("Not implemented")),this.library.Core.createPromiseSelfError(new r.Erreur("Not implemented"))},i.prototype.getNiveauMinimumTraceConsole=function(e,t){return t&&t(new r.Erreur("Not implemented")),this.library.Core.createPromiseSelfError(new r.Erreur("Not implemented"))},i.prototype.setNiveauMinimumTraceBD=function(e,t,n){return n&&n(new r.Erreur("Not implemented")),this.library.Core.createPromiseSelfError(new r.Erreur("Not implemented"))},i.prototype.getNiveauMinimumTraceBD=function(e,t){return t&&t(new r.Erreur("Not implemented")),this.library.Core.createPromiseSelfError(new r.Erreur("Not implemented"))},i.prototype.getAfficherTracesDansConsole=function(e,t){return t&&t(new r.Erreur("Not implemented")),this.library.Core.createPromiseSelfError(new r.Erreur("Not implemented"))},i.prototype.reInitDbTraces=function(e,t){return this.sendMessage(o.Messages.TraceMessageSubject.ReInitDbTraces,{}).then(function(){e&&e()},t)},i.prototype.addOldTraces=function(e,t,n){return n&&n(new r.Erreur("Not implemented")),this.library.Core.createPromiseSelfError(new r.Erreur("Not implemented"))},i.prototype.purgeTrace=function(e,t,n){return this.sendMessage(o.Messages.TraceMessageSubject.PurgerTraces,{}).then(function(){t&&t()},n)},i.prototype.getTracesByLevel=function(e,t,n){return n&&n(new r.Erreur("Not implemented")),this.library.Core.createPromiseSelfError(new r.Erreur("Not implemented"))},i.prototype.setModeDebug=function(e,t,n){return this.sendMessage(o.Messages.TraceMessageSubject.SetModeDebug,{active:e}).then(function(){return t&&t([]),[]},n)},n=i,o.TraceTechAgent=n,r.Components.RegistryAgent.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,o,n,r;function i(){return n.call(this,t.Components.ComponentType.Aide)||this}t=e.Services||(e.Services={}),o=t.Aide||(t.Aide={}),n=t.Components.ComponentAgentBase,__extends(i,n),i.prototype.GetContenuInfobulle=function(e,t,n,r){return this.sendMessage(o.Messages.AideMessageSubject.GetContenuInfobulle,{idChampLie:e,horsProcessus:t,codeProcessus:n,codeEtape:r}).then(function(e){var t=new o.DetailInfobulleAfficheeResult(e);return new o.DetailInfobulleAfficheeResult(t)})},i.prototype.GetInfobullesAffichables=function(e,t,n){return this.sendMessage(o.Messages.AideMessageSubject.GetInfobullesAffichables,{horsProcessus:e,codeProcessus:t,codeEtape:n}).then(function(e){for(var t=[],n=0;n<e.length;n++)t.push(new o.InfobulleAfficheeResult(e[n]));return t})},r=i,o.AideAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Aide)||this}t=e.Services||(e.Services={}),n=t.Aide||(t.Aide={}),r=t.Components.ComponentApiBase,__extends(i,r),i.prototype.init=function(e,t,n){return r.prototype.init.call(this,e,t,n)},i.prototype.GetContenuInfobulle=function(e){return this.libraryManager.Core.sendRequest({url:t.PrivatePortalServiceParameters.Instance().AideUrl+"/recherche/infobulle?codeEtablissement="+e.codeEtablissement+"&processus="+e.codeProcessus+"&etape="+e.codeEtape+"&date="+e.dateTraitement+"&nomChamp="+e.idChampLie,method:t.MethodEnum.GET,withHeaders:!0})},i.prototype.GetInfobullesAffichables=function(e){return this.libraryManager.Core.sendRequest({url:t.PrivatePortalServiceParameters.Instance().AideUrl+"/recherche/presenceinfobulle?codeEtablissement="+e.codeEtablissement+"&processus="+e.codeProcessus+"&etape="+e.codeEtape+"&date="+e.dateTraitement,method:t.MethodEnum.GET,withHeaders:!0})},i.prototype.GetAideFlash=function(e){return this.libraryManager.Core.sendRequest({url:t.PrivatePortalServiceParameters.Instance().AideUrl+"/recherche/flash/?codeEtablissement="+e.codeEtablissement+"&etape="+e.codeEtape+"&date="+e.dateTraitement,method:t.MethodEnum.GET,withHeaders:!0})},o=i,n.AideApi=o,t.Components.RegistryApi.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t;(function(e){e.CODE_ETAPE_KEY="codeEtape",e.ID_FLASH_CODE_KEY="idFlashCode";var t=(n.prototype.estEgal=function(e){return this.codeEtablissement==e.codeEtablissement&&this.codeEtape==e.codeEtape&&this.codeProcessus==e.codeProcessus&&this.dateTraitement==e.dateTraitement&&this.pointEntree==e.pointEntree},n);function n(){}e.InfobulleAfficheeParametres=t;var r,o=(__extends(i,r=t),i.prototype.estEgal=function(e){return r.prototype.estEgal.call(this,e)&&this.idChampLie==e.idChampLie},i);function i(){return null!==r&&r.apply(this,arguments)||this}e.DetailInfobulleAfficheeParametres=o})((t=e.Services||(e.Services={})).Aide||(t.Aide={}))}(MyWay=MyWay||{}),function(e){var p,f,o,t;function g(){var e=o.call(this,p.Components.ComponentType.Acquisition)||this;return e.api=null,e.stateTasks={},e}p=e.Services||(e.Services={}),f=p.Acquisition||(p.Acquisition={}),o=p.Components.ComponentManagerBase,__extends(g,o),g.prototype.init=function(e,t,n,r){return this.api=r,o.prototype.init.call(this,e,t,n,r)},g.prototype.appelRADLAD=function(e,n){var r=this;return this.api.recuperationImageKofax(e).then(function(e){var t={save:n.save||!1,binarizeMethod:n.binarizeMethod||f.BINARIZE_METHOD.SIMPLE_THRESHOLD};return r.api.creerImagesBitonales(e,t).then(function(t){return r.library.Context.getAuthentificationInfo().then(function(e){return r.api.traitementRADLAD(JSON.parse(t),n,e).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("traitementRADLAD Success"),e},function(e){throw g.logger.error("traitementRADLAD failed - %1",JSON.stringify(e)),e})})},function(e){throw g.logger.error("creerImagesBitonales failed - %1",JSON.stringify(e)),e})},function(e){throw g.logger.error("recuperationImageKofax failed - %1",JSON.stringify(e)),e})},g.prototype.convertFileToImg=function(t,e){return this.api.convertFileToImg(t,e).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("convertFileToImg Success"),JSON.parse(e)},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",t),g.logger.error("convertFileToImg failed - %1",JSON.stringify(e)),e})},g.prototype.mergerEtArchiver=function(n,r){var o=this;return this.api.mergerPdfs(n).then(function(e){var t=JSON.parse(e);return r.docElect=t.base64,o.library.Context.getAuthentificationInfo().then(function(e){return o.api.archiver(r,e).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("archiver Success"),e},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",n),g.logger.error("archiver failed - %1",JSON.stringify(e)),e})})},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",n),g.logger.error("merge Pdf failed - %1",JSON.stringify(e)),e})},g.prototype.mergerEtUploader=function(e){return this.api.mergerPdfs(e).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("mergerPdfs Success"),JSON.parse(e).base64},function(e){throw g.logger.error("mergerPdfs failed - %1",JSON.stringify(e)),e})},g.prototype.convertBase64ToBin=function(e){return this.api.convertBase64ToBin(e).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("convertBase64ToBin Success"),e},function(e){throw g.logger.error("convertBase64ToBin failed - %1",JSON.stringify(e)),e})},g.prototype.purge=function(e){return this.api.purge(e).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("purge Success"),e},function(e){throw g.logger.error("purge failed - %1",JSON.stringify(e)),e})},g.prototype.fermetureSpiFactory=function(){return this.api.fermetureSpiFactory().then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("fermeture Spifactory Success"),e},function(e){throw g.logger.error("Spifactory failed - %1",JSON.stringify(e)),e})},g.prototype.setConfigurationScanner=function(e){return this.api.setConfigurationScanner(e).then(function(){return g.logger.debug("setConfigurationScanner Success"),!0},function(e){return g.logger.error("setConfigurationScanner failed - %1",JSON.stringify(e)),!1})},g.prototype.onMergeAndOpenPDF=function(r,e){var o=this,i=p.CoreCommon.ServiceDePromesse.defer(),s=this.generateGuid();this.stateTasks[s]={guid:s,state:f.Messages.START_STATE,frames:[]};var a,c,u=r.documents instanceof Array?r.documents.length:1,l=0;if(e){var t=this.library.Display.getMyIFrameId(e),n=this.library.Display.GetFrameModelById(t);this.stateTasks[s].frames.push(n)}return c=r.documents instanceof Array?r.documents:[r.documents],this.library.Context.getAuthentificationInfo().then(function(t){var n=[];return c.forEach(function(e){n.push(o.api.retrieveGedDocument(r.applicationCode,e,t).then(function(e){return l++,o.changeState(s,l/(u+1)*100),e}))}),p.Promesses.all(n).then(function(t){var r=[];return t.forEach(function(e){r.push({base64:e.fichier.contenu,type:f.ACQUISITION_TYPE.BASE64}),a=1===t.length?e.fichier.nom:"merge.pdf"}),o.api.mergerPdfs(r).then(function(e){var t=JSON.parse(e);p.Loggers.FLASH.INSTANCE.setValue("details",t.base64),g.logger.debug("mergerPdfs Success"),l++,o.changeState(s,l/(u+1)*100);var n={path:s,name:a,base64:t.base64};return o.api.saveDocument(n).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("SaveDocument Success"),o.api.openDocument(n).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("openDocument Success"),o.changeState(s,f.Messages.END_STATE),JSON.parse(e)},function(e){p.Loggers.FLASH.INSTANCE.setValue("details",r),g.logger.error("openDocument failed - %1",JSON.stringify(e)),o.changeState(s,f.Messages.ERROR,e.codeLibelle),i.reject(e)})},function(e){p.Loggers.FLASH.INSTANCE.setValue("details",r),g.logger.error("SaveDocument failed - %1",JSON.stringify(e)),o.changeState(s,f.Messages.ERROR,e.codeLibelle),i.reject(e)})},function(e){p.Loggers.FLASH.INSTANCE.setValue("details",r),g.logger.error("mergerPdfs failed - %1",JSON.stringify(e)),o.changeState(s,f.Messages.ERROR,e.codeLibelle),i.reject(e)})},function(e){p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("retrieveGedDocument failed - %1",JSON.stringify(e)),o.changeState(s,f.Messages.ERROR,e.codeLibelle),i.reject(e)})},function(e){p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("getAuthentificationInfo failed - %1",JSON.stringify(e)),o.changeState(s,f.Messages.ERROR,e.codeLibelle),i.reject(e)}),i.resolve(s),i.promise},g.prototype.onRecupereListeDocumentGED=function(r,o){var e,i=this;return e=r.documents instanceof Array?r.documents:[r.documents],this.library.Context.getAuthentificationInfo().then(function(t){var n=[];return e.forEach(function(e){n.push(i.api.retrieveGedDocument(r.applicationCode,e,t).then(function(e){return g.logger.debug("onRecupereListeDocumentGED : le document a été retrouvé en GED"),e}))}),p.Promesses.all(n).then(function(e){var t=[];return e.forEach(function(e){t.push({base64:e.fichier.contenu,type:f.ACQUISITION_TYPE.BASE64,nomDocumentEnGed:e.fichier.nom})}),i.api.mergerDocuments(t,o).then(function(e){return g.logger.debug("mergerDocuments Success"),e.replace(/@@/gi,"\\")},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",t),g.logger.error("mergerPdfs failed - %1",JSON.stringify(e)),e})},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("retrieveGedDocument failed - %1",JSON.stringify(e)),e})},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("getAuthentificationInfo failed - %1",JSON.stringify(e)),e})},g.prototype.onOuvrirListeDocumentGED=function(r,o,i){var e,s=this;return e=r.documents instanceof Array?r.documents:[r.documents],this.library.Context.getAuthentificationInfo().then(function(t){var n=[];return e.forEach(function(e){n.push(s.api.retrieveGedDocument(r.applicationCode,e,t).then(function(e){return g.logger.debug("onOuvrirListeDocumentGED : le document a été retrouvé en GED"),e}))}),p.Promesses.all(n).then(function(e){var t=[];return e.forEach(function(e){t.push({base64:e.fichier.contenu,type:f.ACQUISITION_TYPE.BASE64,nomDocumentEnGed:e.fichier.nom})}),s.api.manipulerArchives(t,o,i).then(function(){return g.logger.debug("manipulerArchives Success"),!0},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",t),g.logger.error("manipulerArchives failed - %1",JSON.stringify(e)),e})},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("retrieveGedDocument failed - %1",JSON.stringify(e)),e})},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("getAuthentificationInfo failed - %1",JSON.stringify(e)),e})},g.prototype.changeState=function(t,n,r){var o=this;this.stateTasks[t].state=n,this.stateTasks[t].detail=r,0<this.stateTasks[t].frames.length?this.stateTasks[t].frames.forEach(function(e){o.sendMessageWithFrame(f.Messages.AcquisitionMessageSubject.ChangeState,{guid:t,state:n,detail:r},e)}):this.sendMessage(f.Messages.AcquisitionMessageSubject.ChangeState,{guid:t,state:n,detail:r})},g.prototype.onGetProcessingTask=function(e){var t=p.CoreCommon.ServiceDePromesse.defer();return t.resolve(this.stateTasks[e]),t.promise},g.prototype.onGetDocumentGEDAndSave=function(n){var r=this;return p.CoreCommon.ServiceDePromesse.defer(),this.library.Context.getAuthentificationInfo().then(function(e){var t;if(n.documents instanceof Array)throw new Error("Tableau de document impossibles, uniquement un seul document peut être traité");return t=n.documents,r.api.retrieveGedDocument(n.applicationCode,t,e).then(function(e){var t={path:r.generateGuid(),name:e.fichier.nom,base64:e.fichier.contenu};return r.api.saveDocument(t).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("SaveDocument Success"),JSON.parse(e)},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("SaveDocument failed - %1",JSON.stringify(e)),e})})})},g.prototype.onGetDocumentGedSaveAtAndOpen=function(n){var r=this;return this.library.Context.getAuthentificationInfo().then(function(e){var t={id:null,nature:null};return t.id=n.id,t.nature=n.nature,r.api.retrieveGedDocument(n.applicationCode,t,e).then(function(e){var t={path:n.cheminSauvegardeSurLePoste,name:e.fichier.nom,base64:e.fichier.contenu};return r.api.saveDocumentGedAtAndOpen(t).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("onGetDocumentGedSaveAtAndOpen - saveDocumentGedAtAndOpen Success"),e},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("onGetDocumentGedSaveAtAndOpen - saveDocumentGedAtAndOpen failed - %1",JSON.stringify(e)),e})},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("onGetDocumentGedSaveAtAndOpen - retrieveGedDocument failed - %1",JSON.stringify(e)),e})},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("onGetDocumentGedSaveAtAndOpen - GetAuthentificationInfo failed - %1",JSON.stringify(e)),e})},g.prototype.onUploadDocumentFrom=function(e){return this.api.uploadDocumentFrom(e).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("onUploadDocumentFrom - uploadDocumentFrom : Success"),e},function(e){throw g.logger.error("onUploadDocumentFrom - uploadDocumentFrom : failed - %1",JSON.stringify(e)),e})},g.prototype.onGetDocumentGEDAndOpen=function(n){var r=this;return p.CoreCommon.ServiceDePromesse.defer(),this.library.Context.getAuthentificationInfo().then(function(e){var t={id:null,nature:null};return t.id=n.id,t.nature=n.nature,r.api.retrieveGedDocument(n.applicationCode,t,e).then(function(e){var t={path:r.generateGuid(),name:e.fichier.nom,base64:e.fichier.contenu};return r.api.saveDocument(t).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("SaveDocument Success"),r.api.openDocument(t).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.debug("openDocument Success"),JSON.parse(e)},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("openDocument failed - %1",JSON.stringify(e)),e})},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("SaveDocument failed - %1",JSON.stringify(e)),e})}).catch(function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("retrieveGedDocument failed - %1",JSON.stringify(e)),e})}).catch(function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("getAuthentificationInfo failed - %1",JSON.stringify(e)),e})},g.prototype.onGetListeScanner=function(){return this.api.getListeScanner().then(function(e){return g.logger.debug("onGetListeScanner Success"),JSON.parse(e)},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("onGetListeScanner failed - %1",JSON.stringify(e)),e})},g.prototype.onIsPrisEnMainADistance=function(){return this.api.isPrisEnMainADistance().then(function(e){return g.logger.debug("onIsPrisEnMainADistance Success"),JSON.parse(e)},function(e){throw p.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("onIsPrisEnMainADistance failed - %1",JSON.stringify(e)),e})},g.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},g.prototype.generateGuid=function(){return(this.S4()+this.S4()+"-"+this.S4()+"-4"+this.S4().substr(0,3)+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()).toLowerCase()},g.CLASS_NAME="MyWay.Services.Acquisition.AcquisitionManager",g.logger=p.Loggers.LoggerFactory.INSTANCE.getClass(g.CLASS_NAME),t=g,f.AcquisitionManager=t,p.Components.RegistryManager.getInstance().register(t)}(MyWay=MyWay||{}),function(o){var i,s,a,e;function c(){var e=a.call(this,i.Components.ComponentType.Communication)||this;return e.api=null,e}i=o.Services||(o.Services={}),s=i.Communication||(i.Communication={}),a=i.Components.ComponentManagerBase,__extends(c,a),c.prototype.init=function(e,t,n,r){return this.api=r,a.prototype.init.call(this,e,t,n,r)},c.prototype.envoyerMail=function(e){var t;if(""!==(t=s.controleEnvoyerMail(e))){var n=new i.Erreur(o.Services.Libelle.LibelleModel.COM.ERREUR_COMMUNICATION_FORMAT_MAIL_INCORRECT,[t]);return c.logger.error("envoyerMail Failed - %1",JSON.stringify(n)),this.library.Core.createPromiseSelfError(n)}var r="mailto:{0}?{1}{2}{3}{4}";return(r=(r=(r=(r=(r=(r=r.replace("{0}",e.to)).replace("{1}",i.Controle.StaticStringControle.isString(e.subject)?"subject="+e.subject+"&":"")).replace("{2}",i.Controle.StaticStringControle.isString(e.body)?"body="+e.body.replace(/\n/g,"%0D%0A")+"&":"")).replace("{3}",i.Controle.StaticStringControle.isString(e.cc)?"cc="+e.cc+"&":"")).replace("{4}",i.Controle.StaticStringControle.isString(e.bcc)?"bcc="+e.bcc:"")).replace("?&","?")).lastIndexOf("&")!=r.length-1&&r.lastIndexOf("?")!=r.length-1||(r=r.substring(0,r.length-1)),c.logger.debug("envoyerMail Success - %1",r),this.library.Core.createPromiseSelfResolved(r)},c.prototype.declencherAppel=function(t){var e,n=this;if(""===(e=s.controleDeclencherAppel(t)))return this.library.Context.getAuthentificationInfo().then(function(e){if(null!==e)return n.api.declencherAppel(t,e).then(function(e){return c.logger.debug("API NumerotationTelephonique.declencherAppel Success"),e},function(e){throw c.logger.error("API NumerotationTelephonique.declencherAppel Failed - %1",JSON.stringify(e)),e});throw c.logger.error("Données d'appel manquantes"),new i.Erreur(o.Services.Libelle.LibelleModel.COM.ERREUR_COMMUNICATION_DONNEES_APPEL_MANQUANTE)});var r=new i.Erreur(o.Services.Libelle.LibelleModel.COM.ERREUR_COMMUNICATION_FORMAT_NUMERO_INCORRECT,[e]);return c.logger.error("envoyerMail Failed - %1",JSON.stringify(r)),this.library.Core.createPromiseSelfError(r)},c.prototype.raccrocherAppel=function(){var t=this;return this.library.Context.getAuthentificationInfo().then(function(e){return t.api.raccrocherAppel(e).then(function(e){return c.logger.debug("API NumerotationTelephonique.raccrocherAppel Success"),e},function(e){throw c.logger.error("API NumerotationTelephonique.raccrocherAppel Failed - %1",JSON.stringify(e)),e})})},c.prototype.envoyerMessageAppliKiosque=function(e){return this.api.envoyerMessageAppliKiosque(e).then(function(e){return c.logger.debug("API NumerotationTelephonique.raccrocherAppel Success"),e},function(e){throw c.logger.error("API NumerotationTelephonique.raccrocherAppel Failed - %1",JSON.stringify(e)),e})},c.CLASS_NAME="MyWay.Services.Communication.CommunicationManager",c.logger=i.Loggers.LoggerFactory.INSTANCE.getClass(c.CLASS_NAME),e=c,s.CommunicationManager=e,i.Components.RegistryManager.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var n;(n=e.Services||(e.Services={})).PhantomAgent.addListenerOnInit(function(e,t){e.Communication=new n.Communication.PhantomCommunicationAgent(t)})}(MyWay=MyWay||{}),function(e){var t,n,r;function o(e){this.serviceManager=e}t=e.Services||(e.Services={}),n=t.Communication||(t.Communication={}),o.prototype.envoyerMail=function(e){return this.serviceManager.Library.Communication.envoyerMail(e)},o.prototype.declencherAppel=function(e){return this.serviceManager.Library.Communication.declencherAppel(e)},o.prototype.raccrocherAppel=function(){return this.serviceManager.Library.Communication.raccrocherAppel()},r=o,n.PhantomCommunicationAgent=r}(MyWay=MyWay||{}),function(e){var s,g,a,t;function h(){var i=a.call(this,s.Components.ComponentType.BriqueCommunication)||this;return i.initialization=null,i.api=null,i.configuration=null,i.configurationEtablissement=null,i.AVAILABLE=null,i.CONNECTED=null,i.TO_DEVICE=null,i.FROM_DEVICE=null,i.CONFIGURATION_ETABLISSEMENT=null,i.agentCourant=null,i.loadConfig=function(o){return h.logger.error("Chargement de la configuration globale KAAZING"),s.CoreCommon.promesseTryCatch(function(t){function n(e){r.close(),i.configuration=e,i.configuration.forEach(function(e){switch(e.code){case"USERS_TODEVICE":i.TO_DEVICE=e;break;case"USERS_FROMDEVICE":i.FROM_DEVICE=e;break;case"USERS_AVAILABLE":i.AVAILABLE=e;break;case"USERS_ONLINE":i.CONNECTED=e;break;case"CHANNELS_SEC_CONFIGURATION":i.CONFIGURATION_ETABLISSEMENT=e}}),i.loadConfigEtablissement(o,t)}var r=null;i.ouvrirCanal(g.URLBASE_CONFIGURATION,g.TOPIC_CONFIGURATION_GENERALE,{readable:!0,writable:!1},o).then(function(e){(r=e).reader=n},function(e){h.logger.error("Impossible de charger la configuration KAAZING : %1",JSON.pruned(e)),t.reject(e)})}).then(function(){return i.enregistrerAgent()})},i.sessions={},i.connexionsInProgress={},i.connexionsEnFileDAttente={},i}s=e.Services||(e.Services={}),g=s.BriqueCommunication||(s.BriqueCommunication={}),a=s.Components.ComponentManagerBase,__extends(h,a),h.prototype.init=function(e,t,n,r){var o=this;return this.api=r,a.prototype.init.call(this,e,t,n,r).then(function(){if(window.JmsConnectionFactory)return e.Context.getAuthentificationInfo().then(function(e){return o.loadConfig(e)}).then(function(){o.library.Display.setFormatObjectNotificationListener(s.Component.ManagerEventType.BriqueCommunication,function(e,t){t.type=s.CommonEventType.BriqueCommunication,t.Contenu=e.Detail.chat})})})},h.prototype.getConfiguration=function(){return this.configuration},h.prototype.getConfigurationEtablissement=function(){return this.configurationEtablissement},h.prototype.getInfosAgentCourant=function(){return this.agentCourant},h.prototype.loadConfigEtablissement=function(e,t){var n=this;function r(e){o.close(),n.configurationEtablissement=e,h.logger.error("Fin de chargement de la configuration"),t.resolve()}h.logger.error("Chargement de la configuration de l'établissement");var o=null;this.ouvrirCanal(this.CONFIGURATION_ETABLISSEMENT.url,this.replaceTokens(this.CONFIGURATION_ETABLISSEMENT.destination,{establishment:e.codeEtablissement}),{readable:!0,writable:!1},e).then(function(e){(o=e).reader=r},function(e){h.logger.error("Impossible de charger la configuration par établissement de KAAZING : %1",JSON.pruned(e)),t.reject(e)})},h.prototype.enregistrerAgent=function(){var o=this;return s.CoreCommon.promesseTryCatch(function(r){o.library.Context.getAuthentificationInfo().then(function(e){function t(t){n.close(),t.firstname=e.agentConnecte.prenom,t.lastname=e.agentConnecte.nomFamillePersonnePhysique,t.establishment=e.codeEtablissement,t.persisted=!0,o.agentCourant=t,o.ouvrirCanal(o.FROM_DEVICE.url,o.FROM_DEVICE.destination,{readable:!1,writable:!0},e).then(function(e){e.writer(t),e.close(),r.resolve()},r.reject)}var n=null;o.ouvrirCanal(o.TO_DEVICE.url,o.TO_DEVICE.destination,{readable:!0,writable:!1},e).then(function(e){(n=e).reader=t},r.reject)},r.reject)})},h.prototype.setStatutEnLigne=function(t){var n=this;return this.library.Context.getAuthentificationInfo().then(function(e){return n.agentCourant.onlineStatus=t,n.ouvrirCanal(n.FROM_DEVICE.url,n.FROM_DEVICE.destination,{readable:!1,writable:!0},e).then(function(e){e.writer(n.agentCourant),e.close()})})},h.prototype.getUtilisateursConnectes=function(){var t=this;return this.library.Context.getAuthentificationInfo().then(function(e){return t.ouvrirCanal(t.CONNECTED.url,t.replaceTokens(t.CONNECTED.destination,{establishment:e.codeEtablissement}),{readable:!0,writable:!1},e).then(function(e){return e})})},h.prototype.getUtilisateurs=function(){var t=this;return this.library.Context.getAuthentificationInfo().then(function(e){return t.ouvrirCanal(t.AVAILABLE.url,t.AVAILABLE.destination,{readable:!0,writable:!1},e).then(function(e){return e})})},h.prototype.dispose=function(){var o=this;return s.CoreCommon.promesseTryCatch(function(e){var t=[];for(var n in o.sessions){var r=s.CoreCommon.ServiceDePromesse.defer();o.sessions[n].session.close(function(){r.resolve()}),delete o.sessions[n],t.push(r.promise)}s.CoreCommon.ServiceDePromesse.all(t).finally(e.resolve)})},h.prototype.ouvrirCanal=function(u,l,p,e){var f=this;return s.CoreCommon.promesseTryCatch(function(c){f.connect(u,e).then(function(e){var t=null!==l.match(/^\/queue\//);h.logger.debug("Connexion à %1, sur %2",u,l);var n=null,r=f.sessions[e].session;n=t?r.createQueue(l):r.createTopic(l);var o=null,i=null,s=new g.CanalControler;if(s.messagesEnAttente=null,s.close=function(){h.logger.debug("Deconnexion de %1, sur %2",u,l),o&&o.close(function(){}),i&&i.close(),f.sessions[e]&&(f.sessions[e].count--,null!==f.sessions[e].timeoutToClose&&window.clearTimeout(f.sessions[e].timeoutToClose),f.sessions[e].timeoutToClose=window.setTimeout(function(){f.sessions[e].count<=0&&(h.logger.debug("Tente de fermer la connexion à %1",u),f.sessions[e].session.close(function(){h.logger.debug("Session fermée à %1",u)}),delete f.sessions[e],delete f.connexionsInProgress[e],delete f.connexionsEnFileDAttente[e])},5e3))},p.readable&&(o=r.createConsumer(n)).setMessageListener(function(e){h.logger.debug("Message arrivé sur %1 : %2",l,JSON.pruned(e.getText()));var t=e.getText(),n=JSON.parse(t);s.reader(n)}),p.writable){i=r.createProducer(n);var a=function(e){var t=r.createTextMessage(e);i.send(t,function(){var e=s.messagesEnAttente,t=null,n=null;if(e&&0<e.length){n=e[0],t=[];for(var r=1;r<e.length;r++)t.push(e[r])}s.messagesEnAttente=t,n&&a(n)})};s.writer=function(e){var t=JSON.stringify(e);s.messagesEnAttente?s.messagesEnAttente.push(t):(s.messagesEnAttente=[],a(t))}}c.resolve(s)})})},h.prototype.replaceTokens=function(e,t){var n;for(n in t){var r=t[n];e=e.replace("["+n+"]",r)}return e},h.prototype.connect=function(r,e){var o=this;return s.CoreCommon.promesseTryCatch(function(n){return o.sessions[r]?(o.sessions[r].count++,void n.resolve(r)):o.connexionsInProgress[r]?(o.connexionsEnFileDAttente[r]||(o.connexionsEnFileDAttente[r]=[]),void o.connexionsEnFileDAttente[r].push(n)):(o.connexionsInProgress[r]=!0,void o.api.connect(r,e).then(function(e){var t=e;o.sessions[r]={count:1,session:t,timeoutToClose:null},o.connexionsEnFileDAttente[r]&&(o.connexionsEnFileDAttente[r].forEach(function(e){o.sessions[r].count++,e.resolve(r)}),delete o.connexionsEnFileDAttente[r]),delete o.connexionsInProgress[r],n.resolve(r)}))})},h.CLASS_NAME="MyWay.Services.BriqueCommunication.BriqueCommunicationManager",h.logger=s.Loggers.LoggerFactory.INSTANCE.getClass(h.CLASS_NAME),t=h,g.BriqueCommunicationManager=t,s.Components.RegistryManager.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var a,t,c,i,n;function s(){var t=i.call(this,a.Components.ComponentType.Chat)||this;return t.conf_chat_request=null,t.conf_chat_request_experts=null,t.conf_chat_rooms=null,t.storageInstance=null,t.storageValue=null,t.storageSaveTimeout=null,t.chatManagerCanaux=null,t.onChangeStorage=function(e){e.chats.forEach(function(e){t.chatManagerCanaux.getChatRoomById(e.chatroom_id)||t.openChatroom.apply(t,[e.chatroom_id,null].concat(e.membres))})},t.onChangeAuthentificationInfo=function(){t.chatManagerCanaux.closeAndOpenAll()},t}a=e.Services||(e.Services={}),t=a.BriqueCommunication||(a.BriqueCommunication={}),c=t.Chat||(t.Chat={}),i=a.Components.ComponentManagerBase,__extends(s,i),s.prototype.init=function(e,t,n,r){var o=this;return i.prototype.init.call(this,e,t,n,r).then(function(){if(window.JmsConnectionFactory)return o.chatManagerCanaux=new c.ChatManagerCanaux(e),o.load()})},s.prototype.sendNotification=function(e,t){var n={mainEventType:a.BriqueCommunication.Messages.EVENT_TYPE.CHAT,event:e},r=new a.Component.ManagerEvent(a.Component.ManagerEventType.BriqueCommunication,{chat:n});r.onSend=t,this.library.Evennements.notifier(r)},s.prototype.getCurrentFramePrincipale=function(){if(this.library.Display.CurrentFrame&&this.library.Display.CurrentFrame.capaciteChat)return this.library.Display.CurrentFrame.FrameId;var t=null;return this.library.Display.Frames&&this.library.Display.Frames.every(function(e){return e.capaciteChat&&(t=e.FrameId),null===t}),t},s.prototype.load=function(){var s=this;return this.storageInstance=this.library.Persistence.addStorage("Chats",this.onChangeStorage),this.chatManagerCanaux.init({fermerChatroom:function(e){s.closeChat(e)},ouvrirChatroom:function(e,t,n){n.push(t),s.openChatroom.apply(s,[e,s.getCurrentFramePrincipale()].concat(n))},notifierChangementListeUtilisateurs:function(o){var i=!1;s.storageValue.chats.forEach(function(e){var n=[],r=s.chatManagerCanaux.getChatRoomById(e.chatroom_id);e.membres.forEach(function(t){o.every(function(e){return e.id!==t||(e.isConnected?n.push(t):(i=!0,r&&r.utilisateurDeconnecte(t)),!1)})}),i&&(e.membres=n)}),s.sendNotification({eventType:c.Messages.EVENT_TYPE.MISE_A_JOUR_LISTE_UTILISATEURS,utilisateurs:o})},demanderExpert:function(e,t,n){s.sendNotification({eventType:c.Messages.EVENT_TYPE.DEMANDE_EXPERT,chatroom_id:e,expertise:t,user_id:n})},finDemandeExpert:function(e,t,n){s.sendNotification({eventType:c.Messages.EVENT_TYPE.FIN_DEMANDE_EXPERT,chatroom_id:e,expertise:t,user_id:n})}}),this.storageValue=this.storageInstance.getValue(),this.storageValue||(this.storageValue={chats:[]}),this.onChangeStorage(this.storageValue),this.ajouterListenerEvent(a.Component.ManagerEventType.ChangementAuthentificationInfo,this.onChangeAuthentificationInfo),this.library.BriqueCommunication.getConfiguration().forEach(function(e){switch(e.code){case"CHAT_REQUEST":s.conf_chat_request=e;break;case"CHATROOM":s.conf_chat_rooms=e;break;case"CHAT_REQUEST_PROSPECT":s.conf_chat_request_experts=e}}),this.library.Core.getPromesseSelfResoved()},s.prototype.addChatroomReader=function(e){var t=this;e.reader=function(e){t.sendNotification({eventType:c.Messages.EVENT_TYPE.MESSAGE_RECU,message:e})}},s.prototype.setChatCapacite=function(e){var t=this.library.Display.getMyIFrameId(e);this.library.Display.Frames&&this.library.Display.Frames.every(function(e){return e.FrameId===t&&(e.capaciteChat=!0),!0}),this.library.Display.CurrentFrame&&(this.library.Display.CurrentFrame.capaciteChat=!0)},s.prototype.getUtilisateurs=function(){return this.chatManagerCanaux.getUtilisateurs()},s.prototype.setStatut=function(e){return this.library.BriqueCommunication.setStatutEnLigne(e===c.Messages.UTILISATEUR_STATUT.CONNECTE)},s.prototype.getChatrooms=function(e){var n=this,r=this.library.Display.getMyIFrameId(e);return this.library.Core.promesseTryCatch(function(e){var t=[];n.chatManagerCanaux.getChatrooms().forEach(function(e){t.push({id:e.id,membres:e.membres,framePrincipale:e.framePrincipale,estFramePrincipale:e.framePrincipale===r,videoEstEnCours:!1})}),e.resolve(t)})},s.prototype.getChatroom=function(r,e){var o=this,i=this.library.Display.getMyIFrameId(e);return this.library.Core.promesseTryCatch(function(e){var t=o.chatManagerCanaux.getChatRoomById(r),n={id:t.id,membres:t.membres,framePrincipale:t.framePrincipale,estFramePrincipale:t.framePrincipale===i,videoEstEnCours:!1};e.resolve(n)})},s.prototype.closeChat=function(n){var r=this;return this.library.Core.promesseTryCatch(function(e){var t=r.chatManagerCanaux.getChatRoomById(n);null!==t?(t.writeEnd(),t.close(),r.chatManagerCanaux.retirerChatroom(t),r.supprimerStorageInstance(n),r.sendNotification({eventType:c.Messages.EVENT_TYPE.CHAT_FERME,chatroom_id:n}),e.resolve()):e.reject(new a.Erreur("Chat room "+n+" isn't found!"))})},s.prototype.accepterDemandeExpert=function(e,t,n,r){var o=this;return this.openChatroom(e,r,n).then(function(){o.chatManagerCanaux.accepterDemandeExpert(e,t,n)})},s.prototype.inviterPersonnesAUneChatroom=function(o){for(var i=this,e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return this.library.Context.getAuthentificationInfo().then(function(t){var n=i.chatManagerCanaux.getChatRoomById(o);if(n){var r=[];n.membres.forEach(function(e){r.push(e)}),e.forEach(function(e){n.membresObject[e]||r.push(e)}),e.forEach(function(e){i.inviterPersonneARejoindreUneChatroomApi.apply(i,[o,e,t].concat(r))})}})},s.prototype.changerFramePrincipale=function(e,t){var n=this.chatManagerCanaux.getChatRoomById(e);if(n&&n.framePrincipale!==t){n.framePrincipale=t;var r={eventType:c.Messages.EVENT_TYPE.CHAT_OUVERT,chatroom_id:e,framePrincipale:n.framePrincipale,videoEstEnCours:n.videoEstEnCours,estFramePrincipale:!1};this.sendNotification(r,function(e){return e===n.framePrincipale?r.estFramePrincipale=!0:r.estFramePrincipale=!1,!0})}},s.prototype.demarrerVideoChatroom=function(e){var t=this.chatManagerCanaux.getChatRoomById(e);t&&(t.videoEstEnCours=!0)},s.prototype.arreterVideoChatroom=function(e){var t=this.chatManagerCanaux.getChatRoomById(e);t&&(t.videoEstEnCours=!1)},s.prototype.openChat=function(r,e){var o=this,i=this.library.Display.getMyIFrameId(e);return this.library.Core.promesseTryCatch(function(n){var t=null;if(o.chatManagerCanaux.getChatrooms().every(function(e){if(!(2<e.membres.length))return e.membres[0]!==r&&e.membres[1]!==r||(t=e),null===t}),t){var e={id:t.id,membres:t.membres,framePrincipale:t.framePrincipale,estFramePrincipale:t.framePrincipale===i,videoEstEnCours:!1};n.resolve(e)}else o.openChatApi(r).then(function(e){e.framePrincipale=i;var t={id:e.id,membres:e.membres,framePrincipale:e.framePrincipale,estFramePrincipale:e.framePrincipale===i,videoEstEnCours:!1};o.enregistrerVideoroomsOuvertes(e),o.chatManagerCanaux.ajouterChatroom(e),o.addChatroomReader(e),o.sendNotification({eventType:c.Messages.EVENT_TYPE.CHAT_OUVERT,chatroom_id:e.id,membres:e.membres,framePrincipale:e.framePrincipale,estFramePrincipale:e.framePrincipale===i}),n.resolve(t)},n.reject)})},s.prototype.openChatroom=function(r,e){for(var o=this,i=[],t=2;t<arguments.length;t++)i[t-2]=arguments[t];var s=null;return s="string"==typeof e?e:this.library.Display.getMyIFrameId(e),this.library.Core.promesseTryCatch(function(n){var e=o.chatManagerCanaux.getChatRoomById(r);if(e){var t={id:e.id,membres:e.membres,framePrincipale:e.framePrincipale,estFramePrincipale:e.framePrincipale===s,videoEstEnCours:!1};n.resolve(t)}else o.library.Context.getAuthentificationInfo().then(function(e){o.library.Core.StringUtils.leftPad(e.agentConnecte.referenceExterneAgent,"0",7);var t=[r];i&&i.forEach(function(e){t.push(e)}),o.openTchatroomApi.apply(o,[r].concat(i)).then(function(e){e.framePrincipale=s,e.writeResponse(!0);var t={id:e.id,membres:e.membres,framePrincipale:e.framePrincipale,estFramePrincipale:e.framePrincipale===s,videoEstEnCours:!1};i&&i.forEach(function(e){}),o.enregistrerVideoroomsOuvertes(e),o.chatManagerCanaux.ajouterChatroom(e),o.addChatroomReader(e),o.sendNotification({eventType:c.Messages.EVENT_TYPE.CHAT_OUVERT,chatroom_id:e.id,membres:e.membres,framePrincipale:e.framePrincipale,estFramePrincipale:e.framePrincipale===s}),n.resolve(t)},n.reject)},n.reject)})},s.prototype.enregistrerVideoroomsOuvertes=function(o){function n(t){if(!o.membresObject[t]){var n={eventType:c.Messages.EVENT_TYPE.UTILISATEUR_CONNECTE_A_CHAT,chatroom_id:o.id,user_id:t,framePrincipale:o.framePrincipale,estFramePrincipale:!1};i.sendNotification(n,function(e){return e===o.framePrincipale?n.estFramePrincipale=!0:n.estFramePrincipale=!1,!0})}var r=o.videosrooms[t].canal.writer;o.videosrooms[t].canal.writer=function(e){var t=JSON.parse(e);s.logger.debug("Envoi d'un message sur la chatroom %1 : %2",o.id,JSON.pruned(t)),r(t)},o.videosrooms[t].canal.reader=function(e){s.logger.debug("Reception d'un message sur la chatroom %1 : %2",o.id,JSON.pruned(e)),i.sendMessage(c.ChatMessageSubject.WebRTC,{chatroom_id:o.id,user_id:t,content:e})}}var i=this;o.utilisateurConnecte=function(e){var t={eventType:c.Messages.EVENT_TYPE.UTILISATEUR_CONNECTE_A_CHAT,chatroom_id:o.id,user_id:e,framePrincipale:o.framePrincipale,estFramePrincipale:!1};i.sendNotification(t,function(e){return e===o.framePrincipale?t.estFramePrincipale=!0:t.estFramePrincipale=!1,!0}),i.ajouterStorageInstance(o)},o.utilisateurDeconnecte=function(e){i.sendNotification({eventType:c.Messages.EVENT_TYPE.UTILISATEUR_DECONNECTE_A_CHAT,chatroom_id:o.id,user_id:e}),i.ajouterStorageInstance(o)},o.videoroomAjoutee=function(e,t){n(t)},o.membres.forEach(function(e){o.videosrooms[e]&&n(e)}),this.ajouterStorageInstance(o)},s.prototype.sendMessageToStream=function(n,r){var o=this;return this.library.Core.promesseTryCatch(function(e){var t=o.chatManagerCanaux.getChatRoomById(n);null!==t?(t.writeMessage(r),e.resolve()):e.reject(new a.Erreur("Chat room "+n+" isn't found!"))})},s.prototype.envoyerMessageVideoroom=function(r,o,i){var s=this;return this.library.Core.promesseTryCatch(function(e){var t=s.chatManagerCanaux.getChatRoomById(r);if(null!==t){var n=t.videosrooms[o];n?(n.canal.writer(i),e.resolve()):e.reject(new a.Erreur("Video room "+r+" to user "+o+" isn't found!"))}else e.reject(new a.Erreur("Chat room "+r+" isn't found!"))})},s.prototype.demarrerVideo=function(t){var r=this;return this.library.Core.promesseTryCatch(function(e){var n=r.chatManagerCanaux.getChatRoomById(t);n?n.membres.forEach(function(e){var t=n.videosrooms[e];t&&t.start()}):e.reject(new a.Erreur("Chat "+t+" not found!"))})},s.prototype.arreterVideo=function(t){var r=this;return this.library.Core.promesseTryCatch(function(e){var n=r.chatManagerCanaux.getChatRoomById(t);n?n.membres.forEach(function(e){var t=n.videosrooms[e];t&&t.stop()}):e.reject(new a.Erreur("Chat "+t+" not found!"))})},s.prototype.saveStorageValue=function(){var e=this;null!==this.storageSaveTimeout&&(window.clearTimeout(this.storageSaveTimeout),this.storageSaveTimeout=null),this.storageSaveTimeout=window.setTimeout(function(){e.storageInstance.saveValue(e.storageValue)},100)},s.prototype.ajouterStorageInstance=function(e){var t=this.getStorageInstance(e.id);t||(t={chatroom_id:e.id,membres:[]},this.storageValue.chats.push(t)),t.membres=e.membres,this.saveStorageValue()},s.prototype.supprimerStorageInstance=function(e){for(var t=!1,n=0;n<this.storageValue.chats.length-1;n++)this.storageValue.chats[n].chatroom_id===e&&(t=!0),t&&(this.storageValue.chats[n]=this.storageValue.chats[n+1]);!t&&this.storageValue.chats[this.storageValue.chats.length-1].chatroom_id!==e||this.storageValue.chats.length--,this.saveStorageValue()},s.prototype.getStorageInstance=function(t){var n=null;return this.storageValue.chats.every(function(e){return e.chatroom_id===t&&(n=e),null===n}),n},s.prototype.ecouterCanalDeDemandeApi=function(t){var n=this;return this.library.Context.getAuthentificationInfo().then(function(e){return n.library.BriqueCommunication.ouvrirCanal(n.conf_chat_request.url,n.library.BriqueCommunication.replaceTokens(n.conf_chat_request.destination,{user_id:t}),{readable:!0,writable:!1},e).then(function(e){return e})})},s.prototype.ecouterCanalExpertiseApi=function(t){var n=this;return this.library.Context.getAuthentificationInfo().then(function(e){return n.library.BriqueCommunication.ouvrirCanal(n.conf_chat_request_experts.url,n.library.BriqueCommunication.replaceTokens(n.conf_chat_request_experts.destination,{domain:t}),{readable:!0,writable:!0},e).then(function(e){return e})})},s.prototype.inviterPersonneARejoindreUneChatroomApi=function(n,e,t){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var i="agent-S"+this.library.Core.StringUtils.leftPad(t.agentConnecte.referenceExterneAgent,"0",7);this.library.BriqueCommunication.ouvrirCanal(this.conf_chat_request.url,this.library.BriqueCommunication.replaceTokens(this.conf_chat_request.destination,{user_id:e}),{readable:!1,writable:!0},t).then(function(e){var t={chatroom_id:n,type:"request",user_id:i,users_ids:r};e.writer(t),e.close()})},s.prototype.openChatApi=function(n){var r=this,o=this.generateRoomId();return this.library.Context.getAuthentificationInfo().then(function(t){return r.openTchatroomApi(o,n).then(function(e){return e.membresObject[n]||(e.membres.push(n),e.membresObject[n]=!0),r.inviterPersonneARejoindreUneChatroomApi(o,n,t),e})})},s.prototype.openTchatroomApi=function(i){for(var s=this,t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return this.library.Context.getAuthentificationInfo().then(function(e){var r="agent-S"+s.library.Core.StringUtils.leftPad(e.agentConnecte.referenceExterneAgent,"0",7),o={membres:[],membresObject:{},myUserId:r,id:i,close:null,reader:null,writeMessage:null,writeResponse:null,writeEnd:null,videosrooms:{},videoroomAjoutee:null,utilisateurConnecte:null,utilisateurDeconnecte:null,framePrincipale:null,videoEstEnCours:!1};function n(t){if(!o.membresObject[t.user_id]){if("response"===t.type&&!t.accepted)return;o.membres.push(t.user_id),o.membresObject[t.user_id]=!0,o.utilisateurConnecte&&o.utilisateurConnecte(t.user_id),t.user_id!==r&&s.ouvrirCanalVideoApi(o,t.user_id).then(function(e){o.videosrooms[t.user_id]=e,o.videoroomAjoutee&&o.videoroomAjoutee(e,t.user_id)})}if("end"!==t.type)"message"===t.type&&o.reader&&o.reader(t);else if(o.membresObject[t.user_id]){for(var e=!1,n=0;n<o.membres.length-1;n++)o.membres[n]===t.user_id&&(e=!0),e&&(o.membres[n]=o.membres[n+1]);!e&&o.membres[o.membres.length-1]!==t.user_id||o.membres.length--,delete o.membresObject[t.user_id],o.utilisateurDeconnecte&&o.utilisateurDeconnecte(t.user_id)}}return o.membres.push(r),o.membresObject[r]=!0,t&&t.forEach(function(e){o.membresObject[e]||(o.membres.push(e),o.membresObject[e]=!0)}),s.library.BriqueCommunication.ouvrirCanal(s.conf_chat_rooms.url,s.library.BriqueCommunication.replaceTokens(s.conf_chat_rooms.destination,{chatroom_id:i}),{readable:!0,writable:!0},e).then(function(t){return t.reader=n,o.membres.forEach(function(t){t!==r&&s.ouvrirCanalVideoApi(o,t).then(function(e){o.videosrooms[t]=e,o.videoroomAjoutee&&o.videoroomAjoutee(e,t)})}),o.close=function(){o.membres.forEach(function(e){o.videosrooms[e]&&o.videosrooms[e].canal.close()}),t.close()},o.writeMessage=function(e){t.writer({chatroom_id:i,message:e,type:"message",user_id:r})},o.writeResponse=function(e){t.writer({chatroom_id:i,accepted:e,type:"response",user_id:r})},o.writeEnd=function(){t.writer({chatroom_id:i,type:"end",user_id:r})},o})})},s.prototype.ouvrirCanalVideoApi=function(e,t){var n=this,r=this.library.BriqueCommunication.replaceTokens(this.conf_chat_rooms.destination,{chatroom_id:e.id})+"/webrtc/"+(e.myUserId.localeCompare(t)<0?e.myUserId+"_"+t:t+"_"+e.myUserId);return s.logger.debug("Ouverture vidéo vers %1",r),this.library.Context.getAuthentificationInfo().then(function(e){return n.library.BriqueCommunication.ouvrirCanal(n.conf_chat_rooms.url,r,{readable:!0,writable:!0},e).then(function(e){return{start:null,stop:null,canal:e}})})},s.prototype.generateRoomId=function(){return Math.random().toString(36).substring(2)},s.CLASS_NAME="MyWay.Services.BriqueCommunication.Chat.ChatManagerBase",s.logger=a.Loggers.LoggerFactory.INSTANCE.getClass(s.CLASS_NAME),n=s,c.ChatManagerBase=n,a.Components.RegistryManager.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,p,f,n;function r(e){this.library=e,this.listenerOnChangeAuthentificationInfo=null,this.currentCodeAgent=null,this.currentCodeEtablissement=null,this.doitEcouterMiseAJourListeUtilisateurs=!1,this.utilisateurs=null,this.currentListenerListeUtilisateurs=null,this.promessesGetUtilisateursEnAttente=[],this.doitEcouterCanalDemandeChat=!0,this.currentListenerDemandeChat=null,this.currentCanauxEcouteExpertises=[],this.currentCanauxEcouteExpertisesParDomaine={},this.chatrooms=[],this.controleur=null}t=e.Services||(e.Services={}),p=t.BriqueCommunication||(t.BriqueCommunication={}),f=p.Chat||(p.Chat={}),r.prototype.init=function(e){this.controleur=e,this.closeAndOpenAll()},r.prototype.Dispose=function(){var t=this;null!==this.currentListenerListeUtilisateurs&&(this.currentListenerListeUtilisateurs.close(),this.currentListenerListeUtilisateurs=null),null!==this.currentListenerDemandeChat&&(this.currentListenerDemandeChat.close(),this.currentListenerDemandeChat=null),this.chatrooms.forEach(function(e){t.controleur.fermerChatroom(e.id)})},r.prototype.closeAndOpenAll=function(){var r=this;this.library.Context.getAuthentificationInfo().then(function(e){var t=null,n=null;e&&(t=e.agentConnecte.referenceExterneAgent,n=e.codeEtablissement),r.currentCodeAgent!==t&&null!==r.currentListenerListeUtilisateurs&&(r.currentListenerListeUtilisateurs.close(),r.currentListenerListeUtilisateurs=null),r.currentCodeEtablissement!==n&&null!==r.currentListenerDemandeChat&&(r.currentListenerDemandeChat.close(),r.currentListenerDemandeChat=null),e&&(r.currentCodeAgent!==t&&(r.chatrooms.forEach(function(e){r.controleur.fermerChatroom(e.id)}),r.currentCanauxEcouteExpertises.forEach(function(e){e.canal.close(),delete r.currentCanauxEcouteExpertisesParDomaine[e.domaine]}),r.doitEcouterMiseAJourListeUtilisateurs&&r.ecouterMiseAJourListeUtilisateurs(e.codeEtablissement),r.ecouterCanauxExpertises(),r.currentCodeAgent=t),r.currentCodeEtablissement!==n&&r.doitEcouterCanalDemandeChat&&(r.ecouterCanalDeDemande(e.agentConnecte.referenceExterneAgent),r.currentCodeEtablissement=n))})},r.prototype.getUtilisateurs=function(){var n=this;return this.doitEcouterMiseAJourListeUtilisateurs=!0,this.library.Core.promesseTryCatch(function(t){null!==n.promessesGetUtilisateursEnAttente?0<n.promessesGetUtilisateursEnAttente.length?n.promessesGetUtilisateursEnAttente.push(t):(n.promessesGetUtilisateursEnAttente.push(t),n.library.Context.getAuthentificationInfo().then(function(e){n.ecouterMiseAJourListeUtilisateurs(e.codeEtablissement).then(function(){n.promessesGetUtilisateursEnAttente.forEach(function(e){e.resolve(n.utilisateurs)}),n.promessesGetUtilisateursEnAttente=null},t.reject)},t.reject)):t.resolve(n.utilisateurs)})},r.prototype.getChatrooms=function(){return this.chatrooms},r.prototype.ajouterChatroom=function(e){this.chatrooms.push(e)},r.prototype.retirerChatroom=function(e){for(var t=!1,n=0;n<this.chatrooms.length-1;n++)this.chatrooms[n].id===e.id&&(t=!0),t&&(this.chatrooms[n]=this.chatrooms[n+1]);!t&&this.chatrooms[this.chatrooms.length-1].id!==e.id||this.chatrooms.length--},r.prototype.getChatRoomById=function(t){var n=null;return this.chatrooms.every(function(e){return e.id===t&&(n=e),null===n}),n},r.prototype.accepterDemandeExpert=function(e,t,n){if(this.currentCanauxEcouteExpertisesParDomaine[t]){var r=this.library.BriqueCommunication.getInfosAgentCourant();this.currentCanauxEcouteExpertisesParDomaine[t].canal.writer({type:"response",accepted:!0,chatroom_id:e,date:Date.now(),domain:t,user_id:r.userid})}},r.prototype.ecouterCanauxExpertises=function(){var r=this,e=this.library.BriqueCommunication.getInfosAgentCourant();e.type===p.InfosAgentType.EXPERT&&e.preferences.expertises.forEach(function(t){r.library.Chat.ecouterCanalExpertiseApi(t).then(function(e){r.currentCanauxEcouteExpertisesParDomaine[t]={canal:e,domaine:t},r.currentCanauxEcouteExpertises.push(r.currentCanauxEcouteExpertisesParDomaine[t]),e.reader=function(e){switch(e.type){case"request":var t=e;r.controleur.demanderExpert(t.chatroom_id,t.domain,t.user_id);break;case"response":var n=e;r.controleur.finDemandeExpert(n.chatroom_id,n.domain,n.user_id)}}})})},r.prototype.ecouterMiseAJourListeUtilisateurs=function(u){var l=this;return this.library.Core.promesseTryCatch(function(t){var n=null,r=null,s={};function o(){l.controleur.notifierChangementListeUtilisateurs(l.utilisateurs)}function i(e){e.forEach(function(e){if(e.establishment===u&&!s[e.userid]){var t=e.label.match(/^([^ ]+) ([^-]+)/),n=3<=t.length?t[2].trim():"?",r=2<=t.length?t[1].trim():"?",o={id:e.userid,isConnected:!1,nom:n,prenom:r,type:null};switch(e.type){case p.InfosAgentType.ADVISER:o.type=f.Messages.UTILISATEUR_TYPE.CONSEILLER;break;case p.InfosAgentType.CLIENT:o.type=f.Messages.UTILISATEUR_TYPE.CLIENT;break;case p.InfosAgentType.EXPERT:o.type=f.Messages.UTILISATEUR_TYPE.EXPERT;break;case p.InfosAgentType.PROSPECT:o.type=f.Messages.UTILISATEUR_TYPE.PROSPECT}s[o.id]=o,l.utilisateurs.push(o)}}),o()}function a(e){var t=[],i={};l.utilisateurs.forEach(function(e){t.push(e),i[e.id]=e}),e.forEach(function(e){if(e.establishment===u){if(s[e.userid])s[e.userid].isConnected=!0;else{var t=e.label.match(/^([^ ]+) ([^-]+)/),n=3<=t.length?t[2].trim():"?",r=2<=t.length?t[1].trim():"?",o={id:e.userid,isConnected:!0,nom:n,prenom:r,type:null};switch(e.type){case p.InfosAgentType.ADVISER:o.type=f.Messages.UTILISATEUR_TYPE.CONSEILLER;break;case p.InfosAgentType.CLIENT:o.type=f.Messages.UTILISATEUR_TYPE.CLIENT;break;case p.InfosAgentType.EXPERT:o.type=f.Messages.UTILISATEUR_TYPE.EXPERT;break;case p.InfosAgentType.PROSPECT:o.type=f.Messages.UTILISATEUR_TYPE.PROSPECT}s[o.id]=o,l.utilisateurs.push(o)}delete i[e.userid]}}),t.forEach(function(e){i[e.id]&&(e.isConnected=!1)}),o()}l.utilisateurs=[];var c={close:function(){l.currentListenerListeUtilisateurs=null,n.close(),r.close()}};l.library.BriqueCommunication.getUtilisateurs().then(function(e){(n=e).reader=i,r&&(l.currentListenerListeUtilisateurs=c,t.resolve())}),l.library.BriqueCommunication.getUtilisateursConnectes().then(function(e){(r=e).reader=a,n&&(l.currentListenerListeUtilisateurs=c,t.resolve())})})},r.prototype.ecouterCanalDeDemande=function(r){var o=this;return this.doitEcouterCanalDemandeChat=!0,this.library.Core.promesseTryCatch(function(t){function n(e){"request"===e.type&&o.controleur.ouvrirChatroom(e.chatroom_id,e.user_id,e.users_ids)}var e="agent-S"+o.library.Core.StringUtils.leftPad(r,"0",7);o.library.Chat.ecouterCanalDeDemandeApi(e).then(function(e){e.reader=n,o.currentListenerDemandeChat=e,t.resolve(e)},t.reject)})},n=r,f.ChatManagerCanaux=n}(MyWay=MyWay||{}),function(e){var a,t,c,i,n;function r(){var s=i.call(this,a.Components.ComponentType.Notification)||this;return s.CONF_NOTIFICATIONS=null,s.subjetsConnected=[],s.subjetsConnectedByName={},s.subjects=null,s.subjectsByName={},s.storageInstance=null,s.abonnements=null,s.onChangeStorage=function(e){e=e||{sujetsAbonnees:[],version:1};var t=[],n=[],r=[],o={};s.abonnements&&s.abonnements.sujetsAbonnees.forEach(function(e){r.push(e),o[e]=!0});var i={};e.sujetsAbonnees.forEach(function(e){i[e]=!0,o[e]||n.push(e)}),r.forEach(function(e){i[e]||t.push(e)}),t.forEach(function(e){s._arreterNotifications(e)}),n.forEach(function(e){s._ecouterNotifications(e)}),s.abonnements=e,s.save()},s.load=function(){return s.library.BriqueCommunication.getConfigurationEtablissement().forEach(function(e){switch(e.code){case"CLIENTS":s.CONF_NOTIFICATIONS=e}}),s.subjects=s.CONF_NOTIFICATIONS.parameters.subjects,s.subjects.forEach(function(e){s.subjectsByName[e.name]=e}),s.storageInstance=s.library.Persistence.addStorage("Notifications",s.onChangeStorage),s.onChangeStorage(s.storageInstance.getValue()),s.library.Core.getPromesseSelfResoved()},s}a=e.Services||(e.Services={}),t=a.BriqueCommunication||(a.BriqueCommunication={}),c=t.Notification||(t.Notification={}),i=a.Components.ComponentManagerBase,__extends(r,i),r.prototype.init=function(e,t,n,r){var o=this;return i.prototype.init.call(this,e,t,n,r).then(function(){if(window.JmsConnectionFactory)return o.load()})},r.prototype.save=function(){this.storageInstance.saveValue(this.abonnements)},r.prototype.sendNotification=function(e){var t={mainEventType:a.BriqueCommunication.Messages.EVENT_TYPE.NOTIFICATION,event:e};this.library.Evennements.notifier(new a.Component.ManagerEvent(a.Component.ManagerEventType.BriqueCommunication,{chat:t}))},r.prototype._ecouterNotifications=function(n){var e,r=this;if(!this.subjectsByName[n])return(e=a.CoreCommon.ServiceDePromesse.defer()).reject(new a.Erreur("Canal "+n+" inconnu")),e.promise;if(this.subjetsConnectedByName[n])return(e=a.CoreCommon.ServiceDePromesse.defer()).resolve(),e.promise;function o(e){r.sendNotification({eventType:c.Messages.EVENT_TYPE.NOTIFICATION_MESSAGE,subject:n,message:e})}var i=this.subjectsByName[n],s=this.library.BriqueCommunication.getInfosAgentCourant();return this.library.Context.getAuthentificationInfo().then(function(e){var t=r.library.BriqueCommunication.replaceTokens(r.CONF_NOTIFICATIONS.destination,{user_id:s.userid,subject:i.code});return r.library.BriqueCommunication.ouvrirCanal(r.CONF_NOTIFICATIONS.url,t,{readable:!0,writable:!1},e).then(function(e){e.reader=o,r.subjetsConnectedByName[n]={name:n,canal:e},r.subjetsConnected.push(r.subjetsConnectedByName[n]),r.sendNotification({eventType:c.Messages.EVENT_TYPE.NOUVEL_ABONNEMENT,subject:n})})})},r.prototype._arreterNotifications=function(e){var t=this.subjetsConnectedByName[e];if(t){t.canal.close(),delete this.subjetsConnectedByName[e];for(var n=!1,r=0;r<this.subjetsConnected.length-1;r++)this.subjetsConnected[r]===t&&(n=!0),n&&(this.subjetsConnected[r]=this.subjetsConnected[r+1]);!n&&this.subjetsConnected[this.subjetsConnected.length-1]!==t||(this.subjetsConnected.length--,n=!0),n&&this.sendNotification({eventType:c.Messages.EVENT_TYPE.DESABONNEMENT,subject:e})}},r.prototype.ecouterNotifications=function(n){var e=this;return this._ecouterNotifications(n).then(function(){var t=!1;e.abonnements.sujetsAbonnees.every(function(e){return!(t=e===n)}),t||(e.abonnements.sujetsAbonnees.push(n),e.save())})},r.prototype.arreterNotifications=function(e){this._arreterNotifications(e);for(var t=!1,n=0;n<this.abonnements.sujetsAbonnees.length-1;n++)this.abonnements.sujetsAbonnees[n]===e&&(t=!0),t&&(this.abonnements.sujetsAbonnees[n]=this.abonnements.sujetsAbonnees[n+1]);!t&&this.abonnements.sujetsAbonnees[this.abonnements.sujetsAbonnees.length-1]!==e||(this.abonnements.sujetsAbonnees.length--,t=!0),t&&this.save()},r.prototype.getListeSujets=function(){var t=this,n=[];return this.subjects.forEach(function(e){n.push({nom:e.name,estAbonne:!!t.subjetsConnectedByName[e.name]})}),this.library.Core.createPromiseSelfResolved({sujets:n})},r.prototype.ecouterNotificationsApi=function(e){var n=this;if(this.subjectsByName[e]){var r=this.subjectsByName[e],o=this.library.BriqueCommunication.getInfosAgentCourant();return this.library.Context.getAuthentificationInfo().then(function(e){var t=n.library.BriqueCommunication.replaceTokens(n.CONF_NOTIFICATIONS.destination,{user_id:o.userid,subject:r.code});return n.library.BriqueCommunication.ouvrirCanal(n.CONF_NOTIFICATIONS.url,t,{readable:!0,writable:!1},e)})}},n=r,c.NotificationManagerBase=n,a.Components.RegistryManager.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,i,r;function o(){var e=i.call(this,t.Components.ComponentType.ConfigurationPoste)||this;return e.api=null,e.localStorageKey="configurationPoste",e.storage=null,e}t=e.Services||(e.Services={}),n=t.ConfigurationPoste||(t.ConfigurationPoste={}),i=t.Components.ComponentManagerBase,__extends(o,i),o.prototype.init=function(e,t,n,r){var o=this;return this.api=r,i.prototype.init.call(this,e,t,n,r).then(function(){o.storage=o.library.Persistence.addStorage(o.localStorageKey,o.listenerOnConfigurationPosteLocalStorage),o.getConfigurationPoste({refreshLocalStorage:!0}).catch(function(e){})})},o.prototype.getConfigPosteInLocalStorage=function(){var e=this.storage.getValue();return e&&e.configuration&&e.dateConfig?e:null},o.prototype.listenerOnConfigurationPosteLocalStorage=function(e){o.logger.warn("configurationPoste - %1",JSON.stringify(e))},o.prototype.getConfigurationPoste=function(e){var n=this,r=void 0!==e?e:{poste:null,etablissement:null,refreshLocalStorage:null};return this.library.Context.getAuthentificationInfo().then(function(e){if(!r.etablissement&&!r.poste||e.numeroStationTravail===r.poste&&e.codeEtablissement===r.etablissement){var t=n.getConfigPosteInLocalStorage();return r.refreshLocalStorage||!t?n.api.getConfigurationPoste({etablissement:e.codeEtablissement,poste:e.numeroStationTravail,dateConfig:t?t.dateConfig:null}).then(function(e){return e&&n.storage.saveValue(e),e||t}):t}return n.api.getConfigurationPoste({etablissement:r.etablissement,poste:r.poste,dateConfig:null})})},o.CLASS_NAME="MyWay.Services.ConfigurationPoste.ConfigurationPosteManager",o.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(o.CLASS_NAME),r=o,n.ConfigurationPosteManager=r,t.Components.RegistryManager.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var c,u,i,t;function l(){var t=i.call(this,c.Components.ComponentType.ContexteClient)||this;return t.contextes=[],t.contextesById={},t.storage=null,t.api=null,t.listenerOnContexteChange=function(){var e=JSON.parse(localStorage.getItem("contextesClients"));t.load(e)},t.listenerOnProcessEnd=function(e){e.contexteClientId&&t.library.ContexteClient.changeContexteOfProcess(null,e.id,null)},t}c=e.Services||(e.Services={}),u=c.ContexteClient||(c.ContexteClient={}),i=c.Components.ComponentManagerBase,__extends(l,i),Object.defineProperty(l,"RELOAD_FLAG_NAME",{get:function(){return u.ContexteClientStatusFlag.RELOAD_FLAG_NAME},enumerable:!0,configurable:!0}),Object.defineProperty(l,"RELOAD_FLAG_VALUE_NONE",{get:function(){return u.ContexteClientStatusFlag.RELOAD_FLAG_VALUE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(l,"RELOAD_FLAG_VALUE_SYNCHRO",{get:function(){return u.ContexteClientStatusFlag.RELOAD_FLAG_VALUE_SYNCHRO},enumerable:!0,configurable:!0}),Object.defineProperty(l,"RELOAD_FLAG_VALUE_RELOAD",{get:function(){return u.ContexteClientStatusFlag.RELOAD_FLAG_VALUE_RELOAD},enumerable:!0,configurable:!0}),l.prototype.init=function(e,t,n,r){var o=this;return this.api=r,i.prototype.init.call(this,e,t,n,r).then(function(){o.storage=o.library.Persistence.addStorage("notification.contextesclient",o.listenerOnContexteChange),o.load(),o.library.Evennements.ajouterListener(function(e){o.notifierRechargementContexte()},c.Component.ManagerEventType.ContextRecharge),o.library.Context.addListenerOnTerminerProcessus(o.listenerOnProcessEnd)})},l.prototype.dispose=function(){return this.library.Context.removeListenerOnTerminerProcessus(this.listenerOnProcessEnd),i.prototype.dispose.call(this)},l.prototype.nouveauContexte=function(e){var t=this.getByIdClient(e);if(t)return l.loggerContexteClientManagerBase.debug("reutilisation contexte client : %1",t.getId()),t;for(var n=this.library.Core.creerChaineAleatoire(16);this.contextesById[n];)n=this.library.Core.creerChaineAleatoire(16);var r=new u.ContexteClientClass(n,this.library.Core,this);return e&&r.setClient(e),this.contextesById[n]=r,this.contextes.push(r),l.loggerContexteClientManagerBase.debug("creation nouveau contexte client : %1",r.getId()),this.save(),r},l.prototype.getByIdClient=function(t){var n=null;return t?(this.contextes.every(function(e){return e.getClient()===t&&(n=e),null===n}),n):null},l.prototype.getCurrentContexteClient=function(){var e=this.library.Context.GetCurrentProcess();if(!e)return null;var t=e.contexteClientId;return t?this.getContexte(t):null},l.prototype.setCurrentContexteClient=function(e){var t=this.library.Context.GetCurrentProcess();if(!t)throw new c.Erreur("Il n'y a pas de processus courant");this.library.Context.setContextClientIdOnProcessus(e.getId(),t)},l.prototype.getContexte=function(e){return this.contextesById[e]},l.prototype.getContextes=function(){return this.contextes},l.prototype.getContextesAsync=function(){var o,i=this,s=[];return this.api.getContexteClientPCM().then(function(e){if(null==e)return i.contextes;for(var t=0,n=e;t<n.length;t++){var r=n[t];null!=(o=i.getByIdClient(r))&&s.push(o)}return s})},l.prototype.detruireContexte=function(e,t){var n=this,r=this.getContexte(t);if(!r)throw new c.Erreur("Contexte client "+t+" inexistant");r.getMode()===u.Messages.ContexteClientMode.AUTOMATIQUE&&(this.changeContexteMode(t,u.Messages.ContexteClientMode.MANUEL),l.loggerContexteClientManagerBase.debug("Le contexte d'identifiant %1 cherche à être détruit, mais il est en mode automatique. Changement de son statut en manuel.",t));var o=[];r.getProcessus().forEach(function(e){o.push(e),e.contexteClientId=null,n.library.Context.setContextClientIdOnProcessus(null,e)}),delete this.contextesById[t];for(var i=this.contextes.length-1,s=!1,a=0;a<1+i;a++)this.contextes[a]===r&&(s=!0),s&&(this.contextes[a]=this.contextes[a+1]);return this.contextes.length--,this.save(),this.broadcastUpdateEventByProcess(null,e,o,u.Messages.MiseAJourContexteClientType.detructionContexte),!0},l.prototype.changeTousContexteMode=function(e){var t=[];this.getContextes().forEach(function(e){t.push(e.getId())}),this.changeContexteModes(t,u.Messages.ContexteClientMode.AUTOMATIQUE)},l.prototype.getClient=function(e){return this.getCurrentContexteOrByIdAndThrowIfNothing(e).getClient()},l.prototype.setClient=function(e,t,n){var r=this;if(!t)throw new c.Erreur("Impossible de supprimer l'id du client dans le contexte client courant.");var o=this.getCurrentContexteOrByIdAndThrowIfNothing(n);if(void 0!==o.getClient())throw new c.Erreur("Impossible de modifier le client courant du contexte client car il est déjà défini.");var i=void 0;if(this.getContextes().every(function(e){return e.getClient()===t&&(i=e),void 0===i}),void 0===i)return o.setClient(t),this.save(),this.broadcastUpdateEvent(null,e,o,u.Messages.MiseAJourContexteClientType.setClient),!0;var s=[],a=o.getMode();return o.getProcessus().forEach(function(e){s.push(e),o.retirerProcessus(e),i.ajouterProcessus(e),r.library.Context.setContextClientIdOnProcessus(i.getId(),e)}),a!==u.Messages.ContexteClientMode.AUTOMATIQUE&&this.detruireContexte(e,o.getId()),this.save(),this.broadcastUpdateEventByProcess(null,e,s,u.Messages.MiseAJourContexteClientType.changementContexte),!0},l.prototype.getContextesParClients=function(){var n=[];return this.getContextes().forEach(function(e){var t=e.getClient();t&&n.push(t)}),n},l.prototype.getContextesParClientsAsync=function(){var t=this;return this.api.getContexteClientPCM().then(function(e){return null==e?t.getContextesParClients():e})},l.prototype.addToList=function(t,n,e,r){var o=this,i=this.getCurrentContexteOrByIdAndThrowIfNothing(r);return i.addToList(n,e).then(function(e){return o.save(),o.broadcastUpdateEvent(n,t,i,u.Messages.MiseAJourContexteClientType.addToList),e})},l.prototype.getContenu=function(e){var t=c.CoreCommon.ServiceDePromesse.defer(),n=this.getByIdClient(e);return n?n.getProperty(null):(t.reject(new c.Erreur("Impossible de trouver une contexte client avec l'id client "+e)),t.promise)},l.prototype.getProperty=function(e,t){return this.getCurrentContexteOrByIdAndThrowIfNothing(t).getProperty(e)},l.prototype.setContenu=function(r,e,o){var i=this;return this.library.Core.promesseTryCatch(function(t){var n=i.getByIdClient(e);n?(o[l.RELOAD_FLAG_NAME]||(o[l.RELOAD_FLAG_NAME]=l.RELOAD_FLAG_VALUE_NONE),n.setProperty(null,o).then(function(e){i.save(),i.broadcastUpdateEvent(null,r,n,u.Messages.MiseAJourContexteClientType.setProperty),t.resolve(e)},t.reject)):t.reject(new c.Erreur("Impossible de trouver une contexte client avec l'id client "+e))})},l.prototype.setReloadSynthese=function(r,e){var o=this;return this.library.Core.promesseTryCatch(function(t){var n=o.getByIdClient(e);n?n.setProperty(u.ContexteClientStatusFlag.RELOAD_FLAG_NAME,u.ContexteClientStatusFlag.RELOAD_FLAG_VALUE_RELOAD).then(function(e){o.save(),o.broadcastUpdateEvent(null,r,n,u.Messages.MiseAJourContexteClientType.setProperty),t.resolve(e)},t.reject):t.reject(new c.Erreur("Impossible de trouver une contexte client avec l'id client "+e))})},l.prototype.setProperty=function(t,n,e,r){var o=this,i=this.getCurrentContexteOrByIdAndThrowIfNothing(r);return i.setProperty(n,e).then(function(e){return o.save(),o.broadcastUpdateEvent(n,t,i,u.Messages.MiseAJourContexteClientType.setProperty),e})},l.prototype.removeFromList=function(t,n,e){var r=this,o=this.getCurrentContexteOrByIdAndThrowIfNothing(e);return o.removeFromList(n).then(function(e){return r.save(),r.broadcastUpdateEvent(n,t,o,u.Messages.MiseAJourContexteClientType.removeFromList),e})},l.prototype.deleteProperty=function(t,n,e){var r=this,o=this.getCurrentContexteOrByIdAndThrowIfNothing(e);return o.deleteProperty(n).then(function(e){return r.save(),r.broadcastUpdateEvent(n,t,o,u.Messages.MiseAJourContexteClientType.deleteProperty),e})},l.prototype.notifierRechargementContexte=function(){var r=this,e=this.library.Context.GetAllProcessFromAllPortails(),o={},i=[];e.forEach(function(t){if((o[t.id]=t).contexteClientId){var e=r.getContexte(t.contexteClientId);if(e){var n=!1;e.getProcessus().every(function(e){return e.id!==t.id||!(n=!0)}),n||(i.push(t),e.ajouterProcessus(t))}}}),this.contextes.forEach(function(n){var r=[];n.getProcessus().forEach(function(e){var t=o[e.id];t?t.contexteClientId!==n.getId()&&(-1===i.indexOf(t)&&i.push(t),r.push(e)):n.retirerProcessus(e)}),r.forEach(function(e){n.retirerProcessus(e)})}),this.broadcastUpdateEventByProcess(null,"load",i,u.Messages.MiseAJourContexteClientType.changementContexte)},l.prototype.changeContexteOfProcess=function(e,t,n){var r=this.library.Context.GetProcessByIdFromAllPortails(t);if(!r)throw new c.Erreur("Le processus "+t+" n'a pas été trouvé");var o=null;if(r.contexteClientId&&(o=this.getContexte(r.contexteClientId)),!n)return this.library.Context.setContextClientIdOnProcessus(null,r),o&&o.retirerProcessus(r),this.save(),void this.broadcastUpdateEventByProcess(null,e,[r],u.Messages.MiseAJourContexteClientType.changementContexte);var i=this.getContexte(n);if(!i)throw new c.Erreur("Le contexte client d'identifiant technique "+n+" n'a pas été trouvé");o&&o.retirerProcessus(r),i.ajouterProcessus(r),this.library.Context.setContextClientIdOnProcessus(i.getId(),r),this.save(),this.broadcastUpdateEventByProcess(null,e,[r],u.Messages.MiseAJourContexteClientType.changementContexte)},l.prototype.getMode=function(e){return this.getCurrentContexteOrByIdAndThrowIfNothing(e).getMode()},l.prototype.changeContexteMode=function(e,t){return this.changeContexteModes([e],t)},l.prototype.changeContexteModes=function(e,n){var r=this;e.forEach(function(e){var t=r.getContexte(e);if(!t)throw new c.Erreur("Le contexte client d'identifiant technique "+e+" n'a pas été trouvé");t.setMode(n)}),this.save()},l.prototype.getListeProcessus=function(e){return this.getCurrentContexteOrByIdAndThrowIfNothing(e).getProcessus()},l.prototype.getDetailsContexte=function(e){var t=this.getContexte(e);if(!t)throw new c.Erreur("Le contexte client d'identifiant technique "+e+" n'a pas été trouvé");var n={idContexte:t.getId(),idClient:t.getClient(),mode:t.getMode(),processus:[],content:t.getCurrentDatas()};return t.getProcessus().forEach(function(e){n.processus.push(e.id)}),n},l.prototype.getCurrentContexteOrById=function(e){return e?this.contextesById[e]:this.getCurrentContexteClient()},l.prototype.getCurrentContexteOrByIdAndThrowIfNothing=function(e){var t=null;if(!(t=e?this.contextesById[e]:this.getCurrentContexteClient()))throw e?new c.Erreur("Le contexte client "+e+" n'existe pas!"):new c.Erreur("Il n'y a pas de contexte client courant.");return t},l.prototype.save=function(){var t={version:1,contextes:[]};this.contextes.forEach(function(e){t.contextes.push({id:e.getId(),client:e.getClient(),mode:e.getMode(),content:e.getCurrentDatas()})}),localStorage.setItem("contextesClients",JSON.stringify(t)),this.storage.saveValue(Math.random())},l.prototype.load=function(e){var r=this,t=null;if(!(t=e||JSON.parse(localStorage.getItem("contextesClients"))))return this.contextes=[],void(this.contextesById={});if(1!==t.version)return l.loggerContexteClientManagerBase.error("Impossible de charger les contextes du local storage car la version "+t.version+" n'est pas correcte! Repars de zéro."),this.contextes=[],void(this.contextesById={});var n=this.contextesById;this.contextes=[],this.contextesById={};var o=[],i=this.library.Context.GetWaitingProcesses();i&&i.forEach(function(e){o.push(e)});var s=this.library.Context.getPortails();s&&s.forEach(function(e){e.processes.forEach(function(e){o.push(e)})}),t.contextes.forEach(function(t){var n=new u.ContexteClientClass(t.id,r.library.Core,r);r.contextes.push(n),(r.contextesById[t.id]=n).setClient(t.client),o.forEach(function(e){e.contexteClientId===t.id&&n.ajouterProcessus(e)}),n.setProperty(null,t.content),n.setMode(t.mode)}),o.forEach(function(e){r.contextesById[e.contexteClientId]||r.library.Context.setContextClientIdOnProcessus(null,e)}),this.contextes.forEach(function(e){n[e.getId()]?(n[e.getId()].getClient()!==e.getClient()&&r.broadcastUpdateEvent(null,"load",e,u.Messages.MiseAJourContexteClientType.setClient),r.library.Core.ObjectUtils.deepEquals(n[e.getId()].getCurrentDatas(),e.getCurrentDatas())||r.broadcastUpdateEvent(null,"load",e,u.Messages.MiseAJourContexteClientType.setProperty)):(r.broadcastUpdateEvent(null,"load",e,u.Messages.MiseAJourContexteClientType.setClient),r.broadcastUpdateEvent(null,"load",e,u.Messages.MiseAJourContexteClientType.setProperty))})},l.prototype.broadcastUpdateEvent=function(e,n,t,r){var o=this,i={cleModifie:e,contexteClientId:t?t.getId():null,type:r};"portail"!==n&&this.SendEvent(new c.Component.ManagerEvent(c.Component.ManagerEventType.MiseAJourContexteClient,{contexteClientMiseAJourInfo:i}));var s=void 0;t&&(s=t.getProcessus()),s&&(s.forEach(function(e){if(e.id!==n){var t=new c.NotificationMessage;t.Sujet="MiseAJourContexteClient",t.Contenu=i,o.library.Display.Frames&&o.library.Display.Frames.every(function(e){return o.library.Context.NotifyFrame(t,e),!0})}}),"interop"!==n&&"load"!==n&&t.getProperty(null).then(function(e){o.api.setContexteClientNSDK(t.getClient(),e).then(function(e){e&&(t.setProperty(l.RELOAD_FLAG_NAME,l.RELOAD_FLAG_VALUE_NONE),c.Loggers.FLASH.INSTANCE.setValue("action","broadcastUpdateEvent"),l.loggerContexteClientManagerBase.debug("update ok"))}).catch(function(e){c.Loggers.FLASH.INSTANCE.setValue("action","broadcastUpdateEvent"),c.Loggers.FLASH.INSTANCE.setValue("details",e),l.loggerContexteClientManagerBase.error("Impossible de mettre à jour la synthèse NSDK")})}))},l.prototype.broadcastUpdateEventByProcess=function(r,o,e,i){var s=this;e.forEach(function(t){var e={cleModifie:r,contexteClientId:t.contexteClientId,type:i};if("portail"!==o&&s.SendEvent(new c.Component.ManagerEvent(c.Component.ManagerEventType.MiseAJourContexteClient,{contexteClientMiseAJourInfo:e})),t.id!==o){var n=new c.NotificationMessage;n.Sujet="MiseAJourContexteClient",n.Contenu=e,s.library.Display.Frames&&s.library.Display.Frames.every(function(e){return e.ProcessId!==t.id||(s.library.Context.NotifyFrame(n,e),!1)})}})},l.CLASS_NAME_BASE="MyWay.Services.Context.ContexteClientManagerBase",l.loggerContexteClientManagerBase=c.Loggers.LoggerFactory.INSTANCE.getClass(l.CLASS_NAME_BASE),t=l,u.ContexteClientManagerBase=t,c.Components.RegistryManager.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var u,r,t;function n(e,t,n){this.coreCommon=t,this.contexteClientManager=n,this.contexte=null,this.id=e,this.client=void 0,this.contexte={},this.mode=r.Messages.ContexteClientMode.MANUEL,this.processus=[]}u=e.Services||(e.Services={}),r=u.ContexteClient||(u.ContexteClient={}),n.prototype.getId=function(){return this.id},n.prototype.getMode=function(){return this.mode},n.prototype.setMode=function(e){this.mode=e,this.checkSiDoitDetruireContexteClient()},n.prototype.getProcessus=function(){return this.processus},n.prototype.ajouterProcessus=function(e){this.processus.push(e)},n.prototype.retirerProcessus=function(e){for(var t=!1,n=0;n<this.processus.length;n++)t||this.processus[n]!==e||(t=!0),t&&(this.processus[n]=this.processus[n+1]);return t||this.processus[this.processus.length-1]!==e||(t=!0),t&&(this.processus.length--,this.checkSiDoitDetruireContexteClient()),t},n.prototype.checkSiDoitDetruireContexteClient=function(){this.mode===r.Messages.ContexteClientMode.AUTOMATIQUE&&0===this.processus.length&&this.detruireContexte()},n.prototype.getClient=function(){return this.client},n.prototype.setClient=function(e){if(this.client)throw new u.Erreur("Impossible de modifier le client courant du contexte client car il est déjà défini.");this.client=e},n.prototype.getCurrentDatas=function(){return this.contexte},n.prototype.getProperty=function(r){var o=this;return this.coreCommon.promesseTryCatch(function(e){if(r){var t=r.split("."),n=o.contexte;t.every(function(e,t){return null!=(n=n[e])}),e.resolve(n)}else e.resolve(o.contexte)})},n.prototype.addToList=function(i,s){var a=this;return this.coreCommon.promesseTryCatch(function(e){if(i){var t=i.split("."),n=a.contexte,r=t.length,o=!1;t.forEach(function(e,t){if(r<=t+1)return n[e]||(n[e]=[]),(n=n[e]).push?(n.push(s),void(o=!0)):void(o=!1);n[e]||(n[e]={}),n=n[e]}),e.resolve(o)}else e.reject(new u.Erreur("La clé ne peut être nulle ni vide"))})},n.prototype.setProperty=function(o,i){var s=this;return this.coreCommon.promesseTryCatch(function(e){if(!o)return s.contexte=i,void e.resolve(!0);var t=o.split("."),n=s.contexte,r=t.length;t.forEach(function(e,t){r<=t+1?n[e]=i:(n[e]||(n[e]={}),n=n[e])}),e.resolve(!0)})},n.prototype.removeFromList=function(n){var r=this;return this.coreCommon.promesseTryCatch(function(e){if(n){var t=n.split("."),s=r.contexte,a=t.length,c=!1;t.every(function(e,t){if(a<=t+1){var n=s;if(!n.push)return void(c=!1);var r=Number(e);if(isNaN(r))return c=!1;for(var o=n.length,i=r;i<o-1;i++)n[i]=n[i+1];return delete n[n.length-1],n.length--,c=!0}return!!s[e]&&(s=s[e],!0)}),e.resolve(c)}else e.reject(new u.Erreur("La clé ne peut être nulle ni vide"))})},n.prototype.deleteProperty=function(i){var s=this;return this.coreCommon.promesseTryCatch(function(e){if(!i)return s.contexte={},void e.resolve(!0);var t=i.split("."),n=s.contexte,r=t.length,o=!1;t.every(function(e,t){return r<=t+1?o=!!n[e]&&(delete n[e],!0):!!n[e]&&(n=n[e],!0)}),e.resolve(o)})},n.prototype.detruireContexte=function(){this.contexteClientManager.detruireContexte(null,this.id)},t=n,r.ContexteClientClass=t}(MyWay=MyWay||{}),function(e){var c,u,o,t;function l(){var e=o.call(this,c.Components.ComponentType.Libelle)||this;return e.api=null,e}c=e.Services||(e.Services={}),u=c.Libelle||(c.Libelle={}),o=c.Components.ComponentManagerBase,__extends(l,o),l.prototype.init=function(e,t,n,r){return this.api=r,o.prototype.init.call(this,e,t,n,r)},l.prototype.constituerLibelle=function(e,t){if(null==e||0===e.trim().length)throw new c.ErreurClient(u.LibelleModel.TEC.CHAINE_VIDE,["codeLibelle",e]);var n,r=this.api.messages,o=e.split(".");if(r instanceof Object){var i=r[o[0]];i?"string"==typeof o[1]?(n=i[o[1]])||(l.logger.warn("Code message manquant : %1",e),n=this.codeValeurs(e,t)):(l.logger.warn("Code incorrect : %1",e),n=e):(l.logger.warn("Code incorrect, domaine fonctionnel manquant : %1",o[0]),n=e)}else l.logger.warn("Fichier Libelles manquants."),n=e;if(t instanceof Array)for(var s=0;s<t.length;++s){var a="{"+s+"}";n.indexOf(a)<0?l.logger.warn("PlaceHolder %1 manquant pour le code libelle %2",a,e):n=n.replace(a,t[s])}return n=n.replace(/{[0-9]*}/g,""),this.library.Core.createPromiseSelfResolved(n)},l.prototype.codeValeurs=function(e,t){var n=e;return t instanceof Array&&t.forEach(function(e){n=n+" "+e}),n},l.prototype.afficherMessage=function(e,o,t,i,s,a){var c=this;this.constituerLibelle(e,t).then(function(e){var t=e;if(o===u.TYPE_AFFICHAGE.INFORMATION){var n={Type:"Info",Message:t};c.library.Display.DisplayMessage(n)}else{var r={oui:!1,non:!1,valider:!1,ok:!1,annuler:!1};switch(o){case u.TYPE_AFFICHAGE.ERREUR:case u.TYPE_AFFICHAGE.AVERTISSEMENT:r.ok=!0;break;case u.TYPE_AFFICHAGE.OUI_NON:r.oui=!0,r.non=!0;break;case u.TYPE_AFFICHAGE.OUI_NON_ANNULER:r.oui=!0,r.non=!0,r.annuler=!0;break;case u.TYPE_AFFICHAGE.VALIDER_ANNULER:r.valider=!0,r.annuler=!0;break;case u.TYPE_AFFICHAGE.ANNULER:r.annuler=!0;break;case u.TYPE_AFFICHAGE.VIDE:}c.library.Display.FermerModalMessage(),setTimeout(function(){c.library.Display.AfficherModalMessage("MESSAGE",t,r,i,s,a)},500)}})},l.prototype.afficherMessageAsync=function(t,n,r,o){var i=this;return this.library.Core.promesseTryCatch(function(e){i.afficherMessage(t,n,r,o,e.resolve,function(){var e=new c.NotificationMessage;e.Sujet="modaleOuverte",i.Notify(e,function(){})})})},l.prototype.Notify=function(e,t){this.library.Context.Notify(e).then(t)},l.CLASS_NAME="MyWay.Services.Libelle.LibelleManager",l.logger=c.Loggers.LoggerFactory.INSTANCE.getClass(l.CLASS_NAME),t=l,u.LibelleManager=t,c.Components.RegistryManager.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var u=function(e,t,n){this.message=e,this.timestamp=t,this.deltaWithPreviousCheckpoint=n};e.CheckpointModel=u;var t=(l.addCheckpoint=function(e,t,n){if(!0===n){var r=new Date(t),o=r.getHours().toString(),i=r.getMinutes().toString(),s=r.getSeconds().toString(),a=r.getMilliseconds().toString(),c=(o[1]?o:"0"+o[0])+":"+(i[1]?i:"0"+i[0])+":"+(s[1]?s:"0"+s[0])+","+(a[2]?a:a[1]?"0"+a:"00"+a[0]);console.log(c+" > "+e)}l._checkpoints.push(new u(e,t,0<l._checkpoints.length?t-l._checkpoints[l._checkpoints.length-1].timestamp:0)),l._traceManager&&l._traceManager.recordCheckpoints()},l._checkpoints=[],l._traceManager=null,l);function l(){}e.Memory=t}(IndependantLogger=IndependantLogger||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.Trace||(t.Trace={})).DB_STORE_TRACES="storeTrace",n.DB_STORE_TRACES_INDEX_NIVEAU="indexNiveau",n.DB_STORE_TRACES_INDEX_DATETIME="indexDatetime",n.TIMEOUT_ENVOI_TRACE=3e5,n.NB_ESSAIS_MAX_TRACES=5}(MyWay=MyWay||{}),function(e){var g;(function(e){var p,t;(t=p=e.EventSizeChangeType||(e.EventSizeChangeType={}))[t.SET=0]="SET",t[t.ADD=1]="ADD";var n=(f.prototype.get=function(c){var u=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(a){u.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var o=t.objectStore(f.TABLE_NOM),i=[],s=function(t){if(t>=c.length)a.resolve(i);else{var n=c[t],r=o.get(n);r.onsuccess=function(e){r.result?(i.push(u.elementToInstanceAvecCle(r.result)),i.push({cle:n,element:r.result})):(i.push(null),console.warn("Trace "+n+" isn't found!")),s(t+1)},r.onerror=function(e){console.error(e),a.reject(new g.Erreur("Erreur lors de la purge des traces de la base de données - Moment de la lecture"))}}};s(0)})});var e=[];return this.memoryDB.forEach(function(t){var n=null;c.every(function(e){return e===t.id&&(n=t),null===n}),e.push(u.elementToInstanceAvecCle(n))}),this.library.Core.createPromiseSelfResolved(e)},f.prototype.getAll=function(){var t=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){t.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).openCursor(),o=[];n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value,r=t.key;o.push({cle:r,element:n}),t.continue()}else i.resolve(o)},n.onerror=function(e){console.error(e),i.reject(new g.Erreur("Erreur lors du comptage du nombre de traces"))}})});var n=[];return this.memoryDB.forEach(function(e){n.push(t.elementToInstanceAvecCle(e))}),this.library.Core.createPromiseSelfResolved(n)},f.prototype.chercher=function(s){var a=this;if(!s)return this.getAll();if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){a.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).openCursor(),o=[];n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;if(a.testTrace(n,s)){var r=t.key;o.push({cle:r,element:n})}t.continue()}else i.resolve(o)},n.onerror=function(e){console.error(e),i.reject(new g.Erreur("Erreur lors du comptage du nombre de traces"))}})});var t=[];return this.memoryDB.forEach(function(e){a.testTrace(e,s)&&t.push(a.elementToInstanceAvecCle(e))}),this.library.Core.createPromiseSelfResolved(t)},f.prototype.count=function(e){var t=this;return e||!this.hasIndexedDb?this.chercher(e).then(function(e){return e.length}):this.library.Core.promesseTryCatch(function(r){t.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).count();n.onsuccess=function(){var e=n.result;r.resolve(e)},n.onerror=function(e){console.error(e),r.reject(new g.Erreur("Erreur lors du comptage du nombre de traces"))}})})},f.prototype.ajouter=function(a){var c=this;return this.hasIndexedDb?this.library.Core.promesseTryCatch(function(s){c.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(f.TABLE_NOM),o=0,i=function(e){if(e>=a.length)return c.onSizeChange(o,p.ADD),void s.resolve();var t=a[e];o+=JSON.stringify(t.trace).length;var n=r.add(t);n.onsuccess=function(){i(e+1)},n.onerror=function(e){console.error(e),s.reject(new g.Erreur("Erreur lors de la sauvegarde d'une trace"))}};i(0)})}):(a.forEach(function(e){void 0===e.id?e.id=c.memoryDBAutoincrement++:e.id>c.memoryDBAutoincrement&&(c.memoryDBAutoincrement=e.id+1),c.memoryDB.push(e)}),this.library.Core.getPromesseSelfResoved())},f.prototype.supprimer=function(u){var l=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(c){l.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var i=t.objectStore(f.TABLE_NOM),s=0,a=function(n){if(n>=u.length)return l.onSizeChange(-1*s,p.ADD),void c.resolve();var r=u[n],o=i.get(r);o.onsuccess=function(e){if(!o.result)return console.warn("Trace "+r+" isn't found!"),void a(n+1);s+=JSON.stringify(o.result.trace).length;var t=i.delete(r);t.onsuccess=function(){a(n+1)},t.onerror=function(e){console.error(e),c.reject(new g.Erreur("Erreur lors de la purge des traces de la base de données - Moment de la suppression"))}},o.onerror=function(e){console.error(e),c.reject(new g.Erreur("Erreur lors de la purge des traces de la base de données - Moment de la lecture"))}};a(0)})});var e=[];return this.memoryDB.forEach(function(t){var n=!1;u.every(function(e){return!(n=e===t.id)}),n||e.push(t)}),this.memoryDB=e,this.library.Core.getPromesseSelfResoved()},f.prototype.mettreAJour=function(s){var o=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){o.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(f.TABLE_NOM),o=function(e){if(e>=s.length)i.resolve();else{var t=s[e],n=r.put(t.element,t.cle);n.onsuccess=function(){o(e+1)},n.onerror=function(e){console.error(e),i.reject(new g.Erreur("Erreur lors du reset de la base de données"))}}};o(0)})});var e=[];return s.forEach(function(n){var r=!1;o.memoryDB.every(function(e,t){return n.cle===e.id&&(o.memoryDB[t]=n.element,r=!0),!r}),r||e.push(n.element)}),0<e.length?this.ajouter(e):this.library.Core.getPromesseSelfResoved()},f.prototype.resetAll=function(){var o=this;return this.hasIndexedDb?this.library.Core.promesseTryCatch(function(r){o.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).clear();n.onsuccess=function(e){o.onSizeChange(0,p.SET),r.resolve()},n.onerror=function(e){console.error(e),r.reject(new g.Erreur("Erreur lors du reset de la base de données"))}})}):(this.memoryDB.length=0,this.library.Core.getPromesseSelfResoved())},f.prototype.getTracesToPurge=function(){var e=this;if(!this.hasIndexedDb)return this.library.Core.createPromiseSelfResolved(this.memoryDB);var o=[];return this.library.Core.promesseTryCatch(function(r){e.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).openCursor();n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;n.id=t.key,o.push(n),t.continue()}else r.resolve(o)},n.onerror=function(e){console.error(e),r.reject(new g.Erreur("Erreur lors de la récupération des traces à purger"))}})})},f.prototype.actionOnDB=function(n){var e=window.indexedDB.open("myway_stc_traces",f.VERSION);e.onupgradeneeded=function(e){var t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(f.TABLE_NOM,{autoIncrement:!0}).createIndex("datetime","datetime",{unique:!1})}},e.onsuccess=function(e){var t=e.target.result;n(t)}},f.prototype.testTrace=function(e,t){return!!e.trace.message.match(t)},f.prototype.elementToInstanceAvecCle=function(e){return e?{cle:e.id,element:e}:null},f.VERSION=1,f.TABLE_NOM="traces",f);function f(e,t,n){this.hasIndexedDb=e,this.library=t,this.onSizeChange=n,this.memoryDB=[],this.memoryDBAutoincrement=0}e.TraceDB=n})((g=e.Services||(e.Services={})).Trace||(g.Trace={}))}(MyWay=MyWay||{}),function(f){var g;(function(c){g.CoreCommon.addListenerOnCheckSettings(function(e){g.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.stepInfo)&&!g.Controle.StaticNumberControle.isNumber(e.stepInfo.NiveauTrace)&&(e.stepInfo.NiveauTrace=c.NIVEAUX_TRACE.DEBUG)}),c.QUOTA_PURGE=102400;var s,e,a=!(c.INTERVALLE_PURGE=6e5),u=0,i=0;(e=s=s||{})[e.DEBUT="DEBUT"]="DEBUT",e[e.FIN="FIN"]="FIN";var l,t=(l=g.Components.ComponentManagerBase,__extends(p,l),p.prototype.createPrivateTrace=function(e,t,n,r){var o=new c.TraceModel;o.niveau=e,o.composant="TraceManager",o.action=t,o.application=f.Framework.NAME+" V"+f.Framework.VERSION,o.datetime=(new Date).getTime(),o.message=n,o.details=r,this.traceModelToLogger(o)},p.prototype.init=function(e,t,n,r){var o=this;return this.api=r,l.prototype.init.call(this,e,t,n,r).then(function(){return o.storageInstanceSize=o.library.Persistence.addStorage("traces_size",function(e){i=e.newSize}),o.storageInstancePurge=o.library.Persistence.addStorage("traces_size",function(e){a=e.action===s.FIN,u=e.nbPurgesError}),g.BaseDeDonnees.Generique.Factory.testImplementationIndexeddb().then(function(n){return o.traceDB=new c.TraceDB(n,o.library,function(e,t){if(n){switch(t){case c.EventSizeChangeType.ADD:i+=e;break;case c.EventSizeChangeType.SET:i=e;break;default:p.logger.error("L'evennement de type %1 n'est pas geré par le callback onSizeChanged() sur la base de données des traces",t)}o.storageInstanceSize.saveValue({newSize:i})}}),o.library.BaseDeDonnees.enregistrerDB("TRACE",{version:c.TraceDB.VERSION,implementation:n?g.BaseDeDonnees.BaseDeDonneesImplementation.INDEXEDDB:g.BaseDeDonnees.BaseDeDonneesImplementation.MEMORY,getTables:function(){return[c.TraceDB.TABLE_NOM]},getTable:function(e){switch(e){case c.TraceDB.TABLE_NOM:return o.traceDB;default:return null}}}),o.traceDB.getAll().then(function(e){var t=0;e.forEach(function(e){e&&(t+=JSON.stringify(e.element.trace).length)}),i=t,o.storageInstanceSize.saveValue({newSize:i}),o.recordCheckpoints(),o.startTimerPurge()})})}).then(function(){o.library.Context.addListenerOnTerminerProcessus(o.onCallbackOnFinProcessus)}).then(function(){o.initializeModeDebug()})},p.prototype.startTimerPurge=function(){if(this._timerPurgeId)throw"un timer est déjà en cours d'éxécution";this.createPrivateTrace(c.NIVEAUX_TRACE.DEBUG,"startTimerPurge","Démarrage du timer de purge");var e=this;this._timerPurgeId=window.setInterval(function(){e.purgerTraces()},c.INTERVALLE_PURGE)},p.prototype.dispose=function(){return this.library.Context.removeListenerOnTerminerProcessus(this.onCallbackOnFinProcessus),this._timerPurgeId&&(this.createPrivateTrace(c.NIVEAUX_TRACE.DEBUG,"Dispose","Arrêt du timer de purge"),clearInterval(this._timerPurgeId),this._timerPurgeId=null),g.Loggers.Appenders.DBAppender.SERVICE_TRACE=null,this.library.BaseDeDonnees.disposeDB("TRACE"),l.prototype.dispose.call(this)},p.prototype.traceToLogger=function(e){g.Loggers.LoggerFactory.INSTANCE.getClass(e.packageName).tracer(e)},p.prototype.traceModelToLogger=function(e){var t=g.Loggers.LoggerFactory.INSTANCE.getClass("MyWay.SPA."+e.composant);switch(g.Loggers.FLASH.INSTANCE.setValue("details",e.details),g.Loggers.FLASH.INSTANCE.setValue("action",e.action),e.datetime&&g.Loggers.FLASH.INSTANCE.setValue("dateLog",new Date(e.datetime)),e.niveau){case c.NIVEAUX_TRACE.DEBUG:t.debug(e.message);break;case c.NIVEAUX_TRACE.INFO:t.info(e.message);break;case c.NIVEAUX_TRACE.WARNING:t.warn(e.message);break;case c.NIVEAUX_TRACE.ERROR:t.error(e.message);break;default:throw"Niveau de trace "+e.niveau+" non supporté"}},p.prototype.recupererInfosContexte=function(e){var t=this.library.Context.GetAuthentificationInfo();t&&(e.COCXBQ=t.codeEtablissement,e.client=t.numeroStationTravail,t.agentConnecte&&(e.COCEAG=t.agentConnecte.referenceExterneAgent,e.CTCEAG=t.agentConnecte.typeFonction,e.NOCEEL=t.agentConnecte.numeroInterneEds)),e.idProcessus=g.Donnees.StaticStringExtension.getEmptyStringIfNotStringOrGetItSelf(this.library.Context.GetMainProcessId()),e.cheminInstances=g.Donnees.StaticStringExtension.getEmptyStringIfNotStringOrGetItSelf(this.library.Context.GetPortalContext().currentPath)},p.prototype.logToTrace=function(e,t){var n=null;switch(e.niveau){case g.Loggers.LEVEL.DEBUG:n=c.NIVEAUX_TRACE.DEBUG;break;case g.Loggers.LEVEL.INFO:n=c.NIVEAUX_TRACE.INFO;break;case g.Loggers.LEVEL.WARN:n=c.NIVEAUX_TRACE.WARNING;break;case g.Loggers.LEVEL.ERROR:n=c.NIVEAUX_TRACE.ERROR}var r=t.format(e),o=e.context.details,i=e.context.action;e.date,"ServiceAgentExtended"===i&&o&&o.lastDigestTime&&(o.lastDigestTime,o=null);var s=null,a=null;return a=/^MyWay\.Service.*/.test(e.packageName)?(s=void 0!==f.Framework?f.Framework.NAME+" V"+f.Framework.VERSION:"Framework inconnu",e.packageName):(s=e.packageName,null),o=o||null,{action:i=i||"",application:s,cheminInstances:null,client:null,COCEAG:null,COCXBQ:null,composant:a=a||"",CTCEAG:null,datetime:e.date,details:o,idProcessus:null,message:r,niveau:n,NOCEEL:null,serveur:null,url:window.location.href}},p.prototype.sendMultipleLogs=function(e,n){var r=this,o=[];return e.forEach(function(e){var t=r.logToTrace(e,n);r.recupererInfosContexte(t),o.push({dateDernierEnvoi:0,nbEssais:0,trace:t})}),this.traceDB.ajouter(o).then(function(){r.gererPurge()})},p.prototype.sendLog=function(e,t){var n=this,r=this.logToTrace(e,t);this.recupererInfosContexte(r);var o={dateDernierEnvoi:0,nbEssais:0,trace:r};return this.traceDB.ajouter([o]).then(function(){n.gererPurge()})},p.prototype.send=function(e,t){var n=this;this.recupererInfosContexte(e);var r={dateDernierEnvoi:0,nbEssais:0,trace:e};return this.traceDB.ajouter([r]).then(function(){n.gererPurge()})},p.prototype.recordCheckpoints=function(e){var t=this;for(var n in IndependantLogger.Memory._checkpoints){var r=new c.TraceModel;r.datetime=IndependantLogger.Memory._checkpoints[n].timestamp,r.message=IndependantLogger.Memory._checkpoints[n].message,r.niveau=c.NIVEAUX_TRACE.INFO,this.traceModelToLogger(r)}e&&0<e.length&&e.forEach(function(e){t.traceModelToLogger(r)}),IndependantLogger.Memory._checkpoints=[],IndependantLogger.Memory._traceManager=this,g.Loggers.Appenders.DBAppender.SERVICE_TRACE=this},p.prototype.gererPurge=function(){a||i>c.QUOTA_PURGE&&this.purgerTraces()},p.prototype.resetDB=function(){return this.traceDB.resetAll()},p.prototype.purgerTraces=function(){var n=this;if(!a){this.createPrivateTrace(c.NIVEAUX_TRACE.DEBUG,"purgerTraces","Début de la purge"),a=!0,this.storageInstancePurge.saveValue({action:s.DEBUT,nbPurgesError:u});var r=[],o=[],i=null;return this.traceDB.getTracesToPurge().then(function(e){if(0===(i=e).length)return a=!1,void n.storageInstancePurge.saveValue({action:s.FIN,nbPurgesError:u});var t=(new Date).getTime();return e.every(function(e){return e.dateDernierEnvoi=t,r.push(e.trace),o.push({cle:e.id,element:e}),r.length<30}),n.traceDB.mettreAJour(o)}).then(function(){return n.library.Context.getAuthentificationInfo()}).then(function(e){return n.api.envoyerTraces(r,e)}).then(function(){u=0;var t=[];o.forEach(function(e){t.push(e.cle)}),n.traceDB.supprimer(t)},function(e){console.error(e),n.finDePurgeFail(o)}).finally(function(){a=!1,n.storageInstancePurge.saveValue({action:s.FIN,nbPurgesError:u}),30<=i.length&&n.purgerTraces()})}},p.prototype.finDePurgeFail=function(e){var t=this;if(!(5<=++u)){var n=[],r=[];return e.forEach(function(e){e.element.nbEssais<c.NB_ESSAIS_MAX_TRACES?(e.element.nbEssais++,n.push(e)):r.push(e.cle)}),this.traceDB.mettreAJour(n).then(function(){return t.traceDB.supprimer(r)}).then(function(){0<n.length&&t.createPrivateTrace(c.NIVEAUX_TRACE.WARNING,"purgerTraces","Des traces n'ont pas pu être envoyées, incrémentation de leur compteur de tentative d'envois"),0<r.length&&t.createPrivateTrace(c.NIVEAUX_TRACE.ERROR,"purgerTraces","Des traces ont atteint leur quota de tentative d'envois, elles sont donc supprimées")})}this.traceDB.resetAll()},p.prototype.sendDiagnostic=function(e){var t=null,n=this.library.Context.GetCurrentProcess();n&&(t=this.library.Context.GetCurrentStep(n)),t&&(t.id===e.stepId&&(e.contextSize=this.library.Context.GetCurrentProcessContextSize(),this.SendEvent(new g.Component.ManagerEvent(g.Component.ManagerEventType.Diagnostic,{diagnostic:e}))),e.finalDiagnostic&&(this.library.Context.SetDiagnosticTraceSentForStep(e.stepPath),t.diagnosticTraceSentForStep=e.finalDiagnostic))},p.prototype.formatageDate=function(e){if(!1===/^(0[1-9]|1\d|2\d|3[01])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}\s+(0[0-9]|1[0-9]|2[0-3])\:(0[0-9]|[1-5][0-9])\:(0[0-9]|[1-5][0-9])$/.test(e))return null;var t=e.split(" "),n=t[0].split("/");n.reverse();var r=n.join("/")+" "+t[1];return new Date(r)},p.prototype.initializeModeDebug=function(){var e=0;try{var t=this.library.Context.GetFromContext("MODEDEBUG");t&&(e=parseInt(t,10))}catch(e){}Date.now()<this._dateFinDebug&&this._dateDebutDebug<Date.now()?g.PrivatePortalServiceParameters.Instance().TTLModeDebug=this._dateFinDebug:g.PrivatePortalServiceParameters.Instance().TTLModeDebug=0<e?e+this._modeDebugDuration:0,this.api.setModeDebug(g.PrivatePortalServiceParameters.Instance().TTLModeDebug)},p.prototype.setModeDebug=function(e){var r=this;e?(p.logger.info("Activation du mode debug"),this.library.Context.AddToContext(g.Context.StorageLevel.Global,"MODEDEBUG",Date.now().toString()),g.PrivatePortalServiceParameters.Instance().TTLModeDebug=Date.now()+this._modeDebugDuration,this.api.readFileModeDebug().then(function(e){try{var t=r.formatageDate(e.DateHeureDebut),n=r.formatageDate(e.DateHeureFin);t.getTime()<Date.now()&&Date.now()<n.getTime()&&(r._dateDebutDebug=t.getTime(),r._dateFinDebug=n.getTime(),g.PrivatePortalServiceParameters.Instance().TTLModeDebug=r._dateFinDebug)}catch(e){p.logger.warn("Format des dates incorrectes dans le fichier ModeDebugMyway.json : %1",e.codeLibelle)}}).catch(function(e){p.logger.warn("Erreur lors de la lecture du fichier ModeDebugMyway.json : %1",e.codeLibelle)}).finally(function(){p.logger.info("Mode débug activité jusqu'à : %1",new Date(g.PrivatePortalServiceParameters.Instance().TTLModeDebug)),r.api.setModeDebug(g.PrivatePortalServiceParameters.Instance().TTLModeDebug)})):(p.logger.info("Desactivation du mode debug"),this.library.Context.AddToContext(g.Context.StorageLevel.Global,"MODEDEBUG","0"),g.PrivatePortalServiceParameters.Instance().TTLModeDebug=0,this.api.setModeDebug(g.PrivatePortalServiceParameters.Instance().TTLModeDebug))},p.CLASS_NAME="MyWay.Services.Trace.TraceManager",p.logger=g.Loggers.LoggerFactory.INSTANCE.getClass(p.CLASS_NAME),p);function p(){var t=l.call(this,g.Components.ComponentType.Trace)||this;return t.api=null,t.storageInstanceSize=null,t.storageInstancePurge=null,t.traceDB=null,t.onCallbackOnFinProcessus=function(e){t.purgerTraces()},t._modeDebugDuration=72e5,t._dateDebutDebug=0,t._dateFinDebug=0,t}c.TraceManager=t,g.Components.RegistryManager.getInstance().register(t)})((g=f.Services||(f.Services={})).Trace||(g.Trace={}))}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t,o,n,i,r;function s(e,t,n){var r=i.call(this,e,s.CLASSNAME,t,n)||this;return r.niveauxDeclenchementPurgeDebug=[],r.niveauMaxTrace=null,r.nbTracesAStocker=null,r.messagesAPurgerSiError=[],r.indexMessagesAPurgerSiError=0,r.niveauxDeclenchementPurgeDebug=n.niveauxDeclenchementPurgeDebug||[{name:"*",level:o.LEVEL.ERROR}],r.niveauMaxTrace=n.niveauMaxTrace||o.LEVEL.WARN,r.nbTracesAStocker=n.nbTracesAStocker||50,r}t=e.Services||(e.Services={}),o=t.Loggers||(t.Loggers={}),n=o.Appenders||(o.Appenders={}),i=n.AbstractAppender,__extends(s,i),Object.defineProperty(s,"SERVICE_TRACE",{set:function(e){null!==(s._SERVICE_TRACE=e)&&0<s.tracesAEnregistrer.length&&(s._SERVICE_TRACE.sendMultipleLogs(s.tracesAEnregistrer,s.messageFormater),s.tracesAEnregistrer.length=0)},enumerable:!0,configurable:!0}),s.prototype.append=function(e){return!!i.prototype.append.call(this,e)||(this.messagesAPurgerSiError.length<this.nbTracesAStocker?this.messagesAPurgerSiError.push(e):(this.messagesAPurgerSiError[this.indexMessagesAPurgerSiError]=e,this.indexMessagesAPurgerSiError++,this.indexMessagesAPurgerSiError%=this.nbTracesAStocker),!1)},s.prototype.onAppend=function(e){this.verificationEtEnvoiTracesSiNiveauDelenchementAtteint(e),this.envoyerTrace(e)},s.prototype.verificationEtEnvoiTracesSiNiveauDelenchementAtteint=function(t){var n=null,r=o.LEVEL.NONE;if(this.niveauxDeclenchementPurgeDebug.forEach(function(e){("*"===e.name||new RegExp("^"+e.name.replace(".","\\.")).test(t.packageName))&&(null===n||n.length<e.name.length)&&(r=e.level,n=e.name)}),o.LoggerHelper.INSTANCE.testLevel(t.niveau,r)){for(var e=this.indexMessagesAPurgerSiError;e<this.messagesAPurgerSiError.length;)this.envoyerTrace(this.messagesAPurgerSiError[e]),e++;for(e=0;e<this.indexMessagesAPurgerSiError;)this.envoyerTrace(this.messagesAPurgerSiError[e]),e++;this.messagesAPurgerSiError.length=0,this.indexMessagesAPurgerSiError=0}},s.prototype.envoyerTrace=function(e){null!==s._SERVICE_TRACE?s._SERVICE_TRACE.sendLog(e,s.messageFormater):s.tracesAEnregistrer.push(e)},s.CLASSNAME="MyWay.Services.Loggers.Appenders.DBAppender",s._SERVICE_TRACE=null,s.tracesAEnregistrer=[],s.messageFormater=new o.Formaters.MessageFormater,r=s,n.DBAppender=r,o.LoggerFactory.INSTANCE.declareAppender(r.CLASSNAME,r)}(MyWay=MyWay||{}),function(e){var r,o,t,i,n;function s(e,t,n){var r=i.call(this,e,s.CLASSNAME,t,n)||this;return r.format=null,r._eventsToSend=null,r.parse(n.format),r}r=e.Services||(e.Services={}),o=r.Loggers||(r.Loggers={}),t=o.Appenders||(o.Appenders={}),i=t.AbstractAppender,__extends(s,i),s.prototype.onAppend=function(t){var n="";this.format.forEach(function(e){n+=e.format(t)});var e=new r.Component.ManagerEvent(r.Component.ManagerEventType.Log,{trace:{content:n,level:null}});switch(e.ComponentName=r.Components.ComponentType.Trace,t.niveau){case o.LEVEL.DEBUG:e.Detail.trace.level="DEBUG",this.send(e);break;case o.LEVEL.INFO:e.Detail.trace.level="INFO",this.send(e);break;case o.LEVEL.WARN:e.Detail.trace.level="WARN",this.send(e);break;case o.LEVEL.ERROR:e.Detail.trace.level="ERROR",this.send(e)}},s.prototype.send=function(e){var t=null;r.ServiceManager.Instance()&&r.ServiceManager.Instance().Library&&r.ServiceManager.Instance().Library.Evennements&&(t=r.ServiceManager.Instance().Library.Evennements),t?(null!==this._eventsToSend&&(this._eventsToSend.forEach(function(e){r.ServiceManager.Instance().Library.Evennements.notifier(e)}),this._eventsToSend=null),r.ServiceManager.Instance().Library.Evennements.notifier(e)):(null===this._eventsToSend&&(this._eventsToSend=[]),this._eventsToSend.push(e))},s.prototype.parse=function(e){var n=this,t=e.split(/%([^ ]+)/g);this.format=[],t.forEach(function(t){if(0!==t.length){if(/^d/.test(t)){var e=t.split(/d{([^}]+)}/);return 3!==e.length?void n.format.push(new o.Formaters.DateFormater):void n.format.push(new o.Formaters.DateFormater(e[1]))}/^level$/.test(t)?n.format.push({format:function(e){return e.niveau.toString()}}):/^class/.test(t)?n.format.push({format:function(e){return e.packageName}}):/^msg/.test(t)?n.format.push(new o.Formaters.MessageFormater):n.format.push({format:function(e){return t}})}})},s.CLASSNAME="MyWay.Services.Loggers.Appenders.PortalAppender",n=s,t.PortalAppender=n,o.LoggerFactory.INSTANCE.declareAppender(n.CLASSNAME,n)}(MyWay=MyWay||{}),function(e){var P,I,N,t;function L(){return N.call(this,P.Components.ComponentType.Context)||this}P=e.Services||(e.Services={}),I=P.Context||(P.Context={}),N=P.Components.ComponentManagerMessageBase,__extends(L,N),L.prototype.getAuthentificationInfo=function(){return this.managerInstance.getAuthentificationInfo()},L.prototype.reception=function(e){var t=this;switch(e.subject){case I.ContextMessageSubject.AddToContext:var n=(a=e.message).key,r=a.value,o=I.StorageLevel.Process;return L.logger.debug("Ajout au contexte %1 de la clé %2",o,n),this.managerInstance.AddToContextAsync(o,n,r);case I.ContextMessageSubject.AddToContextTech:var i=(a=e.message).kvp,s=(o=a.level,a.elementId);return L.logger.debug("Ajout au contexte %1 des clés valeurs %2",o,JSON.pruned(i)),this.managerInstance.AddListToContextAsync(o,i,s);case I.ContextMessageSubject.ClearContext:var a=e.message;return L.logger.debug("Efface le contexte"),this.managerInstance.ClearContext(),(b=P.CoreCommon.ServiceDePromesse.defer()).resolve(),b.promise;case I.ContextMessageSubject.AddToSharedContext:var c=(a=e.message).key;return r=a.value,o=I.StorageLevel.Shared,L.logger.debug("Ajout au contexte %1 de la clé %2",o,c),this.managerInstance.AddToContextAsync(o,c,r);case I.ContextMessageSubject.RemoveFromSharedContext:var u=(a=e.message).key;return o=I.StorageLevel.Shared,L.logger.debug("Ajout au contexte "+o+" de la clé "+u),this.managerInstance.RemoveFromContextAsync(o,u);case I.ContextMessageSubject.AddToProcessStepContext:var l=(a=e.message).key,p=(r=a.value,a.processStepId);return o=I.StorageLevel.Step,L.logger.debug("Ajout au contexte %1 de la clé %2",o,l),this.managerInstance.AddListToContextAsync(o,[{Key:l,Value:r}],p);case I.ContextMessageSubject.AddToGlobalContext:return i=(a=e.message).kvp,o=I.StorageLevel.Global,L.logger.debug("Ajout au contexte %1 de %2",o,JSON.stringify(i)),this.managerInstance.AddListToContextAsync(o,i);case I.ContextMessageSubject.AddToTempoContext:return i=(a=e.message).kvp,o=I.StorageLevel.Tempo,L.logger.debug("Ajout au contexte %1 de %2",o,JSON.stringify(i)),this.managerInstance.AddListToContextAsync(o,i);case I.ContextMessageSubject.AddListToContext:return i=(a=e.message).kvp,o=I.StorageLevel.Process,L.logger.debug("Ajout au contexte %1 de %2",o,JSON.stringify(i)),this.managerInstance.AddListToContextAsync(o,i);case I.ContextMessageSubject.AddToMainProcessContext:var f=(a=e.message).key;return r=a.value,o=I.StorageLevel.MainProcess,L.logger.debug("Ajout au contexte %1 de la clé %2",o,f),this.managerInstance.AddToContextAsync(o,f,r).then(function(e){return t.managerInstance.SendPortalContext(!0,"AddToMainProcessContext"),e});case I.ContextMessageSubject.GetFromMainProcessContext:var g=(a=e.message).key;return this.managerInstance.GetFromContextAsync(g);case I.ContextMessageSubject.ChangeMainProcessName:var h=(a=e.message).name;return this.managerInstance.ChangeMainProcessNameAsync(h).then(function(e){t.managerInstance.SendEvent(new P.Component.ManagerEvent(P.Component.ManagerEventType.ChangementNomProcess,{portalContext:e,info:h}))});case I.ContextMessageSubject.GetFromContext:return g=(a=e.message).key,this.managerInstance.GetFromContextAsync(g);case I.ContextMessageSubject.GetFromSharedContext:return g=(a=e.message).key,this.managerInstance.GetFromSharedContextAsync(g);case I.ContextMessageSubject.GetCurrentStepInfo:return a=e.message,this.managerInstance.GetCurrentStepInfoAsync().then(function(e){return t.managerInstance.setIsMyWayUrl(!0),e});case I.ContextMessageSubject.GetSharedStorage:a=e.message;var d=this.managerInstance._context.sharedStorage;return(b=P.CoreCommon.ServiceDePromesse.defer()).resolve(d),b.promise;case I.ContextMessageSubject.GetPortals:a=e.message;var m=this.managerInstance.getPortails();return(b=P.CoreCommon.ServiceDePromesse.defer()).resolve(m),b.promise;case I.ContextMessageSubject.GetGlobalStorage:a=e.message;var y=this.managerInstance._context.globalStorage;return(b=P.CoreCommon.ServiceDePromesse.defer()).resolve(y),b.promise;case I.ContextMessageSubject.SetMyWayCompatible:return a=e.message,this.managerInstance.setIsMyWayUrl(!0),(b=P.CoreCommon.ServiceDePromesse.defer()).resolve({versionComposant:P.CoreCommon.VersionMySys}),b.promise;case I.ContextMessageSubject.GetListFromContext:var v=(a=e.message).keyArray;return this.managerInstance.GetListFromContextAsync(v);case I.ContextMessageSubject.GetAuthentificationInfo:return a=e.message,this.managerInstance.GetAuthentificationInfoAsync();case I.ContextMessageSubject.GetParametresComptables:return a=e.message,this.managerInstance.GetParametresComptablesAsync();case I.ContextMessageSubject.GetWaitingProcesses:return a=e.message,this.managerInstance.GetWaitingProcessesAsync();case I.ContextMessageSubject.PutProcessInPortalContext:var C=(a=e.message).processId;return this.managerInstance.PutProcessInPortalContext(C),this.managerInstance.SendPortalContext(!1,"PutProcessInPortalContext"),(b=P.CoreCommon.ServiceDePromesse.defer()).resolve(),b.promise;case I.ContextMessageSubject.PutTaskInPortalContext:var S=(a=e.message).taskId;return this.managerInstance.PutTaskInPortalContext(S).then(function(e){t.managerInstance.SendPortalContext(!1,"PutTaskInPortalContext")});case I.ContextMessageSubject.GetCurrentProcessId:return a=e.message,this.managerInstance.GetCurrentProcessIdAsync();case I.ContextMessageSubject.GetCurrentMainProcess:return a=e.message,this.managerInstance.GetCurrentMainProcessAsync();case I.ContextMessageSubject.GetCurrentStepId:return a=e.message,this.managerInstance.GetCurrentStepIdAsync();case I.ContextMessageSubject.GetObjectFromContext:return a=e.message,(b=P.CoreCommon.ServiceDePromesse.defer()).resolve(this.managerInstance.GetObjectFromContext(a.keyArray)),b.promise;case I.ContextMessageSubject.GetTypedObjectFromContext:return a=e.message,(b=P.CoreCommon.ServiceDePromesse.defer()).resolve(this.managerInstance.GetTypedObjectFromContext(a.template)),b.promise;case I.ContextMessageSubject.GetPortalContext:var E=(a=e.message).getSingleIfSingle;return(b=P.CoreCommon.ServiceDePromesse.defer()).resolve(this.managerInstance.GetPortalContext(E)),b.promise;case I.ContextMessageSubject.SwitchProcess:var A=(a=e.message).processId,b=P.CoreCommon.ServiceDePromesse.defer(),M=this.managerInstance.SwitchToProcess(A);return this.managerInstance.DisplayProcesses(),M&&this.managerInstance.SendEvent(new P.Component.ManagerEvent(P.Component.ManagerEventType.BasculeProcess,{portalContext:this.managerInstance.GetPortalContext()})),b.resolve(!1),b.promise;case I.ContextMessageSubject.EndProcess:var T=(a=e.message).processId;return this.managerInstance._portail_terminerProcess(T);case I.ContextMessageSubject.EndAllProcess:return a=e.message,this.managerInstance._portail_terminerAllProcess();default:return N.prototype.reception.call(this,e)}},L.CLASS_NAME="MyWay.Services.Context.ContextManagerMessage",L.logger=P.Loggers.LoggerFactory.INSTANCE.getClass(L.CLASS_NAME),t=L,I.ContextManagerMessage=t,P.Components.RegistryManagerMessage.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var t,s,a,n;function r(){return a.call(this,t.Components.ComponentType.Display)||this}t=e.Services||(e.Services={}),s=t.Display||(t.Display={}),a=t.Components.ComponentManagerMessageBase,__extends(r,a),r.prototype.reception=function(t){var n=this;switch(t.subject){case s.DisplayMessageSubject.Redirect:var e=(i=t.message).url,r=i.previousUrl;return this.managerInstance.Redirect(e,r);case s.DisplayMessageSubject.RedirectInStep:return e=(i=t.message).url,this.managerInstance.RedirectInStep(e),this.library.Core.getPromesseSelfResoved();case s.DisplayMessageSubject.PrepareSubmit:return e=(i=t.message).url,this.managerInstance.PrepareSubmit(e),this.library.Core.getPromesseSelfResoved();case s.DisplayMessageSubject.DisplayMessage:var o=(i=t.message).message;return this.managerInstance.DisplayMessage(o),this.library.Core.getPromesseSelfResoved();case s.DisplayMessageSubject.GetMyIFrameId:var i=t.message;return this.library.Core.promesseTryCatch(function(e){e.resolve(n.managerInstance.getMyIFrameId(t.iframe))});default:return a.prototype.reception.call(this,t)}},r.CLASS_NAME="MyWay.Services.Display.DisplayManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,s.DisplayManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var n;(n=e.Services||(e.Services={})).ServiceManagerExtended.setListenerOnInitContext(function(e){for(var t in n.PrivatePortalServiceParameters.Instance().LisaPlaceholders)e.Context.AddToContext("global",t,n.PrivatePortalServiceParameters.Instance().LisaPlaceholders[t]);return e.Core.createPromiseSelfResolved(e.Context.GetPortalContext())})}(MyWay=MyWay||{}),function(e){var r,o,t,n;function i(){return t.call(this,r.Components.ComponentType.Context)||this}r=e.Services||(e.Services={}),o=r.Context||(r.Context={}),t=r.Components.ComponentManagerExtendedBase,__extends(i,t),i.prototype.AddToContext=function(e,t,n){var r;switch(e){case"global":r=o.StorageLevel.Global;break;case"tempo":r=o.StorageLevel.Tempo;break;default:r=o.StorageLevel.Process}return this.manager.AddToContext(r,t,n)},i.prototype.GetDonneesLocales=function(){return this.manager.GetDonneesLocales()},i.prototype.GetAuthentificationInfo=function(e){return void 0===e&&(e=!1),this.manager.GetAuthentificationInfo(e)},i.prototype.GetFromContext=function(e){return this.manager.GetFromContext(e)},i.prototype.DedierPortail=function(e){return this.manager.SetSingleProcess(e)?(this.manager.DisplayProcesses(),this.manager.GetCurrentStep(this.manager.GetCurrentProcess())):null},i.prototype.TerminerProcess=function(e){return this.manager._portail_terminerProcess(e)},i.prototype.BasculerProcess=function(e){i.logger.debug("BasculerProcess");var t=r.CoreCommon.ServiceDePromesse.defer(),n=this.manager.SwitchToProcess(e);return this.manager.DisplayProcesses(),n&&this.manager.SendEvent(new r.Component.ManagerEvent(r.Component.ManagerEventType.BasculeProcess,{portalContext:this.manager.GetPortalContext()})),t.resolve(!1),t.promise},i.prototype.ChangerNomProcessPrincipal=function(e){return this.manager.ChangeMainProcessName(e)},i.prototype.RemoveWaitingProcesses=function(){return this.manager.RemoveWaitingProcesses()},i.prototype.AnalyseApp=function(){var t=r.CoreCommon.ServiceDePromesse.defer();return this.manager.AnalyseApp(function(e){t.resolve(e)}),t.promise},i.prototype.GetPortalContext=function(e){return void 0===e&&(e=!0),this.manager.GetPortalContext(e)},i.prototype.ExtraireProcess=function(e){return this.manager._portail_extraireProcess(e)},i.CLASS_NAME="MyWay.Services.Context.ContextManagerExtended",i.logger=r.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),n=i,o.ContextManagerExtended=n,r.Components.RegistryManagerExtended.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Display)||this}t=e.Services||(e.Services={}),n=t.Display||(t.Display={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),Object.defineProperty(i.prototype,"onNotificationDeMessage",{set:function(e){this.manager.onNotificationDeMessage=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onFermerModalMessage",{set:function(e){this.manager.onFermerModalMessage=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onAffichageModalMessage",{set:function(e){this.manager.onAffichageModalMessage=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onAffichageModalAide",{set:function(e){this.manager.onAffichageModalAide=e},enumerable:!0,configurable:!0}),i.prototype.AfficherUrl=function(e,t){return this.manager.AfficherUrl(e,t,!1)},i.prototype.OuvrirUrl=function(e){return this.manager.OuvrirUrl(e)},Object.defineProperty(i.prototype,"onChangementDeFrame",{set:function(e){this.manager.onShowFrame=e},enumerable:!0,configurable:!0}),o=i,n.DisplayManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,r,n,o;function i(){return n.call(this)||this}t=e.Services||(e.Services={}),r=t.DonneesDelocalisees||(t.DonneesDelocalisees={}),n=r.DonneesDelocaliseesAgent,__extends(i,n),i.prototype.reInitDbDonneesDelocalisees=function(e,t){return this.sendMessage(r.Messages.DonneesDelocaliseesMessageSubject.ReInitDbDonneesDelocalisees,{}).then(function(){e&&e()},function(e){throw t&&t(e),e})},i.prototype.getTDTById=function(e,t,n){return this.sendMessage(r.Messages.DonneesDelocaliseesMessageSubject.GetTDTById,{idTDT:e}).then(function(e){t&&t(e)},function(e){throw n&&n(e),e})},i.prototype.deleteTDTById=function(e,t,n){return this.sendMessage(r.Messages.DonneesDelocaliseesMessageSubject.DeleteTDTById,{}).then(function(){t&&t()},function(e){throw n&&n(e),e})},o=i,r.DonneesDelocaliseesTechAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var s;(function(e){s.ServiceManager.addActionOnInitialize("Preferences.ObtenirPreferences",function(e){return e.Preferences.ObtenirPreferences().then(function(){})},"Context.GetDonneesLocales");var o,t=(o=s.Components.ComponentManagerBase,__extends(i,o),i.prototype.init=function(e,t,n,r){return this.api=r,o.prototype.init.call(this,e,t,n,r)},i.prototype.ObtenirPreferences=function(){var t=this;return this.library.Context.getAuthentificationInfo().then(function(e){if(e)return t.api.ObtenirPreferences(e.agentConnecte.referenceExterneAgent).then(function(e){return t.internalSavePreferences(e),i.logger.debug("ServiceApi.Preferences.ObtenirPreferences Success - %1",JSON.stringify(e)),e},function(e){throw i.logger.error("ServiceApi.Preferences.ObtenirPreferences Failed - %1",JSON.stringify(e)),e});throw i.logger.error("Impossible de récupérer les données d'authentification"),new s.Erreur("Impossible de récupérer les données d'authentification")})},i.prototype.LirePreference=function(t,e){var n=this;return e?this.internalGetPreferencesChargementServeur().then(function(e){return n.preferenceTrouve(t,e)}):this.internalGetPreferences().then(function(e){return n.preferenceTrouve(t,e)})},i.prototype.preferenceTrouve=function(t,e){if(e){var n=!1,r=null;return e.every(function(e){return e.cle===t&&(n=!0,r=e.valeur),!n}),r}var o=new s.Erreur("JSON des préférences mal formé");throw i.logger.error("GetFromContext Failed - 1%",JSON.stringify(o)),o},i.prototype.EcrirePreference=function(t){var n=this,e=this.library.Core.getPromesseSelfResoved();this.derniereEcritureEnAttente&&(e=this.derniereEcritureEnAttente);var r=null;return this.derniereEcritureEnAttente=e.then(function(){return n.library.Context.getAuthentificationInfo()}).then(function(e){return r=e,n.internalGetPreferences()}).then(function(e){return e?(n.internalMettreAJourDonnee(e,t),n.api.EcrirePreference(r.agentConnecte.referenceExterneAgent,t).catch(function(e){i.logger.error("ServiceApi.Preferences.EcrirePreference Failed - 1%",JSON.stringify(e))}),n.library.Core.getPromesseSelfResoved()):n.api.EcrirePreference(r.agentConnecte.referenceExterneAgent,t).then(function(){return n.ObtenirPreferences().then(function(){})},function(e){throw i.logger.error("ServiceApi.Preferences.EcrirePreference Failed - 1%",JSON.stringify(e)),e})}),this.derniereEcritureEnAttente},i.prototype.LireMultiPreference=function(t){return this.internalGetPreferences().then(function(e){var r={preferences:[]};return t.forEach(function(t){var n=!1;e.every(function(e){return t===e.cle&&(n=!0,r.preferences.push({cle:e.cle,valeur:e.valeur})),!n}),n||r.preferences.push(null)}),r})},i.prototype.internalGetPreferences=function(){var e=null;try{e=JSON.parse(this.library.Context.GetFromContext("preferences"))}catch(e){var t=new s.Erreur("JSON des préférences mal formé");return i.logger.error("GetFromContext Failed - 1%",JSON.stringify(t)),this.library.Core.createPromiseSelfError(t)}return e?this.library.Core.createPromiseSelfResolved(e):this.ObtenirPreferences()},i.prototype.internalGetPreferencesChargementServeur=function(){try{JSON.parse(this.library.Context.GetFromContext("preferences"))}catch(e){var t=new s.Erreur("JSON des préférences mal formé");return i.logger.error("GetFromContext Failed - 1%",JSON.stringify(t)),this.library.Core.createPromiseSelfError(t)}return this.ObtenirPreferences()},i.prototype.internalSavePreferences=function(e){this.library.Context.AddToContext(s.Context.StorageLevel.Global,"preferences",JSON.stringify(e))},i.prototype.internalMettreAJourDonnee=function(e,t){t.forEach(function(t){var n=!1;e.every(function(e){return e.cle===t.cle&&(e.valeur=t.valeur,n=!0),!n}),n||e.push({cle:t.cle,valeur:t.valeur})}),this.internalSavePreferences(e)},i.CLASS_NAME="MyWay.Services.Preferences.PreferencesManager",i.logger=s.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),i);function i(){var e=o.call(this,s.Components.ComponentType.Preferences)||this;return e.api=null,e.derniereEcritureEnAttente=null,e}e.PreferencesManager=t,s.Components.RegistryManager.getInstance().register(t)})((s=e.Services||(e.Services={})).Preferences||(s.Preferences={}))}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Numerisation)||this}t=e.Services||(e.Services={}),n=t.Numerisation||(t.Numerisation={}),r=t.Components.ComponentAgentBase,__extends(i,r),i.prototype.numeriser=function(e,t){return i.logger.info("Méthode à déprécier - numeriser"),this.sendMessage(n.NumerisationMessageSubject.Numeriser,{data:e,numerisationParams:t})},i.prototype.numeriserArcade=function(e,t){return i.logger.info("Méthode à surveiller - numeriserArcade"),this.sendMessage(n.NumerisationMessageSubject.NumeriserArcade,{data:e,numerisationParams:t})},i.prototype.getSpiFactoryActivationStatut=function(){return i.logger.info("Méthode à surveiller - getSpiFactoryActivationStatut"),this.sendMessage(n.NumerisationMessageSubject.GetSpiFactoryActivationStatut,{})},i.CLASS_NAME="MyWay.Services.Numerisation.NumerisationAgent",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.NumerisationAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var r,t,n;function o(e){this.libraryManager=null,this._url=e}r=e.Services||(e.Services={}),t=r.Numerisation||(r.Numerisation={}),o.prototype.initApi=function(e){this.libraryManager=e},o.prototype.numeriserDocument=function(e,t){var n={};return n.url=this._url+"/NumeriserSpifactory",n.method=r.MethodEnum.POST,n.params=t,n.async=!0,n.contentType=r.ContentTypeEnum.JSON,n.data=JSON.stringify(e),n.cache=!1,this.libraryManager.Core.sendRequest(n)},o.prototype.getSpiFactoryActivationStatutOnServeur=function(){var e={};return e.url=this._url+"/GetSpiFactoryActivationStatut",e.method=r.MethodEnum.GET,e.async=!0,e.contentType=r.ContentTypeEnum.JSON,this.libraryManager.Core.sendRequest(e)},o.prototype.numeriserDocumentArcade=function(e,t){var n={};return n.url=this._url+"/NumeriserSpifactoryArcade",n.method=r.MethodEnum.POST,n.params=t,n.async=!0,n.contentType=r.ContentTypeEnum.JSON,n.data=JSON.stringify(e),this.libraryManager.Core.sendRequest(n)},n=o,t.NumerisationApiBase=n}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Numerisation)||this;return e.wrapped=null,e}t=e.Services||(e.Services={}),o=t.Numerisation||(t.Numerisation={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?this.wrapped=new o.NumerisationApiWindows:this.wrapped=new o.NumerisationApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.wrapped.initApi(t)})},r.prototype.initApi=function(e){},r.prototype.numeriserDocument=function(e,t){return this.wrapped.numeriserDocument(e,t)},r.prototype.getSpiFactoryActivationStatutOnServeur=function(){return this.wrapped.getSpiFactoryActivationStatutOnServeur()},r.prototype.numeriserDocumentArcade=function(e,t){return this.wrapped.numeriserDocumentArcade(e,t)},n=r,o.NumerisationApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.PrivatePortalServiceParameters.Instance().NumerisationUrl)||this}t=e.Services||(e.Services={}),n=t.Numerisation||(t.Numerisation={}),r=n.NumerisationApiBase,__extends(i,r),o=i,n.NumerisationApiFullWeb=o}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/numerisation/")||this}t=e.Services||(e.Services={}),n=t.Numerisation||(t.Numerisation={}),r=n.NumerisationApiBase,__extends(i,r),o=i,n.NumerisationApiWindows=o}(MyWay=MyWay||{}),function(e){var n,r,t,o;function i(){return t.call(this,n.Components.ComponentType.Habilitation)||this}n=e.Services||(e.Services={}),r=n.Habilitation||(n.Habilitation={}),t=n.Components.ComponentAgentBase,__extends(i,t),i.prototype.EstHabilite=function(e){var t=n.Controle.StaticArrayControle.isArray(e);return this.sendMessage(r.HabilitationMessageSubject.EstHabilite,{code:t?e:[e]}).then(function(e){return t?e:e[0]})},o=i,r.HabilitationAgent=o,n.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(s){var a,e,r,t;function n(){return r.call(this,a.Components.ComponentType.Habilitation)||this}a=s.Services||(s.Services={}),e=a.Habilitation||(a.Habilitation={}),r=a.Components.ComponentApiBase,__extends(n,r),n.prototype.init=function(e,t,n){return this._habilitationUrl=a.PrivatePortalServiceParameters.Instance().HabilitationUrl,r.prototype.init.call(this,e,t,n)},n.prototype.GetHabilitations=function(e,t,n,r,o){try{if(o.agentConnecte.referenceExterneAgent&&o.codeEtablissement&&o.agentConnecte.typeFonction){var i=void 0;if(i=this._habilitationUrl+"/?mysys="+e+"&iam="+t+"&cultureNet="+n+"&codeAgent=T"+o.agentConnecte.referenceExterneAgent+"&codeEtablissement="+o.codeEtablissement+"&typeFonction="+o.agentConnecte.typeFonction,t||n){if(null==r||!r.IdentifiantUser||!r.DomaineADUser)return a.Promesses.createPromiseSelfError(new a.Erreur(s.Services.Libelle.LibelleModel.COM.ERREUR_HABILITATION_PARAMETRES_INSUFFISANTS));i+="&userAD="+r.IdentifiantUser,i+="&domaineUtilisateur="+r.DomaineADUser}return this.libraryManager.Core.sendRequest({url:i,method:a.MethodEnum.GET,authentificationInfo:o})}return a.Promesses.createPromiseSelfError(new a.Erreur(s.Services.Libelle.LibelleModel.COM.ERREUR_HABILITATION_PARAMETRES_INSUFFISANTS))}catch(e){return a.Promesses.createPromiseSelfError(new a.Erreur(e))}},t=n,e.HabilitationApi=t,a.Components.RegistryApi.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var t;function n(){}((t=e.Services||(e.Services={})).Lisa||(t.Lisa={})).LisaCallbackResult=n}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Lisa="Lisa"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Lisa||(t.Lisa={}),r=n.Messages||(n.Messages={}),(o=r.LisaMessageSubject||(r.LisaMessageSubject={}))[o.Next=0]="Next",o[o.StartProcess=1]="StartProcess",o[o.StartSubProcess=2]="StartSubProcess",o[o.StartExternalApp=3]="StartExternalApp",o[o.GetProcesses=4]="GetProcesses",o[o.GetTools=5]="GetTools",o[o.GetCodesProcessus=6]="GetCodesProcessus",o[o.GetInfoProcessus=7]="GetInfoProcessus",o[o.StartUrl=8]="StartUrl",o[o.StartUrlPortal=9]="StartUrlPortal",o[o.StartProcessPortal=10]="StartProcessPortal",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Lisa,[t.Components.ComponentType.Aide,t.Components.ComponentType.Context,t.Components.ComponentType.ContexteClient,t.Components.ComponentType.Core,t.Components.ComponentType.Display,t.Components.ComponentType.Habilitation,t.Components.ComponentType.Interop,t.Components.ComponentType.TraceSuivi])}(MyWay=MyWay||{}),function(e){var t;(function(e){var t=(n.prototype.Init=function(e){e&&(e.ProcessDemarre&&(this.ProcessDemarre=new u(e.ProcessDemarre)),e.ProchaineEtape&&(this.ProchaineEtape=new l(e.ProchaineEtape)))},n);function n(){}e.ResultBase=t;var r,o=(__extends(i,r=t),i);function i(e){var t=r.call(this)||this;return e&&(t.CodeEtape=e.CodeEtape,t.ValeurSortie=e.ValeurSortie,t.FinProcess=e.FinProcess,t.ValeurFinProcess=e.ValeurFinProcess),t.Init(e),t}e.NextResult=o;var s,a=(__extends(c,s=t),c);function c(e){var t=s.call(this)||this;return e&&(t.CodeProcessus=e.CodeProcessus,t.VersionExport=e.VersionExport),t.Init(e),t}e.StartResult=a;var u=function(e){e&&(this.Code=e.Code,this.ValeurDepart=e.ValeurDepart,this.Nom=e.Nom,this.EtapesConnues=e.EtapesConnues,this.CodeEtape=e.CodeEtape,this.OptionsProcess=e.OptionsProcess,this.OptionsProcessAsEtape=e.OptionsProcessAsEtape,this.Actions=e.Actions)};e.ProcessResult=u;var l=function(e){if(e){if(this.CodeEtape=e.CodeEtape,this.CodeMetier=e.CodeMetier,this.TypeApplication=e.TypeApplication,this.ValeurEntree=e.ValeurEntree,this.CodeApplication=e.CodeApplication,this.NomApplication=e.NomApplication,this.Icone=e.Icone,this.LocalisationAbsolue=e.LocalisationAbsolue,this.LocalisationRelative=e.LocalisationRelative,this.Contrats=[],e.Contrats)for(var t=0;t<e.Contrats.length;t++){var n=e.Contrats[t],r=new p(n);this.Contrats.push(r)}if(this.Actions=[],e.Actions)for(t=0;t<e.Actions.length;t++){var o=e.Actions[t],i=new f(o);this.Actions.push(i)}this.OptionsEtape=e.OptionsEtape,this.OptionsPointEntree=e.OptionsPointEntree}};e.EtapeResult=l;var p=function(e){e&&(this.Code=e.Code,this.Type=e.Type,this.Longueur=e.Longueur,this.Nullable=e.Nullable,this.Mode=e.Mode,this.OptionsContrat=e.OptionsContrat)};e.ContratResult=p;var f=function(e){if(e&&(this.ValeurSortie=e.ValeurSortie,this.EstExterne=e.EstExterne,this.NomExterne=e.NomExterne,this.OptionsAction=e.OptionsAction,this.ValeursFinProcessPossibles=[],e.ValeursFinProcessPossibles))for(var t=0;t<e.ValeursFinProcessPossibles.length;t++){var n=e.ValeursFinProcessPossibles[t];this.ValeursFinProcessPossibles.push(n)}};function g(e,t,n){this.Nom=e,this.Icone=t,this.Url=n}e.ActionResult=f,e.ApplicationResult=g})((t=e.Services||(e.Services={})).Lisa||(t.Lisa={}))}(MyWay=MyWay||{}),function(e){var t,n;function r(){}t=e.Services||(e.Services={}),r.setImplementation=function(e){r.implementation=e},Object.defineProperty(r.prototype,"StepInfo",{get:function(){return r.implementation.StepInfo},enumerable:!0,configurable:!0}),r.prototype.Next=function(e){return r.implementation.Next(e)},r.prototype.AddToContext=function(e,t){return r.implementation.AddToContext(e,t)},r.prototype.GetFromContext=function(e){return r.implementation.GetFromContext(e)},r.prototype.LireFichier=function(e){return r.implementation.LireFichier(e)},r.prototype.Previous=function(){return r.implementation.Previous()},r.CLASS_NAME="MyWay.Services.RouteurAgent",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,t.RouteurAgent=n}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgentExtended,"TraceSuiviTechAgent",{get:function(){return this._techLibrary.TraceSuiviTechAgent}})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgent,"TraceSuiviTechAgent",{get:function(){return this._techLibrary.TraceSuiviTechAgent}})}(MyWay=MyWay||{}),function(e){(e.Services||(e.Services={})).TechLibrary.addInitListener(function(e,t){e.TraceSuiviTechAgent=t.TraceSuivi})}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this)||this}t=e.Services||(e.Services={}),n=t.TraceSuivi||(t.TraceSuivi={}),r=n.TraceSuiviAgent,__extends(i,r),i.prototype.forcerTrace=function(e){return this.sendMessage(n.Messages.TraceSuiviMessageSubject.SendTraceSuiviForcee,{trace:e})},o=i,n.TraceSuiviTechAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Acquisition)||this}t=e.Services||(e.Services={}),n=t.Acquisition||(t.Acquisition={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.onAppelRADLAD=function(e){var t=e.fileInfos,n=e.params;return this.managerInstance.appelRADLAD(t,n)},i.prototype.onConvertFileToImg=function(e){var t=e.fileInfo,n=e.params;return this.managerInstance.convertFileToImg(t,n)},i.prototype.onMergerEtArchiver=function(e){var t=e.fileInfos,n=e.putDocumentInput;return this.managerInstance.mergerEtArchiver(t,n)},i.prototype.onMergerEtUploader=function(e){var t=e.fileInfos;return this.managerInstance.mergerEtUploader(t)},i.prototype.onConvertBase64ToBin=function(e){var t=e.urls;return this.managerInstance.convertBase64ToBin(t)},i.prototype.onPurge=function(e){var t=e.hour;return this.managerInstance.purge(t)},i.prototype.onFermetureSpiFactory=function(e){return this.managerInstance.fermetureSpiFactory()},i.prototype.onSetConfigurationScanner=function(e){var t=e.typeScanner;return this.managerInstance.setConfigurationScanner(t)},i.prototype.onMergeAndOpenPDF=function(e,t){var n=e.params;return this.managerInstance.onMergeAndOpenPDF(n,t)},i.prototype.onRecupereListeDocumentGED=function(e){var t=e.params,n=e.formatResultat;return this.managerInstance.onRecupereListeDocumentGED(t,n)},i.prototype.onOuvrirListeDocumentGED=function(e){var t=e.params,n=e.formatResultat,r=e.formatOuverture;return this.managerInstance.onOuvrirListeDocumentGED(t,n,r)},i.prototype.onGetProcessingTask=function(e){var t=e.guid;return this.managerInstance.onGetProcessingTask(t)},i.prototype.onGetDocumentGEDAndSave=function(e){var t=e.params;return this.managerInstance.onGetDocumentGEDAndSave(t)},i.prototype.onGetDocumentGedSaveAtAndOpen=function(e){var t=e.params;return this.managerInstance.onGetDocumentGedSaveAtAndOpen(t)},i.prototype.onGetDocumentGEDAndOpen=function(e){var t=e.params;return this.managerInstance.onGetDocumentGEDAndOpen(t)},i.prototype.onUploadDocumentFrom=function(e){var t=e.cheminDuFichierSurLePoste;return this.managerInstance.onUploadDocumentFrom(t)},i.prototype.onGetListeScanner=function(e){return this.managerInstance.onGetListeScanner()},i.prototype.onIsPrisEnMainADistance=function(e){return this.managerInstance.onIsPrisEnMainADistance()},i.prototype.reception=function(e){switch(e.subject){case n.Messages.AcquisitionMessageSubject.AppelRADLAD:return this.onAppelRADLAD(e.message);case n.Messages.AcquisitionMessageSubject.ConvertFileToImg:return this.onConvertFileToImg(e.message);case n.Messages.AcquisitionMessageSubject.MergerEtArchiver:return this.onMergerEtArchiver(e.message);case n.Messages.AcquisitionMessageSubject.MergerEtUploader:return this.onMergerEtUploader(e.message);case n.Messages.AcquisitionMessageSubject.ConvertBase64ToBin:return this.onConvertBase64ToBin(e.message);case n.Messages.AcquisitionMessageSubject.Purge:return this.onPurge(e.message);case n.Messages.AcquisitionMessageSubject.FermetureSpiFactory:return this.onFermetureSpiFactory(e.message);case n.Messages.AcquisitionMessageSubject.SetConfigurationScanner:return this.onSetConfigurationScanner(e.message);case n.Messages.AcquisitionMessageSubject.MergeAndOpenPDF:return this.onMergeAndOpenPDF(e.message,e.iframe);case n.Messages.AcquisitionMessageSubject.OuvrirListeDocumentGED:return this.onOuvrirListeDocumentGED(e.message);case n.Messages.AcquisitionMessageSubject.RecupereListeDocumentGED:return this.onRecupereListeDocumentGED(e.message);case n.Messages.AcquisitionMessageSubject.GetProcessingTask:return this.onGetProcessingTask(e.message);case n.Messages.AcquisitionMessageSubject.GetDocumentGEDAndSave:return this.onGetDocumentGEDAndSave(e.message);case n.Messages.AcquisitionMessageSubject.GetDocumentGEDAtAndOpen:return this.onGetDocumentGedSaveAtAndOpen(e.message);case n.Messages.AcquisitionMessageSubject.GetDocumentGEDAndOpen:return this.onGetDocumentGEDAndOpen(e.message);case n.Messages.AcquisitionMessageSubject.GetListeScanner:return this.onGetListeScanner(e.message);case n.Messages.AcquisitionMessageSubject.IsPrisEnMainADistance:return this.onIsPrisEnMainADistance(e.message);case n.Messages.AcquisitionMessageSubject.UploadDocumentFrom:return this.onUploadDocumentFrom(e.message);default:return r.prototype.reception.call(this,e)}},i.CLASS_NAME="MyWay.Services.Acquisition.AcquisitionManagerMessage",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.AcquisitionManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Communication)||this}t=e.Services||(e.Services={}),n=t.Communication||(t.Communication={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.envoyerMail=function(e){return this.manager.envoyerMail(e)},i.prototype.declencherAppel=function(e){return this.manager.declencherAppel(e)},i.prototype.raccrocherAppel=function(){return this.manager.raccrocherAppel()},i.prototype.envoyerMessageAppliKiosque=function(e){return this.manager.envoyerMessageAppliKiosque(e)},o=i,n.CommunicationManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){return i.call(this,t.Components.ComponentType.Communication)||this}t=e.Services||(e.Services={}),o=t.Communication||(t.Communication={}),i=t.Components.ComponentManagerMessageBase,__extends(r,i),r.prototype.reception=function(e){switch(e.subject){case o.CommunicationMessageSubject.EnvoyerMail:var t=e.message.mail;return this.managerInstance.envoyerMail(t);case o.CommunicationMessageSubject.DeclencherAppel:var n=e.message.call;return this.managerInstance.declencherAppel(n);case o.CommunicationMessageSubject.RaccrocherAppel:return e.message,this.managerInstance.raccrocherAppel();case o.CommunicationMessageSubject.EnvoyerMessageAppliKiosque:var r=e.message.messageAgent;return this.managerInstance.envoyerMessageAppliKiosque(r);default:return i.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.Communication.CommunicationManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,o.CommunicationManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o,i;function s(){return o.call(this,t.Components.ComponentType.Chat)||this}t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),r=n.Chat||(n.Chat={}),o=t.Components.ComponentManagerExtendedBase,__extends(s,o),s.prototype.closeChat=function(e){return this.manager.closeChat(e)},s.prototype.openChat=function(e){return this.manager.openChat(e,null)},s.prototype.openChatroom=function(e){return this.manager.openChatroom(e,null)},s.prototype.sendMessage=function(e,t){return this.manager.sendMessageToStream(e,t)},s.prototype.getUtilisateurs=function(){return this.manager.getUtilisateurs()},i=s,r.ChatManagerExtended=i,t.Components.RegistryManagerExtended.getInstance().register(i)}(MyWay=MyWay||{}),function(e){var t,n,r,o,i;function s(){return o.call(this,t.Components.ComponentType.Chat)||this}t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),r=n.Chat||(n.Chat={}),o=t.Components.ComponentManagerMessageBase,__extends(s,o),s.prototype.reception=function(e){switch(e.subject){case r.ChatMessageSubject.AddChatCapacity:var t=e.message;return this.managerInstance.setChatCapacite(e.iframe),this.library.Core.getPromesseSelfResoved();case r.ChatMessageSubject.SetStatut:return t=e.message,this.managerInstance.setStatut(t.statut);case r.ChatMessageSubject.CloseChat:return t=e.message,this.managerInstance.closeChat(t.idChat);case r.ChatMessageSubject.OpenChat:return t=e.message,this.managerInstance.openChat(t.destinataire,e.iframe);case r.ChatMessageSubject.OpenChatroom:return t=e.message,this.managerInstance.openChatroom(t.idChat,e.iframe);case r.ChatMessageSubject.SendMessage:return t=e.message,this.managerInstance.sendMessageToStream(t.idChat,t.message);case r.ChatMessageSubject.AccepterDemanderExpert:return t=e.message,this.managerInstance.accepterDemandeExpert(t.chatroom_id,t.domaine,t.prospect_id,e.iframe);case r.ChatMessageSubject.GetUtilisateurs:return t=e.message,this.managerInstance.getUtilisateurs();case r.ChatMessageSubject.EnvoyerMessageVideoroom:return t=e.message,this.managerInstance.envoyerMessageVideoroom(t.chatroom_id,t.user_id,t.message);case r.ChatMessageSubject.GetChatrooms:return t=e.message,this.managerInstance.getChatrooms(e.iframe);case r.ChatMessageSubject.GetChatroom:return t=e.message,this.managerInstance.getChatroom(t.chatroom_id,e.iframe);case r.ChatMessageSubject.DemarrerVideoChatroom:return t=e.message,this.managerInstance.demarrerVideoChatroom(t.idChat),this.library.Core.getPromesseSelfResoved();case r.ChatMessageSubject.ArreterVideoChatroom:return t=e.message,this.managerInstance.arreterVideoChatroom(t.idChat),this.library.Core.getPromesseSelfResoved();case r.ChatMessageSubject.InviterPersonnesAUneChatroom:return t=e.message,(n=this.managerInstance).inviterPersonnesAUneChatroom.apply(n,[t.chatroom_id].concat(t.users_id));default:return o.prototype.reception.call(this,e)}var n},i=s,r.ChatManagerMessage=i,t.Components.RegistryManagerMessage.getInstance().register(i)}(MyWay=MyWay||{}),function(e){var t,n,r,o,i;function s(){return o.call(this,t.Components.ComponentType.Notification)||this}t=e.Services||(e.Services={}),n=t.BriqueCommunication||(t.BriqueCommunication={}),r=n.Notification||(n.Notification={}),o=t.Components.ComponentManagerMessageBase,__extends(s,o),s.prototype.onAbonnement=function(e){return this.managerInstance.ecouterNotifications(e.subject)},s.prototype.onDesabonnement=function(e){this.managerInstance.arreterNotifications(e.subject)},s.prototype.onGetSujets=function(e){return this.managerInstance.getListeSujets()},s.prototype.reception=function(e){switch(e.subject){case r.NotificationMessageSubject.Abonnement:return e.message,this.onAbonnement(e.message);case r.NotificationMessageSubject.Desabonnement:return e.message,this.onDesabonnement(e.message),this.library.Core.getPromesseSelfResoved();case r.NotificationMessageSubject.GetListeSubjects:return e.message,this.onGetSujets(e.message);default:return o.prototype.reception.call(this,e)}},i=s,r.NotificationManagerMessage=i,t.Components.RegistryManagerMessage.getInstance().register(i)}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){this.libraryManager=null}t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),o.prototype.initApi=function(e){this.libraryManager=e},o.prototype.estConnecte=function(){return navigator&&void 0!==navigator.onLine?navigator.onLine?t.Promesses.createPromiseSelfResolved(!0):t.Promesses.createPromiseSelfResolved(!1):t.Promesses.createPromiseSelfError(new t.Erreur(e.Services.Libelle.LibelleModel.COM.ERREUR_MOBILITE_RECUP_RESEAU_IMPOSSIBLE))},o.prototype.estEcranTactile=function(){return"onstarttouch"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints?t.Promesses.createPromiseSelfResolved(!0):t.Promesses.createPromiseSelfResolved(!1)},o.prototype.listePeripheriques=function(){return t.Promesses.createPromiseSelfResolved([])},o.prototype.listeTablettesSignatures=function(){return t.Promesses.createPromiseSelfResolved([])},o.prototype.getPlagesReseau=function(){return this.libraryManager.ConfigurationPoste.getConfigurationPoste()},r=o,n.MobiliteApiBase=r}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Mobilite)||this;return e.wrapped=null,e}t=e.Services||(e.Services={}),o=t.Mobilite||(t.Mobilite={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?e.SIRIS?this.wrapped=new o.MobiliteApiSIRIS:this.wrapped=new o.MobiliteApiWindows:this.wrapped=new o.MobiliteApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.wrapped.initApi(t)})},r.prototype.initApi=function(e){},r.prototype.getPlagesReseau=function(){return this.wrapped.getPlagesReseau()},r.prototype.estConnecte=function(){return this.wrapped.estConnecte()},r.prototype.estEcranTactile=function(){return this.wrapped.estEcranTactile()},r.prototype.listeTablettesSignatures=function(){return this.wrapped.listeTablettesSignatures()},r.prototype.getPlateforme=function(){return this.wrapped.getPlateforme()},r.prototype.getResolutionEcran=function(){return this.wrapped.getResolutionEcran()},r.prototype.getAdresseIp=function(){return this.wrapped.getAdresseIp()},n=r,o.MobiliteApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this)||this}t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),r=n.MobiliteApiBase,__extends(i,r),i.prototype.getResolutionEcran=function(){var e={largeur:null,hauteur:null};return window.screen?(e.hauteur=window.screen.height,e.largeur=window.screen.width):(e.hauteur=document.body.clientHeight,e.largeur=document.body.clientWidth),t.Promesses.createPromiseSelfResolved(e)},i.prototype.getPlateforme=function(){var e;return e=navigator&&navigator.platform?-1!=navigator.platform.indexOf("Win")?n.PLATEFORME.WINDOWS:-1!=navigator.platform.indexOf("Mac")?n.PLATEFORME.APPLE:-1!=navigator.platform.indexOf("iP")?n.PLATEFORME.APPLE:-1!=navigator.platform.indexOf("Android")?n.PLATEFORME.ANDROID:n.PLATEFORME.AUTRE:n.PLATEFORME.AUTRE,t.Promesses.createPromiseSelfResolved(e)},i.prototype.getFromUrl=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?null:decodeURIComponent(t[1].replace(/\+/g," "))},i.prototype.getAdresseIp=function(){var e=this.getFromUrl("ip");return e?t.Promesses.createPromiseSelfResolved(e):t.Promesses.createPromiseSelfError(new t.Erreur("Aucune adresse Ip passée en paramètre d'url"))},o=i,n.MobiliteApiFullWeb=o}(MyWay=MyWay||{}),function(e){var t,i,n,r;function o(){var e=n.call(this)||this;return e._periphUrl=t.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/periph/",e._contexteUrl=t.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/contexte/",e}t=e.Services||(e.Services={}),i=t.Mobilite||(t.Mobilite={}),n=i.MobiliteApiBase,__extends(o,n),o.prototype.listeTablettesSignatures=function(){return this.libraryManager.Core.sendRequest({url:this._periphUrl+"getliste",method:t.MethodEnum.GET,cache:!1}).then(function(e){var t=[];for(var n in e){var r=JSON.parse(e[n].Info),o=new i.TabletteSignature(r.Type,r.Modele,r.CodeModele);t.push(o)}return t},function(e){throw e})},o.prototype.getResolutionEcran=function(){return this.libraryManager.Core.sendRequest({url:this._contexteUrl+"GetResolutionEcran",method:t.MethodEnum.GET,cache:!1}).then(function(e){return e},function(e){throw e})},o.prototype.getPlateforme=function(){return t.Promesses.createPromiseSelfResolved(i.PLATEFORME.WINDOWS)},o.prototype.getAdresseIp=function(){return this.libraryManager.Core.sendRequest({withHeaders:!0,url:t.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/contexte/GetIpPoste",method:t.MethodEnum.GET}).then(function(e){return e},function(e){throw e})},r=o,i.MobiliteApiWindows=r}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this)||this}t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),r=n.MobiliteApiWindows,__extends(i,r),i.prototype.getPlateforme=function(){return t.Promesses.createPromiseSelfResolved(n.PLATEFORME.MYSYS)},o=i,n.MobiliteApiSIRIS=o}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.ContexteClient)||this}t=e.Services||(e.Services={}),n=t.ContexteClient||(t.ContexteClient={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.nouveauContexte=function(e){return this.manager.nouveauContexte(e).getId()},i.prototype.detruireContexte=function(e){return this.manager.detruireContexte("portail",e)},i.prototype.changerContexteClientDunProcessus=function(e,t){this.manager.changeContexteOfProcess("portail",t,e)},i.prototype.getClientDuContexte=function(e){return this.manager.getClient(e)},i.prototype.setClientDuContexte=function(e,t){return this.manager.setClient("portail",t,e)},i.prototype.getModeDuContexte=function(e){return this.manager.getMode(e)},i.prototype.setModeDuContexte=function(e,t){this.manager.changeContexteMode(e,t)},i.prototype.getContextes=function(){var t=[];return this.manager.getContextes().forEach(function(e){t.push(e.getId())}),t},i.prototype.getProcessusDuContexte=function(e){var t=[];return this.manager.getListeProcessus(e).forEach(function(e){t.push(e.id)}),t},i.prototype.getProprieteDuContexte=function(e,t){return this.manager.getProperty(t,e)},i.prototype.setProprieteDuContexte=function(e,t,n){return this.manager.setProperty("portail",t,n,e)},i.prototype.ajouterAListeDuContexte=function(e,t,n){return this.manager.addToList("portail",t,n,e)},i.prototype.retirerDeListeDuContexte=function(e,t){return this.manager.removeFromList("portail",t,e)},i.prototype.supprimerProprieteDuContexte=function(e,t){return this.manager.deleteProperty("portail",t,e)},o=i,n.ContexteClientManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.ContexteClient)||this}t=e.Services||(e.Services={}),n=t.ContexteClient||(t.ContexteClient={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.onGetContextesParClients=function(){return this.managerInstance.getContextesParClientsAsync().then(function(e){return{ids:e}})},i.prototype.onGetId=function(){var t=this;return this.library.Core.promesseTryCatch(function(e){e.resolve({id:t.managerInstance.getCurrentContexteClient().getId()})})},i.prototype.onGetClient=function(){var t=this;return this.library.Core.promesseTryCatch(function(e){e.resolve({id:t.managerInstance.getCurrentContexteClient().getClient()})})},i.prototype.onSetClient=function(t){var n=this;return this.library.Core.promesseTryCatch(function(e){n.managerInstance.setClient(t.expediteur,t.client,t.idContexteClient),e.resolve()})},i.prototype.onGetContenu=function(e){return this.managerInstance.getContenu(e.idClient).then(function(e){return{valeur:e}})},i.prototype.onGetProperty=function(e){return this.managerInstance.getProperty(e.cle,e.idContexteClient).then(function(e){return{valeur:e}})},i.prototype.onAddToList=function(e){return this.managerInstance.addToList(e.expediteur,e.cle,e.valeur,e.idContexteClient).then(function(e){return{estOk:e}})},i.prototype.onSetContenu=function(e){return this.managerInstance.setContenu(e.expediteur,e.idClient,e.valeur).then(function(e){return{estOk:e}})},i.prototype.onSetReloadSynthese=function(e){return this.managerInstance.setReloadSynthese(e.expediteur,e.idClient).then(function(e){return{estOk:e}})},i.prototype.onSetProperty=function(e){return this.managerInstance.setProperty(e.expediteur,e.cle,e.valeur,e.idContexteClient).then(function(e){return{estOk:e}})},i.prototype.onRemoveFromList=function(e){return this.managerInstance.removeFromList(e.expediteur,e.cle,e.idContexteClient).then(function(e){return{estOk:e}})},i.prototype.onDeleteProperty=function(e){return this.managerInstance.deleteProperty(e.expediteur,e.cle,e.idContexteClient).then(function(e){return{estOk:e}})},i.prototype.onGetContextes=function(){var t=[];return this.managerInstance.getContextesAsync().then(function(e){return e.forEach(function(e){t.push(e.getId())}),{idContextes:t}})},i.prototype.onDestroyContext=function(t){var n=this;return this.library.Core.promesseTryCatch(function(e){e.resolve({isDestroy:n.managerInstance.detruireContexte(t.expediteur,t.idContexte)})})},i.prototype.onNewContexte=function(t){var n=this;return this.library.Core.promesseTryCatch(function(e){e.resolve({idContexte:n.managerInstance.nouveauContexte(t.idClient).getId()})})},i.prototype.onChangeContexteProcess=function(t){var n=this;return this.library.Core.promesseTryCatch(function(e){n.managerInstance.changeContexteOfProcess(t.expediteur,t.codeProcessus,t.idContexte),e.resolve()})},i.prototype.onChangeContexteMode=function(t){var n=this;return this.library.Core.promesseTryCatch(function(e){n.managerInstance.changeContexteMode(t.idContexte,t.mode),e.resolve()})},i.prototype.onDetailsContexte=function(t){var n=this;return this.library.Core.promesseTryCatch(function(e){e.resolve(n.managerInstance.getDetailsContexte(t.idContexte))})},i.prototype.reception=function(e){var t=null;switch(e.subject){case n.ContextClientMessageSubject.GetContextesParClients:t=this.onGetContextesParClients;break;case n.ContextClientMessageSubject.GetId:t=this.onGetId;break;case n.ContextClientMessageSubject.GetClient:t=this.onGetClient;break;case n.ContextClientMessageSubject.SetClient:t=this.onSetClient;break;case n.ContextClientMessageSubject.GetProperty:t=this.onGetProperty;break;case n.ContextClientMessageSubject.AddToList:t=this.onAddToList;break;case n.ContextClientMessageSubject.SetProperty:t=this.onSetProperty;break;case n.ContextClientMessageSubject.RemoveFromList:t=this.onRemoveFromList;break;case n.ContextClientMessageSubject.DeleteProperty:t=this.onDeleteProperty;break;case n.ContextClientMessageSubject.GetContenu:t=this.onGetContenu;break;case n.ContextClientMessageSubject.SetContenu:t=this.onSetContenu;break;case n.ContextClientMessageSubject.SetReloadSynthese:t=this.onSetReloadSynthese;break;case n.ContextClientMessageSubject.GetContextes:t=this.onGetContextes;break;case n.ContextClientMessageSubject.DestroyContext:t=this.onDestroyContext;break;case n.ContextClientMessageSubject.NewContext:t=this.onNewContexte;break;case n.ContextClientMessageSubject.ChangeContextProcess:t=this.onChangeContexteProcess;break;case n.ContextClientMessageSubject.ChangeContextMode:t=this.onChangeContexteMode;break;case n.ContextClientMessageSubject.DetailsContext:t=this.onDetailsContexte;break;default:return r.prototype.reception.call(this,e)}return t.call(this,e.message)},i.CLASS_NAME="MyWay.Services.Context.ContexteClientManagerMessage",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.ContexteClientManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var l,a,o,t;function p(){var e=o.call(this,l.Components.ComponentType.Fichier)||this;return e.api=null,e}l=e.Services||(e.Services={}),a=l.Fichier||(l.Fichier={}),o=l.Components.ComponentManagerBase,__extends(p,o),p.prototype.init=function(e,t,n,r){return this.api=r,o.prototype.init.call(this,e,t,n,r)},p.prototype.saveAs=function(e,t,n,r){var o=this;if(void 0===r&&(r=a.TYPE_DONNEES_A_SAUVER.BLOB),null==e){var i=new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FICHIER_PARAMETRE_DATA_VIDE);return l.Loggers.FLASH.INSTANCE.setValue("action","saveAs"),this.library.Libelle.constituerLibelle(i.codeLibelle).then(function(e){p.logger.error(e)}),l.Promesses.createPromiseSelfError(i)}var s=e;return l.Promesses.getPromesseSelfResoved().then(function(){return!r||r!==a.TYPE_DONNEES_A_SAUVER.BASE64||o.b64toBlob(e,null,null).then(function(e){return s=e,!0})}).then(function(e){if(e)return o.api.save(s,o.getFormatFichier(t),n)})},p.prototype.b64toBlob=function(e,t,n){if(void 0===t&&(t=null),void 0===n&&(n=null),!l.Controle.StaticStringControle.isStringNotEmptyOrNull(e)){var r=new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FICHIER_PARAMETRE_B64_VIDE);return l.Loggers.FLASH.INSTANCE.setValue("action","saveAsb64toBlob"),this.library.Libelle.constituerLibelle(r.codeLibelle).then(function(e){p.logger.error(e)}),l.Promesses.createPromiseSelfError(r)}null===t&&(t="application/pdf"),null===n&&(n=512);for(var o=atob(e),i=[],s=0;s<o.length;s+=n){for(var a=o.slice(s,s+n),c=new Array(a.length),u=0;u<a.length;u++)c[u]=a.charCodeAt(u);i.push(new Uint8Array(c))}return l.Promesses.createPromiseSelfResolved(new Blob(i,{type:t}))},p.prototype.getFormatFichier=function(e){var t;switch(e){case a.TYPE_FICHIER.PDF:case a.TYPE_FICHIER.PDF_EMBED:case a.TYPE_FICHIER.PDFA_1A:case a.TYPE_FICHIER.PDFA_1B:case a.TYPE_FICHIER.PDFX_1_2001:case a.TYPE_FICHIER.PDFX_1A_2001:case a.TYPE_FICHIER.PDFX_1A_2003:case a.TYPE_FICHIER.PDFX_3_2002:case a.TYPE_FICHIER.PDFX_3_2003:t="application/pdf";break;case a.TYPE_FICHIER.JSON:t="application/json";break;case a.TYPE_FICHIER.TAR_GZ:t="application/x-compressed";break;default:t="application/pdf"}return t},p.CLASS_NAME="MyWay.Services.Fichier.FichierManager",p.logger=l.Loggers.LoggerFactory.INSTANCE.getClass(p.CLASS_NAME),t=p,a.FichierManager=t,l.Components.RegistryManager.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var t,r,n;function o(){}t=e.Services||(e.Services={}),r=t.DonneesDelocalisees||(t.DonneesDelocalisees={}),o.actionOnDB=function(n){var e=window.indexedDB.open("myway_stc_donneesdelocalisees",o.DB_VERSION);e.onupgradeneeded=function(e){var t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(r.DonneesDelocaliseesTDTDB.TABLE_NOM,{autoIncrement:!1,keyPath:"id"}),t.createObjectStore(r.DonneesDelocaliseesTableDB.TABLE_NOM,{autoIncrement:!1,keyPath:"id"})}},e.onsuccess=function(e){var t=e.target.result;n(t)}},o.DB_VERSION=1,o.DB_NAME="myway_stc_donneesdelocalisees",n=o,r.DBDonneesDelocs=n}(MyWay=MyWay||{}),function(e){var l;(function(c){var i,s;l.ServiceManager.addActionOnInitialize("DonneesDelocalisees.openIDBAndGetDistantTDTAndCloseIDB",function(e){return e.DonneesDelocalisees.openIDBAndGetDistantTDTAndCloseIDB(null).then(function(){l.Loggers.FLASH.INSTANCE.setValue("action","Initialize()"),l.ServiceManager.logger.debug("Pré-chargement TDT OK!")},function(e){l.Loggers.FLASH.INSTANCE.setValue("action","Initialize()"),l.Loggers.FLASH.INSTANCE.setValue("details",e),l.ServiceManager.logger.warn("Impossible de pré-charger la TDT: %1 / %2",e.codeLibelle,e.valeurs)})},"Habilitation.ObtenirHabilitations");var a,e=(a=l.Components.ComponentManagerBase,__extends(u,a),u.prototype.init=function(e,t,n,r){var o=this;return this.api=r,i=l.PrivatePortalServiceParameters.Instance().DonneesDelocaliseesUrl+"tableDesTables",s=l.PrivatePortalServiceParameters.Instance().DonneesDelocaliseesUrl+"objetDelocalise",a.prototype.init.call(this,e,t,n,r).then(function(){return l.BaseDeDonnees.Generique.Factory.testImplementationIndexeddb(!0).then(function(e){o.dbTDT=new c.DonneesDelocaliseesTDTDB(e,o.library),o.dbTable=new c.DonneesDelocaliseesTableDB(e,o.library);var t={version:c.DBDonneesDelocs.DB_VERSION,implementation:e?l.BaseDeDonnees.BaseDeDonneesImplementation.INDEXEDDB:l.BaseDeDonnees.BaseDeDonneesImplementation.MEMORY,getTable:function(e){switch(e){case c.DonneesDelocaliseesTDTDB.TABLE_NOM:return o.dbTDT;case c.DonneesDelocaliseesTableDB.TABLE_NOM:return o.dbTable;default:return null}},getTables:function(){return[c.DonneesDelocaliseesTDTDB.TABLE_NOM,c.DonneesDelocaliseesTableDB.TABLE_NOM]}};o.library.BaseDeDonnees.enregistrerDB("DonneesDelocalisees",t)})})},u.prototype.getDonneesDelocalisees=function(e,t){var n=l.CoreCommon.ServiceDePromesse.defer(),r="";return l.Controle.StaticStringControle.isStringNotEmptyOrNull(e)||(r+="Le paramètre 'numEtablissement' doit être une chaine de caractères non vide ou null / "),l.Controle.StaticStringControle.isStringNotEmpty(t)||(r+="Le paramètre 'objectDataName' est obligatoire et doit être une chaine de caractères non vide / "),""!=r?(r=r.substring(0,r.lastIndexOf("/")-1),l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesDelocalisees"),u.logger.error(r),n.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[r]))):null===e&&null===(e=this._getCodeEtablissement(n.reject))||(l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesDelocalisees"),u.logger.debug("Début récupération '%1' (%2) avec support DB",t,e),this.getDonneesDelocaliseesIDB(e,t).then(function(e){l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesDelocalisees"),u.logger.debug("Fin récupération objet '%1' OK",e.id),n.resolve(e)},function(e){l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesDelocalisees"),u.logger.debug("Fin récupération objet KO: %1",e.libelle),n.reject(e)})),n.promise},u.prototype.getListeDonneesDelocalisees=function(n,e){var r=this,o=l.CoreCommon.ServiceDePromesse.defer(),t="";if(l.Controle.StaticStringControle.isStringNotEmptyOrNull(n)||(t+="Le paramètre 'numEtablissement' doit être une chaine de caractères non vide ou null / "),l.Controle.StaticArrayControle.isArray(e)||(t+="Le paramètre 'objectDataNames' est obligatoire et doit être un tableau d'objets de type String / "),""!=t)return t=t.substring(0,t.lastIndexOf("/")-1),l.Loggers.FLASH.INSTANCE.setValue("action","getListeDonneesDelocalisees"),u.logger.error(t),o.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[t])),o.promise;if(null===n&&null===(n=this._getCodeEtablissement(o.reject)))return o.promise;var i=!1,s=e.length,a=[],c=0;return e.forEach(function(e,t){r.getDonneesDelocalisees(n,e).then(function(e){a[t]=e,++c===s&&o.resolve(a)},function(e){i||(i=!0,o.reject(e))})}),o.promise},u.prototype.getRubriqueLibelle=function(e,i,s){var a=l.CoreCommon.ServiceDePromesse.defer(),t="";return l.Controle.StaticStringControle.isStringNotEmptyOrNull(e)||(t+="Le paramètre 'numEtablissement' doit être une chaine de caractères non vide ou null / "),l.Controle.StaticStringControle.isStringNotEmpty(i)||(t+="Le paramètre 'objectDataName' est obligatoire et doit être une chaine de caractères non vide / "),l.Controle.StaticStringControle.isStringNotEmpty(s)||(t+="Le paramètre 'code' est obligatoire et doit être une chaine de caractères non vide / "),""!=t?(t=t.substring(0,t.lastIndexOf("/")-1),l.Loggers.FLASH.INSTANCE.setValue("action","getRubriqueLibelle"),u.logger.error(t),a.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[t]))):null===e&&null===(e=this._getCodeEtablissement(a.reject))||this.getDonneesDelocalisees(e,i).then(function(e){if("rubrique"===e.referentiel){l.Loggers.FLASH.INSTANCE.setValue("action","getRubriqueLibelle"),u.logger.debug("L'objet de données '%1' est bien une rubrique",i);for(var t=e.donnees.length,n=null,r=0;r<t;r++)if(e.donnees[r].Key===s){n=e.donnees[r].Value;break}if(n)l.Loggers.FLASH.INSTANCE.setValue("action","getRubriqueLibelle"),u.logger.debug("Récupération du libellé du code '%1' : '%2'",s,n),a.resolve(n);else{l.Loggers.FLASH.INSTANCE.setValue("action","getRubriqueLibelle");var o="Le code '"+s+"' n'a pas été trouvé dans la rubrique '"+i+"'";u.logger.error(o),a.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[o]))}}else l.Loggers.FLASH.INSTANCE.setValue("action","getRubriqueLibelle"),o="L'objet de données '"+i+"' n'est pas une rubrique",u.logger.error(o),a.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[o]))},function(e){l.Loggers.FLASH.INSTANCE.setValue("action","getRubriqueLibelle"),u.logger.error("Erreur lors de la récupération de la rubrique '%1'",i),a.reject(e)}),a.promise},u.prototype.getDonneesParCriteres=function(t,n,i){var r=l.CoreCommon.ServiceDePromesse.defer(),e="";return l.Controle.StaticStringControle.isStringNotEmptyOrNull(t)||(e+="Le paramètre 'numEtablissement' doit être une chaine de caractères non vide ou null / "),l.Controle.StaticStringControle.isStringNotEmpty(n)||(e+="Le paramètre 'objectDataName' est obligatoire et doit être une chaine de caractères non vide / "),l.Controle.StaticArrayControle.isArray(i)||(e+="Le paramètre 'criteres' est obligatoire et doit être un tableau d'objets de type ObjectDataCritere / "),""!=e?(e=e.substring(0,e.lastIndexOf("/")-1),l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesParCriteres"),u.logger.error(e),r.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[e]))):null===t&&null===(t=this._getCodeEtablissement(r.reject))||this.getDonneesDelocalisees(t,n).then(function(e){try{var o=[],t=l.Donnees.StaticArrayExtension.filtrer(e.donnees,function(n){var r=!0;return i.forEach(function(e){if(!n.hasOwnProperty(e.propriete)){var t="L'objet de données ne contient pas la propriété '"+e.propriete+"'";return l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesParCriteres"),u.logger.error(t),o.push(e.propriete),r=null,!1}switch(e.operateur){case c.CRITERES_OPERATEUR.CONTIENT:-1===n[e.propriete].indexOf(e.valeur)&&(r=!1);break;default:n[e.propriete]!==e.valeur&&(r=!1)}if(!r)return!1}),r});l.Controle.StaticArrayControle.isArray(t)?r.resolve(t):r.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_DONNEESDELOC_PROPRIETE_ABSENTE,o))}catch(e){r.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_DONNEESDELOC_OBJET_MAL_FORME,[e]))}},function(e){l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesParCriteres"),u.logger.error("Erreur lors de la récupération de l'objet de données '%1' pour l'établissement '%2'",n,t),r.reject(e)}),r.promise},u.prototype.openIDBAndGetDistantTDTAndCloseIDB=function(e){var t=l.CoreCommon.ServiceDePromesse.defer(),n="";return l.Controle.StaticStringControle.isStringNotEmptyOrNull(e)||(n+="Le paramètre 'numEtablissement' doit être une chaine de caractères non vide ou null / "),""!=n?(n=n.substring(0,n.lastIndexOf("/")-1),l.Loggers.FLASH.INSTANCE.setValue("action","openIDBAndGetDistantTDTAndCloseIDB"),u.logger.error(n),t.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[n]))):null===e&&null===(e=this._getCodeEtablissement(t.reject))||(l.Loggers.FLASH.INSTANCE.setValue("action","openIDBAndGetDistantTDTAndCloseIDB"),u.logger.debug("Le navigateur supporte IndexedDB"),l.Loggers.FLASH.INSTANCE.setValue("action","openIDBAndGetDistantTDTAndCloseIDB"),u.logger.debug("Début récupération TDT (%1) avec support IndexedDB",e),this.getTDTIDB(e).then(t.resolve,t.reject)),t.promise},u.prototype._getCodeEtablissement=function(e){var t=null,n=this.library.Context.GetAuthentificationInfo();if(n&&(t=n.codeEtablissement),l.Controle.StaticStringControle.isStringNotEmpty(t))return t;var r=new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_CONTEXTE_RECUP_CODE_ETAB_IMPOSSIBLE);return l.Loggers.FLASH.INSTANCE.setValue("action","_getCodeEtablissement"),this.library.Libelle.constituerLibelle(r.codeLibelle).then(function(e){u.logger.error(e)}),e(r),null},u.prototype.getDonneesDelocaliseesIDB=function(n,r){var o=this,i=l.CoreCommon.ServiceDePromesse.defer();return this.getTDTIDB(n).then(function(e){var t=o.getRefData(e,r);t?(l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesDelocaliseesIDB"),u.logger.debug("Date de dernière mise à jour de l'objet de données '%1' dans la TDT '%2': %3",r,n,t.datemaj),o.getObjectDataIDB(n,t).then(function(e){i.resolve(e)},function(e){i.reject(e)})):(l.Loggers.FLASH.INSTANCE.setValue("action","getDonneesDelocaliseesIDB"),u.logger.error("Impossible de récupérer la date de dernière mise à jour de l'objet de données '%1' dans la TDT '%2'",r,n),i.reject(new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_DONNEESDELOC_RECUP_DERNMAJ_IMPOSSIBLE,[r,n])))},i.reject),i.promise},u.prototype.getTDTIDB=function(o){var i=this;return this.dbTDT.get([o]).then(function(e){var t,n=i.library.Dates.getDateDuJour(l.Dates.FORMATS_DATE.aaaammjj);if(e[0]){var r=e[0].element;return t=r.datemaj,l.Loggers.FLASH.INSTANCE.setValue("action","getTDTIDB"),u.logger.debug("Date de dernière mise à jour de la TDT '%1': %2",o,t),t<n?i.getDistantTDT(o):r}return i.getDistantTDT(o)})},u.prototype.getDistantTDT=function(t){var n=this,e={};e.method=l.MethodEnum.GET,e.url=i,e.params={codeEtablissement:t},e.withHeaders=!0;var r=null;return this.api.getDistantTDT(e).then(function(e){return r=e,n.dbTDT.mettreAJour([{cle:r.id,element:r}])}).then(function(){return l.Loggers.FLASH.INSTANCE.setValue("action","getDistantTDT"),u.logger.debug("La TDT '%1' a bien été mise à jour dans le store %2",t,c.DonneesDelocaliseesTDTDB.TABLE_NOM),r}).catch(function(e){if(r)return l.Loggers.FLASH.INSTANCE.setValue("action","getDistantTDT"),u.logger.error("La TDT '%1' n'a pas été mise à jour dans le store %2",t,c.DonneesDelocaliseesTDTDB.TABLE_NOM),r;throw l.Loggers.FLASH.INSTANCE.setValue("action","getDistantTDT"),u.logger.error("Impossible de récupérer la TDT '%1' auprès du serveur distant",t),e})},u.prototype.getObjectDataIDB=function(r,o){var i=this,s=o.referentiel+"-"+o.nom,a=null;return this.dbTable.get([s]).then(function(e){if(e[0]){var t=e[0].element,n=(a=t).datemaj;return l.Loggers.FLASH.INSTANCE.setValue("action","getObjectDataIDB"),u.logger.debug("Date de dernière mise à jour de l'objet de données '%1' dans le store %2: %3",s,c.DonneesDelocaliseesTableDB.TABLE_NOM,n),n<o.datemaj?i.getDistantObjectData(r,o.nom):t}return i.getDistantObjectData(r,o.nom)}).catch(function(e){if("O"===o.utildonneesperimees)return l.Loggers.FLASH.INSTANCE.setValue("action","getObjectDataIDB"),u.logger.error("Impossible de récupérer l'objet de données '%1' mis à jour le '%2' du central. L'objet du store local mis à jour le '%3' sera utilisé",s,o.datemaj,null),a;throw e})},u.prototype.getDistantObjectData=function(e,t){var n=this,r={};r.method=l.MethodEnum.GET,r.url=s,r.params={codeEtablissement:e,nom:t},r.withHeaders=!0;var o=null;return this.api.getDistantObjectData(r).then(function(e){return o=e,n.dbTable.mettreAJour([{cle:e.id,element:e}])}).then(function(){return l.Loggers.FLASH.INSTANCE.setValue("action","getDistantObjectData"),u.logger.debug("L'objet de données '%1' a bien été mis à jour dans le store %2",t,c.DonneesDelocaliseesTableDB.TABLE_NOM),o},function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","getDistantObjectData"),u.logger.error("L'objet de données '%1' n'a pas été mis à jour dans le store %2",t,c.DonneesDelocaliseesTableDB.TABLE_NOM),e})},u.prototype.getRefData=function(e,t){for(var n=e.tables.length,r=0;r<n;r++)if(e.tables[r].nom===t)return e.tables[r];return null},u.prototype.reInitDbDonneesDelocalisees=function(){var e=this;return this.dbTDT.resetAll().then(function(){return e.dbTable.resetAll()})},u.prototype.getTDTById=function(e){return this.dbTDT.get([e]).then(function(e){return e[0]?e[0].element:null})},u.prototype.deleteTDTById=function(e){return this.dbTDT.supprimer([e])},u.prototype.getEnumCriteresOperateur=function(){var e=l.CoreCommon.ServiceDePromesse.defer();return e.resolve(c.CRITERES_OPERATEUR),e.promise},u.CLASS_NAME="MyWay.Services.DonneesDelocalisees.DonneesDelocaliseesManager",u.logger=l.Loggers.LoggerFactory.INSTANCE.getClass(u.CLASS_NAME),u);function u(){var e=a.call(this,l.Components.ComponentType.DonneesDelocalisees)||this;return e.api=null,e.dbTDT=null,e.dbTable=null,e}c.DonneesDelocaliseesManager=e,l.Components.RegistryManager.getInstance().register(e)})((l=e.Services||(e.Services={})).DonneesDelocalisees||(l.DonneesDelocalisees={}))}(MyWay=MyWay||{}),function(e){var l,n,t;function p(e,t){this.hasIndexedDb=e,this.library=t,this.memoryDB=[]}l=e.Services||(e.Services={}),n=l.DonneesDelocalisees||(l.DonneesDelocalisees={}),p.prototype.get=function(c){var u=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(a){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var o=t.objectStore(p.TABLE_NOM),i=[],s=function(t){if(t>=c.length)a.resolve(i);else{var n=c[t],r=o.get(n);r.onsuccess=function(e){r.result?i.push(u.elementToInstanceAvecCle(r.result)):(i.push(null),console.warn("Table "+n+" isn't found!")),s(t+1)},r.onerror=function(e){console.error(e),a.reject(new l.Erreur("Erreur lors de la récupération d'une Table de la base de données - Moment de la lecture"))}}};s(0)})});var e=[];return this.memoryDB.forEach(function(t){var n=null;c.every(function(e){return e===t.id&&(n=t),null===n}),e.push(u.elementToInstanceAvecCle(n))}),this.library.Core.createPromiseSelfResolved(e)},p.prototype.getAll=function(){var i=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(o){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(p.TABLE_NOM).openCursor(),r=[];n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;r.push(i.elementToInstanceAvecCle(n)),t.continue()}else o.resolve(r)},n.onerror=function(e){console.error(e),o.reject(new l.Erreur("Erreur lors de la récupération de l'ensemble des Table"))}})});var t=[];return this.memoryDB.forEach(function(e){t.push(i.elementToInstanceAvecCle(e))}),this.library.Core.createPromiseSelfResolved(t)},p.prototype.chercher=function(i){var s=this;if(!i)return this.getAll();if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(o){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(p.TABLE_NOM).openCursor(),r=[];n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;s.testTable(n,i)&&r.push(s.elementToInstanceAvecCle(n)),t.continue()}else o.resolve(r)},n.onerror=function(e){console.error(e),o.reject(new l.Erreur("Erreur lors de la recherche de Table"))}})});var t=[];return this.memoryDB.forEach(function(e){s.testTable(e,i)&&t.push(s.elementToInstanceAvecCle(e))}),this.library.Core.createPromiseSelfResolved(t)},p.prototype.count=function(e){return e||!this.hasIndexedDb?this.chercher(e).then(function(e){return e.length}):this.library.Core.promesseTryCatch(function(r){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(p.TABLE_NOM).count();n.onsuccess=function(){var e=n.result;r.resolve(e)},n.onerror=function(e){console.error(e),r.reject(new l.Erreur("Erreur lors du comptage du nombre de Table"))}})})},p.prototype.ajouter=function(s){var t=this;return this.hasIndexedDb?this.library.Core.promesseTryCatch(function(i){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(p.TABLE_NOM),o=function(e){if(e>=s.length)i.resolve();else{var t=s[e],n=r.add(t);n.onsuccess=function(){o(e+1)},n.onerror=function(e){console.error(e),i.reject(new l.Erreur("Erreur lors de la sauvegarde d'une Table"))}}};o(0)})}):(s.forEach(function(e){t.memoryDB.push(e)}),this.library.Core.getPromesseSelfResoved())},p.prototype.supprimer=function(s){if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(p.TABLE_NOM),o=function(t){if(t>=s.length)i.resolve();else{var e=s[t],n=r.delete(e);n.onsuccess=function(){o(t+1)},n.onerror=function(e){o(t+1)}}};o(0)})});var e=[];return this.memoryDB.forEach(function(t){var n=!1;s.every(function(e){return!(n=e===t.id)}),n||e.push(t)}),this.memoryDB=e,this.library.Core.getPromesseSelfResoved()},p.prototype.mettreAJour=function(s){var o=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(p.TABLE_NOM),o=function(e){if(e>=s.length)i.resolve();else{var t=s[e],n=r.put(t.element);n.onsuccess=function(){o(e+1)},n.onerror=function(e){console.error(e),i.reject(new l.Erreur("Erreur lors de la mise à jour d'une Table"))}}};o(0)})});var e=[];return s.forEach(function(n){var r=!1;o.memoryDB.every(function(e,t){return n.cle===e.id&&(o.memoryDB[t]=n.element,r=!0),!r}),r||e.push(n.element)}),0<e.length?this.ajouter(e):this.library.Core.getPromesseSelfResoved()},p.prototype.resetAll=function(){return this.hasIndexedDb?this.library.Core.promesseTryCatch(function(r){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(p.TABLE_NOM).clear();n.onsuccess=function(e){r.resolve()},n.onerror=function(e){console.error(e),r.reject(new l.Erreur("Erreur lors du reset de la base de données"))}})}):(this.memoryDB.length=0,this.library.Core.getPromesseSelfResoved())},p.prototype.testTable=function(e,t){return!!e.id.match(t)},p.prototype.elementToInstanceAvecCle=function(e){return e?{cle:e.id,element:e}:null},p.TABLE_NOM="TABLES",t=p,n.DonneesDelocaliseesTableDB=t}(MyWay=MyWay||{}),function(e){var l,n,t;function p(e,t){this.hasIndexedDb=e,this.library=t,this.memoryDB=[]}l=e.Services||(e.Services={}),n=l.DonneesDelocalisees||(l.DonneesDelocalisees={}),p.prototype.get=function(c){var u=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(a){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var o=t.objectStore(p.TABLE_NOM),i=[],s=function(t){if(t>=c.length)a.resolve(i);else{var n=c[t],r=o.get(n);r.onsuccess=function(e){r.result?i.push(u.elementToInstanceAvecCle(r.result)):(i.push(null),console.warn("TDT "+n+" isn't found!")),s(t+1)},r.onerror=function(e){console.error(e),a.reject(new l.Erreur("Erreur lors de la récupération d'une table de la base de données - Moment de la lecture"))}}};s(0)})});var e=[];return this.memoryDB.forEach(function(t){var n=null;c.every(function(e){return e===t.id&&(n=t),null===n}),e.push(u.elementToInstanceAvecCle(n))}),this.library.Core.createPromiseSelfResolved(e)},p.prototype.getAll=function(){var i=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(o){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(p.TABLE_NOM).openCursor(),r=[];n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;r.push(i.elementToInstanceAvecCle(n)),t.continue()}else o.resolve(r)},n.onerror=function(e){console.error(e),o.reject(new l.Erreur("Erreur lors de la récupération de l'ensemble des tables"))}})});var t=[];return this.memoryDB.forEach(function(e){t.push(i.elementToInstanceAvecCle(e))}),this.library.Core.createPromiseSelfResolved(t)},p.prototype.chercher=function(i){var s=this;if(!i)return this.getAll();if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(o){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(p.TABLE_NOM).openCursor(),r=[];n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;s.testTDT(n,i)&&r.push(s.elementToInstanceAvecCle(n)),t.continue()}else o.resolve(r)},n.onerror=function(e){console.error(e),o.reject(new l.Erreur("Erreur lors de la recherche de table"))}})});var t=[];return this.memoryDB.forEach(function(e){s.testTDT(e,i)&&t.push(s.elementToInstanceAvecCle(e))}),this.library.Core.createPromiseSelfResolved(t)},p.prototype.count=function(e){return e||!this.hasIndexedDb?this.chercher(e).then(function(e){return e.length}):this.library.Core.promesseTryCatch(function(r){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(p.TABLE_NOM).count();n.onsuccess=function(){var e=n.result;r.resolve(e)},n.onerror=function(e){console.error(e),r.reject(new l.Erreur("Erreur lors du comptage du nombre de table"))}})})},p.prototype.ajouter=function(s){var t=this;return this.hasIndexedDb?this.library.Core.promesseTryCatch(function(i){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(p.TABLE_NOM),o=function(e){if(e>=s.length)i.resolve();else{var t=s[e],n=r.add(t);n.onsuccess=function(){o(e+1)},n.onerror=function(e){console.error(e),i.reject(new l.Erreur("Erreur lors de la sauvegarde d'une table"))}}};o(0)})}):(s.forEach(function(e){t.memoryDB.push(e)}),this.library.Core.getPromesseSelfResoved())},p.prototype.supprimer=function(s){if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(p.TABLE_NOM),o=function(t){if(t>=s.length)i.resolve();else{var e=s[t],n=r.delete(e);n.onsuccess=function(){o(t+1)},n.onerror=function(e){o(t+1)}}};o(0)})});var e=[];return this.memoryDB.forEach(function(t){var n=!1;s.every(function(e){return!(n=e===t.id)}),n||e.push(t)}),this.memoryDB=e,this.library.Core.getPromesseSelfResoved()},p.prototype.mettreAJour=function(s){var o=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(p.TABLE_NOM),o=function(e){if(e>=s.length)i.resolve();else{var t=s[e],n=r.put(t.element);n.onsuccess=function(){o(e+1)},n.onerror=function(e){console.error(e),i.reject(new l.Erreur("Erreur lors de la mise à jour d'une table"))}}};o(0)})});var e=[];return s.forEach(function(n){var r=!1;o.memoryDB.every(function(e,t){return n.cle===e.id&&(o.memoryDB[t]=n.element,r=!0),!r}),r||e.push(n.element)}),0<e.length?this.ajouter(e):this.library.Core.getPromesseSelfResoved()},p.prototype.resetAll=function(){return this.hasIndexedDb?this.library.Core.promesseTryCatch(function(r){n.DBDonneesDelocs.actionOnDB(function(e){var t=e.transaction([p.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(p.TABLE_NOM).clear();n.onsuccess=function(e){r.resolve()},n.onerror=function(e){console.error(e),r.reject(new l.Erreur("Erreur lors du reset de la base de données"))}})}):(this.memoryDB.length=0,this.library.Core.getPromesseSelfResoved())},p.prototype.testTDT=function(e,t){return!!e.id.match(t)},p.prototype.elementToInstanceAvecCle=function(e){return e?{cle:e.id,element:e}:null},p.TABLE_NOM="TDT",t=p,n.DonneesDelocaliseesTDTDB=t}(MyWay=MyWay||{}),function(e){var t,s,a,n;function c(){return a.call(this,t.Components.ComponentType.Libelle)||this}t=e.Services||(e.Services={}),s=t.Libelle||(t.Libelle={}),a=t.Components.ComponentManagerMessageBase,__extends(c,a),c.prototype.constituerLibelle=function(e,t){return this.managerInstance.constituerLibelle(e,t)},c.prototype.reception=function(e){switch(e.subject){case s.LibelleMessageSubject.afficherMessage:var t=(i=e.message).codeLibelle,n=i.typeAffichage,r=i.valeurs,o=i.delai;return this.managerInstance.afficherMessageAsync(t,n,r,o).then(function(e){return c.logger.debug("afficherMessage Success : %1",JSON.stringify(e)),e});case s.LibelleMessageSubject.constituerLibelle:var i;return t=(i=e.message).codeLibelle,r=i.valeurs,this.managerInstance.constituerLibelle(t,r).then(function(e){return c.logger.debug("constituerLibelle Success : %1",e),e}).catch(function(e){throw c.logger.error("constituerLibelle Failed : %1",JSON.stringify(e)),e});default:return a.prototype.reception.call(this,e)}},c.CLASS_NAME="MyWay.Services.Libelle.LibelleManagerMessage",c.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(c.CLASS_NAME),n=c,s.LibelleManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var r,o,i,t;function n(){return i.call(this,r.Components.ComponentType.Trace)||this}r=e.Services||(e.Services={}),o=r.Trace||(r.Trace={}),i=r.Components.ComponentManagerMessageBase,__extends(n,i),n.prototype.send=function(e,t){return this.managerInstance.send(e,t)},n.prototype.reception=function(e){switch(e.subject){case o.Messages.TraceMessageSubject.Tracer:var t=e.message;return this.managerInstance.traceModelToLogger(t.trace),this.library.Core.getPromesseSelfResoved();case o.Messages.TraceMessageSubject.Logger:return t=e.message,this.managerInstance.traceToLogger(t.log),this.library.Core.getPromesseSelfResoved();case o.Messages.TraceMessageSubject.GetIntervallePurge:return t=e.message,this.library.Core.createPromiseSelfResolved(o.INTERVALLE_PURGE);case o.Messages.TraceMessageSubject.GetQuotaPurge:return t=e.message,this.library.Core.createPromiseSelfResolved(o.QUOTA_PURGE);case o.Messages.TraceMessageSubject.PurgerTraces:return t=e.message,this.managerInstance.purgerTraces(),this.library.Core.getPromesseSelfResoved();case o.Messages.TraceMessageSubject.SendDiagnostic:t=e.message;var n=new r.ApplicationDiagnostic;return n.clone(t.diagnostic),this.managerInstance.sendDiagnostic(n),this.library.Core.getPromesseSelfResoved();case o.Messages.TraceMessageSubject.SetModeDebug:return t=e.message,this.managerInstance.setModeDebug(t.active),this.library.Core.getPromesseSelfResoved();case o.Messages.TraceMessageSubject.ReInitDbTraces:return t=e.message,this.managerInstance.resetDB();default:return i.prototype.reception.call(this,e)}},n.CLASS_NAME="MyWay.Services.Trace.TraceManagerMessage",n.logger=r.Loggers.LoggerFactory.INSTANCE.getClass(n.CLASS_NAME),t=n,o.TraceManagerMessage=t,r.Components.RegistryManagerMessage.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var r,t,n,o;function i(){return n.call(this,r.Components.ComponentType.Trace)||this}r=e.Services||(e.Services={}),t=r.Trace||(r.Trace={}),n=r.Components.ComponentManagerExtendedBase,__extends(i,n),i.prototype.debug=function(e,t,n){r.Loggers.FLASH.INSTANCE.setValue("action",t),r.Loggers.FLASH.INSTANCE.setValue("details",n),i.logger.debug(e)},i.prototype.info=function(e,t,n){r.Loggers.FLASH.INSTANCE.setValue("action",t),r.Loggers.FLASH.INSTANCE.setValue("details",n),i.logger.info(e)},i.prototype.warning=function(e,t,n){r.Loggers.FLASH.INSTANCE.setValue("action",t),r.Loggers.FLASH.INSTANCE.setValue("details",n),i.logger.warn(e)},i.prototype.error=function(e,t,n){r.Loggers.FLASH.INSTANCE.setValue("action",t),r.Loggers.FLASH.INSTANCE.setValue("details",n),i.logger.error(e)},i.prototype.send=function(e){this.manager.send(e)},i.CLASS_NAME="MyWay.Services.Trace.TraceManagerExtended",i.logger=r.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,t.TraceManagerExtended=o,r.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(r){var o,p,i,e;function f(){var e=i.call(this,o.Components.ComponentType.Aide)||this;return e.ClePreferenceModaleAide="AideModalePush",e._listeCodesEtapesVues=[],e}o=r.Services||(r.Services={}),p=o.Aide||(o.Aide={}),i=o.Components.ComponentManagerBase,__extends(f,i),f.prototype.init=function(e,t,n,r){return this.api=r,i.prototype.init.call(this,e,t,n,r)},f.prototype.displayAideFlash=function(r){var o=this;if(r){if(!r.dateTraitement){var e=new Date(Date.now()),t=e.getDate().toString();t[1]||(t="0"+t[0]);var n=(e.getMonth()+1).toString();n[1]||(n="0"+n[0]);var i=e.getFullYear().toString();r.dateTraitement=i+"-"+n+"-"+t}if(!r.codeEtablissement){var s=this.library.Context.GetAuthentificationInfo();s&&(r.codeEtablissement=s.codeEtablissement)}this.api.GetAideFlash(r).then(function(n){n&&o.lireEtapesDansPreference(function(e){if(e){var t={codeEtape:r.codeEtape,idFlashCode:n.id};o._listeCodesEtapesVues&&null!=o.aidePrefExist(t,o._listeCodesEtapesVues)&&(n=null)}n&&o.library.Display.AfficherModalAide(n.titre,n.contenu,r.codeEtape,n.id)}),f.logger.debug("GetAideFlash success")},function(e){f.logger.error("GetAideFlash Failed - %1",JSON.stringify(e))}),f.logger.debug("DisplayAideFlash success")}else f.logger.error("DisplayAideFlash error : le paramètre params est null ou undefined")},f.prototype.lireEtapesDansPreference=function(t){var n=this;this.library.Preferences.LirePreference(this.ClePreferenceModaleAide).then(function(e){if(e)try{f.logger.debug("LirePreference success - %1",e),n._listeCodesEtapesVues=JSON.parse(e)}catch(e){return f.logger.error("LirePreference : JSON parse of the result Failed - %1",e),void t(!1)}t(!0)},function(){f.logger.error("LirePreference Failed - ClePreferenceModaleAide : %1",n.ClePreferenceModaleAide),t&&t(!1)})},f.prototype.ajouterEtapeDansPreference=function(n){var r=this;this.lireEtapesDansPreference(function(e){if(e){if(r._listeCodesEtapesVues){if(null!=r.aidePrefExist(n,r._listeCodesEtapesVues))return}else r._listeCodesEtapesVues=[];null!=r.aidePrefExistForOnlyCodeEtape(n,r._listeCodesEtapesVues)&&o.CoreCommon.ArrayUtils.remove(r._listeCodesEtapesVues,function(e){return e.codeEtape===n.codeEtape}),r._listeCodesEtapesVues.push(n);var t=[{cle:r.ClePreferenceModaleAide,valeur:JSON.stringify(r._listeCodesEtapesVues)}];r.library.Preferences.EcrirePreference(t),f.logger.debug("AjouterEtapeDansPreference success")}})},f.prototype.aidePrefExistForOnlyCodeEtape=function(e,t){var n=[];return n.push({Key:p.CODE_ETAPE_KEY,Value:e.codeEtape}),r.Services.CoreCommon.ObjectUtils.objectExistsByKeyValueList(n,t)},f.prototype.aidePrefExist=function(e,t){var n=[];return n.push({Key:p.CODE_ETAPE_KEY,Value:e.codeEtape}),n.push({Key:p.ID_FLASH_CODE_KEY,Value:e.idFlashCode}),r.Services.CoreCommon.ObjectUtils.objectExistsByKeyValueList(n,t)},f.prototype.GetContenuInfobulle=function(e){var n=this;return this.api.GetContenuInfobulle(e).then(function(e){return e?(t=new p.DetailInfobulleAfficheeResult(e.nomChamp,e.nouveaute,n.ValoriserMessage(e.token,e.contenu),e.image),f.logger.debug("GetContenuInfobulle success- %1",JSON.stringify(t)),t):null;var t},function(e){throw f.logger.error("GetContenuInfobulle Failed - %1",JSON.stringify(e)),e})},f.prototype.GetInfobullesAffichables=function(e){var o=this;return this.api.GetInfobullesAffichables(e).then(function(e){if(!e)return null;var t=new Array,n=new Array;n=e;for(var r=0;r<n.length;r++)t.push(new p.InfobulleAfficheeResult(n[r].nomChamp,o.DeterminerNouveaute(n[r].dateFinNouveaute,n[r].nouveaute)));return f.logger.debug("GetInfobullesAffichables success- %1",JSON.stringify(t)),t},function(e){throw f.logger.error("GetInfobullesAffichables Failed - %1",JSON.stringify(e)),e})},f.prototype.getParametresContexte=function(e,t,n,r){var o;o=new p.DetailInfobulleAfficheeParametres;var i,s=new Date,a=("0"+s.getUTCDate()).slice(-2),c=("0"+(s.getMonth()+1)).slice(-2),u=s.getUTCFullYear().toString();if(o.dateTraitement=u+"-"+c+"-"+a,o.idChampLie=null!=e?e:"",null!=(i=this.library.Context.GetAuthentificationInfo())?o.codeEtablissement=i.codeEtablissement:(o.codeEtablissement=null,f.logger.debug("code Etablissement non récupéré à partir de GetAuthentificationInfo() => valorisé à null")),o.codeEtape=null,!(o.pointEntree=null)===t)return o.codeProcessus=null,o;if(null!=n)return o.codeProcessus=n,null!=r&&(o.codeEtape=r),o;if(o.codeProcessus=this.library.Context.GetCurrentProcessCode(),void 0===o.codeProcessus)o.codeProcessus=null;else if(null!==o.codeProcessus){var l=this.library.Context.GetCurrentStep(this.library.Context.GetCurrentProcess());null!=l&&(o.codeEtape=l.codeEtape)}return o},f.prototype.ValoriserMessage=function(e,t){var n=t;return e&&(n=this.RemplacerTokens(t)),n},f.prototype.RemplacerTokens=function(e){var t=e;if(null!=e){for(var n=new Array,r=0,o="";0<=r;)if(t.length>=r+o.length&&(r=t.indexOf(f.INDICATEUR_DE_TOKEN,r+o.length)),0<=r)if(0<=t.indexOf(f.INDICATEUR_DE_TOKEN,r+f.INDICATEUR_DE_TOKEN.length)){var i="";null!=(o=t.substr(r,t.indexOf(f.INDICATEUR_DE_TOKEN,r+f.INDICATEUR_DE_TOKEN.length)+f.INDICATEUR_DE_TOKEN.length-r))&&(i=o.substr(f.INDICATEUR_DE_TOKEN.length,o.length-2*f.INDICATEUR_DE_TOKEN.length)),n.indexOf(i)<0&&n.push(i)}else r=-1;if(0<n.length)for(var s=this.library.Context.GetListFromContext(n),a=0;a<s.length;a++)t=t.replace(new RegExp(f.INDICATEUR_DE_TOKEN+s[a].Key+f.INDICATEUR_DE_TOKEN,"g"),s[a].Value)}return f.logger.debug("RemplacerTokens Success: %1",t),t},f.prototype.DeterminerNouveaute=function(e,t){var n=t;if(null!=e&&10==e.length&&!isNaN(Number(e.substr(6,4)))&&!isNaN(Number(e.substr(3,2)))&&!isNaN(Number(e.substr(0,2)))){var r,o=new Date,i=("0"+(o.getMonth()+1)).slice(-2),s=("0"+o.getUTCDate()).slice(-2),a=o.getUTCFullYear().toString()+i+s;r=e.substr(6,4)+e.substr(3,2)+e.substr(0,2),n=!0===t&&!(r<a)}return f.logger.debug("DeterminerNouveaute Success : %1",n),n},f.INDICATEUR_DE_TOKEN="##",f.CLASS_NAME="MyWay.Services.Aide.AideManager",f.logger=o.Loggers.LoggerFactory.INSTANCE.getClass(f.CLASS_NAME),e=f,p.AideManager=e,o.Components.RegistryManager.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var t,s,a,n;function r(){return a.call(this,t.Components.ComponentType.Preferences)||this}t=e.Services||(e.Services={}),s=t.Preferences||(t.Preferences={}),a=t.Components.ComponentManagerMessageBase,__extends(r,a),r.prototype.reception=function(e){switch(e.subject){case s.PreferencesMessageSubject.LirePreference:var t=(o=e.message).nomVariable,n=o.isChargerServeur;return this.managerInstance.LirePreference(t,n).then(function(e){return{valeurVariable:e}});case s.PreferencesMessageSubject.EcrirePreference:var r=(o=e.message).preferences;return this.managerInstance.EcrirePreference(r);case s.PreferencesMessageSubject.LireMultiPreference:var o,i=(o=e.message).codesPreference;return this.managerInstance.LireMultiPreference(i);default:return a.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.Preferences.PreferencesManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,s.PreferencesManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Preferences)||this}t=e.Services||(e.Services={}),n=t.Preferences||(t.Preferences={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.LirePreference=function(e,t){return this.manager.LirePreference(e,t)},i.prototype.EcrirePreference=function(e,t){var n=[{cle:e,valeur:t}];return this.manager.EcrirePreference(n)},i.prototype.lireMultiPreference=function(e){return this.manager.LireMultiPreference(e).then(function(e){return e.preferences})},i.prototype.ecrireMultiPreference=function(e){return this.manager.EcrirePreference(e)},o=i,n.PreferencesManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgentExtended,"HabilitationTechAgent",{get:function(){return this._techLibrary.HabilitationTechAgent}})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgent,"HabilitationTechAgent",{get:function(){return this._techLibrary.HabilitationTechAgent}})}(MyWay=MyWay||{}),function(e){(e.Services||(e.Services={})).TechLibrary.addInitListener(function(e,t){e.HabilitationTechAgent=t.Habilitation})}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this)||this}t=e.Services||(e.Services={}),n=t.Habilitation||(t.Habilitation={}),r=n.HabilitationAgent,__extends(i,r),i.prototype.init=function(e,t,n){return e.HabilitationTech=this,r.prototype.init.call(this,e,t,n)},i.prototype.ObtenirHabilitations=function(){return this.sendMessage(n.HabilitationMessageSubject.ObtenirHabilitations,{})},i.prototype.ObtenirHabilitation=function(e){return this.sendMessage(n.HabilitationMessageSubject.ObtenirHabilitation,{code:e})},i.prototype.ModifierHabilitation=function(e,t){return this.sendMessage(n.HabilitationMessageSubject.ModifierHabilitation,{code:e,valeur:t})},i.prototype.ChargerHabilitations=function(){return this.sendMessage(n.HabilitationMessageSubject.ChargerHabilitations,{})},o=i,n.HabilitationTechAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),((n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})).Application="Application"}(MyWay=MyWay||{}),function(e){var t,n,r,o;t=e.Services||(e.Services={}),n=t.Application||(t.Application={}),r=n.Messages||(n.Messages={}),(o=r.ApplicationMessageSubject||(r.ApplicationMessageSubject={}))[o.Demarrer=0]="Demarrer",o[o.DemarrerProcessus=1]="DemarrerProcessus",t.Components.FactoryRegistries.getInstance().declareComponent(t.Components.ComponentType.Application,[t.Components.ComponentType.Context,t.Components.ComponentType.ContexteClient,t.Components.ComponentType.Core,t.Components.ComponentType.Display,t.Components.ComponentType.Evennements,t.Components.ComponentType.Lisa])}(MyWay=MyWay||{}),function(g){var h;(function(o){var s=function(e,t,n,r){if(this.Nom=e,this.LocalisationAbsolue=t,r)for(var o in r)this.LocalisationAbsolue=this.LocalisationAbsolue.replace("["+o+"]",r[o]);this.Type=n};o.LisaComposantApplicatif=s;var a=function(e,t,n,r,o,i){this.ComposantApplicatif=e,this.Nom=t,this.Code=n,this.Icone=r,this.LocalisationRelative=o,this.Type="PointDEntree",this.EstUnOutil=!1,null!=i&&(this.EstUnOutil=i)};o.LisaPointEntree=a;var c=function(e,t,n,r){this.Code=e,this.Nom=t,this.Type="Process",this.Options=n,this.Habilitation=r};o.LisaProcess=c;var u=function(e,t,n,r,o,i,s){this.ElementDeProcessus=t,this.InProcess=r,this.ValeurEntree=o,this.ValeurDepartProcessus=i,e?this.Code=e:(this.InProcess?this.Code=this.InProcess.Code+":":this.Code="",this.Code+=this.ElementDeProcessus.Code),this.Options=s,this.CodeMetier=n,this.Actions=[]};o.LisaEtape=u;var l=function(e,t,n,r,o,i,s){void 0===i&&(i=!1),void 0===s&&(s=null),this.Etape=e,this.ValeurSortie=t,this.VersEtape=n,this.EstExterne=r,this.NomExterne=o,this.FinProcess=i,this.ValeurFinProcess=s};o.LisaAction=l;var p=function(e,t,n,r,o,i){this.PointEntree=e,this.Code=t,this.Longueur=n,this.Type=i,this.Nullable=o,this.Mode=r};o.LisaContrat=p;var e=(t.prototype.initApi=function(e){this.libraryManager=e},t.prototype.addSettingsFromJSON=function(e,r){var t,n;n=h.PrivatePortalServiceParameters.Instance().LisaFileUrl?(t=h.PrivatePortalServiceParameters.Instance().LisaFileUrl,e?t+"/"+e:t):(t="/v1/data/lisa","/v1/data/lisa/"+e);var o=this,i=n+"/composants-applicatifs.json";h.CoreCommon.SendRequest({url:i,withHeaders:!1,async:!1,cache:!1},function(e){for(var t in o.composantsApplicatifs=[],e){var n=e[t];if(!n)throw"ca is null: url="+i;o.composantsApplicatifs[n.Nom]=new s(n.Nom,n.LocalisationAbsolue,n.Type,r)}},null),i=t+"/points-entrees.json",h.CoreCommon.SendRequest({url:i,withHeaders:!1,async:!1,cache:!1},function(e){for(var t in o.pointDEntrees=[],e){var n=e[t];o.pointDEntrees[n.Code]=new a(o.composantsApplicatifs[n.ComposantApplicatif],n.Nom,n.Code,n.Icone,n.LocalisationRelative,n.EstUnOutil)}},null),i=t+"/processus.json",h.CoreCommon.SendRequest({url:i,withHeaders:!1,async:!1,cache:!1},function(e){for(var t in o.processes=[],e){var n=e[t];o.processes[n.Code]=new c(n.Code,n.Nom,n.Options,n.Habilitation)}},null),i=t+"/etapes.json",h.CoreCommon.SendRequest({url:i,withHeaders:!1,async:!1,cache:!1},function(e){for(var t in o.etapes=[],e){var n=e[t],r=n.ElementDeProcessus.split("|");"PointDEntree"===r[1]?o.etapes[n.Code]=new u(n.Code,o.pointDEntrees[r[0]],n.CodeMetier,o.processes[n.InProcess],n.ValeurEntree,n.ValeurDepartProcessus,n.Options):o.etapes[n.Code]=new u(n.Code,o.processes[r[0]],n.CodeMetier,o.processes[n.InProcess],n.ValeurEntree,n.ValeurDepartProcessus,n.Options)}},null),i=t+"/actions.json",h.CoreCommon.SendRequest({url:i,withHeaders:!1,async:!1,cache:!1},function(e){for(var t in o.actions=[],e){var n=e[t],r=new l(o.etapes[n.Etape],n.ValeurSortie,o.etapes[n.VersEtape],n.EstExterne,n.NomExterne,n.FinProcess,n.ValeurFinProcess);o.actions.push(r),o.etapes[n.Etape].Actions.push(r)}},null),i=t+"/contrats.json",h.CoreCommon.SendRequest({url:i,withHeaders:!1,async:!1,cache:!1},function(e){for(var t in o.contrats=[],e){var n=e[t];o.contrats.push(new p(o.pointDEntrees[n.PointEntree],n.Code,n.Longueur,n.Mode,n.Nullable,n.Type))}},null),i=t+"/addons.json",h.CoreCommon.SendRequest({url:i,withHeaders:!1,async:!1,cache:!1},function(e){o.addOns=e},null)},t.prototype.next=function(e,t){var n=h.CoreCommon.ServiceDePromesse.defer();try{var r=null;for(var o in this.actions){var i=this.actions[o];if(i.Etape.Code===e&&i.ValeurSortie===t){if((r=new g.Services.Lisa.NextResult(null)).CodeEtape=e,r.ValeurSortie=t,i.FinProcess)r.FinProcess=!0,r.ValeurFinProcess=i.ValeurFinProcess;else if("PointDEntree"===i.VersEtape.ElementDeProcessus.Type){var s=this.setSequencePE(i.VersEtape);r.ProchaineEtape=s}else if("Process"===i.VersEtape.ElementDeProcessus.Type){var a=this.setSequencePR(i.VersEtape.ElementDeProcessus,i.VersEtape.ValeurEntree);for(var c in r.ProchaineEtape=a,r.ProcessDemarre=new h.Lisa.ProcessResult({Code:i.VersEtape.ElementDeProcessus.Code,Nom:i.VersEtape.ElementDeProcessus.Nom}),r.ProcessDemarre.EtapesConnues=this.getKnownSteps(i.VersEtape.ElementDeProcessus.Code),r.ProcessDemarre.CodeEtape=i.VersEtape.Code,r.ProcessDemarre.OptionsProcess=i.VersEtape.ElementDeProcessus.Options,r.ProcessDemarre.Actions=[],this.actions){var u=this.actions[c];if(u.Etape&&u.Etape.Code===i.VersEtape.Code){var l=new g.Services.Lisa.ActionResult(null);l.ValeurSortie=u.ValeurSortie,l.NomExterne=u.NomExterne,l.EstExterne=u.EstExterne,r.ProcessDemarre.Actions.push(l)}}for(var p in i.VersEtape.Options&&(r.ProcessDemarre.OptionsProcessAsEtape=i.VersEtape.Options),r.ProcessDemarre.Actions){var f=r.ProcessDemarre.Actions[p];f.ValeursFinProcessPossibles=this.getSortiesPossiblesPourEtapeEtSortie(i.VersEtape,f.ValeurSortie)}}return n.resolve(r),n.promise}}n.reject(new h.Erreur("Sortie "+t+" inexistante pour l'étape "+e))}catch(e){n.reject(new h.Erreur("Impossible de réaliser l'enchainement: "+JSON.stringify(e)))}return n.promise},t.prototype.start=function(e,t){var n=h.CoreCommon.ServiceDePromesse.defer();try{var r=null;for(var o in e||n.reject(new h.Erreur("pas de code processus fourni en paramètre")),this.processes){var i=this.processes[o];if(i.Code===e){var s=this.setSequencePR(i,t);return(r=new g.Services.Lisa.StartResult(null)).CodeProcessus=i.Code,r.ProchaineEtape=s,r.ProcessDemarre=new h.Lisa.ProcessResult({Code:i.Code,ValeurDepart:t,Nom:i.Nom}),r.ProcessDemarre.EtapesConnues=this.getKnownSteps(i.Code),r.ProcessDemarre.Actions=[],r.ProcessDemarre.OptionsProcess=i.Options,n.resolve(r),n.promise}}n.resolve(null)}catch(e){n.reject(new h.Erreur("Impossible de démarrer un processus: "+JSON.stringify(e)))}return n.promise},t.prototype.getProcesses=function(){if(this.processes){var e=[];for(var t in this.processes){var n=this.processes[t],r=new o.ProcessResult(null);r.Code=n.Code,r.Nom=n.Nom,r.OptionsProcess=n.Options,e.push(r)}return this.libraryManager.Core.createPromiseSelfResolved(e)}return this.libraryManager.Core.createPromiseSelfError(new h.Erreur("pas de processus trouvé"))},t.prototype.getTools=function(){if(this.pointDEntrees){var e=[];for(var t in this.pointDEntrees){var n=this.pointDEntrees[t];if(n.EstUnOutil){var r=new o.ApplicationResult(n.Nom,n.Icone,n.ComposantApplicatif.LocalisationAbsolue+n.LocalisationRelative);e.push(r)}}return this.libraryManager.Core.createPromiseSelfResolved(e)}return this.libraryManager.Core.createPromiseSelfError(new h.Erreur("pas d'outil trouvé"))},t.prototype.setSequencePE=function(e){var t=(e=this.getEtape(e.Code)).ElementDeProcessus,n=new g.Services.Lisa.EtapeResult(null);for(var r in n.CodeApplication=t.Code,n.CodeEtape=e.Code,n.CodeMetier=e.CodeMetier,n.NomApplication=e.ElementDeProcessus.Nom,n.LocalisationAbsolue=t.ComposantApplicatif.LocalisationAbsolue,n.LocalisationRelative=t.LocalisationRelative,n.TypeApplication=t.ComposantApplicatif.Type,n.ValeurEntree=e.ValeurEntree,n.Actions=[],this.actions){var o=this.actions[r];if(o.Etape&&o.Etape.Code===n.CodeEtape){var i=new g.Services.Lisa.ActionResult(null);i.ValeurSortie=o.ValeurSortie,i.NomExterne=o.NomExterne,i.EstExterne=o.EstExterne,n.Actions.push(i)}}for(var s in n.Contrats=[],this.contrats){var a=this.contrats[s];if(a.PointEntree.Code===t.Code){var c=new g.Services.Lisa.ContratResult(null);c.Code=a.Code,c.Longueur=a.Longueur,c.Mode=a.Mode,c.Nullable=a.Nullable,c.Type=a.Type,n.Contrats.push(c)}}for(var u in n.OptionsEtape=e.Options,n.OptionsPointEntree=t.Options,n.Actions){var l=n.Actions[u];l.ValeursFinProcessPossibles=this.getSortiesPossiblesPourEtapeEtSortie(e,l.ValeurSortie)}return n},t.prototype.setSequencePR=function(e,t){var n=this.getDepart(e.Code,t);return"PointDEntree"===n.ElementDeProcessus.Type?this.setSequencePE(n):this.setSequencePR(n.ElementDeProcessus,t)},t.prototype.getDepart=function(e,t){for(var n in this.etapes){var r=this.etapes[n];if(r.InProcess.Code===e)if(t){if(r.ValeurDepartProcessus&&r.ValeurDepartProcessus===t)return r}else if(1===r.ValeurDepartProcessus)return r}throw"pas de première étape trouvée"},t.prototype.getEtape=function(e){for(var t in this.etapes){var n=this.etapes[t];if(n.Code==e)return n}return null},t.prototype.getActionsForAStep=function(e,t){var n=[];for(var r in this.actions)this.actions[r].Etape.Code===e+":"+t&&n.push(this.actions[r]);return n},t.prototype.getKnownSteps=function(e){var t=[],n="",r=[];for(n=this.getDepart(e).ElementDeProcessus.Code,t.push(n),r=this.getActionsForAStep(e,n);1===r.length&&!0!==r[0].FinProcess&&r[0].VersEtape&&-1===t.indexOf(r[0].VersEtape.ElementDeProcessus.Code);)n=r[0].VersEtape.ElementDeProcessus.Code,t.push(n),r=this.getActionsForAStep(e,n);return 1<r.length?t.push("..."):r.length<1&&t.push("???"),t},t.prototype.getSortiesPossiblesPourEtapeEtSortie=function(e,t){var n=[];for(var r in e.Actions){var o=e.Actions[r];if(o.ValeurSortie===t){if(o.FinProcess)n.push(o.ValeurFinProcess);else{var i=this.getSortiesPossiblesPourEtape(o.VersEtape);for(var s in i){var a=i[s];n.indexOf(a)<0&&n.push(a)}}break}}return n},t.prototype.getSortiesPossiblesPourEtape=function(e){var t=[];if(e.Actions)for(var n in e.Actions){var r=e.Actions[n];if(!r.ValeursFinProcessPossibles)if(r.FinProcess)r.ValeursFinProcessPossibles=[],r.ValeursFinProcessPossibles.push(r.ValeurFinProcess);else{r.ValeursFinProcessPossibles=[];var o=r.VersEtape,i=this.getSortiesPossiblesPourEtape(o);for(var s in i){var a=i[s];r.ValeursFinProcessPossibles.indexOf(a)<0&&r.ValeursFinProcessPossibles.push(a)}}for(var c in r.ValeursFinProcessPossibles)a=r.ValeursFinProcessPossibles[c],t.indexOf(a)<0&&t.push(a)}else console.log(e);return t},t.prototype.getCodesProcessus=function(){return this.getProcesses().then(function(e){var t=[];for(var n in e)t.push(e[n].Code);return t})},t.prototype.getInfoProcessus=function(e){var t=h.CoreCommon.ServiceDePromesse.defer();return t.resolve(null),t.promise},t.prototype.DemarrerSousProcessusExterne=function(e,t,n,r,o,i){var s=h.CoreCommon.ServiceDePromesse.defer();return s.resolve(null),s.promise},t.prototype.getHabilitationProcessus=function(e){var t=h.CoreCommon.ServiceDePromesse.defer();for(var n in this.processes){var r=this.processes[n];if(r.Code===e)return t.resolve(r.Habilitation),t.promise}return t.resolve(null),t.promise},t.prototype.getAddOns=function(){var e=h.CoreCommon.ServiceDePromesse.defer();return e.resolve(this.addOns),e.promise},t);function t(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=[]),this.composantsApplicatifs=[],this.pointDEntrees=[],this.contrats=[],this.etapes=[],this.actions=[],this.processes=[],this.libraryManager=null,this._isLocalServiceAvailable=n,r&&0<r.length&&(g.Services.PrivatePortalServiceParameters.Instance().AuthorizedDomains=r),h.PrivatePortalServiceParameters.Instance().LisaFileUrl&&this.addSettingsFromJSON(e,t)}o.FakeLisaApi=e})((h=g.Services||(g.Services={})).Lisa||(h.Lisa={}))}(MyWay=MyWay||{}),function(e){var s,a,c,t;function n(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=[]);var o=c.call(this,e,t,n,r)||this;return o.processusVersions={},o._lisaUrl=s.PrivatePortalServiceParameters.Instance().LisaUrl,o._referentielProcessusSiUrl=s.PrivatePortalServiceParameters.Instance().ReferentielProcessusSiUrl,o.getAddOns().then(function(e){o.addOns=e}),o}s=e.Services||(e.Services={}),a=s.Lisa||(s.Lisa={}),c=a.FakeLisaApi,__extends(n,c),n.prototype.next=function(e,o){var i=this;return(s.PrivatePortalServiceParameters.Instance().LisaFileUrl?c.prototype.next.call(this,e,o):this._next(e,o)).then(function(e){var t=new a.NextResult(e);if(t.ProcessDemarre){var n;if(t.ProcessDemarre.OptionsProcessAsEtape&&null!=(n=JSON.parse(t.ProcessDemarre.OptionsProcessAsEtape))&&n.HorsProcessus)return t;var r=null;if(r=void 0!==e.ProcessDemarre.ValeurDepart?{actionsFinSousProcessus:e.ProcessDemarre.Actions,codeEtape:e.ProcessDemarre.CodeEtape,valeurDepartSousProcessus:e.ProcessDemarre.ValeurDepart,valeurSortie:o}:i._getEtapeAddOn(t.ProcessDemarre.CodeEtape))return i._handleSubProcess(t,r)}return t})},n.prototype.start=function(t,e){var n=this;return s.Promesses.getPromesseSelfResoved().then(function(){return s.PrivatePortalServiceParameters.Instance().LisaFileUrl?c.prototype.start.call(n,t,e).then(function(e){return new a.StartResult(e)}):n._start(t,e)}).then(function(e){return void 0!==e.VersionExport?n.processusVersions[t]=Number(e.VersionExport):n.processusVersions[t]=0,e})},n.prototype._next=function(e,t){return s.CoreCommon.SendRequestWithPromise({url:this._lisaUrl+"/next/"+e+"/"+t,method:s.MethodEnum.GET,withHeaders:!1})},n.prototype._start=function(e,t){var n=s.CoreCommon.ServiceDePromesse.defer(),r=this._lisaUrl+"/start/"+e;return t&&(r+="/"+t),s.CoreCommon.SendRequestWithPromise({url:r,method:s.MethodEnum.GET,withHeaders:!1}).then(function(e){var t=new a.StartResult(e);n.resolve(t)}).catch(function(e){n.reject(e)}),n.promise},n.prototype._handleSubProcess=function(n,r){var e=n.ProcessDemarre.ValeurDepart;return void 0===e&&(e=r.valeurDepartSousProcessus),this.start(n.ProcessDemarre.Code,e).then(function(e){for(var t in n.ProchaineEtape=new a.EtapeResult(e.ProchaineEtape),n.ProcessDemarre.Actions=[],r.actionsFinSousProcessus)n.ProcessDemarre.Actions.push(new a.ActionResult(r.actionsFinSousProcessus[t]));return n}).catch(function(e){throw e})},n.prototype.getTools=function(){return c.prototype.getTools.call(this)},n.prototype.getCodesProcessus=function(){return s.PrivatePortalServiceParameters.Instance().LisaFileUrl?c.prototype.getCodesProcessus.call(this):s.CoreCommon.SendRequestWithPromise({url:this._lisaUrl+"/_index_",withHeaders:!1})},n.prototype.getInfoProcessus=function(e){return s.PrivatePortalServiceParameters.Instance().LisaFileUrl?c.prototype.getInfoProcessus.call(this,e):s.CoreCommon.SendRequestWithPromise({url:this._lisaUrl+"/"+e+".infos",withHeaders:!1})},n.prototype.getHabilitationProcessus=function(e){if(s.PrivatePortalServiceParameters.Instance().LisaFileUrl)return c.prototype.getHabilitationProcessus.call(this,e);var t=s.CoreCommon.ServiceDePromesse.defer();return s.CoreCommon.SendRequest({url:this._referentielProcessusSiUrl+"/recherche/processus?codeProcessus="+e},function(e){e&&e.codeHabilitation?t.resolve(e.codeHabilitation):t.reject(new s.Erreur("les données renvoyées ne sont pas valables",[JSON.stringify(e)]))},function(e){t.reject(e)}),t.promise},n.prototype.getAddOns=function(){if(s.PrivatePortalServiceParameters.Instance().LisaFileUrl)return c.prototype.getAddOns.call(this);var t=s.CoreCommon.ServiceDePromesse.defer();return s.CoreCommon.SendRequest({url:this._lisaUrl+"/importExport/addons",withHeaders:!1},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},n.prototype._getEtapeAddOn=function(e){if(this.addOns&&this.addOns.nextsSubProcess)for(var t in this.addOns.nextsSubProcess){var n=this.addOns.nextsSubProcess[t];if(n&&n.codeEtape===e)return n}return null},n.prototype.DemarrerSousProcessusExterne=function(e,t,n,r,o,i){return this.libraryManager.Core.createPromiseSelfResolved(!0)},t=n,a.LisaApiBase=t}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Lisa)||this;return e.wrapped=null,e}t=e.Services||(e.Services={}),o=t.Lisa||(t.Lisa={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?e.InteropAppliBancaire?this.wrapped=new o.LisaApiPetra:this.wrapped=new o.LisaApiWindows:this.wrapped=new o.LisaApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.wrapped.initApi(t)})},r.prototype.initApi=function(e){},r.prototype.next=function(e,t){return this.wrapped.next(e,t)},r.prototype.start=function(e,t){return this.wrapped.start(e,t)},r.prototype.DemarrerSousProcessusExterne=function(e,t,n,r,o,i){return this.wrapped.DemarrerSousProcessusExterne(e,t,n,r,o,i)},r.prototype.getTools=function(){return this.wrapped.getTools()},r.prototype.getCodesProcessus=function(){return this.wrapped.getCodesProcessus()},r.prototype.getInfoProcessus=function(e){return this.wrapped.getInfoProcessus(e)},r.prototype.getHabilitationProcessus=function(e){return this.wrapped.getHabilitationProcessus(e)},r.prototype.getAddOns=function(){return this.wrapped.getAddOns()},n=r,o.LisaApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,e.Services.PrivatePortalServiceParameters.Instance().Environnement,e.Services.PrivatePortalServiceParameters.Instance().LisaPlaceholders)||this}t=e.Services||(e.Services={}),n=t.Lisa||(t.Lisa={}),r=n.LisaApiBase,__extends(i,r),o=i,n.LisaApiFullWeb=o}(MyWay=MyWay||{}),function(t){var i,e,s,n;function r(){var e=s.call(this,t.Services.PrivatePortalServiceParameters.Instance().Environnement,t.Services.PrivatePortalServiceParameters.Instance().LisaPlaceholders)||this;e._surchargeNext=null,e._surchargeStart=null,e._localServiceUrl=null,e._localServiceUrl=i.PrivatePortalServiceParameters.Instance().LocalServiceUrl;return e}i=t.Services||(t.Services={}),e=i.Lisa||(i.Lisa={}),s=e.LisaApiBase,__extends(r,s),r.prototype.initApi=function(e){var t=this;s.prototype.initApi.call(this,e),i.PrivatePortalServiceParameters.Instance().LocalServiceDisabled||(this.getSurchargeNext(function(e){t._surchargeNext=e}),this.getSurchargeStart(function(e){t._surchargeStart=e}))},r.prototype.next=function(e,t){var n=i.CoreCommon.ServiceDePromesse.defer();for(var r in this._surchargeNext){var o=this._surchargeNext[r];if(o.CodeEtape===e&&o.ValeurSortie===t)return n.resolve(o),n.promise}return s.prototype.next.call(this,e,t)},r.prototype.start=function(e,t){var n=i.CoreCommon.ServiceDePromesse.defer();for(var r in this._surchargeStart){var o=this._surchargeStart[r];if(o.CodeProcessus===e)return n.resolve(o),n.promise}return s.prototype.start.call(this,e,t)},r.prototype.getSurchargeNext=function(o){var e;if(this._localServiceUrl)return e=this._localServiceUrl+"/surcharge-next.json",this.libraryManager.Core.sendRequest({url:e}).then(function(e){var t=[];for(var n in e){var r=e[n];t.push(r)}o(t)},function(e){})},r.prototype.getSurchargeStart=function(o){var e;if(this._localServiceUrl)return e=this._localServiceUrl+"/surcharge-start.json",this.libraryManager.Core.sendRequest({url:e}).then(function(e){var t=[];for(var n in e){var r=e[n];t.push(r)}o(t)},function(e){})},n=r,e.LisaApiWindows=n}(MyWay=MyWay||{}),function(e){var t,n,o,r;function i(){return o.call(this,t.Components.ComponentType.Lisa)||this}t=e.Services||(e.Services={}),n=t.Lisa||(t.Lisa={}),o=t.Components.ComponentAgentBase,__extends(i,o),i.prototype.init=function(e,t,n){var r=this;return o.prototype.init.call(this,e,t,n).then(function(){if(!n.disableGetStepInfo||!0!==n.disableGetStepInfo)return r.library.Context.GetCurrentStepInfo().then(function(e){r.StepCode=e.StepCode,r.library.Context.StepInfo=e});r.StepCode=n.codeApplication})},i.prototype.Next=function(e){return this.NextWithStep(this.StepCode,e)},i.prototype.NextWithStep=function(e,t){return this.sendMessage(n.Messages.LisaMessageSubject.Next,{valeurSortie:t,stepCode:e})},r=i,n.LisaAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(c){var u,l,t,e;function n(){var e=t.call(this,u.Components.ComponentType.Impression)||this;return e._urlDistantGeneration=u.PrivatePortalServiceParameters.Instance().ImpressionUrl+"/ServiceRestGcedoc/api/Restitution/RestitutionGceDocAvecGed",e._urlGetFichierFromGED=u.PrivatePortalServiceParameters.Instance().GetFichierFromGEDUrl,e}u=c.Services||(c.Services={}),l=u.Impression||(u.Impression={}),t=u.Components.ComponentApiBase,__extends(n,t),n.prototype.isLocal=function(){return!1},n.prototype.genererDocument=function(e,t,n){var r={};return r.url=this._urlDistantGeneration,r.responseType=u.ResponseTypeEnum.JSON,r.authentificationInfo=n,r.method=u.MethodEnum.POST,r.params=t,r.withHeaders=!0,r.async=!0,r.timeout=6e4,r.contentType=u.ContentTypeEnum.JSON,r.data=this.convertJson(e),this.libraryManager.Core.sendRequest(r)},n.prototype.convertJson=function(e){var t=JSON.stringify(e).replace(/_attribute_Content\":0/g,'@Content":"Id"').replace(/_attribute_Content:\"1/g,'@Content":"Flux"').replace(/_attribute_/g,"@");return t=t.replace(/attributeContent\":0/g,'@Content":"Id"').replace(/attributeContent:\"1/g,'@Content":"Flux"').replace(/attributeId/g,"@id").replace(/attributeXmlns/g,"@xmlns").replace(/attributeCamel/g,"@camel")},n.prototype.getJsonConverti=function(e){try{return u.Promesses.createPromiseSelfResolved(this.convertJson(e))}catch(e){return u.Promesses.createPromiseSelfError(new u.Erreur(e))}},n.prototype.imprimerDocument=function(e,t){return u.Promesses.getPromesseSelfResoved()},n.prototype.imprimerDocumentLot=function(e,t){return u.Promesses.getPromesseSelfResoved()},n.prototype.getDocumentGEDLot=function(i,s){var a=this;return u.Promesses.promesseTryCatch(function(n){for(var e,r=0;r<i.length;r++){if(""===i[r].fichier&&(i[r].fichier=void 0),""===i[r].idGed&&(i[r].idGed=void 0),""!==(e=l.controleDocumentImpressionLot(i[r]))){var t="Le contrôle du document {0} a rapporté une erreur : {1}";return t=(t=t.replace("{0}",String(r+1))).replace("{1}",e),void n.reject(new u.Erreur(t))}if(u.Controle.StaticStringControle.isStringNotEmpty(i[r].composantApplicatif)||(i[r].composantApplicatif="CONTELEC"),u.Controle.StaticStringControle.isStringNotEmpty(i[r].codeEtablissement)&&(s.codeEtablissement=i[r].codeEtablissement),!u.Controle.StaticAnyControle.isNotUndefinedAndNotNull(i[r].fichier)){if(!s.codeEtablissement||!s.agentConnecte)return void n.reject(new u.Erreur(c.Services.Libelle.LibelleModel.COM.ERREUR_COMMUNICATION_PARAMETRES_INSUFFISANTS));var o={};o.url=a._urlGetFichierFromGED,o.responseType=u.ResponseTypeEnum.JSON,o.authentificationInfo=s,o.method=u.MethodEnum.GET,o.params={idDocument:i[r].idGed,codeApplication:i[r].composantApplicatif},o.withHeaders=!0,o.async=!1,o.contentType=u.ContentTypeEnum.JSON,o.timeout=6e4,u.CoreCommon.SendRequest(o,function(e){i[r].fichier=e.fichier.contenu},function(e){var t="La récupération du document {0} du lot a généré une erreur : {1}";t=(t=t.replace("{0}",String(r+1))).replace("{1}",e.libelle),n.reject(new u.Erreur(t))})}}n.resolve(i)})},n.prototype.gererErreur=function(e){return n.logger.error(e),u.Promesses.createPromiseSelfError(new u.Erreur(u.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[e]))},n.CLASS_NAME="MyWay.Services.Impression.ImpressionApiBase",n.logger=u.Loggers.LoggerFactory.INSTANCE.getClass(n.CLASS_NAME),e=n,l.ImpressionApiBase=e}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Impression)||this;return e.wrapped=null,e}t=e.Services||(e.Services={}),o=t.Impression||(t.Impression={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal&&e.SIRIS&&e.InteropAppliBancaire?this.wrapped=new o.ImpressionApiPetra:this.wrapped=new o.ImpressionApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.wrapped.init(e,t,n)})},r.prototype.genererDocument=function(e,t,n){return this.wrapped.genererDocument(e,t,n)},r.prototype.getJsonConverti=function(e){return this.wrapped.getJsonConverti(e)},r.prototype.imprimerDocument=function(e,t){return this.wrapped.imprimerDocument(e,t)},r.prototype.imprimerDocumentLot=function(e,t){return this.wrapped.imprimerDocumentLot(e,t)},r.prototype.getDocumentGEDLot=function(e,t){return this.wrapped.getDocumentGEDLot(e,t)},n=r,o.ImpressionApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(o){var i,n,e,t;function r(){return e.call(this)||this}i=o.Services||(o.Services={}),n=i.Impression||(i.Impression={}),e=n.ImpressionApiBase,__extends(r,e),r.prototype.imprimerDocument=function(e,t){return n.ImpressionApiBase.logger.debug("Lancement de la sauvegarde du PDF"),this.libraryManager.Fichier.saveAs(e,o.Services.Fichier.TYPE_FICHIER.PDF,t.serializedImpressionParams.obligatoires.nomFichier,o.Services.Fichier.TYPE_DONNEES_A_SAUVER.BASE64)},r.prototype.imprimerDocumentLot=function(e,t){for(var n=[],r=0;r<e.length;r++)n.push(this.libraryManager.Fichier.saveAs(e[r].fichier,o.Services.Fichier.TYPE_FICHIER.PDF,e[r].impressionParams.obligatoires.nomFichier,o.Services.Fichier.TYPE_DONNEES_A_SAUVER.BASE64));return i.Promesses.getServiceDePromesse().all(n).catch(function(e){var t="Une erreur est survenue lors de la sauvegarde des documents du lot : {0}";throw t=t.replace("{0}",e.codeLibelle),new i.Erreur(i.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[t])})},t=r,n.ImpressionApiFullWeb=t}(MyWay=MyWay||{}),function(e){var o,i,t,n;function r(){var e=t.call(this)||this;return e._urlLocal=o.PrivatePortalServiceParameters.Instance().LocalServiceUrl+"/impression/",e}o=e.Services||(e.Services={}),i=o.Impression||(o.Impression={}),t=i.ImpressionApiBase,__extends(r,t),r.prototype.imprimerDocument=function(e,n){var r=this;return o.Promesses.promesseTryCatch(function(t){r.libraryManager.Libelle.afficherMessage(o.Libelle.LibelleModel.TEC.IMPRESSION_IMPRESSION_EN_COURS,o.Libelle.TYPE_AFFICHAGE.VIDE,null,0,null,function(){r._imprimerDocument(e,n).then(function(){o.ServiceManager.Instance().Library.Display.FermerModalMessage(),i.ImpressionApiBase.logger.debug("ServiceApi.Impression.imprimerDocument Success"),t.resolve()},function(e){o.ServiceManager.Instance().Library.Display.FermerModalMessage(),i.ImpressionApiBase.logger.error("ServiceApi.Impression.imprimerDocument failed %1",JSON.stringify(e)),t.reject(e)})})})},r.prototype.imprimerDocumentLot=function(e,t){var r=this;return o.Promesses.promesseTryCatch(function(n){r.libraryManager.Libelle.afficherMessage(o.Libelle.LibelleModel.TEC.IMPRESSION_IMPRESSION_EN_COURS,o.Libelle.TYPE_AFFICHAGE.VIDE,null,0,null,function(){r._imprimerDocumentLot(e,t).then(function(){o.ServiceManager.Instance().Library.Display.FermerModalMessage(),i.ImpressionApiBase.logger.debug("ServiceApi.Impression.imprimerDocumentLot success"),n.resolve()},function(e){o.ServiceManager.Instance().Library.Display.FermerModalMessage();var t="Une erreur est survenue lors de la l'impression des documents du lot : {0}";t=t.replace("{0}",e.libelle),n.reject(new o.Erreur(o.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[t]))})})})},r.prototype._imprimerDocument=function(e,t){var n={};return n.url=this._urlLocal+"ImprimerSansGceDoc",n.responseType=null,n.method=o.MethodEnum.POST,n.params=t,n.async=!0,n.timeout=36e5,n.contentType=o.ContentTypeEnum.JSON,n.data=e,n.cache=!1,this.libraryManager.Core.sendRequest(n)},r.prototype._imprimerDocumentLot=function(e,t){var n={};return n.url=this._urlLocal+"ImprimerLotSansGceDoc",n.responseType=null,n.params=t,n.method=o.MethodEnum.POST,n.async=!0,n.timeout=36e5,n.contentType=o.ContentTypeEnum.JSON,n.data=e,this.libraryManager.Core.sendRequest(n)},n=r,i.ImpressionApiPetra=n}(MyWay=MyWay||{}),function(e){var t,n,r;function o(){}t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),o.isAdresseIpValide=function(e){return!(!/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)&&!/(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/.test(e))},r=o,n.OutilsIp=r}(MyWay=MyWay||{}),function(e){var i;(function(o){o.PLAGES_IP=/^126|^172/;var e=(t.prototype.formatagePlages=function(e){var t=e.split("*");switch(t[0]){case"1":return t[1].split(",").map(function(e){var t=e.split("/"),n=t[0];if(!o.OutilsIp.isAdresseIpValide(n))throw new i.Erreur("La valeur de l'adresseIp est incorrecte :"+n);var r=Number(t[1]);if(isNaN(r)||r<0||32<r)throw new i.Erreur("La valeur du masque réseau est incorrecte :"+r);return{adresseIP:n,masque:r}});default:throw new i.Erreur("Type de plage réseau incorrecte")}},t.prototype.isDansPlageReseau=function(r){var o=this;return this._plagesReseau.some(function(e){var t=o.convertirMasqueEnBinaire(e.masque),n=o.convertirIPEnBinaire(r);if(o.recupererSousReseau(o.convertirIPEnBinaire(e.adresseIP),t)===o.recupererSousReseau(n,t))return!0})},t.prototype.convertirIPEnBinaire=function(e){var r="";return e.split(".").map(Number).forEach(function(e){var t=e.toString(2),n=8-t.length;t=Array(1+n).join("0")+t,r+=t}),r},t.prototype.convertirMasqueEnBinaire=function(e){return Array(e).join("1")+Array(32-e).join("0")},t.prototype.recupererSousReseau=function(e,t){var n=parseInt(e,2);return(parseInt(t,2)&n).toString(2)},t);function t(e){this._data=e,this._plagesReseau=null;try{this._plagesReseau=this.formatagePlages(e)}catch(e){throw e}}o.PlageReseau=e})((i=e.Services||(e.Services={})).Mobilite||(i.Mobilite={}))}(MyWay=MyWay||{}),function(t){var o,i,s,e;function a(){var e=s.call(this,o.Components.ComponentType.Mobilite)||this;return e.api=null,e.contextKey="MOBILITE",e.recupIpPromesse=null,e.recupIpTimeout=null,e.maximumTimeout=36e5,e}o=t.Services||(t.Services={}),i=o.Mobilite||(o.Mobilite={}),s=o.Components.ComponentManagerBase,__extends(a,s),a.prototype.init=function(e,t,n,r){var o=this;return this.api=r,s.prototype.init.call(this,e,t,n,r).then(function(){o.recupererAdresseIp()})},a.prototype.getCaisseAuto=function(){var e=this.library.Context.GetParametresComptables();return!(!e||!e.typeCA)},a.prototype.getEcranTactile=function(){return this.api.estEcranTactile().then(function(e){return a.logger.debug("Ecran principal tactile - statut : %1",e),e},function(e){throw a.logger.warn("Erreur lors de la récupération de l'information: écran tactile",JSON.stringify(e)),new o.Erreur(t.Services.Libelle.LibelleModel.COM.ERREUR_MOBILITE_RECUP_TYPE_ECRAN_IMPOSSIBLE)})},a.prototype.getNavigateur=function(){var e={nom:null,version:null};return e.nom=this.library.Core.GetBrowser(),e.version=this.library.Core.GetBrowserVersion(),a.logger.debug("Le navigateur utilisé est %1",JSON.stringify(e)),this.library.Core.createPromiseSelfResolved(e)},a.prototype.getPlateforme=function(){return this.api.getPlateforme().then(function(e){return a.logger.debug("La plateforme de l'utilisateur est %1",i.PLATEFORME[e]),e},function(e){throw a.logger.warn("Impossible de récupérer la plateforme de la machine"),new o.Erreur(t.Services.Libelle.LibelleModel.COM.ERREUR_MOBILITE_RECUP_PLATEFORME_MACHINE_IMPOSSIBLE)})},a.prototype.getResolutionEcran=function(){return this.api.getResolutionEcran().then(function(e){return a.logger.debug("La résolution de l'écran principal est %1",JSON.stringify(e)),e},function(e){throw a.logger.warn("Impossible de récupérer la résolution de l'écran"),new o.Erreur(t.Services.Libelle.LibelleModel.COM.ERREUR_MOBILITE_RECUP_RESOLUTION_ECRAN_IMPOSSIBLE)})},a.prototype.getInfoMachine=function(){var t={},e=[];return a.logger.debug("Start getInfoMachine"),e.push(this.getPlateforme().then(function(e){t.plateforme=e})),e.push(this.getResolutionEcran().then(function(e){t.hauteurEcran=e.hauteur,t.largeurEcran=e.largeur})),e.push(this.getEcranTactile().then(function(e){t.ecranTactile=e})),e.push(this.getNavigateur().then(function(e){t.navigateur=e})),o.Promesses.all(e).then(function(){return t},function(e){throw a.logger.warn("getInfoMachine Failed",JSON.stringify(e)),e})},a.prototype.recupererAdresseIp=function(){var r=this;return null!==this.recupIpPromesse&&Date.now()-this.recupIpTimeout<this.maximumTimeout||o.Promesses.promesseTryCatch(function(n){r.recupIpPromesse=n.promise,r.recupIpTimeout=Date.now();var e=JSON.parse(r.library.Context.GetFromContext(r.contextKey));e&&null!==e.adresseIp&&Date.now()-e.timeout<r.maximumTimeout?n.resolve(e.adresseIp):r.api.getAdresseIp().then(function(e){if(!i.OutilsIp.isAdresseIpValide(e))return n.reject(new o.Erreur("Format de l'adresse IP est incorrect"));var t={adresseIp:e,timeout:r.recupIpTimeout};r.library.Context.AddToContext(o.Context.StorageLevel.Global,r.contextKey,JSON.stringify(t)),n.resolve(e)},function(e){r.recupIpPromesse=null,a.logger.warn(e.codeLibelle,JSON.stringify(e)),n.reject(e)})}),this.recupIpPromesse},a.prototype.determinerTypeReseau=function(r){return i.PLAGES_IP.test(r)?this.api.getPlagesReseau().then(function(e){var t=new i.PlageReseau(e.configuration.VPN),n=new i.PlageReseau(e.configuration.WIFI);return t.isDansPlageReseau(r)?(a.logger.debug("Type de réseau: %1",i.TYPE_RESEAU[i.TYPE_RESEAU.VPN]),i.TYPE_RESEAU.VPN):n.isDansPlageReseau(r)?(a.logger.debug("Type de réseau: %1",i.TYPE_RESEAU[i.TYPE_RESEAU.WIFI_AGENCE]),i.TYPE_RESEAU.WIFI_AGENCE):(a.logger.debug("Type de réseau: %1",i.TYPE_RESEAU[i.TYPE_RESEAU.FILAIRE]),i.TYPE_RESEAU.FILAIRE)}):(a.logger.warn("Type de réseau: %1 - Adresse IP: %2",i.TYPE_RESEAU[i.TYPE_RESEAU.INCONNU],r),this.library.Core.createPromiseSelfResolved(i.TYPE_RESEAU.INCONNU))},a.prototype.getReseau=function(){var t=this;return this.recupererAdresseIp().then(function(e){return a.logger.debug("Adresse IP du poste %1",e),t.determinerTypeReseau(e)},function(e){return a.logger.warn("Impossible de récupérer l'adresse IP du poste : %1",JSON.stringify(e.codeLibelle)),i.TYPE_RESEAU.INCONNU})},a.prototype.getPeripheriques=function(){var t=[];this.getCaisseAuto()&&t.push(new i.CaisseAuto);var e=[];return e.push(this.getTablettesSignatures().then(function(e){t=t.concat(e)})),o.Promesses.all(e).then(function(){return a.logger.debug("Liste des périphériques connectés: %1",JSON.stringify(t)),t},function(e){throw a.logger.warn("Erreur lors de la récupération la liste des périphériques connectés: %1",JSON.stringify(e)),e})},a.prototype.getPeripheriquesParType=function(n){return this.getPeripheriques().then(function(e){var t=e.filter(function(e){return e.typePeripherique===n}).map(function(e){return e});return a.logger.debug("Liste de périphériques de type %1 connectées: %2",i.TYPE_PERIPHERIQUE[n],JSON.stringify(t)),t}).catch(function(e){throw a.logger.warn("Erreur lors de la récupération la liste des périphériques connectés: %1",JSON.stringify(e)),e})},a.prototype.getTablettesSignatures=function(){return this.api.listeTablettesSignatures().catch(function(e){throw new o.Erreur(t.Services.Libelle.LibelleModel.COM.ERREUR_MOBILITE_RECUP_LISTE_TABLETTES_SIGNATURES_IMPOSSIBLE)})},a.CLASS_NAME="MyWay.Services.Mobilite.MobiliteManager",a.logger=o.Loggers.LoggerFactory.INSTANCE.getClass(a.CLASS_NAME),e=a,i.MobiliteManager=e,o.Components.RegistryManager.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var t,s,a,n;function r(){return a.call(this,t.Components.ComponentType.Fichier)||this}t=e.Services||(e.Services={}),s=t.Fichier||(t.Fichier={}),a=t.Components.ComponentManagerMessageBase,__extends(r,a),r.prototype.reception=function(e){switch(e.subject){case s.FichierMessageSubject.SaveAs:var t=e.message,n=t.data,r=t.type,o=t.nomFichier,i=t.typeDonnees;return this.managerInstance.saveAs(n,r,o,i);default:return a.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.Fichier.FichierManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,s.FichierManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.DonneesDelocalisees)||this}t=e.Services||(e.Services={}),n=t.DonneesDelocalisees||(t.DonneesDelocalisees={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.getDonneesDelocalisees=function(e,t){return this.manager.getDonneesDelocalisees(e,t)},i.prototype.getListeDonneesDelocalisees=function(e,t){return this.manager.getListeDonneesDelocalisees(e,t)},i.prototype.getRubriqueLibelle=function(e,t,n){return this.manager.getRubriqueLibelle(e,t,n)},i.prototype.getDonneesParCriteres=function(e,t,n){return this.manager.getDonneesParCriteres(e,t,n)},o=i,n.DonneesDelocaliseesManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,c,u,n;function r(){return u.call(this,t.Components.ComponentType.DonneesDelocalisees)||this}t=e.Services||(e.Services={}),c=t.DonneesDelocalisees||(t.DonneesDelocalisees={}),u=t.Components.ComponentManagerMessageBase,__extends(r,u),r.prototype.reception=function(e){switch(e.subject){case c.Messages.DonneesDelocaliseesMessageSubject.GetDonneesDelocalisees:var t=(s=e.message).numEtablissement,n=s.objectDataName;return this.managerInstance.getDonneesDelocalisees(t,n);case c.Messages.DonneesDelocaliseesMessageSubject.GetListeDonneesDelocalisees:t=(s=e.message).numEtablissement;var r=s.objectDataNames;return this.managerInstance.getListeDonneesDelocalisees(t,r);case c.Messages.DonneesDelocaliseesMessageSubject.GetRubriqueLibelle:t=(s=e.message).numEtablissement,n=s.objectDataName;var o=s.code;return this.managerInstance.getRubriqueLibelle(t,n,o);case c.Messages.DonneesDelocaliseesMessageSubject.GetDonneesParCriteres:t=(s=e.message).numEtablissement,n=s.objectDataName;var i=s.criteres;return this.managerInstance.getDonneesParCriteres(t,n,i);case c.Messages.DonneesDelocaliseesMessageSubject.ReInitDbDonneesDelocalisees:var s=e.message;return this.managerInstance.reInitDbDonneesDelocalisees();case c.Messages.DonneesDelocaliseesMessageSubject.GetTDTById:var a=(s=e.message).idTDT;return this.managerInstance.getTDTById(a);case c.Messages.DonneesDelocaliseesMessageSubject.DeleteTDTById:return a=(s=e.message).idTDT,this.managerInstance.deleteTDTById(a);default:return u.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.DonneesDelocalisees.DonneesDelocaliseesManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,c.DonneesDelocaliseesManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var p;(function(e){var o,t=(o=p.Components.ComponentManagerBase,__extends(u,o),u.prototype.init=function(e,t,n,r){return this.api=r,o.prototype.init.call(this,e,t,n,r)},u.prototype.numeriser=function(e,r){var o=this,t="",i="";if(p.Controle.StaticStringControle.isStringNotEmpty(e)||(t+="Le paramètre 'data' est obligatoire et doit être une chaine de caractères non vide / "),p.Controle.StaticAnyControle.isNotUndefinedAndNotNull(r)?(p.Controle.StaticStringControle.isStringNotEmpty(r.dropZonePath)||(t+="Le paramètre 'numerisationParams.dropZonePath' est obligatoire et doit être une chaine de caractères non vide / "),p.Controle.StaticStringControle.isStringNotEmpty(r.configurationFilePath)||(t+="Le paramètre 'numerisationParams.configurationFilePath' est obligatoire et doit être une chaine de caractères non vide / ")):t+="Le paramètre 'numerisationParams' est obligatoire et doit être de type 'NumerisationParams' / ",""!=t)return t=t.substring(0,t.lastIndexOf("/")-1),p.Loggers.FLASH.INSTANCE.setValue("action","numeriser"),u.logger.error(t),this.library.Core.createPromiseSelfError(new p.Erreur(p.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[t]));var s={};return s.data=e,this.library.Core.promesseTryCatch(function(n){o.library.Libelle.afficherMessage(p.Libelle.LibelleModel.TEC.NUMERISATION_EN_COURS,p.Libelle.TYPE_AFFICHAGE.VIDE,null,0,null,function(){o.library.Context.getAuthentificationInfo().then(function(e){if(e&&(i=e.codeEtablissement),""===i){var t=new p.Erreur(p.Libelle.LibelleModel.COM.ERREUR_CONTEXTE_RECUP_CODE_ETAB_IMPOSSIBLE);return p.Loggers.FLASH.INSTANCE.setValue("action","numeriser"),o.library.Libelle.constituerLibelle(t.codeLibelle).then(function(e){u.logger.error(e)}),o.library.Display.FermerModalMessage(),void n.reject(t)}o.getDonneesDelocaliseesNumerisation(i,s,"").then(function(){var e=new a(r.dropZonePath,r.configurationFilePath,i,!0);o.api.numeriserDocument(s,e).then(function(){o.library.Display.FermerModalMessage(),u.logger.debug("numeriserDocument success"),n.resolve()},function(e){o.library.Display.FermerModalMessage(),u.logger.error("numeriserDocument failed - %1",JSON.stringify(e)),n.reject(e)})},function(){p.Loggers.FLASH.INSTANCE.setValue("action","numeriser"),o.library.Libelle.constituerLibelle(p.Libelle.LibelleModel.COM.ERREUR_NUMERISATION_RECUP_DONNEES_DELOCALISEES_IMPOSSIBLE).then(function(e){u.logger.warn(e)}),s.CCLI_TYP={},s.CCLI_UTL={},s.NATURE={};var e=new a(r.dropZonePath,r.configurationFilePath,i,!1);o.api.numeriserDocument(s,e).then(function(){o.library.Display.FermerModalMessage(),u.logger.debug("numeriserDocument success"),n.resolve()},function(e){o.library.Display.FermerModalMessage(),u.logger.error("numeriserDocument failed - %1",JSON.stringify(e)),n.reject(e)})})},n.reject)})})},u.prototype.getSpiFactoryActivationStatut=function(){return this.api.getSpiFactoryActivationStatutOnServeur().then(function(e){return u.logger.debug("Statut de la présence du jeton d'activation SpiFactory sur le serveur d'agence : %1",e),e},function(e){throw u.logger.error("Statut de la présence du jeton d'activation SpiFactory sur le serveur d'agence : %1",JSON.stringify(e)),e})},u.prototype.numeriserArcade=function(e,t){var i=this,n="",s="",a="";if(p.Controle.StaticStringControle.isStringNotEmpty(e)||(n+="Le paramètre 'data' est obligatoire et doit être une chaine de caractères non vide / "),""!=n)return n=n.substring(0,n.lastIndexOf("/")-1),p.Loggers.FLASH.INSTANCE.setValue("action","numeriserArcade"),u.logger.error(n),this.library.Core.createPromiseSelfError(new p.Erreur(p.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[n]));var c={};return c.data=e,this.library.Core.promesseTryCatch(function(o){i.library.Libelle.afficherMessage(p.Libelle.LibelleModel.TEC.NUMERISATION_EN_COURS,p.Libelle.TYPE_AFFICHAGE.VIDE,null,0,null,function(){i.library.Context.getAuthentificationInfo().then(function(e){s=e.codeEtablissement;var t=i.library.Context.GetParametresComptables();if(t&&(a=t.edsExterneGuichetComptable),!p.Controle.StaticStringControle.isStringNotEmpty(s)){var n=new p.Erreur(p.Libelle.LibelleModel.COM.ERREUR_CONTEXTE_RECUP_CODE_ETAB_IMPOSSIBLE);return p.Loggers.FLASH.INSTANCE.setValue("action","numeriserArcade"),i.library.Libelle.constituerLibelle(n.codeLibelle).then(function(e){u.logger.error(e)}),i.library.Display.FermerModalMessage(),void o.reject(n)}if(!p.Controle.StaticStringControle.isStringNotEmpty(a)){var r=new p.Erreur(p.Libelle.LibelleModel.COM.ERREUR_CONTEXTE_RECUP_ID_AGENCE_IMPOSSIBLE);return p.Loggers.FLASH.INSTANCE.setValue("action","numeriserArcade"),i.library.Libelle.constituerLibelle(r.codeLibelle).then(function(e){u.logger.error(e)}),i.library.Display.FermerModalMessage(),void o.reject(r)}i.getDonneesDelocaliseesNumerisationArcade(s,c,"").then(function(){var e=new l(s,a,!0);i.api.numeriserDocumentArcade(c,e).then(function(){i.library.Display.FermerModalMessage(),u.logger.debug("numeriserDocumentArcade success"),o.resolve()},function(e){i.library.Display.FermerModalMessage(),u.logger.error("numeriserDocumentArcade failed - %1",JSON.stringify(e)),o.reject(e)})},function(){p.Loggers.FLASH.INSTANCE.setValue("action","numeriserArcade"),i.library.Libelle.constituerLibelle(p.Libelle.LibelleModel.COM.ERREUR_NUMERISATION_RECUP_DONNEES_DELOCALISEES_IMPOSSIBLE).then(function(e){u.logger.warn(e)}),c.D93F={},c.D93G={},c.D93J={},c.D93K={},c.D93M={},c.D93T={},c.D93V={},c.D93Y={};var e=new l(s,a,!1);i.api.numeriserDocumentArcade(c,e).then(function(){i.library.Display.FermerModalMessage(),u.logger.debug("numeriserDocumentArcade success"),o.resolve()},function(e){i.library.Display.FermerModalMessage(),u.logger.error("numeriserDocumentArcade failed - %1",JSON.stringify(e)),o.reject(e)})})})})})},u.prototype.getDonneesDelocaliseesNumerisation=function(t,n,e){var r=this;switch(e){case"CCLI_TYP":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.CCLI_TYP=e,r.getDonneesDelocaliseesNumerisation(t,n,"CCLI_UTL")});case"CCLI_UTL":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.CCLI_UTL=e,r.getDonneesDelocaliseesNumerisation(t,n,"NATURE")});case"NATURE":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){n.NATURE=e});default:return this.getDonneesDelocaliseesNumerisation(t,n,"CCLI_TYP")}},u.prototype.getDonneesDelocaliseesNumerisationArcade=function(t,n,e){var r=this;switch(e){case"D93F":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.D93F=e,r.getDonneesDelocaliseesNumerisationArcade(t,n,"D93G")});case"D93G":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.D93G=e,r.getDonneesDelocaliseesNumerisationArcade(t,n,"D93J")});case"D93J":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.D93J=e,r.getDonneesDelocaliseesNumerisationArcade(t,n,"D93K")});case"D93K":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.D93K=e,r.getDonneesDelocaliseesNumerisationArcade(t,n,"D93M")});case"D93M":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.D93M=e,r.getDonneesDelocaliseesNumerisationArcade(t,n,"D93T")});case"D93T":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.D93T=e,r.getDonneesDelocaliseesNumerisationArcade(t,n,"D93V")});case"D93V":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){return n.D93V=e,r.getDonneesDelocaliseesNumerisationArcade(t,n,"D93Y")});case"D93Y":return this.library.DonneesDelocalisees.getDonneesDelocalisees(t,e).then(function(e){n.D93Y=e});default:return this.getDonneesDelocaliseesNumerisationArcade(t,n,"D93F")}},u.CLASS_NAME="MyWay.Services.Numerisation.NumerisationManager",u.logger=p.Loggers.LoggerFactory.INSTANCE.getClass(u.CLASS_NAME),u);function u(){var e=o.call(this,p.Components.ComponentType.Numerisation)||this;return e.api=null,e}e.NumerisationManager=t;var a=function(e,t,n,r){this.dropZonePath=e,this.configurationFilePath=t,this.codeEtablissement=n,this.donneesDelocalisees=r},l=function(e,t,n){this.codeEtablissement=e,this.idAgence=t,this.donneesDelocalisees=n};p.Components.RegistryManager.getInstance().register(t)})((p=e.Services||(e.Services={})).Numerisation||(p.Numerisation={}))}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Aide)||this}t=e.Services||(e.Services={}),n=t.Aide||(t.Aide={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.onGetContenuInfobulle=function(e){var t=null!==e.idChampLie&&void 0!==e.idChampLie?e.idChampLie:"",n=null!==e.horsProcessus&&void 0!==e.horsProcessus?e.horsProcessus:null,r=null!==e.codeProcessus&&void 0!==e.codeProcessus?e.codeProcessus:null,o=null!==e.codeEtape&&void 0!==e.codeEtape?e.codeEtape:null,i=this.managerInstance.getParametresContexte(t,n,r,o);return this.managerInstance.GetContenuInfobulle(i)},i.prototype.onGetInfobullesAffichables=function(e){var t=null!==e.horsProcessus&&void 0!==e.horsProcessus?e.horsProcessus:null,n=null!==e.codeProcessus&&void 0!==e.codeProcessus?e.codeProcessus:null,r=null!==e.codeEtape&&void 0!==e.codeEtape?e.codeEtape:null,o=this.managerInstance.getParametresContexte("",t,n,r);return this.managerInstance.GetInfobullesAffichables(o)},i.prototype.reception=function(e){switch(e.subject){case n.Messages.AideMessageSubject.GetContenuInfobulle:return this.onGetContenuInfobulle(e.message);case n.Messages.AideMessageSubject.GetInfobullesAffichables:return this.onGetInfobullesAffichables(e.message);default:return r.prototype.reception.call(this,e)}},i.CLASS_NAME="MyWay.Services.Aide.AideManagerMessage",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.AideManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Aide)||this}t=e.Services||(e.Services={}),n=t.Aide||(t.Aide={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.MemoriserEtape=function(e){return this.manager.ajouterEtapeDansPreference(e)},o=i,n.AideManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,o,n,r;function i(){return n.call(this,t.Components.ComponentType.Application)||this}t=e.Services||(e.Services={}),o=t.Application||(t.Application={}),n=t.Components.ComponentAgentBase,__extends(i,n),i.prototype.Demarrer=function(e){return this.sendMessage(o.Messages.ApplicationMessageSubject.Demarrer,{codeApplication:e})},i.prototype.DemarrerProcessus=function(e,t,n,r){return void 0===t&&(t=null),void 0===r&&(r=null),this.sendMessage(o.Messages.ApplicationMessageSubject.DemarrerProcessus,{codeProcessus:e,delegationPortail:t,initData:n,valeurDepart:r})},r=i,o.ApplicationAgent=r,t.Components.RegistryAgent.getInstance().register(r)}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgentExtended,"LisaTechAgent",{get:function(){return this._techLibrary.LisaTechAgent}}),t.TechAgentExtended.prototype.StartProcess=function(e,t,n){return this._techLibrary.StartProcess(e,t,n)},t.TechAgentExtended.prototype.StartSubProcess=function(e,t){return this._techLibrary.StartSubProcess(e,t)},t.TechAgentExtended.prototype.StartExternalApp=function(e,t,n){return this._techLibrary.StartExternalApp(e,t,n)},t.TechAgentExtended.prototype.GetProcesses=function(){return this._techLibrary.GetProcesses()},t.TechAgentExtended.prototype.GetTools=function(){return this._techLibrary.GetTools()},t.TechAgentExtended.prototype.GetCodesProcessus=function(){return this._techLibrary.GetCodesProcessus()},t.TechAgentExtended.prototype.GetInfoProcessus=function(e){return this._techLibrary.GetInfoProcessus(e)}}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.TechAgent,"LisaTechAgent",{get:function(){return this._techLibrary.LisaTechAgent}}),t.TechAgent.prototype.StartProcess=function(e,t,n){return this.LisaTechAgent.StartProcess(e,t,n)},t.TechAgent.prototype.StartSubProcess=function(e,t){return this.LisaTechAgent.StartSubProcess(e,t)},t.TechAgent.prototype.StartExternalApp=function(e,t,n){return this.LisaTechAgent.StartExternalApp(e,t,n)},t.TechAgent.prototype.GetProcesses=function(){return this.LisaTechAgent.GetProcesses()},t.TechAgent.prototype.GetTools=function(){return this.LisaTechAgent.GetTools()},t.TechAgent.prototype.GetCodesProcessus=function(){return this.LisaTechAgent.GetCodesProcessus()},t.TechAgent.prototype.GetInfoProcessus=function(e){return this.LisaTechAgent.GetInfoProcessus(e)}}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).TechLibrary.addInitListener(function(e,t){e.LisaTechAgent=t.Lisa}),t.TechLibrary.prototype.StartProcess=function(e,t,n){return this.LisaTechAgent.StartProcess(e,t,n)},t.TechLibrary.prototype.StartSubProcess=function(e,t){return this.LisaTechAgent.StartSubProcess(e,t)},t.TechLibrary.prototype.StartExternalApp=function(e,t,n){return this.LisaTechAgent.StartExternalApp(e,t,n)},t.TechLibrary.prototype.GetProcesses=function(){return this.LisaTechAgent.GetProcesses()},t.TechLibrary.prototype.GetTools=function(){return this.LisaTechAgent.GetTools()},t.TechLibrary.prototype.GetCodesProcessus=function(){return this.LisaTechAgent.GetCodesProcessus()},t.TechLibrary.prototype.GetInfoProcessus=function(e){return this.LisaTechAgent.GetInfoProcessus(e)}}(MyWay=MyWay||{}),function(e){var t,r,n,o;function i(){return n.call(this)||this}t=e.Services||(e.Services={}),r=t.Lisa||(t.Lisa={}),n=r.LisaAgent,__extends(i,n),i.prototype.StartProcess=function(e,t,n){return this.sendMessage(r.Messages.LisaMessageSubject.StartProcess,{processCode:e,initData:t,valeurDepart:n})},i.prototype.StartSubProcess=function(e,t){return this.sendMessage(r.Messages.LisaMessageSubject.StartSubProcess,{processCode:e,valeurDepart:t})},i.prototype.StartExternalApp=function(e,t,n){return this.sendMessage(r.Messages.LisaMessageSubject.StartExternalApp,{name:e,url:t,standAlone:n})},i.prototype.GetProcesses=function(){return this.library.Core.createPromiseSelfError(new t.Erreur("Not implemented"))},i.prototype.GetTools=function(){return this.sendMessage(r.Messages.LisaMessageSubject.GetTools,{})},i.prototype.GetCodesProcessus=function(){return this.sendMessage(r.Messages.LisaMessageSubject.GetCodesProcessus,{})},i.prototype.GetInfoProcessus=function(e){return this.sendMessage(r.Messages.LisaMessageSubject.GetInfoProcessus,{codeProcessus:e})},o=i,r.LisaTechAgent=o,t.Components.RegistryAgent.getInstance().register(o)}(MyWay=MyWay||{}),function(o){var i,s,r,e;function a(){var e=r.call(this,i.Components.ComponentType.Capacites)||this;return e._isTotemCapable=!0,e}i=o.Services||(o.Services={}),s=i.Capacites||(i.Capacites={}),r=i.Components.ComponentApiBase,__extends(a,r),a.prototype.init=function(e,t,n){return this.capabilities=e,r.prototype.init.call(this,e,t,n)},a.prototype.setTotemCapable=function(e){this._isTotemCapable=e},a.prototype.resolve=function(e){var n=i.CoreCommon.ServiceDePromesse.defer();switch(e){case s.REGLE.MODIFIER_HABILITATION:var t=this.libraryManager.Context.GetFromContext(a.URL_SPA_KEY);/myway-[pP]+/.test(t)?n.resolve(!1):n.resolve(!0),i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.MODIFIER_HABILITATION"),a.logger.debug("GetFromContext of URL_SPA_KEY Success");break;case s.REGLE.CAISSE_AUTO:this.libraryManager.Mobilite.getPeripheriquesParType(i.Mobilite.TYPE_PERIPHERIQUE.CAISSE_AUTO).then(function(e){0<e.length?n.resolve(!0):n.resolve(!1),i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.CAISSE_AUTO"),a.logger.debug("getPeripheriquesParType Success")}).catch(function(e){i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.CAISSE_AUTO"),a.logger.error("getPeripheriquesParType failed - %1",JSON.stringify(e)),n.reject(e)});break;case s.REGLE.ECRAN_COMPATIBLE_MYWAY:this.libraryManager.Mobilite.getInfoMachine().then(function(e){var t=e.hauteurEcran&&e.hauteurEcran>=a.HAUTEUR_MINIMALE_MYWAY&&e.largeurEcran&&e.largeurEcran>=a.LARGEUR_MINIMALE_MYWAY;!0===t?n.resolve(!0):n.resolve(!1),i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.ECRAN_COMPATIBLE_MYWAY"),a.logger.debug("getInfoMachine Success - %1",t)}).catch(function(e){i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.ECRAN_COMPATIBLE_MYWAY"),a.logger.error("getInfoMachine failed - %1",JSON.stringify(e)),n.reject(e)});break;case s.REGLE.INTEROP_APPLI_BANCAIRE:i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.INTEROP_APPLI_BANCAIRE"),a.logger.debug("deviceCapabilities.InteropAppliBancaire Success - %1",this.capabilities.InteropAppliBancaire),n.resolve(this.capabilities.InteropAppliBancaire);break;case s.REGLE.INTEROP_WINDOWS:i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.INTEROP_WINDOWS"),a.logger.debug("deviceCapabilities.ServiceLocal Success - %1",this.capabilities.ServiceLocal),n.resolve(this.capabilities.ServiceLocal);break;case s.REGLE.RESEAU_INTERNE:this.libraryManager.Mobilite.getReseau().then(function(e){e===i.Mobilite.TYPE_RESEAU.FILAIRE||e===i.Mobilite.TYPE_RESEAU.WIFI_AGENCE||e===i.Mobilite.TYPE_RESEAU.VPN?n.resolve(!0):n.resolve(!1),i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.RESEAU_INTERNE"),a.logger.debug("getReseau Success - %1",e)}).catch(function(e){i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.RESEAU_INTERNE"),a.logger.error("getReseau failed - %1",JSON.stringify(e)),n.reject(e)});break;case s.REGLE.TABLETTE_SIGNATURE:this.libraryManager.Mobilite.getPeripheriquesParType(i.Mobilite.TYPE_PERIPHERIQUE.TABLETTE_SIGNATURE).then(function(e){0<e.length?n.resolve(!0):n.resolve(!1),i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.TABLETTE_SIGNATURE"),a.logger.debug("getPeripheriquesParType Success - %1",JSON.stringify(e))}).catch(function(e){i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.TABLETTE_SIGNATURE"),a.logger.error("getPeripheriquesParType failed - %1",JSON.stringify(e)),n.reject(e)});break;case s.REGLE.CONNECTE:this.libraryManager.Mobilite.getReseau().then(function(e){e!==i.Mobilite.TYPE_RESEAU.DECONNECTE?n.resolve(!0):n.resolve(!1),i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.CONNECTE"),a.logger.debug("getReseau Success - %1",e)}).catch(function(e){i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.CONNECTE"),a.logger.error("getReseau failed - %1",JSON.stringify(e)),n.reject(e)});break;case s.REGLE.PORTAIL_MYWAY:i.Loggers.FLASH.INSTANCE.setValue("action","REGLE.PORTAIL_MYWAY"),a.logger.debug("deviceCapabilities.PORTAIL_MYWAY Success - %1",this._isTotemCapable),n.resolve(this._isTotemCapable);break;default:var r=new i.Erreur(o.Services.Libelle.LibelleModel.COM.ERREUR_CAPACITES_REGLE_INCONNU);a.logger.error("Règle capacité inconnue"),n.reject(r)}return n.promise},a.CLASS_NAME="MyWay.Services.Capacites.CapacitesApi",a.logger=i.Loggers.LoggerFactory.INSTANCE.getClass(a.CLASS_NAME),a.URL_SPA_KEY="URL-SPA",a.LARGEUR_MINIMALE_MYWAY=1280,a.HAUTEUR_MINIMALE_MYWAY=800,e=a,s.CapacitesApi=e,i.Components.RegistryApi.getInstance().register(e)}(MyWay=MyWay||{}),function(t){var p;(function(a){var o,e=(o=p.Components.ComponentManagerBase,__extends(c,o),c.prototype.init=function(e,t,n,r){return this.api=r,o.prototype.init.call(this,e,t,n,r)},c.prototype.getAuthentificationInfo=function(){return this.library.Context.getAuthentificationInfo().catch(function(e){throw c.logger.error("Les données d'authentification n'ont pas pu être récupérées"),new p.Erreur(p.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,["Les données d'authentification n'ont pas pu être récupérées"])})},c.prototype.gererErreur=function(e){return c.logger.error(e),this.library.Core.createPromiseSelfError(new p.Erreur(p.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,[e]))},c.prototype.generer=function(n,r){var e,o=this;return c.logger.debug("Start API Impression.generer"),""!==(e=a.controleGenerer(n,r))?this.gererErreur(e):this.getAuthentificationInfo().then(function(e){var t=new u(r);return o.api.genererDocument(n,t,e).then(function(e){return c.logger.debug("ServiceApi.Impression.genererDocument success"),e},function(e){throw c.logger.error("ServiceApi.Impression.genererDocument failed - %1",JSON.stringify(e)),e})})},c.prototype.imprimer=function(e,t){var n;if(c.logger.debug("Start API Impression.imprimer"),""!==(n=a.controleImprimer(e,t)))return this.gererErreur(n);var r=new l(t);return this.api.imprimerDocument(e,r)},c.prototype.imprimerLot=function(t,r){var e,o=this;return c.logger.debug("Start API Impression.imprimerLot"),""!==(e=a.controleImprimerLot(t,r))?this.gererErreur(e):this.library.Core.promesseTryCatch(function(n){o.getAuthentificationInfo().then(function(e){o.library.Libelle.afficherMessage("Récupération des documents en GED en cours. Merci de patienter.",p.Libelle.TYPE_AFFICHAGE.VIDE,null,0,null,function(){o.api.getDocumentGEDLot(t,e).then(function(e){t=e,o.library.Display.FermerModalMessage()}).then(function(){var e=new i(r);return o.api.imprimerDocumentLot(t,e).then(n.resolve,n.reject)}).catch(function(e){var t="Une erreur est survenue lors de la récupération de document en GED : {0}";t=t.replace("{0}",e.codeLibelle),o.library.Display.FermerModalMessage(),o.gererErreur(t).then(n.resolve,n.reject)})})},n.reject)})},c.prototype.genererImprimer=function(o,i){var e,s=this;return c.logger.debug("Start API Impression.genererImprimer"),""!==(e=a.controleGenererImprimer(o,i))?this.gererErreur(e):this.library.Core.promesseTryCatch(function(r){s.getAuthentificationInfo().then(function(e){var t=new u(i),n=new l(i);c.logger.debug("Contrôle de paramètres OK"),s.library.Libelle.afficherMessage(p.Libelle.LibelleModel.TEC.IMPRESSION_GENERATION_IMPRESSION_EN_COURS,p.Libelle.TYPE_AFFICHAGE.VIDE,null,0,null,function(){c.logger.debug("Modale ouverte -> Appel au service de génération"),s.api.genererDocument(o,t,e).then(function(e){p.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e)?s.api.imprimerDocument(e.Fichier,n).then(function(){s.library.Display.FermerModalMessage(),r.resolve(e)},function(e){s.library.Display.FermerModalMessage(),c.logger.error("ServiceApi.Impression.genererDocument Failed - %1",JSON.stringify(e)),r.reject(e)}):s.gererErreur("Erreur: document non généré").then(r.resolve,function(e){s.library.Display.FermerModalMessage(),c.logger.error("ServiceApi.Impression.genererDocument Failed - %1",JSON.stringify(e)),r.reject(e)})},function(e){s.library.Display.FermerModalMessage(),c.logger.error("ServiceApi.Impression.genererDocument Failed - %1",JSON.stringify(e)),r.reject(e)})})})})},c.prototype.getJsonConverti=function(t){return this.api.getJsonConverti(t).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),c.logger.debug("getJsonConverti Success"),p.Promesses.createPromiseSelfResolved(e)}).catch(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",t),c.logger.error("getJsonConverti failed - %1",JSON.stringify(e)),p.Promesses.createPromiseSelfError(e)})},c.CLASS_NAME="MyWay.Services.Impression.ImpressionManager",c.logger=p.Loggers.LoggerFactory.INSTANCE.getClass(c.CLASS_NAME),c);function c(){var e=o.call(this,p.Components.ComponentType.Impression)||this;return e.api=null,e}a.ImpressionManager=e;var u=function(e){this.serializedGenerationParams={},this.serializedGenerationParams.parametreGenerationSysteme=e.systeme,this.serializedGenerationParams.parametresGenerationObligatoires={},this.serializedGenerationParams.parametresGenerationObligatoires.action=t.Services.CoreCommon.EnumUtils.getName(a.GENERATION_ACTION,e.obligatoires.action),this.serializedGenerationParams.parametresGenerationObligatoires.parametresGenerationFichier={typeFichier:t.Services.CoreCommon.EnumUtils.getName(p.Fichier.TYPE_FICHIER,e.obligatoires.parametresGenerationFichier.typeFichier),restitutionVersion:e.obligatoires.parametresGenerationFichier.restitutionVersion,sousRepModele:e.obligatoires.parametresGenerationFichier.sousRepModele},this.serializedGenerationParams.parametresGenerationOptionnels={archivage:e.optionnels.archivage,blocGenerique:null}},l=function(e){this.serializedImpressionParams={},this.serializedImpressionParams.obligatoires={nomFichier:e.obligatoires.nomFichier},this.serializedImpressionParams.optionnels={},this.serializedImpressionParams.optionnels.parametreActiveX={annul:!1,voir:!1,enregistrer:!1,blocnbex:!1,nbcopiesdef:0},p.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX)&&p.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e.optionnels.parametreActiveX)&&(p.Controle.StaticBooleanControle.isBoolean(e.optionnels.parametreActiveX.annul)&&(this.serializedImpressionParams.optionnels.parametreActiveX.annul=e.optionnels.parametreActiveX.annul),p.Controle.StaticBooleanControle.isBoolean(e.optionnels.parametreActiveX.voir)&&(this.serializedImpressionParams.optionnels.parametreActiveX.voir=e.optionnels.parametreActiveX.voir),p.Controle.StaticBooleanControle.isBoolean(e.optionnels.parametreActiveX.enregistrer)&&(this.serializedImpressionParams.optionnels.parametreActiveX.enregistrer=e.optionnels.parametreActiveX.enregistrer),p.Controle.StaticBooleanControle.isBoolean(e.optionnels.parametreActiveX.blocnbex)&&(this.serializedImpressionParams.optionnels.parametreActiveX.blocnbex=e.optionnels.parametreActiveX.blocnbex),p.Controle.StaticNumberControle.isNumber(e.optionnels.parametreActiveX.mincop)&&(this.serializedImpressionParams.optionnels.parametreActiveX.mincop=e.optionnels.parametreActiveX.mincop),p.Controle.StaticNumberControle.isNumber(e.optionnels.parametreActiveX.nbcopiesdef)&&(this.serializedImpressionParams.optionnels.parametreActiveX.nbcopiesdef=e.optionnels.parametreActiveX.nbcopiesdef>=this.serializedImpressionParams.optionnels.parametreActiveX.mincop?e.optionnels.parametreActiveX.nbcopiesdef:this.serializedImpressionParams.optionnels.parametreActiveX.mincop),p.Controle.StaticNumberControle.isNumber(e.optionnels.parametreActiveX.maxcop)&&(this.serializedImpressionParams.optionnels.parametreActiveX.maxcop=e.optionnels.parametreActiveX.maxcop))},i=function(e){this.serializedImpressionParams={annul:!1,impdef:!1,affred:!1,reimp:!1},p.Controle.StaticAnyControle.isNotUndefinedAndNotNull(e)&&(p.Controle.StaticBooleanControle.isBoolean(e.annul)&&(this.serializedImpressionParams.annul=e.annul),p.Controle.StaticBooleanControle.isBoolean(e.impdef)&&(this.serializedImpressionParams.impdef=e.impdef),p.Controle.StaticBooleanControle.isBoolean(e.affred)&&(this.serializedImpressionParams.affred=e.affred),p.Controle.StaticBooleanControle.isBoolean(e.reimp)&&(this.serializedImpressionParams.reimp=e.reimp))};p.Components.RegistryManager.getInstance().register(e)})((p=t.Services||(t.Services={})).Impression||(p.Impression={}))}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Mobilite)||this}t=e.Services||(e.Services={}),n=t.Mobilite||(t.Mobilite={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.reception=function(e){switch(e.subject){case n.Messages.MobiliteMessageSubject.GetInfoMachine:return e.message,this.managerInstance.getInfoMachine();case n.Messages.MobiliteMessageSubject.GetPeripheriques:return e.message,this.managerInstance.getPeripheriques();case n.Messages.MobiliteMessageSubject.GetPeripheriquesParType:var t=e.message.typePeripherique;return this.managerInstance.getPeripheriquesParType(t);case n.Messages.MobiliteMessageSubject.GetReseau:return e.message,this.managerInstance.getReseau();default:return r.prototype.reception.call(this,e)}},i.CLASS_NAME="MyWay.Services.Mobilite.MobiliteManagerMessage",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.MobiliteManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.TraceSuivi||(t.TraceSuivi={})).VERSION_BASE=10,n.DB_TRACES_NAME="DBTraceSuivi",n.DB_TABLE_TRACES="tracessuivi"}(MyWay=MyWay||{}),function(e){var g;(function(e){var p,t;(t=p=e.EventSizeChangeType||(e.EventSizeChangeType={}))[t.SET=0]="SET",t[t.ADD=1]="ADD";var n=(f.prototype.get=function(c){var e=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(a){e.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var o=t.objectStore(f.TABLE_NOM),i=[],s=function(t){if(t>=c.length)a.resolve(i);else{var n=c[t],r=o.get(n);r.onsuccess=function(e){r.result?i.push({cle:n,element:r.result}):(i.push(null),console.warn("Trace "+n+" isn't found!")),s(t+1)},r.onerror=function(e){console.error(e),a.reject(new g.Erreur("Erreur lors de la purge des traces de la base de données - Moment de la lecture"))}}};s(0)})});var r=[];return this.memoryDB.forEach(function(t){var n=null;c.every(function(e){return e===t.id&&(n=t),null===n}),r.push(e.elementToInstanceAvecCle(n))}),this.library.Core.createPromiseSelfResolved(r)},f.prototype.getAll=function(){var t=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){t.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).openCursor(),o=[];n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value,r=t.key;o.push({cle:r,element:n}),t.continue()}else i.resolve(o)},n.onerror=function(e){console.error(e),i.reject(new g.Erreur("Erreur lors du comptage du nombre de traces"))}})});var n=[];return this.memoryDB.forEach(function(e){n.push(t.elementToInstanceAvecCle(e))}),this.library.Core.createPromiseSelfResolved(n)},f.prototype.chercher=function(s){var a=this;if(!s)return this.getAll();if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){a.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).openCursor(),o=[];n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;if(a.testTrace(n,s)){var r=t.key;o.push({cle:r,element:n})}t.continue()}else i.resolve(o)},n.onerror=function(e){console.error(e),i.reject(new g.Erreur("Erreur lors du comptage du nombre de traces"))}})});var t=[];return this.memoryDB.forEach(function(e){a.testTrace(e,s)&&t.push(a.elementToInstanceAvecCle(e))}),this.library.Core.createPromiseSelfResolved(t)},f.prototype.count=function(e){var t=this;return e||!this.hasIndexedDb?this.chercher(e).then(function(e){return e.length}):this.library.Core.promesseTryCatch(function(r){t.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).count();n.onsuccess=function(){var e=n.result;r.resolve(e)},n.onerror=function(e){console.error(e),r.reject(new g.Erreur("Erreur lors du comptage du nombre de traces"))}})})},f.prototype.ajouter=function(a){var c=this;return this.hasIndexedDb?this.library.Core.promesseTryCatch(function(s){c.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(f.TABLE_NOM),o=0,i=function(e){if(e>=a.length)return c.onSizeChange(o,p.ADD),void s.resolve();var t=a[e];o+=JSON.stringify(t.trace).length;var n=r.add(t);n.onsuccess=function(){i(e+1)},n.onerror=function(e){console.error(e),s.reject(new g.Erreur("Erreur lors de la sauvegarde d'une trace"))}};i(0)})}):(a.forEach(function(e){void 0===e.id?e.id=c.memoryDBAutoincrement++:e.id>c.memoryDBAutoincrement&&(c.memoryDBAutoincrement=e.id+1),c.memoryDB.push(e)}),this.library.Core.getPromesseSelfResoved())},f.prototype.supprimer=function(u){var l=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(c){l.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var i=t.objectStore(f.TABLE_NOM),s=0,a=function(n){if(n>=u.length)return l.onSizeChange(-1*s,p.ADD),void c.resolve();var r=u[n],o=i.get(r);o.onsuccess=function(e){if(!o.result)return console.warn("Trace "+r+" isn't found!"),void a(n+1);s+=JSON.stringify(o.result.trace).length;var t=i.delete(r);t.onsuccess=function(){a(n+1)},t.onerror=function(e){console.error(e),c.reject(new g.Erreur("Erreur lors de la purge des traces de la base de données - Moment de la suppression"))}},o.onerror=function(e){console.error(e),c.reject(new g.Erreur("Erreur lors de la purge des traces de la base de données - Moment de la lecture"))}};a(0)})});var e=[];return this.memoryDB.forEach(function(t){var n=!1;u.every(function(e){return!(n=e===t.id)}),n||e.push(t)}),this.memoryDB=e,this.library.Core.getPromesseSelfResoved()},f.prototype.mettreAJour=function(s){var o=this;if(this.hasIndexedDb)return this.library.Core.promesseTryCatch(function(i){o.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var r=t.objectStore(f.TABLE_NOM),o=function(e){if(e>=s.length)i.resolve();else{var t=s[e],n=r.put(t.element,t.cle);n.onsuccess=function(){o(e+1)},n.onerror=function(e){console.error(e),i.reject(new g.Erreur("Erreur lors du reset de la base de données"))}}};o(0)})});var e=[];return s.forEach(function(n){var r=!1;o.memoryDB.every(function(e,t){return n.cle===e.id&&(o.memoryDB[t]=n.element,r=!0),!r}),r||e.push(n.element)}),0<e.length?this.ajouter(e):this.library.Core.getPromesseSelfResoved()},f.prototype.resetAll=function(){var o=this;return this.hasIndexedDb?this.library.Core.promesseTryCatch(function(r){o.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readwrite");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).clear();n.onsuccess=function(e){o.onSizeChange(0,p.SET),r.resolve()},n.onerror=function(e){console.error(e),r.reject(new g.Erreur("Erreur lors du reset de la base de données"))}})}):(this.memoryDB.length=0,this.library.Core.getPromesseSelfResoved())},f.prototype.getTracesToPurge=function(){var e=this;if(!this.hasIndexedDb)return this.library.Core.createPromiseSelfResolved(this.memoryDB);var o=[];return this.library.Core.promesseTryCatch(function(r){e.actionOnDB(function(e){var t=e.transaction([f.TABLE_NOM],"readonly");t.oncomplete=function(){e.close()},t.onabort=t.oncomplete;var n=t.objectStore(f.TABLE_NOM).openCursor();n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;n.id=t.key,o.push(n),t.continue()}else r.resolve(o)},n.onerror=function(e){console.error(e),r.reject(new g.Erreur("Erreur lors de la récupération des traces à purger"))}})})},f.prototype.actionOnDB=function(n){var e=window.indexedDB.open("myway_stc_traces_suivis",f.VERSION);e.onupgradeneeded=function(e){var t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore("traces_suivis",{autoIncrement:!0})}},e.onsuccess=function(e){var t=e.target.result;n(t)}},f.prototype.testTrace=function(e,t){return!!e.trace.processIdCurrent.match(t)},f.prototype.elementToInstanceAvecCle=function(e){return e?{cle:e.id,element:e}:null},f.VERSION=1,f.TABLE_NOM="traces_suivis",f);function f(e,t,n){this.hasIndexedDb=e,this.library=t,this.onSizeChange=n,this.memoryDB=[],this.memoryDBAutoincrement=0}e.TraceSuiviDB=n})((g=e.Services||(e.Services={})).TraceSuivi||(g.TraceSuivi={}))}(MyWay=MyWay||{}),function(e){var m;(function(s){var a,e,c=!1,u=0,i=0;(e=a=a||{})[e.DEBUT="DEBUT"]="DEBUT",e[e.FIN="FIN"]="FIN";var l,t=(l=m.Components.ComponentManagerBase,__extends(p,l),p.prototype.init=function(e,t,n,r){var o=this;return this.api=r,l.prototype.init.call(this,e,t,n,r).then(function(){return o.storageInstanceSize=o.library.Persistence.addStorage("traces_suivis_size",function(e){i=e.newSize}),o.storageInstancePurge=o.library.Persistence.addStorage("traces_suivis_size",function(e){c=e.action===a.FIN,u=e.nbPurgesError}),m.BaseDeDonnees.Generique.Factory.testImplementationIndexeddb().then(function(n){return o.traceSuiviDB=new s.TraceSuiviDB(n,o.library,function(e,t){if(n){switch(t){case s.EventSizeChangeType.ADD:i+=e;break;case s.EventSizeChangeType.SET:i=e;break;default:p.logger.error("L'evennement de type %1 n'est pas geré par le callback onSizeChanged() sur la base de données des traces de suivis",t)}o.storageInstanceSize.saveValue({newSize:i})}}),o.library.BaseDeDonnees.enregistrerDB("TRACE_SUIVIS",{version:s.TraceSuiviDB.VERSION,implementation:n?m.BaseDeDonnees.BaseDeDonneesImplementation.INDEXEDDB:m.BaseDeDonnees.BaseDeDonneesImplementation.MEMORY,getTables:function(){return[s.TraceSuiviDB.TABLE_NOM]},getTable:function(e){switch(e){case s.TraceSuiviDB.TABLE_NOM:return o.traceSuiviDB;default:return null}}}),o.traceSuiviDB.getAll().then(function(e){var t=0;e.forEach(function(e){e&&(t+=JSON.stringify(e.element.trace).length)}),i=t,o.storageInstanceSize.saveValue({newSize:i})})})}).then(function(){o.library.Context.addListenerOnTerminerProcessus(o.onCallbackOnFinProcessus)})},p.prototype.dispose=function(){return this.library.Context.removeListenerOnTerminerProcessus(this.onCallbackOnFinProcessus),l.prototype.dispose.call(this)},p.prototype.recupererInfos=function(t,e){if(this.library.Context){var n=this.library.Context.GetAuthentificationInfo();n&&(t.establishment=e&&void 0!==t.establishment?t.establishment:n.codeEtablissement,t.deviceId=e&&void 0!==t.deviceId?t.deviceId:n.numeroStationTravail,n.agentConnecte&&(t.agentCode=e&&void 0!==t.agentCode?t.agentCode:n.agentConnecte.referenceExterneAgent,t.computerEdsInternalId=e&&void 0!==t.computerEdsInternalId?t.computerEdsInternalId:n.agentConnecte.numeroInterneEds,t.agentEdsType=e&&void 0!==t.agentEdsType?t.agentEdsType:n.agentConnecte.typeEdsRattachement,t.agentEdsCode=e&&void 0!==t.agentEdsCode?t.agentEdsCode:n.agentConnecte.referenceExterneEdsRattachemen,t.agentEdsInternalRef=e&&void 0!==t.agentEdsInternalRef?t.agentEdsInternalRef:n.agentConnecte.numeroEdsSuperieur));var r=new Date,o=r.getTimezoneOffset(),i=Math.floor(Math.abs(o/60)),s=Math.abs(o)-60*i,a=(o<0?"+":"-")+m.CoreCommon.StringUtils.leftPad(i,"0",2)+m.CoreCommon.StringUtils.leftPad(s,"0",2);null!==t.dateUse&&void 0!==t.dateUse||(t.dateUse=r.getTime()),t.timezone=e&&void 0!==t.timezone?t.timezone:a,t.computerSi=e&&void 0!==t.computerSi?t.computerSi:m.CoreCommon.VersionMySys;var c=this.library.Context.GetPortalContext().currentPath;this.SetProcessAndStepId(t,c,e),null!==t.data&&void 0!==t.data||(t.data={});var u=this.library.Context.GetCurrentStepInfo();if(u&&u.BusinessCode?t.processIdBusiness=e&&void 0!==t.processIdBusiness?t.processIdBusiness:u.BusinessCode:t.processIdBusiness=e&&void 0!==t.processIdBusiness?t.processIdBusiness:"",u&&u.Contrats)for(var l=0;l<u.Contrats.length;l++){var p=u.Contrats[l];if(p){var f=p.NomData;0<p.NomData.indexOf("=>")&&(f=p.NomData.split("=>")[1]);var g=this.library.Context.GetFromContext(f);if(null!=g){var h=0;"object"==typeof g?h=JSON.stringify(g).length:"string"==typeof g&&(h=g.trim().length),0<h&&h<50&&(t.data[f]=e&&void 0!==t.data[f]?t.data[f]:g)}}}return this.library.Mobilite.getReseau().then(function(e){switch(e){case m.Mobilite.TYPE_RESEAU.CONNECTE:case m.Mobilite.TYPE_RESEAU.INCONNU:t.deviceType="I";break;case m.Mobilite.TYPE_RESEAU.DECONNECTE:t.deviceType="D";break;case m.Mobilite.TYPE_RESEAU.FILAIRE:t.deviceType="F";break;case m.Mobilite.TYPE_RESEAU.VPN:t.deviceType="V";break;case m.Mobilite.TYPE_RESEAU.WIFI_AGENCE:t.deviceType="W";break;default:t.deviceType="I"}}).catch(function(){t.deviceType="I"}).then(function(){return t})}var d=m.CoreCommon.ServiceDePromesse.defer();return d.resolve(t),d.promise},p.prototype.SetProcessAndStepId=function(e,t,n){var r=m.Context.PortalContext.GetPathPart(t,m.Context.PATH_PART.MAIN_PROCESS_ID),o=m.Context.PortalContext.GetPathPart(t,m.Context.PATH_PART.LAST_PROCESS_ID),i=m.Context.PortalContext.GetPathPart(t,m.Context.PATH_PART.STEP_ID);e.processIdMaster=n&&void 0!==e.processIdMaster?e.processIdMaster:this.CleanProcessId(r,20),e.processIdCurrent=n&&void 0!==e.processIdCurrent?e.processIdCurrent:this.CleanProcessId(o,20),e.stepIdCurrent=n&&void 0!==e.stepIdCurrent?e.stepIdCurrent:this.CleanStepId(i,20,24)},p.prototype.GetCodeAndUId=function(e,t){if(!e)return null;var n=e.lastIndexOf(t);return 0<=n?{code:e.substring(0,n),uid:e.substring(n+1,e.length)}:null},p.prototype.CleanProcessId=function(e,t){if(!e)return e;var n=this.GetCodeAndUId(e,"-");if(n){var r=n.code,o=n.uid;return r.length>t&&(r=r.substring(0,t)),r+"-"+o}return e.length>t+9?e.substring(0,t+9):e},p.prototype.CleanStepId=function(e,t,n){if(!e)return e;var r=this.GetCodeAndUId(e,"-");if(r){var o=r.code,i=r.uid,s=this.GetCodeAndUId(o,":");if(s){var a=s.code,c=s.uid;a.length>t&&(a=a.substring(0,t));var u=this.GetCodeAndUId(c,"_");if(u){var l=u.code,p=u.uid;l.length>t&&(l=l.substring(0,t)),c=l+"_"+p}else c.length>t&&(c=c.substring(0,t));o=a+":"+c}else o.length>t+n+1&&(o=o.substring(0,t+n+1));return o+"-"+i}return e.length>t+n+1+9?e.substring(0,t+n+1+9):e},p.prototype.tracer=function(e,t){var n=this,r=m.CoreCommon.ServiceDePromesse.defer();return this.ecrituresTracesEnCours.push(r.promise),this.recupererInfos(e,!1===t).then(function(e){return e.processIdMaster&&0===e.processIdMaster.indexOf("TECH_")?(r.resolve(),n.checkTailleDB()):n.recordInIDB(e).then(function(e){return r.resolve(),e})})},p.prototype.recordInIDB=function(e){var t=this;p.logger.debug("Ecriture d'une trace de suivi %1",JSON.stringify(e));var n={trace:e,datePurge:null,nbEssais:0};return this.traceSuiviDB.ajouter([n]).then(function(){return t.checkTailleDB()})},p.prototype.checkTailleDB=function(e){var t=this;return null!==this.timerRunPurge&&(clearTimeout(this.timerRunPurge),this.timerRunPurge=null),this.timerRunPurge=setTimeout(function(){t.purgerTraces()},this.PURGE_TIME_WAIT_NEXT_TRACE),this.library.Core.createPromiseSelfResolved(0)},p.prototype.purgerTraces=function(){var i=this;if(!c){null!==this.timerRunPurge&&(clearTimeout(this.timerRunPurge),this.timerRunPurge=null),c=!0,this.doitRelancerPurge=!1,this.storageInstancePurge.saveValue({action:a.DEBUT,nbPurgesError:u});var t=0,e=this.ecrituresTracesEnCours;return this.ecrituresTracesEnCours=[],p.logger.debug("Demarrage de la purge des traces de suivi"),m.CoreCommon.ServiceDePromesse.all(e).then(function(){},function(e){}).then(function(){var n=[],r=[],o=[];return i.traceSuiviDB.getTracesToPurge().then(function(e){if(0===e.length)return c=!1,void i.storageInstancePurge.saveValue({action:a.FIN,nbPurgesError:u});var t=(new Date).getTime();return e.forEach(function(e){e.datePurge=t,n.push(e.trace),r.push({cle:e.id,element:e}),o.push(e.id)}),i.traceSuiviDB.mettreAJour(r)}).then(function(){return i.library.Context.getAuthentificationInfo()}).then(function(e){return i.api.envoyerTracesSuivi(n,e)}).then(function(){return u=0,t=o.length,i.traceSuiviDB.supprimer(o)},function(e){return t=0,console.error(e),i.finDePurgeFail(r)}).finally(function(){c=!1,i.storageInstancePurge.saveValue({action:a.FIN,nbPurgesError:u}),i.doitRelancerPurge&&i.purgerTraces()}).then(function(){return t})})}},p.prototype.finDePurgeFail=function(e){var t=this;if(!(5<=++u)){var n=[],r=[];return e.forEach(function(e){e.element.nbEssais<5?(e.element.nbEssais++,n.push(e)):r.push(e.cle)}),this.traceSuiviDB.mettreAJour(n).then(function(){return t.traceSuiviDB.supprimer(r)}).then(function(){0<n.length&&p.logger.warn("Des traces n'ont pas pu être envoyées, incrémentation de leur compteur de tentative d'envois"),0<r.length&&p.logger.warn("Des traces ont atteint leur quota de tentative d'envois, elles sont donc supprimées")})}},p.CLASS_NAME="MyWay.Services.Lisa.TraceSuiviManager",p.logger=m.Loggers.LoggerFactory.INSTANCE.getClass(p.CLASS_NAME),p);function p(){var i=l.call(this,m.Components.ComponentType.TraceSuivi)||this;return i.tempsDePurgeMax=120,i.storageInstanceSize=null,i.storageInstancePurge=null,i.nombreMaximumDeTraceAvantPurge=20,i.traceSuiviDB=null,i.api=null,i.timerRunPurge=null,i.PURGE_TIME_WAIT_NEXT_TRACE=2e3,i.onCallbackOnFinProcessus=function(e){!function(e){var t,n;for(var r in e.subElements){var o=e.subElements[r];if(o.getPath()===e.getPath()){"ProcessStep"===o.type?((t=new s.TraceSuiviModel).state="FE",i.library.TraceSuivi.SetProcessAndStepId(t,o.getPath(),!1),i.library.TraceSuivi.tracer(t,!1)):"Process"==o.type&&i.onCallbackOnFinProcessus(o);break}}t=new s.TraceSuiviModel,n=e.isSubProcess?(t.state="FS",e.id+"|"):(t.state="FP",e.id+"|"+e.id+"|"),i.library.TraceSuivi.SetProcessAndStepId(t,n,!1),i.library.TraceSuivi.tracer(t,!1)}(e),i.library.TraceSuivi.purgerTraces()},i.ecrituresTracesEnCours=[],i.doitRelancerPurge=!1,i}s.TraceSuiviManager=t,m.Components.RegistryManager.getInstance().register(t)})((m=e.Services||(e.Services={})).TraceSuivi||(m.TraceSuivi={}))}(MyWay=MyWay||{}),function(e){var t,i,s,n;function r(){return s.call(this,t.Components.ComponentType.Numerisation)||this}t=e.Services||(e.Services={}),i=t.Numerisation||(t.Numerisation={}),s=t.Components.ComponentManagerMessageBase,__extends(r,s),r.prototype.reception=function(e){switch(e.subject){case i.NumerisationMessageSubject.Numeriser:var t=(r=e.message).data,n=r.numerisationParams;return this.managerInstance.numeriser(t,n);case i.NumerisationMessageSubject.GetSpiFactoryActivationStatut:var r=e.message;return this.managerInstance.getSpiFactoryActivationStatut();case i.NumerisationMessageSubject.NumeriserArcade:t=(r=e.message).data;var o=r.numerisationParams;return this.managerInstance.numeriserArcade(t,o);default:return s.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.Numerisation.NumerisationManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,i.NumerisationManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,a,c,n;function r(){return c.call(this,t.Components.ComponentType.Impression)||this}t=e.Services||(e.Services={}),a=t.Impression||(t.Impression={}),c=t.Components.ComponentManagerMessageBase,__extends(r,c),r.prototype.reception=function(e){switch(e.subject){case a.Messages.ImpressionMessageSubject.Generer:var t=(i=e.message).data,n=i.generationParams;return this.managerInstance.generer(t,n);case a.Messages.ImpressionMessageSubject.GetJsonConverti:return t=(i=e.message).data,this.managerInstance.getJsonConverti(t);case a.Messages.ImpressionMessageSubject.Imprimer:t=(i=e.message).data;var r=i.impressionParams;return this.managerInstance.imprimer(t,r);case a.Messages.ImpressionMessageSubject.ImprimerLot:t=(i=e.message).data;var o=i.parametresActiveXGlobaux;return this.managerInstance.imprimerLot(t,o);case a.Messages.ImpressionMessageSubject.GenererImprimer:t=(i=e.message).data;var i,s=i.generationImpressionParams;return this.managerInstance.genererImprimer(t,s);default:return c.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.Impression.ImpressionManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,a.ImpressionManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(t){var n,r,o,e;function i(){var e=o.call(this,n.Components.ComponentType.Capacites)||this;return e.api=null,e}n=t.Services||(t.Services={}),r=n.Capacites||(n.Capacites={}),o=n.Components.ComponentManagerBase,__extends(i,o),i.prototype.init=function(e,t,n,r){return this.api=r,this.api.setTotemCapable(n.isTotemCapable),o.prototype.init.call(this,e,t,n)},i.prototype.getCapacite=function(e){return void 0===r.REGLE[e]?(i.logger.error("Règle capacité inconnue"),n.Promesses.createPromiseSelfError(new n.Erreur(t.Services.Libelle.LibelleModel.COM.ERREUR_CAPACITES_REGLE_INCONNU))):this.api.resolve(e).then(function(e){return i.logger.debug("resolve success - %1",e),e}).catch(function(e){throw i.logger.error("resolve failed - %1",JSON.stringify(e)),e})},i.CLASS_NAME="MyWay.Services.Capacites.CapacitesManager",i.logger=n.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),e=i,r.CapacitesManager=e,n.Components.RegistryManager.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.TraceSuivi)||this}t=e.Services||(e.Services={}),n=t.TraceSuivi||(t.TraceSuivi={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.reception=function(e){switch(e.subject){case n.Messages.TraceSuiviMessageSubject.SendTraceSuivi:var t=e.message.trace;return this.managerInstance.tracer(t);case n.Messages.TraceSuiviMessageSubject.SendTraceSuiviForcee:return t=e.message.trace,this.managerInstance.tracer(t,!1);default:return r.prototype.reception.call(this,e)}},i.CLASS_NAME="MyWay.Services.Lisa.TraceSuiviManagerMessage",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.TraceSuiviManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(f){var g,i,s,e;function h(){var t=s.call(this,g.Components.ComponentType.Interop)||this;return t.api=null,t.EndTransition=function(e){h.logger.debug("Start de EndTransition"),t.SendEvent(new g.Component.ManagerEvent(g.Component.ManagerEventType.FinDeTransition,e)),t.library.Context.SendPortalContext(!0,"Interop: EndTransition"),t.library.Context.DisplayProcesses()},t}g=f.Services||(f.Services={}),i=g.Interop||(g.Interop={}),s=g.Components.ComponentManagerBase,__extends(h,s),h.prototype.init=function(e,t,n,r){var o=this;return this.api=r,s.prototype.init.call(this,e,t,n,r).then(function(){return o._disableStorageEvent=!1,o._messageBus=new i.InteropMessageBus,o.PortalType=n.PortalType,(h._instance=o)._subscribeToEvent(),o._messageBus.StorageNotification=o.library.Persistence.addStorage("notifications.interop",function(){o.OnInteropMessageBusStorageChanged()}),o._getCommonDataInteropToUpdate()}).then(function(){o.library.Context.setOnChangePortailType(function(e){o.PortalType+=e})})},h.prototype.dispose=function(){return this.library.Context.setOnChangePortailType(null),s.prototype.dispose.call(this)},h.prototype.Lancer=function(e,t,n,r,o){h.logger.debug("Start de Lancer"),this.api.lancer(e,t,n,r,o)},h.prototype.AddToContextInterop=function(e,t,n,r,o){h.logger.debug("Start de AddToContextInterop"),this.api.addToContextInterop(e,t,n,function(e){r()},o)},h.prototype.AddListToContextInterop=function(e,t,n,r){h.logger.debug("Start de AddListToContextInterop"),this.api.addListToContextInterop(e,t,function(e){n()},r)},h.prototype.GetFromContextInterop=function(e,t,n,r){h.logger.debug("Start de GetFromContextInterop"),this.api.getFromContextInterop(e,t,function(e){n()},r)},h.prototype.GetListFromContextInterop=function(e,t,n,r){h.logger.debug("Start de GetFromContextInterop"),this.api.getListFromContextInterop(e,t,function(e){n()},r)},h.prototype.EndStep=function(){h.logger.debug("Start de EndStep"),this.library.Context.RemoveCurrentStep(),this.api.notifierFinStep(this.library.Context.GetCurrentStepId())},h.prototype.NotifyEndProcessus=function(e){h.logger.debug("Start de NotifyEndProcessus - Id du process %1",e),this.library.TraceSuivi.purgerTraces(),this.library.Trace.purgerTraces();var t=this.library.Context.GetFromContext("CommonDataInterop"),n=this.library.Context.GetListFromContext(JSON.parse(t));this._notifierFinProcessusInterop(e,n)},h.prototype._notifierFinProcessusInterop=function(e,t){var n=this;setTimeout(function(){n.api.notifierFinProcessus(e,t)},500)},h.prototype.NotifyBeginProcessus=function(e){h.logger.debug("Start de NotifyBeginProcessus - Id du process %1",e),this.api.notifierEtatProcessus(e,"ON")},h.prototype.NotifierChangementNomProcessus=function(e,t){h.logger.debug("Start de NotifierChangementNomProcessus - Id du process %1, nom de processus %2",e,t),this.api.notifierChangementNomProcessus(e,t)},h.prototype.AfficherWindowParHandle=function(e,t){h.logger.debug("Lancement de Afficher Windows par handle - handle: %1, affiche: %2",e,t),this.api.afficherWindowParHandle(e,t)},h.prototype.AfficherWindowParPid=function(e,t){h.logger.debug("Lancement de Afficher Windows par pid - pid: %1, affiche: %2",e,t),this.api.afficherWindowParPid(e,t)},h.prototype.AfficherSynthese=function(e){h.logger.debug("Lancement de Afficher Synthèse - numero client : %1",e),this.api.afficherSynthese(e)},h.prototype.ActiverApplicationAppelante=function(e){h.logger.debug("Lancement de activation application appelante - numero plan : %1",e),this.api.activerApplicationAppelante(e)},h.prototype.GetVarEnv=function(e,t,n){this.api.getVarEnv(e,function(e){t&&t(e),h.logger.debug("GetVarEnv success - %1",e)},function(e){n&&n(e),h.logger.error("GetVarEnv failed - %1",JSON.stringify(e))})},h.prototype.GetRegistryValue=function(e,t,n,r,o){this.api.getRegistryValue(e,t,n,function(e){r&&r(e),h.logger.debug("GetRegistryValue success - %1",e)},function(e){o(e),h.logger.error("GetRegistryValue failed - %1",JSON.stringify(e))})},h.prototype.LireFichier=function(e){var t=this.getPathFichier(e),n=g.CoreCommon.ServiceDePromesse.defer();return this.api.lireFichier(t).then(function(e){h.logger.debug("LireFichier success - path Fichier  %1, donnees: %2",t,e),n.resolve(e)}).catch(function(e){h.logger.error("LireFichier failed - path Fichier %1, erreurs: %2",t,JSON.stringify(e)),n.reject(e)}),n.promise},h.prototype.GetInfoFichier=function(e,t,n){this.api.getInfoFichier(e,function(e){t&&t(e),h.logger.debug("GetInfoFichier success - %1",JSON.stringify(e))},function(e){n&&n(e),h.logger.error("GetInfoFichier failed - %1",JSON.stringify(e))})},h.prototype.EcrireFichier=function(e,t,n,r){var o=this.getPathFichier(e),i=g.CoreCommon.ServiceDePromesse.defer();return this.api.ecrireFichier(o,t,n,r).then(function(e){h.logger.debug("EcrireFichier Success - path Fichier  %1, donnees: %2",o,e),i.resolve(e)}).catch(function(e){h.logger.error("EcrireFichier failed - %1",JSON.stringify(e)),i.reject(e)}),i.promise},h.prototype._subscribeToEvent=function(){var n=this;this.api&&this.api.subscribeToEvent(h._onEvent,h._onAcceptEvent,h._onConnection),this.library.Context&&(this.library.Context.onProcessNameChanged=function(e,t){n.NotifierChangementNomProcessus(e,t)})},h._onEvent=function(e,t){var n=h._instance;n.Deliver(e).then(function(){t&&t()},function(){n._shelveEvent(e),t&&t()})},h.prototype._getCommonDataInteropToUpdate=function(){var t=this;return this.api.getCommonDataInteropToUpdate().then(function(e){t.library.Context.AddToContext(g.Context.StorageLevel.Global,"CommonDataInterop",JSON.stringify(e))}).catch(function(){})},h._onAcceptEvent=function(e){var t=!1,n=h._instance,r=e.Contenu.Destinataire,o=n.library.Context.GetPortalContext().processes.length;if(n.PortalType!==r)t=!!n.library.Context.GetProcessStepById(r);else switch(n.PortalType){case"single":t="DemarreProcess"!==e.Subject||0===o;break;case"portal":t=!0;break;default:t=!1}return g.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),h.logger.debug("accept process: portalType=%1, destinataire=%2, subject=%3, processLength=%4 => accept=%5",n.PortalType,r,e.Subject,o,t),n.SendEvent(new g.Component.ManagerEvent(g.Component.ManagerEventType.AcceptPhase,{info:t.toString()})),t},h._onConnection=function(e){var t=h._instance;t._connectionId=e,t.SendEvent(new g.Component.ManagerEvent(g.Component.ManagerEventType.ConnectionSignalR,{info:e}))},h.prototype._shelveEvent=function(e){e.DeliverTries++,this._messageBus.Add(e)},h.prototype.Deliver=function(e){if(h.logger.debug("Start de Deliver"),this.library.Display.CurrentFrame.ProcessId||this.library.Context.IsSingleProcess()){var t=this.library.Context.GetCurrentProcess();if(t){var n=this.library.Context.GetCurrentStep(t);if(e.ProcessStepId===n.getPath())return this._deliverMessage(e)}}return"portal"===e.ProcessStepId||"single"===e.ProcessStepId||e.ProcessStepId===this._connectionId?this._handlePortalMessage(e):(h.logger.error("Deliver failed"),this.library.Core.createPromiseSelfError(new g.Erreur("Erreur deliver failed")))},h.prototype.DeliverUndeliveredMessage=function(e){var t=this,n=this._messageBus.SpliceByStepId(e);if(0===n.length)return this.library.Core.getPromesseSelfResoved();for(var r in g.Loggers.MDC.INSTANCE.setValue("action","DeliverUndeliveredMessage"),n)h.logger.debug(n[r].Subject);return g.Loggers.MDC.INSTANCE.remove("action"),this._disableStorageEvent=!0,this._deliverMessages(n).then(function(){t._disableStorageEvent=!1})},h.prototype._deliverMessages=function(e){var t=this;if(0<e.length){var n=e.pop();return this._deliverMessage(n).then(function(){return t._deliverMessages(e)},function(){return t._shelveEvent(n),t._deliverMessages(e)})}return this.library.Core.getPromesseSelfResoved()},h.prototype._deliverMessage=function(e){var t=new g.NotificationMessage;return t.Sujet=e.Subject,t.Contenu=e.Contenu,this.library.Context.Notify(t)},h.prototype._handlePortalMessage=function(e){var t=this;switch(e.Subject){case"Guichet":return"O"===e.Contenu?this.library.Context.GetDonneesLocales():(this.library.Context.ClearParametresComptables(),this.library.Core.getPromesseSelfResoved());case"DemarreProcess":var n=e.Contenu.Code,r=e.Contenu.ValeurDepart,o=JSON.stringify(e.Contenu.InitData),i=new g.Component.ManagerEvent(g.Component.ManagerEventType.DemandeDeDemarrageDeProcessus,{demandeDeDemarrageDeProcessusDetail:{codeProcessus:n,initData:o,valeurDepart:r}});return g.Loggers.FLASH.INSTANCE.setValue("action","_handlePortalMessage"),h.logger.info("Send event 'DemarreProcess' : process=%1, valeurDepart=%2, initData=%3",n,r,o),this.SendEvent(i),this.library.Core.getPromesseSelfResoved();case"ChangeModeTrace":var s;return s="ON"==e.Contenu,h.logger.info("Positonnement mode debug trace : %1",s),this.library.Trace.setModeDebug(s),this.library.Core.getPromesseSelfResoved();case"Communication":return i=new g.Component.ManagerEvent(g.Component.ManagerEventType.Communication,{communicationDetail:{message:e.Contenu}}),g.Loggers.FLASH.INSTANCE.setValue("action","_handlePortalMessage"),h.logger.info("Send event 'Communication' : message=%1",e.Contenu),this.SendEvent(i),this.library.Core.getPromesseSelfResoved();case"UpdateContexteClient":var a=(u=e.Contenu).NumeroClient,c=u.FluxJSON;return(p=this.library.ContexteClient.nouveauContexte(a))&&this.library.ContexteClient.setContenu("interop",a,JSON.parse(c)),this.library.Core.getPromesseSelfResoved();case"DeleteContexteClient":var u;if(a=(u=e.Contenu).NumeroClient,h.logger.debug("DeleteContexteclient : contenu=%1 numeroclient=%2",u,a),"tous"===a){this.library.ContexteClient.changeTousContexteMode(f.Services.ContexteClient.Messages.ContexteClientMode.AUTOMATIQUE),this.library.Context.RemoveWaitingProcesses();var l=this.library.ContexteClient.getContextes();h.logger.debug("DeleteContexteclient : suppression de tous les contextes client"),l.forEach(function(e){t.library.ContexteClient.detruireContexte("interop",e.getId())})}else{var p;(p=this.library.ContexteClient.getByIdClient(a))&&(h.logger.debug("DeleteContexteclient : change mode en automatique contexte client=%1 de contexte id=%2",a,p.getId()),this.library.ContexteClient.changeContexteMode(p.getId(),f.Services.ContexteClient.Messages.ContexteClientMode.AUTOMATIQUE))}return this.library.Core.getPromesseSelfResoved();default:return this.library.Core.getPromesseSelfResoved()}},h.prototype.ClearBus=function(){this._messageBus.Clear()},Object.defineProperty(h.prototype,"Bus",{get:function(){return this._messageBus},enumerable:!0,configurable:!0}),h.prototype.OnInteropMessageBusStorageChanged=function(){if(g.Loggers.FLASH.INSTANCE.setValue("action","OnInteropMessageBusStorageChanged"),h.logger.debug("Start de OnInteropMessageBusStorageChanged"),!this._disableStorageEvent&&this.library.Display.CurrentFrame.ProcessId){var e=this.library.Context.GetCurrentProcess();if(e){var t=this.library.Context.GetCurrentStep(e);return this.DeliverUndeliveredMessage(t.getPath())}}return this.library.Core.getPromesseSelfResoved()},h.prototype.TestLocalService=function(){h.logger.debug("Start de TestLocalService"),this.api.testLocalService()},h.prototype.TriggerNotifications=function(){g.Loggers.FLASH.INSTANCE.setValue("action","OnInteropMessageBusStorageChanged"),h.logger.debug("TriggerNotifications");var e=this.library.Context.GetCurrentProcess();if(e){var t=this.library.Context.GetCurrentStep(e);return t?this.DeliverUndeliveredMessage(t.getPath()):this.library.Core.getPromesseSelfResoved()}return this.library.Core.getPromesseSelfResoved()},h.prototype.getPathFichier=function(e){var t=e;return 0!==e.toLowerCase().lastIndexOf("c:",0)&&0!==e.toLowerCase().lastIndexOf("d:",0)&&(t=h.TempFolderPath+e),t},h.CLASS_NAME="MyWay.Services.Interop.InteropManager",h.logger=g.Loggers.LoggerFactory.INSTANCE.getClass(h.CLASS_NAME),h.TempFolderPath="%TEMP%\\",e=h,i.InteropManager=e,g.Components.RegistryManager.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.TraceSuivi)||this}t=e.Services||(e.Services={}),n=t.TraceSuivi||(t.TraceSuivi={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.forcerTrace=function(t){var n=this;return this.library.Core.promesseTryCatch(function(e){n.manager.tracer(t,!1).then(function(){e.resolve()},e.reject)})},i.prototype.purgerTraces=function(){return this.manager.checkTailleDB(!0)},o=i,n.TraceSuiviManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Capacites)||this}t=e.Services||(e.Services={}),n=t.Capacites||(t.Capacites={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.reception=function(e){switch(e.subject){case n.Messages.CapacitesMessageSubject.GetCapacite:var t=e.message.regle;return this.managerInstance.getCapacite(t);default:return r.prototype.reception.call(this,e)}},i.CLASS_NAME="MyWay.Services.Capacites.CapacitesManagerMessage",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.CapacitesManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(c){var u;(function(s){u.ServiceManager.addActionOnInitialize("Habilitation.ObtenirHabilitations",function(e){return e.Habilitation.ObtenirHabilitations().then(function(){})},"Context.GetDonneesLocales");var o,e=(o=u.Components.ComponentManagerBase,__extends(a,o),a.prototype.init=function(e,t,n,r){return this.api=r,this.isTotemCapable=n.isTotemCapable,o.prototype.init.call(this,e,t,n,r)},a.prototype.transformContextDTOIntoArray=function(e){var t={};for(var n in e.codesHabilites)t[e.codesHabilites[n]]=!0;for(var n in e.codesNonHabilites)t[e.codesNonHabilites[n]]=!1;return t},a.prototype.extractCodesDTOIntoArray=function(e){var t=[],n=this.concatHabilitations(e);for(var r in n)t[n[r]]=!0;return t},a.prototype.concatHabilitations=function(e){var t=[],n=e[c.Services.Habilitation.DOMAIN.MYSYS],r=e[c.Services.Habilitation.DOMAIN.IAM],o=e[c.Services.Habilitation.DOMAIN.CULTURENET];return t=t.concat(n,r,o)},a.prototype._HabilitationsOK=function(e){return e&&e.timestamp&&Date.now()-e.timestamp<this.maximumTimeBeforeReload},a.prototype.EstHabilite=function(e){var t=u.CoreCommon.ServiceDePromesse.defer(),n=this;try{if(this._HabilitationsOK(this.habilitationsContextCache))if(this.habilitationsContextCache.codesHabilites){for(var r=[],o=0;o<e.length;o++)this.habilitationsCache&&this.habilitationsCache[e[o]]?r.push(!0):r.push(!1);u.Loggers.FLASH.INSTANCE.setValue("action","EstHabilite"),u.Loggers.FLASH.INSTANCE.setValue("details",e),a.logger.debug("Vérification codes habilitation success - result : %1 ",r),t.resolve(r)}else u.Loggers.FLASH.INSTANCE.setValue("action","EstHabilite"),u.Loggers.FLASH.INSTANCE.setValue("details",e),a.logger.error("Codes habilitation format incorrecte"),t.reject(new u.Erreur(c.Services.Libelle.LibelleModel.COM.ERREUR_HABILITATION_MAUVAIS_FORMAT));else this.ChargerHabilitations().then(function(){n.EstHabilite(e).then(function(e){t.resolve(e)}).catch(function(e){return t.reject(e)})}).catch(function(e){return t.reject(e)})}catch(e){a.logger.error("EstHabilite failed %1",JSON.stringify(e)),t.reject(new u.Erreur(e))}return t.promise},a.prototype.chargerHablitationsInternal=function(r,o){var i=this,e=this.library.Context.GetAuthentificationInfo(),t=this.library.Context.GetInfosUser();return null!==e?this.api.GetHabilitations(r===s.EHabilitationType.MYSYS,r===s.EHabilitationType.IAM,r===s.EHabilitationType.CULTURENET,t,e).then(function(e){var t=!0===o?null:JSON.parse(i.library.Context.GetFromContext(i.contextKey)),n=!t||!i._HabilitationsOK(t);if(n)t={codesHabilites:i.concatHabilitations(e),codesNonHabilites:[],timestamp:Date.now()};else switch(r){case s.EHabilitationType.MYSYS:e.mysys&&e.mysys.forEach(function(e){t.codesHabilites.indexOf(e)<0&&t.codesHabilites.push(e)});break;case s.EHabilitationType.IAM:e.iam&&e.iam.forEach(function(e){t.codesHabilites.indexOf(e)<0&&t.codesHabilites.push(e)});break;case s.EHabilitationType.CULTURENET:e.cultureNet&&e.cultureNet.forEach(function(e){t.codesHabilites.indexOf(e)<0&&t.codesHabilites.push(e)})}return i.library.Context.AddToContext(u.Context.StorageLevel.Global,i.contextKey,JSON.stringify(t)),i.habilitationsContextCache=t,i.habilitationsCache=i.transformContextDTOIntoArray(t),u.Loggers.FLASH.INSTANCE.setValue("action","ChargerHabilitations"),u.Loggers.FLASH.INSTANCE.setValue("details",i.habilitationsCache),a.logger.debug("GetHabilitations success"),n&&i.SendEvent(new u.Component.ManagerEvent(u.Component.ManagerEventType.ResetHabilitations,{})),i.habilitationsCache},function(e){throw u.Loggers.FLASH.INSTANCE.setValue("action","ChargerHabilitations"),a.logger.error("GetHabilitations failed %1",JSON.stringify(e)),e}):(u.Loggers.FLASH.INSTANCE.setValue("action","ChargerHabilitations"),a.logger.error("authentification manquante"),c.Services.CoreCommon.createPromiseSelfError(new u.Erreur(c.Services.Libelle.LibelleModel.COM.ERREUR_HABILITATION_AUTHENTIFICATION_MANQUANTE)))},a.prototype.ChargerHabilitations=function(e){return this.chargerHablitationsInternal(s.EHabilitationType.MYSYS,e)},a.prototype.chargerHabilitationsTypee=function(e,t){return this.chargerHablitationsInternal(e,t)},a.prototype.ObtenirHabilitations=function(){var e=this;try{return this._HabilitationsOK(this.habilitationsContextCache)?(u.Loggers.FLASH.INSTANCE.setValue("details",this.habilitationsCache),a.logger.debug("ObtenirHabilitations success"),this.library.Core.createPromiseSelfResolved(this.habilitationsCache)):this.ChargerHabilitations().then(function(){return e.ObtenirHabilitations()})}catch(e){return a.logger.error("ObtenirHabilitations failed %1",JSON.stringify(e)),this.library.Core.createPromiseSelfError(new u.Erreur(e))}},a.prototype.ObtenirHabilitation=function(t){var n=u.CoreCommon.ServiceDePromesse.defer();try{this.EstHabilite([t]).then(function(e){a.logger.debug("ObtenirHabilitation(code) success - code: %1, resultat: %2",t,e[0]),n.resolve(new s.HabilitationModel(t,e[0]))}).catch(function(e){return n.reject(e)})}catch(e){a.logger.error("ObtenirHabilitation(code) failed %1",JSON.stringify(e)),n.reject(new u.Erreur(e))}return n.promise},a.prototype.ModifierHabilitation=function(e,t){var n=u.CoreCommon.ServiceDePromesse.defer(),r=this;try{if(this._HabilitationsOK(this.habilitationsContextCache)){var o=this.habilitationsContextCache.codesHabilites.indexOf(e),i=this.habilitationsContextCache.codesNonHabilites.indexOf(e);-1<o?this.habilitationsContextCache.codesHabilites.splice(o,1):-1<i&&this.habilitationsContextCache.codesNonHabilites.splice(i,1),!0===t?this.habilitationsContextCache.codesHabilites.push(e):!1===t&&this.habilitationsContextCache.codesNonHabilites.push(e),this.library.Context.AddToContext(u.Context.StorageLevel.Global,this.contextKey,JSON.stringify(this.habilitationsContextCache)),a.logger.debug("ModifierHabilitation success - Code: %1, valeur: %2",e,t),this.habilitationsCache=this.transformContextDTOIntoArray(this.habilitationsContextCache),n.resolve(new s.HabilitationModel(e,t))}else this.ChargerHabilitations().then(function(){r.ModifierHabilitation(e,t).then(function(e){n.resolve(e)}).catch(function(e){return n.reject(e)})}).catch(function(e){return n.reject(e)})}catch(e){a.logger.error("ModifierHabilitation failed %1",JSON.stringify(e)),n.reject(new u.Erreur(e))}return n.promise},a.prototype.SupprimerHabilitations=function(){return this.library.Context.RemoveFromContext(u.Context.StorageLevel.Global,this.contextKey)},a.CLASS_NAME="MyWay.Services.Habilitation.HabilitationManager",a.logger=u.Loggers.LoggerFactory.INSTANCE.getClass(a.CLASS_NAME),a);function a(){var e=o.call(this,u.Components.ComponentType.Habilitation)||this;return e.isTotemCapable=!0,e.contextKey="HABILITATIONS",e.maximumTimeBeforeReload=432e5,e.api=null,e}s.HabilitationManager=e,u.Components.RegistryManager.getInstance().register(e)})((u=c.Services||(c.Services={})).Habilitation||(u.Habilitation={}))}(MyWay=MyWay||{}),function(e){var n;(n=e.Services||(e.Services={})).PhantomAgent.addListenerOnInit(function(e,t){e.Habilitation=new n.Habilitation.PhantomHabilitationAgent(t)})}(MyWay=MyWay||{}),function(e){var o,t,n;function r(e){this.serviceManager=e}o=e.Services||(e.Services={}),t=o.Habilitation||(o.Habilitation={}),r.prototype.EstHabilite=function(e){var t=o.CoreCommon.ServiceDePromesse.defer(),n=o.Controle.StaticArrayControle.isArray(e),r=n?e:[e];return this.serviceManager.Library.Habilitation.EstHabilite(r).then(function(e){n?t.resolve(e):t.resolve(e[0])}).catch(function(e){t.reject(e)}),t.promise},n=r,t.PhantomHabilitationAgent=n}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Interop)||this}t=e.Services||(e.Services={}),n=t.Interop||(t.Interop={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),o=i,n.InteropManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var I,N,L,t;function _(){return L.call(this,I.Components.ComponentType.Interop)||this}I=e.Services||(e.Services={}),N=I.Interop||(I.Interop={}),L=I.Components.ComponentManagerMessageBase,__extends(_,L),_.prototype.reception=function(e){var n=this;switch(e.subject){case N.Messages.InteropMessageSubject.AfficherWindowParHandle:var t=(S=e.message).handle,r=S.affiche;return this.managerInstance.AfficherWindowParHandle(t,r),this.library.Core.getPromesseSelfResoved();case N.Messages.InteropMessageSubject.AfficherWindowParPid:var o=(S=e.message).pid;return r=S.affiche,this.managerInstance.AfficherWindowParPid(o,r),this.library.Core.getPromesseSelfResoved();case N.Messages.InteropMessageSubject.AfficherSynthese:var i=(S=e.message).numeroClient;return this.managerInstance.AfficherSynthese(i),this.library.Core.getPromesseSelfResoved();case N.Messages.InteropMessageSubject.ActiverApplicationAppelante:var s=(S=e.message).numeroPlan;return this.managerInstance.ActiverApplicationAppelante(s),this.library.Core.getPromesseSelfResoved();case N.Messages.InteropMessageSubject.AddToContextInterop:var a=(S=e.message).level,c=S.key,u=S.value;return this.library.Core.promesseTryCatch(function(t){n.managerInstance.AddToContextInterop(a,c,u,t.resolve,function(e){I.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),_.logger.error("Service local indisponible - %1",JSON.stringify(e)),t.reject(new I.Erreur(I.Libelle.LibelleModel.COM.ERREUR_INTEROP_SERVICE_LOCAL_APPEL_IMPOSSIBLE))})});case N.Messages.InteropMessageSubject.AddListToContextInterop:var l=(S=e.message).level,p=S.datas;return this.library.Core.promesseTryCatch(function(t){n.managerInstance.AddListToContextInterop(l,p,t.resolve,function(e){I.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),_.logger.error("Service local indisponible - %1",JSON.stringify(e)),t.reject(new I.Erreur(I.Libelle.LibelleModel.COM.ERREUR_INTEROP_SERVICE_LOCAL_APPEL_IMPOSSIBLE))})});case N.Messages.InteropMessageSubject.GetFromContextInterop:var f=(S=e.message).level,g=S.key;return this.library.Core.promesseTryCatch(function(t){n.managerInstance.GetFromContextInterop(f,g,t.resolve,function(e){I.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),_.logger.error("Service local indisponible - %1",JSON.stringify(e)),t.reject(new I.Erreur(I.Libelle.LibelleModel.COM.ERREUR_INTEROP_SERVICE_LOCAL_APPEL_IMPOSSIBLE))})});case N.Messages.InteropMessageSubject.GetListFromContextInterop:var h=(S=e.message).level,d=S.datas;return this.library.Core.promesseTryCatch(function(t){n.managerInstance.GetListFromContextInterop(h,d,t.resolve,function(e){I.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),_.logger.error("Service local indisponible - %1",JSON.stringify(e)),t.reject(new I.Erreur(I.Libelle.LibelleModel.COM.ERREUR_INTEROP_SERVICE_LOCAL_APPEL_IMPOSSIBLE))})});case N.Messages.InteropMessageSubject.Lancer:var m=(S=e.message).executableWrapper,y=S.parametres,v=S.sync,C=S.contexte;return this.library.Core.promesseTryCatch(function(t){n.managerInstance.Lancer(m,C,y,v,function(e){I.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),_.logger.error("Service local indisponible - %1",JSON.stringify(e)),t.reject(new I.Erreur(I.Libelle.LibelleModel.COM.ERREUR_INTEROP_SERVICE_LOCAL_APPEL_IMPOSSIBLE))}),t.resolve()});case N.Messages.InteropMessageSubject.EndStep:var S=e.message;return this.library.Core.promesseTryCatch(function(t){try{n.managerInstance.EndStep(),n.managerInstance.EndTransition(null),t.resolve()}catch(e){I.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),_.logger.error("EndStep failed - %1",JSON.stringify(e)),t.reject(new I.Erreur(I.Libelle.LibelleModel.COM.ERREUR_FRAMEWORK,["EndStep failed"]))}});case N.Messages.InteropMessageSubject.TriggerNotifications:return this.managerInstance.TriggerNotifications();case N.Messages.InteropMessageSubject.LireFichier:var E=(S=e.message).nomFichier;return this.managerInstance.LireFichier(E).then(function(e){return{data:e}});case N.Messages.InteropMessageSubject.EcrireFichier:var A=(S=e.message).nomFichier,b=S.fluxdonnees,M=S.ajouter,T=S.creeDir;return this.managerInstance.EcrireFichier(A,b,M,T).then(function(e){return{data:e}});case N.Messages.InteropMessageSubject.ClearBus:e.message,_.logger.debug("Efface le bus interop"),this.managerInstance.ClearBus();var P=I.CoreCommon.ServiceDePromesse.defer();return P.resolve(),P.promise;default:return L.prototype.reception.call(this,e)}},_.CLASS_NAME="MyWay.Services.Interop.InteropManagerMessage",_.logger=I.Loggers.LoggerFactory.INSTANCE.getClass(_.CLASS_NAME),t=_,N.InteropManagerMessage=t,I.Components.RegistryManagerMessage.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){return i.call(this,t.Components.ComponentType.Habilitation)||this}t=e.Services||(e.Services={}),o=t.Habilitation||(t.Habilitation={}),i=t.Components.ComponentManagerMessageBase,__extends(r,i),r.prototype.reception=function(e){switch(e.subject){case o.HabilitationMessageSubject.EstHabilite:var t=(n=e.message).code;return this.managerInstance.EstHabilite(t);case o.HabilitationMessageSubject.ChargerHabilitations:var n=e.message;return this.managerInstance.ChargerHabilitations();case o.HabilitationMessageSubject.ObtenirHabilitations:return n=e.message,this.managerInstance.ObtenirHabilitations();case o.HabilitationMessageSubject.ObtenirHabilitation:return t=(n=e.message).code,this.managerInstance.ObtenirHabilitation(t);case o.HabilitationMessageSubject.ModifierHabilitation:t=(n=e.message).code;var r=n.valeur;return this.managerInstance.ModifierHabilitation(t,r);default:return i.prototype.reception.call(this,e)}},r.CLASS_NAME="MyWay.Services.Habilitation.HabilitationManagerMessage",r.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(r.CLASS_NAME),n=r,o.HabilitationManagerMessage=n,t.Components.RegistryManagerMessage.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Habilitation)||this}t=e.Services||(e.Services={}),n=t.Habilitation||(t.Habilitation={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.EstHabilite=function(e){return this.manager.EstHabilite(e)},i.prototype.ChargerHabilitations=function(){return this.manager.ChargerHabilitations()},i.prototype.chargerHabilitationsTypee=function(e){return this.manager.chargerHabilitationsTypee(e)},o=i,n.HabilitationManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(y){var T,P,i,e;function I(){var n=i.call(this,T.Components.ComponentType.Lisa)||this;return n.DisplayProcessesOnProcessEnd=!1,n.api=null,n.endTransition=function(e){I.logger.debug("Debut EndTransition");var t=!1;e&&e.retourEtapePrecedente&&e.etapeCourante&&e.etapeCourante.maintienIFrameLastAction&&(n.library.Display.CleanLastProcessFrame(),t=!0),n.library.Context.SendPortalContext(!0,"Lisa: EndTransition"),n.library.Context.DisplayProcesses(e.nouvelleIframe).then(function(){if(t){var e=new T.NotificationMessage;e.Sujet="FrameShownOnComeBack",n.library.Context.Notify(e)}}).catch(function(e){T.Loggers.FLASH.INSTANCE.setValue("action","EndTransition"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("Erreur DisplayProcesses")})},n}T=y.Services||(y.Services={}),P=T.Lisa||(T.Lisa={}),i=T.Components.ComponentManagerBase,__extends(I,i),I.prototype.init=function(e,t,n,r){var o=this;return this._modeVerificationProcessus=n.ModeVerificationProcessus,this.api=r,i.prototype.init.call(this,e,t,n,r).then(function(){o.library.Interop&&(o.onFinProcessus=function(e){o.library.Interop.NotifyEndProcessus(e)})})},I.prototype.startStandaloneProcessWithInitialisation=function(t,e,n){var r,o,i=this;return I.logger.debug("Debut StartStandaloneProcessWithInitialisation"),o="object"==typeof e&&null!==e?(r=null,e):(r=e,n),this._start(t,r,"",o).then(function(e){return i.SendEvent(new T.Component.ManagerEvent(T.Component.ManagerEventType.NouveauProcess,{portalContext:i.library.Context.GetPortalContext(),processusAOuvrirDansUneNouvelleInstance:!!o&&o.processusAOuvrirDansUneNouvelleInstance,info:t})),I.logger.debug("Fin StartStandaloneProcessWithInitialisation, res: %1",e),e},function(e){throw T.Loggers.FLASH.INSTANCE.setValue("action","StartStandaloneProcessWithInitialisation"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("Start '%1' (%2) demandé mais en echec",t,r),e})},I.prototype.startUrl=function(e,t){var n=this;I.logger.debug("Debut StartUrl");var r=new P.StartResult(null);r.CodeProcessus=e,r.ProcessDemarre=new P.ProcessResult({Nom:e}),r.ProcessDemarre.OptionsProcess='{"EstApplicationExterne":true}';var o=new P.EtapeResult(null);if(o.LocalisationAbsolue=t,o.LocalisationRelative="",o.CodeApplication=e,o.CodeEtape=e,o.CodeMetier="",o.NomApplication=e,o.TypeApplication="HTML5",o.ValeurEntree=0,r.ProchaineEtape=o,r&&r.ProcessDemarre)try{return this._launchNextStep(r,"",null,null).then(function(e){return e.finDeProcessus||n.SendEvent(new T.Component.ManagerEvent(T.Component.ManagerEventType.NouvelleAppliExterne,{portalContext:n.library.Context.GetPortalContext()})),I.logger.debug("Fin StartUrl, res: %1",e),e})}catch(e){return T.Loggers.FLASH.INSTANCE.setValue("action","StartUrl"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("_launchNextStep failed - %1",e),this.library.Core.createPromiseSelfError(e)}else T.Loggers.FLASH.INSTANCE.setValue("action","StartUrl"),I.logger.warn("Pas d'url démarrée"),this.library.Core.createPromiseSelfResolved(null)},I.prototype.next=function(o,e){var i=this;void 0===e&&(e=!1),I.logger.debug("Debut Next");var s=this.library.Context.GetCurrentProcess(),a=this.library.Context.GetCurrentStep(s);return a?(e?(I.logger.info("Demande de retour à l'étape précédente"),this._getPrevious(s,a)):(I.logger.info("Demande d'enchainement depuis '%1', valeur de sortie '%2'",a.codeEtape,o),this.api.next(a.codeEtape,o))).then(function(t){try{if(t.ProcessDemarre&&t.ProcessDemarre.OptionsProcessAsEtape){var e=null;e=JSON.parse(t.ProcessDemarre.OptionsProcessAsEtape)}if(t.ProcessDemarre&&null!=e&&e.HorsProcessus)return i._DemarreSousProcessusModeExterne(t);var n=new T.NotificationMessage;n.Sujet="fin d etape",n.Contenu=s.id;var r=i.library.Core.getPromesseSelfResoved();return a.isRouteur||(r=i.library.Context.Notify(n)),r.then(function(){try{I.logger.info("FE");var e=new T.TraceSuivi.TraceSuiviModel;return e.state="FE",i.library.TraceSuivi.tracer(e),a.isRouteur||(s.lastNextTime=Date.now()),i.library.Display.FinishSubmit(),i._handleNext(a.codeEtape,o,t).then(function(e){return a.etatEtape==T.Context.EtatEtape.STARTED&&(a.etatEtape=T.Context.EtatEtape.RESET),e.finDeProcessus||i.SendEvent(new T.Component.ManagerEvent(T.Component.ManagerEventType.NouvelleEtape,{portalContext:i.library.Context.GetPortalContext()})),I.logger.debug("Fin Next, res: %1",e),e},function(e){throw T.Loggers.FLASH.INSTANCE.setValue("action","Next"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("_handleNext failed - %1",e),e})}catch(e){throw T.Loggers.FLASH.INSTANCE.setValue("action","Next"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("Next failed - %1",e),e}})}catch(e){throw T.Loggers.FLASH.INSTANCE.setValue("action","Next"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("Next failed - %1, e"),e}}).catch(function(e){throw T.Loggers.FLASH.INSTANCE.setValue("action","Next"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("Next failed - %1",e),e}):(T.Loggers.FLASH.INSTANCE.setValue("action","Next"),I.logger.error("Aucune étape courante"),this.library.Core.createPromiseSelfError(new T.Erreur("Aucune étape courante")))},I.prototype.replaceTokens=function(e,t){I.logger.debug("Debut ReplaceTokens");var n=[],r=[];if(t)for(var o in t){var i=t[o];if(i&&0<i.indexOf("=>")){var s=i.split("=>");n[s[1]]=s[0],r[s[0]]=s[1]}}var a=this.library.Core.FindKeysToReplace(e),c=[];for(var o in a)n[a[o]]?c.push(n[a[o]]):c.push(a[o]);var u=this.library.Context.GetListFromContext(c,!0,!0);for(var o in u){var l=u[o];e=r[l.Key]?e.replace(new RegExp("\\["+r[l.Key]+"\\]","g"),l.Value):e.replace(new RegExp("\\["+l.Key+"\\]","g"),l.Value),e=r[l.Key]?e.replace(new RegExp("\\%5B"+r[l.Key]+"\\%5D","g"),l.Value):e.replace(new RegExp("\\%5B"+l.Key+"\\%5D","g"),l.Value)}return I.logger.debug("Fin ReplaceTokens, url: %1",e),e},I.prototype.start=function(t,n){var r=this;return void 0===n&&(n=null),I.logger.debug("Debut Start"),this._start(t,n,"current",null).then(function(e){return r.SendEvent(new T.Component.ManagerEvent(T.Component.ManagerEventType.NouveauProcess,{portalContext:r.library.Context.GetPortalContext(),info:t})),I.logger.debug("Fin Start, res: %1",e),e},function(e){throw T.Loggers.FLASH.INSTANCE.setValue("action","Start"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("Start '%1' (%2) demandé mais en echec",t,n),e})},I.prototype.startStandaloneProcess=function(t,n){var r=this;return void 0===n&&(n=null),I.logger.debug("Debut StartStandaloneProcess"),this._start(t,n,"",null).then(function(e){return r.SendEvent(new T.Component.ManagerEvent(T.Component.ManagerEventType.NouveauProcess,{portalContext:r.library.Context.GetPortalContext(),info:t})),I.logger.debug("Fin StartStandaloneProcess, res: %1",e),e},function(e){throw T.Loggers.FLASH.INSTANCE.setValue("action","StartStandaloneProcess"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("Start '%1' (%2) demandé mais en echec",t,n),e})},I.prototype.previous=function(){return this.next(null,!0)},I.prototype.AddProcess=function(e,t,n,r,o,i){var s=this.library.Context.GetPortalContext();for(var a in s.processes){var c=s.processes[a];if(c.id===e)return void(s.currentPath=c.getPath())}var u=new y.Services.Context.Process;return u.id=e,u.icon="cog",u.displayName=t,u.contextStorage=[],u.subElements=[],u.currentInnerElementPath="",u.knownSteps=r,u.codeProcess=n,u.estApplicationExterne=!1,i&&(u.contexteClientId=i),o&&(o.Icon&&(u.icon=o.Icon),o.TypeProcess&&(u.typeProcess=o.TypeProcess),o.EstApplicationExterne&&(u.estApplicationExterne=!0)),s.processes.push(u),s.currentPath=u.getPath(),u.lastNextTime=Date.now(),this.library.Context.SaveContext(),u},I.prototype.AddSubProcess=function(e,t,n,r,o,i,s,a,c){var u=this.library.Context.GetPortalContext();for(var l in u.processes){var p=u.processes[l];if(p.id===e)return void(u.currentPath=p.getPath())}var f=new y.Services.Context.Process;if(f.id=t.id+"|"+e,f.icon="cog",a&&a.Icon&&(f.icon=a.Icon),f.displayName=n,f.contextStorage=[],f.subElements=[],f.currentInnerElementPath="",f.knownSteps=s,f.codeEtape=o,f.codeProcess=r,f.estApplicationExterne=!1,c&&c.OutputContracts)for(var g in c.OutputContracts)f.outputContracts.push(c.OutputContracts[g]);f.isSubProcess=!0,f.contexteClientId=t.contexteClientId,this.setAuthorizedOutputs(f,t,i),t.subElements.push(f),u.currentPath=f.getPath(),f.lastNextTime=t.lastNextTime,this.library.Context.SaveContext()},I.prototype.AddStepWithResult=function(e,t,n){var r=e.CodeEtape;r+="-"+T.CoreCommon.creerChaineAleatoire(8);var o=e.Actions,i=e.Contrats;this.AddStep(r,e.CodeEtape,e.CodeApplication,e.CodeMetier,o,i,e.NomApplication,t,e.ValeurEntree,n,JSON.stringify(e))},I.prototype.AddStep=function(e,t,n,r,o,i,s,a,c,u,l){var p=this.library.Context.GetCurrentProcess();if(!p)throw"no current process";for(var f in p.subElements)if(p.subElements[f].id===e)return p.currentInnerElementPath=e,this.library.Context.SaveContext(),this.library.Context.GetPortalContext(!1);var g=new y.Services.Context.ProcessStep;g.parentPath=p.id,g.id=e;var h=T.Context.EtatEtape.RESET,d=!1;if(a.indexOf(".js")===a.length-3&&(d=!0),I.ProcessStepSetValues(g,p,s,a,o,i,n,t,r,c,null,u,l,h,d,Date.now()),this.setAuthorizedOutputs(g,p,o),u&&(!0!==u.MaintienIFrame&&"true"!==u.MaintienIFrame||(g.maintienIFrame=!0),u.OutputContracts&&0<u.OutputContracts.length))for(var m in u.OutputContracts)p.outputContracts.push(u.OutputContracts[m]);p.subElements.push(g),p.currentInnerElementPath=g.id,u&&u.ChangeTypeProcess&&p.typeProcess!==u.ChangeTypeProcess&&(p.typeProcess=u.ChangeTypeProcess),this.library.Context.GetPortalContext().currentPath=p.getPath(),this.SetParentProcessPath(p),this.library.Context.SaveContext()},I.prototype.setAuthorizedOutputs=function(e,t,n){if(t.isSubProcess)for(var r in e.authorizedOutputs=[],n){var o=n[r];for(var i in o.ValeursFinProcessPossibles){var s=t.authorizedOutputs.indexOf(o.ValeursFinProcessPossibles[i]),a=e.authorizedOutputs.indexOf(o.ValeurSortie);0<=s&&a<0&&e.authorizedOutputs.push(o.ValeurSortie)}}else for(var r in e.authorizedOutputs=[],n)o=n[r],(s=e.authorizedOutputs.indexOf(o.ValeurSortie))<0&&e.authorizedOutputs.push(o.ValeurSortie)},I.prototype.SetParentProcessPath=function(e){for(var t=e,n=this.library.Context.GetParentProcess(e);n;){var r=t.getPath().replace(n.id+"|","");n.currentInnerElementPath=r,t=n,n=this.library.Context.GetParentProcess(n)}},I.prototype.ConvertInitData=function(e){var t={};for(var n in"string"==typeof e&&(e=JSON.parse(e)),t.displayName=e.displayName,t.subProcessCode=e.subProcessCode,t.contextArray=[],e.context){var r=e.context[n];t.contextArray.push({Key:n,Value:r})}for(var n in e.contextArray){var o=e.contextArray[n];t.contextArray.push({Key:o.Key,Value:o.Value})}return t.idClient=e.idClient,t.idContexteClient=e.idContexteClient,t},I.prototype.AddBoundStep=function(e,t,n,r,o,i){var s=this.library.Context.GetCurrentProcess();if(!s)throw"no current process";var a=new y.Services.Context.ProcessStep;for(var c in a.id=t,a.nomApplication=n,a.url=r,a.boundId=o,a.isEnd=i,a.processName=s.displayName,e&&(e.nextStep=a),s.subElements.push(a),s.subElements){var u=s.subElements[c];if(!u.boundId&&u.id===o){u.boundId=o;break}}this.library.Context.SaveContext()},I.prototype.SwitchToSubProcess=function(e){var t,n=this.library.Context.GetCurrentMainProcess();if(!n)return null;for(var r in n.subElements){var o=n.subElements[r];if("Process"===o.type&&o.id===e){t=o;break}}if(!t)throw"process '"+e+"' not found";var i=this.library.Context.GetPortalContext();return i.currentPath=t.getPath(),this.SetParentProcessPath(t),this.library.Context.SaveContext(),i},I.prototype.SwitchToSubProcessAsync=function(e,t){t(this.SwitchToSubProcess(e))},I.prototype.SwitchToMainProcess=function(){var e=this.library.Context.GetCurrentMainProcess();if(!e)return null;var t=null;for(var n in e.subElements){var r=e.subElements[n];"ProcessStep"===r.type&&(t=r)}var o=this.library.Context.GetPortalContext();return t&&e.currentInnerElementPath!==t.id&&(e.currentInnerElementPath=t.id,o.currentPath=e.getPath(),this.library.Context.SaveContext()),o},I.prototype.SwitchToMainProcessAsync=function(e){e(this.SwitchToMainProcess())},I.prototype.SwitchToStep=function(e,t){var n,r=this.library.Context.GetPortalContext();if((n=this.library.Context.GetCurrentProcess())&&this.library.Context.GetCurrentStep(n),!n)throw"no current process";for(var o in n.subElements){var i=n.subElements[o];if(i.id===e){n.currentInnerElementPath=i.id;var s=this.library.Core.FindKeysToReplace(i.url);if(s&&0<s.length){var a=this.library.Context.GetListFromContext(s);for(var c in a){var u=a[c];i.url=i.url.replace(new RegExp("\\["+u.Key+"\\]","g"),u.Value)}}return this.library.Context.SaveContext(),r}}throw"step '"+e+"' not found"},I.prototype.SwitchToCurrentProcess=function(){var e=this.library.Context.GetPortalContext();return this.library.Context.SwitchToProcess(e.currentPath),this.library.Context.GetPortalContext()},I.prototype.SwitchToCurrentProcessAsync=function(e){e(this.SwitchToCurrentProcess())},I.prototype.EndSubProcess=function(e){this.library.Context.GetPortalContext();var t=T.Context.PortalContext.GetPathPart(e,T.Context.PATH_PART.PREVIOUS_PROCESS_ID),n=e.indexOf(t);t=e.substr(0,n)+t;var r=T.Context.PortalContext.GetPathPart(e,T.Context.PATH_PART.LAST_PROCESS_ID);r=t+"|"+r,this.library.Context.RemoveStep(r,t)},I.prototype.RemoveSubProcessIfSingle=function(e,t,n){for(var r=-1,o=T.Context.PortalContext.GetPathPart(t,T.Context.PATH_PART.MAIN_PROCESS_ID),i=T.Context.PortalContext.GetPathPart(t,T.Context.PATH_PART.LAST_PROCESS_ID),s=0;s<n.length;s++)if("Process"===(u=n[s]).type){var a=u;if(T.Context.PortalContext.GetPathPart(a.id,T.Context.PATH_PART.STEP_ID)===o){if(o!==i)return this.RemoveSubProcessIfSingle(e,t.replace(o+"|",""),a.subElements);r=s;break}}var c=null;if(0<=r){c=n.splice(r,1)[0];var u,l=this.library.Context.GetParentProcess(c);0<n.length?"Process"===(u=n[n.length-1]).type?e.currentPath=u.getPath():(l.currentInnerElementPath=u.id,e.currentPath=l.id+"|"+u.id):e.currentPath=""}return c},I.prototype._getPrevious=function(e,t){for(var n=T.CoreCommon.ServiceDePromesse.defer(),r=-1,o=0;o<e.subElements.length;o++)if(e.subElements[o].id==t.id){r=o-1;break}var i=e.subElements[r];if("ProcessStep"===i.type){var s=i,a=new P.NextResult(null);a.FinProcess=!1,a.CodeEtape=t.codeEtape,a.ValeurFinProcess=null,a.ValeurSortie=null,a.ProchaineEtape=JSON.parse(s.etapeResultAsString),n.resolve(a)}else n.reject(new T.Erreur("l'étape précédente n'est pas une étape applicative"));return n.promise},I.prototype._startSubProcess=function(e,t){var n=this;return this._start(e,t,"main",null).then(function(e){return n.SendEvent(new T.Component.ManagerEvent(T.Component.ManagerEventType.NouveauSousProcess,{portalContext:n.library.Context.GetPortalContext()})),e})},I.prototype._start=function(n,r,o,i){var s=this;I.logger.info("Demande de démarrage du processus : %1",n);var e,a=!1;if(this._modeVerificationProcessus===T.ModeVerificationProcessus.Aucun){a=!0;var t=T.CoreCommon.ServiceDePromesse.defer();t.resolve(),e=t.promise}else e=this.api.getHabilitationProcessus(n).then(function(t){return s.library.Habilitation.EstHabilite([t]).then(function(e){1===e.length?!1===e[0]?I.logger.warn("Utilisateur non autorisé à démarrer le processus %1. Habilitation du processus %2 non déclarée",n,t):(a=!0,I.logger.debug("Utilisateur autorisé à démarrer le processus %1. Habilitation du processus %2 trouvée",n,t)):I.logger.warn("Impossible de vérifier si l'utilisateur est habilité au processus %1 (Habilitation %2)",n,t)})}).catch(function(e){I.logger.warn("Impossible de récupérer l'habilitation nécessaire au processus %1",n)});return this.library.Core.promesseTryCatch(function(t){e.finally(function(){if(!a&&s._modeVerificationProcessus===T.ModeVerificationProcessus.Erreur){var e="Le processus n'est pas lancé en raison d'un problème d'habilitation";return I.logger.error(e),void t.reject(new T.Erreur(e))}s.api.start(n,r).then(function(e){if(e&&e.ProcessDemarre){I.logger.info("Démarrage du processus : %1",e.ProcessDemarre.Nom);try{s._launchNextStep(e,o,i,null).then(function(e){try{i&&i.displayName&&s.library.Context.ChangeProcessName(i.displayName,e.processId),t.resolve(e)}catch(e){T.Loggers.FLASH.INSTANCE.setValue("action","Next"),I.logger.error("change process name failed"),t.reject(e)}})}catch(e){t.reject(e)}}else I.logger.warn("Aucun processus démarré"),t.resolve(null)}).catch(t.reject)})})},I.prototype._getCodesProcessus=function(){return this.api.getCodesProcessus()},I.prototype._getInfoProcessus=function(e){return this.api.getInfoProcessus(e)},I.prototype._getTools=function(){var r=this;return this.api.getTools().then(function(e){for(var t in e){var n=e[t];n.Url=r.replaceTokens(n.Url,null)}return e})},I.prototype._handleNext=function(u,l,e){var p=this;if(e&&e.FinProcess){var f=this.library.Context.GetCurrentProcess(),g=(n=this.library.Context.GetPortalContext()).currentPath;if(f.codeEtape)return this.api.next(f.codeEtape,e.ValeurFinProcess).then(function(e){if(e){var t=[];if((f=p.library.Context.GetCurrentProcess()).outputContracts)for(var n in f.outputContracts){var r=f.outputContracts[n],o=p.library.Context.GetFromContext(r);t.push({Key:r,Value:o})}0<t.length&&p.library.Context.AddListToContext(T.Context.StorageLevel.Process,t,p.library.Context.GetParentProcess(f).id),I.logger.info("FSP"),(s=new T.TraceSuivi.TraceSuiviModel).state="FS",p.library.TraceSuivi.tracer(s);var i=f.lastNextTime;return p.EndSubProcess(g),p.library.Context.GetCurrentProcess().lastNextTime=i,p._handleNext(u,l,e)}var s;I.logger.info("FP"),f.contexteClientId&&p.library.ContexteClient.changeContexteOfProcess(null,f.id,null),(s=new T.TraceSuivi.TraceSuiviModel).state="FP",p.library.TraceSuivi.tracer(s),p._notifyEndProcessus(),p.library.Context.RemoveCurrentProcess();var a=p.library.Context.GetPortalContext();p.SendEvent(new T.Component.ManagerEvent(T.Component.ManagerEventType.FinDeProcessus,{portalContext:a})),p.DisplayProcessesOnProcessEnd&&(0<a.processes.length?p.library.Context.DisplayProcesses():p.library.Display.DisplayBaseFrame());var c=new P.LisaCallbackResult;return c.finDeProcessus=!0,p.library.Core.createPromiseSelfResolved(c)});I.logger.info("FP");var t=new T.TraceSuivi.TraceSuiviModel;f.contexteClientId&&this.library.ContexteClient.changeContexteOfProcess(null,f.id,null),t.state="FP",this.library.TraceSuivi.tracer(t),this._notifyEndProcessus(),this.library.Context.RemoveCurrentProcess();var n=this.library.Context.GetPortalContext();this.SendEvent(new T.Component.ManagerEvent(T.Component.ManagerEventType.FinDeProcessus,{portalContext:n})),this.DisplayProcessesOnProcessEnd&&(0<n.processes.length?this.library.Context.DisplayProcesses():this.library.Display.DisplayBaseFrame());var r=new P.LisaCallbackResult;return r.finDeProcessus=!0,this.library.Core.createPromiseSelfResolved(r)}return e?e.ProchaineEtape?this._launchNextStep(e,"current",null,l):this.library.Core.createPromiseSelfError(new T.Erreur("Aucune prochaine etape trouvée pour l'enchainement de "+u+" sortie "+l)):(T.Loggers.FLASH.INSTANCE.setValue("action","Next"),I.logger.error("pas de next trouvé pour etape %1, valeur %2",u,l),this.library.Core.createPromiseSelfResolved(null))},I.prototype._notifyEndProcessus=function(){if(this.onFinProcessus)try{this.onFinProcessus(this.library.Context.GetMainProcessId())}catch(e){T.Loggers.FLASH.INSTANCE.setValue("action","NotifyEndProcessus"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("une erreur est survenue lors de la notification de fin de processus")}},I.prototype._launchNextStep=function(e,t,n,r){var o=this,i=[];for(var s in e.ProchaineEtape.Contrats){var a=e.ProchaineEtape.Contrats[s];"IN"===a.Mode&&i.push(a.Code)}var c,u=e.ProchaineEtape;"current"===t?c=this.library.Context.GetCurrentProcess():"main"===t&&(c=this.library.Context.GetCurrentMainProcess());var l=this.library.Context.GetCurrentStep(c);if(c){var p=this._handlePreviousSteps(e,c);if(p)return this.library.Core.createPromiseSelfResolved(p)}u.Actions,u.Contrats;var f=new P.LisaCallbackResult,g=null;if(e.ProcessDemarre){var h=e.ProcessDemarre.Code;h+="-"+T.CoreCommon.creerChaineAleatoire(8);var d=null;e.ProcessDemarre.OptionsProcess&&(d=JSON.parse(e.ProcessDemarre.OptionsProcess));var m=e.ProcessDemarre.Nom;if(n&&n.displayName&&(m=n.displayName),c){var y=null;e.ProcessDemarre.OptionsProcessAsEtape&&(y=JSON.parse(e.ProcessDemarre.OptionsProcessAsEtape)),this.AddSubProcess(h,c,m,e.ProcessDemarre.Code,e.ProcessDemarre.CodeEtape,e.ProcessDemarre.Actions,e.ProcessDemarre.EtapesConnues,d,y),y&&y.Mappage&&this._translateContext(y.Mappage,T.Context.StorageLevel.Process),I.logger.info("DSP"),(A=new T.TraceSuivi.TraceSuiviModel).state="DS",this.library.TraceSuivi.tracer(A)}else{var v=null;if(n){g=n.idClient;var C=n.idContexteClient;g?v=this.library.ContexteClient.nouveauContexte(g):C?v=this.library.ContexteClient.getContexte(C):""===g&&(v=this.library.ContexteClient.nouveauContexte())}var S=this.AddProcess(h,m,e.ProcessDemarre.Code,e.ProcessDemarre.EtapesConnues,d,v?v.getId():null);v&&v.ajouterProcessus(S),this.library.Interop.NotifyBeginProcessus(h),I.logger.info("DP"),(A=new T.TraceSuivi.TraceSuiviModel).state="DP",this.library.TraceSuivi.tracer(A),d&&d.TypeProcess}if(f.processId=h,f.codeProcessus=e.ProcessDemarre.Code,n&&n.contextArray)for(var s in this.library.Context.AddListToContext(T.Context.StorageLevel.Process,n.contextArray),n.contextArray){var E=n.contextArray[s];if("IDCLIENT"===E.Key){g=E.Value;break}}}u=e.ProchaineEtape;var A,b=this._evaluateUrl(u),M=null;return u.OptionsEtape&&(M=JSON.parse(u.OptionsEtape)),M=M||{},l&&(l.maintienIFrameLastAction=l.maintienIFrame,l.actions&&l.actions.every(function(e){if(e.ValeurSortie!==r)return!0;var t={};try{t=JSON.parse(e.Options)}catch(e){}return!0===t.MaintienIFrame||"true"===t.MaintienIFrame?l.maintienIFrameLastAction=!0:!1!==t.MaintienIFrame&&"false"!==t.MaintienIFrame||(l.maintienIFrameLastAction=!1),!1})),l&&!0===l.maintienIFrameLastAction&&(b.indexOf(".js")===b.length-3?M.MaintienIFrame=!0:M.NouvelleIFrame=!0),this.AddStepWithResult(u,b,M),M&&M.Mappage&&this._translateContext(M.Mappage,T.Context.StorageLevel.Step),I.logger.info("DE"),I.logger.info("Nouvelle etape : %1, options: %2",u.CodeEtape,JSON.stringify(M)),(A=new T.TraceSuivi.TraceSuiviModel).state="DE",this.library.TraceSuivi.tracer(A),f.codeEtape=u.CodeEtape,M&&M.NouvelleIFrame?f.nouvelleIframe=!0:f.nouvelleIframe=!1,n&&n.subProcessCode?this._start(n.subProcessCode,null,"current",null).then(function(e){return f.sousProcessusDemarre=e.codeProcessus,o._finalizeCallbackResultValues(f),f},function(e){return T.Loggers.FLASH.INSTANCE.setValue("action","Next"),T.Loggers.FLASH.INSTANCE.setValue("details",e),I.logger.error("sous processus '%1' demandé mais en echec",n.subProcessCode),f}):(this._finalizeCallbackResultValues(f),this.library.Core.createPromiseSelfResolved(f))},I.prototype._evaluateUrl=function(e){var t=[];for(var n in e.Contrats){var r=e.Contrats[n];"IN"===r.Mode&&t.push(r.Code)}this._translateContext(t,T.Context.StorageLevel.Process);var o="";return e.LocalisationAbsolue&&(o+=e.LocalisationAbsolue),e.LocalisationRelative&&(o+=e.LocalisationRelative),o=this.replaceTokens(o,t),"PMM"===e.TypeApplication&&(o=this._addModeMyWay(o)),o},I.prototype._addModeMyWay=function(e){0<e.indexOf("?")?e+="&":e+="?";var t=y.Services.PortalServiceParameters.Instance().Environnement.toLowerCase(),n=this.library.Context.GetFromContext("VERS"),r={environnement:t,version:n=n&&n.substring(1)};return e+="modeMyWay="+JSON.stringify(r)},I.prototype._finalizeCallbackResultValues=function(e){var t=this.library.Context.GetCurrentProcess();e.etapeCourante=this.library.Context.GetCurrentStep(t);var n=new T.Aide.InfobulleAfficheeParametres,r=this.library.Context.GetAuthentificationInfo();r&&(n.codeEtablissement=r.codeEtablissement),n.codeEtape=e.codeEtape,n.codeProcessus=e.codeProcessus,this.library.Aide.displayAideFlash(n)},I.prototype._handlePreviousSteps=function(e,t){var n;if(e.ProcessDemarre)return null;for(var r in t.subElements){var o=t.subElements[r];if(o.codeEtape===e.ProchaineEtape.CodeEtape){n=o;break}}if(n){for(var i=this.library.Context.GetPortalContext(),s=i.GetCurrentProcess(),a=i.GetCurrentStep(s);a&&a.codeEtape!==e.ProchaineEtape.CodeEtape;)s=(i=this.library.Context.RemoveCurrentStep(a.codeEtape)).GetCurrentProcess(),a=i.GetCurrentStep(s);var c=this.library.Context.GetCurrentProcess(),u=this.library.Context.GetCurrentStep(c);if(u.etapeResultAsString){var l=JSON.parse(u.etapeResultAsString);u.url=this._evaluateUrl(l)}var p=new P.LisaCallbackResult;return p.codeEtape=u.codeEtape,p.codeProcessus=c.codeProcess,p.etapeCourante=u,p.finDeProcessus=!1,p.processId=c.id,p.sousProcessusDemarre=null,p.retourEtapePrecedente=!0,p}},I.prototype._translateContext=function(e,t){var n=[],r=[],o=[];if(e)for(var i in e){var s=e[i];if(s&&0<s.indexOf("=>")){var a=s.split("=>");n[a[1]]=a[0],o.push(a[0]),r[a[0]]=a[1]}}var c=this.library.Context.GetListFromContext(o,!0),u=[];for(var i in c){var l=c[i];r[l.Key]&&u.push({Key:r[l.Key],Value:l.Value})}this.library.Context.AddListToContext(t,u)},I.prototype._prepareNavigation=function(e,t,n){e&&0<e.length?I._setNextSteps(this,this.library,t,e,t,function(){n&&n(t)}):n&&n(t)},I._setNextSteps=function(e,t,n,r,o,i){var s,a=t.Context.GetCurrentProcess();for(var c in a.subElements){var u=a.subElements[c];if(u.id===n){s=u;break}}s&&I._setNextStep(e,t,s,r.shift(),r,o,I._setNextSteps,i)},I._setNextStep=function(e,t,n,r,o,i,s,a){var c="";r.LocalisationAbsolue&&(c+=r.LocalisationAbsolue),r.LocalisationRelative&&(c+=r.LocalisationRelative),c=e.replaceTokens(c,null);var u=r.CodeEtape;u+="-"+T.CoreCommon.creerChaineAleatoire(8);var l=0==o.length;t.Lisa.AddBoundStep(n,u,r.NomApplication,c,i,l),0<o.length?s(e,t,u,o,i,a):a()},I.prototype._portail_StartProcess=function(e,t,n,r){var o=this;return this.startStandaloneProcessWithInitialisation(e,r,n).then(function(e){return t&&(o.library.Context.PutProcessInWait(e.processId),o.library.Context.SetSingleProcess(e.processId)),o.library.Context.DisplayProcesses(),e})},I.prototype._portail_StartUrl=function(e,t,n){var r=this;return this.startUrl(e,t).then(function(e){return n&&(r.library.Context.PutProcessInWait(e.processId),r.library.Context.SetSingleProcess(e.processId)),r.library.Context.DisplayProcesses(),e})},I.prototype._portail_Next=function(e){var t=this;return this.next(e).then(function(e){return t.endTransition(e),e})},I.prototype._DemarreSousProcessusModeExterne=function(n){var e,t,r,o,i,s=this,a=null;return r=n.ProcessDemarre.Code,t=n.ProcessDemarre.ValeurDepart.toString(),n.ProchaineEtape&&n.ProchaineEtape.OptionsEtape&&JSON.parse(n.ProchaineEtape.OptionsEtape),n.ProcessDemarre.OptionsProcessAsEtape&&(a=JSON.parse(n.ProcessDemarre.OptionsProcessAsEtape)),a&&a.Mappage&&this._translateContext(a.Mappage,T.Context.StorageLevel.Process),a&&a.HorsPortail&&(o=!("true"!=a.HorsPortail&&!a.HorsPortail)),a&&a.SurTablette?i=!("true"!=a.SurTablette&&!a.SurTablette):o=!1,(e=this._FormateInitData(n.ProchaineEtape.Contrats)).processusAOuvrirDansUneNouvelleInstance=o,this.api.DemarrerSousProcessusExterne(r,!0,e,t,o,i).then(function(e){if(e){var t=new P.LisaCallbackResult;return t.codeProcessus=n.ProcessDemarre.Code,t}return T.Loggers.FLASH.INSTANCE.setValue("action","DemarrerSousProcessusExterne"),I.logger.error("Le sous processus n'a pas pu démarrer en mode externe"),s.library.Core.createPromiseSelfError(new T.Erreur("Le sous processus n'a pas pu démarrer en mode externe"))})},I.prototype._FormateInitData=function(e){var t={},n=[],r=[];if(e){for(var o=e.length,i=0;i<o;i++){var s=e[i];r.push(s.Code)}n=this.library.Context.GetListFromContext(r),t.contextArray=n}return t},I.ProcessStepSetValues=function(e,t,n,r,o,i,s,a,c,u,l,p,f,g,h,d){if(e.codeEtape=a,e.codeMetier=c,e.codeApplication=s,e.nomApplication=n,e.valeurEntree=u,e.url=r,e.boundId=l,e.actions=[],e.contextStorage=[],e.processName=t.displayName,o)for(var m=o.length,y=0;y<m;y++){var v=o[y],C=new T.Context.StepAction;C.EstExterne=v.EstExterne,C.Nom=v.NomExterne,C.Options=v.OptionsAction,C.ValeurSortie=v.ValeurSortie,C.CodeEtape=a,e.actions.push(C)}if(e.contrats=[],i){var S=i.length;for(y=0;y<S;y++){var E=i[y],A=new T.Context.StepContrat;A.Code=E.Code,A.Longueur=E.Longueur,A.Mode=E.Mode,A.Nullable=E.Nullable,A.Type=E.Type,e.contrats.push(A)}}e.etapeResultAsString=f,e.isRouteur=h,e.etatEtape=g,e.creationDate=d,p&&p.ProcessusMaitre&&(e.processusMaitre=p.ProcessusMaitre),e.diagnosticTraceSentForStep=!1},I.CLASS_NAME="MyWay.Services.Lisa.LisaManager",I.logger=T.Loggers.LoggerFactory.INSTANCE.getClass(I.CLASS_NAME),e=I,P.LisaManager=e,T.Components.RegistryManager.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var n;(n=e.Services||(e.Services={})).PhantomAgent.addListenerOnInit(function(e,t){e.Lisa=new n.Lisa.PhantomLisaAgent(t)})}(MyWay=MyWay||{}),function(e){var n,t,r;function o(e){this.serviceManager=e}n=e.Services||(e.Services={}),t=n.Lisa||(n.Lisa={}),o.prototype.Next=function(e){var t=n.CoreCommon.ServiceDePromesse.defer();return this.serviceManager.Library.Lisa.next(e),t.promise},o.prototype.NextWithStep=function(e,t){return this.Next(t)},r=o,t.PhantomLisaAgent=r}(MyWay=MyWay||{}),function(n){var r,e,t;function o(){}r=n.Services||(n.Services={}),e=r.Lisa||(r.Lisa={}),Object.defineProperty(o.prototype,"StepInfo",{get:function(){return n.Services.ServiceManager.Instance().Library.Context.GetCurrentStepInfo()},enumerable:!0,configurable:!0}),o.prototype.Next=function(e){n.Services.ServiceManager.Instance().Library.Lisa.next(e).then(function(e){n.Services.ServiceManager.Instance().Library.Lisa.endTransition(e)},function(e){r.Loggers.FLASH.INSTANCE.setValue("details",e),o.logger.error("une erreur est survenue")})},o.prototype.AddToContext=function(e,t){n.Services.ServiceManager.Instance().Library.Context.AddToContext(r.Context.StorageLevel.Process,e,t)},o.prototype.GetFromContext=function(e){return n.Services.ServiceManager.Instance().Library.Context.GetFromContext(e)},o.prototype.LireFichier=function(e){var t=r.CoreCommon.ServiceDePromesse.defer();return n.Services.ServiceManager.Instance().Library.Interop.LireFichier(e).then(function(e){t.resolve(e)}).catch(function(e){t.reject(e)}),t.promise},o.prototype.Previous=function(){n.Services.ServiceManager.Instance().Library.Lisa.previous().then(function(e){n.Services.ServiceManager.Instance().Library.Lisa.endTransition(e)},function(e){r.Loggers.FLASH.INSTANCE.setValue("details",e),o.logger.error("une erreur est survenue")})},o.CLASS_NAME="MyWay.Services.RouteurAgent",o.logger=r.Loggers.LoggerFactory.INSTANCE.getClass(o.CLASS_NAME),t=o,e.RouteurAgentImpl=t,r.RouteurAgent.setImplementation(new t)}(MyWay=MyWay||{}),function(e){var n;(n=e.Services||(e.Services={})).ServiceAgentMobileExtended.addActionPostInit(function(e){var t=n.ServiceManager.Instance().Library.Context.GetFromContext("MobileProcessId");return n.ServiceManager.Instance().Library.Context.GetProcessByIdFromAllPortails(t)?(n.ServiceManager.Instance().Library.Context.PutProcessInWait(t),n.ServiceManager.Instance().Library.Context.SetSingleProcess(t),e.Core.getPromesseSelfResoved()):(t&&n.ServiceManager.Instance().Library.Context.AddToContext(n.Context.StorageLevel.Global,"MobileProcessId",null),n.ServiceManager.Instance().Library.Lisa.startUrl("MobileProcess","").then(function(e){n.ServiceManager.Instance().Library.Context.PutProcessInWait(e.processId),n.ServiceManager.Instance().Library.Context.SetSingleProcess(e.processId),n.ServiceManager.Instance().Library.Context.AddToContext(n.Context.StorageLevel.Global,"MobileProcessId",e.processId)},function(e){}))})}(MyWay=MyWay||{}),function(e){var l,p,f,t;function g(){return f.call(this,l.Components.ComponentType.Lisa)||this}l=e.Services||(e.Services={}),p=l.Lisa||(l.Lisa={}),f=l.Components.ComponentManagerMessageBase,__extends(g,f),g.prototype.reception=function(e){var t=this;switch(e.subject){case p.Messages.LisaMessageSubject.Next:var n=(u=e.message).valeurSortie;return this.managerInstance.next(n).then(function(e){return t.managerInstance.endTransition(e),t.library.Core.getServiceDePromesse().defer().promise},function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),l.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("Next failed - %1",e),new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_LISA_NEXT_IMPOSSIBLE)});case p.Messages.LisaMessageSubject.StartProcess:var r=(u=e.message).processCode,o=u.valeurDepart,i=u.initData;return this.managerInstance.startStandaloneProcessWithInitialisation(r,o,i).then(function(e){return t.managerInstance.endTransition,e},function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),l.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("StartStandaloneProcess failed - %1",e),new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_LISA_START_IMPOSSIBLE)});case p.Messages.LisaMessageSubject.StartProcessPortal:return r=(u=e.message).processCode,o=u.valeurDepart,i=u.initData,this.managerInstance._portail_StartProcess(r,!1,i,o);case p.Messages.LisaMessageSubject.StartSubProcess:return r=(u=e.message).processCode,o=u.valeurDepart,this.managerInstance._startSubProcess(r,o).then(this.managerInstance.endTransition,function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),l.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("StartSubProcess failed - %1",e),new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_LISA_START_IMPOSSIBLE)});case p.Messages.LisaMessageSubject.StartUrl:var s=(u=e.message).name,a=u.url;return this.managerInstance.startUrl(s,a).then(function(e){return t.managerInstance.endTransition,e},function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),l.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("StartExternalApp failed - %1",e),new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_LISA_START_IMPOSSIBLE)});case p.Messages.LisaMessageSubject.StartUrlPortal:return s=(u=e.message).name,a=u.url,this.managerInstance._portail_StartUrl(s,a,!1);case p.Messages.LisaMessageSubject.StartExternalApp:if(s=(u=e.message).name,a=u.url,u.standAlone){var c=l.PrivatePortalServiceParameters.Instance().LisaPlaceholders["URL-SPA"]+l.PrivatePortalServiceParameters.Instance().LisaPlaceholders.ALIASPORTAIL+"/?u="+encodeURIComponent(a)+"&n="+s;return window.open(c),this.managerInstance.endTransition(null),this.library.Core.getPromesseSelfResoved()}return this.managerInstance.startUrl(s,a).then(function(e){return t.managerInstance.endTransition,e},function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),l.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("StartExternalApp failed - %1",e),new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_LISA_START_IMPOSSIBLE)});case p.Messages.LisaMessageSubject.GetTools:var u=e.message;return this.managerInstance._getTools().catch(function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),l.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("GetTools failed - %1",e.codeLibelle),new l.Erreur(l.Libelle.LibelleModel.COM.ERREUR_LISA_GETTOOLS_IMPOSSIBLE)});case p.Messages.LisaMessageSubject.GetCodesProcessus:return u=e.message,this.managerInstance._getCodesProcessus().catch(function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),l.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("GetCodesProcessus failed - %1",e.codeLibelle),new l.Erreur("GetCodesProcessus failed")});case p.Messages.LisaMessageSubject.GetInfoProcessus:return u=e.message,this.managerInstance._getInfoProcessus(u.codeProcessus).catch(function(e){throw l.Loggers.FLASH.INSTANCE.setValue("action","HandleMessage"),l.Loggers.FLASH.INSTANCE.setValue("details",e),g.logger.error("GetInfoProcessus failed - %1",e.codeLibelle),new l.Erreur("GetInfoProcessus failed")});default:return f.prototype.reception.call(this,e)}},g.CLASS_NAME="MyWay.Services.Lisa.LisaManagerMessage",g.logger=l.Loggers.LoggerFactory.INSTANCE.getClass(g.CLASS_NAME),t=g,p.LisaManagerMessage=t,l.Components.RegistryManagerMessage.getInstance().register(t)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Lisa)||this}t=e.Services||(e.Services={}),n=t.Lisa||(t.Lisa={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.StartProcess=function(e,t,n,r){return this.manager._portail_StartProcess(e,t,n,r)},i.prototype.StartUrl=function(e,t,n){return this.manager._portail_StartUrl(e,t,n)},i.prototype.Next=function(e){return this.manager._portail_Next(e)},o=i,n.LisaManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(l){var p,e,t;function f(){this.libraryManager=null,this.privatePortalServiceParameters=null,this._localServiceUrl=p.PrivatePortalServiceParameters.Instance().LocalServiceUrl}p=l.Services||(l.Services={}),e=p.Application||(p.Application={}),f.prototype.init=function(e,t){this.libraryManager=e,this.privatePortalServiceParameters=t.privatePortalServiceParameters},f.prototype.GetApplication=function(e,t){return e?this.libraryManager.Core.sendRequest({url:p.PrivatePortalServiceParameters.Instance().ApplicationUrl+"/?codeApplication="+e+"&versionDebutPublication="+p.CoreCommon.VersionMySys,method:p.MethodEnum.GET,authentificationInfo:t}).then(function(e){return p.Loggers.FLASH.INSTANCE.setValue("details",e),f.loggerApplicationApiBase.debug("GetApplication Success"),e},function(e){throw f.loggerApplicationApiBase.error("GetApplication failed - %1",JSON.stringify(e)),e}):this.libraryManager.Core.createPromiseSelfError(new p.Erreur(l.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_CODE_NON_RENSEIGNE))},f.prototype.Demarrer=function(e){return this.libraryManager.Core.createPromiseSelfResolved(!1)},f.prototype.Lancer=function(e,t,n){if(this.privatePortalServiceParameters.LocalServiceDisabled)return this.warnLocalServiceUnavailability(),this.libraryManager.Core.createPromiseSelfError(new p.Erreur(l.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_DEMARRAGE_IMPO));var r=JSON.stringify(e),o=JSON.stringify("null");return this.libraryManager.Core.sendRequest({url:this._localServiceUrl+"/lanceur/lancer?exec="+r+"&parametres="+JSON.stringify(t)+"&contexte="+o+"&sync="+n,contentType:p.ContentTypeEnum.JSON,method:p.MethodEnum.POST,cache:!1}).then(function(){return p.Loggers.FLASH.INSTANCE.setValue("details",t),f.loggerApplicationApiBase.debug("Lancer du Service Local - Success"),!0},function(){return f.loggerApplicationApiBase.error("Lancer du Service Local - Failed"),!1})},f.prototype.OuvrirUrl=function(e,t){var n=this;return 1===e.codeExecutableConteneurMyway&&t?this.libraryManager.Lisa.startUrl(e.libelleNomApplication,e.libelleCheminExecution).then(function(e){return n.libraryManager.Lisa.endTransition(e),f.loggerApplicationApiBase.debug("Start URL Success"),!0},function(e){throw f.loggerApplicationApiBase.error("Start URL failed - %1",JSON.stringify(e)),e}):(this.libraryManager.Display.OuvrirUrl(e.libelleCheminExecution),f.loggerApplicationApiBase.debug("OuvrirUrl Success"),this.libraryManager.Core.createPromiseSelfResolved(!0))},f.prototype.LancerApplicationClientLourd=function(e,t){var n=new l.Services.Interop.ExecApp(e.libelleCheminExecution),r=new l.Services.Interop.ExecutableWrapper(n,null,null,null);return new l.Services.Interop.ContexteMyway(null,null),this.Lancer(r,t,!1).then(function(e){return f.loggerApplicationApiBase.debug("API Lancer - Success"),e},function(e){throw e=new p.Erreur(l.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_DEMARRAGE_IMPO),f.loggerApplicationApiBase.error("API Lancer - failed - %1",JSON.stringify(e)),e})},f.prototype.DemarrerProcessus=function(e,t,n,r){var o,i=this;if(t){var s=JSON.stringify(n),a={};a.codeProcessus=e,r&&(a.valeurDepart=r.toString()),a.initData=s;var c={};c.demandeDeDemarrageDeProcessusDetail=a;var u=new p.Component.ManagerEvent(p.Component.ManagerEventType.DemandeDeDemarrageDeProcessus,c);return p.Loggers.FLASH.INSTANCE.setValue("action","_handlePortalMessage"),f.loggerApplicationApiBase.debug("Send event 'DemarreProcess' : process=%1, valeurDepart=%2, initData=%3",e,r,s),this.libraryManager.Evennements.SendEvent(u),this.libraryManager.Core.createPromiseSelfResolved(!0)}return o=null==r?null:parseInt(r),this.libraryManager.Lisa.startStandaloneProcessWithInitialisation(e,o,n).then(function(e){return n.processusAOuvrirDansUneNouvelleInstance&&i.libraryManager.Context.PutProcessInWait(e.processId),i.libraryManager.Lisa.endTransition(e),f.loggerApplicationApiBase.debug("StartStandaloneProcessWithInitialisation Success"),!0},function(){var e=new p.Erreur(l.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_DEMARRAGE_IMPO);throw f.loggerApplicationApiBase.error("StartStandaloneProcessWithInitialisation failed - %1",JSON.stringify(e)),e})},f.prototype.warnLocalServiceUnavailability=function(){f.loggerApplicationApiBase.warn("Le service local n'a pu être joint et a été désactivé. Veuillez redémarrer le service local et recharger le portail")},f.CLASS_NAME_BASE="MyWay.Services.Application.ApplicationApiBase",f.loggerApplicationApiBase=p.Loggers.LoggerFactory.INSTANCE.getClass(f.CLASS_NAME_BASE),t=f,e.ApplicationApiBase=t}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Application)||this;return e.api=null,e}t=e.Services||(e.Services={}),o=t.Application||(t.Application={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?e.InteropAppliBancaire?this.api=new o.ApplicationApiPetra:this.api=new o.ApplicationApiWindows:this.api=new o.ApplicationApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){r.api.init(t,n)})},r.prototype.dispose=function(){return this.libraryManager.Core.getPromesseSelfResoved()},r.prototype.GetApplication=function(e,t){return this.api.GetApplication(e,t)},r.prototype.Demarrer=function(e){return this.api.Demarrer(e)},r.prototype.Lancer=function(e,t,n){return this.api.Lancer(e,t,n)},r.prototype.OuvrirUrl=function(e,t){return this.api.OuvrirUrl(e,t)},r.prototype.LancerApplicationClientLourd=function(e,t){return this.api.LancerApplicationClientLourd(e,t)},r.prototype.DemarrerProcessus=function(e,t,n,r){return this.api.DemarrerProcessus(e,t,n,r)},n=r,o.ApplicationApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(t){var n,e,r,o;function i(){return r.call(this)||this}n=t.Services||(t.Services={}),e=n.Application||(n.Application={}),r=e.ApplicationApiBase,__extends(i,r),i.prototype.LancerApplicationClientLourd=function(e){return this.warnLocalServiceUnavailability(),this.libraryManager.Core.createPromiseSelfError(new n.Erreur(t.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_DEMARRAGE_IMPO))},i.CLASS_NAME="MyWay.Services.Application.ApplicationApiFullWeb",i.logger=n.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,e.ApplicationApiFullWeb=o}(MyWay=MyWay||{}),function(r){var i,e,t,n;function s(){return t.call(this)||this}i=r.Services||(r.Services={}),e=i.Application||(i.Application={}),t=e.ApplicationApiBase,__extends(s,t),s.prototype.DemarrerProcessus=function(e,t,n,r){var o=JSON.stringify(n);return this.libraryManager.Core.sendRequest({url:this.privatePortalServiceParameters.LocalServiceUrl+"/lanceur/DemarrerProcessus?codeProcessus="+e+"&initData="+o+"&valeurEntree="+(null==r?"":r),contentType:i.ContentTypeEnum.JSON,method:i.MethodEnum.GET,cache:!1}).then(function(){return i.Loggers.FLASH.INSTANCE.setValue("details",e),s.logger.debug("DemarrerProcessus du Service Local - Success"),!0},function(){return s.logger.error("DemarrerProcessus du Service Local - Failed"),!1})},s.prototype.OuvrirUrl=function(e){i.CoreCommon.ServiceDePromesse.defer();var t=new r.Services.Interop.ExecWeb(e.libelleCheminExecution,e.libelleNomApplication),n=new r.Services.Interop.ExecutableWrapper(null,null,null,t);return new r.Services.Interop.ContexteMyway(null,null),this.Lancer(n,[],!1).then(function(e){return s.logger.debug("API Ouvrir URL - Success"),e},function(e){throw e=new i.Erreur(r.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_DEMARRAGE_IMPO),s.logger.error("API Ouvrir URL - failed - %1",JSON.stringify(e)),e})},s.CLASS_NAME="MyWay.Services.Application.ApplicationApiPetra",s.logger=i.Loggers.LoggerFactory.INSTANCE.getClass(s.CLASS_NAME),n=s,e.ApplicationApiPetra=n}(MyWay=MyWay||{}),function(l){var p,e,t,n;function f(){return t.call(this)||this}p=l.Services||(l.Services={}),e=p.Application||(p.Application={}),t=e.ApplicationApiBase,__extends(f,t),f.prototype.DemarrerProcessus=function(t,n,r,o){var e,i=this;if(r={},n){var s=JSON.stringify(r),a={};a.codeProcessus=t,o&&(a.valeurDepart=o.toString()),a.initData=s;var c={};c.demandeDeDemarrageDeProcessusDetail=a;var u=new p.Component.ManagerEvent(p.Component.ManagerEventType.DemandeDeDemarrageDeProcessus,c);return p.Loggers.FLASH.INSTANCE.setValue("action","_handlePortalMessage"),f.logger.debug("Send event 'DemarreProcess' : process=%1, valeurDepart=%2, initData=%3",t,o,s),this.libraryManager.Evennements.SendEvent(u),this.libraryManager.Core.createPromiseSelfResolved(!0)}return e=null==o?null:parseInt(o),this.libraryManager.Lisa.startStandaloneProcessWithInitialisation(t,e,r).then(function(e){return r.processusAOuvrirDansUneNouvelleInstance&&i.LancerProcessusAvecServiceLocal(t,n,r,o),i.libraryManager.Lisa.endTransition(e),f.logger.debug("StartStandaloneProcessWithInitialisation Success"),!0},function(){var e=new p.Erreur(l.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_DEMARRAGE_IMPO);throw f.logger.error("StartStandaloneProcessWithInitialisation failed - %1",JSON.stringify(e)),e})},f.prototype.LancerProcessusAvecServiceLocal=function(e,t,n,r){var o=JSON.stringify(n);return this.libraryManager.Core.sendRequest({url:this.privatePortalServiceParameters.LocalServiceUrl+"/lanceur/DemarrerProcessus?codeProcessus="+e+"&initData="+o+"&valeurEntree="+(null==r?"":r),contentType:p.ContentTypeEnum.JSON,method:p.MethodEnum.GET,cache:!1}).then(function(){return p.Loggers.FLASH.INSTANCE.setValue("details",e),f.logger.debug("DemarrerProcessus du Service Local - Success"),!0},function(){return f.logger.error("DemarrerProcessus du Service Local - Failed"),!1})},f.CLASS_NAME="MyWay.Services.Application.ApplicationApiWindows",f.logger=p.Loggers.LoggerFactory.INSTANCE.getClass(f.CLASS_NAME),n=f,e.ApplicationApiWindows=n}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.Application||(t.Application={})).TYPE_URL_GET="G",n.TYPE_URL_POST="P"}(MyWay=MyWay||{}),function(a){var c,u,o,e;function l(){var e=o.call(this,c.Components.ComponentType.Application)||this;return e.contextKey="APPLICATIONS",e.isTotemCapable=!0,e.delegationPortail=!1,e.api=null,e}c=a.Services||(a.Services={}),u=c.Application||(c.Application={}),o=c.Components.ComponentManagerBase,__extends(l,o),l.prototype.init=function(e,t,n,r){return this.api=r,this.isTotemCapable=n.isTotemCapable,n.delegationPortail&&(this.delegationPortail=n.delegationPortail),o.prototype.init.call(this,e,t,n,r)},l.prototype.remplacerVariablesContexte=function(e){return this.library.Lisa.replaceTokens(e,null).replace(new RegExp("[[]+[a-zA-Z0-9]+]|undefined","g"),"")},l.prototype.creerUrlAvecParametres=function(e){var t=this;return e.map(function(e){return e.nomVariablePost=t.remplacerVariablesContexte(e.nomVariablePost),e.valeurVariablePost=t.remplacerVariablesContexte(e.valeurVariablePost),c.CoreCommon.encoderURL(e.nomVariablePost)+"="+c.CoreCommon.encoderURL(e.valeurVariablePost)}).join("&")},l.prototype.Demarrer=function(e,t,n){var i=this;void 0===t&&(t=null),null===t&&(t=this.delegationPortail);var s=c.CoreCommon.ServiceDePromesse.defer();if(e)this.ObtenirInformationsApplication(e).then(function(e){if(1===e.codeApplicationMaintenance){var t=new c.Erreur(a.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_MAINTENANCE);return e.libelleMessageMaintenance&&(t.libelle=e.libelleMessageMaintenance),c.Loggers.FLASH.INSTANCE.setValue("details",t),l.logger.debug("Application en maintenance"),s.reject(t)}switch(e.codeTypeApplication){case 1:case 2:case 5:if(e.libelleCheminExecution=i.remplacerVariablesContexte(e.libelleCheminExecution),e.libelleValeurParametre2===u.TYPE_URL_GET&&0<e.listeApplicationUrlValeur.length){var n=i.creerUrlAvecParametres(e.listeApplicationUrlValeur);e.libelleCheminExecution+="?"+n}i.api.OuvrirUrl(e,i.isTotemCapable).then(function(e){s.resolve(e)}).catch(function(e){s.reject(e)});break;case 3:var r=[];null!==e.libelleValeurParametre1&&(e.libelleValeurParametre1=i.remplacerVariablesContexte(e.libelleValeurParametre1),r.push(e.libelleValeurParametre1)),i.api.LancerApplicationClientLourd(e,r).then(function(e){s.resolve(e)}).catch(function(e){s.reject(e)});break;default:var o=new c.Erreur(a.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_TYPE_INCONNU);l.logger.error("ObtenirInformationsApplication failed  %1",JSON.stringify(o)),s.reject(o)}}).catch(function(e){s.reject(e)});else{var r=new c.Erreur(a.Services.Libelle.LibelleModel.COM.ERREUR_APPLICATION_CODE_NON_RENSEIGNE);l.logger.error("Demarrer %1",JSON.stringify(r)),s.reject(r)}return s.promise},l.prototype.DemarrerProcessus=function(e,t,n,r){void 0===t&&(t=null),void 0===r&&(r=null),null===t&&(t=this.delegationPortail);var o=c.CoreCommon.ServiceDePromesse.defer();return this.api.DemarrerProcessus(e,t,n,r).then(function(e){o.resolve(e)}).catch(function(e){o.reject(e)}),o.promise},l.prototype.ObtenirInformationsApplication=function(e){return this.api.GetApplication(e,this.library.Context.GetAuthentificationInfo())},l.CLASS_NAME="MyWay.Services.Application.ApplicationManager",l.logger=c.Loggers.LoggerFactory.INSTANCE.getClass(l.CLASS_NAME),e=l,u.ApplicationManager=e,c.Components.RegistryManager.getInstance().register(e)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Application)||this}t=e.Services||(e.Services={}),n=t.Application||(t.Application={}),r=t.Components.ComponentManagerExtendedBase,__extends(i,r),i.prototype.Demarrer=function(e){return this.manager.Demarrer(e,null)},i.prototype.DemarrerProcessus=function(e,t,n,r){return void 0===t&&(t=null),void 0===r&&(r=null),this.manager.DemarrerProcessus(e,t,n,r)},o=i,n.ApplicationManagerExtended=o,t.Components.RegistryManagerExtended.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t,n,r,o;function i(){return r.call(this,t.Components.ComponentType.Application)||this}t=e.Services||(e.Services={}),n=t.Application||(t.Application={}),r=t.Components.ComponentManagerMessageBase,__extends(i,r),i.prototype.onDemarrer=function(e){return this.managerInstance.Demarrer(e.codeApplication)},i.prototype.onDemarrerProcessus=function(e){return this.managerInstance.DemarrerProcessus(e.codeProcessus,e.delegationPortail,e.initData,e.valeurDepart)},i.prototype.reception=function(e){switch(e.subject){case n.Messages.ApplicationMessageSubject.Demarrer:return this.onDemarrer(e.message);case n.Messages.ApplicationMessageSubject.DemarrerProcessus:return this.onDemarrerProcessus(e.message);default:r.prototype.reception.call(this,e)}},i.CLASS_NAME="MyWay.Services.Application.ApplicationManagerMessage",i.logger=t.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,n.ApplicationManagerMessage=o,t.Components.RegistryManagerMessage.getInstance().register(o)}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t,n;t=e.Services||(e.Services={}),(n=t.Components||(t.Components={})).ComponentType||(n.ComponentType={})}(MyWay=MyWay||{}),function(e){var t;t=e.Services||(e.Services={}),"undefined"!=typeof angular&&(t.moduleAgent=angular.module("moduleAgent",["ng"]))}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Components||(t.Components={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Components||(t.Components={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Components||(t.Components={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Components||(t.Components={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t,o,i,n;function r(){var e=i.call(this,t.Components.ComponentType.Communication)||this;return e.wrapped=null,e}t=e.Services||(e.Services={}),o=t.Communication||(t.Communication={}),i=t.Components.ComponentApiBase,__extends(r,i),r.prototype.init=function(e,t,n){var r=this;return e.ServiceLocal?this.wrapped=new o.CommunicationApiWindows:this.wrapped=new o.CommunicationApiFullWeb,i.prototype.init.call(this,e,t,n).then(function(){return r.wrapped.initApi(t)})},r.prototype.initApi=function(e){},r.prototype.declencherAppel=function(e,t){return this.wrapped.declencherAppel(e,t)},r.prototype.raccrocherAppel=function(e){return this.wrapped.raccrocherAppel(e)},r.prototype.envoyerMessageAppliKiosque=function(e){return this.wrapped.envoyerMessageAppliKiosque(e)},n=r,o.CommunicationApiFactory=n,t.Components.RegistryApi.getInstance().register(n)}(MyWay=MyWay||{}),function(e){var n,t,r,o;function i(){var e=r.call(this)||this;return e._localServiceUrl=n.PrivatePortalServiceParameters.Instance().LocalServiceUrl,e}n=e.Services||(e.Services={}),t=n.Communication||(n.Communication={}),r=t.CommunicationApiBase,__extends(i,r),i.prototype.envoyerMessageAppliKiosque=function(e){var t={url:this._localServiceUrl+"/com/SendMessage",method:n.MethodEnum.POST,async:!0,contentType:n.ContentTypeEnum.JSON,data:e,cache:!1};return i.logger.debug("Envoi du message "+e+"à l'application externe"),this.libraryManager.Core.sendRequest(t).then(function(){return i.logger.debug("Message envoyé à l'application externe - Success"),"Message Envoyé à l'agent"},function(){return i.logger.error("Message non envoyé à l'application externe - Failed"),"Message non Envoyé à l'agent"})},i.CLASS_NAME="MyWay.Services.Communication.CommunicationApiWindows",i.logger=n.Loggers.LoggerFactory.INSTANCE.getClass(i.CLASS_NAME),o=i,t.CommunicationApiWindows=o}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(h,b){function t(e,t){return t.toUpperCase()}function r(e){!d.addEventListener&&"load"!==e.type&&"complete"!==d.readyState||(R(),Se.ready())}var o,n,y=typeof b,e=h.location,d=h.document,i=d.documentElement,s=h.jQuery,a=h.$,c={},p=[],u="1.10.2",m=p.concat,l=p.push,f=p.slice,g=p.indexOf,v=c.toString,C=c.hasOwnProperty,S=u.trim,Se=function(e,t){return new Se.fn.init(e,t,n)},E=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,M=/\S+/g,A=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,T=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,P=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,I=/^[\],:{}\s]*$/,N=/(?:^|:|,)(?:\s*\[)+/g,L=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,_=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,x=/^-ms-/,D=/-([\da-z])/gi,R=function(){d.addEventListener?(d.removeEventListener("DOMContentLoaded",r,!1),h.removeEventListener("load",r,!1)):(d.detachEvent("onreadystatechange",r),h.detachEvent("onload",r))};function O(e){var t=e.length,n=Se.type(e);return!Se.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===n||"function"!==n&&(0===t||"number"==typeof t&&0<t&&t-1 in e)))}Se.fn=Se.prototype={jquery:u,constructor:Se,init:function(e,t,n){var r,o;if(!e)return this;if("string"!=typeof e)return e.nodeType?(this.context=this[0]=e,this.length=1,this):Se.isFunction(e)?n.ready(e):(e.selector!==b&&(this.selector=e.selector,this.context=e.context),Se.makeArray(e,this));if(!(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&3<=e.length?[null,e,null]:T.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof Se?t[0]:t,Se.merge(this,Se.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:d,!0)),P.test(r[1])&&Se.isPlainObject(t))for(r in t)Se.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}if((o=d.getElementById(r[2]))&&o.parentNode){if(o.id!==r[2])return n.find(e);this.length=1,this[0]=o}return this.context=d,this.selector=e,this},selector:"",length:0,toArray:function(){return f.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=Se.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return Se.each(this,e,t)},ready:function(e){return Se.ready.promise().done(e),this},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},map:function(n){return this.pushStack(Se.map(this,function(e,t){return n.call(e,t,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:l,sort:[].sort,splice:[].splice},Se.fn.init.prototype=Se.fn,Se.extend=Se.fn.extend=function(){var e,t,n,r,o,i,s=arguments[0]||{},a=1,c=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},a=2),"object"==typeof s||Se.isFunction(s)||(s={}),c===a&&(s=this,--a);a<c;a++)if(null!=(o=arguments[a]))for(r in o)e=s[r],s!==(n=o[r])&&(u&&n&&(Se.isPlainObject(n)||(t=Se.isArray(n)))?(i=t?(t=!1,e&&Se.isArray(e)?e:[]):e&&Se.isPlainObject(e)?e:{},s[r]=Se.extend(u,i,n)):n!==b&&(s[r]=n));return s},Se.extend({expando:"jQuery"+(u+Math.random()).replace(/\D/g,""),noConflict:function(e){return h.$===Se&&(h.$=a),e&&h.jQuery===Se&&(h.jQuery=s),Se},isReady:!1,readyWait:1,holdReady:function(e){e?Se.readyWait++:Se.ready(!0)},ready:function(e){if(!0===e?!--Se.readyWait:!Se.isReady){if(!d.body)return setTimeout(Se.ready);(Se.isReady=!0)!==e&&0<--Se.readyWait||(o.resolveWith(d,[Se]),Se.fn.trigger&&Se(d).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===Se.type(e)},isArray:Array.isArray||function(e){return"array"===Se.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?c[v.call(e)]||"object":typeof e},isPlainObject:function(e){var t;if(!e||"object"!==Se.type(e)||e.nodeType||Se.isWindow(e))return!1;try{if(e.constructor&&!C.call(e,"constructor")&&!C.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(Se.support.ownLast)for(t in e)return C.call(e,t);for(t in e);return t===b||C.call(e,t)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||d;var r=P.exec(e),o=!n&&[];return r?[t.createElement(r[1])]:(r=Se.buildFragment([e],t,o),o&&Se(o).remove(),Se.merge([],r.childNodes))},parseJSON:function(e){return h.JSON&&h.JSON.parse?h.JSON.parse(e):null===e?e:"string"==typeof e&&(e=Se.trim(e))&&I.test(e.replace(L,"@").replace(_,"]").replace(N,""))?new Function("return "+e)():void Se.error("Invalid JSON: "+e)},parseXML:function(e){var t;if(!e||"string"!=typeof e)return null;try{h.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e))}catch(e){t=b}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length||Se.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(e){e&&Se.trim(e)&&(h.execScript||function(e){h.eval.call(h,e)})(e)},camelCase:function(e){return e.replace(x,"ms-").replace(D,t)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r=0,o=e.length,i=O(e);if(n){if(i)for(;r<o&&!1!==t.apply(e[r],n);r++);else for(r in e)if(!1===t.apply(e[r],n))break}else if(i)for(;r<o&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:S&&!S.call("\ufeff ")?function(e){return null==e?"":S.call(e)}:function(e){return null==e?"":(e+"").replace(A,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(O(Object(e))?Se.merge(n,"string"==typeof e?[e]:e):l.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g)return g.call(t,e,n);for(r=t.length,n=n?n<0?Math.max(0,r+n):n:0;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){var n=t.length,r=e.length,o=0;if("number"==typeof n)for(;o<n;o++)e[r++]=t[o];else for(;t[o]!==b;)e[r++]=t[o++];return e.length=r,e},grep:function(e,t,n){var r=[],o=0,i=e.length;for(n=!!n;o<i;o++)n!==!!t(e[o],o)&&r.push(e[o]);return r},map:function(e,t,n){var r,o=0,i=e.length,s=[];if(O(e))for(;o<i;o++)null!=(r=t(e[o],o,n))&&(s[s.length]=r);else for(o in e)null!=(r=t(e[o],o,n))&&(s[s.length]=r);return m.apply([],s)},guid:1,proxy:function(e,t){var n,r,o;return"string"==typeof t&&(o=e[t],t=e,e=o),Se.isFunction(e)?(n=f.call(arguments,2),(r=function(){return e.apply(t||this,n.concat(f.call(arguments)))}).guid=e.guid=e.guid||Se.guid++,r):b},access:function(e,t,n,r,o,i,s){var a=0,c=e.length,u=null==n;if("object"===Se.type(n))for(a in o=!0,n)Se.access(e,t,a,n[a],!0,i,s);else if(r!==b&&(o=!0,Se.isFunction(r)||(s=!0),u&&(t=s?(t.call(e,r),null):(u=t,function(e,t,n){return u.call(Se(e),n)})),t))for(;a<c;a++)t(e[a],n,s?r:r.call(e[a],a,t(e[a],n)));return o?e:u?t.call(e):c?t(e[0],n):i},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var o,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];for(i in o=n.apply(e,r||[]),t)e.style[i]=s[i];return o}}),Se.ready.promise=function(e){if(!o)if(o=Se.Deferred(),"complete"===d.readyState)setTimeout(Se.ready);else if(d.addEventListener)d.addEventListener("DOMContentLoaded",r,!1),h.addEventListener("load",r,!1);else{d.attachEvent("onreadystatechange",r),h.attachEvent("onload",r);var n=!1;try{n=null==h.frameElement&&d.documentElement}catch(e){}n&&n.doScroll&&!function t(){if(!Se.isReady){try{n.doScroll("left")}catch(e){return setTimeout(t,50)}R(),Se.ready()}}()}return o.promise(e)},Se.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()}),n=Se(d),function(n,o){var e,h,E,A,i,r,d,b,u,m,M,s,y,v,a,l,C,S="sizzle"+-new Date,T=n.document,P=0,p=0,c=oe(),f=oe(),g=oe(),I=!1,N=function(e,t){return e===t&&(I=!0),0},L=typeof o,_={}.hasOwnProperty,t=[],x=t.pop,D=t.push,R=t.push,O=t.slice,w=t.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]===e)return t;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",$="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",W=$.replace("w","w#"),U="\\["+B+"*("+$+")"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+W+")|)|)"+B+"*\\]",j=":("+$+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+U.replace(3,8)+")*)|.*)\\)|)",G=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),V=new RegExp("^"+B+"*,"+B+"*"),k=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),H=new RegExp(B+"*[+~]"),q=new RegExp("="+B+"*([^\\]'\"]*)"+B+"*\\]","g"),J=new RegExp(j),z=new RegExp("^"+W+"$"),Y={ID:new RegExp("^#("+$+")"),CLASS:new RegExp("^\\.("+$+")"),TAG:new RegExp("^("+$.replace("w","w*")+")"),ATTR:new RegExp("^"+U),PSEUDO:new RegExp("^"+j),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},X=/^[^{]+\{\s*\[native \w/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Q=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,ee=/'|\\/g,te=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),ne=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(65536+r):String.fromCharCode(r>>10|55296,1023&r|56320)};try{R.apply(t=O.call(T.childNodes),T.childNodes),t[T.childNodes.length].nodeType}catch(e){R={apply:t.length?function(e,t){D.apply(e,O.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function re(e,t,n,r){var o,i,s,a,c,u,l,p,f,g;if((t?t.ownerDocument||t:T)!==M&&m(t),n=n||[],!e||"string"!=typeof e)return n;if(1!==(a=(t=t||M).nodeType)&&9!==a)return[];if(y&&!r){if(o=K.exec(e))if(s=o[1]){if(9===a){if(!(i=t.getElementById(s))||!i.parentNode)return n;if(i.id===s)return n.push(i),n}else if(t.ownerDocument&&(i=t.ownerDocument.getElementById(s))&&C(t,i)&&i.id===s)return n.push(i),n}else{if(o[2])return R.apply(n,t.getElementsByTagName(e)),n;if((s=o[3])&&h.getElementsByClassName&&t.getElementsByClassName)return R.apply(n,t.getElementsByClassName(s)),n}if(h.qsa&&(!v||!v.test(e))){if(p=l=S,f=t,g=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(u=ge(e),(l=t.getAttribute("id"))?p=l.replace(ee,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",c=u.length;c--;)u[c]=p+he(u[c]);f=H.test(e)&&t.parentNode||t,g=u.join(",")}if(g)try{return R.apply(n,f.querySelectorAll(g)),n}catch(e){}finally{l||t.removeAttribute("id")}}}return function(e,t,n,r){var o,i,s,a,c,u=ge(e);if(!r&&1===u.length){if(2<(i=u[0]=u[0].slice(0)).length&&"ID"===(s=i[0]).type&&h.getById&&9===t.nodeType&&y&&A.relative[i[1].type]){if(!(t=(A.find.ID(s.matches[0].replace(te,ne),t)||[])[0]))return n;e=e.slice(i.shift().value.length)}for(o=Y.needsContext.test(e)?0:i.length;o--&&(s=i[o],!A.relative[a=s.type]);)if((c=A.find[a])&&(r=c(s.matches[0].replace(te,ne),H.test(i[0].type)&&t.parentNode||t))){if(i.splice(o,1),!(e=r.length&&he(i)))return R.apply(n,r),n;break}}return d(e,u)(r,t,!y,n,H.test(e)),n}(e.replace(G,"$1"),t,n,r)}function oe(){var r=[];return function e(t,n){return r.push(t+=" ")>A.cacheLength&&delete e[r.shift()],e[t]=n}}function ie(e){return e[S]=!0,e}function se(e){var t=M.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ae(e,t){for(var n=e.split("|"),r=e.length;r--;)A.attrHandle[n[r]]=t}function ce(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||1<<31)-(~e.sourceIndex||1<<31);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ue(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function le(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function pe(s){return ie(function(i){return i=+i,ie(function(e,t){for(var n,r=s([],e.length,i),o=r.length;o--;)e[n=r[o]]&&(e[n]=!(t[n]=e[n]))})})}for(e in r=re.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},h=re.support={},m=re.setDocument=function(e){var c=e?e.ownerDocument||e:T,t=c.defaultView;return c!==M&&9===c.nodeType&&c.documentElement?(s=(M=c).documentElement,y=!r(c),t&&t.attachEvent&&t!==t.top&&t.attachEvent("onbeforeunload",function(){m()}),h.attributes=se(function(e){return e.className="i",!e.getAttribute("className")}),h.getElementsByTagName=se(function(e){return e.appendChild(c.createComment("")),!e.getElementsByTagName("*").length}),h.getElementsByClassName=se(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),h.getById=se(function(e){return s.appendChild(e).id=S,!c.getElementsByName||!c.getElementsByName(S).length}),h.getById?(A.find.ID=function(e,t){if(typeof t.getElementById!=L&&y){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},A.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}}):(delete A.find.ID,A.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t=typeof e.getAttributeNode!=L&&e.getAttributeNode("id");return t&&t.value===n}}),A.find.TAG=h.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!=L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],o=0,i=t.getElementsByTagName(e);if("*"!==e)return i;for(;n=i[o++];)1===n.nodeType&&r.push(n);return r},A.find.CLASS=h.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!=L&&y)return t.getElementsByClassName(e)},a=[],v=[],(h.qsa=X.test(c.querySelectorAll))&&(se(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||v.push("\\["+B+"*(?:value|"+F+")"),e.querySelectorAll(":checked").length||v.push(":checked")}),se(function(e){var t=c.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&v.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(h.matchesSelector=X.test(l=s.webkitMatchesSelector||s.mozMatchesSelector||s.oMatchesSelector||s.msMatchesSelector))&&se(function(e){h.disconnectedMatch=l.call(e,"div"),l.call(e,"[s!='']:x"),a.push("!=",j)}),v=v.length&&new RegExp(v.join("|")),a=a.length&&new RegExp(a.join("|")),C=X.test(s.contains)||s.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},N=s.compareDocumentPosition?function(e,t){if(e===t)return I=!0,0;var n=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return n?1&n||!h.sortDetached&&t.compareDocumentPosition(e)===n?e===c||C(T,e)?-1:t===c||C(T,t)?1:u?w.call(u,e)-w.call(u,t):0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var n,r=0,o=e.parentNode,i=t.parentNode,s=[e],a=[t];if(e===t)return I=!0,0;if(!o||!i)return e===c?-1:t===c?1:o?-1:i?1:u?w.call(u,e)-w.call(u,t):0;if(o===i)return ce(e,t);for(n=e;n=n.parentNode;)s.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;s[r]===a[r];)r++;return r?ce(s[r],a[r]):s[r]===T?-1:a[r]===T?1:0},c):M},re.matches=function(e,t){return re(e,null,null,t)},re.matchesSelector=function(e,t){if((e.ownerDocument||e)!==M&&m(e),t=t.replace(q,"='$1']"),h.matchesSelector&&y&&(!a||!a.test(t))&&(!v||!v.test(t)))try{var n=l.call(e,t);if(n||h.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){}return 0<re(t,M,null,[e]).length},re.contains=function(e,t){return(e.ownerDocument||e)!==M&&m(e),C(e,t)},re.attr=function(e,t){(e.ownerDocument||e)!==M&&m(e);var n=A.attrHandle[t.toLowerCase()],r=n&&_.call(A.attrHandle,t.toLowerCase())?n(e,t,!y):o;return r===o?h.attributes||!y?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null:r},re.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},re.uniqueSort=function(e){var t,n=[],r=0,o=0;if(I=!h.detectDuplicates,u=!h.sortStable&&e.slice(0),e.sort(N),I){for(;t=e[o++];)t===e[o]&&(r=n.push(o));for(;r--;)e.splice(n[r],1)}return e},i=re.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r];r++)n+=i(t);return n},(A=re.selectors={cacheLength:50,createPseudo:ie,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||re.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&re.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return Y.CHILD.test(e[0])?null:(e[3]&&e[4]!==o?e[2]=e[4]:n&&J.test(n)&&(t=ge(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=c[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&c(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!=L&&e.getAttribute("class")||"")})},ATTR:function(n,r,o){return function(e){var t=re.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===o:"!="===r?t!==o:"^="===r?o&&0===t.indexOf(o):"*="===r?o&&-1<t.indexOf(o):"$="===r?o&&t.slice(-o.length)===o:"~="===r?-1<(" "+t+" ").indexOf(o):"|="===r&&(t===o||t.slice(0,o.length+1)===o+"-"))}},CHILD:function(g,e,t,h,d){var m="nth"!==g.slice(0,3),y="last"!==g.slice(-4),v="of-type"===e;return 1===h&&0===d?function(e){return!!e.parentNode}:function(e,t,n){var r,o,i,s,a,c,u=m!=y?"nextSibling":"previousSibling",l=e.parentNode,p=v&&e.nodeName.toLowerCase(),f=!n&&!v;if(l){if(m){for(;u;){for(i=e;i=i[u];)if(v?i.nodeName.toLowerCase()===p:1===i.nodeType)return!1;c=u="only"===g&&!c&&"nextSibling"}return!0}if(c=[y?l.firstChild:l.lastChild],y&&f){for(a=(r=(o=l[S]||(l[S]={}))[g]||[])[0]===P&&r[1],s=r[0]===P&&r[2],i=a&&l.childNodes[a];i=++a&&i&&i[u]||(s=a=0)||c.pop();)if(1===i.nodeType&&++s&&i===e){o[g]=[P,a,s];break}}else if(f&&(r=(e[S]||(e[S]={}))[g])&&r[0]===P)s=r[1];else for(;(i=++a&&i&&i[u]||(s=a=0)||c.pop())&&((v?i.nodeName.toLowerCase()!==p:1!==i.nodeType)||!++s||(f&&((i[S]||(i[S]={}))[g]=[P,s]),i!==e)););return(s-=d)===h||s%h==0&&0<=s/h}}},PSEUDO:function(e,i){var t,s=A.pseudos[e]||A.setFilters[e.toLowerCase()]||re.error("unsupported pseudo: "+e);return s[S]?s(i):1<s.length?(t=[e,e,"",i],A.setFilters.hasOwnProperty(e.toLowerCase())?ie(function(e,t){for(var n,r=s(e,i),o=r.length;o--;)e[n=w.call(e,r[o])]=!(t[n]=r[o])}):function(e){return s(e,0,t)}):s}},pseudos:{not:ie(function(e){var r=[],o=[],a=d(e.replace(G,"$1"));return a[S]?ie(function(e,t,n,r){for(var o,i=a(e,null,r,[]),s=e.length;s--;)(o=i[s])&&(e[s]=!(t[s]=o))}):function(e,t,n){return r[0]=e,a(r,null,n,o),!o.pop()}}),has:ie(function(t){return function(e){return 0<re(t,e).length}}),contains:ie(function(t){return function(e){return-1<(e.textContent||e.innerText||i(e)).indexOf(t)}}),lang:ie(function(n){return z.test(n||"")||re.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=y?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===s},focus:function(e){return e===M.activeElement&&(!M.hasFocus||M.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if("@"<e.nodeName||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!A.pseudos.empty(e)},header:function(e){return Z.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pe(function(){return[0]}),last:pe(function(e,t){return[t-1]}),eq:pe(function(e,t,n){return[n<0?n+t:n]}),even:pe(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:pe(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:pe(function(e,t,n){for(var r=n<0?n+t:n;0<=--r;)e.push(r);return e}),gt:pe(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=A.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})A.pseudos[e]=ue(e);for(e in{submit:!0,reset:!0})A.pseudos[e]=le(e);function fe(){}function ge(e,t){var n,r,o,i,s,a,c,u=f[e+" "];if(u)return t?0:u.slice(0);for(s=e,a=[],c=A.preFilter;s;){for(i in n&&!(r=V.exec(s))||(r&&(s=s.slice(r[0].length)||s),a.push(o=[])),n=!1,(r=k.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(G," ")}),s=s.slice(n.length)),A.filter)!(r=Y[i].exec(s))||c[i]&&!(r=c[i](r))||(n=r.shift(),o.push({value:n,type:i,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?re.error(e):f(e,a).slice(0)}function he(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function de(a,e,t){var c=e.dir,u=t&&"parentNode"===c,l=p++;return e.first?function(e,t,n){for(;e=e[c];)if(1===e.nodeType||u)return a(e,t,n)}:function(e,t,n){var r,o,i,s=P+" "+l;if(n){for(;e=e[c];)if((1===e.nodeType||u)&&a(e,t,n))return!0}else for(;e=e[c];)if(1===e.nodeType||u)if((o=(i=e[S]||(e[S]={}))[c])&&o[0]===s){if(!0===(r=o[1])||r===E)return!0===r}else if((o=i[c]=[s])[1]=a(e,t,n)||E,!0===o[1])return!0}}function me(o){return 1<o.length?function(e,t,n){for(var r=o.length;r--;)if(!o[r](e,t,n))return!1;return!0}:o[0]}function ye(e,t,n,r,o){for(var i,s=[],a=0,c=e.length,u=null!=t;a<c;a++)(i=e[a])&&(n&&!n(i,r,o)||(s.push(i),u&&t.push(a)));return s}function ve(g,h,d,m,y,e){return m&&!m[S]&&(m=ve(m)),y&&!y[S]&&(y=ve(y,e)),ie(function(e,t,n,r){var o,i,s,a=[],c=[],u=t.length,l=e||function(e,t,n){for(var r=0,o=t.length;r<o;r++)re(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),p=!g||!e&&h?l:ye(l,a,g,n,r),f=d?y||(e?g:u||m)?[]:t:p;if(d&&d(p,f,n,r),m)for(o=ye(f,c),m(o,[],n,r),i=o.length;i--;)(s=o[i])&&(f[c[i]]=!(p[c[i]]=s));if(e){if(y||g){if(y){for(o=[],i=f.length;i--;)(s=f[i])&&o.push(p[i]=s);y(null,f=[],o,r)}for(i=f.length;i--;)(s=f[i])&&-1<(o=y?w.call(e,s):a[i])&&(e[o]=!(t[o]=s))}}else f=ye(f===t?f.splice(u,f.length):f),y?y(null,t,f,r):R.apply(t,f)})}function Ce(e){for(var r,t,n,o=e.length,i=A.relative[e[0].type],s=i||A.relative[" "],a=i?1:0,c=de(function(e){return e===r},s,!0),u=de(function(e){return-1<w.call(r,e)},s,!0),l=[function(e,t,n){return!i&&(n||t!==b)||((r=t).nodeType?c(e,t,n):u(e,t,n))}];a<o;a++)if(t=A.relative[e[a].type])l=[de(me(l),t)];else{if((t=A.filter[e[a].type].apply(null,e[a].matches))[S]){for(n=++a;n<o&&!A.relative[e[n].type];n++);return ve(1<a&&me(l),1<a&&he(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(G,"$1"),t,a<n&&Ce(e.slice(a,n)),n<o&&Ce(e=e.slice(n)),n<o&&he(e))}l.push(t)}return me(l)}fe.prototype=A.filters=A.pseudos,A.setFilters=new fe,d=re.compile=function(e,t){var n,r=[],o=[],i=g[e+" "];if(!i){for(n=(t=t||ge(e)).length;n--;)(i=Ce(t[n]))[S]?r.push(i):o.push(i);i=g(e,function(m,y){function e(e,t,n,r,o){var i,s,a,c=[],u=0,l="0",p=e&&[],f=null!=o,g=b,h=e||S&&A.find.TAG("*",o&&t.parentNode||t),d=P+=null==g?1:Math.random()||.1;for(f&&(b=t!==M&&t,E=v);null!=(i=h[l]);l++){if(S&&i){for(s=0;a=m[s++];)if(a(i,t,n)){r.push(i);break}f&&(P=d,E=++v)}C&&((i=!a&&i)&&u--,e&&p.push(i))}if(u+=l,C&&l!==u){for(s=0;a=y[s++];)a(p,c,t,n);if(e){if(0<u)for(;l--;)p[l]||c[l]||(c[l]=x.call(r));c=ye(c)}R.apply(r,c),f&&!e&&0<c.length&&1<u+y.length&&re.uniqueSort(r)}return f&&(P=d,b=g),p}var v=0,C=0<y.length,S=0<m.length;return C?ie(e):e}(o,r))}return i},h.sortStable=S.split("").sort(N).join("")===S,h.detectDuplicates=I,m(),h.sortDetached=se(function(e){return 1&e.compareDocumentPosition(M.createElement("div"))}),se(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ae("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),h.attributes&&se(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ae("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),se(function(e){return null==e.getAttribute("disabled")})||ae(F,function(e,t,n){var r;if(!n)return(r=e.getAttributeNode(t))&&r.specified?r.value:!0===e[t]?t.toLowerCase():null}),Se.find=re,Se.expr=re.selectors,Se.expr[":"]=Se.expr.pseudos,Se.unique=re.uniqueSort,Se.text=re.getText,Se.isXMLDoc=re.isXML,Se.contains=re.contains}(h);var w={};Se.Callbacks=function(o){o="string"==typeof o?w[o]||function(e){var n=w[e]={};return Se.each(e.match(M)||[],function(e,t){n[t]=!0}),n}(o):Se.extend({},o);var r,t,n,i,s,a,c=[],u=!o.once&&[],l=function(e){for(t=o.memory&&e,n=!0,s=a||0,a=0,i=c.length,r=!0;c&&s<i;s++)if(!1===c[s].apply(e[0],e[1])&&o.stopOnFalse){t=!1;break}r=!1,c&&(u?u.length&&l(u.shift()):t?c=[]:p.disable())},p={add:function(){if(c){var e=c.length;!function r(e){Se.each(e,function(e,t){var n=Se.type(t);"function"===n?o.unique&&p.has(t)||c.push(t):t&&t.length&&"string"!==n&&r(t)})}(arguments),r?i=c.length:t&&(a=e,l(t))}return this},remove:function(){return c&&Se.each(arguments,function(e,t){for(var n;-1<(n=Se.inArray(t,c,n));)c.splice(n,1),r&&(n<=i&&i--,n<=s&&s--)}),this},has:function(e){return e?-1<Se.inArray(e,c):!(!c||!c.length)},empty:function(){return c=[],i=0,this},disable:function(){return c=u=t=b,this},disabled:function(){return!c},lock:function(){return u=b,t||p.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!c||n&&!u||(t=[e,(t=t||[]).slice?t.slice():t],r?u.push(t):l(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!n}};return p},Se.extend({Deferred:function(e){var s=[["resolve","done",Se.Callbacks("once memory"),"resolved"],["reject","fail",Se.Callbacks("once memory"),"rejected"],["notify","progress",Se.Callbacks("memory")]],o="pending",a={state:function(){return o},always:function(){return c.done(arguments).fail(arguments),this},then:function(){var i=arguments;return Se.Deferred(function(o){Se.each(s,function(e,t){var n=t[0],r=Se.isFunction(i[e])&&i[e];c[t[1]](function(){var e=r&&r.apply(this,arguments);e&&Se.isFunction(e.promise)?e.promise().done(o.resolve).fail(o.reject).progress(o.notify):o[n+"With"](this===a?o.promise():this,r?[e]:arguments)})}),i=null}).promise()},promise:function(e){return null!=e?Se.extend(e,a):a}},c={};return a.pipe=a.then,Se.each(s,function(e,t){var n=t[2],r=t[3];a[t[1]]=n.add,r&&n.add(function(){o=r},s[1^e][2].disable,s[2][2].lock),c[t[0]]=function(){return c[t[0]+"With"](this===c?a:this,arguments),this},c[t[0]+"With"]=n.fireWith}),a.promise(c),e&&e.call(c,c),c},when:function(e){function t(t,n,r){return function(e){n[t]=this,r[t]=1<arguments.length?f.call(arguments):e,r===o?u.notifyWith(n,r):--c||u.resolveWith(n,r)}}var o,n,r,i=0,s=f.call(arguments),a=s.length,c=1!==a||e&&Se.isFunction(e.promise)?a:0,u=1===c?e:Se.Deferred();if(1<a)for(o=new Array(a),n=new Array(a),r=new Array(a);i<a;i++)s[i]&&Se.isFunction(s[i].promise)?s[i].promise().done(t(i,r,s)).fail(u.reject).progress(t(i,n,o)):--c;return c||u.resolveWith(r,s),u.promise()}}),Se.support=function(i){var e,t,n,r,o,s,a,c,u,l=d.createElement("div");if(l.setAttribute("className","t"),l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=l.getElementsByTagName("*")||[],!(t=l.getElementsByTagName("a")[0])||!t.style||!e.length)return i;s=(r=d.createElement("select")).appendChild(d.createElement("option")),n=l.getElementsByTagName("input")[0],t.style.cssText="top:1px;float:left;opacity:.5",i.getSetAttribute="t"!==l.className,i.leadingWhitespace=3===l.firstChild.nodeType,i.tbody=!l.getElementsByTagName("tbody").length,i.htmlSerialize=!!l.getElementsByTagName("link").length,i.style=/top/.test(t.getAttribute("style")),i.hrefNormalized="/a"===t.getAttribute("href"),i.opacity=/^0.5/.test(t.style.opacity),i.cssFloat=!!t.style.cssFloat,i.checkOn=!!n.value,i.optSelected=s.selected,i.enctype=!!d.createElement("form").enctype,i.html5Clone="<:nav></:nav>"!==d.createElement("nav").cloneNode(!0).outerHTML,i.inlineBlockNeedsLayout=!1,i.shrinkWrapBlocks=!1,i.pixelPosition=!1,i.deleteExpando=!0,i.noCloneEvent=!0,i.reliableMarginRight=!0,i.boxSizingReliable=!0,n.checked=!0,i.noCloneChecked=n.cloneNode(!0).checked,r.disabled=!0,i.optDisabled=!s.disabled;try{delete l.test}catch(e){i.deleteExpando=!1}for(u in(n=d.createElement("input")).setAttribute("value",""),i.input=""===n.getAttribute("value"),n.value="t",n.setAttribute("type","radio"),i.radioValue="t"===n.value,n.setAttribute("checked","t"),n.setAttribute("name","t"),(o=d.createDocumentFragment()).appendChild(n),i.appendChecked=n.checked,i.checkClone=o.cloneNode(!0).cloneNode(!0).lastChild.checked,l.attachEvent&&(l.attachEvent("onclick",function(){i.noCloneEvent=!1}),l.cloneNode(!0).click()),{submit:!0,change:!0,focusin:!0})l.setAttribute(a="on"+u,"t"),i[u+"Bubbles"]=a in h||!1===l.attributes[a].expando;for(u in l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",i.clearCloneStyle="content-box"===l.style.backgroundClip,Se(i))break;return i.ownLast="0"!==u,Se(function(){var e,t,n,r="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",o=d.getElementsByTagName("body")[0];o&&((e=d.createElement("div")).style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",o.appendChild(e).appendChild(l),l.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(n=l.getElementsByTagName("td"))[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===n[0].offsetHeight,n[0].style.display="",n[1].style.display="none",i.reliableHiddenOffsets=c&&0===n[0].offsetHeight,l.innerHTML="",l.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",Se.swap(o,null!=o.style.zoom?{zoom:1}:{},function(){i.boxSizing=4===l.offsetWidth}),h.getComputedStyle&&(i.pixelPosition="1%"!==(h.getComputedStyle(l,null)||{}).top,i.boxSizingReliable="4px"===(h.getComputedStyle(l,null)||{width:"4px"}).width,(t=l.appendChild(d.createElement("div"))).style.cssText=l.style.cssText=r,t.style.marginRight=t.style.width="0",l.style.width="1px",i.reliableMarginRight=!parseFloat((h.getComputedStyle(t,null)||{}).marginRight)),typeof l.style.zoom!==y&&(l.innerHTML="",l.style.cssText=r+"width:1px;padding:1px;display:inline;zoom:1",i.inlineBlockNeedsLayout=3===l.offsetWidth,l.style.display="block",l.innerHTML="<div></div>",l.firstChild.style.width="5px",i.shrinkWrapBlocks=3!==l.offsetWidth,i.inlineBlockNeedsLayout&&(o.style.zoom=1)),o.removeChild(e),e=l=n=t=null)}),e=r=o=s=t=n=null,i}({});var F=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function $(e,t,n,r){if(Se.acceptData(e)){var o,i,s=Se.expando,a=e.nodeType,c=a?Se.cache:e,u=a?e[s]:e[s]&&s;if(u&&c[u]&&(r||c[u].data)||n!==b||"string"!=typeof t)return c[u=u||(a?e[s]=p.pop()||Se.guid++:s)]||(c[u]=a?{}:{toJSON:Se.noop}),"object"!=typeof t&&"function"!=typeof t||(r?c[u]=Se.extend(c[u],t):c[u].data=Se.extend(c[u].data,t)),i=c[u],r||(i.data||(i.data={}),i=i.data),n!==b&&(i[Se.camelCase(t)]=n),"string"==typeof t?null==(o=i[t])&&(o=i[Se.camelCase(t)]):o=i,o}}function W(e,t,n){if(Se.acceptData(e)){var r,o,i=e.nodeType,s=i?Se.cache:e,a=i?e[Se.expando]:Se.expando;if(s[a]){if(t&&(r=n?s[a]:s[a].data)){o=(t=Se.isArray(t)?t.concat(Se.map(t,Se.camelCase)):t in r?[t]:(t=Se.camelCase(t))in r?[t]:t.split(" ")).length;for(;o--;)delete r[t[o]];if(n?!j(r):!Se.isEmptyObject(r))return}(n||(delete s[a].data,j(s[a])))&&(i?Se.cleanData([e],!0):Se.support.deleteExpando||s!=s.window?delete s[a]:s[a]=null)}}}function U(e,t,n){if(n===b&&1===e.nodeType){var r="data-"+t.replace(B,"-$1").toLowerCase();if("string"==typeof(n=e.getAttribute(r))){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:F.test(n)?Se.parseJSON(n):n)}catch(e){}Se.data(e,t,n)}else n=b}return n}function j(e){var t;for(t in e)if(("data"!==t||!Se.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}Se.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return!!(e=e.nodeType?Se.cache[e[Se.expando]]:e[Se.expando])&&!j(e)},data:function(e,t,n){return $(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return $(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&Se.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}}),Se.fn.extend({data:function(e,t){var n,r,o=null,i=0,s=this[0];if(e!==b)return"object"==typeof e?this.each(function(){Se.data(this,e)}):1<arguments.length?this.each(function(){Se.data(this,e,t)}):s?U(s,e,Se.data(s,e)):null;if(this.length&&(o=Se.data(s),1===s.nodeType&&!Se._data(s,"parsedAttrs"))){for(n=s.attributes;i<n.length;i++)0===(r=n[i].name).indexOf("data-")&&U(s,r=Se.camelCase(r.slice(5)),o[r]);Se._data(s,"parsedAttrs",!0)}return o},removeData:function(e){return this.each(function(){Se.removeData(this,e)})}}),Se.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Se._data(e,t),n&&(!r||Se.isArray(n)?r=Se._data(e,t,Se.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=Se.queue(e,t),r=n.length,o=n.shift(),i=Se._queueHooks(e,t);"inprogress"===o&&(o=n.shift(),r--),o&&("fx"===t&&n.unshift("inprogress"),delete i.stop,o.call(e,function(){Se.dequeue(e,t)},i)),!r&&i&&i.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Se._data(e,n)||Se._data(e,n,{empty:Se.Callbacks("once memory").add(function(){Se._removeData(e,t+"queue"),Se._removeData(e,n)})})}}),Se.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?Se.queue(this[0],t):n===b?this:this.each(function(){var e=Se.queue(this,t,n);Se._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&Se.dequeue(this,t)})},dequeue:function(e){return this.each(function(){Se.dequeue(this,e)})},delay:function(r,e){return r=Se.fx&&Se.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=setTimeout(e,r);t.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function n(){--o||i.resolveWith(s,[s])}var r,o=1,i=Se.Deferred(),s=this,a=this.length;for("string"!=typeof e&&(t=e,e=b),e=e||"fx";a--;)(r=Se._data(s[a],e+"queueHooks"))&&r.empty&&(o++,r.empty.add(n));return n(),i.promise(t)}});var G,V,k=/[\t\r\n\f]/g,H=/\r/g,q=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,z=/^(?:checked|selected)$/i,Y=Se.support.getSetAttribute,X=Se.support.input;Se.fn.extend({attr:function(e,t){return Se.access(this,Se.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){Se.removeAttr(this,e)})},prop:function(e,t){return Se.access(this,Se.prop,e,t,1<arguments.length)},removeProp:function(e){return e=Se.propFix[e]||e,this.each(function(){try{this[e]=b,delete this[e]}catch(e){}})},addClass:function(t){var e,n,r,o,i,s=0,a=this.length,c="string"==typeof t&&t;if(Se.isFunction(t))return this.each(function(e){Se(this).addClass(t.call(this,e,this.className))});if(c)for(e=(t||"").match(M)||[];s<a;s++)if(r=1===(n=this[s]).nodeType&&(n.className?(" "+n.className+" ").replace(k," "):" ")){for(i=0;o=e[i++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");n.className=Se.trim(r)}return this},removeClass:function(t){var e,n,r,o,i,s=0,a=this.length,c=0===arguments.length||"string"==typeof t&&t;if(Se.isFunction(t))return this.each(function(e){Se(this).removeClass(t.call(this,e,this.className))});if(c)for(e=(t||"").match(M)||[];s<a;s++)if(r=1===(n=this[s]).nodeType&&(n.className?(" "+n.className+" ").replace(k," "):"")){for(i=0;o=e[i++];)for(;0<=r.indexOf(" "+o+" ");)r=r.replace(" "+o+" "," ");n.className=t?Se.trim(r):""}return this},toggleClass:function(o,t){var i=typeof o;return"boolean"==typeof t&&"string"==i?t?this.addClass(o):this.removeClass(o):Se.isFunction(o)?this.each(function(e){Se(this).toggleClass(o.call(this,e,this.className,t),t)}):this.each(function(){if("string"==i)for(var e,t=0,n=Se(this),r=o.match(M)||[];e=r[t++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else i!==y&&"boolean"!=i||(this.className&&Se._data(this,"__className__",this.className),this.className=this.className||!1===o?"":Se._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;n<r;n++)if(1===this[n].nodeType&&0<=(" "+this[n].className+" ").replace(k," ").indexOf(t))return!0;return!1},val:function(n){var e,r,o,t=this[0];return arguments.length?(o=Se.isFunction(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=o?n.call(this,e,Se(this).val()):n)?t="":"number"==typeof t?t+="":Se.isArray(t)&&(t=Se.map(t,function(e){return null==e?"":e+""})),(r=Se.valHooks[this.type]||Se.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&r.set(this,t,"value")!==b||(this.value=t))})):t?(r=Se.valHooks[t.type]||Se.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&(e=r.get(t,"value"))!==b?e:"string"==typeof(e=t.value)?e.replace(H,""):null==e?"":e:void 0}}),Se.extend({valHooks:{option:{get:function(e){var t=Se.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){for(var t,n,r=e.options,o=e.selectedIndex,i="select-one"===e.type||o<0,s=i?null:[],a=i?o+1:r.length,c=o<0?a:i?o:0;c<a;c++)if(((n=r[c]).selected||c===o)&&(Se.support.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!Se.nodeName(n.parentNode,"optgroup"))){if(t=Se(n).val(),i)return t;s.push(t)}return s},set:function(e,t){for(var n,r,o=e.options,i=Se.makeArray(t),s=o.length;s--;)((r=o[s]).selected=0<=Se.inArray(Se(r).val(),i))&&(n=!0);return n||(e.selectedIndex=-1),i}}},attr:function(e,t,n){var r,o,i=e.nodeType;if(e&&3!==i&&8!==i&&2!==i)return typeof e.getAttribute===y?Se.prop(e,t,n):(1===i&&Se.isXMLDoc(e)||(t=t.toLowerCase(),r=Se.attrHooks[t]||(Se.expr.match.bool.test(t)?V:G)),n===b?r&&"get"in r&&null!==(o=r.get(e,t))?o:null==(o=Se.find.attr(e,t))?b:o:null!==n?r&&"set"in r&&(o=r.set(e,n,t))!==b?o:(e.setAttribute(t,n+""),n):void Se.removeAttr(e,t))},removeAttr:function(e,t){var n,r,o=0,i=t&&t.match(M);if(i&&1===e.nodeType)for(;n=i[o++];)r=Se.propFix[n]||n,Se.expr.match.bool.test(n)?X&&Y||!z.test(n)?e[r]=!1:e[Se.camelCase("default-"+n)]=e[r]=!1:Se.attr(e,n,""),e.removeAttribute(Y?n:r)},attrHooks:{type:{set:function(e,t){if(!Se.support.radioValue&&"radio"===t&&Se.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{for:"htmlFor",class:"className"},prop:function(e,t,n){var r,o,i=e.nodeType;if(e&&3!==i&&8!==i&&2!==i)return(1!==i||!Se.isXMLDoc(e))&&(t=Se.propFix[t]||t,o=Se.propHooks[t]),n!==b?o&&"set"in o&&(r=o.set(e,n,t))!==b?r:e[t]=n:o&&"get"in o&&null!==(r=o.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=Se.find.attr(e,"tabindex");return t?parseInt(t,10):q.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:-1}}}}),V={set:function(e,t,n){return!1===t?Se.removeAttr(e,n):X&&Y||!z.test(n)?e.setAttribute(!Y&&Se.propFix[n]||n,n):e[Se.camelCase("default-"+n)]=e[n]=!0,n}},Se.each(Se.expr.match.bool.source.match(/\w+/g),function(e,t){var i=Se.expr.attrHandle[t]||Se.find.attr;Se.expr.attrHandle[t]=X&&Y||!z.test(t)?function(e,t,n){var r=Se.expr.attrHandle[t],o=n?b:(Se.expr.attrHandle[t]=b)!=i(e,t,n)?t.toLowerCase():null;return Se.expr.attrHandle[t]=r,o}:function(e,t,n){return n?b:e[Se.camelCase("default-"+t)]?t.toLowerCase():null}}),X&&Y||(Se.attrHooks.value={set:function(e,t,n){if(!Se.nodeName(e,"input"))return G&&G.set(e,t,n);e.defaultValue=t}}),Y||(G={set:function(e,t,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="","value"===n||t===e.getAttribute(n)?t:b}},Se.expr.attrHandle.id=Se.expr.attrHandle.name=Se.expr.attrHandle.coords=function(e,t,n){var r;return n?b:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},Se.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:b},set:G.set},Se.attrHooks.contenteditable={set:function(e,t,n){G.set(e,""!==t&&t,n)}},Se.each(["width","height"],function(e,n){Se.attrHooks[n]={set:function(e,t){if(""===t)return e.setAttribute(n,"auto"),t}}})),Se.support.hrefNormalized||Se.each(["href","src"],function(e,t){Se.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),Se.support.style||(Se.attrHooks.style={get:function(e){return e.style.cssText||b},set:function(e,t){return e.style.cssText=t+""}}),Se.support.optSelected||(Se.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),Se.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Se.propFix[this.toLowerCase()]=this}),Se.support.enctype||(Se.propFix.enctype="encoding"),Se.each(["radio","checkbox"],function(){Se.valHooks[this]={set:function(e,t){if(Se.isArray(t))return e.checked=0<=Se.inArray(Se(e).val(),t)}},Se.support.checkOn||(Se.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var K=/^(?:input|select|textarea)$/i,Q=/^key/,Z=/^(?:mouse|contextmenu)|click/,ee=/^(?:focusinfocus|focusoutblur)$/,te=/^([^.]*)(?:\.(.+)|)$/;function ne(){return!0}function re(){return!1}function oe(){try{return d.activeElement}catch(e){}}Se.event={global:{},add:function(e,t,n,r,o){var i,s,a,c,u,l,p,f,g,h,d,m=Se._data(e);if(m){for(n.handler&&(n=(c=n).handler,o=c.selector),n.guid||(n.guid=Se.guid++),(s=m.events)||(s=m.events={}),(l=m.handle)||((l=m.handle=function(e){return typeof Se===y||e&&Se.event.triggered===e.type?b:Se.event.dispatch.apply(l.elem,arguments)}).elem=e),a=(t=(t||"").match(M)||[""]).length;a--;)g=d=(i=te.exec(t[a])||[])[1],h=(i[2]||"").split(".").sort(),g&&(u=Se.event.special[g]||{},g=(o?u.delegateType:u.bindType)||g,u=Se.event.special[g]||{},p=Se.extend({type:g,origType:d,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&Se.expr.match.needsContext.test(o),namespace:h.join(".")},c),(f=s[g])||((f=s[g]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,r,h,l)||(e.addEventListener?e.addEventListener(g,l,!1):e.attachEvent&&e.attachEvent("on"+g,l))),u.add&&(u.add.call(e,p),p.handler.guid||(p.handler.guid=n.guid)),o?f.splice(f.delegateCount++,0,p):f.push(p),Se.event.global[g]=!0);e=null}},remove:function(e,t,n,r,o){var i,s,a,c,u,l,p,f,g,h,d,m=Se.hasData(e)&&Se._data(e);if(m&&(l=m.events)){for(u=(t=(t||"").match(M)||[""]).length;u--;)if(g=d=(a=te.exec(t[u])||[])[1],h=(a[2]||"").split(".").sort(),g){for(p=Se.event.special[g]||{},f=l[g=(r?p.delegateType:p.bindType)||g]||[],a=a[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),c=i=f.length;i--;)s=f[i],!o&&d!==s.origType||n&&n.guid!==s.guid||a&&!a.test(s.namespace)||r&&r!==s.selector&&("**"!==r||!s.selector)||(f.splice(i,1),s.selector&&f.delegateCount--,p.remove&&p.remove.call(e,s));c&&!f.length&&(p.teardown&&!1!==p.teardown.call(e,h,m.handle)||Se.removeEvent(e,g,m.handle),delete l[g])}else for(g in l)Se.event.remove(e,g+t[u],n,r,!0);Se.isEmptyObject(l)&&(delete m.handle,Se._removeData(e,"events"))}},trigger:function(e,t,n,r){var o,i,s,a,c,u,l,p=[n||d],f=C.call(e,"type")?e.type:e,g=C.call(e,"namespace")?e.namespace.split("."):[];if(s=u=n=n||d,3!==n.nodeType&&8!==n.nodeType&&!ee.test(f+Se.event.triggered)&&(0<=f.indexOf(".")&&(f=(g=f.split(".")).shift(),g.sort()),i=f.indexOf(":")<0&&"on"+f,(e=e[Se.expando]?e:new Se.Event(f,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=g.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=b,e.target||(e.target=n),t=null==t?[e]:Se.makeArray(t,[e]),c=Se.event.special[f]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!Se.isWindow(n)){for(a=c.delegateType||f,ee.test(a+f)||(s=s.parentNode);s;s=s.parentNode)p.push(s),u=s;u===(n.ownerDocument||d)&&p.push(u.defaultView||u.parentWindow||h)}for(l=0;(s=p[l++])&&!e.isPropagationStopped();)e.type=1<l?a:c.bindType||f,(o=(Se._data(s,"events")||{})[e.type]&&Se._data(s,"handle"))&&o.apply(s,t),(o=i&&s[i])&&Se.acceptData(s)&&o.apply&&!1===o.apply(s,t)&&e.preventDefault();if(e.type=f,!r&&!e.isDefaultPrevented()&&(!c._default||!1===c._default.apply(p.pop(),t))&&Se.acceptData(n)&&i&&n[f]&&!Se.isWindow(n)){(u=n[i])&&(n[i]=null),Se.event.triggered=f;try{n[f]()}catch(e){}Se.event.triggered=b,u&&(n[i]=u)}return e.result}},dispatch:function(e){e=Se.event.fix(e);var t,n,r,o,i,s,a=f.call(arguments),c=(Se._data(this,"events")||{})[e.type]||[],u=Se.event.special[e.type]||{};if((a[0]=e).delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,e)){for(s=Se.event.handlers.call(this,e,c),t=0;(o=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,i=0;(r=o.handlers[i++])&&!e.isImmediatePropagationStopped();)e.namespace_re&&!e.namespace_re.test(r.namespace)||(e.handleObj=r,e.data=r.data,(n=((Se.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,a))!==b&&!1===(e.result=n)&&(e.preventDefault(),e.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,o,i,s=[],a=t.delegateCount,c=e.target;if(a&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!=this;c=c.parentNode||this)if(1===c.nodeType&&(!0!==c.disabled||"click"!==e.type)){for(o=[],i=0;i<a;i++)o[n=(r=t[i]).selector+" "]===b&&(o[n]=r.needsContext?0<=Se(n,this).index(c):Se.find(n,this,null,[c]).length),o[n]&&o.push(r);o.length&&s.push({elem:c,handlers:o})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},fix:function(e){if(e[Se.expando])return e;var t,n,r,o=e.type,i=e,s=this.fixHooks[o];for(s||(this.fixHooks[o]=s=Z.test(o)?this.mouseHooks:Q.test(o)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new Se.Event(i),t=r.length;t--;)e[n=r[t]]=i[n];return e.target||(e.target=i.srcElement||d),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,i):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,o,i=t.button,s=t.fromElement;return null==e.pageX&&null!=t.clientX&&(o=(r=e.target.ownerDocument||d).documentElement,n=r.body,e.pageX=t.clientX+(o&&o.scrollLeft||n&&n.scrollLeft||0)-(o&&o.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(o&&o.scrollTop||n&&n.scrollTop||0)-(o&&o.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?t.toElement:s),e.which||i===b||(e.which=1&i?1:2&i?3:4&i?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==oe()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===oe()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(Se.nodeName(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1},_default:function(e){return Se.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==b&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var o=Se.extend(new Se.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?Se.event.trigger(o,null,t):Se.event.dispatch.call(t,o),o.isDefaultPrevented()&&n.preventDefault()}},Se.removeEvent=d.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===y&&(e[r]=null),e.detachEvent(r,n))},Se.Event=function(e,t){if(!(this instanceof Se.Event))return new Se.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.getPreventDefault&&e.getPreventDefault()?ne:re):this.type=e,t&&Se.extend(this,t),this.timeStamp=e&&e.timeStamp||Se.now(),this[Se.expando]=!0},Se.Event.prototype={isDefaultPrevented:re,isPropagationStopped:re,isImmediatePropagationStopped:re,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ne,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ne,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ne,this.stopPropagation()}},Se.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,o){Se.event.special[e]={delegateType:o,bindType:o,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||Se.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=o),t}}}),Se.support.submitBubbles||(Se.event.special.submit={setup:function(){if(Se.nodeName(this,"form"))return!1;Se.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=Se.nodeName(t,"input")||Se.nodeName(t,"button")?t.form:b;n&&!Se._data(n,"submitBubbles")&&(Se.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),Se._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&Se.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(Se.nodeName(this,"form"))return!1;Se.event.remove(this,"._submit")}}),Se.support.changeBubbles||(Se.event.special.change={setup:function(){if(K.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(Se.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),Se.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),Se.event.simulate("change",this,e,!0)})),!1;Se.event.add(this,"beforeactivate._change",function(e){var t=e.target;K.test(t.nodeName)&&!Se._data(t,"changeBubbles")&&(Se.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||Se.event.simulate("change",this.parentNode,e,!0)}),Se._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return Se.event.remove(this,"._change"),!K.test(this.nodeName)}}),Se.support.focusinBubbles||Se.each({focus:"focusin",blur:"focusout"},function(e,t){function n(e){Se.event.simulate(t,e.target,Se.event.fix(e),!0)}var r=0;Se.event.special[t]={setup:function(){0==r++&&d.addEventListener(e,n,!0)},teardown:function(){0==--r&&d.removeEventListener(e,n,!0)}}}),Se.fn.extend({on:function(e,t,n,r,o){var i,s;if("object"==typeof e){for(i in"string"!=typeof t&&(n=n||t,t=b),e)this.on(i,t,n,e[i],o);return this}if(null==n&&null==r?(r=t,n=t=b):null==r&&("string"==typeof t?(r=n,n=b):(r=n,n=t,t=b)),!1===r)r=re;else if(!r)return this;return 1===o&&(s=r,(r=function(e){return Se().off(e),s.apply(this,arguments)}).guid=s.guid||(s.guid=Se.guid++)),this.each(function(){Se.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,Se(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(n=t,t=b),!1===n&&(n=re),this.each(function(){Se.event.remove(this,e,n,t)});for(o in e)this.off(o,t,e[o]);return this},trigger:function(e,t){return this.each(function(){Se.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return Se.event.trigger(e,t,n,!0)}});var ie=/^.[^:#\[\.,]*$/,se=/^(?:parents|prev(?:Until|All))/,ae=Se.expr.match.needsContext,ce={children:!0,contents:!0,next:!0,prev:!0};function ue(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function le(e,n,r){if(Se.isFunction(n))return Se.grep(e,function(e,t){return!!n.call(e,t,e)!==r});if(n.nodeType)return Se.grep(e,function(e){return e===n!==r});if("string"==typeof n){if(ie.test(n))return Se.filter(n,e,r);n=Se.filter(n,e)}return Se.grep(e,function(e){return 0<=Se.inArray(e,n)!==r})}function pe(e){var t=fe.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}Se.fn.extend({find:function(e){var t,n=[],r=this,o=r.length;if("string"!=typeof e)return this.pushStack(Se(e).filter(function(){for(t=0;t<o;t++)if(Se.contains(r[t],this))return!0}));for(t=0;t<o;t++)Se.find(e,r[t],n);return(n=this.pushStack(1<o?Se.unique(n):n)).selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t,n=Se(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(Se.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(le(this,e||[],!0))},filter:function(e){return this.pushStack(le(this,e||[],!1))},is:function(e){return!!le(this,"string"==typeof e&&ae.test(e)?Se(e):e||[],!1).length},closest:function(e,t){for(var n,r=0,o=this.length,i=[],s=ae.test(e)||"string"!=typeof e?Se(e,t||this.context):0;r<o;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?-1<s.index(n):1===n.nodeType&&Se.find.matchesSelector(n,e))){n=i.push(n);break}return this.pushStack(1<i.length?Se.unique(i):i)},index:function(e){return e?"string"==typeof e?Se.inArray(this[0],Se(e)):Se.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?Se(e,t):Se.makeArray(e&&e.nodeType?[e]:e),r=Se.merge(this.get(),n);return this.pushStack(Se.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),Se.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return Se.dir(e,"parentNode")},parentsUntil:function(e,t,n){return Se.dir(e,"parentNode",n)},next:function(e){return ue(e,"nextSibling")},prev:function(e){return ue(e,"previousSibling")},nextAll:function(e){return Se.dir(e,"nextSibling")},prevAll:function(e){return Se.dir(e,"previousSibling")},nextUntil:function(e,t,n){return Se.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return Se.dir(e,"previousSibling",n)},siblings:function(e){return Se.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return Se.sibling(e.firstChild)},contents:function(e){return Se.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:Se.merge([],e.childNodes)}},function(r,o){Se.fn[r]=function(e,t){var n=Se.map(this,o,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=Se.filter(t,n)),1<this.length&&(ce[r]||(n=Se.unique(n)),se.test(r)&&(n=n.reverse())),this.pushStack(n)}}),Se.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?Se.find.matchesSelector(r,e)?[r]:[]:Se.find.matches(e,Se.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,t,n){for(var r=[],o=e[t];o&&9!==o.nodeType&&(n===b||1!==o.nodeType||!Se(o).is(n));)1===o.nodeType&&r.push(o),o=o[t];return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var fe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ge=/ jQuery\d+="(?:null|\d+)"/g,he=new RegExp("<(?:"+fe+")[\\s/>]","i"),de=/^\s+/,me=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ye=/<([\w:]+)/,ve=/<tbody/i,Ce=/<|&#?\w+;/,Ee=/<(?:script|style|link)/i,Ae=/^(?:checkbox|radio)$/i,be=/checked\s*(?:[^=]|=\s*.checked.)/i,Me=/^$|\/(?:java|ecma)script/i,Te=/^true\/(.*)/,Pe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ie={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:Se.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Ne=pe(d).appendChild(d.createElement("div"));function Le(e,t){return Se.nodeName(e,"table")&&Se.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function _e(e){return e.type=(null!==Se.find.attr(e,"type"))+"/"+e.type,e}function xe(e){var t=Te.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function De(e,t){for(var n,r=0;null!=(n=e[r]);r++)Se._data(n,"globalEval",!t||Se._data(t[r],"globalEval"))}function Re(e,t){if(1===t.nodeType&&Se.hasData(e)){var n,r,o,i=Se._data(e),s=Se._data(t,i),a=i.events;if(a)for(n in delete s.handle,s.events={},a)for(r=0,o=a[n].length;r<o;r++)Se.event.add(t,n,a[n][r]);s.data&&(s.data=Se.extend({},s.data))}}function Oe(e,t){var n,r,o;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!Se.support.noCloneEvent&&t[Se.expando]){for(r in(o=Se._data(t)).events)Se.removeEvent(t,r,o.handle);t.removeAttribute(Se.expando)}"script"===n&&t.text!==e.text?(_e(t).text=e.text,xe(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),Se.support.html5Clone&&e.innerHTML&&!Se.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Ae.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}}function we(e,t){var n,r,o=0,i=typeof e.getElementsByTagName!==y?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==y?e.querySelectorAll(t||"*"):b;if(!i)for(i=[],n=e.childNodes||e;null!=(r=n[o]);o++)!t||Se.nodeName(r,t)?i.push(r):Se.merge(i,we(r,t));return t===b||t&&Se.nodeName(e,t)?Se.merge([e],i):i}function Fe(e){Ae.test(e.type)&&(e.defaultChecked=e.checked)}Ie.optgroup=Ie.option,Ie.tbody=Ie.tfoot=Ie.colgroup=Ie.caption=Ie.thead,Ie.th=Ie.td,Se.fn.extend({text:function(e){return Se.access(this,function(e){return e===b?Se.text(this):this.empty().append((this[0]&&this[0].ownerDocument||d).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Le(this,e).appendChild(e)})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Le(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?Se.filter(e,this):this,o=0;null!=(n=r[o]);o++)t||1!==n.nodeType||Se.cleanData(we(n)),n.parentNode&&(t&&Se.contains(n.ownerDocument,n)&&De(we(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&Se.cleanData(we(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&Se.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return Se.clone(this,e,t)})},html:function(e){return Se.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===b)return 1===t.nodeType?t.innerHTML.replace(ge,""):b;if("string"==typeof e&&!Ee.test(e)&&(Se.support.htmlSerialize||!he.test(e))&&(Se.support.leadingWhitespace||!de.test(e))&&!Ie[(ye.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(me,"<$1></$2>");try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(Se.cleanData(we(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var r=Se.map(this,function(e){return[e.nextSibling,e.parentNode]}),o=0;return this.domManip(arguments,function(e){var t=r[o++],n=r[o++];n&&(t&&t.parentNode!==n&&(t=this.nextSibling),Se(this).remove(),n.insertBefore(e,t))},!0),o?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(n,r,o){n=m.apply([],n);var e,t,i,s,a,c,u=0,l=this.length,p=this,f=l-1,g=n[0],h=Se.isFunction(g);if(h||!(l<=1||"string"!=typeof g||Se.support.checkClone)&&be.test(g))return this.each(function(e){var t=p.eq(e);h&&(n[0]=g.call(this,e,t.html())),t.domManip(n,r,o)});if(l&&(e=(c=Se.buildFragment(n,this[0].ownerDocument,!1,!o&&this)).firstChild,1===c.childNodes.length&&(c=e),e)){for(i=(s=Se.map(we(c,"script"),_e)).length;u<l;u++)t=c,u!==f&&(t=Se.clone(t,!0,!0),i&&Se.merge(s,we(t,"script"))),r.call(this[u],t,u);if(i)for(a=s[s.length-1].ownerDocument,Se.map(s,xe),u=0;u<i;u++)t=s[u],Me.test(t.type||"")&&!Se._data(t,"globalEval")&&Se.contains(a,t)&&(t.src?Se._evalUrl(t.src):Se.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Pe,"")));c=e=null}return this}}),Se.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,s){Se.fn[e]=function(e){for(var t,n=0,r=[],o=Se(e),i=o.length-1;n<=i;n++)t=n===i?this:this.clone(!0),Se(o[n])[s](t),l.apply(r,t.get());return this.pushStack(r)}}),Se.extend({clone:function(e,t,n){var r,o,i,s,a,c=Se.contains(e.ownerDocument,e);if(Se.support.html5Clone||Se.isXMLDoc(e)||!he.test("<"+e.nodeName+">")?i=e.cloneNode(!0):(Ne.innerHTML=e.outerHTML,Ne.removeChild(i=Ne.firstChild)),!(Se.support.noCloneEvent&&Se.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||Se.isXMLDoc(e)))for(r=we(i),a=we(e),s=0;null!=(o=a[s]);++s)r[s]&&Oe(o,r[s]);if(t)if(n)for(a=a||we(e),r=r||we(i),s=0;null!=(o=a[s]);s++)Re(o,r[s]);else Re(e,i);return 0<(r=we(i,"script")).length&&De(r,!c&&we(e,"script")),r=a=o=null,i},buildFragment:function(e,t,n,r){for(var o,i,s,a,c,u,l,p=e.length,f=pe(t),g=[],h=0;h<p;h++)if((i=e[h])||0===i)if("object"===Se.type(i))Se.merge(g,i.nodeType?[i]:i);else if(Ce.test(i)){for(a=a||f.appendChild(t.createElement("div")),c=(ye.exec(i)||["",""])[1].toLowerCase(),l=Ie[c]||Ie._default,a.innerHTML=l[1]+i.replace(me,"<$1></$2>")+l[2],o=l[0];o--;)a=a.lastChild;if(!Se.support.leadingWhitespace&&de.test(i)&&g.push(t.createTextNode(de.exec(i)[0])),!Se.support.tbody)for(o=(i="table"!==c||ve.test(i)?"<table>"!==l[1]||ve.test(i)?0:a:a.firstChild)&&i.childNodes.length;o--;)Se.nodeName(u=i.childNodes[o],"tbody")&&!u.childNodes.length&&i.removeChild(u);for(Se.merge(g,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=f.lastChild}else g.push(t.createTextNode(i));for(a&&f.removeChild(a),Se.support.appendChecked||Se.grep(we(g,"input"),Fe),h=0;i=g[h++];)if((!r||-1===Se.inArray(i,r))&&(s=Se.contains(i.ownerDocument,i),a=we(f.appendChild(i),"script"),s&&De(a),n))for(o=0;i=a[o++];)Me.test(i.type||"")&&n.push(i);return a=null,f},cleanData:function(e,t){for(var n,r,o,i,s=0,a=Se.expando,c=Se.cache,u=Se.support.deleteExpando,l=Se.event.special;null!=(n=e[s]);s++)if((t||Se.acceptData(n))&&(i=(o=n[a])&&c[o])){if(i.events)for(r in i.events)l[r]?Se.event.remove(n,r):Se.removeEvent(n,r,i.handle);c[o]&&(delete c[o],u?delete n[a]:typeof n.removeAttribute!==y?n.removeAttribute(a):n[a]=null,p.push(o))}},_evalUrl:function(e){return Se.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})}}),Se.fn.extend({wrapAll:function(t){if(Se.isFunction(t))return this.each(function(e){Se(this).wrapAll(t.call(this,e))});if(this[0]){var e=Se(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(n){return Se.isFunction(n)?this.each(function(e){Se(this).wrapInner(n.call(this,e))}):this.each(function(){var e=Se(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=Se.isFunction(t);return this.each(function(e){Se(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(){return this.parent().each(function(){Se.nodeName(this,"body")||Se(this).replaceWith(this.childNodes)}).end()}});var Be,$e,We,Ue=/alpha\([^)]*\)/i,je=/opacity\s*=\s*([^)]*)/,Ge=/^(top|right|bottom|left)$/,Ve=/^(none|table(?!-c[ea]).+)/,ke=/^margin/,He=new RegExp("^("+E+")(.*)$","i"),qe=new RegExp("^("+E+")(?!px)[a-z%]+$","i"),Je=new RegExp("^([+-])=("+E+")","i"),ze={BODY:"block"},Ye={position:"absolute",visibility:"hidden",display:"block"},Xe={letterSpacing:0,fontWeight:400},Ke=["Top","Right","Bottom","Left"],Qe=["Webkit","O","Moz","ms"];function Ze(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,o=Qe.length;o--;)if((t=Qe[o]+n)in e)return t;return r}function et(e,t){return e=t||e,"none"===Se.css(e,"display")||!Se.contains(e.ownerDocument,e)}function tt(e,t){for(var n,r,o,i=[],s=0,a=e.length;s<a;s++)(r=e[s]).style&&(i[s]=Se._data(r,"olddisplay"),n=r.style.display,t?(i[s]||"none"!==n||(r.style.display=""),""===r.style.display&&et(r)&&(i[s]=Se._data(r,"olddisplay",it(r.nodeName)))):i[s]||(o=et(r),(n&&"none"!==n||!o)&&Se._data(r,"olddisplay",o?n:Se.css(r,"display"))));for(s=0;s<a;s++)(r=e[s]).style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?i[s]||"":"none"));return e}function nt(e,t,n){var r=He.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function rt(e,t,n,r,o){for(var i=n===(r?"border":"content")?4:"width"===t?1:0,s=0;i<4;i+=2)"margin"===n&&(s+=Se.css(e,n+Ke[i],!0,o)),r?("content"===n&&(s-=Se.css(e,"padding"+Ke[i],!0,o)),"margin"!==n&&(s-=Se.css(e,"border"+Ke[i]+"Width",!0,o))):(s+=Se.css(e,"padding"+Ke[i],!0,o),"padding"!==n&&(s+=Se.css(e,"border"+Ke[i]+"Width",!0,o)));return s}function ot(e,t,n){var r=!0,o="width"===t?e.offsetWidth:e.offsetHeight,i=$e(e),s=Se.support.boxSizing&&"border-box"===Se.css(e,"boxSizing",!1,i);if(o<=0||null==o){if(((o=We(e,t,i))<0||null==o)&&(o=e.style[t]),qe.test(o))return o;r=s&&(Se.support.boxSizingReliable||o===e.style[t]),o=parseFloat(o)||0}return o+rt(e,t,n||(s?"border":"content"),r,i)+"px"}function it(e){var t=d,n=ze[e];return n||("none"!==(n=st(e,t))&&n||((t=((Be=(Be||Se("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement))[0].contentWindow||Be[0].contentDocument).document).write("<!doctype html><html><body>"),t.close(),n=st(e,t),Be.detach()),ze[e]=n),n}function st(e,t){var n=Se(t.createElement(e)).appendTo(t.body),r=Se.css(n[0],"display");return n.remove(),r}Se.fn.extend({css:function(e,t){return Se.access(this,function(e,t,n){var r,o,i={},s=0;if(Se.isArray(t)){for(o=$e(e),r=t.length;s<r;s++)i[t[s]]=Se.css(e,t[s],!1,o);return i}return n!==b?Se.style(e,t,n):Se.css(e,t)},e,t,1<arguments.length)},show:function(){return tt(this,!0)},hide:function(){return tt(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){et(this)?Se(this).show():Se(this).hide()})}}),Se.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:Se.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,i,s,a=Se.camelCase(t),c=e.style;if(t=Se.cssProps[a]||(Se.cssProps[a]=Ze(c,a)),s=Se.cssHooks[t]||Se.cssHooks[a],n===b)return s&&"get"in s&&(o=s.get(e,!1,r))!==b?o:c[t];if(!("string"===(i=typeof n)&&(o=Je.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(Se.css(e,t)),i="number"),null==n||"number"===i&&isNaN(n)||("number"!==i||Se.cssNumber[a]||(n+="px"),Se.support.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),s&&"set"in s&&(n=s.set(e,n,r))===b)))try{c[t]=n}catch(e){}}},css:function(e,t,n,r){var o,i,s,a=Se.camelCase(t);return t=Se.cssProps[a]||(Se.cssProps[a]=Ze(e.style,a)),(s=Se.cssHooks[t]||Se.cssHooks[a])&&"get"in s&&(i=s.get(e,!0,n)),i===b&&(i=We(e,t,r)),"normal"===i&&t in Xe&&(i=Xe[t]),""===n||n?(o=parseFloat(i),!0===n||Se.isNumeric(o)?o||0:i):i}}),h.getComputedStyle?($e=function(e){return h.getComputedStyle(e,null)},We=function(e,t,n){var r,o,i,s=n||$e(e),a=s?s.getPropertyValue(t)||s[t]:b,c=e.style;return s&&(""!==a||Se.contains(e.ownerDocument,e)||(a=Se.style(e,t)),qe.test(a)&&ke.test(t)&&(r=c.width,o=c.minWidth,i=c.maxWidth,c.minWidth=c.maxWidth=c.width=a,a=s.width,c.width=r,c.minWidth=o,c.maxWidth=i)),a}):d.documentElement.currentStyle&&($e=function(e){return e.currentStyle},We=function(e,t,n){var r,o,i,s=n||$e(e),a=s?s[t]:b,c=e.style;return null==a&&c&&c[t]&&(a=c[t]),qe.test(a)&&!Ge.test(t)&&(r=c.left,(i=(o=e.runtimeStyle)&&o.left)&&(o.left=e.currentStyle.left),c.left="fontSize"===t?"1em":a,a=c.pixelLeft+"px",c.left=r,i&&(o.left=i)),""===a?"auto":a}),Se.each(["height","width"],function(e,o){Se.cssHooks[o]={get:function(e,t,n){if(t)return 0===e.offsetWidth&&Ve.test(Se.css(e,"display"))?Se.swap(e,Ye,function(){return ot(e,o,n)}):ot(e,o,n)},set:function(e,t,n){var r=n&&$e(e);return nt(0,t,n?rt(e,o,n,Se.support.boxSizing&&"border-box"===Se.css(e,"boxSizing",!1,r),r):0)}}}),Se.support.opacity||(Se.cssHooks.opacity={get:function(e,t){return je.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,o=Se.isNumeric(t)?"alpha(opacity="+100*t+")":"",i=r&&r.filter||n.filter||"";((n.zoom=1)<=t||""===t)&&""===Se.trim(i.replace(Ue,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=Ue.test(i)?i.replace(Ue,o):i+" "+o)}}),Se(function(){Se.support.reliableMarginRight||(Se.cssHooks.marginRight={get:function(e,t){if(t)return Se.swap(e,{display:"inline-block"},We,[e,"marginRight"])}}),!Se.support.pixelPosition&&Se.fn.position&&Se.each(["top","left"],function(e,n){Se.cssHooks[n]={get:function(e,t){if(t)return t=We(e,n),qe.test(t)?Se(e).position()[n]+"px":t}}})}),Se.expr&&Se.expr.filters&&(Se.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!Se.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||Se.css(e,"display"))},Se.expr.filters.visible=function(e){return!Se.expr.filters.hidden(e)}),Se.each({margin:"",padding:"",border:"Width"},function(o,i){Se.cssHooks[o+i]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[o+Ke[t]+i]=r[t]||r[t-2]||r[0];return n}},ke.test(o)||(Se.cssHooks[o+i].set=nt)});var at=/%20/g,ct=/\[\]$/,ut=/\r?\n/g,lt=/^(?:submit|button|image|reset|file)$/i,pt=/^(?:input|select|textarea|keygen)/i;function ft(n,e,r,o){var t;if(Se.isArray(e))Se.each(e,function(e,t){r||ct.test(n)?o(n,t):ft(n+"["+("object"==typeof t?e:"")+"]",t,r,o)});else if(r||"object"!==Se.type(e))o(n,e);else for(t in e)ft(n+"["+t+"]",e[t],r,o)}Se.fn.extend({serialize:function(){return Se.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=Se.prop(this,"elements");return e?Se.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!Se(this).is(":disabled")&&pt.test(this.nodeName)&&!lt.test(e)&&(this.checked||!Ae.test(e))}).map(function(e,t){var n=Se(this).val();return null==n?null:Se.isArray(n)?Se.map(n,function(e){return{name:t.name,value:e.replace(ut,"\r\n")}}):{name:t.name,value:n.replace(ut,"\r\n")}}).get()}}),Se.param=function(e,t){function n(e,t){t=Se.isFunction(t)?t():null==t?"":t,o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)}var r,o=[];if(t===b&&(t=Se.ajaxSettings&&Se.ajaxSettings.traditional),Se.isArray(e)||e.jquery&&!Se.isPlainObject(e))Se.each(e,function(){n(this.name,this.value)});else for(r in e)ft(r,e[r],t,n);return o.join("&").replace(at,"+")},Se.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,n){Se.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}}),Se.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var gt,ht,dt=Se.now(),mt=/\?/,yt=/#.*$/,vt=/([?&])_=[^&]*/,Ct=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,St=/^(?:GET|HEAD)$/,Et=/^\/\//,At=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,bt=Se.fn.load,Mt={},Tt={},Pt="*/".concat("*");try{ht=e.href}catch(e){(ht=d.createElement("a")).href="",ht=ht.href}function It(i){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,o=e.toLowerCase().match(M)||[];if(Se.isFunction(t))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(i[n]=i[n]||[]).unshift(t)):(i[n]=i[n]||[]).push(t)}}function Nt(t,o,i,s){var a={},c=t===Tt;function u(e){var r;return a[e]=!0,Se.each(t[e]||[],function(e,t){var n=t(o,i,s);return"string"!=typeof n||c||a[n]?c?!(r=n):void 0:(o.dataTypes.unshift(n),u(n),!1)}),r}return u(o.dataTypes[0])||!a["*"]&&u("*")}function Lt(e,t){var n,r,o=Se.ajaxSettings.flatOptions||{};for(r in t)t[r]!==b&&((o[r]?e:n=n||{})[r]=t[r]);return n&&Se.extend(!0,e,n),e}gt=At.exec(ht.toLowerCase())||[],Se.fn.load=function(e,t,n){if("string"!=typeof e&&bt)return bt.apply(this,arguments);var r,o,i,s=this,a=e.indexOf(" ");return 0<=a&&(r=e.slice(a,e.length),e=e.slice(0,a)),Se.isFunction(t)?(n=t,t=b):t&&"object"==typeof t&&(i="POST"),0<s.length&&Se.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){o=arguments,s.html(r?Se("<div>").append(Se.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){s.each(n,o||[e.responseText,t,e])}),this},Se.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){Se.fn[t]=function(e){return this.on(t,e)}}),Se.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ht,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(gt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Pt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Se.parseJSON,"text xml":Se.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Lt(Lt(e,Se.ajaxSettings),t):Lt(Se.ajaxSettings,e)},ajaxPrefilter:It(Mt),ajaxTransport:It(Tt),ajax:function(e,t){"object"==typeof e&&(t=e,e=b),t=t||{};var n,r,l,p,f,g,h,o,d=Se.ajaxSetup({},t),m=d.context||d,y=d.context&&(m.nodeType||m.jquery)?Se(m):Se.event,v=Se.Deferred(),C=Se.Callbacks("once memory"),S=d.statusCode||{},i={},s={},E=0,a="canceled",A={readyState:0,getResponseHeader:function(e){var t;if(2===E){if(!o)for(o={};t=Ct.exec(p);)o[t[1].toLowerCase()]=t[2];t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===E?p:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return E||(e=s[n]=s[n]||e,i[e]=t),this},overrideMimeType:function(e){return E||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(E<2)for(t in e)S[t]=[S[t],e[t]];else A.always(e[A.status]);return this},abort:function(e){var t=e||a;return h&&h.abort(t),c(0,t),this}};if(v.promise(A).complete=C.add,A.success=A.done,A.error=A.fail,d.url=((e||d.url||ht)+"").replace(yt,"").replace(Et,gt[1]+"//"),d.type=t.method||t.type||d.method||d.type,d.dataTypes=Se.trim(d.dataType||"*").toLowerCase().match(M)||[""],null==d.crossDomain&&(n=At.exec(d.url.toLowerCase()),d.crossDomain=!(!n||n[1]===gt[1]&&n[2]===gt[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(gt[3]||("http:"===gt[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=Se.param(d.data,d.traditional)),Nt(Mt,d,t,A),2===E)return A;for(r in(g=d.global)&&0==Se.active++&&Se.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!St.test(d.type),l=d.url,d.hasContent||(d.data&&(l=d.url+=(mt.test(l)?"&":"?")+d.data,delete d.data),!1===d.cache&&(d.url=vt.test(l)?l.replace(vt,"$1_="+dt++):l+(mt.test(l)?"&":"?")+"_="+dt++)),d.ifModified&&(Se.lastModified[l]&&A.setRequestHeader("If-Modified-Since",Se.lastModified[l]),Se.etag[l]&&A.setRequestHeader("If-None-Match",Se.etag[l])),(d.data&&d.hasContent&&!1!==d.contentType||t.contentType)&&A.setRequestHeader("Content-Type",d.contentType),A.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Pt+"; q=0.01":""):d.accepts["*"]),d.headers)A.setRequestHeader(r,d.headers[r]);if(d.beforeSend&&(!1===d.beforeSend.call(m,A,d)||2===E))return A.abort();for(r in a="abort",{success:1,error:1,complete:1})A[r](d[r]);if(h=Nt(Tt,d,t,A)){A.readyState=1,g&&y.trigger("ajaxSend",[A,d]),d.async&&0<d.timeout&&(f=setTimeout(function(){A.abort("timeout")},d.timeout));try{E=1,h.send(i,c)}catch(e){if(!(E<2))throw e;c(-1,e)}}else c(-1,"No Transport");function c(e,t,n,r){var o,i,s,a,c,u=t;2!==E&&(E=2,f&&clearTimeout(f),h=b,p=r||"",A.readyState=0<e?4:0,o=200<=e&&e<300||304===e,n&&(a=function(e,t,n){var r,o,i,s,a=e.contents,c=e.dataTypes;for(;"*"===c[0];)c.shift(),o===b&&(o=e.mimeType||t.getResponseHeader("Content-Type"));if(o)for(s in a)if(a[s]&&a[s].test(o)){c.unshift(s);break}if(c[0]in n)i=c[0];else{for(s in n){if(!c[0]||e.converters[s+" "+c[0]]){i=s;break}r=r||s}i=i||r}if(i)return i!==c[0]&&c.unshift(i),n[i]}(d,A,n)),a=function(e,t,n,r){var o,i,s,a,c,u={},l=e.dataTypes.slice();if(l[1])for(s in e.converters)u[s.toLowerCase()]=e.converters[s];i=l.shift();for(;i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=i,i=l.shift())if("*"===i)i=c;else if("*"!==c&&c!==i){if(!(s=u[c+" "+i]||u["* "+i]))for(o in u)if((a=o.split(" "))[1]===i&&(s=u[c+" "+a[0]]||u["* "+a[0]])){!0===s?s=u[o]:!0!==u[o]&&(i=a[0],l.unshift(a[1]));break}if(!0!==s)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+c+" to "+i}}}return{state:"success",data:t}}(d,a,A,o),o?(d.ifModified&&((c=A.getResponseHeader("Last-Modified"))&&(Se.lastModified[l]=c),(c=A.getResponseHeader("etag"))&&(Se.etag[l]=c)),204===e||"HEAD"===d.type?u="nocontent":304===e?u="notmodified":(u=a.state,i=a.data,o=!(s=a.error))):(s=u,!e&&u||(u="error",e<0&&(e=0))),A.status=e,A.statusText=(t||u)+"",o?v.resolveWith(m,[i,u,A]):v.rejectWith(m,[A,u,s]),A.statusCode(S),S=b,g&&y.trigger(o?"ajaxSuccess":"ajaxError",[A,d,o?i:s]),C.fireWith(m,[A,u]),g&&(y.trigger("ajaxComplete",[A,d]),--Se.active||Se.event.trigger("ajaxStop")))}return A},getJSON:function(e,t,n){return Se.get(e,t,n,"json")},getScript:function(e,t){return Se.get(e,b,t,"script")}}),Se.each(["get","post"],function(e,o){Se[o]=function(e,t,n,r){return Se.isFunction(t)&&(r=r||n,n=t,t=b),Se.ajax({url:e,type:o,dataType:r,data:t,success:n})}}),Se.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return Se.globalEval(e),e}}}),Se.ajaxPrefilter("script",function(e){e.cache===b&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),Se.ajaxTransport("script",function(t){if(t.crossDomain){var r,o=d.head||Se("head")[0]||d.documentElement;return{send:function(e,n){(r=d.createElement("script")).async=!0,t.scriptCharset&&(r.charset=t.scriptCharset),r.src=t.url,r.onload=r.onreadystatechange=function(e,t){!t&&r.readyState&&!/loaded|complete/.test(r.readyState)||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),r=null,t||n(200,"success"))},o.insertBefore(r,o.firstChild)},abort:function(){r&&r.onload(b,!0)}}}});var _t=[],xt=/(=)\?(?=&|$)|\?\?/;Se.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=_t.pop()||Se.expando+"_"+dt++;return this[e]=!0,e}}),Se.ajaxPrefilter("json jsonp",function(e,t,n){var r,o,i,s=!1!==e.jsonp&&(xt.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&xt.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=Se.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(xt,"$1"+r):!1!==e.jsonp&&(e.url+=(mt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return i||Se.error(r+" was not called"),i[0]},e.dataTypes[0]="json",o=h[r],h[r]=function(){i=arguments},n.always(function(){h[r]=o,e[r]&&(e.jsonpCallback=t.jsonpCallback,_t.push(r)),i&&Se.isFunction(o)&&o(i[0]),i=o=b}),"script"});var Dt,Rt,Ot=0,wt=h.ActiveXObject&&function(){var e;for(e in Dt)Dt[e](b,!0)};function Ft(){try{return new h.XMLHttpRequest}catch(e){}}Se.ajaxSettings.xhr=h.ActiveXObject?function(){return!this.isLocal&&Ft()||function(){try{return new h.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:Ft,Rt=Se.ajaxSettings.xhr(),Se.support.cors=!!Rt&&"withCredentials"in Rt,(Rt=Se.support.ajax=!!Rt)&&Se.ajaxTransport(function(u){var l;if(!u.crossDomain||Se.support.cors)return{send:function(e,s){var a,t,c=u.xhr();if(u.username?c.open(u.type,u.url,u.async,u.username,u.password):c.open(u.type,u.url,u.async),u.xhrFields)for(t in u.xhrFields)c[t]=u.xhrFields[t];u.mimeType&&c.overrideMimeType&&c.overrideMimeType(u.mimeType),u.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(t in e)c.setRequestHeader(t,e[t])}catch(e){}c.send(u.hasContent&&u.data||null),l=function(e,t){var n,r,o,i;try{if(l&&(t||4===c.readyState))if(l=b,a&&(c.onreadystatechange=Se.noop,wt&&delete Dt[a]),t)4!==c.readyState&&c.abort();else{i={},n=c.status,r=c.getAllResponseHeaders(),"string"==typeof c.responseText&&(i.text=c.responseText);try{o=c.statusText}catch(e){o=""}n||!u.isLocal||u.crossDomain?1223===n&&(n=204):n=i.text?200:404}}catch(e){t||s(-1,e)}i&&s(n,o,i,r)},u.async?4===c.readyState?setTimeout(l):(a=++Ot,wt&&(Dt||(Dt={},Se(h).unload(wt)),Dt[a]=l),c.onreadystatechange=l):l()},abort:function(){l&&l(b,!0)}}});var Bt,$t,Wt=/^(?:toggle|show|hide)$/,Ut=new RegExp("^(?:([+-])=|)("+E+")([a-z%]*)$","i"),jt=/queueHooks$/,Gt=[function(t,e,n){var r,o,i,s,a,c,u=this,l={},p=t.style,f=t.nodeType&&et(t),g=Se._data(t,"fxshow");n.queue||(null==(a=Se._queueHooks(t,"fx")).unqueued&&(a.unqueued=0,c=a.empty.fire,a.empty.fire=function(){a.unqueued||c()}),a.unqueued++,u.always(function(){u.always(function(){a.unqueued--,Se.queue(t,"fx").length||a.empty.fire()})}));1===t.nodeType&&("height"in e||"width"in e)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===Se.css(t,"display")&&"none"===Se.css(t,"float")&&(Se.support.inlineBlockNeedsLayout&&"inline"!==it(t.nodeName)?p.zoom=1:p.display="inline-block"));n.overflow&&(p.overflow="hidden",Se.support.shrinkWrapBlocks||u.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in e)if(o=e[r],Wt.exec(o)){if(delete e[r],i=i||"toggle"===o,o===(f?"hide":"show"))continue;l[r]=g&&g[r]||Se.style(t,r)}if(!Se.isEmptyObject(l))for(r in g?"hidden"in g&&(f=g.hidden):g=Se._data(t,"fxshow",{}),i&&(g.hidden=!f),f?Se(t).show():u.done(function(){Se(t).hide()}),u.done(function(){var e;for(e in Se._removeData(t,"fxshow"),l)Se.style(t,e,l[e])}),l)s=Ht(f?g[r]:0,r,u),r in g||(g[r]=s.start,f&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}],Vt={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),o=Ut.exec(t),i=o&&o[3]||(Se.cssNumber[e]?"":"px"),s=(Se.cssNumber[e]||"px"!==i&&+r)&&Ut.exec(Se.css(n.elem,e)),a=1,c=20;if(s&&s[3]!==i)for(i=i||s[3],o=o||[],s=+r||1;s/=a=a||".5",Se.style(n.elem,e,s+i),a!==(a=n.cur()/r)&&1!==a&&--c;);return o&&(s=n.start=+s||+r||0,n.unit=i,n.end=o[1]?s+(o[1]+1)*o[2]:+o[2]),n}]};function kt(){return setTimeout(function(){Bt=b}),Bt=Se.now()}function Ht(e,t,n){for(var r,o=(Vt[t]||[]).concat(Vt["*"]),i=0,s=o.length;i<s;i++)if(r=o[i].call(n,t,e))return r}function qt(i,e,t){var n,s,r=0,o=Gt.length,a=Se.Deferred().always(function(){delete c.elem}),c=function(){if(s)return!1;for(var e=Bt||kt(),t=Math.max(0,u.startTime+u.duration-e),n=1-(t/u.duration||0),r=0,o=u.tweens.length;r<o;r++)u.tweens[r].run(n);return a.notifyWith(i,[u,n,t]),n<1&&o?t:(a.resolveWith(i,[u]),!1)},u=a.promise({elem:i,props:Se.extend({},e),opts:Se.extend(!0,{specialEasing:{}},t),originalProperties:e,originalOptions:t,startTime:Bt||kt(),duration:t.duration,tweens:[],createTween:function(e,t){var n=Se.Tween(i,u.opts,e,t,u.opts.specialEasing[e]||u.opts.easing);return u.tweens.push(n),n},stop:function(e){var t=0,n=e?u.tweens.length:0;if(s)return this;for(s=!0;t<n;t++)u.tweens[t].run(1);return e?a.resolveWith(i,[u,e]):a.rejectWith(i,[u,e]),this}}),l=u.props;for(!function(e,t){var n,r,o,i,s;for(n in e)if(r=Se.camelCase(n),o=t[r],i=e[n],Se.isArray(i)&&(o=i[1],i=e[n]=i[0]),n!==r&&(e[r]=i,delete e[n]),(s=Se.cssHooks[r])&&"expand"in s)for(n in i=s.expand(i),delete e[r],i)n in e||(e[n]=i[n],t[n]=o);else t[r]=o}(l,u.opts.specialEasing);r<o;r++)if(n=Gt[r].call(u,i,l,u.opts))return n;return Se.map(l,Ht,u),Se.isFunction(u.opts.start)&&u.opts.start.call(i,u),Se.fx.timer(Se.extend(c,{elem:i,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function Jt(e,t,n,r,o){return new Jt.prototype.init(e,t,n,r,o)}function zt(e,t){var n,r={height:e},o=0;for(t=t?1:0;o<4;o+=2-t)r["margin"+(n=Ke[o])]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function Yt(e){return Se.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}Se.Animation=Se.extend(qt,{tweener:function(e,t){for(var n,r=0,o=(e=Se.isFunction(e)?(t=e,["*"]):e.split(" ")).length;r<o;r++)n=e[r],Vt[n]=Vt[n]||[],Vt[n].unshift(t)},prefilter:function(e,t){t?Gt.unshift(e):Gt.push(e)}}),((Se.Tween=Jt).prototype={constructor:Jt,init:function(e,t,n,r,o,i){this.elem=e,this.prop=n,this.easing=o||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=i||(Se.cssNumber[n]?"":"px")},cur:function(){var e=Jt.propHooks[this.prop];return e&&e.get?e.get(this):Jt.propHooks._default.get(this)},run:function(e){var t,n=Jt.propHooks[this.prop];return this.options.duration?this.pos=t=Se.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Jt.propHooks._default.set(this),this}}).init.prototype=Jt.prototype,(Jt.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=Se.css(e.elem,e.prop,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){Se.fx.step[e.prop]?Se.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[Se.cssProps[e.prop]]||Se.cssHooks[e.prop])?Se.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}}).scrollTop=Jt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},Se.each(["toggle","show","hide"],function(e,r){var o=Se.fn[r];Se.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?o.apply(this,arguments):this.animate(zt(r,!0),e,t,n)}}),Se.fn.extend({fadeTo:function(e,t,n,r){return this.filter(et).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){function o(){var e=qt(this,Se.extend({},t),s);(i||Se._data(this,"finish"))&&e.stop(!0)}var i=Se.isEmptyObject(t),s=Se.speed(e,n,r);return o.finish=o,i||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(o,e,i){function s(e){var t=e.stop;delete e.stop,t(i)}return"string"!=typeof o&&(i=e,e=o,o=b),e&&!1!==o&&this.queue(o||"fx",[]),this.each(function(){var e=!0,t=null!=o&&o+"queueHooks",n=Se.timers,r=Se._data(this);if(t)r[t]&&r[t].stop&&s(r[t]);else for(t in r)r[t]&&r[t].stop&&jt.test(t)&&s(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=o&&n[t].queue!==o||(n[t].anim.stop(i),e=!1,n.splice(t,1));!e&&i||Se.dequeue(this,o)})},finish:function(s){return!1!==s&&(s=s||"fx"),this.each(function(){var e,t=Se._data(this),n=t[s+"queue"],r=t[s+"queueHooks"],o=Se.timers,i=n?n.length:0;for(t.finish=!0,Se.queue(this,s,[]),r&&r.stop&&r.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===s&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;e<i;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),Se.each({slideDown:zt("show"),slideUp:zt("hide"),slideToggle:zt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){Se.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),Se.speed=function(e,t,n){var r=e&&"object"==typeof e?Se.extend({},e):{complete:n||!n&&t||Se.isFunction(e)&&e,duration:e,easing:n&&t||t&&!Se.isFunction(t)&&t};return r.duration=Se.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in Se.fx.speeds?Se.fx.speeds[r.duration]:Se.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){Se.isFunction(r.old)&&r.old.call(this),r.queue&&Se.dequeue(this,r.queue)},r},Se.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},Se.timers=[],Se.fx=Jt.prototype.init,Se.fx.tick=function(){var e,t=Se.timers,n=0;for(Bt=Se.now();n<t.length;n++)(e=t[n])()||t[n]!==e||t.splice(n--,1);t.length||Se.fx.stop(),Bt=b},Se.fx.timer=function(e){e()&&Se.timers.push(e)&&Se.fx.start()},Se.fx.interval=13,Se.fx.start=function(){$t=$t||setInterval(Se.fx.tick,Se.fx.interval)},Se.fx.stop=function(){clearInterval($t),$t=null},Se.fx.speeds={slow:600,fast:200,_default:400},Se.fx.step={},Se.expr&&Se.expr.filters&&(Se.expr.filters.animated=function(t){return Se.grep(Se.timers,function(e){return t===e.elem}).length}),Se.fn.offset=function(t){if(arguments.length)return t===b?this:this.each(function(e){Se.offset.setOffset(this,t,e)});var e,n,r={top:0,left:0},o=this[0],i=o&&o.ownerDocument;return i?(e=i.documentElement,Se.contains(e,o)?(typeof o.getBoundingClientRect!==y&&(r=o.getBoundingClientRect()),n=Yt(i),{top:r.top+(n.pageYOffset||e.scrollTop)-(e.clientTop||0),left:r.left+(n.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}):r):void 0},Se.offset={setOffset:function(e,t,n){var r=Se.css(e,"position");"static"===r&&(e.style.position="relative");var o,i,s=Se(e),a=s.offset(),c=Se.css(e,"top"),u=Se.css(e,"left"),l={},p={};i=("absolute"===r||"fixed"===r)&&-1<Se.inArray("auto",[c,u])?(o=(p=s.position()).top,p.left):(o=parseFloat(c)||0,parseFloat(u)||0),Se.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(l.top=t.top-a.top+o),null!=t.left&&(l.left=t.left-a.left+i),"using"in t?t.using.call(e,l):s.css(l)}},Se.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===Se.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),Se.nodeName(e[0],"html")||(n=e.offset()),n.top+=Se.css(e[0],"borderTopWidth",!0),n.left+=Se.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-Se.css(r,"marginTop",!0),left:t.left-n.left-Se.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||i;e&&!Se.nodeName(e,"html")&&"static"===Se.css(e,"position");)e=e.offsetParent;return e||i})}}),Se.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,o){var i=/Y/.test(o);Se.fn[t]=function(e){return Se.access(this,function(e,t,n){var r=Yt(e);if(n===b)return r?o in r?r[o]:r.document.documentElement[t]:e[t];r?r.scrollTo(i?Se(r).scrollLeft():n,i?n:Se(r).scrollTop()):e[t]=n},t,e,arguments.length,null)}}),Se.each({Height:"height",Width:"width"},function(i,s){Se.each({padding:"inner"+i,content:s,"":"outer"+i},function(r,e){Se.fn[e]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),o=r||(!0===e||!0===t?"margin":"border");return Se.access(this,function(e,t,n){var r;return Se.isWindow(e)?e.document.documentElement["client"+i]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+i],r["scroll"+i],e.body["offset"+i],r["offset"+i],r["client"+i])):n===b?Se.css(e,t,o):Se.style(e,t,n,o)},s,n?e:b,n,null)}})}),Se.fn.size=function(){return this.length},Se.fn.andSelf=Se.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=Se:(h.jQuery=h.$=Se,"function"==typeof define&&define.amd&&define("jquery",[],function(){return Se}))}(window),function(d,ne,re){function C(o,i){return i=i||Error,function(){var e,t,n=arguments[0],r=arguments;for(e=(e="["+(o?o+":":"")+n+"] "+arguments[1].replace(/\{\d+\}/g,function(e){var t=+e.slice(1,-1);return 2+t<r.length?De(r[2+t]):e}))+"\nhttp://errors.angularjs.org/1.3.5/"+(o?o+"/":"")+n,t=2;t<arguments.length;t++)e=e+(2==t?"?":"&")+"p"+(t-2)+"="+encodeURIComponent(De(arguments[t]));return new i(e)}}var i=/^\/(.+)\/([a-z]*)$/,s="validity",S=function(e){return ae(e)?e.toLowerCase():e},P=Object.prototype.hasOwnProperty,u=function(e){return ae(e)?e.toUpperCase():e};"i"!=="I".toLowerCase()&&(S=function(e){return ae(e)?e.replace(/[A-Z]/g,function(e){return String.fromCharCode(32|e.charCodeAt(0))}):e},u=function(e){return ae(e)?e.replace(/[a-z]/g,function(e){return String.fromCharCode(-33&e.charCodeAt(0))}):e});var q,oe,m,h,r=[].slice,n=[].splice,e=[].push,a=Object.prototype.toString,l=C("ng"),E=d.angular||(d.angular={}),t=0;function O(e){if(null==e||M(e))return!1;var t=e.length;return!(e.nodeType!==Ie||!t)||(ae(e)||ce(e)||0===t||"number"==typeof t&&0<t&&t-1 in e)}function ie(e,t,n){var r,o;if(e)if(ue(e))for(r in e)"prototype"==r||"length"==r||"name"==r||e.hasOwnProperty&&!e.hasOwnProperty(r)||t.call(n,e[r],r,e);else if(ce(e)||O(e)){var i="object"!=typeof e;for(r=0,o=e.length;r<o;r++)(i||r in e)&&t.call(n,e[r],r,e)}else if(e.forEach&&e.forEach!==ie)e.forEach(t,n,e);else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e);return e}function J(e){return Object.keys(e).sort()}function y(n){return function(e,t){n(t,e)}}function o(){return++t}function p(e,t){t?e.$$hashKey=t:delete e.$$hashKey}function D(e){for(var t=e.$$hashKey,n=1,r=arguments.length;n<r;n++){var o=arguments[n];if(o)for(var i=Object.keys(o),s=0,a=i.length;s<a;s++){var c=i[s];e[c]=o[c]}}return p(e,t),e}function g(e){return parseInt(e,10)}function R(e,t){return D(Object.create(e),t)}function w(){}function F(e){return e}function v(e){return function(){return e}}function x(e){return void 0===e}function z(e){return void 0!==e}function se(e){return null!==e&&"object"==typeof e}function ae(e){return"string"==typeof e}function A(e){return"number"==typeof e}function b(e){return"[object Date]"===a.call(e)}q=ne.documentMode,w.$inject=[],F.$inject=[];var ce=Array.isArray;function ue(e){return"function"==typeof e}function f(e){return"[object RegExp]"===a.call(e)}function M(e){return e&&e.window===e}function le(e){return e&&e.$evalAsync&&e.$watch}function T(e){return"boolean"==typeof e}function I(e){return e&&ue(e.then)}var pe=function(e){return ae(e)?e.trim():e},c=function(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};function N(e){return!(!e||!(e.nodeName||e.prop&&e.attr&&e.find))}function fe(e){return S(e.nodeName||e[0]&&e[0].nodeName)}function ge(e,t){var n=e.indexOf(t);return 0<=n&&e.splice(n,1),t}function L(e,n,t,r){if(M(e)||le(e))throw l("cpws","Can't copy! Making copies of Window or Scope instances is not supported.");if(n){if(e===n)throw l("cpi","Can't copy! Source and destination are identical.");if(t=t||[],r=r||[],se(e)){var o=t.indexOf(e);if(-1!==o)return r[o];t.push(e),r.push(n)}var i;if(ce(e))for(var s=n.length=0;s<e.length;s++)i=L(e[s],null,t,r),se(e[s])&&(t.push(e[s]),r.push(i)),n.push(i);else{var a=n.$$hashKey;for(var c in ce(n)?n.length=0:ie(n,function(e,t){delete n[t]}),e)e.hasOwnProperty(c)&&(i=L(e[c],null,t,r),se(e[c])&&(t.push(e[c]),r.push(i)),n[c]=i);p(n,a)}}else if(n=e)if(ce(e))n=L(e,[],t,r);else if(b(e))n=new Date(e.getTime());else if(f(e))(n=new RegExp(e.source,e.toString().match(/[^\/]*$/)[0])).lastIndex=e.lastIndex;else if(se(e)){var u=Object.create(Object.getPrototypeOf(e));n=L(e,u,t,r)}return n}function _(e,t){if(ce(e)){t=t||[];for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}else if(se(e))for(var o in t=t||{},e)"$"===o.charAt(0)&&"$"===o.charAt(1)||(t[o]=e[o]);return t||e}function he(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e!=e&&t!=t)return!0;var n,r,o,i=typeof e;if(i==typeof t&&"object"==i){if(!ce(e)){if(b(e))return!!b(t)&&he(e.getTime(),t.getTime());if(f(e)&&f(t))return e.toString()==t.toString();if(le(e)||le(t)||M(e)||M(t)||ce(t))return!1;for(r in o={},e)if("$"!==r.charAt(0)&&!ue(e[r])){if(!he(e[r],t[r]))return!1;o[r]=!0}for(r in t)if(!o.hasOwnProperty(r)&&"$"!==r.charAt(0)&&t[r]!==re&&!ue(t[r]))return!1;return!0}if(!ce(t))return!1;if((n=e.length)==t.length){for(r=0;r<n;r++)if(!he(e[r],t[r]))return!1;return!0}}return!1}var B=function(){if(z(B.isActive_))return B.isActive_;var t=!(!ne.querySelector("[ng-csp]")&&!ne.querySelector("[data-ng-csp]"));if(!t)try{new Function("")}catch(e){t=!0}return B.isActive_=t};function $(e,t,n){return e.concat(r.call(t,n))}function de(e,t){return r.call(e,t||0)}function W(e,t){var n=2<arguments.length?de(arguments,2):[];return!ue(t)||t instanceof RegExp?t:n.length?function(){return arguments.length?t.apply(e,$(n,arguments,0)):t.apply(e,n)}:function(){return arguments.length?t.apply(e,arguments):t.call(e)}}function U(e,t){var n=t;return"string"==typeof e&&"$"===e.charAt(0)&&"$"===e.charAt(1)?n=re:M(t)?n="$WINDOW":t&&ne===t?n="$DOCUMENT":le(t)&&(n="$SCOPE"),n}function j(e,t){return void 0===e?re:JSON.stringify(e,U,t?"  ":null)}function G(e){return ae(e)?JSON.parse(e):e}function me(e){e=oe(e).clone();try{e.empty()}catch(e){}var t=oe("<div>").append(e).html();try{return e[0].nodeType===Ne?S(t):t.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(e,t){return"<"+S(t)})}catch(e){return S(t)}}function V(e){try{return decodeURIComponent(e)}catch(e){}}function k(e){var n,r,o={};return ie((e||"").split("&"),function(e){if(e&&(n=e.replace(/\+/g,"%20").split("="),z(r=V(n[0])))){var t=!z(n[1])||V(n[1]);P.call(o,r)?ce(o[r])?o[r].push(t):o[r]=[o[r],t]:o[r]=t}}),o}function H(e){var n=[];return ie(e,function(e,t){ce(e)?ie(e,function(e){n.push(X(t,!0)+(!0===e?"":"="+X(e,!0)))}):n.push(X(t,!0)+(!0===e?"":"="+X(e,!0)))}),n.length?n.join("&"):""}function Y(e){return X(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function X(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,t?"%20":"+")}var K=["ng-","data-ng-","ng:","x-ng-"];function Q(r,e){var o,i,t={};ie(K,function(e){var t=e+"app";!o&&r.hasAttribute&&r.hasAttribute(t)&&(i=(o=r).getAttribute(t))}),ie(K,function(e){var t,n=e+"app";!o&&(t=r.querySelector("["+n.replace(":","\\:")+"]"))&&(i=(o=t).getAttribute(n))}),o&&(t.strictDi=null!==function(e,t){var n,r,o=K.length;for(e=oe(e),r=0;r<o;++r)if(n=K[r]+t,ae(n=e.attr(n)))return n;return null}(o,"strict-di"),e(o,i?[i]:[],t))}function Z(n,r,o){se(o)||(o={});o=D({strictDi:!1},o);function t(){if((n=oe(n)).injector()){var e=n[0]===ne?"document":me(n);throw l("btstrpd","App Already Bootstrapped with this Element '{0}'",e.replace(/</,"&lt;").replace(/>/,"&gt;"))}(r=r||[]).unshift(["$provide",function(e){e.value("$rootElement",n)}]),o.debugInfoEnabled&&r.push(["$compileProvider",function(e){e.debugInfoEnabled(!0)}]),r.unshift("ng");var t=Pt(r,o.strictDi);return t.invoke(["$rootScope","$rootElement","$compile","$injector",function(e,t,n,r){e.$apply(function(){t.data("$injector",r),n(t)(e)})}]),t}var e=/^NG_ENABLE_DEBUG_INFO!/,i=/^NG_DEFER_BOOTSTRAP!/;if(d&&e.test(d.name)&&(o.debugInfoEnabled=!0,d.name=d.name.replace(e,"")),d&&!i.test(d.name))return t();d.name=d.name.replace(i,""),E.resumeBootstrap=function(e){ie(e,function(e){r.push(e)}),t()}}function ee(){d.name="NG_ENABLE_DEBUG_INFO!"+d.name,d.location.reload()}function te(e){return E.element(e).injector().get("$$testability")}var ye=/[A-Z]/g;function ve(e,n){return n=n||"_",e.replace(ye,function(e,t){return(t?n:"")+e.toLowerCase()})}var Ce,Se=!1;function Ee(e,t,n){if(!e)throw l("areq","Argument '{0}' is {1}",t||"?",n||"required");return e}function Ae(e,t,n){return n&&ce(e)&&(e=e[e.length-1]),Ee(ue(e),t,"not a function, got "+(e&&"object"==typeof e?e.constructor.name||"Object":typeof e)),e}function be(e,t){if("hasOwnProperty"===e)throw l("badname","hasOwnProperty is not a valid {0} name",t)}function Me(e,t,n){if(!t)return e;for(var r,o=t.split("."),i=e,s=o.length,a=0;a<s;a++)r=o[a],e=e&&(i=e)[r];return!n&&ue(e)?W(i,e):e}function Te(e){var t=e[0],n=e[e.length-1],r=[t];do{if(!(t=t.nextSibling))break;r.push(t)}while(t!==n);return oe(r)}function Pe(){return Object.create(null)}var Ie=1,Ne=3,Le=8,_e=9,xe=11;function De(e){return"function"==typeof e?e.toString().replace(/ \{[\s\S]*$/,""):void 0===e?"undefined":"string"!=typeof e?function(e){var n=[];return JSON.stringify(e,function(e,t){if(se(t=U(e,t))){if(0<=n.indexOf(t))return"<<already seen>>";n.push(t)}return t})}(e):e}var Re={full:"1.3.5",major:1,minor:3,dot:5,codeName:"cybernetic-mercantilism"};Ke.expando="ng339";var Oe=Ke.cache={},we=1,Fe=function(e,t,n){e.addEventListener(t,n,!1)},Be=function(e,t,n){e.removeEventListener(t,n,!1)};Ke._data=function(e){return this.cache[e[this.expando]]||{}};var $e=/([\:\-\_]+(.))/g,We=/^moz([A-Z])/,Ue={mouseleave:"mouseout",mouseenter:"mouseover"},je=C("jqLite");function Ge(e){return e.replace($e,function(e,t,n,r){return r?n.toUpperCase():n}).replace(We,"Moz$1")}var Ve=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ke=/<|&#?\w+;/,He=/<([\w:]+)/,qe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Je={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ze(e){return!ke.test(e)}function Ye(e){var t=e.nodeType;return t===Ie||!t||t===_e}function Xe(e,t){var n,r,o,i,s=t.createDocumentFragment(),a=[];if(ze(e))a.push(t.createTextNode(e));else{for(n=n||s.appendChild(t.createElement("div")),r=(He.exec(e)||["",""])[1].toLowerCase(),o=Je[r]||Je._default,n.innerHTML=o[1]+e.replace(qe,"<$1></$2>")+o[2],i=o[0];i--;)n=n.lastChild;a=$(a,n.childNodes),(n=s.firstChild).textContent=""}return s.textContent="",s.innerHTML="",ie(a,function(e){s.appendChild(e)}),s}function Ke(e){if(e instanceof Ke)return e;var t;if(ae(e)&&(e=pe(e),t=!0),!(this instanceof Ke)){if(t&&"<"!=e.charAt(0))throw je("nosel","Looking up elements via selectors is not supported by jqLite! See: http://docs.angularjs.org/api/angular.element");return new Ke(e)}at(this,t?function(e,t){var n;return t=t||ne,(n=Ve.exec(e))?[t.createElement(n[1])]:(n=Xe(e,t))?n.childNodes:[]}(e):e)}function Qe(e){return e.cloneNode(!0)}function Ze(e,t){if(t||tt(e),e.querySelectorAll)for(var n=e.querySelectorAll("*"),r=0,o=n.length;r<o;r++)tt(n[r])}function et(n,e,r,t){if(z(t))throw je("offargs","jqLite#off() does not support the `selector` argument");var o=nt(n),i=o&&o.events,s=o&&o.handle;if(s)if(e)ie(e.split(" "),function(e){if(z(r)){var t=i[e];if(ge(t||[],r),t&&0<t.length)return}Be(n,e,s),delete i[e]});else for(e in i)"$destroy"!==e&&Be(n,e,s),delete i[e]}function tt(e,t){var n=e.ng339,r=n&&Oe[n];if(r){if(t)return void delete r.data[t];r.handle&&(r.events.$destroy&&r.handle({},"$destroy"),et(e)),delete Oe[n],e.ng339=re}}function nt(e,t){var n=e.ng339,r=n&&Oe[n];return t&&!r&&(e.ng339=n=++we,r=Oe[n]={events:{},data:{},handle:re}),r}function rt(e,t,n){if(Ye(e)){var r=z(n),o=!r&&t&&!se(t),i=!t,s=nt(e,!o),a=s&&s.data;if(r)a[t]=n;else{if(i)return a;if(o)return a&&a[t];D(a,t)}}}function ot(e,t){return!!e.getAttribute&&-1<(" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")}function it(t,e){e&&t.setAttribute&&ie(e.split(" "),function(e){t.setAttribute("class",pe((" "+(t.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+pe(e)+" "," ")))})}function st(e,t){if(t&&e.setAttribute){var n=(" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");ie(t.split(" "),function(e){e=pe(e),-1===n.indexOf(" "+e+" ")&&(n+=e+" ")}),e.setAttribute("class",pe(n))}}function at(e,t){if(t)if(t.nodeType)e[e.length++]=t;else{var n=t.length;if("number"==typeof n&&t.window!==t){if(n)for(var r=0;r<n;r++)e[e.length++]=t[r]}else e[e.length++]=t}}function ct(e,t){return ut(e,"$"+(t||"ngController")+"Controller")}function ut(e,t,n){e.nodeType==_e&&(e=e.documentElement);for(var r=ce(t)?t:[t];e;){for(var o=0,i=r.length;o<i;o++)if((n=oe.data(e,r[o]))!==re)return n;e=e.parentNode||e.nodeType===xe&&e.host}}function lt(e){for(Ze(e,!0);e.firstChild;)e.removeChild(e.firstChild)}function pt(e,t){t||Ze(e);var n=e.parentNode;n&&n.removeChild(e)}Je.optgroup=Je.option,Je.tbody=Je.tfoot=Je.colgroup=Je.caption=Je.thead,Je.th=Je.td;var ft=Ke.prototype={ready:function(e){var t=!1;function n(){t||(t=!0,e())}"complete"===ne.readyState?setTimeout(n):(this.on("DOMContentLoaded",n),Ke(d).on("load",n))},toString:function(){var t=[];return ie(this,function(e){t.push(""+e)}),"["+t.join(", ")+"]"},eq:function(e){return oe(0<=e?this[e]:this[this.length+e])},length:0,push:e,sort:[].sort,splice:[].splice},gt={};ie("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(e){gt[S(e)]=e});var ht={};ie("input,select,option,textarea,button,form,details".split(","),function(e){ht[e]=!0});var dt={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern"};function mt(e,t){var n=gt[t.toLowerCase()];return n&&ht[fe(e)]&&n}function yt(e,t){if(x(t)){var n=e.nodeType;return n===Ie||n===Ne?e.textContent:""}e.textContent=t}function vt(e,t){var n=e&&e.$$hashKey;if(n)return"function"==typeof n&&(n=e.$$hashKey()),n;var r=typeof e;return n="function"==r||"object"==r&&null!==e?e.$$hashKey=r+":"+(t||o)():r+":"+e}function Ct(e,t){if(t){var n=0;this.nextUid=function(){return++n}}ie(e,this.put,this)}ie({data:rt,removeData:tt},function(e,t){Ke[t]=e}),ie({data:rt,inheritedData:ut,scope:function(e){return oe.data(e,"$scope")||ut(e.parentNode||e,["$isolateScope","$scope"])},isolateScope:function(e){return oe.data(e,"$isolateScope")||oe.data(e,"$isolateScopeNoTemplate")},controller:ct,injector:function(e){return ut(e,"$injector")},removeAttr:function(e,t){e.removeAttribute(t)},hasClass:ot,css:function(e,t,n){if(t=Ge(t),!z(n))return e.style[t];e.style[t]=n},attr:function(e,t,n){var r=S(t);if(gt[r]){if(!z(n))return e[t]||(e.attributes.getNamedItem(t)||w).specified?r:re;n?(e[t]=!0,e.setAttribute(t,r)):(e[t]=!1,e.removeAttribute(r))}else if(z(n))e.setAttribute(t,n);else if(e.getAttribute){var o=e.getAttribute(t,2);return null===o?re:o}},prop:function(e,t,n){if(!z(n))return e[t];e[t]=n},text:(yt.$dv="",yt),val:function(e,t){if(x(t)){if(e.multiple&&"select"===fe(e)){var n=[];return ie(e.options,function(e){e.selected&&n.push(e.value||e.text)}),0===n.length?null:n}return e.value}e.value=t},html:function(e,t){if(x(t))return e.innerHTML;Ze(e,!0),e.innerHTML=t},empty:lt},function(u,e){Ke.prototype[e]=function(e,t){var n,r,o=this.length;if(u!==lt&&(2==u.length&&u!==ot&&u!==ct?e:t)===re){if(se(e)){for(n=0;n<o;n++)if(u===rt)u(this[n],e);else for(r in e)u(this[n],r,e[r]);return this}for(var i=u.$dv,s=i===re?Math.min(o,1):o,a=0;a<s;a++){var c=u(this[a],e,t);i=i?i+c:c}return i}for(n=0;n<o;n++)u(this[n],e,t);return this}}),ie({removeData:tt,on:function e(t,n,r,o){if(z(o))throw je("onargs","jqLite#on() does not support the `selector` or `eventData` parameters");if(Ye(t)){var i=nt(t,!0),s=i.events,a=i.handle;a=a||(i.handle=function(s,a){function e(e,t){e.isDefaultPrevented=function(){return e.defaultPrevented};var n=a[t||e.type],r=n?n.length:0;if(r){if(x(e.immediatePropagationStopped)){var o=e.stopImmediatePropagation;e.stopImmediatePropagation=function(){e.immediatePropagationStopped=!0,e.stopPropagation&&e.stopPropagation(),o&&o.call(e)}}e.isImmediatePropagationStopped=function(){return!0===e.immediatePropagationStopped},1<r&&(n=_(n));for(var i=0;i<r;i++)e.isImmediatePropagationStopped()||n[i].call(s,e)}}return e.elem=s,e}(t,s));for(var c=0<=n.indexOf(" ")?n.split(" "):[n],u=c.length;u--;){var l=s[n=c[u]];l||(s[n]=[],"mouseenter"===n||"mouseleave"===n?e(t,Ue[n],function(e){var t=e.relatedTarget;t&&(t===this||this.contains(t))||a(e,n)}):"$destroy"!==n&&Fe(t,n,a),l=s[n]),l.push(r)}}},off:et,one:function(t,n,r){(t=oe(t)).on(n,function e(){t.off(n,r),t.off(n,e)}),t.on(n,r)},replaceWith:function(t,e){var n,r=t.parentNode;Ze(t),ie(new Ke(e),function(e){n?r.insertBefore(e,n.nextSibling):r.replaceChild(e,t),n=e})},children:function(e){var t=[];return ie(e.childNodes,function(e){e.nodeType===Ie&&t.push(e)}),t},contents:function(e){return e.contentDocument||e.childNodes||[]},append:function(e,t){var n=e.nodeType;if(n===Ie||n===xe)for(var r=0,o=(t=new Ke(t)).length;r<o;r++){var i=t[r];e.appendChild(i)}},prepend:function(t,e){if(t.nodeType===Ie){var n=t.firstChild;ie(new Ke(e),function(e){t.insertBefore(e,n)})}},wrap:function(e,t){t=oe(t).eq(0).clone()[0];var n=e.parentNode;n&&n.replaceChild(t,e),t.appendChild(e)},remove:pt,detach:function(e){pt(e,!0)},after:function(e,t){for(var n=e,r=e.parentNode,o=0,i=(t=new Ke(t)).length;o<i;o++){var s=t[o];r.insertBefore(s,n.nextSibling),n=s}},addClass:st,removeClass:it,toggleClass:function(n,e,r){e&&ie(e.split(" "),function(e){var t=r;x(t)&&(t=!ot(n,e)),(t?st:it)(n,e)})},parent:function(e){var t=e.parentNode;return t&&t.nodeType!==xe?t:null},next:function(e){return e.nextElementSibling},find:function(e,t){return e.getElementsByTagName?e.getElementsByTagName(t):[]},clone:Qe,triggerHandler:function(t,e,n){var r,o,i,s=e.type||e,a=nt(t),c=a&&a.events,u=c&&c[s];u&&(r={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return!0===this.immediatePropagationStopped},stopPropagation:w,type:s,target:t},e.type&&(r=D(r,e)),o=_(u),i=n?[r].concat(n):[r],ie(o,function(e){r.isImmediatePropagationStopped()||e.apply(t,i)}))}},function(s,e){Ke.prototype[e]=function(e,t,n){for(var r,o=0,i=this.length;o<i;o++)x(r)?z(r=s(this[o],e,t,n))&&(r=oe(r)):at(r,s(this[o],e,t,n));return z(r)?r:this},Ke.prototype.bind=Ke.prototype.on,Ke.prototype.unbind=Ke.prototype.off}),Ct.prototype={put:function(e,t){this[vt(e,this.nextUid)]=t},get:function(e){return this[vt(e,this.nextUid)]},remove:function(e){var t=this[e=vt(e,this.nextUid)];return delete this[e],t}};var St=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,Et=/,/,At=/^\s*(_?)(\S+?)\1\s*$/,bt=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,Mt=C("$injector");function Tt(e,t,n){var r,o;if("function"==typeof e){if(!(r=e.$inject)){if(r=[],e.length){if(t)throw ae(n)&&n||(n=e.name||function(e){var t=e.toString().replace(bt,"").match(St);return t?"function("+(t[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}(e)),Mt("strictdi","{0} is not using explicit annotation and cannot be invoked in strict mode",n);ie(e.toString().replace(bt,"").match(St)[1].split(Et),function(e){e.replace(At,function(e,t,n){r.push(n)})})}e.$inject=r}}else ce(e)?(Ae(e[o=e.length-1],"fn"),r=e.slice(0,o)):Ae(e,"fn",!0);return r}function Pt(e,l){l=!0===l;var r={},o="Provider",s=[],i=new Ct([],!0),a={$provide:{provider:t(p),factory:t(f),service:t(function(e,t){return f(e,["$injector",function(e){return e.instantiate(t)}])}),value:t(function(e,t){return f(e,v(t),!1)}),constant:t(function(e,t){be(e,"constant"),a[e]=t,n[e]=t}),decorator:function(e,t){var n=c.get(e+o),r=n.$get;n.$get=function(){var e=u.invoke(r,n);return u.invoke(t,null,{$delegate:e})}}}},c=a.$injector=g(a,function(){throw Mt("unpr","Unknown provider: {0}",s.join(" <- "))}),n={},u=n.$injector=g(n,function(e){var t=c.get(e+o);return u.invoke(t.$get,t,re,e)});return ie(function n(e){var r,o=[];ie(e,function(t){if(!i.get(t)){i.put(t,!0);try{ae(t)?(r=h(t),o=o.concat(n(r.requires)).concat(r._runBlocks),e(r._invokeQueue),e(r._configBlocks)):ue(t)?o.push(c.invoke(t)):ce(t)?o.push(c.invoke(t)):Ae(t,"module")}catch(e){throw ce(t)&&(t=t[t.length-1]),e.message&&e.stack&&-1==e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),Mt("modulerr","Failed to instantiate module {0} due to:\n{1}",t,e.stack||e.message||e)}}function e(e){var t,n;for(t=0,n=e.length;t<n;t++){var r=e[t],o=c.get(r[0]);o[r[1]].apply(o,r[2])}}});return o}(e),function(e){u.invoke(e||w)}),u;function t(n){return function(e,t){if(!se(e))return n(e,t);ie(e,y(n))}}function p(e,t){if(be(e,"service"),(ue(t)||ce(t))&&(t=c.instantiate(t)),!t.$get)throw Mt("pget","Provider '{0}' must define $get factory method.",e);return a[e+o]=t}function f(e,t,n){return p(e,{$get:!1!==n?function(t,n){return function(){var e=u.invoke(n,this,re,t);if(x(e))throw Mt("undef","Provider '{0}' must return a value from $get factory method.",t);return e}}(e,t):t})}function g(n,e){function u(t){if(n.hasOwnProperty(t)){if(n[t]===r)throw Mt("cdep","Circular dependency found: {0}",t+" <- "+s.join(" <- "));return n[t]}try{return s.unshift(t),n[t]=r,n[t]=e(t)}catch(e){throw n[t]===r&&delete n[t],e}finally{s.shift()}}function i(e,t,n,r){"string"==typeof n&&(r=n,n=null);var o,i,s,a=[],c=Tt(e,l,r);for(i=0,o=c.length;i<o;i++){if("string"!=typeof(s=c[i]))throw Mt("itkn","Incorrect injection token! Expected service name as string, got {0}",s);a.push(n&&n.hasOwnProperty(s)?n[s]:u(s))}return ce(e)&&(e=e[o]),e.apply(t,a)}return{invoke:i,instantiate:function(e,t,n){var r=Object.create((ce(e)?e[e.length-1]:e).prototype),o=i(e,r,t,n);return se(o)||ue(o)?o:r},get:u,annotate:Tt,has:function(e){return a.hasOwnProperty(e+o)||n.hasOwnProperty(e)}}}}function It(){var e=!0;this.disableAutoScrolling=function(){e=!1},this.$get=["$window","$location","$rootScope",function(r,n,o){var i=r.document;function s(e){if(e){e.scrollIntoView();var t=function(){var e=a.yOffset;if(ue(e))e=e();else if(N(e)){var t=e[0];e="fixed"!==r.getComputedStyle(t).position?0:t.getBoundingClientRect().bottom}else A(e)||(e=0);return e}();if(t){var n=e.getBoundingClientRect().top;r.scrollBy(0,n-t)}}else r.scrollTo(0,0)}function a(){var e,t=n.hash();t?(e=i.getElementById(t))?s(e):(e=function(e){var t=null;return Array.prototype.some.call(e,function(e){if("a"===fe(e))return t=e,!0}),t}(i.getElementsByName(t)))?s(e):"top"===t&&s(null):s(null)}return e&&o.$watch(function(){return n.hash()},function(e,t){e===t&&""===e||function(e,t){"complete"===(t=t||d).document.readyState?t.setTimeout(e):oe(t).on("load",e)}(function(){o.$evalAsync(a)})}),a}]}Pt.$$annotate=Tt;var Nt=C("$animate"),Lt=["$provide",function(r){this.$$selectors={},this.register=function(e,t){var n=e+"-animation";if(e&&"."!=e.charAt(0))throw Nt("notcsel","Expecting class selector starting with '.' got '{0}'.",e);this.$$selectors[e.substr(1)]=n,r.factory(n,t)},this.classNameFilter=function(e){return 1===arguments.length&&(this.$$classNameFilter=e instanceof RegExp?e:null),this.$$classNameFilter},this.$get=["$$q","$$asyncCallback","$rootScope",function(u,e,l){var t;function p(e,t,n){for(var r=0,o=t.length;r<o;++r){e[t[r]]=n}}function o(){return t||(t=u.defer(),e(function(){t.resolve(),t=null})),t.promise}function i(e,t){if(E.isObject(t)){var n=D(t.from||{},t.to||{});e.css(n)}}return{animate:function(e,t,n){return i(e,{from:t,to:n}),o()},enter:function(e,t,n,r){return i(e,r),n?n.after(e):t.prepend(e),o()},leave:function(e,t){return e.remove(),o()},move:function(e,t,n,r){return this.enter(e,t,n,r)},addClass:function(e,t,n){return this.setClass(e,t,[],n)},$$addClassImmediately:function(e,t,n){return e=oe(e),t=ae(t)?t:ce(t)?t.join(" "):"",ie(e,function(e){st(e,t)}),i(e,n),o()},removeClass:function(e,t,n){return this.setClass(e,[],t,n)},$$removeClassImmediately:function(e,t,n){return e=oe(e),t=ae(t)?t:ce(t)?t.join(" "):"",ie(e,function(e){it(e,t)}),i(e,n),o()},setClass:function(r,e,t,n){var o=this,i="$$animateClasses",s=!1,a=(r=oe(r)).data(i);a?n&&a.options&&(a.options=E.extend(a.options||{},n)):(a={classes:{},options:n},s=!0);var c=a.classes;return e=ce(e)?e:e.split(" "),t=ce(t)?t:t.split(" "),p(c,e,!0),p(c,t,!1),s&&(a.promise=function(e){var t,n=u.defer();return n.promise.$$cancelFn=function(){t&&t()},l.$$postDigest(function(){t=e(function(){n.resolve()})}),n.promise}(function(e){var t=r.data(i);if(r.removeData(i),t){var n=function(e,t){var r=[],o=[],i=Pe();return ie((e.attr("class")||"").split(/\s+/),function(e){i[e]=!0}),ie(t,function(e,t){var n=i[t];!1===e&&n?o.push(t):!0!==e||n||r.push(t)}),0<r.length+o.length&&[r.length?r:null,o.length?o:null]}(r,t.classes);n&&o.$$setClassImmediately(r,n[0],n[1],t.options)}e()}),r.data(i,a)),a.promise},$$setClassImmediately:function(e,t,n,r){return t&&this.$$addClassImmediately(e,t),n&&this.$$removeClassImmediately(e,n),i(e,r),o()},enabled:w,cancel:w}}]}];function _t(){this.$get=["$$rAF","$timeout",function(t,n){return t.supported?function(e){return t(e)}:function(e){return n(e,0,!1)}}]}function xt(i,e,a,s){var c=this,u=e[0],l=i.location,p=i.history,r=i.setTimeout,t=i.clearTimeout,o={};c.isMock=!1;var f=0,n=[];function g(e){try{e.apply(null,de(arguments,1))}finally{if(0===--f)for(;n.length;)try{n.pop()()}catch(e){a.error(e)}}}c.$$completeOutstandingRequest=g,c.$$incOutstandingRequestCount=function(){f++},c.notifyWhenNoOutstandingRequests=function(e){ie(d,function(e){e()}),0===f?e():n.push(e)};var h,d=[];c.addPollFn=function(e){return x(h)&&function(t,n){!function e(){ie(d,function(e){e()}),h=n(e,t)}()}(100,r),d.push(e),e};var m,y,v=l.href,C=e.find("base"),S=null;T(),y=m,c.url=function(e,t,n){if(x(n)&&(n=null),l!==i.location&&(l=i.location),p!==i.history&&(p=i.history),e){var r=y===n;if(v===e&&(!s.history||r))return c;var o=v&&dn(v)===dn(e);return v=e,y=n,!s.history||o&&r?(o||(S=e),t?l.replace(e):l.href=e):(p[t?"replaceState":"pushState"](n,"",e),T(),y=m),c}return S||l.href.replace(/%27/g,"'")},c.state=function(){return m};var E=[],A=!1;function b(){T(),P()}var M=null;function T(){try{m=i.history.state}catch(e){}he(m=x(m)?null:m,M)&&(m=M),M=m}function P(){v===c.url()&&y===m||(v=c.url(),y=m,ie(E,function(e){e(c.url(),m)}))}c.onUrlChange=function(e){return A||(s.history&&oe(i).on("popstate",b),oe(i).on("hashchange",b),A=!0),E.push(e),e},c.$$checkUrlChange=P,c.baseHref=function(){var e=C.attr("href");return e?e.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var I={},N="",L=c.baseHref();function _(t){try{return decodeURIComponent(t)}catch(e){return t}}c.cookies=function(e,t){var n,r,o,i,s;if(!e){if(u.cookie!==N)for(r=(N=u.cookie).split("; "),I={},i=0;i<r.length;i++)0<(s=(o=r[i]).indexOf("="))&&(e=_(o.substring(0,s)),I[e]===re&&(I[e]=_(o.substring(s+1))));return I}t===re?u.cookie=encodeURIComponent(e)+"=;path="+L+";expires=Thu, 01 Jan 1970 00:00:00 GMT":ae(t)&&4096<(n=(u.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path="+L).length+1)&&a.warn("Cookie '"+e+"' possibly not set or overflowed because it was too large ("+n+" > 4096 bytes)!")},c.defer=function(e,t){var n;return f++,n=r(function(){delete o[n],g(e)},t||0),o[n]=!0,n},c.defer.cancel=function(e){return!!o[e]&&(delete o[e],t(e),g(w),!0)}}function Dt(){this.$get=["$window","$log","$sniffer","$document",function(e,t,n,r){return new xt(e,r,t,n)}]}function Rt(){this.$get=function(){var p={};function e(e,t){if(e in p)throw C("$cacheFactory")("iid","CacheId '{0}' is already taken!",e);var n=0,r=D({},t,{id:e}),o={},i=t&&t.capacity||Number.MAX_VALUE,s={},a=null,c=null;return p[e]={put:function(e,t){i<Number.MAX_VALUE&&u(s[e]||(s[e]={key:e}));if(!x(t))return e in o||n++,o[e]=t,i<n&&this.remove(c.key),t},get:function(e){if(i<Number.MAX_VALUE){var t=s[e];if(!t)return;u(t)}return o[e]},remove:function(e){if(i<Number.MAX_VALUE){var t=s[e];if(!t)return;t==a&&(a=t.p),t==c&&(c=t.n),l(t.n,t.p),delete s[e]}delete o[e],n--},removeAll:function(){o={},n=0,s={},a=c=null},destroy:function(){s=r=o=null,delete p[e]},info:function(){return D({},r,{size:n})}};function u(e){e!=a&&(c?c==e&&(c=e.n):c=e,l(e.n,e.p),l(e,a),(a=e).n=null)}function l(e,t){e!=t&&(e&&(e.p=t),t&&(t.n=e))}}return e.info=function(){var n={};return ie(p,function(e,t){n[t]=e.info()}),n},e.get=function(e){return p[e]},e}}function Ot(){this.$get=["$cacheFactory",function(e){return e("templates")}]}var wt=C("$compile");function Ft(n,t){var g={},h="Directive",P=/^\s*directive\:\s*([\w\-]+)\s+(.*)$/,I=/(([\w\-]+)(?:\:([^;]+))?;?)/,u=function(e){var t,n={},r=e.split(",");for(t=0;t<r.length;t++)n[r[t]]=!0;return n}("ngSrc,ngSrcset,src,srcset"),te=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,l=/^(on[a-z]+|formaction)$/;this.directive=function e(s,t){return be(s,"directive"),ae(s)?(Ee(t,"directiveFactory"),g.hasOwnProperty(s)||(g[s]=[],n.factory(s+h,["$injector","$exceptionHandler",function(r,o){var i=[];return ie(g[s],function(e,t){try{var n=r.invoke(e);ue(n)?n={compile:v(n)}:!n.compile&&n.link&&(n.compile=v(n.link)),n.priority=n.priority||0,n.index=t,n.name=n.name||s,n.require=n.require||n.controller&&n.name,n.restrict=n.restrict||"EA",se(n.scope)&&(n.$$isolateBindings=function(e,r){var o=/^\s*([@&]|=(\*?))(\??)\s*(\w*)\s*$/,i={};return ie(e,function(e,t){var n=e.match(o);if(!n)throw wt("iscp","Invalid isolate scope definition for directive '{0}'. Definition: {... {1}: '{2}' ...}",r,t,e);i[t]={mode:n[1][0],collection:"*"===n[2],optional:"?"===n[3],attrName:n[4]||t}}),i}(n.scope,n.name)),i.push(n)}catch(e){o(e)}}),i}])),g[s].push(t)):ie(s,y(e)),this},this.aHrefSanitizationWhitelist=function(e){return z(e)?(t.aHrefSanitizationWhitelist(e),this):t.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(e){return z(e)?(t.imgSrcSanitizationWhitelist(e),this):t.imgSrcSanitizationWhitelist()};var s=!0;this.debugInfoEnabled=function(e){return z(e)?(s=e,this):s},this.$get=["$injector","$interpolate","$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(f,B,$,e,W,U,i,t,c,o,v){var j=function(e,t){if(t){var n,r,o,i=Object.keys(t);for(n=0,r=i.length;n<r;n++)this[o=i[n]]=t[o]}else this.$attr={};this.$$element=e};function N(e,t){try{e.addClass(t)}catch(e){}}j.prototype={$normalize:$t,$addClass:function(e){e&&0<e.length&&o.addClass(this.$$element,e)},$removeClass:function(e){e&&0<e.length&&o.removeClass(this.$$element,e)},$updateClass:function(e,t){var n=Wt(e,t);n&&n.length&&o.addClass(this.$$element,n);var r=Wt(t,e);r&&r.length&&o.removeClass(this.$$element,r)},$set:function(e,t,n,r){var o,i=this.$$element[0],s=mt(i,e),a=function(e,t){var n=e.nodeName;return("INPUT"===n||"TEXTAREA"===n)&&dt[t]}(i,e),c=e;if(s?(this.$$element.prop(e,t),r=s):a&&(this[a]=t,c=a),this[e]=t,r?this.$attr[e]=r:(r=this.$attr[e])||(this.$attr[e]=r=ve(e,"-")),"a"===(o=fe(this.$$element))&&"href"===e||"img"===o&&"src"===e)this[e]=t=v(t,"src"===e);else if("img"===o&&"srcset"===e){for(var u="",l=pe(t),p=/\s/.test(l)?/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/:/(,)/,f=l.split(p),g=Math.floor(f.length/2),h=0;h<g;h++){var d=2*h;u+=v(pe(f[d]),!0),u+=" "+pe(f[1+d])}var m=pe(f[2*h]).split(/\s/);u+=v(pe(m[0]),!0),2===m.length&&(u+=" "+pe(m[1])),this[e]=t=u}!1!==n&&(null===t||t===re?this.$$element.removeAttr(r):this.$$element.attr(r,t));var y=this.$$observers;y&&ie(y[c],function(e){try{e(t)}catch(e){$(e)}})},$observe:function(e,t){var n=this,r=n.$$observers||(n.$$observers=Pe()),o=r[e]||(r[e]=[]);return o.push(t),i.$evalAsync(function(){!o.$$inter&&n.hasOwnProperty(e)&&t(n[e])}),function(){ge(o,t)}}};var n=B.startSymbol(),r=B.endSymbol(),G="{{"==n||"}}"==r?F:function(e){return e.replace(/\{\{/g,n).replace(/}}/g,r)},E=/^ngAttr[A-Z]/;return V.$$addBindingInfo=s?function(e,t){var n=e.data("$binding")||[];ce(t)?n=n.concat(t):n.push(t),e.data("$binding",n)}:w,V.$$addBindingClass=s?function(e){N(e,"ng-binding")}:w,V.$$addScopeInfo=s?function(e,t,n,r){var o=n?r?"$isolateScopeNoTemplate":"$isolateScope":"$scope";e.data(o,t)}:w,V.$$addScopeClass=s?function(e,t){N(e,t?"ng-isolate-scope":"ng-scope")}:w,V;function V(c,e,t,n,r){c instanceof oe||(c=oe(c)),ie(c,function(e,t){e.nodeType==Ne&&e.nodeValue.match(/\S+/)&&(c[t]=oe(e).wrap("<span></span>").parent()[0])});var u=L(c,e,c,t,n,r);V.$$addScopeClass(c);var l=null;return function(e,t,n){Ee(e,"scope");var r,o=(n=n||{}).parentBoundTranscludeFn,i=n.transcludeControllers,s=n.futureParentElement;if(o&&o.$$boundTransclude&&(o=o.$$boundTransclude),r="html"!==(l=l||function(e){var t=e&&e[0];return t&&"foreignobject"!==fe(t)&&t.toString().match(/SVG/)?"svg":"html"}(s))?oe(K(l,oe("<div>").append(c).html())):t?ft.clone.call(c):c,i)for(var a in i)r.data("$"+a+"Controller",i[a].instance);return V.$$addScopeInfo(r,e),t&&t(r,e),u&&u(e,r,r,o),r}}function L(e,h,t,n,r,o){for(var i,s,a,c,u,l,d,m=[],p=0;p<e.length;p++)i=new j,(a=(s=k(e[p],[],i,0===p?n:re,r)).length?x(s,e[p],i,h,t,null,[],[],o):null)&&a.scope&&V.$$addScopeClass(i.$$element),u=a&&a.terminal||!(c=e[p].childNodes)||!c.length?null:L(c,a?(a.transcludeOnThisElement||!a.templateOnThisElement)&&a.transclude:h),(a||u)&&(m.push(p,a,u),l=!0,d=d||a),o=null;return l?function(e,t,n,r){var o,i,s,a,c,u,l,p,f;if(d){var g=t.length;for(f=new Array(g),c=0;c<m.length;c+=3)l=m[c],f[l]=t[l]}else f=t;for(c=0,u=m.length;c<u;)s=f[m[c++]],o=m[c++],i=m[c++],o?(o.scope?(a=e.$new(),V.$$addScopeInfo(oe(s),a)):a=e,p=o.transcludeOnThisElement?_(e,o.transclude,r,o.elementTranscludeOnThisElement):!o.templateOnThisElement&&r?r:!r&&h?_(e,h):null,o(i,a,s,n,p)):i&&i(e,s.childNodes,re,r)}:null}function _(i,s,a){return function(e,t,n,r,o){return e||((e=i.$new(!1,o)).$$transcluded=!0),s(e,t,{parentBoundTranscludeFn:a,transcludeControllers:n,futureParentElement:r})}}function k(e,t,n,r,o){var i,s,a=e.nodeType,c=n.$attr;switch(a){case Ie:A(t,$t(fe(e)),"E",r,o);for(var u,l,p,f,g,h,d=e.attributes,m=0,y=d&&d.length;m<y;m++){var v=!1,C=!1;l=(u=d[m]).name,g=pe(u.value),f=$t(l),(h=E.test(f))&&(l=ve(f.substr(6),"-"));var S=f.replace(/(Start|End)$/,"");b(S)&&f===S+"Start"&&(C=(v=l).substr(0,l.length-5)+"end",l=l.substr(0,l.length-6)),c[p=$t(l.toLowerCase())]=l,!h&&n.hasOwnProperty(p)||(n[p]=g,mt(e,p)&&(n[p]=!0)),T(e,t,g,p,h),A(t,p,"A",r,o,v,C)}if(ae(s=e.className)&&""!==s)for(;i=I.exec(s);)A(t,p=$t(i[2]),"C",r,o)&&(n[p]=pe(i[3])),s=s.substr(i.index+i[0].length);break;case Ne:!function(e,t){var o=B(t,!0);o&&e.push({priority:0,compile:function(e){var t=e.parent(),r=!!t.length;return r&&V.$$addBindingClass(t),function(e,t){var n=t.parent();r||V.$$addBindingClass(n),V.$$addBindingInfo(n,o.expressions),e.$watch(o,function(e){t[0].nodeValue=e})}}})}(t,e.nodeValue);break;case Le:try{(i=P.exec(e.nodeValue))&&A(t,p=$t(i[1]),"M",r,o)&&(n[p]=pe(i[2]))}catch(e){}}return t.sort(M),t}function H(e,t,n){var r=[],o=0;if(t&&e.hasAttribute&&e.hasAttribute(t))do{if(!e)throw wt("uterdir","Unterminated attribute, found '{0}' but no matching '{1}' found.",t,n);e.nodeType==Ie&&(e.hasAttribute(t)&&o++,e.hasAttribute(n)&&o--),r.push(e),e=e.nextSibling}while(0<o);else r.push(e);return oe(r)}function q(i,s,a){return function(e,t,n,r,o){return t=H(t[0],s,a),i(e,t,n,r,o)}}function x(e,y,v,t,n,r,C,S,o){o=o||{};for(var i,E,s,a,c,u,l,p=-Number.MAX_VALUE,A=o.controllerDirectives,b=o.newIsolateScopeDirective,M=o.templateDirective,f=o.nonTlbTranscludeDirective,g=!1,h=!1,T=o.hasElementTranscludeDirective,d=v.$$element=oe(y),m=r,P=t,I=0,N=e.length;I<N;I++){var L=(s=e[I]).$$start,_=s.$$end;if(L&&(d=H(y,L,_)),c=re,p>s.priority)break;if((l=s.scope)&&(s.templateUrl||(se(l)?(X("new/isolated scope",b||i,s,d),b=s):X("new/isolated scope",b,s,d)),i=i||s),a=s.name,!s.templateUrl&&s.controller&&(l=s.controller,X("'"+a+"' controller",(A=A||{})[a],s,d),A[a]=s),(l=s.transclude)&&(g=!0,s.$$tlb||(X("transclusion",f,s,d),f=s),P="element"==l?(T=!0,p=s.priority,c=d,d=v.$$element=oe(ne.createComment(" "+a+": "+v[a]+" ")),y=d[0],Q(n,de(c),y),V(c,t,p,m&&m.name,{nonTlbTranscludeDirective:f})):(c=oe(Qe(y)).contents(),d.empty(),V(c,t))),s.template)if(h=!0,X("template",M,s,d),l=ue((M=s).template)?s.template(d,v):s.template,l=G(l),s.replace){if(m=s,c=ze(l)?[]:Ut(K(s.templateNamespace,pe(l))),y=c[0],1!=c.length||y.nodeType!==Ie)throw wt("tplrt","Template for directive '{0}' must have exactly one root element. {1}",a,"");Q(n,d,y);var x={$attr:{}},D=k(y,[],x),R=e.splice(I+1,e.length-(I+1));b&&J(D),e=e.concat(D).concat(R),z(v,x),N=e.length}else d.html(l);if(s.templateUrl)h=!0,X("template",M,s,d),(M=s).replace&&(m=s),F=Y(e.splice(I,e.length-I),d,v,n,g&&P,C,S,{controllerDirectives:A,newIsolateScopeDirective:b,templateDirective:M,nonTlbTranscludeDirective:f}),N=e.length;else if(s.compile)try{ue(u=s.compile(d,v,P))?O(null,u,L,_):u&&O(u.pre,u.post,L,_)}catch(e){$(e,me(d))}s.terminal&&(F.terminal=!0,p=Math.max(p,s.priority))}return F.scope=i&&!0===i.scope,F.transcludeOnThisElement=g,F.elementTranscludeOnThisElement=T,F.templateOnThisElement=h,F.transclude=P,o.hasElementTranscludeDirective=T,F;function O(e,t,n,r){e&&(n&&(e=q(e,n,r)),e.require=s.require,e.directiveName=a,b!==s&&!s.$$isolateScope||(e=Z(e,{isolateScope:!0})),C.push(e)),t&&(n&&(t=q(t,n,r)),t.require=s.require,t.directiveName=a,b!==s&&!s.$$isolateScope||(t=Z(t,{isolateScope:!0})),S.push(t))}function w(t,e,n,r){var o,i,s="data",a=!1,c=n;if(ae(e)){if(i=e.match(te),e=e.substring(i[0].length),i[3]&&(i[1]?i[3]=null:i[1]=i[3]),"^"===i[1]?s="inheritedData":"^^"===i[1]&&(s="inheritedData",c=n.parent()),"?"===i[2]&&(a=!0),o=null,r&&"data"===s&&(o=r[e])&&(o=o.instance),!(o=o||c[s]("$"+e+"Controller"))&&!a)throw wt("ctreq","Controller '{0}', required by directive '{1}', can't be found!",e,t);return o||null}return ce(e)&&(o=[],ie(e,function(e){o.push(w(t,e,n,r))})),o}function F(e,l,t,n,o){var r,i,s,a,p,c,u,f,g;if(y===t?f=(g=v).$$element:(f=oe(t),g=new j(f,v)),b&&(p=l.$new(!0)),o&&((u=function(e,t,n){var r;le(e)||(n=t,t=e,e=re);T&&(r=c);n=n||(T?f.parent():f);return o(e,t,r,n,m)}).$$boundTransclude=o),A&&(E={},c={},ie(A,function(e){var t,n={$scope:e===b||e.$$isolateScope?p:l,$element:f,$attrs:g,$transclude:u};"@"==(a=e.controller)&&(a=g[e.name]),t=U(a,n,!0,e.controllerAs),c[e.name]=t,T||f.data("$"+e.name+"Controller",t.instance),E[e.name]=t})),b){V.$$addScopeInfo(f,p,!0,!(M&&(M===b||M===b.$$originalDirective))),V.$$addScopeClass(f,!0);var h=E&&E[b.name],d=p;h&&h.identifier&&!0===b.bindToController&&(d=h.instance),ie(p.$$isolateBindings=b.$$isolateBindings,function(e,t){var n,r,o,i,s=e.attrName,a=e.optional;switch(e.mode){case"@":g.$observe(s,function(e){d[t]=e}),g.$$observers[s].$$scope=l,g[s]&&(d[t]=B(g[s])(l));break;case"=":if(a&&!g[s])return;r=W(g[s]),i=r.literal?he:function(e,t){return e===t||e!=e&&t!=t},o=r.assign||function(){throw n=d[t]=r(l),wt("nonassign","Expression '{0}' used with directive '{1}' is non-assignable!",g[s],b.name)},n=d[t]=r(l);var c,u=function(e){return i(e,d[t])||(i(e,n)?o(l,e=d[t]):d[t]=e),n=e};u.$stateful=!0,c=e.collection?l.$watchCollection(g[s],u):l.$watch(W(g[s],u),null,r.literal),p.$on("$destroy",c);break;case"&":r=W(g[s]),d[t]=function(e){return r(l,e)}}})}for(E&&(ie(E,function(e){e()}),E=null),r=0,i=C.length;r<i;r++)ee(s=C[r],s.isolateScope?p:l,f,g,s.require&&w(s.directiveName,s.require,f,c),u);var m=l;for(b&&(b.template||null===b.templateUrl)&&(m=p),e&&e(m,t.childNodes,re,o),r=S.length-1;0<=r;r--)ee(s=S[r],s.isolateScope?p:l,f,g,s.require&&w(s.directiveName,s.require,f,c),u)}}function J(e){for(var t=0,n=e.length;t<n;t++)e[t]=R(e[t],{$$isolateScope:!0})}function A(e,t,n,r,o,i,s){if(t===o)return null;var a=null;if(g.hasOwnProperty(t))for(var c,u=f.get(t+h),l=0,p=u.length;l<p;l++)try{c=u[l],(r===re||r>c.priority)&&-1!=c.restrict.indexOf(n)&&(i&&(c=R(c,{$$start:i,$$end:s})),e.push(c),a=c)}catch(e){$(e)}return a}function b(e){if(g.hasOwnProperty(e))for(var t=f.get(e+h),n=0,r=t.length;n<r;n++)if(t[n].multiElement)return!0;return!1}function z(n,r){var o=r.$attr,i=n.$attr,s=n.$$element;ie(n,function(e,t){"$"!=t.charAt(0)&&(r[t]&&r[t]!==e&&(e+=("style"===t?";":" ")+r[t]),n.$set(t,e,!0,o[t]))}),ie(r,function(e,t){"class"==t?(N(s,e),n.class=(n.class?n.class+" ":"")+e):"style"==t?(s.attr("style",s.attr("style")+";"+e),n.style=(n.style?n.style+";":"")+e):"$"==t.charAt(0)||n.hasOwnProperty(t)||(n[t]=e,i[t]=o[t])})}function Y(f,g,h,d,m,y,v,C){var S,E,A=[],b=g[0],M=f.shift(),T=D({},M,{templateUrl:null,transclude:null,replace:null,$$originalDirective:M}),P=ue(M.templateUrl)?M.templateUrl(g,h):M.templateUrl,I=M.templateNamespace;return g.empty(),e(c.getTrustedResourceUrl(P)).then(function(e){var n,t,r,o;if(e=G(e),M.replace){if(r=ze(e)?[]:Ut(K(I,pe(e))),n=r[0],1!=r.length||n.nodeType!==Ie)throw wt("tplrt","Template for directive '{0}' must have exactly one root element. {1}",M.name,P);t={$attr:{}},Q(d,g,n);var i=k(n,[],t);se(M.scope)&&J(i),f=i.concat(f),z(h,t)}else n=b,g.html(e);for(f.unshift(T),S=x(f,n,h,m,g,M,y,v,C),ie(d,function(e,t){e==n&&(d[t]=g[0])}),E=L(g[0].childNodes,m);A.length;){var s=A.shift(),a=A.shift(),c=A.shift(),u=A.shift(),l=g[0];if(!s.$$destroyed){if(a!==b){var p=a.className;C.hasElementTranscludeDirective&&M.replace||(l=Qe(n)),Q(c,oe(a),l),N(oe(l),p)}o=S.transcludeOnThisElement?_(s,S.transclude,u):u,S(E,s,l,d,o)}}A=null}),function(e,t,n,r,o){var i=o;t.$$destroyed||(A?A.push(t,n,r,i):(S.transcludeOnThisElement&&(i=_(t,S.transclude,o)),S(E,t,n,r,i)))}}function M(e,t){var n=t.priority-e.priority;return 0!=n?n:e.name!==t.name?e.name<t.name?-1:1:e.index-t.index}function X(e,t,n,r){if(t)throw wt("multidir","Multiple directives [{0}, {1}] asking for {2} on: {3}",t.name,n.name,e,me(r))}function K(e,t){switch(e=S(e||"html")){case"svg":case"math":var n=ne.createElement("div");return n.innerHTML="<"+e+">"+t+"</"+e+">",n.childNodes[0].childNodes;default:return t}}function T(o,e,t,i,s){var a=B(t,!0);if(a){if("multiple"===i&&"select"===fe(o))throw wt("selmulti","Binding to the 'multiple' attribute is not supported. Element: {0}",me(o));e.push({priority:100,compile:function(){return{pre:function(e,t,n){var r=n.$$observers||(n.$$observers={});if(l.test(i))throw wt("nodomevents","Interpolations for HTML DOM event attributes are disallowed.  Please use the ng- versions (such as ng-click instead of onclick) instead.");n[i]&&(a=B(n[i],!0,function(e,t){if("srcdoc"==t)return c.HTML;var n=fe(e);return"xlinkHref"==t||"form"==n&&"action"==t||"img"!=n&&("src"==t||"ngSrc"==t)?c.RESOURCE_URL:void 0}(o,i),u[i]||s))&&(n[i]=a(e),(r[i]||(r[i]=[])).$$inter=!0,(n.$$observers&&n.$$observers[i].$$scope||e).$watch(a,function(e,t){"class"===i&&e!=t?n.$updateClass(e,t):n.$set(i,e)}))}}}})}}function Q(e,t,n){var r,o,i=t[0],s=t.length,a=i.parentNode;if(e)for(r=0,o=e.length;r<o;r++)if(e[r]==i){e[r++]=n;for(var c=r,u=c+s-1,l=e.length;c<l;c++,u++)u<l?e[c]=e[u]:delete e[c];e.length-=s-1,e.context===i&&(e.context=n);break}a&&a.replaceChild(n,i);var p=ne.createDocumentFragment();p.appendChild(i),oe(n).data(oe(i).data()),m?(Ce=!0,m.cleanData([i])):delete oe.cache[i[oe.expando]];for(var f=1,g=t.length;f<g;f++){var h=t[f];oe(h).remove(),p.appendChild(h),delete t[f]}t[0]=n,t.length=1}function Z(e,t){return D(function(){return e.apply(null,arguments)},e,t)}function ee(e,t,n,r,o,i){try{e(t,n,r,o,i)}catch(e){$(e,me(n))}}}]}Ft.$inject=["$provide","$$sanitizeUriProvider"];var Bt=/^((?:x|data)[\:\-_])/i;function $t(e){return Ge(e.replace(Bt,""))}function Wt(e,t){var n="",r=e.split(/\s+/),o=t.split(/\s+/);e:for(var i=0;i<r.length;i++){for(var s=r[i],a=0;a<o.length;a++)if(s==o[a])continue e;n+=(0<n.length?" ":"")+s}return n}function Ut(e){var t=(e=oe(e)).length;if(t<=1)return e;for(;t--;){e[t].nodeType===Le&&n.call(e,t,1)}return e}function jt(){var f={},g=!1,h=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(e,t){be(e,"controller"),se(e)?D(f,e):f[e]=t},this.allowGlobals=function(){g=!0},this.$get=["$injector","$window",function(u,l){return function(e,t,n,r){var o,i,s,a;if(n=!0===n,r&&ae(r)&&(a=r),ae(e)&&(i=e.match(h),s=i[1],a=a||i[3],Ae(e=f.hasOwnProperty(s)?f[s]:Me(t.$scope,s,!0)||(g?Me(l,s,!0):re),s,!0)),n){var c=(ce(e)?e[e.length-1]:e).prototype;return o=Object.create(c),a&&p(t,a,o,s||e.name),D(function(){return u.invoke(e,o,t,s),o},{instance:o,identifier:a})}return o=u.instantiate(e,t,s),a&&p(t,a,o,s||e.name),o};function p(e,t,n,r){if(!e||!se(e.$scope))throw C("$controller")("noscp","Cannot export controller '{0}' as '{1}'! No $scope object provided via `locals`.",r,t);e.$scope[t]=n}}]}function Gt(){this.$get=["$window",function(e){return oe(e.document)}]}function Vt(){this.$get=["$log",function(n){return function(e,t){n.error.apply(n,arguments)}}]}var kt="application/json",Ht={"Content-Type":kt+";charset=utf-8"},qt=/^\s*(\[|\{[^\{])/,Jt=/[\}\]]\s*$/,zt=/^\)\]\}',?\n/;function Yt(e,t){if(ae(e)){e=e.replace(zt,"");var n=t("Content-Type");(n&&0===n.indexOf(kt)&&e.trim()||qt.test(e)&&Jt.test(e))&&(e=G(e))}return e}function Xt(e){var t,n,r,o=Pe();return e&&ie(e.split("\n"),function(e){r=e.indexOf(":"),t=S(pe(e.substr(0,r))),n=pe(e.substr(r+1)),t&&(o[t]=o[t]?o[t]+", "+n:n)}),o}function Kt(n){var r=se(n)?n:re;return function(e){if(r=r||Xt(n),e){var t=r[S(e)];return void 0===t&&(t=null),t}return r}}function Qt(t,n,e){return ue(e)?e(t,n):(ie(e,function(e){t=e(t,n)}),t)}function Zt(e){return 200<=e&&e<300}function en(){var y=this.defaults={transformResponse:[Yt],transformRequest:[function(e){return!se(e)||function(e){return"[object File]"===a.call(e)}(e)||function(e){return"[object Blob]"===a.call(e)}(e)?e:j(e)}],headers:{common:{Accept:"application/json, text/plain, */*"},post:_(Ht),put:_(Ht),patch:_(Ht)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},v=!1;this.useApplyAsync=function(e){return z(e)?(v=!!e,this):v};var n=this.interceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function(p,f,e,g,h,t){var d=e("$http"),c=[];function m(e){var n={method:"get",transformRequest:y.transformRequest,transformResponse:y.transformResponse},r=function(e){var t,n,r,o=y.headers,i=D({},e.headers);o=D({},o.common,o[S(e.method)]);e:for(t in o){for(r in n=S(t),i)if(S(r)===n)continue e;i[t]=o[t]}return function(n){var r;ie(n,function(e,t){ue(e)&&(null!=(r=e())?n[t]=r:delete n[t])})}(i),i}(e);if(!E.isObject(e))throw C("$http")("badreq","Http request configuration must be an object.  Received: {0}",e);D(n,e),n.headers=r,n.method=u(n.method);var t=[function(e){r=e.headers;var t=Qt(e.data,Kt(r),e.transformRequest);return x(t)&&ie(r,function(e,t){"content-type"===S(t)&&delete r[t]}),x(e.withCredentials)&&!x(y.withCredentials)&&(e.withCredentials=y.withCredentials),function(o,e,t){var i,n,s=h.defer(),r=s.promise,a=function(e,t){if(!t)return e;var n=[];(function(e,t,n){for(var r=J(e),o=0;o<r.length;o++)t.call(n,e[r[o]],r[o])})(t,function(e,t){null===e||x(e)||(ce(e)||(e=[e]),ie(e,function(e){se(e)&&(e=b(e)?e.toISOString():j(e)),n.push(X(t)+"="+X(e))}))}),0<n.length&&(e+=(-1==e.indexOf("?")?"?":"&")+n.join("&"));return e}(o.url,o.params);m.pendingRequests.push(o),r.then(l,l),!o.cache&&!y.cache||!1===o.cache||"GET"!==o.method&&"JSONP"!==o.method||(i=se(o.cache)?o.cache:se(y.cache)?y.cache:d);if(i)if(z(n=i.get(a))){if(I(n))return n.then(l,l),n;ce(n)?u(n[1],n[0],_(n[2]),n[3]):u(n,200,{},"OK")}else i.put(a,r);if(x(n)){var c=lr(o.url)?f.cookies()[o.xsrfCookieName||y.xsrfCookieName]:re;c&&(t[o.xsrfHeaderName||y.xsrfHeaderName]=c),p(o.method,a,e,function(e,t,n,r){i&&(Zt(e)?i.put(a,[e,t,Xt(n),r]):i.remove(a));function o(){u(t,e,n,r)}v?g.$applyAsync(o):(o(),g.$$phase||g.$apply())},t,o.timeout,o.withCredentials,o.responseType)}return r;function u(e,t,n,r){(Zt(t=Math.max(t,0))?s.resolve:s.reject)({data:e,status:t,headers:Kt(n),config:o,statusText:r})}function l(){var e=m.pendingRequests.indexOf(o);-1!==e&&m.pendingRequests.splice(e,1)}}(e,t,r).then(a,a)},re],o=h.when(n);for(ie(c,function(e){(e.request||e.requestError)&&t.unshift(e.request,e.requestError),(e.response||e.responseError)&&t.push(e.response,e.responseError)});t.length;){var i=t.shift(),s=t.shift();o=o.then(i,s)}return o.success=function(t){return o.then(function(e){t(e.data,e.status,e.headers,n)}),o},o.error=function(t){return o.then(null,function(e){t(e.data,e.status,e.headers,n)}),o},o;function a(e){var t=D({},e);return e.data?t.data=Qt(e.data,e.headers,n.transformResponse):t.data=e.data,Zt(e.status)?t:h.reject(t)}}return ie(n,function(e){c.unshift(ae(e)?t.get(e):t.invoke(e))}),m.pendingRequests=[],function(e){ie(arguments,function(n){m[n]=function(e,t){return m(D(t||{},{method:n,url:e}))}})}("get","delete","head","jsonp"),function(e){ie(arguments,function(r){m[r]=function(e,t,n){return m(D(n||{},{method:r,url:e,data:t}))}})}("post","put","patch"),m.defaults=y,m}]}function tn(){return new d.XMLHttpRequest}function nn(){this.$get=["$browser","$window","$document",function(e,t,n){return function(d,m,y,v,C){return function(e,r,t,o,n,i,s,a){if(d.$$incOutstandingRequestCount(),r=r||d.url(),"jsonp"==S(e)){var c="_"+(v.counter++).toString(36);v[c]=function(e){v[c].data=e,v[c].called=!0};var u=function(e,r,o){var i=C.createElement("script"),s=null;return i.type="text/javascript",i.src=e,i.async=!0,s=function(e){Be(i,"load",s),Be(i,"error",s),C.body.removeChild(i),i=null;var t=-1,n="unknown";e&&("load"!==e.type||v[r].called||(e={type:"error"}),n=e.type,t="error"===e.type?404:200),o&&o(t,n)},Fe(i,"load",s),Fe(i,"error",s),C.body.appendChild(i),s}(r.replace("JSON_CALLBACK","angular.callbacks."+c),c,function(e,t){h(o,e,v[c].data,"",t),v[c]=w})}else{var l=m();l.open(e,r,!0),ie(n,function(e,t){z(e)&&l.setRequestHeader(t,e)}),l.onload=function(){var e=l.statusText||"",t="response"in l?l.response:l.responseText,n=1223===l.status?204:l.status;0===n&&(n=t?200:"file"==ur(r).protocol?404:0),h(o,n,t,l.getAllResponseHeaders(),e)};var p=function(){h(o,-1,null,null,"")};if(l.onerror=p,l.onabort=p,s&&(l.withCredentials=!0),a)try{l.responseType=a}catch(e){if("json"!==a)throw e}l.send(t||null)}if(0<i)var f=y(g,i);else I(i)&&i.then(g);function g(){u&&u(),l&&l.abort()}function h(e,t,n,r,o){f!==re&&y.cancel(f),u=l=null,e(t,n,r,o),d.$$completeOutstandingRequest(w)}}}(e,tn,e.defer,t.angular.callbacks,n[0])}]}var rn=C("$interpolate");function on(){var T="{{",P="}}";this.startSymbol=function(e){return e?(T=e,this):T},this.endSymbol=function(e){return e?(P=e,this):P},this.$get=["$parse","$exceptionHandler","$sce",function(v,C,S){var E=T.length,A=P.length,b=new RegExp(T.replace(/./g,e),"g"),M=new RegExp(P.replace(/./g,e),"g");function e(e){return"\\\\\\"+e}function t(i,e,t,r){r=!!r;for(var n,o,s,a=0,c=[],u=[],l=i.length,p=[],f=[];a<l;){if(-1==(n=i.indexOf(T,a))||-1==(o=i.indexOf(P,n+E))){a!==l&&p.push(m(i.substring(a)));break}a!==n&&p.push(m(i.substring(a,n))),s=i.substring(n+E,o),c.push(s),u.push(v(s,y)),a=o+A,f.push(p.length),p.push("")}if(t&&1<p.length)throw rn("noconcat","Error while interpolating: {0}\nStrict Contextual Escaping disallows interpolations that concatenate multiple expressions when a trusted value is required.  See http://docs.angularjs.org/api/ng.$sce",i);if(!e||c.length){var g=function(e){for(var t=0,n=c.length;t<n;t++){if(r&&x(e[t]))return;p[f[t]]=e[t]}return p.join("")},h=function(e){return t?S.getTrusted(t,e):S.valueOf(e)},d=function(e){if(null==e)return"";switch(typeof e){case"string":break;case"number":e=""+e;break;default:e=j(e)}return e};return D(function(e){var t=0,n=c.length,r=new Array(n);try{for(;t<n;t++)r[t]=u[t](e);return g(r)}catch(e){var o=rn("interr","Can't interpolate: {0}\n{1}",i,e.toString());C(o)}},{exp:i,expressions:c,$$watchDelegate:function(r,o,e){var i;return r.$watchGroup(u,function(e,t){var n=g(e);ue(o)&&o.call(this,n,e!==t?i:n,r),i=n},e)}})}function m(e){return e.replace(b,T).replace(M,P)}function y(e){try{return e=h(e),r&&!z(e)?e:d(e)}catch(e){var t=rn("interr","Can't interpolate: {0}\n{1}",i,e.toString());C(t)}}}return t.startSymbol=function(){return T},t.endSymbol=function(){return P},t}]}function sn(){this.$get=["$rootScope","$window","$q","$$q",function(l,p,f,g){var h={};function e(e,t,n,r){var o=p.setInterval,i=p.clearInterval,s=0,a=z(r)&&!r,c=(a?g:f).defer(),u=c.promise;return n=z(n)?n:0,u.then(null,null,e),u.$$intervalId=o(function(){c.notify(s++),0<n&&n<=s&&(c.resolve(s),i(u.$$intervalId),delete h[u.$$intervalId]),a||l.$apply()},t),h[u.$$intervalId]=c,u}return e.cancel=function(e){return!!(e&&e.$$intervalId in h)&&(h[e.$$intervalId].reject("canceled"),p.clearInterval(e.$$intervalId),delete h[e.$$intervalId],!0)},e}]}function an(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"¤",posSuf:"",negPre:"(¤",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),SHORTMONTH:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),DAY:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),SHORTDAY:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a",short:"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(e){return 1===e?"one":"other"}}}}var cn=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,un={http:80,https:443,ftp:21},ln=C("$location");function pn(e){for(var t=e.split("/"),n=t.length;n--;)t[n]=Y(t[n]);return t.join("/")}function fn(e,t){var n=ur(e);t.$$protocol=n.protocol,t.$$host=n.hostname,t.$$port=g(n.port)||un[n.protocol]||null}function gn(e,t){var n="/"!==e.charAt(0);n&&(e="/"+e);var r=ur(e);t.$$path=decodeURIComponent(n&&"/"===r.pathname.charAt(0)?r.pathname.substring(1):r.pathname),t.$$search=k(r.search),t.$$hash=decodeURIComponent(r.hash),t.$$path&&"/"!=t.$$path.charAt(0)&&(t.$$path="/"+t.$$path)}function hn(e,t){if(0===t.indexOf(e))return t.substr(e.length)}function dn(e){var t=e.indexOf("#");return-1==t?e:e.substr(0,t)}function mn(e){return e.substr(0,dn(e).lastIndexOf("/")+1)}function yn(i,s){this.$$html5=!0,s=s||"";var a=mn(i);fn(i,this),this.$$parse=function(e){var t=hn(a,e);if(!ae(t))throw ln("ipthprfx",'Invalid url "{0}", missing path prefix "{1}".',e,a);gn(t,this),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var e=H(this.$$search),t=this.$$hash?"#"+Y(this.$$hash):"";this.$$url=pn(this.$$path)+(e?"?"+e:"")+t,this.$$absUrl=a+this.$$url.substr(1)},this.$$parseLinkUrl=function(e,t){return t&&"#"===t[0]?(this.hash(t.slice(1)),!0):((n=hn(i,e))!==re?o=(n=hn(s,r=n))!==re?a+(hn("/",n)||n):i+r:(n=hn(a,e))!==re?o=a+n:a==e+"/"&&(o=a),o&&this.$$parse(o),!!o);var n,r,o}}function vn(r,o){var i=mn(r);fn(r,this),this.$$parse=function(e){var t=hn(r,e)||hn(i,e),n="#"==t.charAt(0)?hn(o,t):this.$$html5?t:"";if(!ae(n))throw ln("ihshprfx",'Invalid url "{0}", missing hash prefix "{1}".',e,o);gn(n,this),this.$$path=function(e,t,n){var r,o=/^\/[A-Z]:(\/.*)/;0===t.indexOf(n)&&(t=t.replace(n,""));if(o.exec(t))return e;return(r=o.exec(e))?r[1]:e}(this.$$path,n,r),this.$$compose()},this.$$compose=function(){var e=H(this.$$search),t=this.$$hash?"#"+Y(this.$$hash):"";this.$$url=pn(this.$$path)+(e?"?"+e:"")+t,this.$$absUrl=r+(this.$$url?o+this.$$url:"")},this.$$parseLinkUrl=function(e,t){return dn(r)==dn(e)&&(this.$$parse(e),!0)}}function Cn(o,i){this.$$html5=!0,vn.apply(this,arguments);var s=mn(o);this.$$parseLinkUrl=function(e,t){return t&&"#"===t[0]?(this.hash(t.slice(1)),!0):(o==dn(e)?n=e:(r=hn(s,e))?n=o+i+r:s===e+"/"&&(n=s),n&&this.$$parse(n),!!n);var n,r},this.$$compose=function(){var e=H(this.$$search),t=this.$$hash?"#"+Y(this.$$hash):"";this.$$url=pn(this.$$path)+(e?"?"+e:"")+t,this.$$absUrl=o+i+this.$$url}}var Sn={$$html5:!1,$$replace:!1,absUrl:En("$$absUrl"),url:function(e){if(x(e))return this.$$url;var t=cn.exec(e);return!t[1]&&""!==e||this.path(decodeURIComponent(t[1])),(t[2]||t[1]||""===e)&&this.search(t[3]||""),this.hash(t[5]||""),this},protocol:En("$$protocol"),host:En("$$host"),port:En("$$port"),path:An("$$path",function(e){return"/"==(e=null!==e?e.toString():"").charAt(0)?e:"/"+e}),search:function(n,e){switch(arguments.length){case 0:return this.$$search;case 1:if(ae(n)||A(n))n=n.toString(),this.$$search=k(n);else{if(!se(n))throw ln("isrcharg","The first argument of the `$location#search()` call must be a string or an object.");ie(n=L(n,{}),function(e,t){null==e&&delete n[t]}),this.$$search=n}break;default:x(e)||null===e?delete this.$$search[n]:this.$$search[n]=e}return this.$$compose(),this},hash:An("$$hash",function(e){return null!==e?e.toString():""}),replace:function(){return this.$$replace=!0,this}};function En(e){return function(){return this[e]}}function An(t,n){return function(e){return x(e)?this[t]:(this[t]=n(e),this.$$compose(),this)}}function bn(){var g="",h={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(e){return z(e)?(g=e,this):g},this.html5Mode=function(e){return T(e)?(h.enabled=e,this):se(e)?(T(e.enabled)&&(h.enabled=e.enabled),T(e.requireBase)&&(h.requireBase=e.requireBase),T(e.rewriteLinks)&&(h.rewriteLinks=e.rewriteLinks),this):h},this.$get=["$rootScope","$browser","$sniffer","$rootElement",function(s,a,e,o){var c,t,n,r=a.baseHref(),i=a.url();if(h.enabled){if(!r&&h.requireBase)throw ln("nobase","$location in HTML5 mode requires a <base> tag to be present!");n=function(e){return e.substring(0,e.indexOf("/",e.indexOf("//")+2))}(i)+(r||"/"),t=e.history?yn:Cn}else n=dn(i),t=vn;(c=new t(n,"#"+g)).$$parseLinkUrl(i,i),c.$$state=a.state();var u=/^\s*(javascript|mailto):/i;function l(e,t,n){var r=c.url(),o=c.$$state;try{a.url(e,t,n),c.$$state=a.state()}catch(e){throw c.url(r),c.$$state=o,e}}o.on("click",function(e){if(h.rewriteLinks&&!e.ctrlKey&&!e.metaKey&&2!=e.which){for(var t=oe(e.target);"a"!==fe(t[0]);)if(t[0]===o[0]||!(t=t.parent())[0])return;var n=t.prop("href"),r=t.attr("href")||t.attr("xlink:href");se(n)&&"[object SVGAnimatedString]"===n.toString()&&(n=ur(n.animVal).href),u.test(n)||!n||t.attr("target")||e.isDefaultPrevented()||c.$$parseLinkUrl(n,r)&&(e.preventDefault(),c.absUrl()!=a.url()&&(s.$apply(),d.angular["ff-684208-preventDefault"]=!0))}}),c.absUrl()!=i&&a.url(c.absUrl(),!0);var p=!0;return a.onUrlChange(function(r,o){s.$evalAsync(function(){var e,t=c.absUrl(),n=c.$$state;c.$$parse(r),c.$$state=o,e=s.$broadcast("$locationChangeStart",r,t,o,n).defaultPrevented,c.absUrl()===r&&(e?(c.$$parse(t),l(t,!1,c.$$state=n)):(p=!1,f(t,n)))}),s.$$phase||s.$digest()}),s.$watch(function(){var n=a.url(),r=a.state(),o=c.$$replace,i=n!==c.absUrl()||c.$$html5&&e.history&&r!==c.$$state;(p||i)&&(p=!1,s.$evalAsync(function(){var e=c.absUrl(),t=s.$broadcast("$locationChangeStart",e,n,c.$$state,r).defaultPrevented;c.absUrl()===e&&(t?(c.$$parse(n),c.$$state=r):(i&&l(e,o,r===c.$$state?null:c.$$state),f(n,r)))})),c.$$replace=!1}),c;function f(e,t){s.$broadcast("$locationChangeSuccess",c.absUrl(),e,c.$$state,t)}}]}function Mn(){var n=!0,r=this;this.debugEnabled=function(e){return z(e)?(n=e,this):n},this.$get=["$window",function(o){return{log:t("log"),info:t("info"),warn:t("warn"),error:t("error"),debug:(e=t("debug"),function(){n&&e.apply(r,arguments)})};var e;function t(e){var n=o.console||{},r=n[e]||n.log||w,t=!1;try{t=!!r.apply}catch(e){}return t?function(){var t=[];return ie(arguments,function(e){t.push(function(e){return e instanceof Error&&(e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}(e))}),r.apply(n,t)}:function(e,t){r(e,null==t?"":t)}}}]}ie([Cn,vn,yn],function(t){t.prototype=Object.create(Sn),t.prototype.state=function(e){if(!arguments.length)return this.$$state;if(t!==yn||!this.$$html5)throw ln("nostate","History API state support is available only in HTML5 mode and only in browsers supporting HTML5 History API");return this.$$state=x(e)?null:e,this}});var Tn=C("$parse");function Pn(e,t){if("__defineGetter__"===e||"__defineSetter__"===e||"__lookupGetter__"===e||"__lookupSetter__"===e||"__proto__"===e)throw Tn("isecfld","Attempting to access a disallowed field in Angular expressions! Expression: {0}",t);return e}function In(e,t){if(e){if(e.constructor===e)throw Tn("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",t);if(e.window===e)throw Tn("isecwindow","Referencing the Window in Angular expressions is disallowed! Expression: {0}",t);if(e.children&&(e.nodeName||e.prop&&e.attr&&e.find))throw Tn("isecdom","Referencing DOM nodes in Angular expressions is disallowed! Expression: {0}",t);if(e===Object)throw Tn("isecobj","Referencing Object in Angular expressions is disallowed! Expression: {0}",t)}return e}var Nn=Function.prototype.call,Ln=Function.prototype.apply,_n=Function.prototype.bind;var xn=Pe();ie({null:function(){return null},true:function(){return!0},false:function(){return!1},undefined:function(){}},function(e,t){e.constant=e.literal=e.sharedGetter=!0,xn[t]=e}),xn.this=function(e){return e},xn.this.sharedGetter=!0;var Dn=D(Pe(),{"+":function(e,t,n,r){return n=n(e,t),r=r(e,t),z(n)?z(r)?n+r:n:z(r)?r:re},"-":function(e,t,n,r){return n=n(e,t),r=r(e,t),(z(n)?n:0)-(z(r)?r:0)},"*":function(e,t,n,r){return n(e,t)*r(e,t)},"/":function(e,t,n,r){return n(e,t)/r(e,t)},"%":function(e,t,n,r){return n(e,t)%r(e,t)},"===":function(e,t,n,r){return n(e,t)===r(e,t)},"!==":function(e,t,n,r){return n(e,t)!==r(e,t)},"==":function(e,t,n,r){return n(e,t)==r(e,t)},"!=":function(e,t,n,r){return n(e,t)!=r(e,t)},"<":function(e,t,n,r){return n(e,t)<r(e,t)},">":function(e,t,n,r){return n(e,t)>r(e,t)},"<=":function(e,t,n,r){return n(e,t)<=r(e,t)},">=":function(e,t,n,r){return n(e,t)>=r(e,t)},"&&":function(e,t,n,r){return n(e,t)&&r(e,t)},"||":function(e,t,n,r){return n(e,t)||r(e,t)},"!":function(e,t,n){return!n(e,t)},"=":!0,"|":!0}),Rn={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},On=function(e){this.options=e};function wn(e){return e.constant}On.prototype={constructor:On,lex:function(e){for(this.text=e,this.index=0,this.tokens=[];this.index<this.text.length;){var t=this.text.charAt(this.index);if('"'===t||"'"===t)this.readString(t);else if(this.isNumber(t)||"."===t&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(t))this.readIdent();else if(this.is(t,"(){}[].,;:?"))this.tokens.push({index:this.index,text:t}),this.index++;else if(this.isWhitespace(t))this.index++;else{var n=t+this.peek(),r=n+this.peek(2),o=Dn[t],i=Dn[n],s=Dn[r];if(o||i||s){var a=s?r:i?n:t;this.tokens.push({index:this.index,text:a,operator:!0}),this.index+=a.length}else this.throwError("Unexpected next character ",this.index,this.index+1)}}return this.tokens},is:function(e,t){return-1!==t.indexOf(e)},peek:function(e){var t=e||1;return this.index+t<this.text.length&&this.text.charAt(this.index+t)},isNumber:function(e){return"0"<=e&&e<="9"&&"string"==typeof e},isWhitespace:function(e){return" "===e||"\r"===e||"\t"===e||"\n"===e||"\v"===e||" "===e},isIdent:function(e){return"a"<=e&&e<="z"||"A"<=e&&e<="Z"||"_"===e||"$"===e},isExpOperator:function(e){return"-"===e||"+"===e||this.isNumber(e)},throwError:function(e,t,n){n=n||this.index;var r=z(t)?"s "+t+"-"+this.index+" ["+this.text.substring(t,n)+"]":" "+n;throw Tn("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",e,r,this.text)},readNumber:function(){for(var e="",t=this.index;this.index<this.text.length;){var n=S(this.text.charAt(this.index));if("."==n||this.isNumber(n))e+=n;else{var r=this.peek();if("e"==n&&this.isExpOperator(r))e+=n;else if(this.isExpOperator(n)&&r&&this.isNumber(r)&&"e"==e.charAt(e.length-1))e+=n;else{if(!this.isExpOperator(n)||r&&this.isNumber(r)||"e"!=e.charAt(e.length-1))break;this.throwError("Invalid exponent")}}this.index++}this.tokens.push({index:t,text:e,constant:!0,value:Number(e)})},readIdent:function(){for(var e=this.index;this.index<this.text.length;){var t=this.text.charAt(this.index);if(!this.isIdent(t)&&!this.isNumber(t))break;this.index++}this.tokens.push({index:e,text:this.text.slice(e,this.index),identifier:!0})},readString:function(e){var t=this.index;this.index++;for(var n="",r=e,o=!1;this.index<this.text.length;){var i=this.text.charAt(this.index);if(r+=i,o){if("u"===i){var s=this.text.substring(this.index+1,this.index+5);s.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+s+"]"),this.index+=4,n+=String.fromCharCode(parseInt(s,16))}else{n+=Rn[i]||i}o=!1}else if("\\"===i)o=!0;else{if(i===e)return this.index++,void this.tokens.push({index:t,text:r,constant:!0,value:n});n+=i}this.index++}this.throwError("Unterminated quote",t)}};var Fn=function(e,t,n){this.lexer=e,this.$filter=t,this.options=n};function Bn(e,t,n,r){In(e,r);for(var o,i=t.split(".");1<i.length;0){var s=In(e[o=Pn(i.shift(),r)],r);s||(s={},e[o]=s),e=s}return In(e[o=Pn(i.shift(),r)],r),e[o]=n}Fn.ZERO=D(function(){return 0},{sharedGetter:!0,constant:!0}),Fn.prototype={constructor:Fn,parse:function(e){this.text=e,this.tokens=this.lexer.lex(e);var t=this.statements();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),t.literal=!!t.literal,t.constant=!!t.constant,t},primary:function(){var e,t,n;for(this.expect("(")?(e=this.filterChain(),this.consume(")")):this.expect("[")?e=this.arrayDeclaration():this.expect("{")?e=this.object():this.peek().identifier?e=this.identifier():this.peek().constant?e=this.constant():this.throwError("not a primary expression",this.peek());t=this.expect("(","[",".");)"("===t.text?(e=this.functionCall(e,n),n=null):"["===t.text?(n=e,e=this.objectIndex(e)):"."===t.text?(n=e,e=this.fieldAccess(e)):this.throwError("IMPOSSIBLE");return e},throwError:function(e,t){throw Tn("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",t.text,e,t.index+1,this.text,this.text.substring(t.index))},peekToken:function(){if(0===this.tokens.length)throw Tn("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e,t,n,r){return this.peekAhead(0,e,t,n,r)},peekAhead:function(e,t,n,r,o){if(this.tokens.length>e){var i=this.tokens[e],s=i.text;if(s===t||s===n||s===r||s===o||!t&&!n&&!r&&!o)return i}return!1},expect:function(e,t,n,r){var o=this.peek(e,t,n,r);return!!o&&(this.tokens.shift(),o)},consume:function(e){if(0===this.tokens.length)throw Tn("ueoe","Unexpected end of expression: {0}",this.text);var t=this.expect(e);return t||this.throwError("is unexpected, expecting ["+e+"]",this.peek()),t},unaryFn:function(e,n){var r=Dn[e];return D(function(e,t){return r(e,t,n)},{constant:n.constant,inputs:[n]})},binaryFn:function(n,e,r,t){var o=Dn[e];return D(function(e,t){return o(e,t,n,r)},{constant:n.constant&&r.constant,inputs:!t&&[n,r]})},identifier:function(){for(var e=this.consume().text;this.peek(".")&&this.peekAhead(1).identifier&&!this.peekAhead(2,"(");)e+=this.consume().text+this.consume().text;return xn[e]||Gn(e,this.options,this.text)},constant:function(){var e=this.consume().value;return D(function(){return e},{constant:!0,literal:!0})},statements:function(){for(var i=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&i.push(this.filterChain()),!this.expect(";"))return 1===i.length?i[0]:function(e,t){for(var n,r=0,o=i.length;r<o;r++)n=i[r](e,t);return n}},filterChain:function(){for(var e=this.expression();this.expect("|");)e=this.filter(e);return e},filter:function(o){var i,s,a=this.$filter(this.consume().text);if(this.peek(":"))for(i=[],s=[];this.expect(":");)i.push(this.expression());var e=[o].concat(i||[]);return D(function(e,t){var n=o(e,t);if(s){s[0]=n;for(var r=i.length;r--;)s[r+1]=i[r](e,t);return a.apply(re,s)}return a(n)},{constant:!a.$stateful&&e.every(wn),inputs:!a.$stateful&&e})},expression:function(){return this.assignment()},assignment:function(){var n,e,r=this.ternary();return(e=this.expect("="))?(r.assign||this.throwError("implies assignment but ["+this.text.substring(0,e.index)+"] can not be assigned to",e),n=this.ternary(),D(function(e,t){return r.assign(e,n(e,t),t)},{inputs:[r,n]})):r},ternary:function(){var n,r=this.logicalOR();if(this.expect("?")&&(n=this.assignment(),this.consume(":"))){var o=this.assignment();return D(function(e,t){return r(e,t)?n(e,t):o(e,t)},{constant:r.constant&&n.constant&&o.constant})}return r},logicalOR:function(){for(var e,t=this.logicalAND();e=this.expect("||");)t=this.binaryFn(t,e.text,this.logicalAND(),!0);return t},logicalAND:function(){var e,t=this.equality();return(e=this.expect("&&"))&&(t=this.binaryFn(t,e.text,this.logicalAND(),!0)),t},equality:function(){var e,t=this.relational();return(e=this.expect("==","!=","===","!=="))&&(t=this.binaryFn(t,e.text,this.equality())),t},relational:function(){var e,t=this.additive();return(e=this.expect("<",">","<=",">="))&&(t=this.binaryFn(t,e.text,this.relational())),t},additive:function(){for(var e,t=this.multiplicative();e=this.expect("+","-");)t=this.binaryFn(t,e.text,this.multiplicative());return t},multiplicative:function(){for(var e,t=this.unary();e=this.expect("*","/","%");)t=this.binaryFn(t,e.text,this.unary());return t},unary:function(){var e;return this.expect("+")?this.primary():(e=this.expect("-"))?this.binaryFn(Fn.ZERO,e.text,this.unary()):(e=this.expect("!"))?this.unaryFn(e.text,this.unary()):this.primary()},fieldAccess:function(o){var i=this.text,s=this.consume().text,r=Gn(s,this.options,i);return D(function(e,t,n){return r(n||o(e,t))},{assign:function(e,t,n){var r=o(e,n);return r||o.assign(e,r={}),Bn(r,s,t,i)}})},objectIndex:function(i){var s=this.text,a=this.expression();return this.consume("]"),D(function(e,t){var n=i(e,t),r=a(e,t);return Pn(r,s),n?In(n[r],s):re},{assign:function(e,t,n){var r=Pn(a(e,n),s),o=In(i(e,n),s);return o||i.assign(e,o={}),o[r]=t}})},functionCall:function(i,s){var a=[];if(")"!==this.peekToken().text)for(;a.push(this.expression()),this.expect(","););this.consume(")");var c=this.text,u=a.length?[]:null;return function(e,t){var n=s?s(e,t):e,r=i(e,t,n)||w;if(u)for(var o=a.length;o--;)u[o]=In(a[o](e,t),c);return In(n,c),function(e,t){if(e){if(e.constructor===e)throw Tn("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",t);if(e===Nn||e===Ln||e===_n)throw Tn("isecff","Referencing call, apply or bind in Angular expressions is disallowed! Expression: {0}",t)}}(r,c),In(r.apply?r.apply(n,u):r(u[0],u[1],u[2],u[3],u[4]),c)}},arrayDeclaration:function(){var i=[];if("]"!==this.peekToken().text)do{if(this.peek("]"))break;i.push(this.expression())}while(this.expect(","));return this.consume("]"),D(function(e,t){for(var n=[],r=0,o=i.length;r<o;r++)n.push(i[r](e,t));return n},{literal:!0,constant:i.every(wn),inputs:i})},object:function(){var i=[],s=[];if("}"!==this.peekToken().text)do{if(this.peek("}"))break;var e=this.consume();e.constant?i.push(e.value):e.identifier?i.push(e.text):this.throwError("invalid key",e),this.consume(":"),s.push(this.expression())}while(this.expect(","));return this.consume("}"),D(function(e,t){for(var n={},r=0,o=s.length;r<o;r++)n[i[r]]=s[r](e,t);return n},{literal:!0,constant:s.every(wn),inputs:s})}};var $n=Pe(),Wn=Pe();function Un(e){return"constructor"==e}function jn(r,o,i,s,a,t,e){Pn(r,t),Pn(o,t),Pn(i,t),Pn(s,t),Pn(a,t);function n(e){return In(e,t)}var c=e||Un(r)?n:F,u=e||Un(o)?n:F,l=e||Un(i)?n:F,p=e||Un(s)?n:F,f=e||Un(a)?n:F;return function(e,t){var n=t&&t.hasOwnProperty(r)?t:e;return null==n?n:(n=c(n[r]),o?null==n?re:(n=u(n[o]),i?null==n?re:(n=l(n[i]),s?null==n?re:(n=p(n[s]),a?null==n?re:n=f(n[a]):n):n):n):n)}}function Gn(n,e,o){var i=e.expensiveChecks,t=i?Wn:$n,r=t[n];if(r)return r;var s=n.split("."),a=s.length;if(e.csp)r=a<6?jn(s[0],s[1],s[2],s[3],s[4],o,i):function(e,t){for(var n,r=0;n=jn(s[r++],s[r++],s[r++],s[r++],s[r++],o,i)(e,t),t=re,e=n,r<a;);return n};else{var c="";i&&(c+="s = eso(s, fe);\nl = eso(l, fe);\n");var u=i;ie(s,function(e,t){Pn(e,o);var n=(t?"s":'((l&&l.hasOwnProperty("'+e+'"))?l:s)')+"."+e;(i||Un(e))&&(n="eso("+n+", fe)",u=!0),c+="if(s == null) return undefined;\ns="+n+";\n"}),c+="return s;";var l=new Function("s","l","eso","fe",c);l.toString=v(c),u&&(l=function(n,r){return function(e,t){return n(e,t,In,r)}}(l,o)),r=l}return r.sharedGetter=!0,r.assign=function(e,t){return Bn(e,n,t,n)},t[n]=r}var Vn=Object.prototype.valueOf;function kn(e){return ue(e.valueOf)?e.valueOf():Vn.call(e)}function Hn(){var v=Pe(),C=Pe();this.$get=["$filter","$sniffer",function(u,e){var l={csp:e.csp,expensiveChecks:!1},p={csp:e.csp,expensiveChecks:!0};return function(e,t,n){var r,o,i;switch(typeof e){case"string":i=e=e.trim();var s=n?C:v;if(!(r=s[i])){":"===e.charAt(0)&&":"===e.charAt(1)&&(o=!0,e=e.substring(2));var a=n?p:l,c=new On(a);(r=new Fn(c,u,a).parse(e)).constant?r.$$watchDelegate=m:o?(r=function(n){var e=n;return n.sharedGetter&&((e=function(e,t){return n(e,t)}).literal=n.literal,e.constant=n.constant,e.assign=n.assign),e}(r)).$$watchDelegate=r.literal?d:h:r.inputs&&(r.$$watchDelegate=g),s[i]=r}return y(r,t);case"function":return y(e,t);default:return y(w,t)}};function f(e,t){return null==e||null==t?e===t:("object"!=typeof e||"object"!=typeof(e=kn(e)))&&(e===t||e!=e&&t!=t)}function g(e,t,n,i){var s,a=i.$$inputs||(i.$$inputs=function e(t,n){for(var r=0,o=t.length;r<o;r++){var i=t[r];i.constant||(i.inputs?e(i.inputs,n):-1===n.indexOf(i)&&n.push(i))}return n}(i.inputs,[]));if(1===a.length){var r=f;return a=a[0],e.$watch(function(e){var t=a(e);return f(t,r)||(s=i(e),r=t&&kn(t)),s},t,n)}for(var c=[],o=0,u=a.length;o<u;o++)c[o]=f;return e.$watch(function(e){for(var t=!1,n=0,r=a.length;n<r;n++){var o=a[n](e);(t=t||!f(o,c[n]))&&(c[n]=o&&kn(o))}return t&&(s=i(e)),s},t,n)}function h(e,r,t,n){var o,i;return o=e.$watch(function(e){return n(e)},function(e,t,n){i=e,ue(r)&&r.apply(this,arguments),z(e)&&n.$$postDigest(function(){z(i)&&o()})},t)}function d(e,r,t,n){var o,i;return o=e.$watch(function(e){return n(e)},function(e,t,n){i=e,ue(r)&&r.call(this,e,t,n),s(e)&&n.$$postDigest(function(){s(i)&&o()})},t);function s(e){var t=!0;return ie(e,function(e){z(e)||(t=!1)}),t}}function m(e,r,t,n){var o;return o=e.$watch(function(e){return n(e)},function(e,t,n){ue(r)&&r.apply(this,arguments),o()},t)}function y(o,i){if(!i)return o;var e=o.$$watchDelegate,t=e!==d&&e!==h?function(e,t){var n=o(e,t);return i(n,e,t)}:function(e,t){var n=o(e,t),r=i(n,e,t);return z(n)?r:n};return o.$$watchDelegate&&o.$$watchDelegate!==g?t.$$watchDelegate=o.$$watchDelegate:i.$stateful||(t.$$watchDelegate=g,t.inputs=[o]),t}}]}function qn(){this.$get=["$rootScope","$exceptionHandler",function(t,e){return zn(function(e){t.$evalAsync(e)},e)}]}function Jn(){this.$get=["$browser","$exceptionHandler",function(t,e){return zn(function(e){t.defer(e)},e)}]}function zn(t,s){var n=C("$q",TypeError);function e(){this.$$state={status:0}}function r(t,n){return function(e){n.call(t,e)}}function o(e){!e.processScheduled&&e.pending&&(e.processScheduled=!0,t(function(){!function(e){var t,n,r;r=e.pending,e.processScheduled=!1,e.pending=re;for(var o=0,i=r.length;o<i;++o){n=r[o][0],t=r[o][e.status];try{ue(t)?n.resolve(t(e.value)):1===e.status?n.resolve(e.value):n.reject(e.value)}catch(e){n.reject(e),s(e)}}}(e)}))}function i(){this.promise=new e,this.resolve=r(this,this.resolve),this.reject=r(this,this.reject),this.notify=r(this,this.notify)}e.prototype={then:function(e,t,n){var r=new i;return this.$$state.pending=this.$$state.pending||[],this.$$state.pending.push([r,e,t,n]),0<this.$$state.status&&o(this.$$state),r.promise},catch:function(e){return this.then(null,e)},finally:function(t,e){return this.then(function(e){return u(e,!0,t)},function(e){return u(e,!1,t)},e)}},i.prototype={resolve:function(e){this.promise.$$state.status||(e===this.promise?this.$$reject(n("qcycle","Expected promise to be resolved with value other than itself '{0}'",e)):this.$$resolve(e))},$$resolve:function(e){var t,n;n=function(n,e,t){var r=!1;function o(t){return function(e){r||(r=!0,t.call(n,e))}}return[o(e),o(t)]}(this,this.$$resolve,this.$$reject);try{(se(e)||ue(e))&&(t=e&&e.then),ue(t)?(this.promise.$$state.status=-1,t.call(e,n[0],n[1],this.notify)):(this.promise.$$state.value=e,this.promise.$$state.status=1,o(this.promise.$$state))}catch(e){n[1](e),s(e)}},reject:function(e){this.promise.$$state.status||this.$$reject(e)},$$reject:function(e){this.promise.$$state.value=e,this.promise.$$state.status=2,o(this.promise.$$state)},notify:function(o){var i=this.promise.$$state.pending;this.promise.$$state.status<=0&&i&&i.length&&t(function(){for(var e,t,n=0,r=i.length;n<r;n++){t=i[n][0],e=i[n][3];try{t.notify(ue(e)?e(o):o)}catch(e){s(e)}}})}};function a(e,t){var n=new i;return t?n.resolve(e):n.reject(e),n.promise}function c(e,t,n,r){var o=new i;return o.resolve(e),o.promise.then(t,n,r)}var u=function(e,t,n){var r=null;try{ue(n)&&(r=n())}catch(e){return a(e,!1)}return I(r)?r.then(function(){return a(e,t)},function(e){return a(e,!1)}):a(e,t)};function l(e){if(!ue(e))throw n("norslvr","Expected resolverFn, got '{0}'",e);if(!(this instanceof l))return new l(e);var t=new i;return e(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}return l.defer=function(){return new i},l.reject=function(e){var t=new i;return t.reject(e),t.promise},l.when=c,l.all=function(e){var n=new i,r=0,o=ce(e)?[]:{};return ie(e,function(e,t){r++,c(e).then(function(e){o.hasOwnProperty(t)||(o[t]=e,--r||n.resolve(o))},function(e){o.hasOwnProperty(t)||n.reject(e)})}),0===r&&n.resolve(o),n.promise},l}function Yn(){this.$get=["$window","$timeout",function(e,n){var r=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame,o=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelRequestAnimationFrame,t=!!r,i=t?function(e){var t=r(e);return function(){o(t)}}:function(e){var t=n(e,16.66,!1);return function(){n.cancel(t)}};return i.supported=t,i}]}function Xn(){var A=10,b=C("$rootScope"),M=null,T=null;this.digestTtl=function(e){return arguments.length&&(A=e),A},this.$get=["$injector","$exceptionHandler","$parse","$browser",function(e,f,h,g){function r(){this.$id=o(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,(this.$root=this).$$destroyed=!1,this.$$listeners={},this.$$listenerCount={},this.$$isolateBindings=null}r.prototype={constructor:r,$new:function(e,t){var n;return t=t||this,e?(n=new r).$root=this.$root:(this.$$ChildScope||(this.$$ChildScope=function(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$id=o(),this.$$ChildScope=null},this.$$ChildScope.prototype=this),n=new this.$$ChildScope),n.$parent=t,n.$$prevSibling=t.$$childTail,t.$$childHead?(t.$$childTail.$$nextSibling=n,t.$$childTail=n):t.$$childHead=t.$$childTail=n,!e&&t==this||n.$on("$destroy",function(){n.$$destroyed=!0}),n},$watch:function(e,t,n){var r=h(e);if(r.$$watchDelegate)return r.$$watchDelegate(this,t,n,r);var o=this.$$watchers,i={fn:t,last:S,get:r,exp:e,eq:!!n};return M=null,ue(t)||(i.fn=w),(o=o||(this.$$watchers=[])).unshift(i),function(){ge(o,i),M=null}},$watchGroup:function(e,r){var o=new Array(e.length),i=new Array(e.length),s=[],a=this,c=!1,t=!0;if(!e.length){var n=!0;return a.$evalAsync(function(){n&&r(i,i,a)}),function(){n=!1}}if(1===e.length)return this.$watch(e[0],function(e,t,n){i[0]=e,o[0]=t,r(i,e===t?i:o,n)});function u(){c=!1,t?(t=!1,r(i,i,a)):r(i,o,a)}return ie(e,function(e,n){var t=a.$watch(e,function(e,t){i[n]=e,o[n]=t,c||(c=!0,a.$evalAsync(u))});s.push(t)}),function(){for(;s.length;)s.shift()()}},$watchCollection:function(e,n){g.$stateful=!0;var s,a,r,o=this,i=1<n.length,c=0,t=h(e,g),u=[],l={},p=!0,f=0;function g(e){var t,n,r,o;if(!x(s=e)){if(se(s))if(O(s)){a!==u&&(f=(a=u).length=0,c++),t=s.length,f!==t&&(c++,a.length=f=t);for(var i=0;i<t;i++)o=a[i],r=s[i],o!=o&&r!=r||o===r||(c++,a[i]=r)}else{for(n in a!==l&&(a=l={},f=0,c++),t=0,s)s.hasOwnProperty(n)&&(t++,r=s[n],o=a[n],n in a?o!=o&&r!=r||o===r||(c++,a[n]=r):(f++,a[n]=r,c++));if(t<f)for(n in c++,a)s.hasOwnProperty(n)||(f--,delete a[n])}else a!==s&&(a=s,c++);return c}}return this.$watch(t,function(){if(p?(p=!1,n(s,s,o)):n(s,r,o),i)if(se(s))if(O(s)){r=new Array(s.length);for(var e=0;e<s.length;e++)r[e]=s[e]}else for(var t in r={},s)P.call(s,t)&&(r[t]=s[t]);else r=s})},$digest:function(){var e,t,n,r,o,i,s,a,c,u,l=A,p=[];v("$digest"),g.$$checkUrlChange(),this===d&&null!==T&&(g.defer.cancel(T),E()),M=null;do{for(i=!1,a=this;m.length;){try{(u=m.shift()).scope.$eval(u.expression)}catch(e){f(e)}M=null}e:do{if(r=a.$$watchers)for(o=r.length;o--;)try{if(e=r[o])if((t=e.get(a))===(n=e.last)||(e.eq?he(t,n):"number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n))){if(e===M){i=!1;break e}}else i=!0,(M=e).last=e.eq?L(t,null):t,e.fn(t,n===S?t:n,a),l<5&&(p[c=4-l]||(p[c]=[]),p[c].push({msg:ue(e.exp)?"fn: "+(e.exp.name||e.exp.toString()):e.exp,newVal:t,oldVal:n}))}catch(e){f(e)}if(!(s=a.$$childHead||a!==this&&a.$$nextSibling))for(;a!==this&&!(s=a.$$nextSibling);)a=a.$parent}while(a=s);if((i||m.length)&&!l--)throw C(),b("infdig","{0} $digest() iterations reached. Aborting!\nWatchers fired in the last 5 iterations: {1}",A,p)}while(i||m.length);for(C();y.length;)try{y.shift()()}catch(e){f(e)}},$destroy:function(){if(!this.$$destroyed){var e=this.$parent;if(this.$broadcast("$destroy"),this.$$destroyed=!0,this!==d){for(var t in this.$$listenerCount)i(this,this.$$listenerCount[t],t);e.$$childHead==this&&(e.$$childHead=this.$$nextSibling),e.$$childTail==this&&(e.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=w,this.$on=this.$watch=this.$watchGroup=function(){return w},this.$$listeners={},this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=this.$$watchers=null}}},$eval:function(e,t){return h(e)(this,t)},$evalAsync:function(e){d.$$phase||m.length||g.defer(function(){m.length&&d.$digest()}),m.push({scope:this,expression:e})},$$postDigest:function(e){y.push(e)},$apply:function(e){try{return v("$apply"),this.$eval(e)}catch(e){f(e)}finally{C();try{d.$digest()}catch(e){throw f(e),e}}},$applyAsync:function(e){var t=this;e&&n.push(function(){t.$eval(e)}),null===T&&(T=g.defer(function(){d.$apply(E)}))},$on:function(t,n){var r=this.$$listeners[t];r||(this.$$listeners[t]=r=[]),r.push(n);for(var e=this;e.$$listenerCount[t]||(e.$$listenerCount[t]=0),e.$$listenerCount[t]++,e=e.$parent;);var o=this;return function(){var e=r.indexOf(n);-1!==e&&(r[e]=null,i(o,1,t))}},$emit:function(e,t){var n,r,o,i=[],s=this,a=!1,c={name:e,targetScope:s,stopPropagation:function(){a=!0},preventDefault:function(){c.defaultPrevented=!0},defaultPrevented:!1},u=$([c],arguments,1);do{for(n=s.$$listeners[e]||i,c.currentScope=s,r=0,o=n.length;r<o;r++)if(n[r])try{n[r].apply(null,u)}catch(e){f(e)}else n.splice(r,1),r--,o--;if(a)return c.currentScope=null,c;s=s.$parent}while(s);return c.currentScope=null,c},$broadcast:function(e,t){var n=this,r=this,o={name:e,targetScope:this,preventDefault:function(){o.defaultPrevented=!0},defaultPrevented:!1};if(!this.$$listenerCount[e])return o;for(var i,s,a,c=$([o],arguments,1);n=r;){for(s=0,a=(i=(o.currentScope=n).$$listeners[e]||[]).length;s<a;s++)if(i[s])try{i[s].apply(null,c)}catch(e){f(e)}else i.splice(s,1),s--,a--;if(!(r=n.$$listenerCount[e]&&n.$$childHead||n!==this&&n.$$nextSibling))for(;n!==this&&!(r=n.$$nextSibling);)n=n.$parent}return o.currentScope=null,o}};var d=new r,m=d.$$asyncQueue=[],y=d.$$postDigestQueue=[],n=d.$$applyAsyncQueue=[];return d;function v(e){if(d.$$phase)throw b("inprog","{0} already in progress",d.$$phase);d.$$phase=e}function C(){d.$$phase=null}function i(e,t,n){for(;e.$$listenerCount[n]-=t,0===e.$$listenerCount[n]&&delete e.$$listenerCount[n],e=e.$parent;);}function S(){}function E(){for(;n.length;)try{n.shift()()}catch(e){f(e)}T=null}}]}function Kn(){var o=/^\s*(https?|ftp|mailto|tel|file):/,i=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(e){return z(e)?(o=e,this):o},this.imgSrcSanitizationWhitelist=function(e){return z(e)?(i=e,this):i},this.$get=function(){return function(e,t){var n,r=t?i:o;return""===(n=ur(e).href)||n.match(r)?e:"unsafe:"+n}}}var Qn=C("$sce"),Zn={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"};function er(e){var t=[];return z(e)&&ie(e,function(e){t.push(function(e){if("self"===e)return e;if(ae(e)){if(-1<e.indexOf("***"))throw Qn("iwcard","Illegal sequence *** in string matcher.  String: {0}",e);return e=c(e).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*"),new RegExp("^"+e+"$")}if(f(e))return new RegExp("^"+e.source+"$");throw Qn("imatcher",'Matchers may only be "self", string patterns or RegExp objects')}(e))}),t}function tr(){this.SCE_CONTEXTS=Zn;var s=["self"],a=[];this.resourceUrlWhitelist=function(e){return arguments.length&&(s=er(e)),s},this.resourceUrlBlacklist=function(e){return arguments.length&&(a=er(e)),a},this.$get=["$injector",function(e){var r=function(e){throw Qn("unsafe","Attempting to use an unsafe value in a safe context.")};function i(e,t){return"self"===e?lr(t):!!e.exec(t.href)}function t(e){function t(e){this.$$unwrapTrustedValue=function(){return e}}return e&&(t.prototype=new e),t.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},t.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},t}e.has("$sanitize")&&(r=e.get("$sanitize"));var n=t(),o={};return o[Zn.HTML]=t(n),o[Zn.CSS]=t(n),o[Zn.URL]=t(n),o[Zn.JS]=t(n),o[Zn.RESOURCE_URL]=t(o[Zn.URL]),{trustAs:function(e,t){var n=o.hasOwnProperty(e)?o[e]:null;if(!n)throw Qn("icontext","Attempted to trust a value in invalid context. Context: {0}; Value: {1}",e,t);if(null===t||t===re||""===t)return t;if("string"!=typeof t)throw Qn("itype","Attempted to trust a non-string value in a content requiring a string: Context: {0}",e);return new n(t)},getTrusted:function(e,t){if(null===t||t===re||""===t)return t;var n=o.hasOwnProperty(e)?o[e]:null;if(n&&t instanceof n)return t.$$unwrapTrustedValue();if(e===Zn.RESOURCE_URL){if(function(e){var t,n,r=ur(e.toString()),o=!1;for(t=0,n=s.length;t<n;t++)if(i(s[t],r)){o=!0;break}if(o)for(t=0,n=a.length;t<n;t++)if(i(a[t],r)){o=!1;break}return o}(t))return t;throw Qn("insecurl","Blocked loading resource from url not allowed by $sceDelegate policy.  URL: {0}",t.toString())}if(e===Zn.HTML)return r(t);throw Qn("unsafe","Attempting to use an unsafe value in a safe context.")},valueOf:function(e){return e instanceof n?e.$$unwrapTrustedValue():e}}}]}function nr(){var t=!0;this.enabled=function(e){return arguments.length&&(t=!!e),t},this.$get=["$parse","$sceDelegate",function(r,e){if(t&&q<8)throw Qn("iequirks","Strict Contextual Escaping does not support Internet Explorer version < 11 in quirks mode.  You can fix this by adding the text <!doctype html> to the top of your HTML document.  See http://docs.angularjs.org/api/ng.$sce for more information.");var o=_(Zn);o.isEnabled=function(){return t},o.trustAs=e.trustAs,o.getTrusted=e.getTrusted,o.valueOf=e.valueOf,t||(o.trustAs=o.getTrusted=function(e,t){return t},o.valueOf=F),o.parseAs=function(t,e){var n=r(e);return n.literal&&n.constant?n:r(e,function(e){return o.getTrusted(t,e)})};var i=o.parseAs,s=o.getTrusted,a=o.trustAs;return ie(Zn,function(t,e){var n=S(e);o[Ge("parse_as_"+n)]=function(e){return i(t,e)},o[Ge("get_trusted_"+n)]=function(e){return s(t,e)},o[Ge("trust_as_"+n)]=function(e){return a(t,e)}}),o}]}function rr(){this.$get=["$window","$document",function(e,t){var n,r,o={},i=g((/android (\d+)/.exec(S((e.navigator||{}).userAgent))||[])[1]),s=/Boxee/i.test((e.navigator||{}).userAgent),a=t[0]||{},c=/^(Moz|webkit|ms)(?=[A-Z])/,u=a.body&&a.body.style,l=!1,p=!1;if(u){for(var f in u)if(r=c.exec(f)){n=(n=r[0]).substr(0,1).toUpperCase()+n.substr(1);break}n=n||"WebkitOpacity"in u&&"webkit",l=!!("transition"in u||n+"Transition"in u),p=!!("animation"in u||n+"Animation"in u),!i||l&&p||(l=ae(a.body.style.webkitTransition),p=ae(a.body.style.webkitAnimation))}return{history:!(!e.history||!e.history.pushState||i<4||s),hasEvent:function(e){if("input"==e&&9==q)return!1;if(x(o[e])){var t=a.createElement("div");o[e]="on"+e in t}return o[e]},csp:B(),vendorPrefix:n,transitions:l,animations:p,android:i}}]}wt=C("$compile");function or(){this.$get=["$templateCache","$http","$q",function(i,s,a){function c(n,t){var r=c;r.totalPendingRequests++;var e=s.defaults&&s.defaults.transformResponse;ce(e)?e=e.filter(function(e){return e!==Yt}):e===Yt&&(e=null);var o={cache:i,transformResponse:e};return s.get(n,o).then(function(e){var t=e.data;return r.totalPendingRequests--,i.put(n,t),t},function(e){if(r.totalPendingRequests--,t)return a.reject(e);throw wt("tpload","Failed to load template: {0}",n)})}return c.totalPendingRequests=0,c}]}function ir(){this.$get=["$rootScope","$browser","$location",function(t,n,r){var e={findBindings:function(e,n,r){var t=e.getElementsByClassName("ng-binding"),o=[];return ie(t,function(t){var e=E.element(t).data("$binding");e&&ie(e,function(e){r?new RegExp("(^|\\s)"+c(n)+"(\\s|\\||$)").test(e)&&o.push(t):-1!=e.indexOf(n)&&o.push(t)})}),o},findModels:function(e,t,n){for(var r=["ng-","data-ng-","ng\\:"],o=0;o<r.length;++o){var i="["+r[o]+"model"+(n?"=":"*=")+'"'+t+'"]',s=e.querySelectorAll(i);if(s.length)return s}},getLocation:function(){return r.url()},setLocation:function(e){e!==r.url()&&(r.url(e),t.$digest())},whenStable:function(e){n.notifyWhenNoOutstandingRequests(e)}};return e}]}function sr(){this.$get=["$rootScope","$browser","$q","$$q","$exceptionHandler",function(a,c,u,l,p){var f={};function e(e,t,n){var r,o=z(n)&&!n,i=(o?l:u).defer(),s=i.promise;return r=c.defer(function(){try{i.resolve(e())}catch(e){i.reject(e),p(e)}finally{delete f[s.$$timeoutId]}o||a.$apply()},t),s.$$timeoutId=r,f[r]=i,s}return e.cancel=function(e){return!!(e&&e.$$timeoutId in f)&&(f[e.$$timeoutId].reject("canceled"),delete f[e.$$timeoutId],c.defer.cancel(e.$$timeoutId))},e}]}var ar=ne.createElement("a"),cr=ur(d.location.href);function ur(e){var t=e;return q&&(ar.setAttribute("href",t),t=ar.href),ar.setAttribute("href",t),{href:ar.href,protocol:ar.protocol?ar.protocol.replace(/:$/,""):"",host:ar.host,search:ar.search?ar.search.replace(/^\?/,""):"",hash:ar.hash?ar.hash.replace(/^#/,""):"",hostname:ar.hostname,port:ar.port,pathname:"/"===ar.pathname.charAt(0)?ar.pathname:"/"+ar.pathname}}function lr(e){var t=ae(e)?ur(e):e;return t.protocol===cr.protocol&&t.host===cr.host}function pr(){this.$get=v(d)}function fr(r){var o="Filter";function i(e,t){if(se(e)){var n={};return ie(e,function(e,t){n[t]=i(t,e)}),n}return r.factory(e+o,t)}this.register=i,this.$get=["$injector",function(t){return function(e){return t.get(e+o)}}],i("currency",hr),i("date",Pr),i("filter",gr),i("json",Ir),i("limitTo",_r),i("lowercase",Nr),i("number",dr),i("orderBy",xr),i("uppercase",Lr)}function gr(){return function(e,n,o){if(!ce(e))return e;var t=typeof o,r=[];r.check=function(e,t){for(var n=0;n<r.length;n++)if(!r[n](e,t))return!1;return!0},"function"!=t&&(o="boolean"==t&&o?function(e,t){return E.equals(e,t)}:function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){for(var n in e)if("$"!==n.charAt(0)&&P.call(e,n)&&o(e[n],t[n]))return!0;return!1}return t=(""+t).toLowerCase(),-1<(""+e).toLowerCase().indexOf(t)});var i=function(e,t){if("string"==typeof t&&"!"===t.charAt(0))return!i(e,t.substr(1));switch(typeof e){case"boolean":case"number":case"string":return o(e,t);case"object":switch(typeof t){case"object":return o(e,t);default:for(var n in e)if("$"!==n.charAt(0)&&i(e[n],t))return!0}return!1;case"array":for(var r=0;r<e.length;r++)if(i(e[r],t))return!0;return!1;default:return!1}};switch(typeof n){case"boolean":case"number":case"string":n={$:n};case"object":for(var s in n)!function(t){void 0!==n[t]&&r.push(function(e){return i("$"==t?e:e&&e[t],n[t])})}(s);break;case"function":r.push(n);break;default:return e}for(var a=[],c=0;c<e.length;c++){var u=e[c];r.check(u,c)&&a.push(u)}return a}}function hr(e){var r=e.NUMBER_FORMATS;return function(e,t,n){return x(t)&&(t=r.CURRENCY_SYM),x(n)&&(n=r.PATTERNS[1].maxFrac),null==e?e:yr(e,r.PATTERNS[1],r.GROUP_SEP,r.DECIMAL_SEP,n).replace(/\u00A4/g,t)}}function dr(e){var n=e.NUMBER_FORMATS;return function(e,t){return null==e?e:yr(e,n.PATTERNS[0],n.GROUP_SEP,n.DECIMAL_SEP,t)}}fr.$inject=["$provide"],hr.$inject=["$locale"],dr.$inject=["$locale"];var mr=".";function yr(e,t,n,r,o){if(!isFinite(e)||se(e))return"";var i=e<0,s=(e=Math.abs(e))+"",a="",c=[],u=!1;if(-1!==s.indexOf("e")){var l=s.match(/([\d\.]+)e(-?)(\d+)/);l&&"-"==l[2]&&l[3]>o+1?(s="0",e=0):(a=s,u=!0)}if(u)0<o&&-1<e&&e<1&&(a=e.toFixed(o));else{var p=(s.split(mr)[1]||"").length;x(o)&&(o=Math.min(Math.max(t.minFrac,p),t.maxFrac)),0===(e=+(Math.round(+(e.toString()+"e"+o)).toString()+"e"+-o))&&(i=!1);var f=(""+e).split(mr),g=f[0];f=f[1]||"";var h,d=0,m=t.lgSize,y=t.gSize;if(g.length>=m+y)for(d=g.length-m,h=0;h<d;h++)(d-h)%y==0&&0!==h&&(a+=n),a+=g.charAt(h);for(h=d;h<g.length;h++)(g.length-h)%m==0&&0!==h&&(a+=n),a+=g.charAt(h);for(;f.length<o;)f+="0";o&&"0"!==o&&(a+=r+f.substr(0,o))}return c.push(i?t.negPre:t.posPre,a,i?t.negSuf:t.posSuf),c.join("")}function vr(e,t,n){var r="";for(e<0&&(r="-",e=-e),e=""+e;e.length<t;)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function Cr(n,r,o,i){return o=o||0,function(e){var t=e["get"+n]();return(0<o||-o<t)&&(t+=o),0===t&&-12==o&&(t=12),vr(t,r,i)}}function Sr(r,o){return function(e,t){var n=e["get"+r]();return t[u(o?"SHORT"+r:r)][n]}}function Er(e){var t=new Date(e,0,1).getDay();return new Date(e,0,(t<=4?5:12)-t)}function Ar(r){return function(e){var t=Er(e.getFullYear()),n=+function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))}(e)-+t;return vr(1+Math.round(n/6048e5),r)}}var br={yyyy:Cr("FullYear",4),yy:Cr("FullYear",2,0,!0),y:Cr("FullYear",1),MMMM:Sr("Month"),MMM:Sr("Month",!0),MM:Cr("Month",2,1),M:Cr("Month",1,1),dd:Cr("Date",2),d:Cr("Date",1),HH:Cr("Hours",2),H:Cr("Hours",1),hh:Cr("Hours",2,-12),h:Cr("Hours",1,-12),mm:Cr("Minutes",2),m:Cr("Minutes",1),ss:Cr("Seconds",2),s:Cr("Seconds",1),sss:Cr("Milliseconds",3),EEEE:Sr("Day"),EEE:Sr("Day",!0),a:function(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]},Z:function(e){var t=-1*e.getTimezoneOffset(),n=0<=t?"+":"";return n+=vr(Math[0<t?"floor":"ceil"](t/60),2)+vr(Math.abs(t%60),2)},ww:Ar(2),w:Ar(1)},Mr=/((?:[^yMdHhmsaZEw']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z|w+))(.*)/,Tr=/^\-?\d+$/;function Pr(a){var p=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(t,e,n){var r,o,i="",s=[];if(e=e||"mediumDate",e=a.DATETIME_FORMATS[e]||e,ae(t)&&(t=Tr.test(t)?g(t):function(e){var t;if(t=e.match(p)){var n=new Date(0),r=0,o=0,i=t[8]?n.setUTCFullYear:n.setFullYear,s=t[8]?n.setUTCHours:n.setHours;t[9]&&(r=g(t[9]+t[10]),o=g(t[9]+t[11])),i.call(n,g(t[1]),g(t[2])-1,g(t[3]));var a=g(t[4]||0)-r,c=g(t[5]||0)-o,u=g(t[6]||0),l=Math.round(1e3*parseFloat("0."+(t[7]||0)));return s.call(n,a,c,u,l),n}return e}(t)),A(t)&&(t=new Date(t)),!b(t))return t;for(;e;)e=(o=Mr.exec(e))?(s=$(s,o,1)).pop():(s.push(e),null);return n&&"UTC"===n&&(t=new Date(t.getTime())).setMinutes(t.getMinutes()+t.getTimezoneOffset()),ie(s,function(e){r=br[e],i+=r?r(t,a.DATETIME_FORMATS):e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),i}}function Ir(){return function(e){return j(e,!0)}}Pr.$inject=["$locale"];var Nr=v(S),Lr=v(u);function _r(){return function(e,t){if(A(e)&&(e=e.toString()),!ce(e)&&!ae(e))return e;if(t=Math.abs(Number(t))===1/0?Number(t):g(t),ae(e))return t?0<=t?e.slice(0,t):e.slice(t,e.length):"";var n,r,o=[];for(t>e.length?t=e.length:t<-e.length&&(t=-e.length),r=0<t?(n=0,t):(n=e.length+t,e.length);n<r;n++)o.push(e[n]);return o}}function xr(a){return function(e,o,t){return O(e)?(0===(o=ce(o)?o:[o]).length&&(o=["+"]),o=o.map(function(e){var t=!1,n=e||F;if(ae(e)){if("+"!=e.charAt(0)&&"-"!=e.charAt(0)||(t="-"==e.charAt(0),e=e.substring(1)),""===e)return i(function(e,t){return s(e,t)},t);if((n=a(e)).constant){var r=n();return i(function(e,t){return s(e[r],t[r])},t)}}return i(function(e,t){return s(n(e),n(t))},t)}),r.call(e).sort(i(function(e,t){for(var n=0;n<o.length;n++){var r=o[n](e,t);if(0!==r)return r}return 0},t))):e;function i(n,e){return e?function(e,t){return n(t,e)}:n}function s(e,t){var n=typeof e,r=typeof t;return n==r?(b(e)&&b(t)&&(e=e.valueOf(),t=t.valueOf()),"string"==n&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t?0:e<t?-1:1):n<r?-1:1}}}function Dr(e){return ue(e)&&(e={link:e}),e.restrict=e.restrict||"AC",v(e)}xr.$inject=["$parse"];var Rr=v({restrict:"E",compile:function(e,t){if(!t.href&&!t.xlinkHref&&!t.name)return function(e,t){var n="[object SVGAnimatedString]"===a.call(t.prop("href"))?"xlink:href":"href";t.on("click",function(e){t.attr(n)||e.preventDefault()})}}}),Or={};ie(gt,function(e,r){if("multiple"!=e){var o=$t("ng-"+r);Or[o]=function(){return{restrict:"A",priority:100,link:function(e,t,n){e.$watch(n[o],function(e){n.$set(r,!!e)})}}}}}),ie(dt,function(e,o){Or[o]=function(){return{priority:100,link:function(e,t,n){if("ngPattern"===o&&"/"==n.ngPattern.charAt(0)){var r=n.ngPattern.match(i);if(r)return void n.$set("ngPattern",new RegExp(r[1],r[2]))}e.$watch(n[o],function(e){n.$set(o,e)})}}}}),ie(["src","srcset","href"],function(i){var s=$t("ng-"+i);Or[s]=function(){return{priority:99,link:function(e,t,n){var r=i,o=i;"href"===i&&"[object SVGAnimatedString]"===a.call(t.prop("href"))&&(o="xlinkHref",n.$attr[o]="xlink:href",r=null),n.$observe(s,function(e){e?(n.$set(o,e),q&&r&&t.prop(r,n[o])):"href"===i&&n.$set(o,null)})}}}});var wr={$addControl:w,$$renameControl:function(e,t){e.$name=t},$removeControl:w,$setValidity:w,$setDirty:w,$setPristine:w,$setSubmitted:w},Fr="ng-submitted";function Br(e,t,n,r,o){var i=this,s=[],a=i.$$parentForm=e.parent().controller("form")||wr;i.$error={},i.$$success={},i.$pending=re,i.$name=o(t.name||t.ngForm||"")(n),i.$dirty=!1,i.$pristine=!0,i.$valid=!0,i.$invalid=!1,i.$submitted=!1,a.$addControl(i),i.$rollbackViewValue=function(){ie(s,function(e){e.$rollbackViewValue()})},i.$commitViewValue=function(){ie(s,function(e){e.$commitViewValue()})},i.$addControl=function(e){be(e.$name,"input"),s.push(e),e.$name&&(i[e.$name]=e)},i.$$renameControl=function(e,t){var n=e.$name;i[n]===e&&delete i[n],(i[t]=e).$name=t},i.$removeControl=function(n){n.$name&&i[n.$name]===n&&delete i[n.$name],ie(i.$pending,function(e,t){i.$setValidity(t,null,n)}),ie(i.$error,function(e,t){i.$setValidity(t,null,n)}),ge(s,n)},To({ctrl:this,$element:e,set:function(e,t,n){var r=e[t];r?-1===r.indexOf(n)&&r.push(n):e[t]=[n]},unset:function(e,t,n){var r=e[t];r&&(ge(r,n),0===r.length&&delete e[t])},parentForm:a,$animate:r}),i.$setDirty=function(){r.removeClass(e,mo),r.addClass(e,yo),i.$dirty=!0,i.$pristine=!1,a.$setDirty()},i.$setPristine=function(){r.setClass(e,mo,yo+" "+Fr),i.$dirty=!1,i.$pristine=!0,i.$submitted=!1,ie(s,function(e){e.$setPristine()})},i.$setUntouched=function(){ie(s,function(e){e.$setUntouched()})},i.$setSubmitted=function(){r.addClass(e,Fr),i.$submitted=!0,a.$setSubmitted()}}Br.$inject=["$element","$attrs","$scope","$animate","$interpolate"];function $r(e){return["$timeout",function(a){return{name:"form",restrict:e?"EAC":"E",controller:Br,compile:function(e){return e.addClass(mo).addClass(go),{pre:function(t,e,n,r){if(!("action"in n)){var o=function(e){t.$apply(function(){r.$commitViewValue(),r.$setSubmitted()}),e.preventDefault()};Fe(e[0],"submit",o),e.on("$destroy",function(){a(function(){Be(e[0],"submit",o)},0,!1)})}var i=r.$$parentForm,s=r.$name;s&&(Bn(t,s,r,s),n.$observe(n.name?"name":"ngForm",function(e){s!==e&&(Bn(t,s,re,s),Bn(t,s=e,r,s),i.$$renameControl(r,s))})),e.on("$destroy",function(){i.$removeControl(r),s&&Bn(t,s,re,s),D(r,wr)})}}}}}]}var Wr=$r(),Ur=$r(!0),jr=/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,Gr=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,Vr=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,kr=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,Hr=/^(\d{4})-(\d{2})-(\d{2})$/,qr=/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,Jr=/^(\d{4})-W(\d\d)$/,zr=/^(\d{4})-(\d\d)$/,Yr=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,Xr=/(\s+|^)default(\s+|$)/,Kr=new C("ngModel"),Qr={text:function(e,t,n,r,o,i){eo(e,t,n,r,o,i),Zr(r)},date:no("date",Hr,to(Hr,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":no("datetimelocal",qr,to(qr,["yyyy","MM","dd","HH","mm","ss","sss"]),"yyyy-MM-ddTHH:mm:ss.sss"),time:no("time",Yr,to(Yr,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:no("week",Jr,function(e,t){if(b(e))return e;if(ae(e)){Jr.lastIndex=0;var n=Jr.exec(e);if(n){var r=+n[1],o=+n[2],i=0,s=0,a=0,c=0,u=Er(r),l=7*(o-1);return t&&(i=t.getHours(),s=t.getMinutes(),a=t.getSeconds(),c=t.getMilliseconds()),new Date(r,0,u.getDate()+l,i,s,a,c)}}return NaN},"yyyy-Www"),month:no("month",zr,to(zr,["yyyy","MM"]),"yyyy-MM"),number:function(e,t,n,r,o,i){if(ro(e,t,n,r),eo(e,t,n,r,o,i),r.$$parserName="number",r.$parsers.push(function(e){return r.$isEmpty(e)?null:kr.test(e)?parseFloat(e):re}),r.$formatters.push(function(e){if(!r.$isEmpty(e)){if(!A(e))throw Kr("numfmt","Expected `{0}` to be a number",e);e=e.toString()}return e}),n.min||n.ngMin){var s;r.$validators.min=function(e){return r.$isEmpty(e)||x(s)||s<=e},n.$observe("min",function(e){z(e)&&!A(e)&&(e=parseFloat(e,10)),s=A(e)&&!isNaN(e)?e:re,r.$validate()})}if(n.max||n.ngMax){var a;r.$validators.max=function(e){return r.$isEmpty(e)||x(a)||e<=a},n.$observe("max",function(e){z(e)&&!A(e)&&(e=parseFloat(e,10)),a=A(e)&&!isNaN(e)?e:re,r.$validate()})}},url:function(e,t,n,r,o,i){eo(e,t,n,r,o,i),Zr(r),r.$$parserName="url",r.$validators.url=function(e,t){var n=e||t;return r.$isEmpty(n)||Gr.test(n)}},email:function(e,t,n,r,o,i){eo(e,t,n,r,o,i),Zr(r),r.$$parserName="email",r.$validators.email=function(e,t){var n=e||t;return r.$isEmpty(n)||Vr.test(n)}},radio:function(e,t,n,r){x(n.name)&&t.attr("name",o());t.on("click",function(e){t[0].checked&&r.$setViewValue(n.value,e&&e.type)}),r.$render=function(){var e=n.value;t[0].checked=e==r.$viewValue},n.$observe("value",r.$render)},checkbox:function(e,t,n,r,o,i,s,a){var c=oo(a,e,"ngTrueValue",n.ngTrueValue,!0),u=oo(a,e,"ngFalseValue",n.ngFalseValue,!1);t.on("click",function(e){r.$setViewValue(t[0].checked,e&&e.type)}),r.$render=function(){t[0].checked=r.$viewValue},r.$isEmpty=function(e){return!1===e},r.$formatters.push(function(e){return he(e,c)}),r.$parsers.push(function(e){return e?c:u})},hidden:w,button:w,submit:w,reset:w,file:w};function Zr(t){t.$formatters.push(function(e){return t.$isEmpty(e)?e:e.toString()})}function eo(e,r,o,i,t,n){var s=r[0].placeholder,a={},c=S(r[0].type);if(!t.android){var u=!1;r.on("compositionstart",function(e){u=!0}),r.on("compositionend",function(){u=!1,l()})}var l=function(e){if(!u){var t=r.val(),n=e&&e.type;q&&"input"===(e||a).type&&r[0].placeholder!==s?s=r[0].placeholder:("password"===c||o.ngTrim&&"false"===o.ngTrim||(t=pe(t)),(i.$viewValue!==t||""===t&&i.$$hasNativeValidators)&&i.$setViewValue(t,n))}};if(t.hasEvent("input"))r.on("input",l);else{var p,f=function(e){p=p||n.defer(function(){l(e),p=null})};r.on("keydown",function(e){var t=e.keyCode;91===t||15<t&&t<19||37<=t&&t<=40||f(e)}),t.hasEvent("paste")&&r.on("paste cut",f)}r.on("change",l),i.$render=function(){r.val(i.$isEmpty(i.$viewValue)?"":i.$viewValue)}}function to(o,i){return function(e,t){var n,r;if(b(e))return e;if(ae(e)){if('"'==e.charAt(0)&&'"'==e.charAt(e.length-1)&&(e=e.substring(1,e.length-1)),jr.test(e))return new Date(e);if(o.lastIndex=0,n=o.exec(e))return n.shift(),r=t?{yyyy:t.getFullYear(),MM:t.getMonth()+1,dd:t.getDate(),HH:t.getHours(),mm:t.getMinutes(),ss:t.getSeconds(),sss:t.getMilliseconds()/1e3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},ie(n,function(e,t){t<i.length&&(r[i[t]]=+e)}),new Date(r.yyyy,r.MM-1,r.dd,r.HH,r.mm,r.ss||0,1e3*r.sss||0)}return NaN}}function no(g,h,d,m){return function(e,t,n,r,o,i,s){ro(e,t,n,r),eo(0,t,n,r,o,i);var a,c,u,l=r&&r.$options&&r.$options.timezone;r.$$parserName=g,r.$parsers.push(function(e){if(r.$isEmpty(e))return null;if(h.test(e)){var t=d(e,a);return"UTC"===l&&t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t}return re}),r.$formatters.push(function(e){if(e&&!b(e))throw Kr("datefmt","Expected `{0}` to be a date",e);if(p(e)){if((a=e)&&"UTC"===l){var t=6e4*a.getTimezoneOffset();a=new Date(a.getTime()+t)}return s("date")(e,m,l)}return a=null,""}),(z(n.min)||n.ngMin)&&(r.$validators.min=function(e){return!p(e)||x(c)||d(e)>=c},n.$observe("min",function(e){c=f(e),r.$validate()}));(z(n.max)||n.ngMax)&&(r.$validators.max=function(e){return!p(e)||x(u)||d(e)<=u},n.$observe("max",function(e){u=f(e),r.$validate()}));function p(e){return e&&!(e.getTime&&e.getTime()!=e.getTime())}function f(e){return z(e)?b(e)?e:d(e):re}}}function ro(e,n,t,r){var o=n[0];(r.$$hasNativeValidators=se(o.validity))&&r.$parsers.push(function(e){var t=n.prop(s)||{};return t.badInput&&!t.typeMismatch?re:e})}function oo(e,t,n,r,o){var i;if(z(r)){if(!(i=e(r)).constant)throw C("ngModel")("constexpr","Expected constant expression for `{0}`, but saw `{1}`.",n,r);return i(t)}return o}function io(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,r){r&&(n.required=!0,r.$validators.required=function(e,t){return!n.required||!r.$isEmpty(t)},n.$observe("required",function(){r.$validate()}))}}}function so(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,r){if(r){var o,i=n.ngPattern||n.pattern;n.$observe("pattern",function(e){if(ae(e)&&0<e.length&&(e=new RegExp("^"+e+"$")),e&&!e.test)throw C("ngPattern")("noregexp","Expected {0} to be a RegExp but was {1}. Element: {2}",i,e,me(t));o=e||re,r.$validate()}),r.$validators.pattern=function(e){return r.$isEmpty(e)||x(o)||o.test(e)}}}}}function ao(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,r){if(r){var o=-1;n.$observe("maxlength",function(e){var t=g(e);o=isNaN(t)?-1:t,r.$validate()}),r.$validators.maxlength=function(e,t){return o<0||r.$isEmpty(e)||t.length<=o}}}}}function co(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,r){if(r){var o=0;n.$observe("minlength",function(e){o=g(e)||0,r.$validate()}),r.$validators.minlength=function(e,t){return r.$isEmpty(t)||t.length>=o}}}}}function uo(){return{restrict:"A",priority:100,require:"ngModel",link:function(e,t,n,r){var o=t.attr(n.$attr.ngList)||", ",i="false"!==n.ngTrim,s=i?pe(o):o;r.$parsers.push(function(e){if(!x(e)){var t=[];return e&&ie(e.split(s),function(e){e&&t.push(i?pe(e):e)}),t}}),r.$formatters.push(function(e){return ce(e)?e.join(o):re}),r.$isEmpty=function(e){return!e||!e.length}}}}function lo(){return{restrict:"A",priority:100,compile:function(e,t){return Mo.test(t.ngValue)?function(e,t,n){n.$set("value",e.$eval(n.ngValue))}:function(e,t,n){e.$watch(n.ngValue,function(e){n.$set("value",e)})}}}}function po(){return{restrict:"A",controller:["$scope","$attrs",function(e,t){var n=this;this.$options=e.$eval(t.ngModelOptions),this.$options.updateOn!==re?(this.$options.updateOnDefault=!1,this.$options.updateOn=pe(this.$options.updateOn.replace(Xr,function(){return n.$options.updateOnDefault=!0," "}))):this.$options.updateOnDefault=!0}]}}var fo=["$browser","$sniffer","$filter","$parse",function(o,i,s,a){return{restrict:"E",require:["?ngModel"],link:{pre:function(e,t,n,r){r[0]&&(Qr[S(n.type)]||Qr.text)(e,t,n,r[0],i,o,s,a)}}}}],go="ng-valid",ho="ng-invalid",mo="ng-pristine",yo="ng-dirty",vo="ng-untouched",Co="ng-touched",So="ng-pending",Eo=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate","$timeout","$rootScope","$q","$interpolate",function(a,t,o,i,s,e,c,u,l,n){this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$$rawModelValue=re,this.$validators={},this.$asyncValidators={},this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$untouched=!0,this.$touched=!1,this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$error={},this.$$success={},this.$pending=re,this.$name=n(o.name||"",!1)(a);var p=s(o.ngModel),f=p.assign,g=p,h=f,d=null,m=this;this.$$setOptions=function(e){if((m.$options=e)&&e.getterSetter){var n=s(o.ngModel+"()"),r=s(o.ngModel+"($$$p)");g=function(e){var t=p(e);return ue(t)&&(t=n(e)),t},h=function(e,t){ue(p(e))?r(e,{$$$p:m.$modelValue}):f(e,m.$modelValue)}}else if(!p.assign)throw Kr("nonassign","Expression '{0}' is non-assignable. Element: {1}",o.ngModel,me(i))},this.$render=w,this.$isEmpty=function(e){return x(e)||""===e||null===e||e!=e};var r=i.inheritedData("$formController")||wr,y=0;To({ctrl:this,$element:i,set:function(e,t){e[t]=!0},unset:function(e,t){delete e[t]},parentForm:r,$animate:e}),this.$setPristine=function(){m.$dirty=!1,m.$pristine=!0,e.removeClass(i,yo),e.addClass(i,mo)},this.$setDirty=function(){m.$dirty=!0,m.$pristine=!1,e.removeClass(i,mo),e.addClass(i,yo),r.$setDirty()},this.$setUntouched=function(){m.$touched=!1,m.$untouched=!0,e.setClass(i,vo,Co)},this.$setTouched=function(){m.$touched=!0,m.$untouched=!1,e.setClass(i,Co,vo)},this.$rollbackViewValue=function(){c.cancel(d),m.$viewValue=m.$$lastCommittedViewValue,m.$render()},this.$validate=function(){if(!A(m.$modelValue)||!isNaN(m.$modelValue)){var e=m.$$lastCommittedViewValue,t=m.$$rawModelValue,n=m.$$parserName||"parse",r=!m.$error[n]&&re,o=m.$valid,i=m.$modelValue,s=m.$options&&m.$options.allowInvalid;m.$$runValidators(r,t,e,function(e){s||o===e||(m.$modelValue=e?t:re,m.$modelValue!==i&&m.$$writeModelToScope())})}},this.$$runValidators=function(e,r,o,t){var i,s,a,n=++y;(function(e){var t=m.$$parserName||"parse";if(e===re)c(t,null);else if(c(t,e),!e)return ie(m.$validators,function(e,t){c(t,null)}),ie(m.$asyncValidators,function(e,t){c(t,null)}),!1;return!0})(e)?(i=!0,ie(m.$validators,function(e,t){var n=e(r,o);i=i&&n,c(t,n)}),i||(ie(m.$asyncValidators,function(e,t){c(t,null)}),0)?(s=[],a=!0,ie(m.$asyncValidators,function(e,t){var n=e(r,o);if(!I(n))throw Kr("$asyncValidators","Expected asynchronous validator to return a promise but got '{0}' instead.",n);c(t,re),s.push(n.then(function(){c(t,!0)},function(e){c(t,a=!1)}))}),s.length?l.all(s).then(function(){u(a)},w):u(!0)):u(!1)):u(!1);function c(e,t){n===y&&m.$setValidity(e,t)}function u(e){n===y&&t(e)}},this.$commitViewValue=function(){var e=m.$viewValue;c.cancel(d),(m.$$lastCommittedViewValue!==e||""===e&&m.$$hasNativeValidators)&&(m.$$lastCommittedViewValue=e,m.$pristine&&this.$setDirty(),this.$$parseAndValidate())},this.$$parseAndValidate=function(){var e=m.$$lastCommittedViewValue,t=e,n=!x(t)||re;if(n)for(var r=0;r<m.$parsers.length;r++)if(x(t=m.$parsers[r](t))){n=!1;break}A(m.$modelValue)&&isNaN(m.$modelValue)&&(m.$modelValue=g(a));var o=m.$modelValue,i=m.$options&&m.$options.allowInvalid;function s(){m.$modelValue!==o&&m.$$writeModelToScope()}m.$$rawModelValue=t,i&&(m.$modelValue=t,s()),m.$$runValidators(n,t,e,function(e){i||(m.$modelValue=e?t:re,s())})},this.$$writeModelToScope=function(){h(a,m.$modelValue),ie(m.$viewChangeListeners,function(e){try{e()}catch(e){t(e)}})},this.$setViewValue=function(e,t){m.$viewValue=e,m.$options&&!m.$options.updateOnDefault||m.$$debounceViewValueCommit(t)},this.$$debounceViewValueCommit=function(e){var t,n=0,r=m.$options;r&&z(r.debounce)&&(A(t=r.debounce)?n=t:A(t[e])?n=t[e]:A(t.default)&&(n=t.default)),c.cancel(d),n?d=c(function(){m.$commitViewValue()},n):u.$$phase?m.$commitViewValue():a.$apply(function(){m.$commitViewValue()})},a.$watch(function(){var e=g(a);if(e!==m.$modelValue){m.$modelValue=m.$$rawModelValue=e;for(var t=m.$formatters,n=t.length,r=e;n--;)r=t[n](r);m.$viewValue!==r&&(m.$viewValue=m.$$lastCommittedViewValue=r,m.$render(),m.$$runValidators(re,e,r,w))}return e})}],Ao=["$rootScope",function(i){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:Eo,priority:1,compile:function(e){return e.addClass(mo).addClass(vo).addClass(go),{pre:function(e,t,n,r){var o=r[0],i=r[1]||wr;o.$$setOptions(r[2]&&r[2].$options),i.$addControl(o),n.$observe("name",function(e){o.$name!==e&&i.$$renameControl(o,e)}),e.$on("$destroy",function(){i.$removeControl(o)})},post:function(t,e,n,r){var o=r[0];o.$options&&o.$options.updateOn&&e.on(o.$options.updateOn,function(e){o.$$debounceViewValueCommit(e&&e.type)}),e.on("blur",function(e){o.$touched||(i.$$phase?t.$evalAsync(o.$setTouched):t.$apply(o.$setTouched))})}}}}}],bo=v({restrict:"A",require:"ngModel",link:function(e,t,n,r){r.$viewChangeListeners.push(function(){e.$eval(n.ngChange)})}}),Mo=/^(true|false|\d+)$/;function To(e){var o=e.ctrl,n=e.$element,r={},i=e.set,s=e.unset,a=e.parentForm,c=e.$animate;function u(e,t){t&&!r[e]?(c.addClass(n,e),r[e]=!0):!t&&r[e]&&(c.removeClass(n,e),r[e]=!1)}function l(e,t){e=e?"-"+ve(e,"-"):"",u(go+e,!0===t),u(ho+e,!1===t)}r[ho]=!(r[go]=n.hasClass(go)),o.$setValidity=function(e,t,n){t===re?function(e,t,n){o[e]||(o[e]={});i(o[e],t,n)}("$pending",e,n):function(e,t,n){o[e]&&s(o[e],t,n);Po(o[e])&&(o[e]=re)}("$pending",e,n);T(t)?t?(s(o.$error,e,n),i(o.$$success,e,n)):(i(o.$error,e,n),s(o.$$success,e,n)):(s(o.$error,e,n),s(o.$$success,e,n));o.$pending?(u(So,!0),o.$valid=o.$invalid=re,l("",null)):(u(So,!1),o.$valid=Po(o.$error),o.$invalid=!o.$valid,l("",o.$valid));var r;r=o.$pending&&o.$pending[e]?re:!o.$error[e]&&(!!o.$$success[e]||null);l(e,r),a.$setValidity(e,r,o)}}function Po(e){if(e)for(var t in e)return!1;return!0}var Io=["$compile",function(r){return{restrict:"AC",compile:function(e){return r.$$addBindingClass(e),function(e,t,n){r.$$addBindingInfo(t,n.ngBind),t=t[0],e.$watch(n.ngBind,function(e){t.textContent=e===re?"":e})}}}}],No=["$interpolate","$compile",function(o,i){return{compile:function(e){return i.$$addBindingClass(e),function(e,t,n){var r=o(t.attr(n.$attr.ngBindTemplate));i.$$addBindingInfo(t,r.expressions),t=t[0],n.$observe("ngBindTemplate",function(e){t.textContent=e===re?"":e})}}}}],Lo=["$sce","$parse","$compile",function(i,n,s){return{restrict:"A",compile:function(e,t){var r=n(t.ngBindHtml),o=n(t.ngBindHtml,function(e){return(e||"").toString()});return s.$$addBindingClass(e),function(e,t,n){s.$$addBindingInfo(t,n.ngBindHtml),e.$watch(o,function(){t.html(i.getTrustedHtml(r(e))||"")})}}}}];function _o(f,g){return f="ngClass"+f,["$animate",function(u){return{restrict:"AC",link:function(o,i,s){var n;function a(e){var t=c(e,1);s.$addClass(t)}function c(e,t){var n=i.data("$classCounts")||{},r=[];return ie(e,function(e){(0<t||n[e])&&(n[e]=(n[e]||0)+t,n[e]===+(0<t)&&r.push(e))}),i.data("$classCounts",n),r.join(" ")}function t(e){if(!0===g||o.$index%2===g){var t=p(e||[]);if(n){if(!he(e,n)){!function(e,t){var n=l(t,e),r=l(e,t);n=c(n,1),r=c(r,-1),n&&n.length&&u.addClass(i,n),r&&r.length&&u.removeClass(i,r)}(p(n),t)}}else a(t)}n=_(e)}o.$watch(s[f],t,!0),s.$observe("class",function(e){t(o.$eval(s[f]))}),"ngClass"!==f&&o.$watch("$index",function(e,t){var n=1&e;if(n!=(1&t)){var r=p(o.$eval(s[f]));n===g?a(r):function(e){var t=c(e,-1);s.$removeClass(t)}(r)}})}};function l(e,t){var n=[];e:for(var r=0;r<e.length;r++){for(var o=e[r],i=0;i<t.length;i++)if(o==t[i])continue e;n.push(o)}return n}function p(e){if(ce(e))return e;if(ae(e))return e.split(" ");if(se(e)){var n=[];return ie(e,function(e,t){e&&(n=n.concat(t.split(" ")))}),n}return e}}]}var xo=_o("",!0),Do=_o("Odd",0),Ro=_o("Even",1),Oo=Dr({compile:function(e,t){t.$set("ngCloak",re),e.removeClass("ng-cloak")}}),wo=[function(){return{restrict:"A",scope:!0,controller:"@",priority:500}}],Fo={},Bo={blur:!0,focus:!0};ie("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(i){var s=$t("ng-"+i);Fo[s]=["$parse","$rootScope",function(n,o){return{restrict:"A",compile:function(e,t){var r=n(t[s],null,!0);return function(n,e){e.on(i,function(e){function t(){r(n,{$event:e})}Bo[i]&&o.$$phase?n.$evalAsync(t):n.$apply(t)})}}}}]});var $o,Wo=["$animate",function(c){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(e,n,r,t,o){var i,s,a;e.$watch(r.ngIf,function(e){e?s||o(function(e,t){s=t,e[e.length++]=ne.createComment(" end ngIf: "+r.ngIf+" "),i={clone:e},c.enter(e,n.parent(),n)}):(a&&(a.remove(),a=null),s&&(s.$destroy(),s=null),i&&(a=Te(i.clone),c.leave(a).then(function(){a=null}),i=null))})}}}],Uo=["$templateRequest","$anchorScroll","$animate","$sce",function(m,y,v,r){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:E.noop,compile:function(e,t){var n=t.ngInclude||t.src,h=t.onload||"",d=t.autoscroll;return function(s,a,e,c,u){function l(){t&&(t.remove(),t=null),p&&(p.$destroy(),p=null),f&&(v.leave(f).then(function(){t=null}),t=f,f=null)}var p,t,f,g=0;s.$watch(r.parseAsResourceUrl(n),function(r){function o(){!z(d)||d&&!s.$eval(d)||y()}var i=++g;r?(m(r,!0).then(function(e){if(i===g){var t=s.$new();c.template=e;var n=u(t,function(e){l(),v.enter(e,null,a).then(o)});f=n,(p=t).$emit("$includeContentLoaded",r),s.$eval(h)}},function(){i===g&&(l(),s.$emit("$includeContentError",r))}),s.$emit("$includeContentRequested",r)):(l(),c.template=null)})}}}}],jo=["$compile",function(o){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(e,t,n,r){if(/SVG/.test(t[0].toString()))return t.empty(),void o(Xe(r.template,ne).childNodes)(e,function(e){t.append(e)},{futureParentElement:t});t.html(r.template),o(t.contents())(e)}}}],Go=Dr({priority:450,compile:function(){return{pre:function(e,t,n){e.$eval(n.ngInit)}}}}),Vo=Dr({terminal:!0,priority:1e3}),ko=["$locale","$interpolate",function(h,d){var m=/{}/g,y=/^when(Minus)?(.+)$/;return{restrict:"EA",link:function(r,o,i){var s,e=i.count,t=i.$attr.when&&o.attr(i.$attr.when),a=i.offset||0,c=r.$eval(t)||{},u={},n=d.startSymbol(),l=d.endSymbol(),p=n+e+"-"+a+l,f=E.noop;function g(e){o.text(e||"")}ie(i,function(e,t){var n=y.exec(t);if(n){var r=(n[1]?"-":"")+S(n[2]);c[r]=o.attr(i.$attr[t])}}),ie(c,function(e,t){u[t]=d(e.replace(m,p))}),r.$watch(e,function(e){var t=parseFloat(e),n=isNaN(t);n||t in c||(t=h.pluralCat(t-a)),t===s||n&&isNaN(s)||(f(),f=r.$watch(u[t],g),s=t)})}}}],Ho=["$parse","$animate",function(c,_){function x(e,t,n,r,o,i,s){e[n]=r,o&&(e[o]=i),e.$index=t,e.$first=0===t,e.$last=t===s-1,e.$middle=!(e.$first||e.$last),e.$odd=!(e.$even=0==(1&t))}var D="$$NG_REMOVED",R=C("ngRepeat");return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,compile:function(e,t){var A=t.ngRepeat,b=ne.createComment(" end ngRepeat: "+A+" "),n=A.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!n)throw R("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",A);var r=n[1],o=n[2],M=n[3],i=n[4];if(!(n=r.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/)))throw R("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",r);var s,T,P,I,N=n[3]||n[1],L=n[2];if(M&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(M)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent)$/.test(M)))throw R("badident","alias '{0}' is invalid --- must be a valid JS identifier which is not a reserved name.",M);var a={$id:vt};return i?s=c(i):(P=function(e,t){return vt(t)},I=function(e){return e}),function(v,C,e,t,S){s&&(T=function(e,t,n){return L&&(a[L]=e),a[N]=t,a.$index=n,s(v,a)});var E=Pe();v.$watchCollection(o,function(e){var r,t,n,o,i,s,a,c,u,l,p,f,g,h=C[0],d=Pe();if(M&&(v[M]=e),O(e))u=e,c=T||P;else{for(var m in c=T||I,u=[],e)e.hasOwnProperty(m)&&"$"!=m.charAt(0)&&u.push(m);u.sort()}for(o=u.length,p=new Array(o),r=0;r<o;r++)if(i=e===u?r:u[r],s=e[i],a=c(i,s,r),E[a])l=E[a],delete E[a],d[a]=l,p[r]=l;else{if(d[a])throw ie(p,function(e){e&&e.scope&&(E[e.id]=e)}),R("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}, Duplicate value: {2}",A,a,s);p[r]={id:a,scope:re,clone:re},d[a]=!0}for(var y in E){if(f=Te((l=E[y]).clone),_.leave(f),f[0].parentNode)for(r=0,t=f.length;r<t;r++)f[r][D]=!0;l.scope.$destroy()}for(r=0;r<o;r++)if(i=e===u?r:u[r],s=e[i],(l=p[r]).scope){for(n=h;(n=n.nextSibling)&&n[D];);l.clone[0]!=n&&_.move(Te(l.clone),null,oe(h)),h=(g=l).clone[g.clone.length-1],x(l.scope,r,N,s,L,i,o)}else S(function(e,t){l.scope=t;var n=b.cloneNode(!1);e[e.length++]=n,_.enter(e,null,oe(h)),h=n,l.clone=e,d[l.id]=l,x(l.scope,r,N,s,L,i,o)});E=d})}}}}],qo="ng-hide-animate",Jo=["$animate",function(r){return{restrict:"A",multiElement:!0,link:function(e,t,n){e.$watch(n.ngShow,function(e){r[e?"removeClass":"addClass"](t,"ng-hide",{tempClasses:qo})})}}}],zo=["$animate",function(r){return{restrict:"A",multiElement:!0,link:function(e,t,n){e.$watch(n.ngHide,function(e){r[e?"addClass":"removeClass"](t,"ng-hide",{tempClasses:qo})})}}}],Yo=Dr(function(e,n,t){e.$watch(t.ngStyle,function(e,t){t&&e!==t&&ie(t,function(e,t){n.css(t,"")}),e&&n.css(e)},!0)}),Xo=["$animate",function(l){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(e,t,n,o){function i(e,t){return function(){e.splice(t,1)}}var r=n.ngSwitch||n.on,s=[],a=[],c=[],u=[];e.$watch(r,function(e){var t,n;for(t=0,n=c.length;t<n;++t)l.cancel(c[t]);for(t=c.length=0,n=u.length;t<n;++t){var r=Te(a[t].clone);u[t].$destroy(),(c[t]=l.leave(r)).then(i(c,t))}a.length=0,u.length=0,(s=o.cases["!"+e]||o.cases["?"])&&ie(s,function(o){o.transclude(function(e,t){u.push(t);var n=o.element;e[e.length++]=ne.createComment(" end ngSwitchWhen: ");var r={clone:e};a.push(r),l.enter(e,n.parent(),n)})})})}}}],Ko=Dr({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(e,t,n,r,o){r.cases["!"+n.ngSwitchWhen]=r.cases["!"+n.ngSwitchWhen]||[],r.cases["!"+n.ngSwitchWhen].push({transclude:o,element:t})}}),Qo=Dr({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(e,t,n,r,o){r.cases["?"]=r.cases["?"]||[],r.cases["?"].push({transclude:o,element:t})}}),Zo=Dr({restrict:"EAC",link:function(e,t,n,r,o){if(!o)throw C("ngTransclude")("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",me(t));o(function(e){t.empty(),t.append(e)})}}),ei=["$templateCache",function(o){return{restrict:"E",terminal:!0,compile:function(e,t){if("text/ng-template"==t.type){var n=t.id,r=e[0].text;o.put(n,r)}}}}],ti=C("ngOptions"),ni=v({restrict:"A",terminal:!0}),ri=["$compile","$parse",function(C,S){var E=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,a={$setViewValue:w};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(n,e,t){var r,o=this,i={},s=a;o.databound=t.ngModel,o.init=function(e,t,n){s=e,t,r=n},o.addOption=function(e,t){be(e,'"option value"'),i[e]=!0,s.$viewValue==e&&(n.val(e),r.parent()&&r.remove()),t&&t[0].hasAttribute("selected")&&(t[0].selected=!0)},o.removeOption=function(e){this.hasOption(e)&&(delete i[e],s.$viewValue===e&&this.renderUnknownOption(e))},o.renderUnknownOption=function(e){var t="? "+vt(e)+" ?";r.val(t),n.prepend(r),n.val(t),r.prop("selected",!0)},o.hasOption=function(e){return i.hasOwnProperty(e)},e.$on("$destroy",function(){o.renderUnknownOption=w})}],link:function(e,t,n,r){if(r[1]){for(var o,i,s,a,c,u,l,p,f,U=r[0],g=r[1],j=n.multiple,h=n.ngOptions,G=!1,V=!1,k=oe(ne.createElement("option")),H=oe(ne.createElement("optgroup")),d=k.clone(),m=0,y=t.children(),v=y.length;m<v;m++)if(""===y[m].value){o=G=y.eq(m);break}U.init(g,G,d),j&&(g.$isEmpty=function(e){return!e||0===e.length}),h?function(T,P,I){var e;if(!(e=h.match(E)))throw ti("iexp","Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_' but got '{0}'. Element: {1}",h,me(P));var N=S(e[2]||e[1]),r=e[4]||e[6],t=/ as /.test(e[0])&&e[1],L=t?S(t):null,_=e[5],x=S(e[3]||""),D=S(e[2]?e[1]:r),R=S(e[7]),O=e[8]?S(e[8]):null,w={},F=[[{element:P,label:""}]],B={};G&&(C(G)(T),G.removeClass("ng-scope"),G.remove());P.empty(),P.on("change",function(){T.$apply(function(){var t,n=R(T)||[];if(j)t=[],ie(P.val(),function(e){e=O?w[e]:e,t.push(o(e,n[e]))});else{var e=O?w[P.val()]:P.val();t=o(e,n[e])}I.$setViewValue(t),i()})}),I.$render=i,T.$watchCollection(R,n),T.$watchCollection(function(){var e,t=R(T);{if(t&&ce(t)){e=new Array(t.length);for(var n=0,r=t.length;n<r;n++)e[n]=$(N,n,t[n]);return e}if(t)for(var o in e={},t)t.hasOwnProperty(o)&&(e[o]=$(N,o,t[o]))}return e},n),j&&T.$watchCollection(function(){return I.$modelValue},n);function $(e,t,n){return B[r]=n,_&&(B[_]=t),e(T,B)}function o(e,t){return"?"===e?re:""===e?null:$(L||D,e,t)}function n(){V||(T.$$postDigest(i),V=!0)}function W(e,t,n){e[t]=e[t]||0,e[t]+=n?1:-1}function i(){V=!1;var e,t,n,r,o,i,s,a,c,u,l,p,f,g,h,d,m,y={"":[]},v=[""],C=I.$viewValue,S=R(T)||[],E=_?J(S):S,A={},b=function(r){var o;if(j)if(O&&ce(r)){o=new Ct([]);for(var e=0;e<r.length;e++)o.put($(O,null,r[e]),!0)}else o=new Ct(r);else O&&(r=$(O,null,r));return function(e,t){var n;return n=O||(L||D),j?z(o.remove($(n,e,t))):r===$(n,e,t)}}(C),M=!1;for(w={},p=0;p<(u=E.length);p++)s=p,_&&"$"===(s=E[p]).charAt(0)||(a=S[s],(t=y[e=$(x,s,a)||""])||(t=y[e]=[],v.push(e)),f=b(s,a),M=M||f,d=z(d=$(N,s,a))?d:"",m=O?O(T,B):_?E[p]:p,O&&(w[m]=s),t.push({id:m,label:d,selected:f}));for(j||(G||null===C?y[""].unshift({id:"",label:"",selected:!M}):M||y[""].unshift({id:"?",label:"",selected:!0})),l=0,c=v.length;l<c;l++){for(t=y[e=v[l]],F.length<=l?(o=[r={element:H.clone().attr("label",e),label:t.label}],F.push(o),P.append(r.element)):(r=(o=F[l])[0]).label!=e&&r.element.attr("label",r.label=e),g=null,p=0,u=t.length;p<u;p++)n=t[p],(i=o[p+1])?(g=i.element,i.label!==n.label&&(W(A,i.label,!1),W(A,n.label,!0),g.text(i.label=n.label),g.prop("label",i.label)),i.id!==n.id&&g.val(i.id=n.id),g[0].selected!==n.selected&&(g.prop("selected",i.selected=n.selected),q&&g.prop("selected",i.selected))):(""===n.id&&G?h=G:(h=k.clone()).val(n.id).prop("selected",n.selected).attr("selected",n.selected).prop("label",n.label).text(n.label),o.push(i={element:h,label:n.label,id:n.id,selected:n.selected}),W(A,n.label,!0),g?g.after(h):r.element.append(h),g=h);for(p++;o.length>p;)W(A,(n=o.pop()).label,!1),n.element.remove()}for(;F.length>l;){for(t=F.pop(),p=1;p<t.length;++p)W(A,t[p].label,!1);t[0].element.remove()}ie(A,function(e,t){0<e?U.addOption(t):e<0&&U.removeOption(t)})}}(e,t,g):j?(u=e,l=t,(p=g).$render=function(){var t=new Ct(p.$viewValue);ie(l.find("option"),function(e){e.selected=z(t.get(e.value))})},u.$watch(function(){he(f,p.$viewValue)||(f=_(p.$viewValue),p.$render())}),l.on("change",function(){u.$apply(function(){var t=[];ie(l.find("option"),function(e){e.selected&&t.push(e.value)}),p.$setViewValue(t)})})):(i=e,s=t,c=U,(a=g).$render=function(){var e=a.$viewValue;c.hasOption(e)?(d.parent()&&d.remove(),s.val(e),""===e&&o.prop("selected",!0)):x(e)&&o?s.val(""):c.renderUnknownOption(e)},s.on("change",function(){i.$apply(function(){d.parent()&&d.remove(),a.$setViewValue(s.val())})}))}}}}],oi=["$interpolate",function(n){var a={addOption:w,removeOption:w};return{restrict:"E",priority:100,compile:function(e,t){if(x(t.value)){var s=n(e.text(),!0);s||t.$set("value",e.text())}return function(e,n,r){var t="$selectController",o=n.parent(),i=o.data(t)||o.parent().data(t);i&&i.databound||(i=a),s?e.$watch(s,function(e,t){r.$set("value",e),t!==e&&i.removeOption(t),i.addOption(e,n)}):i.addOption(r.value,n),n.on("$destroy",function(){i.removeOption(r.value)})}}}}],ii=v({restrict:"E",terminal:!1});d.angular.bootstrap?console.log("WARNING: Tried to load angular more than once."):(Se||((m=d.jQuery)&&m.fn.on?(D((oe=m).fn,{scope:ft.scope,isolateScope:ft.isolateScope,controller:ft.controller,injector:ft.injector,inheritedData:ft.inheritedData}),$o=m.cleanData,m.cleanData=function(e){var t;if(Ce)Ce=!1;else for(var n,r=0;null!=(n=e[r]);r++)(t=m._data(n,"events"))&&t.$destroy&&m(n).triggerHandler("$destroy");$o(e)}):oe=Ke,E.element=oe,Se=!0),function(e){D(e,{bootstrap:Z,copy:L,extend:D,equals:he,element:oe,forEach:ie,injector:Pt,noop:w,bind:W,toJson:j,fromJson:G,identity:F,isUndefined:x,isDefined:z,isString:ae,isFunction:ue,isObject:se,isNumber:A,isElement:N,isArray:ce,version:Re,isDate:b,lowercase:S,uppercase:u,callbacks:{counter:0},getTestability:te,$$minErr:C,$$csp:B,reloadWithDebugInfo:ee}),h=function(e){var u=C("$injector"),n=C("ng");function t(e,t,n){return e[t]||(e[t]=n())}var r=t(e,"angular",Object);return r.$$minErr=r.$$minErr||C,t(r,"module",function(){var e={};return function(s,a,c){return function(e,t){if("hasOwnProperty"===e)throw n("badname","hasOwnProperty is not a valid {0} name",t)}(s,"module"),a&&e.hasOwnProperty(s)&&(e[s]=null),t(e,s,function(){if(!a)throw u("nomod","Module '{0}' is not available! You either misspelled the module name or forgot to load it. If registering a module ensure that you specify the dependencies as the second argument.",s);var o=[],e=[],t=[],n=r("$injector","invoke","push",e),i={_invokeQueue:o,_configBlocks:e,_runBlocks:t,requires:a,name:s,provider:r("$provide","provider"),factory:r("$provide","factory"),service:r("$provide","service"),value:r("$provide","value"),constant:r("$provide","constant","unshift"),animation:r("$animateProvider","register"),filter:r("$filterProvider","register"),controller:r("$controllerProvider","register"),directive:r("$compileProvider","directive"),config:n,run:function(e){return t.push(e),this}};return c&&n(c),i;function r(e,t,n,r){return r=r||o,function(){return r[n||"push"]([e,t,arguments]),i}}})}})}(d);try{h("ngLocale")}catch(e){h("ngLocale",[]).provider("$locale",an)}h("ng",["ngLocale"],["$provide",function(e){e.provider({$$sanitizeUri:Kn}),e.provider("$compile",Ft).directive({a:Rr,input:fo,textarea:fo,form:Wr,script:ei,select:ri,style:ii,option:oi,ngBind:Io,ngBindHtml:Lo,ngBindTemplate:No,ngClass:xo,ngClassEven:Ro,ngClassOdd:Do,ngCloak:Oo,ngController:wo,ngForm:Ur,ngHide:zo,ngIf:Wo,ngInclude:Uo,ngInit:Go,ngNonBindable:Vo,ngPluralize:ko,ngRepeat:Ho,ngShow:Jo,ngStyle:Yo,ngSwitch:Xo,ngSwitchWhen:Ko,ngSwitchDefault:Qo,ngOptions:ni,ngTransclude:Zo,ngModel:Ao,ngList:uo,ngChange:bo,pattern:so,ngPattern:so,required:io,ngRequired:io,minlength:co,ngMinlength:co,maxlength:ao,ngMaxlength:ao,ngValue:lo,ngModelOptions:po}).directive({ngInclude:jo}).directive(Or).directive(Fo),e.provider({$anchorScroll:It,$animate:Lt,$browser:Dt,$cacheFactory:Rt,$controller:jt,$document:Gt,$exceptionHandler:Vt,$filter:fr,$interpolate:on,$interval:sn,$http:en,$httpBackend:nn,$location:bn,$log:Mn,$parse:Hn,$rootScope:Xn,$q:qn,$$q:Jn,$sce:nr,$sceDelegate:tr,$sniffer:rr,$templateCache:Ot,$templateRequest:or,$$testability:ir,$timeout:sr,$window:pr,$$rAF:Yn,$$asyncCallback:_t})}])}(E),oe(ne).ready(function(){Q(ne,Z)}))}(window,document),window.angular.$$csp()||window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}</style>'),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(t){var c,e,n,r;function u(){var e=n.call(this,t.Services.PrivatePortalServiceParameters.Instance().Environnement,t.Services.PrivatePortalServiceParameters.Instance().LisaPlaceholders)||this;e._localServiceUrl=null,e._localServiceUrl=c.PrivatePortalServiceParameters.Instance().LocalServiceUrl;return e}c=t.Services||(t.Services={}),e=c.Lisa||(c.Lisa={}),n=e.LisaApiBase,__extends(u,n),u.prototype.DemarrerSousProcessusExterne=function(e,t,n,r,o,i){var s=this,a=JSON.stringify(n);return this.libraryManager.Core.sendRequest({url:this._localServiceUrl+"/lanceur/DemarrerProcessus?codeProcessus="+e+"&initData="+a+"&valeurEntree="+(null==r?"":r)+"&horsPortail="+o+"&surTablette="+i,contentType:c.ContentTypeEnum.JSON,method:c.MethodEnum.GET,cache:!1}).then(function(){return c.Loggers.FLASH.INSTANCE.setValue("details",e),u.logger.debug("DemarrerProcessus du Service Local - Success"),s.libraryManager.Core.createPromiseSelfResolved(!0)},function(){return u.logger.error("DemarrerProcessus du Service Local - Failed"),s.libraryManager.Core.createPromiseSelfResolved(!1)})},u.CLASS_NAME="MyWay.Services.Application.LisaApiPetra",u.logger=c.Loggers.LoggerFactory.INSTANCE.getClass(u.CLASS_NAME),r=u,e.LisaApiPetra=r}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Mobilite||(t.Mobilite={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Mobilite||(t.Mobilite={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Mobilite||(t.Mobilite={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Mobilite||(t.Mobilite={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Mobilite||(t.Mobilite={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Mobilite||(t.Mobilite={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Core.defineProperty(t.PhantomAgent,"Trace",{get:function(){return new t.Trace.Logger("PhantomAgent","Manager",this._serviceManager.Library)}})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{}),function(e){var t;(t=e.Services||(e.Services={})).Bug||(t.Bug={})}(MyWay=MyWay||{});
//# sourceMappingURL=C