/**
 * Généré par : SIGCESIE\ct-tfsbuild
 * Changeset TFS : undefined
 * Etiquette TFS : undefined
 * Déclenchement : undefined
 */
var myway;!function(e){var t;!function(e){var t;!function(e){"use strict";e.compteDeDepotModule=angular.module("myway.c0410.compteDeDepot",["myway.c0410.commun","myway.comEditiqueNumerisation","myway.transProduitEngage"])}(t=e.compteDeDepot||(e.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t;!function(e){"use strict";var t;!function(e){e.CLOTURE_TITRE_LABEL="Situation du compte",e.CLOTURE_TYPE=["O","P"],e.HABILITATION_CTX="SHGCCA",e.HABILITATION_PERTE="SHGCCB",e.LIBELLE_ERREUR_HAB_AV="Vous ne possédez pas l'habilitation nécessaire à la modification d'un Compte de depôt",e.LIBELLE_ERREUR_HAB_CL="Vous ne possédez pas l'habilitation nécessaire à la clôture d'un Compte de depôt",e.LIBELLE_ERREUR_HAB_OUV="Vous ne possédez pas l'habilitation nécessaire à l'ouverture d'un Compte de depôt",e.CODE_TYPE_PRODUIT_SERVICE_GCP_TABLE_DELOCALISE="DV7I",e.REFERENCE_PRODUIT_PRINCIPAL="CSPR_DEFINIR_REFERENCE_PRODUIT_PRINCIPAL#",e.CSPR_DEFINIR_ROUTAGE_EDITIQUE="CSPR_DEFINIR_ROUTAGE_EDITIQUE#",e.CODE_HABILITATION_OUVERTURE_AVENANT_CLOTURE="SHGCAB",e.CODE_HABILITATION_MODIFICATION_LIBELLE_PERSONNALISE="SHGCDB",e.CODE_HABILITATION_LECTURE_LIBELLE_PERSONNALISE="SHGCDA",e.CODE_HABILITATION_FORCAGE_OPERATION_FINANCIERE="SHGCAE",e.CODE_HABILITATION_MODIFICATION_REVERSEMENT_AGIO="SHGXAK",e.CODE_HABILITATION_LECTURE_REVERSEMENT_AGIO="SHGCAD",e.CODE_ACTION_DONNEES_DOSSIER_COMMERCIAL_ET_PERSONNE="3",e.NIVEAU_MESSAGE_ERREUR_BLOCANT="B",e.NIVEAU_MESSAGE_ERREUR_INFORMATIF="I",e.CODE_LIBELLE_MSG_FORCE="MSG.FORCE",e.CODE_LIBELLE_FORCAGE="MSG.AUTORISATION",e.CODE_LIBELLE_OPERATIONFINANCIERE_IMPOSSIBLE="MSG.OPFIPB",e.MODE_PRECEDENT="1",e.CODE_FORCAGE="0001",e.CODE_MODE_FINANCIER_VIREMENT_OD="00",e.CODE_MODE_FINANCIER_ESP="01",e.CODE_MODE_FINANCIER_CHEQUE_RECU="02",e.CODE_MODE_FINANCIER_VIR_INTERNE="06",e.CODE_MODE_FINANCIER_VERSEMENT_ESP="07",e.CODE_MODE_FINANCIER_DIVERS="10",e.CODE_MODE_FINANCIER_OUVERTURE_A_ZERO="99",e.TEXTE_BOUTON_OUI="Oui",e.TEXTE_BOUTON_NON="Non",e.TITRE_MODAL_ATTENTION="Attention",e.MESSAGE_CONFIRMATION_PLAFOND_DEPASSE="Vous vous apprêtez à saisir une opération de montant supérieur à %%%% €. Confirmez-vous votre saisie ?",e.MONTANT_SUPERIEUR=1e4,e.TEXTE_BOUTON_VALIDER="Valider",e.TEXTE_BOUTON_ANNULER="Annuler",e.TITRE_MODAL_MISEENPERTE="Clôture pour mise en perte : recommandation et impacts",e.MESSAGE_CONFIRMATION_MISEENPERTE="Vous allez clôturer un compte.<br/>Le choix « clôture pour mise en perte » est réservé aux clients avec lesquels il n'y a plus de relation commerciale.<br/>Ce choix a pour effet de passer en perte le solde débiteur du compte.<br/>Le client, s'il n'est pas déjà en défaut, aura sa note Bâle 2 dégradée à CX.",e.MISE_EN_PERTE="P",e.MISE_EN_CONTENTIEUX="O",e.CODE_OPERATION_OBLIGATOIRE="Le choix de cloture n'a pas été renseigné alors qu'il est obligatoire"}(t=e.Constantes||(e.Constantes={}))}(t=e.compteDeDepot||(e.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},myway;!function(e){var t;!function(t){var i;!function(t){"use strict";var i=function(e){function i(t,i,r,n){e.call(this),this.$q=t,this.serviceAgentExtended=i,this.espaceGlobalService=r,this.serviceTrace=n,this.restServiceUrl="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/contratcdd-v1/contratCDD",this.restPrerequisServiceUrl="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/contratcdd-v1/prerequisOuvertureCDD",this.restExistenceLSEUrl="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/contratcarteservice-v1/existenceLSE",this.listeRatacheUrl="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/contratepargnetradservice-v1/listePsRattache",this.infosCDDUrl="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/contratcdd-v1/caracteristiqueCDD",this.soldeAgiosUrl="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/contratcddservice-v1/calculAgiosRemun",this.resultatEntretien="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/entretiencommercial-v1/resultatEntretien",this.restSuppressionLSEUrl="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/contratcarte-v1/libreServiceEcureuil",this.restTarificationCFNUrl="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/servicecoffrefortnumerique-v1/coffreFortNumerique"}return __extends(i,e),i.prototype.creerCompteDepot=function(e,t,i,r,n,o,a,s,c){var u,l=this,p=this.$q.defer();return o=o?o:"",u=s?{numeroEntiteTitulaire:e,identifiantProduitService:i,numeroOffreSouscrite:t,bordereau:n,codeFamilleGestionProduitService:o,numeroPersonne:c,forcage:s}:{numeroEntiteTitulaire:e,identifiantProduitService:i,numeroOffreSouscrite:t,bordereau:n,codeFamilleGestionProduitService:o,numeroPersonne:c},(angular.isUndefined(c)||null===c)&&delete u.numeroPersonne,a&&(u.codeUniversTracabilite=a),this.serviceAgentExtended.sendRequest({url:this.restServiceUrl,params:u,data:r,withHeaders:!0,method:MyWay.Services.MethodEnum.POST,responseType:MyWay.Services.ResponseTypeEnum.JSON}).then(function(e){l.serviceTrace.debug("creerCompteDepot : La creation de compte de depot est réussie",e),p.resolve(e)})["catch"](function(e){var t="creerCompteDepot: Erreur lors de la creation de compte de depot : "+e.libelle;l.serviceTrace.error(t,e),p.reject(e)}),p.promise},i.prototype.recupererCompteDepot=function(e,t,i,r,n){var o=this,a=this.$q.defer(),s=this.initTimer("recupererCompteDepot","GET",this.restServiceUrl);return this.serviceAgentExtended.sendRequest({url:this.restServiceUrl,params:{codeEtablissement:e,codeGuichet:t,numeroCompte:i},withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){o.updateTimer(s),o.serviceTrace.debug("recupererCompteDepot : La  récupération des données du Compte de Depot est réussie",e),a.resolve(e)})["catch"](function(e){var t="recupererCompteDepot: erreur lors de la récupération des données du Compte de Depot : "+e.libelle;o.serviceTrace.error(t,e),a.reject(e)}),a.promise},i.prototype.modifierCompteDepot=function(e){var t=this,i=this.$q.defer();return this.serviceAgentExtended.sendRequest({url:this.restServiceUrl,data:e,withHeaders:!0,method:MyWay.Services.MethodEnum.PUT}).then(function(e){t.serviceTrace.debug("modifierCompteDepot : La  modification des données du Compte de Depot est réussie",e),i.resolve(e)})["catch"](function(e){var r="modifierCompteDepot: erreur lors de la modification des données du Compte de Depot est echoué: "+e.libelle;t.serviceTrace.error(r,e),i.reject(e)}),i.promise},i.prototype.getPrerequisOuvertureCDD=function(e,t,i,r){var n=this,o=this.$q.defer(),a=this.initTimer("getPrerequisOuvertureCDD","PUT",this.restPrerequisServiceUrl);return this.serviceAgentExtended.sendRequest({url:this.restPrerequisServiceUrl,params:{codeAction:e,codeEtablissement:t,numeroEntiteTitulaire:i},data:angular.copy(r),withHeaders:!0,method:MyWay.Services.MethodEnum.PUT}).then(function(e){n.updateTimer(a),n.serviceTrace.debug("getPrerequisOuvertureCDD : La récuperation des prérequis sur le CDD est réussie",e),o.resolve(e)})["catch"](function(e){var t="getPrerequisOuvertureCDD: Erreur lors de La recuperation des dprérequis sur le CDD  "+e.libelle;n.serviceTrace.error(t,e),o.reject(e)}),o.promise},i.prototype.supprimerCompteDepot=function(e,t,i,r,n,o,a,s,c){var u,l=this,p=this.$q.defer();return u=a?{numeroOffreSouscrite:t,identifiantPersonne:i,numeroEntiteTitulaire:r,identifiantProduitService:n,bordereau:o,forcage:a,indicateurChoixTracabilite:s,codeUniversTracabilite:c}:{numeroOffreSouscrite:t,identifiantPersonne:i,numeroEntiteTitulaire:r,identifiantProduitService:n,bordereau:o,indicateurChoixTracabilite:s,codeUniversTracabilite:c},console.log("----------------> compte-depot-services / contratCDD/delete : ",e),console.log("----------------> compte-depot-services / contratCDD/delete : ",e.detailSolde),this.serviceAgentExtended.sendRequest({url:this.restServiceUrl,params:u,data:e,withHeaders:!0,method:MyWay.Services.MethodEnum.DELETE,responseType:MyWay.Services.ResponseTypeEnum.JSON}).then(function(e){l.serviceTrace.debug("supprimerCompteDepot : La  suppression du compte de depot est réussie",e),p.resolve(e)})["catch"](function(e){var t="supprimerCompteDepot: Erreur lors de la suppression du compte de depot "+e.libelle;l.serviceTrace.error(t,e),p.reject(e)}),p.promise},i.prototype.verifieExistenceLSE=function(e,t,i,r,n){var o=this,a=this.initTimer("verifieExistenceLSE","GET",this.restExistenceLSEUrl),s=this.$q.defer();return this.serviceAgentExtended.sendRequest({url:this.restExistenceLSEUrl,params:{codeEtablissement:e,codeGuichet:t,numeroPersonne:i,numeroCompte:r,dateNaissancePersonne:this.toLocalString(n)},withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){o.updateTimer(a),o.serviceTrace.debug("verifieExistenceLSE : la verification de l'existence du LSE est réussie",e),s.resolve(e)})["catch"](function(e){var t="verifieExistenceLSE: erreur lors de la verification de l'existence du LSE "+e.libelle;o.serviceTrace.error(t,e),s.reject(e)}),s.promise},i.prototype.toLocalString=function(e){return e?e.toISOString():null},i.prototype.toJmaString=function(){var e,t,i,r,n=moment();return e=n.format("DD"),i=n.format("MM"),r=n.format("YYYY"),t=e+i+r,t.toString()},i.prototype.getPrerequisClotureCDD=function(e,t,i,r,n,o){var a=this,s=this.$q.defer();return this.serviceAgentExtended.sendRequest({url:this.listeRatacheUrl,params:{numeroOffreSouscrite:e,codeGuichetInterbancaire:t,codeEtablissement:i,codeTypeProduitService:r,referenceProduitService:n,indicateurMajRMP:o},withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){a.serviceTrace.debug("getPrerequisClotureCDD : get Prerequis Cloture CDD est réussie",e),s.resolve(e)})["catch"](function(e){a.serviceTrace.error("getPrerequisClotureCDD : erreur get Prerequis Cloture CDD "+e.libelle,e),s.reject(e)}),s.promise},i.prototype.getCaracteristiqueCDD=function(e,t,i,r){var n=this,o=this.initTimer("getCaracteristiqueCDD","GET",this.infosCDDUrl),a=this.$q.defer();return this.serviceAgentExtended.sendRequest({url:this.infosCDDUrl,params:{codeEtablissement:e,codeGuichet:t,codeTypeProduitService:i,numeroCompte:r},withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){n.updateTimer(o),n.serviceTrace.debug("getPrerequisClotureCDD :la Restitution des informations d'un compte de dépôt est réussie",e),a.resolve(e)})["catch"](function(e){var t="getPrerequisClotureCDD: Erreur lors de la Restitution des informations d'un compte de dépôt"+e.libelle;n.serviceTrace.error(t,e),a.reject(e)}),a.promise},i.prototype.getCalculAgiosRemun=function(e,t,i,r,n,o,a,s){var c=this,u=this.initTimer("getCalculAgiosRemun","GET",this.soldeAgiosUrl),l=this.$q.defer();return this.serviceAgentExtended.sendRequest({url:this.soldeAgiosUrl,params:{codeEtablissement:e,codeDevise:t,numeroCompteProduitService:i,montantSoldeBrutCDD:r,montantReversementAgios:n,codeAction:o,codeGuichetInterbancaire:a,dateOperation:this.toLocalString(s)},withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){c.updateTimer(u),c.serviceTrace.debug("getCalculAgiosRemun : La récuperation des montant des agios et de la la rémunération à imputer a réussie",e),l.resolve(e)})["catch"](function(e){var t="getCalculAgiosRemun: Erreur lors de la récuperation des montant des agios et de la la rémunération à imputer"+e.libelle;c.serviceTrace.error(t,e),l.reject(e)}),l.promise},i.prototype.postResultatEntretien=function(e,i){var r=this,n=this.$q.defer(),o=this.initTimer("postResultatEntretien","GET",this.resultatEntretien);return this.serviceAgentExtended.sendRequest({url:this.resultatEntretien,params:{versionTraitement:i},data:t.Resultat,withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){r.updateTimer(o),r.serviceTrace.debug("postResultatEntretien : La mémorisation des opérations réalisées sur les produits a réussie",e),n.resolve(e)})["catch"](function(e){var t="postResultatEntretien : Erreur lors de la mémorisation des opérations réalisées sur les produits a réussie"+e.libelle;r.serviceTrace.error(t,e),n.reject(e)}),n.promise},i.prototype.putLibreServiceEcureuil=function(e,t){var i=this,r=this.$q.defer(),n=this.initTimer("putLibreServiceEcureuil","PUT",this.restSuppressionLSEUrl);return this.serviceAgentExtended.sendRequest({url:this.restSuppressionLSEUrl,params:{dateNaissancePersonne:this.toLocalString(t)},data:angular.copy(e),withHeaders:!0,method:MyWay.Services.MethodEnum.PUT}).then(function(e){i.updateTimer(n),i.serviceTrace.debug("putLibreServiceEcureuil : put Libre Service Ecureuil a réussie ",e),r.resolve(e)})["catch"](function(e){var t="putLibreServiceEcureuil : put Libre Service Ecureuil a échouer "+e.libelle;i.serviceTrace.error(t,e),r.reject(e)}),r.promise},i.prototype.getCoffreFortNumerique=function(e,t){var i=this,r=this.$q.defer(),n=this.initTimer("getCoffreFortNumerique","GET",this.restTarificationCFNUrl);return this.serviceAgentExtended.sendRequest({url:this.restTarificationCFNUrl,params:{codeBanque:e,identifiantCoffreFortNumerique:t},withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){i.updateTimer(n),i.serviceTrace.debug("getCoffreFortNumerique : la récuperation du coffre fort numérique est réussie ",e),r.resolve(e)})["catch"](function(e){var t="getCoffreFortNumerique:Erreur lors de la récuperation du coffre fort numérique  "+e.libelle;i.serviceTrace.error(t,e),r.reject(e)}),r.promise},i.prototype.setAgiosRemun=function(e){this._agiosRemun=e},i.prototype.getAgiosRemun=function(){return this._agiosRemun},i.prototype.setCodeGuichetInterbancaire=function(e){this._guichetInterbancaire=e},i.prototype.getCodeGuichetInterbancaire=function(){return this._guichetInterbancaire},i.$inject=["$q","serviceAgentExtended","espaceGlobalService","serviceTrace"],i}(e.c0410.commun.ProduitService);t.CompteDepotService=i,t.compteDeDepotModule.service("compteDepotService",i)}(i=t.compteDeDepot||(t.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var myway;!function(e){var t;!function(t){var i;!function(i){"use strict";!function(e){e[e.DISPONIBLE=0]="DISPONIBLE",e[e.ACTUEL=1]="ACTUEL"}(i.TypeAffichageSolde||(i.TypeAffichageSolde={}));var r=i.TypeAffichageSolde,n=function(t){function n(e,n,o,a,s,c,u,l,p,d,m,f,h,C,E,v){var D=this;t.call(this,n,e,u,a,o),this.$scope=e,this.$q=n,this.compteDepotService=o,this.espaceGlobalService=a,this.serviceAgentExtended=s,this.affectationRadicalService=c,this.compteBddCommunService=u,this.modalService=l,this.postOperationFinanciere=p,this.produitEngageService=d,this.identifiantBordereauService=m,this.libreServiceEcureuilService=f,this.operationFinanciereService=h,this.resultsCommerciauxService=C,this.chequeBanqueService=E,this.serviceTrace=v,this.clotureLabel=i.Constantes.CLOTURE_TITRE_LABEL,this.listeTypeCloture=i.Constantes.CLOTURE_TYPE,this.plusOuMoins="plus",this.afficherDetailSolde=!1,this.comptePourLeSolde=new MyWay.Model.Contrat,this.typeAffichageSolde=r.ACTUEL,this.afficherPerteProfit=!1,this.soldeBrut="Solde brut",this.reversAgiosTrimestriels="Reversement d'agios trimestriels",this.remuBruteAnnuelle="Rémunération brute annuelle",this.fiscaliteAnnuelle="Fiscalité annuelle",this.soldeNetAPayer="Solde net",this.agiosTrimestriels="Agios Trimestriels",this.soldeActuel="Solde Actuel",this.agiosCalcules="Agios calculés",this.tarifCFNLibelle="Tarification coffre fort numérique",this.ID_PRODUIT="compte-de-depot",this.estHabilite=!1,this.tarifCFN=0,this.habilitationCTX="",this.habilitationPERTE="",this.personnes=[],this.eventPS=GestionGeneriqueOffres.Constantes.EvenementsComposantsProduitsService,this.errotab=[],this.boolEndCfn=!0,this.isLoaded=!1,this.isDossierVenteEnCours=!1,this.isCddGSM=!1,this.showPopupMiseEnPerte=function(e){(D.formulaire.operationFinanciere.codeOperation===i.Constantes.MISE_EN_CONTENTIEUX||null===D.formulaire.operationFinanciere.codeOperation||e)&&D.ouverturePopupConfirmationMiseEnPerte().then(function(){},function(e){D.isAgentHabiliteCTX?D.formulaire.operationFinanciere.codeOperation=i.Constantes.MISE_EN_CONTENTIEUX:D.formulaire.operationFinanciere.codeOperation=null})},this.validerDonnees=function(){var e=D.estProduitEngage?D.formulaireProduitEngage.estModifieFormulaire:!1;return D.formulaire&&(D.formulaire.estModifie||e)&&D.enModification&&(D.contexte.donneesProduit.estModifie.valeur=!0),!D.enModification&&D.formulaire.operationFinanciere.montant>i.Constantes.MONTANT_SUPERIEUR?(console.log("ouverture modal",D.formulaire),D.ouverturePopupConfirmationMontant().then(function(e){return D.validationDonnees()},function(e){console.log(e);var t=[],r=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"Montant saisi supérieur à "+i.Constantes.MONTANT_SUPERIEUR.toString()+" €");return t.push(r),t})):D.validationDonnees()},this.miseEnGestion=function(e){if(console.log("CDD ------ >>> miseEnGestion / this.donneesCompteDeDepot",D.donneesCompteDeDepot),D.compteDepotService.erreurPromiseAgios)return D.gererErreurQRGenerique(D.compteDepotService.erreurPromiseAgios);if(D.formulaire&&D.formulaire.intitule===D.detenteur.caracteristiqueEntiteTitulaire.designationEntiteTitulaire&&D.formulaire.viderLeLibelle(),D.enOuverture){var t=!0;return e&&(D.isEligibleSAG=!e.indicateurPapier,t=!1),D.enregistrerCompteDeDepot(t).then(function(e){return e})}if(D.enModification)return D.formulaire&&D.formulaire.estModifie?D.modifierCompteDeDepot().then(function(e){return D.formulaire.formulaireProduitEngage&&D.formulaire.formulaireProduitEngage.estModifieFormulaire&&D.produitEngageService.enregistrerPartageTracab(D.formulaireProduitEngage).then(function(t){return e.erreurs.concat(t.erreurs)}),e})["finally"](function(){D.mettreAJourResultatsCommerciaux()}):D.CompteRenduMiseEnGestionSansModifier(D.donneesCompte).then(function(e){return D.formulaire.formulaireProduitEngage&&D.formulaire.formulaireProduitEngage.estModifieFormulaire&&D.produitEngageService.enregistrerPartageTracab(D.formulaireProduitEngage).then(function(t){return e.erreurs.concat(t.erreurs)}),e})["finally"](function(){D.mettreAJourResultatsCommerciaux()});if(D.enCloture){var i=!0;return e&&(D.isEligibleSAG=!e.indicateurPapier,i=!1),D.verifierPrerequis(!0,!0,!0).then(function(e){if(!_.isEmpty(D.listeErreursBloquantesCloture)){var t=new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(D.listeErreursBloquantesCloture);return D.$q.when(t)}return D.supprimerDonneesCompteDeDepot(i).then(function(e){return e})})}},this.detenteur=this.contexte.donneesProduit.detenteur,console.log("XXXX CompteDepotControleur "+this.idegps+" =>  constructor() : detenteur  ",this.detenteur),this.personnes=this.contexte.personnes,this.contexte.personnes&&this.contexte.personnes.length>0&&(this.dateNaissance=new Date(this.contexte.personnes[0].particulierInformation.dateNaissance)),this.initialiserComposant(),this.$scope.$emit(this.eventPS.CSPR_DEFINIR_ROUTAGE_EDITIQUE+"#"+this.idBloc,{valeur:GestionGeneriqueOffres.Types.SpaEditiques.BouquetLiberteEtAssimiles}),this.initPointEntree(),this.listeErreursBloquantesCloture=[],this.listeErreursBloquantesAgiosCloture=[],this.isCantonnement=1544===this.idegps,this.isCddGSM=5672===this.idegps}return __extends(n,t),n.prototype.isCrossCanal=function(){return this.contexte.dossierVente.donneePrincipale.codeCanalCreation!==this.contexte.offreSouscrite.codeCanal},n.prototype.isModeFinancierPresentTLEtFF=function(e){return e===i.Constantes.CODE_MODE_FINANCIER_VIR_INTERNE||e===i.Constantes.CODE_MODE_FINANCIER_CHEQUE_RECU},n.prototype.getNumeroPersonnes=function(){var e=[];return this.personnes.forEach(function(t){e.push(t.identifiantPersonne.toString())}),e},n.prototype.initialiserEnOuverture=function(){var t=this,r=[];if(this.formulaire=this.espaceGlobalService.getObjetGenerique(this.identifiantFormulaire),this.contexteAppel===i.Constantes.MODE_PRECEDENT&&this.contexte.modeAffichage!==GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif&&this.formulaire)this.formulaire&&this.formulaire.operationFinanciere&&!this.formulaire.operationFinanciere.estForcageOperationFinanciere&&(this.formulaire.operationFinanciere.estForcageOperationFinanciere=!0);else{var n=this.contexte.catalogue.produitService.produitCaracteristique.libelleProduitService.toUpperCase(),o=this.contexte.catalogue.produitService.produitCaracteristique.identifiantProduitService,a=!this.formulaire&&this.contexte.indicateurDossierVenteAutorise;if(this.formulaire=new i.CompteDepotFormulaire(this.identifiantFormulaire,this.contexte.etablissement.codeEtablissement,this.contexte.etablissement.codeGuichetInterbancaire,this.contexte.donneesProduit.produit.produitCaracteristique,n,this.getNumeroPersonnes(),this.contexte.offreSouscrite.numeroPersonneIdentifiee.toString(),this.codeActeGestion.substring(0,2),this.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService,o,this.contexte.offreSouscrite.codeCanal,a),this.donneesSauvegarde){var s=this.donneesSauvegarde.donneesPrincipales;s.compteDeDepot&&s.compteDeDepot.numeroCompte&&(this.donneesCompte=new e.c0410.commun.DonneesCompte(s.compteDeDepot.numeroCompte),this.donneesCompte.codeEtablissement=s.compteDeDepot.codeEtablissement,this.donneesCompte.codeGuichet=s.compteDeDepot.codeGuichet,this.espaceGlobalService.enregistrerObjetGenerique(this.donneesCompte)),this.isDossierVenteEnCours=!0}if(this.contexte.indicateurDossierVenteAutorise&&this.donneesSauvegarde){var c=this.donneesSauvegarde.donneesSecondaires.donneesSauvegardeOpeFi.codeModeFinancier;!this.isCrossCanal()||this.isCrossCanal()&&this.isModeFinancierPresentTLEtFF(c)?r.push(this.restaurerDossierDeVente()):this.isLoaded=!0}}return this.$q.all(r).then(function(){return t.verifieHabilitationsEnOuverture().then(function(e){return e?t.contexte.modeAffichage===GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif?(t.enRecapitulatif=!0,t.formulaire=t.espaceGlobalService.getObjetGenerique(t.identifiantFormulaire),console.log("*** DEBUG ***: initialiserEnOuverture , this.formulaire",t.formulaire),t.initFormulaireEnOuverture().then(function(){return t.donneesCompte&&(t.numeroCompteCodeGuichet=t.donneesCompte.codeEtablissement+"-"+t.donneesCompte.codeGuichet+"-"+t.donneesCompte.numeroDeCompte),t.estLibelleVide()&&(t.formulaire.intitule=t.detenteur.caracteristiqueEntiteTitulaire.designationEntiteTitulaire),t.initialiserDonneesProduitEngage()})):(t.formulaire.habilitations=t.cddHabilitations,t.verifierPrerequis(!0,!1).then(function(e){return t.initialiserDonneesProduitEngage()})):t.initialiserDonneesProduitEngage()})["catch"](function(e){var i=" Erreur lors de La  verification des Habilitations en ouverture : "+e.libelle;return t.errotab.push(e,t.idBloc),t.$scope.$emit(t.eventPS.CSPR_CHARGEMENT_ECHEC,t.errotab),t.serviceTrace.error(i,e),!1})})},n.prototype.initFormulaireEnOuverture=function(){if(!this.formulaire&&this.contexte.indicateurDossierVenteAutorise)return this.rechargerRecapVPC();if(this.donneesCompte=this.espaceGlobalService.getObjetGenerique(e.c0410.commun.DonneesCompte.IDENTIFIANT_DONNEES_COMPTE),this.formulaire&&(this.setModeFinancierPourRecap(this.formulaire.operationFinanciere.segmentPrvRio),console.log("*** DEBUG ***: initFormulaireEnOuverture , this.formulaire",this.formulaire)),this.isCantonnement){var t=new i.ModeFinancier,r=new i.LibelleOperation;t.CIJMMC="O",t.CIJMMS="O",t.CTGXM1="01",t.CTGXMF="ESP",t.LIJMMI="ESPECES",r.libelleCourt="OV ESP",r.libelleLong="OUVERTURE ESPECES",this.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation=0,this.formulaire.operationFinanciere.modeFinancier=t,this.formulaire.operationFinanciere.estValide=!0,this.formulaire.operationFinanciere.libelleOperation=r,this.formulaire.operationFinanciere.nouveauSoldeCompteVirementApresVirement=0,this.formulaire.operationFinanciere.soldeCompteAvantVirement=0,this.formulaire.operationFinanciere.billetterieOuvertParDefaut=!1,this.formulaire.operationFinanciere.estForcageOperationFinanciere=!0}else if(this.isCddGSM){var t=new i.ModeFinancier,r=new i.LibelleOperation;t.CIJMMC="O",t.CIJMMS="O",t.CTGXM1="01",t.CTGXMF="ESP",t.LIJMMI="ESPECES",r.libelleCourt="OV ESP",r.libelleLong="OUVERTURE ESPECES",this.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation=0,this.formulaire.operationFinanciere.modeFinancier=t,this.formulaire.operationFinanciere.estValide=!0,this.formulaire.operationFinanciere.libelleOperation=r,this.formulaire.operationFinanciere.nouveauSoldeCompteVirementApresVirement=0,this.formulaire.operationFinanciere.soldeCompteAvantVirement=0,this.formulaire.operationFinanciere.billetterieOuvertParDefaut=!1,this.formulaire.operationFinanciere.estForcageOperationFinanciere=!0}return this.$q.when(!0)},n.prototype.verifieHabilitationsEnOuverture=function(){var e=this,t=this.$q.defer(),r=[i.Constantes.CODE_HABILITATION_OUVERTURE_AVENANT_CLOTURE,i.Constantes.CODE_HABILITATION_MODIFICATION_LIBELLE_PERSONNALISE],n=this.compteDepotService.initTimer("verifieHabilitationsEnOuverture : "+r.toString()),o=[];return this.serviceAgentExtended.Habilitation.EstHabilite(r).then(function(r){e.compteDepotService.updateTimer(n),e.cddHabilitations=new i.CompteDepotHabilitations,e.cddHabilitations.isHabiliteOuvertureAveantClotureCDD=r[0],e.cddHabilitations.isHabiliteModificationLibellePersonnalise=r[1],e.cddHabilitations.isHabiliteOuvertureAveantClotureCDD||(o.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,i.Constantes.LIBELLE_ERREUR_HAB_OUV)),e.$scope.$emit(e.eventPS.CSPR_EMISSION_ERREUR+"#"+e.idBloc,o));var a="verifieHabilitationsEnOuverture: OK";e.serviceTrace.debug(a,r),t.resolve(r[0])})["catch"](function(i){e.compteDepotService.updateTimer(n);var r="verifieHabilitationsEnOuverture: Erreur lors de La verification habilitation en ouverture : "+i.libelle;e.serviceTrace.error(r,i),e.errotab.push(i,e.idBloc),e.$scope.$emit(e.eventPS.CSPR_CHARGEMENT_ECHEC,e.errotab),t.reject(i)}),t.promise},n.prototype.initialiserEnAvenant=function(){var t=this;if(this.contexteAppel===i.Constantes.MODE_PRECEDENT&&this.contexte.modeAffichage!==GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif)return this.formulaire=this.espaceGlobalService.getObjetGenerique(this.identifiantFormulaire),this.formulaire&&this.formulaire.operationFinanciere&&this.formulaire.operationFinanciere.estForcageOperationFinanciere&&(this.formulaire.operationFinanciere.estForcageOperationFinanciere=!0),this.initialiserDonneesProduitEngage();var r=this.contexte.donneesProduit.detenteur;this.contexte.referencesProduits.forEach(function(i){i.identifiantProduitService===t.idegps&&i.detenteur===r&&(t.donneesCompte=new e.c0410.commun.DonneesCompte(i.referenceProduitServiceContrat),t.donneesCompte.codeEtablissement=i.codeEtablissementContrat,t.donneesCompte.codeGuichet=i.codeGuichetContrat,t.espaceGlobalService.enregistrerObjetGenerique(t.donneesCompte),t.definirReferenceProduitPrincipal(i.codeEtablissementContrat,i.codeGuichetContrat,i.referenceProduitServiceContrat))});var n=[];return n.push(this.verifieHabilitationEnAvenant()),n.push(this.getCompteDeDepot()),this.$q.all(n).then(function(e){return e[0]?t.initFormulaireEnAvenant(e[1]).then(function(){return t.estLibelleVide()&&(t.formulaire.intitule=t.detenteur.caracteristiqueEntiteTitulaire.designationEntiteTitulaire),t.espaceGlobalService.enregistrerObjetGenerique(new i.CompteDepotGenerique(e[1].compteDeDepot)),t.initialiserDonneesProduitEngage()}):t.initialiserDonneesProduitEngage()})["catch"](function(e){var i=" initialiserEnAvenant : Erreur lors de La verification des Habilitations en avenant / chargement CDD : "+e.libelle;return t.serviceTrace.error(i,e),t.errotab.push(e,t.idBloc),t.$scope.$emit(t.eventPS.CSPR_CHARGEMENT_ECHEC,t.errotab),!1})},n.prototype.initFormulaireEnAvenant=function(e){var t;return this.contexte.modeAffichage===GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif?(this.formulaire=this.espaceGlobalService.getObjetGenerique(this.identifiantFormulaire),!this.formulaire&&this.contexte.indicateurDossierVenteAutorise&&(t=this.rechargerRecapVPC()),this.formulaireRecapAvenant=new i.CompteDepotFormulaire(this.identifiantFormulaire),this.formulaire&&this.formulaire.estModifie&&(this.compteDepotModifier=this.formulaire.estModifie),this.formulaireRecapAvenant.setDonneesCompteDeDepot(e),this.numeroCompteCodeGuichet=this.donneesCompte.codeEtablissement+"-"+this.donneesCompte.codeGuichet+"-"+this.donneesCompte.numeroDeCompte,this.enRecapitulatif=!0):this.contexteAppel===i.Constantes.MODE_PRECEDENT?this.formulaire=this.espaceGlobalService.getObjetGenerique(this.identifiantFormulaire):(this.formulaire=new i.CompteDepotFormulaire(this.identifiantFormulaire),this.formulaire.setDonneesCompteDeDepot(e),this.contexte.indicateurDossierVenteAutorise&&this.donneesSauvegarde&&(t=this.restaurerDossierDeVente()),this.formulaire.habilitations=this.cddHabilitations),t?t:this.$q.when(!0)},n.prototype.initialiserEnCloture=function(){var t=this,r=this.$q.defer(),n="C04.10 --> Compte de dépot --> comptedepot-controleur --> lancerClotureCompteDepot --> ";if(this.serviceTrace.info(n+"this.contexteAppel",this.contexteAppel),this.serviceTrace.info(n+"Constantes.MODE_PRECEDENT",i.Constantes.MODE_PRECEDENT),this.contexteAppel!==i.Constantes.MODE_PRECEDENT||this.contexte.modeAffichage===GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif){this.typecloture="N";var o=this.contexte.donneesProduit.detenteur;return this.contexte.referencesProduits.forEach(function(i){i.identifiantProduitService===t.idegps&&i.detenteur===o&&(t.donneesCompte=new e.c0410.commun.DonneesCompte(i.referenceProduitServiceContrat),t.donneesCompte.codeEtablissement=i.codeEtablissementContrat,t.donneesCompte.codeGuichet=i.codeGuichetContrat,t.espaceGlobalService.enregistrerObjetGenerique(t.donneesCompte),t.definirReferenceProduitPrincipal(i.codeEtablissementContrat,i.codeGuichetContrat,i.referenceProduitServiceContrat))}),this.verifieHabilitationEnAvenant().then(function(e){return e?t.getCompteDeDepot().then(function(e){return t.serviceTrace.info("GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif",GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif),t.serviceTrace.info("typeof GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif",typeof GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif),t.serviceTrace.info("this.contexte.modeAffichage",t.contexte.modeAffichage),t.serviceTrace.info("typeof this.contexte.modeAffichage",typeof t.contexte.modeAffichage),t.initFormulaireEnCloture(e).then(function(){t.serviceTrace.info("this.formulaire",t.formulaire),t.estLibelleVide()&&(t.formulaire.intitule=t.detenteur.caracteristiqueEntiteTitulaire.designationEntiteTitulaire),t.espaceGlobalService.enregistrerObjetGenerique(new i.CompteDepotGenerique(e.compteDeDepot)),r.resolve(!0)})}):t.initialiserDonneesProduitEngage().then(function(){r.resolve(!0)})}),r.promise}this.formulaire=this.espaceGlobalService.getObjetGenerique(this.identifiantFormulaire),this.formulaire&&this.formulaire.operationFinanciere&&this.formulaire.operationFinanciere.estForcageOperationFinanciere&&(this.formulaire.operationFinanciere.estForcageOperationFinanciere=!0),this.initialiserDonneesProduitEngage().then(function(){r.resolve(!0)})},n.prototype.initFormulaireEnCloture=function(e){var t=this,r=this.$q.defer();return this.contexte.modeAffichage===GestionGeneriqueOffres.Types.ModeAffichage.Recapitulatif?(this.formulaire=this.espaceGlobalService.getObjetGenerique(this.identifiantFormulaire),this.serviceTrace.info("this.identifiantFormulaire",this.identifiantFormulaire),this.serviceTrace.info("this.formulaire",this.formulaire),this.formulaireRecapAvenant=new i.CompteDepotFormulaire(this.identifiantFormulaire),this.formulaire&&this.formulaire.estModifie&&(this.compteDepotModifier=this.formulaire.estModifie),this.formulaireRecapAvenant.setDonneesCompteDeDepot(e),this.numeroCompteCodeGuichet=this.donneesCompte.codeEtablissement+"-"+this.donneesCompte.codeGuichet+"-"+this.donneesCompte.numeroDeCompte,this.enRecapitulatif=!0,r.resolve(!0)):this.contexteAppel===i.Constantes.MODE_PRECEDENT?(this.formulaire=this.espaceGlobalService.getObjetGenerique(this.identifiantFormulaire),r.resolve(!0)):(this.boolEndCfn=!1,this.getDonneesCDD().then(function(){
t.formulaire.operationFinanciere.montant=t.soldeNetCDD,t.formulaire.detailSolde=new i.DetailSolde(t.infosCDD.informationsCDD.soldeMinuteCompte,t.agiosRemu.montantAgiosImputes,t.agiosRemu.montantBrutRemunerationCDD,t.agiosRemu.montantTotalPrelevements,t.agiosRemu.soldeNetCDD,t.agiosRemu.montantReversementAgios,t.agiosRemu.montantPartRemunCDDFiscalite),t.formulaire.agiosRemu=t.agiosRemu;var n=t.$q.when(!0);t.agiosRemu.soldeNetCDD<0&&(n=t.initFormulaireClotureEnPerte()),t.formulaire.setDonneesCompteDeDepot(e),t.formulaire.operationFinanciere.compte.rice.radical=e.compteDeDepot.numeroCompte.substring(2,9),t.formulaire.operationFinanciere.compte.rice.cleCompte=e.compteDeDepot.numeroCompte.substring(9,11),t.formulaire.operationFinanciere.compte.rice.cleRice=e.compteDeDepot.numeroCompte.substring(11,13),t.comptePourLeSolde.riceContrat=t.formulaire.operationFinanciere.compte.rice.formatRicePourStructureEchange(),t.comptePourLeSolde.devise=t.formulaire.operationFinanciere.compte.devise,t.comptePourLeSolde.codeDeviseContrat=t.formulaire.operationFinanciere.compte.devise.code,t.boolEndCfn=!0,t.formulaire.habilitations=t.cddHabilitations,n.then(function(){t.verifierPrerequis(!0,!1,!0).then(function(e){t.initialiserDonneesProduitEngage().then(function(){r.resolve(!0)})})})})["catch"](function(e){var i=[],n=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"Impossible de recuperer les données du compte de dépôt pour les raisons suivantes: "+e.libelle+" "+e.valeurs);i.push(n),t.listeErreursBloquantesAgiosCloture.push(n),t.$scope.$emit("CSPR_EMISSION_ERREUR#"+t.idBloc,i),r.resolve(!1)})),r.promise},n.prototype.initFormulaireClotureEnPerte=function(){var e=this;this.afficherPerteProfit=!0;var t=[];return t.push(this.EstHabilite(i.Constantes.HABILITATION_CTX)),t.push(this.EstHabilite(i.Constantes.HABILITATION_PERTE)),this.$q.all(t).then(function(t){e.isAgentHabiliteCTX=t[0],e.isAgentHabiliteCTX?e.formulaire.operationFinanciere.codeOperation="O":(e.habilitationCTX=i.Constantes.HABILITATION_CTX,e.formulaire.operationFinanciere.codeOperation=""),e.isAgentHabilitePERTE=t[1],e.isAgentHabilitePERTE&&""===e.formulaire.operationFinanciere.codeOperation&&(e.formulaire.operationFinanciere.codeOperation="P",e.isAgentHabiliteCTX||e.showPopupMiseEnPerte(!0)),""===e.habilitationCTX?e.habilitationPERTE=i.Constantes.HABILITATION_PERTE:e.isAgentHabilitePERTE||(e.habilitationPERTE=" et "+i.Constantes.HABILITATION_PERTE)})["finally"](function(){e.editOpefiEnPerte(e.agiosRemu)})},n.prototype.getCompteDeDepot=function(){var e=this,t=this.$q.defer();return this.compteDepotService.recupererCompteDepot(this.donneesCompte.codeEtablissement,this.donneesCompte.codeGuichet,this.donneesCompte.numeroDeCompte).then(function(r){e.donneesCompteDeDepot=new i.DonneesCompteDeDepot(r),e.donneesCompteDeDepot.miseAjourDuModeleDepuisParametre(e.donneesCompte.codeEtablissement,e.donneesCompte.codeGuichet,e.donneesCompte.numeroDeCompte),t.resolve(r)})["catch"](function(i){var r=" lancerAvenantCompteDepotgetCompteDeDepot : Erreur lors de get Compte De Depott  : "+i.libelle;e.serviceTrace.error(r,i),e.errotab.push(i,e.idBloc),e.$scope.$emit(e.eventPS.CSPR_CHARGEMENT_ECHEC,e.errotab),t.reject(i)}),t.promise},n.prototype.estLibelleVide=function(){return angular.isDefined(this.formulaire)&&this.formulaire&&angular.isDefined(this.formulaire.intitule)&&(null===this.formulaire.intitule||""===this.formulaire.intitule)},n.prototype.EstHabiliteMultiple=function(e){var t=this.$q.defer();return this.serviceAgentExtended.Habilitation.EstHabilite(e).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t.promise},n.prototype.EstHabilite=function(e){var t=this.$q.defer();return this.serviceAgentExtended.Habilitation.EstHabilite(e).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t.promise},n.prototype.verifieHabilitationEnAvenant=function(){var e=this,t=[],r=[i.Constantes.CODE_HABILITATION_OUVERTURE_AVENANT_CLOTURE,i.Constantes.CODE_HABILITATION_LECTURE_REVERSEMENT_AGIO,i.Constantes.CODE_HABILITATION_MODIFICATION_REVERSEMENT_AGIO,i.Constantes.CODE_HABILITATION_LECTURE_LIBELLE_PERSONNALISE,i.Constantes.CODE_HABILITATION_MODIFICATION_LIBELLE_PERSONNALISE],n=this.compteDepotService.initTimer("verifieHabilitationEnAvenant: serviceAgentExtended.Habilitation.EstHabilite : "+r.toString());return this.EstHabiliteMultiple(r).then(function(r){return e.compteDepotService.updateTimer(n),e.cddHabilitations=new i.CompteDepotHabilitations,e.cddHabilitations.isHabiliteOuvertureAveantClotureCDD=r[0],e.cddHabilitations.isHabiliteLectureReversementAgio=r[1],e.cddHabilitations.isHabiliteModificationReversementAgio=r[2],e.cddHabilitations.isHabiliteLectureLibellePersonnalise=r[3],e.cddHabilitations.isHabiliteModificationLibellePersonnalise=r[4],e.cddHabilitations.isHabiliteOuvertureAveantClotureCDD||(t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,i.Constantes.LIBELLE_ERREUR_HAB_AV)),e.$scope.$emit(e.eventPS.CSPR_EMISSION_ERREUR+"#"+e.idBloc,t)),e.cddHabilitations.isHabiliteLectureLibellePersonnalise||e.cddHabilitations.isHabiliteLectureReversementAgio&&e.cddHabilitations.isHabiliteModificationReversementAgio||(e.contexte.donneesProduit.invisible.valeur=!0),r[0]})["catch"](function(t){e.compteDepotService.updateTimer(n);var i="verifieHabilitationEnAvenant: Erreur lors de La verification Habilitation Avenant  : "+t.libelle;return e.serviceTrace.error(i,t),e.errotab.push(t,e.idBloc),e.$scope.$emit(e.eventPS.CSPR_CHARGEMENT_ECHEC,e.errotab),null})},n.prototype.reserverNumeroDeCompte=function(){var t=this,i=this.contexte.donneesProduit.produit.produitCaracteristique.codeTypeProduitService.substring(2,this.contexte.donneesProduit.produit.produitCaracteristique.codeTypeProduitService.length);return this.isNumeroDeCompteReserve()?(this.donneesCompte=this.espaceGlobalService.getObjetGenerique(e.c0410.commun.DonneesCompte.IDENTIFIANT_DONNEES_COMPTE),this.$q.when(this.donneesCompte.numeroDeCompte)):this.affectationRadicalService.getAffectationAutoRadical(this.contexte.etablissement.codeEtablissement,this.contexte.donneesProduit.produit.produitCaracteristique.codeTypeProduitService,this.contexte.etablissement.codeGuichetInterbancaire).then(function(r){t.formulaire.operationFinanciere.compte.rice=r;var n=new e.c0410.commun.DonneesCompte(i+r.radical+r.cleCompte);return t.enOuverture&&(n.codeEtablissement=t.contexte.etablissement.codeEtablissement,n.codeGuichet=t.contexte.etablissement.codeGuichetInterbancaire),t.espaceGlobalService.enregistrerObjetGenerique(n),i+r.radical+r.cleCompte})},n.prototype.isNumeroDeCompteReserve=function(){for(var t=!1,i=0;!t&&i<this.espaceGlobalService.getListeObjetsGeneriques().length;)this.espaceGlobalService.getListeObjetsGeneriques()[i]instanceof e.c0410.commun.DonneesCompte&&(t=!0),i++;return t},n.prototype.verifierPrerequis=function(e,t,r){var n=this,o=[];this.personnes.forEach(function(e){o.push({numeroPersonne:e.getId,listeMessagesErreurPrerequisOuvertureCDD:[]})});var a=[];if(this.enOuverture)return this.compteDepotService.getPrerequisOuvertureCDD(i.Constantes.CODE_ACTION_DONNEES_DOSSIER_COMMERCIAL_ET_PERSONNE,this.contexte.etablissement.codeEtablissement,this.contexte.entitesTitulaires[0].caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire,o).then(function(t){return t.forEach(function(e){e.listeMessagesErreurPrerequisOuvertureCDD.forEach(function(e){if(e.niveauMessageErreur===i.Constantes.NIVEAU_MESSAGE_ERREUR_BLOCANT){var t=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,e.libelleMessageErreur);a.push(t)}else if(e.niveauMessageErreur===i.Constantes.NIVEAU_MESSAGE_ERREUR_INFORMATIF){var t=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Warning,1,e.libelleMessageErreur);a.push(t)}})}),e&&a.length>0&&n.$scope.$emit(n.eventPS.CSPR_EMISSION_ERREUR+"#"+n.idBloc,a),a})["catch"](function(t){var i=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"Prérequis non rempli sur le Compte de depôt pour la raison suivante:"+t.valeurs);a.push(i);var r="verifierPrerequis  : Prérequis non rempli sur le Compte de depôt pour la raison suivante : "+t.libelle;return n.serviceTrace.error(r,t),e&&n.$scope.$emit(n.eventPS.CSPR_EMISSION_ERREUR+"#"+n.idBloc,a),a});if(this.enCloture){var s=Array();return this.agiosRemu=this.compteDepotService.getAgiosRemun(),this.formulaire&&(this.formulaire.codeActionModeCloture=this.typecloture),this.formulaire&&this.agiosRemu&&this.agiosRemu.soldeNetCDD<0&&(this.formulaire.operationFinanciere.segmentPrvRio.libelleOperation1="O"===this.formulaire.operationFinanciere.codeOperation?"Cloture mise en contentieux":"Cloture pour mise en perte",this.formulaire.codeActionModeCloture=this.formulaire.operationFinanciere.codeOperation),console.log("*************** Question getPrerequisClotureCDD *****************"),console.log({numeroOffreSouscrite:this.contexte.offreSouscrite.numeroOffreSouscrite,codeGuichetInterbancaire:this.donneesCompte.codeGuichet,codeEtablissement:this.donneesCompte.codeEtablissement,codeTypeProduitService:this.contexte.donneesProduit.produit.produitCaracteristique.codeTypeProduitService,referenceProduitService:this.donneesCompte.numeroDeCompte}),this.compteDepotService.getPrerequisClotureCDD(this.contexte.offreSouscrite.numeroOffreSouscrite,this.donneesCompte.codeGuichet,this.donneesCompte.codeEtablissement,this.contexte.donneesProduit.produit.produitCaracteristique.codeTypeProduitService,this.donneesCompte.numeroDeCompte,t).then(function(e){return console.log(e),r&&(n.formulaire&&n.agiosRemu&&n.agiosRemu.soldeNetCDD<0&&n.formulaire.operationFinanciere.segmentPrvRio&&(n.formulaire.operationFinanciere.segmentPrvRio.libelleOperation1="O"===n.formulaire.operationFinanciere.codeOperation?"Cloture mise en contentieux":"Cloture pour mise en perte"),e.listeServicesBloquants&&0!==e.listeServicesBloquants.length&&e.listeServicesBloquants.forEach(function(e){s.push(e);var t=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,e.messageErreur.libelle);a.push(t),n.listeErreursBloquantesCloture.push(t)}),e.listeServicesClotureSuppression&&0!==e.listeServicesClotureSuppression.length&&e.listeServicesClotureSuppression.forEach(function(e){s.push(e);var t=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Erreur,1,e.messageErreur.libelle);a.push(t)}),e.listeServicesInformations&&0!==e.listeServicesInformations.length&&e.listeServicesInformations.forEach(function(e){s.push(e);var t=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Warning,1,e.messageErreur.libelle);a.push(t)})),angular.forEach(s,function(e){delete e.messageErreur}),n.formulaire&&n.formulaire.listeServices&&(n.formulaire.listeServices=s),n.enCloture&&a.length>0&&n.$scope.$emit(n.eventPS.CSPR_INFO_PREREQUIS_CLOTURE+"#"+n.idBloc,a),a})["catch"](function(e){var t=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"Prérequis non rempli sur le Compte de depôt pour la raison suivante:"+e.libelle+e.valeurs);a.push(t),n.$scope.$emit(n.eventPS.CSPR_EMISSION_ERREUR+"#"+n.idBloc,a);var i="verifierPrerequis  : Prérequis non rempli sur le Compte de depôt pour la raison suivante : "+e.libelle;return n.serviceTrace.error(i,e),n.enCloture&&n.$scope.$emit(n.eventPS.CSPR_INFO_PREREQUIS_CLOTURE+"#"+n.idBloc,a),a})}return this.$q.when([])},n.prototype.afficherDetailSoldeEnCloture=function(){"plus"===this.plusOuMoins?(this.afficherDetailSolde=!0,this.plusOuMoins="moins"):(this.afficherDetailSolde=!1,this.plusOuMoins="plus")},n.prototype.getDonneesCDD=function(){var e=this,t=this.$q.defer();return this.compteDepotService.getCaracteristiqueCDD(this.donneesCompte.codeEtablissement,this.donneesCompte.codeGuichet,this.contexte.donneesProduit.produit.produitCaracteristique.codeTypeProduitService,this.donneesCompte.numeroDeCompte).then(function(r){e.infosCDD=r,e.compteDepotService.getCalculAgiosRemun(e.donneesCompte.codeEtablissement,r.informationsCDD.codeDevise,e.donneesCompte.numeroDeCompte,r.informationsCDD.soldeMinuteCompte,0,"N",e.donneesCompte.codeGuichet,new Date).then(function(n){var o=e.contexte.catalogue.produitService.produitCaracteristique.libelleProduitService.toUpperCase();e.formulaire=new i.CompteDepotFormulaire(e.identifiantFormulaire,e.contexte.etablissement.codeEtablissement,e.donneesCompte.codeGuichet,e.contexte.donneesProduit.produit.produitCaracteristique,o,e.getNumeroPersonnes(),e.contexte.offreSouscrite.numeroPersonneIdentifiee.toString(),e.codeActeGestion.substring(0,2),e.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService),e.agiosRemu=n,e.compteDepotService.setAgiosRemun(n),console.log("CDD ----------------> comptedepot-controleur.ts / calculAgiosRemun :",n),e.initCFN().then(function(){e.soldeNetCDD=e.agiosRemu.soldeNetCDD-(e.tarifCFN?e.tarifCFN:0),t.resolve(r)})})["catch"](function(i){e.serviceAgentExtended.Trace.error("ERREUR LORS DE LA RECUPERATION DES AGIOS"+i.libelle),e.compteDepotService.erreurPromiseAgios=i,t.reject(i)})}),t.promise},n.prototype.initCFN=function(){var e=this;return this.produitCFN=_.find(this.contexte.referencesProduits,function(e){return 1667===e.identifiantProduitService}),this.produitCFN?this.compteDepotService.getCoffreFortNumerique(this.donneesCompte.codeEtablissement,this.produitCFN.referenceProduitServiceContrat).then(function(t){return e.tarifCFN=t.montantTarificationService/100,t}):this.$q.when(null)},n.prototype.editOpefiEnPerte=function(e){angular.isUndefined(this.formulaire.operationFinanciere.codeOperation)&&"O"!==this.typecloture&&(this.typecloture="O",this.formulaire.operationFinanciere.codeOperation="O");var t,r=new i.DetailBilleterie(1,new i.Coupure(0,0,0,0,0,0,0),0),n=Array(),o=new i.SegmentPrjo,a=new i.ModeFinancier;t=this.formulaire.operationFinanciere.codeOperation?"O"===this.formulaire.operationFinanciere.codeOperation?"Cloture mise en contentieux":"Cloture pour mise en perte":"Cloture mise en contentieux";for(var s=0;3>s;s++)n.push(new i.OperationRepartition("",0,""));var c=new i.SegmentPrvRio(null,"Remboursement pour la clôture COMPTE DE DEPOT","110000110110000000000000000000","Valider",null,null,"EUR",this.donneesCompte.codeEtablissement+this.donneesCompte.codeGuichet+this.donneesCompte.numeroDeCompte,"  ","10","C01","","DIV","EUR",e.soldeNetCDD,t,"","","","","","","","","","N","O","","000","1","","",0,"","000","","","N",r,n,"","",null);this.formulaire.operationFinanciere.segmentPrvRio=c,this.formulaire.operationFinanciere.segmentPrjo=o,this.formulaire.operationFinanciere.titrePanelPrincipal="Informations opération",this.formulaire.operationFinanciere.billetterieOuvertParDefaut=!1,this.formulaire.operationFinanciere.chequeBanqueOperation=null,this.formulaire.operationFinanciere.estValide=!0,this.formulaire.operationFinanciere.nouveauSoldeCompteVirementApresVirement=0,this.formulaire.operationFinanciere.libelleOperation=new i.LibelleOperation,this.formulaire.operationFinanciere.modeFinancier=a,this.formulaire.operationFinanciere.detailDuSolde=this.formulaire.operationFinanciere.detailDuSolde,this.getDonneesAuthentification()},n.prototype.getDonneesAuthentification=function(){var t=this;this.serviceAgentExtended.getAuthentificationInfo().then(function(i){t.serviceAgentExtended.getParametresComptables().then(function(r){var n=new e.comOpesFinancieres.Model.ContexteSaisieOperationFinanciere;n.codeEtablissement=i.codeEtablissement,n.referenceExterneAgent=i.agentConnecte.referenceExterneAgent,n.edsExterneGuichetComptable=r.edsExterneGuichetComptable,n.edsExterneRattachementGuichetComptable=r.edsExterneRattachementGuichetComptable,n.dateOperationJourneeComptable=r.dateOperationJourneeComptable,n.libelleEdsRattachementGuichetComptable=r.libelleEdsRattachementGuichetComptable,n.numTelEdsRattachementguichetComptable=r.numTelEdsRattachementGuichetComptable,n.typeCA=r.typeCA;var o=i.agentConnecte.ligne6Adresse.split(" ")[1];n.localiteEdsExterneGuichetComptable=o,t.formulaire.operationFinanciere.contexteSaisieOperationFinanciere=n})["catch"](function(e){var i="getDonneesAuthentification  : Problème de récupération des paramètres comptables , getParametresComptables: "+e.libelle;t.serviceTrace.error(i,e),t.serviceAgentExtended.Trace.error("Problème de récupération des paramètres comptables","getParametresComptables",e)})})["catch"](function(e){var i="getDonneesAuthentification  : Problème de récupération des données dauthentification ,getAuthentificationInfo"+e.libelle;t.serviceTrace.error(i,e),t.serviceAgentExtended.Trace.error("Problème de récupération des données d'authentification","getAuthentificationInfo",e)})},n.prototype.setModeFinancierPourRecap=function(e){switch(e.modeFinancierNumerique){case i.Constantes.CODE_MODE_FINANCIER_VIREMENT_OD:this.modeFinancierChoisi="Virement Opération Diverse";break;case i.Constantes.CODE_MODE_FINANCIER_ESP:this.modeFinancierChoisi="Espèces ";break;case i.Constantes.CODE_MODE_FINANCIER_CHEQUE_RECU:this.modeFinancierChoisi="Chèque reçu";break;case i.Constantes.CODE_MODE_FINANCIER_VIR_INTERNE:this.modeFinancierChoisi="Virement Interne Client";break;case i.Constantes.CODE_MODE_FINANCIER_VERSEMENT_ESP:this.modeFinancierChoisi="Versement Espèce Divers";break;case i.Constantes.CODE_MODE_FINANCIER_DIVERS:this.modeFinancierChoisi="Divers";break;default:this.modeFinancierChoisi="Espèces "}},n.prototype.getCoupuresBillets=function(t){return e.c0410.commun.GestionnaireBilleterie.getBilleterie(t)},n.prototype.validationDonnees=function(){var e=this;return this.reserverNumeroDeCompte().then(function(t){return e.definirReferenceProduitPrincipal(e.contexte.etablissement.codeEtablissement,e.contexte.etablissement.codeGuichetInterbancaire,t),e.verifierPrerequis(e.enOuverture,!1,!1).then(function(t){var r=e.estProduitEngage?e.formulaireProduitEngage.isValideFormulaire():!0;if(e.formulaire&&e.formulaire.operationFinanciere&&e.formulaire.operationFinanciere.modeFinancier&&0===e.formulaire.operationFinanciere.montant&&"VIR"===e.formulaire.operationFinanciere.modeFinancier.CTGXMF){var n=new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"Le montant doit être supérieur à 0 € pour un virement interne");t.push(n)}if(!_.isEmpty(e.listeErreursBloquantesAgiosCloture)){var n=e.listeErreursBloquantesAgiosCloture[0];t.push(n)}if(e.enOuverture||e.enModification||e.enCloture&&e.agiosRemu&&e.agiosRemu.soldeNetCDD<0&&(e.isAgentHabiliteCTX||e.isAgentHabilitePERTE)||e.enCloture&&e.agiosRemu&&e.agiosRemu.soldeNetCDD>=0){if(e.cddHabilitations&&!e.cddHabilitations.isHabiliteOuvertureAveantClotureCDD){var o="";o=e.enOuverture?i.Constantes.LIBELLE_ERREUR_HAB_OUV:e.enModification?i.Constantes.LIBELLE_ERREUR_HAB_AV:i.Constantes.LIBELLE_ERREUR_HAB_CL,t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,o))}e.enCloture&&e.agiosRemu&&e.agiosRemu.soldeNetCDD<0&&(e.isAgentHabiliteCTX||null!==e.formulaire.operationFinanciere.codeOperation||t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,i.Constantes.CODE_OPERATION_OBLIGATOIRE))),e.formulaire&&0===e.formulaire.getInformationsChampsInvalidesFormulaire().length&&!e.isPrerequisBloquant(t)&&e.isValideOperationFinanciere()&&r?(e.formulaire.operationFinanciere&&e.formulaire.operationFinanciere.modeFinancier&&(e.contexte.donneesProduit.indicateurModeVersement.valeur=e.formulaire.operationFinanciere.modeFinancier.CTGXM1),t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"Formulaire du Compte de depot a été validé avec succès")),e.formulaire.formulaireProduitEngage=e.formulaireProduitEngage,e.espaceGlobalService.enregistrerObjetGenerique(e.formulaire)):e.formulaire&&(e.estProduitEngage&&angular.forEach(e.formulaireProduitEngage.getInformationsChampsInvalidesFormulaireProduitEngage(),function(e){t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,e.getMessageErreur()))}),angular.forEach(e.formulaire.getInformationsChampsInvalidesFormulaire(),function(e){t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,e.getMessageErreur()))}),(!e.isCantonnement&&!e.isCddGSM&&!e.isValideOperationFinanciere()||e.enCloture&&e.isCantonnement&&!e.isValideOperationFinanciere())&&t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"La saisie de l'opération financière est incorrecte")),e.espaceGlobalService.enregistrerObjetGenerique(e.formulaire))}else if(e.agiosRemu)return t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"Vous ne pouvez pas clôturer un compte à découvert.")),console.error("Vous ne pouvez pas clôturer un compte à découvert:",e.habilitationCTX,e.habilitationPERTE),t;return t})})},n.prototype.definirReferenceProduitPrincipal=function(e,t,r){var n={valeur:e+t+r};this.$scope.$emit(i.Constantes.REFERENCE_PRODUIT_PRINCIPAL+this.idBloc,n)},n.prototype.ouverturePopupConfirmationMontant=function(){var e={actionButtonText:i.Constantes.TEXTE_BOUTON_OUI,closeButtonText:i.Constantes.TEXTE_BOUTON_NON,headerText:i.Constantes.TITRE_MODAL_ATTENTION,bodyText:i.Constantes.MESSAGE_CONFIRMATION_PLAFOND_DEPASSE.replace("%%%%",i.Constantes.MONTANT_SUPERIEUR.toString()),iconName:"itce-question",size:"md"};return this.modalService.showConfirm(e)},n.prototype.ouverturePopupConfirmationMiseEnPerte=function(){var e={actionButtonText:i.Constantes.TEXTE_BOUTON_VALIDER,closeButtonText:i.Constantes.TEXTE_BOUTON_ANNULER,headerText:i.Constantes.TITRE_MODAL_MISEENPERTE,bodyText:i.Constantes.MESSAGE_CONFIRMATION_MISEENPERTE,size:"md"};return this.modalService.showConfirm(e)},n.prototype.isPrerequisBloquant=function(e){for(var t=0,i=!1;t<e.length&&!i;)e[t].niveau===GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale&&(i=!0),t++;return i},n.prototype.isValideOperationFinanciere=function(){return this.enModification||this.formulaire.operationFinanciere.estValide},n.prototype.gererErreurQRGenerique=function(e){var t=this.$q.defer(),i=[];return i.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Erreur,0,"Erreur lors de la récuperation des AGIOS/RENUMERATIONS : "+this.compteDepotService.erreurPromiseAgios.libelle)),t.resolve(new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(i)),t.promise},n.prototype.CompteRenduMiseEnGestionSansModifier=function(e){var t=[];return t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"")),this.$q.when(new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(t,e))},n.prototype.supprimerDonneesCompteDeDepot=function(e){var t=this;this._contratCDDCloture=new i.ContratCDDCloture(this.formulaire.listeServices,this.formulaire.codeActionModeCloture,this.detenteur.caracteristiqueEntiteTitulaire.designationEntiteTitulaire,this.formulaire.detailSolde,this.donneesCompte.numeroDeCompte),this._contratLSE=new i.ContratLibreServiceEcureuil,this._contratLSE.codeEtablissementBanque=this.contexte.etablissement.codeEtablissement,this._contratLSE.compteAEnlever.codeGuichetInterbancaire=this.contexte.etablissement.codeGuichetInterbancaire,this._contratLSE.compteAEnlever.referenceProduitService=this.donneesCompte.numeroDeCompte,this._contratLSE.identifiantPersonne=this.contexte.offreSouscrite.numeroPersonneIdentifiee,this._contratLSE.compteAEnlever.identifiantPremierePersonne=this.contexte.offreSouscrite.numeroPersonneIdentifiee,isNaN(this.formulaire.operationFinanciere.nouveauSoldeCompteVirementApresVirement)&&(this.formulaire.operationFinanciere.segmentPrvRio.montantMaximum=0);var r=[];return this.miseaJourDonneeCDDDepuisFormulaire(),this.verifierPrerequis(!0,!0).then(function(i){return t._contratCDDCloture.compteDeDepot=t.donneesCompteDeDepot.compteDeDepot,t._contratCDDCloture.operationFinanciere=t.donneesCompteDeDepot.operationFinanciere,isNaN(t._contratCDDCloture.operationFinanciere.segmentPrvRio.montantGlobalOperation)&&(t._contratCDDCloture.operationFinanciere.segmentPrvRio.montantGlobalOperation=0,t.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation=0),isNaN(t._contratCDDCloture.operationFinanciere.segmentPrvRio.montantMinimum)&&(t.formulaire.operationFinanciere.segmentPrvRio.montantMinimum=0),isNaN(t._contratCDDCloture.operationFinanciere.segmentPrvRio.montantMaximum)&&(t.formulaire.operationFinanciere.segmentPrvRio.montantMaximum=0),t._contratCDDCloture.listeServices=t.formulaire.listeServices,t.isPrerequisBloquant(i)?(r=r.concat(i),t.$q.reject(i)):e?(t.isEligibleSAG=!0,t.identifiantBordereauService.getNumeroBordereau(t.contexte.offreSouscrite.numeroPersonneIdentifiee.toString(),!0)):t.identifiantBordereauService.getNumeroBordereau(t.contexte.offreSouscrite.numeroPersonneIdentifiee.toString(),t.isEligibleSAG)}).then(function(e){t.numeroBordereau=e,t.donneesCompte.identifiantBordereau=e;var i=null,r=null;return t.estProduitEngage&&t.formulaireProduitEngage.choixTracabilite&&(i=t.formulaireProduitEngage.domaineTracabilite.codeUniversTracabilite),console.log("*************************Question cloture CDD***************"),console.log({_contratCDDCloture:t._contratCDDCloture,numeroOffreSouscrite:t.contexte.offreSouscrite.numeroOffreSouscrite,numeroPersonneIdentifiee:t.contexte.offreSouscrite.numeroPersonneIdentifiee,identifiantEntiteTitulaire:t.contexte.entitesTitulaires[0].caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire,identifiantProduitService:t.idegps,numeroBordereau:parseInt(e),indicateurChoixTracabilite:r,codeUniversTracabilite:i}),t.compteDepotService.supprimerCompteDepot(t._contratCDDCloture,t.contexte.offreSouscrite.numeroOffreSouscrite,t.contexte.offreSouscrite.numeroPersonneIdentifiee,t.contexte.entitesTitulaires[0].caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire,t.idegps,parseInt(e),"0000",r,i)}).then(function(e){t.mettreAJourResultatsCommerciaux(),t.imprimerChequeDeBanque(),t.espaceGlobalService.enregistrerObjetGenerique(new i.CompteDepotGenerique(e.compteDeDepot)),t.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation>0&&(t.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation=-Math.abs(t.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation)),t.formulaire.operationFinanciere.montant>0&&(t.formulaire.operationFinanciere.montant=-Math.abs(t.formulaire.operationFinanciere.montant)),t.traitementPostOperationFinanciere();var n=[];return t.personnes.forEach(function(e){n.push(t.rattacheServiceLSE(e,r))}),t.compteDepotService.putLibreServiceEcureuil(t._contratLSE,t.dateNaissance).then(function(e){})["catch"](function(e){var i="supprimerDonneesCompteDeDepot  : Suppression Service LSE: "+e.libelle;t.serviceTrace.error(i,e),console.error("Suppression Service LSE",e)}),MyWay.Services.CoreCommon.ServiceDePromesse.all(n).then(function(e){return r.concat(e[0]).concat(e[1]),new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(r,t.donneesCompte)})})["catch"](function(e){return t.serviceTrace.error("supprimerDonneesCompteDeDepot -> gererErreursPostCompteDepot : "+e.libelle,e),t.gererErreursPostCompteDepot(e,r).then(function(e){return e})})},n.prototype.imprimerChequeDeBanque=function(){var t=this,i=this.$q.defer();if("09"===this.formulaire.operationFinanciere.modeFinancier.CTGXM1){var r="SHKCQI";this.EstHabilite(r).then(function(r){var n=new e.comOpesFinancieres.Model.ChequeBanque;n.beneficiaire=t.formulaire.operationFinanciere.segmentPrvRio.ordreCheque,n.derniereContrepartie=!0,n.devise=t.formulaire.operationFinanciere.compte.devise,n.modeFinancier=t.formulaire.operationFinanciere.modeFinancier,t.formulaire.operationFinanciere.montant<0?n.montantGlobal=-1*t.formulaire.operationFinanciere.montant:n.montantGlobal=t.formulaire.operationFinanciere.montant,n.multiRetrait=!0,n.numero=t.formulaire.operationFinanciere.segmentPrvRio.numeroCheque;var o=new e.comOpesFinancieres.Model.ParamPopupChequeBanque;o.titrePopup="Impression du chèque de banque",o.styleBoutonImprimer="principale",o.styleBoutonNePasImprimer="secondaire",t.chequeBanqueService.openPopupChequeBanqueOperationDepotRetrait(n,!1,t.formulaire.operationFinanciere.contexteSaisieOperationFinanciere,r,o).then(function(e){i.resolve(e)})})}else i.reject(!1);return i.promise},n.prototype.enregistrerCompteDeDepot=function(e){var t=this,r=[];return this.miseaJourDonneeCDDDepuisFormulaire(),console.log("CDD ----- >>> enregistrerCompteDeDepot / 1 this.donneesCompteDeDepot : ",this.donneesCompteDeDepot),this.verifierPrerequis(!0,!1).then(function(i){return t.isPrerequisBloquant(i)?(r=r.concat(i),t.$q.reject(i)):e?(t.isEligibleSAG=!0,t.identifiantBordereauService.getNumeroBordereau(t.contexte.offreSouscrite.numeroPersonneIdentifiee.toString(),!0)):t.identifiantBordereauService.getNumeroBordereau(t.contexte.offreSouscrite.numeroPersonneIdentifiee.toString(),t.isEligibleSAG)}).then(function(e){t.numeroBordereau=e,t.donneesCompte.identifiantBordereau=e;var i=null;t.estProduitEngage&&t.formulaireProduitEngage.choixTracabilite&&(i=t.formulaireProduitEngage.domaineTracabilite.codeUniversTracabilite);var r=t.contexte&&t.contexte.catalogue&&t.contexte.catalogue.produitService&&t.contexte.catalogue.produitService.produitCatalogue&&t.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService?t.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService:"";return t.compteDepotService.creerCompteDepot(t.contexte.entitesTitulaires[0].caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire,t.contexte.offreSouscrite.numeroOffreSouscrite,t.idegps,t.donneesCompteDeDepot,parseInt(e),r,i,null,t.contexte.offreSouscrite.numeroPersonneIdentifiee)}).then(function(e){t.mettreAJourResultatsCommerciaux(),t.espaceGlobalService.enregistrerObjetGenerique(new i.CompteDepotGenerique(e.compteDeDepot)),t.traitementPostOperationFinanciere();var n=[];return t.personnes.forEach(function(e){n.push(t.rattacheServiceLSE(e,r))}),MyWay.Services.CoreCommon.ServiceDePromesse.all(n).then(function(e){return r.concat(e[0]).concat(e[1]),new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(r,t.donneesCompte)})})["catch"](function(e){var i="enregistrerCompteDeDepot  : "+e.libelle;return t.serviceTrace.error(i,e),t.gererErreursPostCompteDepot(e,r)})},n.prototype.sauvegarderDossierDeVente=function(){var e=this;return t.prototype.sauvegarderDossierDeVente.call(this).then(function(t){return t.modeFinancier=e.formulaire&&e.formulaire.getModeFinancier(e.contexte.etablissement.codeEtablissement)?e.formulaire.getModeFinancier(e.contexte.etablissement.codeEtablissement):null,console.log("CDD : sauvergarderDossierDeVente | mode financier: ",t.modeFinancier),t})},n.prototype.doitSauvegarderDonneesMDEC=function(){return t.prototype.doitSauvegarderDonneesMDEC.call(this)||this.enOuverture||this.estProduitEngage&&this.formulaireProduitEngage&&this.formulaireProduitEngage.estModifieFormulaire},n.prototype.getDonneesSauvegardeProduitService=function(){this.donneesCompteDeDepot=new i.DonneesCompteDeDepot;var e,t,r;this.donneesCompte||(this.donneesCompte=this.espaceGlobalService.getDonneesCompte(this.contexte)),this.donneesCompte?(e=this.donneesCompte.codeEtablissement,t=this.donneesCompte.codeGuichet,r=this.donneesCompte.numeroDeCompte):(e=this.contexte.etablissement.codeEtablissement,t=this.contexte.etablissement.codeGuichetInterbancaire),
this.donneesCompteDeDepot.miseAjourDuModele(this.formulaire,e,t,r),this.enOuverture&&this.formulaire.operationFinanciere&&this.donneesCompteDeDepot.miseAjourOperationFinanciere(this.formulaire.operationFinanciere);var n=null;angular.isDefined(this.formulaire.operationFinanciere)&&angular.isDefined(this.formulaire.operationFinanciere.segmentPrvRio)&&angular.isDefined(this.formulaire.operationFinanciere.segmentPrvRio.modeFinancierNumerique)&&(n=this.formulaire.operationFinanciere.segmentPrvRio.modeFinancierNumerique);var o={donneesSauvegardeOpeFi:this.getDonneesSauvegardeOperationFinanciere(n),donneesProduitEngage:this.estProduitEngage?this.produitEngageService.getDonneesSauvegardeProduitEngage(this.formulaireProduitEngage):null},a={donneesPrincipales:this.donneesCompteDeDepot,donneesSecondaires:o};return console.log("CDD: getDonneesSauvegardeProduitService | donneesTechniquesProduitService",a),a},n.prototype.getDonneesSauvegardeOperationFinanciere=function(e){var t=this.formulaire.operationFinanciere?this.operationFinanciereService.creationObjetChoixUtilisateursParObjetOpeFi(this.formulaire.operationFinanciere):null;return angular.isDefined(e)&&e===i.Constantes.CODE_MODE_FINANCIER_OUVERTURE_A_ZERO&&(t.codeModeFinancier="99"),t},n.prototype.restaurerDossierDeVente=function(){var e=this;if(!this.formulaire){var t=void 0,r=void 0,n=this.contexte.catalogue.produitService.produitCaracteristique.libelleProduitService.toUpperCase();this.donneesCompte||(this.donneesCompte=this.espaceGlobalService.getDonneesCompte(this.contexte)),this.donneesCompte?(t=this.donneesCompte.codeEtablissement,r=this.donneesCompte.codeGuichet):(t=this.contexte.etablissement.codeEtablissement,r=this.contexte.etablissement.codeGuichetInterbancaire);var o=this.contexte.indicateurDossierVenteAutorise,a=this.contexte.catalogue.produitService.produitCaracteristique.identifiantProduitService;this.formulaire=new i.CompteDepotFormulaire(this.identifiantFormulaire,this.contexte.etablissement.codeEtablissement,this.contexte.etablissement.codeGuichetInterbancaire,this.contexte.donneesProduit.produit.produitCaracteristique,n,this.getNumeroPersonnes(),this.contexte.offreSouscrite.numeroPersonneIdentifiee.toString(),this.codeActeGestion.substring(0,2),this.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService,a,this.contexte.offreSouscrite.codeCanal,o)}var s=this.donneesSauvegarde.donneesPrincipales,c=this.donneesSauvegarde.donneesSecondaires;return this.formulaire.setDonneesCompteDeDepot(s),this.formulaire&&this.formulaire.estModifie&&(this.formulaire.estModifie=this.contexte.donneesProduit.estModifie.valeur),this.infoPartageTracab=c.donneesProduitEngage,this.enOuverture&&c.donneesSauvegardeOpeFi?(this.formulaire.setDonneesModeFinancierDefaut(c.donneesSauvegardeOpeFi.codeModeFinancier,this.contexte.offreSouscrite.codeCanal),angular.isDefined(s.operationFinanciere.segmentPrvRio)&&this.formulaire.setModeFinancierDonneesSauvegardeOpeFiCasOuvertureAZero(c.donneesSauvegardeOpeFi,s.operationFinanciere.segmentPrvRio.modeFinancierNumerique),console.log("CDD: restaurerDossierDeVente | donneesSauvegardeOpeFi",c.donneesSauvegardeOpeFi),this.operationFinanciereService.creationObjetOpeFiParObjetChoixUtilisateurs(c.donneesSauvegardeOpeFi).then(function(t){console.log("CDD: restaurerDossierDeVente | operationFinanciere",t);var i=angular.isDefined(s);return e.formulaire.restaureOperationFinanciere(t,i),e.isLoaded=!0,e.setModeFinancierPourRecap(e.formulaire.operationFinanciere.segmentPrvRio),!0})):this.$q.when(!0)},n.prototype.rechargerRecapVPC=function(){var e=this;if(this.donneesSauvegarde){var t=[];return t.push(this.restaurerDossierDeVente()),this.espaceGlobalService.enregistrerObjetGenerique(this.formulaire),this.enOuverture&&(this.donneesCompte=this.espaceGlobalService.getDonneesCompte(this.contexte),this.donneesCompte||t.push(this.reserverNumeroDeCompte().then(function(t){return e.serviceAgentExtended.Trace.debug("Numero de compte "+t+"reservé après rechargement du dossier de vente"),e.numeroCompteCodeGuichet||(e.numeroCompteCodeGuichet=e.contexte.etablissement.codeEtablissement+"-"+e.contexte.etablissement.codeGuichetInterbancaire+"-"+t,e.definirReferenceProduitPrincipal(e.contexte.etablissement.codeEtablissement,e.contexte.etablissement.codeGuichetInterbancaire,t)),!0}))),this.$q.all(t).then(function(){return!0})}var i=[];return i.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"Erreur de rechargement du dossier de vente: impossible de recharger le compte de depot en recapitulatif. Données de sauvegarde manquantes")),this.$scope.$emit(this.eventPS.CSPR_EMISSION_ERREUR+"#"+this.idBloc,i),this.$q.when(!1)},n.prototype.getVueMDEC=function(){var e=new GestionGeneriqueOffres.Types.DossierDeVente.SectionMDEC;e.titresSections=[{libelle:this.contexte.donneesProduit.produit.produitCaracteristique.libelleProduitService,vision:"3"}],this.enOuverture&&this.formulaire.operationFinanciere&&(e.champs.push(new GestionGeneriqueOffres.Types.DossierDeVente.ChampsMDEC("Montant operation",this.formulaire.operationFinanciere.segmentPrvRio?this.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation&&this.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation.toString()+" EUR":"","3")),e.champs.push(new GestionGeneriqueOffres.Types.DossierDeVente.ChampsMDEC("Mode financier",this.formulaire.operationFinanciere.modeFinancier?this.formulaire.operationFinanciere.modeFinancier.LIJMMI.toString():"","3"))),this.formulaire&&this.formulaire.intitule?e.champs.push(new GestionGeneriqueOffres.Types.DossierDeVente.ChampsMDEC("Intitulé",this.formulaire.intitule.toString(),"3")):e.champs.push(new GestionGeneriqueOffres.Types.DossierDeVente.ChampsMDEC("Intitulé","","3")),this.estProduitEngage&&this.formulaireProduitEngage.estModifieFormulaire&&(this.formulaireProduitEngage.choixTracabilite?(e.champs.push(new GestionGeneriqueOffres.Types.DossierDeVente.ChampsMDEC("Paramètres de traçabilité","","3")),e.champs.push(new GestionGeneriqueOffres.Types.DossierDeVente.ChampsMDEC("Traçabilité","OUI","3")),e.champs.push(new GestionGeneriqueOffres.Types.DossierDeVente.ChampsMDEC(this.formulaireProduitEngage.donneesRestPartageTracab.paramPartageTracab.informationTracabilite.libelleDomaine,this.formulaireProduitEngage.domaineTracabilite.libelleUniversTracabilite,"3"))):e.champs.push(new GestionGeneriqueOffres.Types.DossierDeVente.ChampsMDEC("Pas de traçabilité","","3")));var t=new GestionGeneriqueOffres.Types.DossierDeVente.BlocMDEC;return t.sections.push(e),t},n.prototype.rattacheServiceLSE=function(e,t){var i=this;t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"Les données du compte de dépôt ont été bien sauvegardées."));var r;return this.compteDepotService.verifieExistenceLSE(this.contexte.etablissement.codeEtablissement,this.contexte.etablissement.codeGuichetInterbancaire,e.getId,this.donneesCompte.numeroDeCompte,new Date(e.particulierInformation.dateNaissance)).then(function(n){return n.existence?i.libreServiceEcureuilService.recupererLibreServiceEcureuil(i.contexte.etablissement.codeEtablissement,e.getId,new Date(e.particulierInformation.dateNaissance)).then(function(n){return n.contratCarte.forEach(function(e){var r=_.remove(e.compteHorsAbonnement,{referenceProduitService:i.donneesCompte.numeroDeCompte});e.compteDansAbonnement.length<14?(e.compteDansAbonnement.push(r[0]),t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"Le compte a été ajouté au service LSE de la carte "+e.libelleCodeProduitCarte))):t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"Le compte n'a pas été ajouté au service LSE de la carte "+e.libelleCodeProduitCarte+" car il y a plus de 14 comptes dans l'abonnement"))}),r=new Date(e.particulierInformation.dateNaissance),i.libreServiceEcureuilService.modifierLibreServiceEcureuil(n,r).then(function(e){return t})}):(t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"Aucun service Libre service ecureuil n'a été detecté sur ce compte")),t)})["catch"](function(e){var r="rattacheServiceLSE  :  Impossible de vérifier l'existence du LSE : "+e.libelle;return i.serviceTrace.error(r,e),t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Warning,0,"Impossible de vérifier l'existence du LSE: "+e.valeurs+" "+e.codeLibelle)),t})},n.prototype.miseaJourDonneeCDDDepuisFormulaire=function(){var e=null;console.log("CDD ----- >>> miseaJourDonneeCDDDepuisFormulaire / 0 this.donneesCompteDeDepot : ",this.donneesCompteDeDepot),this.donneesCompteDeDepot?this.donneesCompteDeDepot.compteDeDepot&&this.donneesCompteDeDepot.compteDeDepot.codeGuichet&&(e=this.donneesCompteDeDepot.compteDeDepot.codeGuichet):this.donneesCompteDeDepot=new i.DonneesCompteDeDepot,console.log("CDD ----- >>> miseaJourDonneeCDDDepuisFormulaire / 1 this.donneesCompteDeDepot : ",this.donneesCompteDeDepot),this.donneesCompte||(this.donneesCompte=this.espaceGlobalService.getDonneesCompte(this.contexte)),this.donneesCompteDeDepot.miseAjourDuModele(this.formulaire),console.log("CDD ----- >>> miseaJourDonneeCDDDepuisFormulaire / 2 this.donneesCompteDeDepot : ",this.donneesCompteDeDepot),this.donneesCompteDeDepot.miseAjourOperationFinanciere(this.formulaire.operationFinanciere),!e&&this.donneesCompte?e=this.donneesCompte.codeGuichet:e||(e=this.contexte.etablissement.codeGuichetInterbancaire),this.donneesCompteDeDepot.miseAjourDuModeleDepuisParametre(this.contexte.etablissement.codeEtablissement,e,this.donneesCompte.numeroDeCompte)},n.prototype.gererErreursPostCompteDepot=function(e,t){var r=this;return this.donneesMiseEnGestionCDD={formulaireCdd:this.formulaire,identifiantEntiteTitulaire:this.contexte.entitesTitulaires[0].caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire,numeroOffreSouscrite:this.contexte.offreSouscrite.numeroOffreSouscrite,identifiantProduitService:this.idegps,donneesCompteDeDepot:this.donneesCompteDeDepot,isEligibleSAG:this.isEligibleSAG,numeroBordereau:this.numeroBordereau},this.EstHabilite(i.Constantes.CODE_HABILITATION_FORCAGE_OPERATION_FINANCIERE).then(function(n){if(n){if(e.codeLibelle===i.Constantes.CODE_LIBELLE_FORCAGE)return r.lancerPopupDeForcage(e.libelle,e.valeurs);if(e.codeLibelle===i.Constantes.CODE_LIBELLE_OPERATIONFINANCIERE_IMPOSSIBLE)return r.lancerPopupSimple(e.libelle,e.valeurs).then(function(e){return r.lancerPopupOperationFinanciere(n,r.formulaire)});if(e.codeLibelle===i.Constantes.CODE_LIBELLE_MSG_FORCE&&r.enCloture)return r.lancerPopupDeForcage(e.libelle,e.valeurs);var o;return o=r.enCloture?"Impossible de clôturer ":"Impossible d'ouvrir ",r.serviceAgentExtended.Trace.error(o+"le compte de depot pour les raisons suivantes: "+e.valeurs),t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,o+"le compte de depot pour les raisons suivantes: "+e.valeurs+" "+e.codeLibelle)),new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(t,r.donneesCompte)}return r.lancerPopupOperationFinanciere(n,r.formulaire)})},n.prototype.lancerPopupSimple=function(e,t){var i="";t.forEach(function(e){i=i+"\n"+e});var r={closeButtonText:"Fermer",headerText:e,bodyText:i,iconName:"itce-warning",size:"md"};return this.modalService.showPopup(r).then(function(e){return!0})["catch"](function(e){return!1})},n.prototype.modifierCompteDeDepot=function(){var e=this;this.donneesCompteDeDepot.miseAjourDuModele(this.formulaire);var t=[];return this.compteDepotService.modifierCompteDepot(this.donneesCompteDeDepot).then(function(i){return console.log("Les modifications sur le compte de dépôt ont été bien effectuées"),t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"Les données du compte de dépôt ont été bien sauvegardées")),new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(t,e.donneesCompte)})["catch"](function(i){var r="modifierCompteDeDepot  : Impossible de modifier les données du compte de depot pour les raisons suivantes: "+i.libelle;return e.serviceTrace.error(r,i),console.log("Impossible de modifier les données du compte de depot pour les raisons suivantes: "+i.valeurs),t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.ErreurFatale,1,"Impossible de sauvegarder les données du compte de depot pour les raisons suivantes: "+i.valeurs+" "+i.codeLibelle)),new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(t)})},n.prototype.lancerPopupDeForcage=function(e,t){var r=this,n="";t.forEach(function(e){n=n+"\n"+e});var o={actionButtonText:"Forcer",closeButtonText:"Annuler",headerText:e,bodyText:n,iconName:"itce-question",size:"md"};return this.modalService.showConfirm(o).then(function(){var e=null;r.estProduitEngage&&r.formulaireProduitEngage.choixTracabilite&&(e=r.formulaireProduitEngage.domaineTracabilite.codeUniversTracabilite);var t=[];if(r.enCloture){var n="0001";return r.compteDepotService.supprimerCompteDepot(r._contratCDDCloture,r.contexte.offreSouscrite.numeroOffreSouscrite,r.contexte.offreSouscrite.numeroPersonneIdentifiee,r.contexte.entitesTitulaires[0].caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire,r.idegps,parseInt(r.donneesCompte.identifiantBordereau),n,null,e).then(function(e){r.mettreAJourResultatsCommerciaux(),r.imprimerChequeDeBanque(),r.espaceGlobalService.enregistrerObjetGenerique(new i.CompteDepotGenerique(e.compteDeDepot)),r.traitementPostOperationFinanciere();var n=[];return r.personnes.forEach(function(e){n.push(r.rattacheServiceLSE(e,t))}),MyWay.Services.CoreCommon.ServiceDePromesse.all(n).then(function(e){return t.concat(e[0]).concat(e[1]),new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(t,r.donneesCompte)})})}var o=r.contexte&&r.contexte.catalogue&&r.contexte.catalogue.produitService&&r.contexte.catalogue.produitService.produitCatalogue&&r.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService?r.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService:"";return r.compteDepotService.creerCompteDepot(r.contexte.entitesTitulaires[0].caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire,r.contexte.offreSouscrite.numeroOffreSouscrite,r.idegps,r.donneesCompteDeDepot,parseInt(r.numeroBordereau),o,e,i.Constantes.CODE_FORCAGE,r.contexte.offreSouscrite.numeroPersonneIdentifiee).then(function(e){return t.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"Les données du compte de dépôt ont été bien sauvegardées")),r.traitementPostOperationFinanciere(),r.mettreAJourResultatsCommerciaux(),new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(t,r.donneesCompte)})["catch"](function(e){var t="lancerPopupDeForcage  : "+e.libelle;return r.serviceTrace.error(t,e),r.lancerPopupOperationFinanciere(!0,r.formulaire)})},function(e){return r.enCloture?void 0:r.lancerPopupOperationFinanciere(!0,r.formulaire)})},n.prototype.lancerPopupOperationFinanciere=function(e,t,r){var n=this;console.log("XXXXXXXX comptedepot-controleur -> lancerPopupModificationDecouvert() : formulaire",t);var o={closeButtonText:"Fermer",actionButtonText:"Valider",headerText:"Modification Opération Financière",iconName:"",bodyText:"",model:{isHabiliteForcage:e,operationFinanciere:t.operationFinanciere}},a={templateUrl:"vues/operation-financiere-popup.html",controller:"operationFinanciereModaleControleur",controllerAs:"operationFinanciereCtrl",windowClass:"app-modal-window-MEG",backdrop:!1,keyboard:!0,modalFade:!0,size:"lg",resolve:{callback:function(){angular.isDefined(n.formulaire.operationFinanciere)&&(n.formulaire.operationFinanciere.estForcageOperationFinanciere=!0)},data:function(){return o}}};return angular.isUndefined(r)&&(r=[]),this.modalService.showModal(a).then(function(t){if(t.valider){console.log("XXXXXXXX comptedepot-controleur -> showModal / this.formulaire.operationFinanciere :",n.formulaire.operationFinanciere),n.donneesCompteDeDepot.miseAjourOperationFinanciere(n.formulaire.operationFinanciere);var o=null;n.estProduitEngage&&n.formulaireProduitEngage.choixTracabilite&&(o=n.formulaireProduitEngage.domaineTracabilite.codeUniversTracabilite);var a=n.contexte&&n.contexte.catalogue&&n.contexte.catalogue.produitService&&n.contexte.catalogue.produitService.produitCatalogue&&n.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService?n.contexte.catalogue.produitService.produitCatalogue.codeFamilleGestionProduitService:"";return n.compteDepotService.creerCompteDepot(n.contexte.entitesTitulaires[0].caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire,n.contexte.offreSouscrite.numeroOffreSouscrite,n.idegps,n.donneesCompteDeDepot,parseInt(n.numeroBordereau),a,o,null,n.contexte.offreSouscrite.numeroPersonneIdentifiee).then(function(e){return r.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Ok,0,"Les données du compte de dépôt ont été bien sauvegardées")),n.traitementPostOperationFinanciere(),n.mettreAJourResultatsCommerciaux(),new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(r,n.donneesCompte)})["catch"](function(t){var r="lancerPopupOperationFinanciere : "+t.libelle;return n.serviceTrace.error(r,t),t.codeLibelle===i.Constantes.CODE_LIBELLE_FORCAGE?n.lancerPopupDeForcage(t.libelle,t.valeurs):t.codeLibelle===i.Constantes.CODE_LIBELLE_OPERATIONFINANCIERE_IMPOSSIBLE?n.lancerPopupSimple(t.libelle,t.valeurs).then(function(t){return n.lancerPopupOperationFinanciere(e,n.formulaire)}):void 0})}return t.annuler?(r.push(new GestionGeneriqueOffres.Types.ErreurGestionGeneriqueOffre(GestionGeneriqueOffres.Types.NiveauErreur.Erreur,1,"La mise en gestion a été abandonnée suite à des erreurs")),n.$q.when(new GestionGeneriqueOffres.Types.CompteRenduMiseEnGestion(r))):void 0})},n.prototype.traitementPostOperationFinanciere=function(){var e=this,t=this.contexte.offreSouscrite.numeroOffreFamille;if(this.formulaire.setOperationFinanciereSignataire(this.contexte.listeSignataires,this.contexte.offreSouscrite.numeroPersonneIdentifiee),this.formulaire.estSignataireVide()&&this.contexte.personnes&&0!==this.contexte.personnes.length){var i=this.contexte.personnes[0];this.formulaire.setOperationFinanciereAvecPersonne(i)}this.serviceAgentExtended.Context.AddToContext("MAJJab",null).then(function(){t&&!e.isEligibleSAG?e.serviceAgentExtended.Context.AddToContext("OPERATION_FINANCIERE",JSON.stringify(e.formulaire.operationFinanciere)).then(function(){console.log("OPERATIONFINANCIERE",e.formulaire.operationFinanciere)}):e.postOperationFinanciere.traitementPostOperationFinanciere(e.formulaire.operationFinanciere,e.isEligibleSAG)})},n.prototype.getCodMPR=function(e){var t=_.find(e.donnees,{IDEGPS:_.padLeft(this.contexte.offreSouscrite.codeProduitServiceOffre.toString(),7,"0"),CIGLDM:"1"});return t?_.padLeft(t.CODMPR,6," "):""},n.prototype.mettreAJourResultatsCommerciaux=function(){var e=this;if(this.enOuverture||this.isChangementOffre()||this.enCloture){var t="";this.compteBddCommunService.getDonneesDelocalisees(this.contexte.etablissement.codeEtablissement,i.Constantes.CODE_TYPE_PRODUIT_SERVICE_GCP_TABLE_DELOCALISE,this.ID_PRODUIT).then(function(i){var r=e.getDonneesResultatCommerciaux();e.enCloture&&(r.codeTypeResultatCommercial="5"),t=e.getCodMPR(i),r.codeTypeProduitServiceGCP=t,e.resultsCommerciauxService.mettreAJourResultatsCommerciaux(r).then(function(e){console.log("Resultats commerciaux mise à jour pour le compte de depôt")})})}},n.prototype.getDonneesResultatCommerciaux=function(){return{identifiantPersonne:this.contexte.offreSouscrite.numeroPersonneIdentifiee,codeTypeFamilleResultat:"1",identifiantProduitService:this.idegps,codeNatureResultatCommercial:"0",codeTypeResultatCommercial:"4",codeTypeProduitService:"",indicRattachableCRE:"1",codeTypeProduitServiceGCP:"",codeOrigineFonds:0,montantResultatCommercial:0,codeModeGestionLivret:"",sousCodeProduitService:"",codeProduitCarte:"",codeModeFinancier:"",codeCaractereForfaitaireOffre:"",indicProduitServiceObligatoire:""}},n.prototype.isChangementOffre=function(){return"OC"===this.contexte.offreSouscrite.codeActeGestion.substring(0,2)},n.prototype.initialiserDonneesProduitEngage=function(){var e=this;return this.formulaire&&(this.formulaireProduitEngage=this.formulaire.formulaireProduitEngage),this.donneesProduitEngagee={enRecapitulatif:this.contexte.modeAffichage,modePrecedent:this.contexteAppel===i.Constantes.MODE_PRECEDENT?!0:!1,offreSouscrite:{codeActeGestion:this.contexte.offreSouscrite.codeSousFamilleActeGestion,numeroCompte:null,identifiantPersonne:this.contexte.offreSouscrite.numeroPersonneIdentifiee},produitService:{codeTypeOperation:this.codeActeGestion.substring(0,2),identifiantProduitService:this.idegps,codeProduit:this.contexte.donneesProduit.produit.produitCaracteristique.codeTypeProduitService},etablissement:{codeEtablissement:this.contexte.etablissement.codeEtablissement,codeGuichet:this.contexte.etablissement.codeGuichetInterbancaire},indicateurs:null},this.produitEngageService.getIndicPartageTracab(this.donneesProduitEngagee.etablissement.codeEtablissement,this.donneesProduitEngagee.produitService.codeTypeOperation,this.donneesProduitEngagee.produitService.identifiantProduitService).then(function(t){return e.donneesProduitEngagee.indicateurs=t,(e.donneesProduitEngagee.indicateurs.indicateurPartageVisible||e.donneesProduitEngagee.indicateurs.indicateurTracabiliteVisible)&&(e.estProduitEngage=!0,-1!==["AV","OC"].indexOf(e.donneesProduitEngagee.offreSouscrite.codeActeGestion)&&e.donneesCompte&&(e.donneesProduitEngagee.offreSouscrite.numeroCompte=e.donneesCompte.numeroDeCompte,e.donneesProduitEngagee.etablissement.codeGuichet=e.donneesCompte.codeGuichet)),!0})},n.$inject=["$scope","$q","compteDepotService","espaceGlobalService","serviceAgentExtended","affectationRadicalService","compteBddCommunService","modalService","postOperationFinanciere","produitEngageService","identifiantBordereauService","libreServiceEcureuilCommunService","operationFinanciereService","resultsCommerciauxService","chequeBanqueService","serviceTrace"],n}(t.commun.ProduitServiceControleur);i.CompteDepotControleur=n,i.compteDeDepotModule.controller("CompteDepotControleur",n)}(i=t.compteDeDepot||(t.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t;!function(e){"use strict";function t(){return{templateUrl:"vues/comptedepot-vue.html",restrict:"E",scope:{idBloc:"@",contexteAppel:"@",modeAcces:"@",modeAffichage:"@",codeActeGestion:"@",contexte:"="},controller:"CompteDepotControleur",controllerAs:"CompteDepot",bindToController:!0}}e.mwcdComptedepot=t,e.compteDeDepotModule.directive("mwcdComptedepot",t)}(t=e.compteDeDepot||(e.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var myway;!function(e){var t;!function(t){var i;!function(t){"use strict";var i=function(i){function r(e,t,r,n,o,a,s,c,u,l,p,d){i.call(this,e),this.modeFinancierDefaut="",this.CODE_FAMILLE_GESTION_PRODUIT_SERVICE="OFFENJ",this._listeServices=null,t&&r&&a&&s&&"AV"!==c&&(u?this.initialiserOperationFinanciere(t,r,n,o,a,s,c,l,p,d,u):this.initialiserOperationFinanciere(t,r,n,o,a,s,c,l,p,d)),this._reversementAgio=!1,this.listeServices=null}return __extends(r,i),Object.defineProperty(r.prototype,"agiosRemu",{get:function(){return this._agiosRemu},set:function(e){this._agiosRemu=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"formulaireProduitEngage",{get:function(){return this._formulaireProduitEngage},set:function(e){this._formulaireProduitEngage=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"habilitations",{get:function(){return this._habilitations},set:function(e){this._habilitations=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"listeServices",{get:function(){return this._listeServices},set:function(e){this._listeServices=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"codeActionModeCloture",{get:function(){return this._codeActionModeCloture},set:function(e){this._codeActionModeCloture=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"detailSolde",{get:function(){return this._detailSolde},set:function(e){this._detailSolde=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"intitule",{get:function(){return this._intitule},set:function(e){null!==this._intitule&&this._intitule!==e&&(this.estModifie=!0),this._intitule=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reversementAgio",{get:function(){return this._reversementAgio},set:function(e){this._reversementAgio=e,this.estModifie=!0},enumerable:!0,configurable:!0}),r.prototype.setDonneesModeFinancierDefaut=function(e,t){var i="TL"===t?"06":"01";this.modeFinancierDefaut=angular.isDefined(e)?e:i},r.prototype.setDonneesCompteDeDepot=function(e){this._intitule=e.compteDeDepot.libellePersonnalise,this._reversementAgio=e.compteDeDepot.reversementAgios},r.prototype.metAJourFormulaire=function(e){this._intitule=e.compteDeDepot.libellePersonnalise,this._reversementAgio=e.compteDeDepot.reversementAgios},r.prototype.getInformationsChampsInvalidesFormulaire=function(){var e=[];return e},r.prototype.initialiserOperationFinanciere=function(t,i,r,n,o,a,s,c,u,l,p){this.operationFinanciere=new e.comOpesFinancieres.Model.OperationFinanciere,angular.isDefined(p)&&p===this.CODE_FAMILLE_GESTION_PRODUIT_SERVICE&&angular.isDefined(l)&&l&&angular.isDefined(u)&&"TL"===u&&angular.isDefined(s)&&"OU"===s?(this.operationFinanciere.fonctionnalite=MyWay.Model.Fonctionnalite.OUVERTURE_CDD_ENJOY,this.operationFinanciere.canal=u,this.operationFinanciere.modeDeVente="VPC",this.modeFinancierDefaut="01"):1544!==r.identifiantProduitService&&5672!==r.identifiantProduitService||!s||"CL"===s?s&&"CL"===s?(this.modeFinancierDefaut="01",this.operationFinanciere.fonctionnalite=MyWay.Model.Fonctionnalite.CLOTURE_CDD,1544===r.identifiantProduitService&&(this.operationFinanciere.montant=0)):angular.isDefined(l)&&l&&angular.isDefined(u)&&"TL"===u&&angular.isDefined(s)&&"OU"===s?(this.modeFinancierDefaut="06",this.operationFinanciere.canal=u,this.operationFinanciere.modeDeVente="VPC",this.operationFinanciere.fonctionnalite=MyWay.Model.Fonctionnalite.OUVERTURE_CDD_CCOOP):(this.modeFinancierDefaut="01",this.operationFinanciere.fonctionnalite=MyWay.Model.Fonctionnalite.OUVERTURE_CDD):(this.operationFinanciere.fonctionnalite=1544===r.identifiantProduitService?MyWay.Model.Fonctionnalite.COMPTE_CANTONNEMENT:MyWay.Model.Fonctionnalite.OUVERTURE_CDD,this.modeFinancierDefaut="01",this.operationFinanciere.montant=0),this.operationFinanciere.listeNumerosPersonnesPourVirementInterne=o,this.operationFinanciere.codeEtatRechercheListeCompteVirementInterne="A",this.operationFinanciere.typeRechercheListeCompteVirementInterne="B",s&&"CL"===s?this.operationFinanciere.listeTypesProduitsPourVirementInterne=["0000","0001","0002","0004","0005","0006","0008","0010","0011"]:this.operationFinanciere.listeTypesProduitsPourVirementInterne=["0000","0001","0004","0005","0006","0008","0010","0011"],this.operationFinanciere.compte=new MyWay.Model.Compte;var d=new MyWay.Model.Devise({code:"EUR",libelle:"Euro",nombreDecimalesGerees:2,nombreDecimalesReelles:2,symboleDevise:"€"});this.operationFinanciere.compte.devise=d,this.operationFinanciere.compte.rice=new MyWay.Model.Rice,this.operationFinanciere.compte.rice.codeActiviteCompte="04",this.operationFinanciere.compte.rice.codeEtablissement=t,this.operationFinanciere.compte.rice.codeGuichet={id:1,value:i},this.operationFinanciere.compte.produit=new MyWay.Model.Produit,this.operationFinanciere.client=new MyWay.Model.Client,this.operationFinanciere.client.numeroPersonne=a,this.operationFinanciere.compte.listeParticipant=[],this.operationFinanciere.signataire=new MyWay.Model.ParticipantInformationClient("","","","","",""),this.operationFinanciere.compte.libelle=n,this.operationFinanciere.compte.produit.CODIPR=r.codeTypeProduitService,this.operationFinanciere.compte.produit.LNEGCO=r.libelleProduitService},r.prototype.setOperationFinanciereSignataire=function(e,t){var i;e.length>0&&(i=_.findWhere(e,{numeroPersonne:t})),i&&(this.operationFinanciere.signataire.codeRole=i.role.toString(),this.operationFinanciere.signataire.libelleRole=i.designataire,this.operationFinanciere.signataire.codePersonnaliteJuridique=i.codePersonnaliteJuridique,this.operationFinanciere.signataire.identifiantParticipant=_.padLeft(i.numeroPersonne.toString(),9,"0"),this.operationFinanciere.signataire.dateNaissance=moment(i.dateNaissance).format("DD/MM/YYYY"),this.operationFinanciere.signataire.nomParticipant=i.nomFamille,this.operationFinanciere.signataire.prenomParticipant=i.prenom,this.operationFinanciere.signataire.nomPrenomParticipant=i.nomFamille+" "+i.prenom)},r.prototype.viderLeLibelle=function(){this._intitule=""},r.prototype.setOperationFinanciereAvecPersonne=function(t){this.operationFinanciere.signataire.codeRole=e.comContract.modeles.TypeSignataire.TITULAIRE.toString(),this.operationFinanciere.signataire.libelleRole=r.ROLE_PERSONNE_0,this.operationFinanciere.signataire.nomParticipant=t.particulierInformation.nomFamillePersonnePhysique,this.operationFinanciere.signataire.prenomParticipant=t.particulierInformation.prenom,this.operationFinanciere.signataire.nomPrenomParticipant=t.particulierInformation.nomFamillePersonnePhysique+" "+t.particulierInformation.prenom,this.operationFinanciere.signataire.identifiantParticipant=_.padLeft(t.identifiantPersonne.toString(),9,"0"),this.operationFinanciere.signataire.dateNaissance=moment(t.particulierInformation.dateNaissance).format("DD/MM/YYYY"),this.operationFinanciere.signataire.codePersonnaliteJuridique=t.particulierInformation.codeCapaciteJuridique},r.prototype.estSignataireVide=function(){return this.operationFinanciere.signataire?(angular.isUndefined(this.operationFinanciere.signataire.codeRole)||null===this.operationFinanciere.signataire.codeRole||""===this.operationFinanciere.signataire.codeRole)&&(angular.isUndefined(this.operationFinanciere.signataire.codePersonnaliteJuridique)||null===this.operationFinanciere.signataire.codePersonnaliteJuridique||""===this.operationFinanciere.signataire.codePersonnaliteJuridique)&&(angular.isUndefined(this.operationFinanciere.signataire.dateNaissance)||null===this.operationFinanciere.signataire.dateNaissance||""===this.operationFinanciere.signataire.dateNaissance)&&(angular.isUndefined(this.operationFinanciere.signataire.identifiantParticipant)||null===this.operationFinanciere.signataire.identifiantParticipant||""===this.operationFinanciere.signataire.identifiantParticipant)&&(angular.isUndefined(this.operationFinanciere.signataire.nomParticipant)||null===this.operationFinanciere.signataire.nomParticipant||""===this.operationFinanciere.signataire.nomParticipant)&&(angular.isUndefined(this.operationFinanciere.signataire.prenomParticipant)||null===this.operationFinanciere.signataire.prenomParticipant||""===this.operationFinanciere.signataire.prenomParticipant):!0},r.prototype.getModeFinancier=function(e){return{codeModeFinancier:this.operationFinanciere&&this.operationFinanciere.modeFinancier?this.operationFinanciere.modeFinancier.CTGXM1:null,codeEtablissementOperation:e?e:null}},r.prototype.setModeFinancierDonneesSauvegardeOpeFiCasOuvertureAZero=function(e,i){angular.isDefined(e)&&i===t.Constantes.CODE_MODE_FINANCIER_OUVERTURE_A_ZERO&&e.codeModeFinancier!==i&&(e.codeModeFinancier=t.Constantes.CODE_MODE_FINANCIER_OUVERTURE_A_ZERO)},r.prototype.restaureOperationFinanciere=function(e,t){e.modeFinancier&&(this.operationFinanciere.referenceEnveloppe=angular.isUndefined(e.referenceEnveloppe)?null:angular.copy(e.referenceEnveloppe),
this.operationFinanciere.riceVirementInterneSaisie=angular.isUndefined(e.riceVirementInterneSaisie)?null:angular.copy(e.riceVirementInterneSaisie),this.operationFinanciere.operationDiverse=angular.isUndefined(e.operationDiverse)?null:angular.copy(e.operationDiverse),this.operationFinanciere.libelleOperation=angular.isUndefined(e.libelleOperation)?null:angular.copy(e.libelleOperation),this.operationFinanciere.segmentPrjo=angular.isUndefined(e.segmentPrjo)?null:angular.copy(e.segmentPrjo),this.operationFinanciere.compteVirementInterneSelectionne=angular.isUndefined(e.compteVirementInterneSelectionne)?null:angular.copy(e.compteVirementInterneSelectionne),this.operationFinanciere.montant=e.montant,this.operationFinanciere.segmentPrvRio=e.segmentPrvRio,(angular.isUndefined(this.operationFinanciere.modeFinancier)||this.operationFinanciere.modeFinancier!==e.modeFinancier)&&(this.operationFinanciere.modeFinancier=angular.copy(e.modeFinancier)),this.operationFinanciere.estForcageOperationFinanciere=!0,this.operationFinanciere.estRepriseOffre=t,console.log("CDD formulaire: restaureOperationFinanciere | this.operationFinanciere",this.operationFinanciere))},r.ROLE_PERSONNE_0="Titulaire",r}(e.c0410.commun.Formulaire);t.CompteDepotFormulaire=i;var r=function(){function e(){}return e}();t.CompteDepotHabilitations=r}(i=t.compteDeDepot||(t.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var myway;!function(e){var t;!function(t){var i;!function(t){"use strict";var i=function(){function e(e,t,i){this.numeroCompte=e,this.montantVirement=t,this.libelleVirement=i}return e}();t.OperationRepartition=i;var r=function(){function e(){this.CIJMMC="N",this.CIJMMS="O",this.CTGXM1="10",this.CTGXMF="DIV",this.LIJMMI="DIVERS"}return e}();t.ModeFinancier=r;var n=function(){function e(e,t,i){this.monnaieBilleterie=e,this.nombreCoupure=t,this.monnaieSansBillet=i}return e}();t.DetailBilleterie=n;var o=function(){function e(e,t,i,r,n,o,a){this.b500=e,this.b200=t,this.b100=i,this.b50=r,this.b20=n,this.b10=o,this.b5=a}return e}();t.Coupure=o;var a=function(){function e(){this.libelleCourt="FE DIV",this.libelleLong="CLOTURE DIVERS"}return e}();t.LibelleOperation=a;var s=function(){function e(e,t,i,r,n,o,a,s,c,u,l,p,d,m,f,h,C,E,v,D,g,b,O,S,P,T,F,R,G,A,I,y,_,M,q,N,L,x,w,U,B,V,H){this.dateDeValeur=e,this.titre=t,this.mfIndicateur=i,this.texteBoutonValidation=r,this.montantMinimum=n,this.codeDeviseMontantParametre=a,this.numeroCompteRice=s,this.anneesProrogationPEL=c,this.modeFinancierNumerique=u,this.codeEvenementAtome=l,this.codePrestationTarifaire=p,this.modeFinancierChoisi=d,this.codeDeviseMontantOperation=m,this.montantGlobalOperation=f,this.libelleOperation1=h,this.indicateurLibelleBlocage=C,this.indicateurDateBlocage=E,this.codeRoleParticipant=v,this.nomPatronymiqueParticipant=D,this.prenomParticipant=g,this.identiteParticipant=b,this.numeroTelephoneParticipant=O,this.numeroCheque=S,this.ordreCheque=P,this.chequeGlobal=T,this.derniereContrepartie=F,this.typeCheque=R,this.nombreJourReserveEncaissement=G,this.supportLivret=A,this.presentationLivret=I,this.indicOblig=y,this.ancienSoldeLivret=_,this.indicateurBlocageAncienSolde=M,this.prochainNumeroLigneAImprimer=q,this.ligneBlocage=N,this.codeDeviseSoldeLivret=L,this.indicateurOD=x,this.S_BILLETERIE=w,this.S_PRVRIOUGR=U,this.libelleOperation2=B,this.numeroPersonneSignataire=V,this.S_CHEQUE=H}return e}();t.SegmentPrvRio=s;var c=function(){function e(){this.numeroCompteclient="",this.codeDeviseOperation="",this.montantCommission=0,this.montantOperation=0,this.libelleFamilleOD="",this.libelleTypeOD="",this.detailAImprimer="",this.codeTransaction="",this.codeReferenceOD="",this.codeFamilleOD="",this.libelle1SaisiOD="",this.libelle2SaisiOD=""}return e}();t.SegmentPrjo=c;var u=function(){function e(e){e?(this.compteDeDepot=e.compteDeDepot,this.operationFinanciere=e.operationFinanciere):(this.compteDeDepot={codeEtablissement:"",codeGuichet:"",numeroCompte:"",reversementAgios:!1,libellePersonnalise:"",deviseDuCompte:"EUR",codeTypeProduitService:"0004"},this.operationFinanciere=null)}return e.prototype.miseAjourDuModele=function(e,t,i,r){this.compteDeDepot.libellePersonnalise=e.intitule,this.compteDeDepot.reversementAgios=e.reversementAgio,t&&(this.compteDeDepot.codeEtablissement=t),i&&(this.compteDeDepot.codeGuichet=i),r&&(this.compteDeDepot.numeroCompte=r)},e.prototype.miseAjourOperationFinanciere=function(e){this.operationFinanciere={montant:e.montant,codeModeFinancier:e.modeFinancier.CTGXMF,libelleCourt:angular.isDefined(e.libelleOperation)?e.libelleOperation.libelleCourt:null,libelleLong:angular.isDefined(e.libelleOperation)?e.libelleOperation.libelleLong:null,segmentPrvRio:e.segmentPrvRio,segmentPrjo:e.segmentPrjo}},e.prototype.miseAjourDuModeleDepuisParametre=function(e,t,i){null!==this.operationFinanciere&&(this.operationFinanciere.segmentPrvRio.numeroCompteRice=this.getnumeroCompteRice(e,t,i)),this.compteDeDepot.codeEtablissement=e,this.compteDeDepot.codeGuichet=t,this.compteDeDepot.numeroCompte=i},e.prototype.getnumeroCompteRice=function(e,t,i){return e+t+i},e}();t.DonneesCompteDeDepot=u;var l=function(e){function t(i){e.call(this,t.IDENTIFIANT_CDD),this.compteDeDepot=i}return __extends(t,e),t.IDENTIFIANT_CDD="CDD",t}(e.c0410.commun.ObjetGenerique);t.CompteDepotGenerique=l;var p=function(){function e(){}return e}();t.Service=p;var d=function(){function e(e){this.codeActionService=e.codeActionService,this.codeTypeProduitService=e.codeTypeProduitService,this.codeEtablissement=e.codeEtablissement,this.codeGuichetInterbancaire=e.codeGuichetInterbancaire,this.numeroCompteProduitService=e.numeroCompteProduitService,this.anneeCreationDossierEcheancier=e.anneeCreationDossierEcheancier,this.numeroChronoDossierEcheancier=e.numeroChronoDossierEcheancier,this.codeActeurCreationDossier=e.codeActeurCreationDossier,this.codeBanqueCompteRecepteur=e.codeBanqueCompteRecepteur,this.codeGuichetCompteRecepteur=e.codeGuichetCompteRecepteur,this.numeroCompteRecepteur=e.numeroCompteRecepteur,this.anneeCreationDossierPrelevement=e.anneeCreationDossierPrelevement,this.numeroCreationDossierPrelvement=e.numeroCreationDossierPrelvement,this.codeApplicatifCreateurDossier=e.codeApplicatifCreateurDossier,this.numeroContratEpar=e.numeroContratEpar,this.numeroOffreSouscrite=e.numeroOffreSouscrite,this.codeInterbancaireBanque=e.codeInterbancaireBanque,this.codeGuichetBanque=e.codeGuichetBanque,this.referenceProduitService=e.referenceProduitService}return e}();t.ServiceClotureContratCdd=d;var m=function(){function e(){}return e}();t.CaracteristiqueCDD=m;var f=function(){function e(e,t,i,r,n,o,a){this.soldeBrut=e,this.montantAgiosNormaux=t,this.montantBrutRemunerationCDD=i,this.montantTotalPrelevements=r,this.soldeNetCDD=n,this.montantReversementAgios=o,this.montantPartRemunCDDFiscalite=a}return e}();t.DetailSolde=f;var h=function(){function e(){}return e}();t.ContratCDD=h;var C=function(e){function t(t,i,r,n,o){var a=this;e.call(this),this.listeServices=[],t&&null!==t&&t.forEach(function(e){a.listeServices.push(new d(e))}),this.codeActionModeCloture=i,this.nomBeneficiaire=r,this.detailSolde=n,this.referenceProduitService=o}return __extends(t,e),t}(h);t.ContratCDDCloture=C;var E=function(){function e(e,t,i,r,n,o,a,s,c,u,l,p,d,m,f,h){this.identifiantPersonne=e,this.codeTypeProduitServiceGCP=t,this.codeTypeFamilleResultat=i,this.codeTypeResultatCommercial=r,this.codeNatureResultatCommercial=n,this.codeOrigineFonds=o,this.montantResultatCommercial=a,this.indicRattachableCRE=s,this.identifiantProduitService=c,this.codeTypeProduitService=u,this.codeModeGestionLivret=l,this.sousCodeProduitService=p,this.codeProduitCarte=d,this.codeModeFinancier=m,this.codeCaractereForfaitaireOffre=f,this.indicProduitServiceObligatoire=h}return e}();t.Resultat=E;var v=function(){function e(){this.contratCarte=new Array,this.compteAEnlever=new b}return e}();t.ContratLibreServiceEcureuil=v;var D=function(){function e(){}return e}();t.ContratCarte=D;var g=function(){function e(){}return e}();t.CompteHorsAbonnement=g;var b=function(){function e(){}return e}();t.CompteAEnlever=b}(i=t.compteDeDepot||(t.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t;!function(e){function t(){return{require:"ngModel",restrict:"A",link:function(e,t,i,r){r.$parsers.push(function(e){if(null==e)return"";var t=e.toUpperCase().replace(/[^\A-Z0-9\s]/g,"");return t!==e&&(r.$setViewValue(t),r.$render()),t})}}}e.noSpecialChar=t,e.compteDeDepotModule.directive("noSpecialChar",t)}(t=e.compteDeDepot||(e.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e,t,i,r,n,o,a,s){this.$q=e,this.$modalInstance=t,this.data=i,this.$location=r,this.serviceAgentExtended=n,this.modalService=o,this.espaceGlobalService=a,this.compteDepotService=s}return e.prototype.fermer=function(e){this.$modalInstance.close(e)},e.prototype.enregistrerCompteDeDepot=function(){this.fermer({annuler:!1,valider:!0})},e.$inject=["$q","$modalInstance","data","$location","serviceAgentExtended","modalService","espaceGlobalService","compteDepotService"],e}();e.OperationFinanciereModaleControleur=t,e.compteDeDepotModule.controller("operationFinanciereModaleControleur",t)}(t=e.compteDeDepot||(e.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e,t,i,r,n,o,a,s){this.$q=e,this.$modalInstance=t,this.data=i,this.$location=r,this.serviceAgentExtended=n,this.modalService=o,this.espaceGlobalService=a,this.compteDepotService=s}return e.prototype.fermer=function(e){this.$modalInstance.close(e)},e.prototype.enregistrerCompteDepotEnModeForcage=function(){this.fermer({annuler:!1,valider:!0})},e.$inject=["$q","$modalInstance","data","$location","serviceAgentExtended","modalService","espaceGlobalService","compteDepotService"],e}();e.PopupForcageControleur=t,e.compteDeDepotModule.controller("popupForcageControleur",t)}(t=e.compteDeDepot||(e.compteDeDepot={}))}(t=e.c0410||(e.c0410={}))}(myway||(myway={})),angular.module("myway.c0410.compteDeDepot").run(["$templateCache",function(e){e.put("vues/comptedepot-vue.html",'<mw-produit-service lecture-seule="CompteDepot.enLectureSeule" id="formulaire-compte-depot">\r\n    <!--  <span ng-if="CompteDepot.isHabiliteOuvertureAveantClotureCDD && this.isHabiliteProfilReduisProfilComplet">-->\r\n    <form class="form-horizontal" novalidate>\r\n        <div ng-if="CompteDepot.afficherDirectiveEnPerso()">\r\n            <div ng-if="::CompteDepot.enOuverture || CompteDepot.enModification && CompteDepot.formulaire.habilitations.isHabiliteLectureLibellePersonnalise" class="form-group" ng-class="{\'disabled\' : !CompteDepot.formulaire.habilitations.isHabiliteModificationLibellePersonnalise }">\r\n                <label class="col-md-3 col-sm-3 col-lg-2 control-label" for="intitule">Intitulé</label>\r\n                <div class="col-sm-6">\r\n                    <mw-infobulle-aide id="aide-ouv-cdd-intitule" id-champ="PS.CDD.Intitule">\r\n                        <input id="intitule" name="intitule" class="form-control" maxlength="32" type="text" ng-disabled="!CompteDepot.formulaire.habilitations.isHabiliteModificationLibellePersonnalise" ng-model="CompteDepot.formulaire.intitule" mw-reset-field>\r\n                    </mw-infobulle-aide>\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-if="(CompteDepot.enOuverture && !CompteDepot.isDossierVenteEnCours) || (CompteDepot.enOuverture && CompteDepot.isDossierVenteEnCours && CompteDepot.isLoaded)" ng-show="!CompteDepot.isCantonnement && !CompteDepot.isCddGSM">\r\n                <mwsf-saisie-operation-financiere operation-financiere="CompteDepot.formulaire.operationFinanciere" code-mode-financier-par-defaut="CompteDepot.formulaire.modeFinancierDefaut" id="saisie-opefi-ouv-cdd" niveau-panel-principal="3" niveau-interieur-panel="2"></mwsf-saisie-operation-financiere>\r\n            </div>\r\n            <!-- Voir le cas en mode ouverture si habilitation -->\r\n            <div ng-show="CompteDepot.enModification && CompteDepot.formulaire.habilitations.isHabiliteLectureReversementAgio && CompteDepot.formulaire.habilitations.isHabiliteModificationReversementAgio">\r\n\r\n                <div class="col-sm-6 infobull-left">\r\n                    <mw-infobulle-aide id="aide-modif-cdd-agios" id-champ="PS.CDD.Agios">\r\n                        <button class="col-md-3 col-sm-3 col-lg-2 btn itce-checkbox" type="button" id="reversement-agio" name="reversement-agio" ng-model="CompteDepot.formulaire.reversementAgio" btn-checkbox>Reversement d\'agios</button>\r\n                    </mw-infobulle-aide>\r\n                </div>\r\n                <!--<div class="col-sm-3 col-sm-offset-1 marge-agio-cdd">\r\n                    <mw-infobulle-aide id="aide-modif-cdd-agios" id-champ="PS.CDD.Agios">\r\n                        <button class="btn itce-checkbox" type="button" id="reversement-agio" name="reversement-agio" ng-model="CompteDepot.formulaire.reversementAgio" btn-checkbox>Reversement d\'agios</button>\r\n                    </mw-infobulle-aide>\r\n                </div>-->\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Recapitulatif -->\r\n        <div ng-if="CompteDepot.afficherDirectiveEnRecap() && !CompteDepot.enCloture">\r\n            <div class="form-group">\r\n                <!-- Intitulé -->\r\n                <span>\r\n                    <label class="col-md-3 control-label">Intitulé</label>\r\n                    <div ng-class="(CompteDepot.enModification && !CompteDepot.hasModifieChamps(\'intitule\') ||\r\n                                        (CompteDepot.formulaire.intitule === CompteDepot.detenteur.caracteristiqueEntiteTitulaire.designationEntiteTitulaire)) ? \'recapitulatif-valeur\' : \'recapitulatif-valeur-modifie\'" class="col-md-3" ng-bind="::CompteDepot.formulaire.intitule"></div>\r\n                </span>\r\n                <!-- N° de compte -->\r\n                <label class="col-md-3 control-label">N° de compte</label>\r\n                <div ng-class="(CompteDepot.enModification && !CompteDepot.hasModifieChamps(\'operationFinanciere.numeroCompteCodeGuichet\')) ? \'recapitulatif-valeur\' : \'recapitulatif-valeur-modifie\'" class="col-md-3">\r\n                    <span ng-bind="::CompteDepot.numeroCompteCodeGuichet"></span>\r\n                </div>\r\n            </div>\r\n            <div ng-if="!CompteDepot.enModification" class="form-group">\r\n                <!-- Versement -->\r\n                <label class="col-md-3 control-label">Versement</label>\r\n                <div ng-class="(CompteDepot.enModification && !CompteDepot.hasModifieChamps(\'operationFinanciere.segmentPrvRio.montantGlobalOperation\')) ? \'recapitulatif-valeur\' : \'recapitulatif-valeur-modifie\'" class="col-md-3">\r\n                    <span ng-bind="::CompteDepot.formulaire.operationFinanciere.segmentPrvRio.montantGlobalOperation"></span>\r\n                    <span> €</span>\r\n                </div>\r\n                <!--Mode Financier-->\r\n                <label class="col-md-3 control-label">Mode financier</label>\r\n                <div ng-class="(CompteDepot.enModification && !CompteDepot.hasModifieChamps(\'operationFinanciere.segmentPrvRio.modeFinancierChoisi\')) ? \'recapitulatif-valeur\' : \'recapitulatif-valeur-modifie\'" class="col-md-3" ng-bind="CompteDepot.modeFinancierChoisi">\r\n                </div>\r\n                <!-- Reversement d\'agio -->\r\n                <span ng-if="CompteDepot.enModification">\r\n                    <label class="col-md-3 control-label">Reversement d\'agio</label>\r\n                    <div ng-if="CompteDepot.formulaire.reversementAgio" ng-class="(CompteDepot.enModification && !CompteDepot.hasModifieChamps(\'reversementAgio\')) ? \'recapitulatif-valeur\' : \'recapitulatif-valeur-modifie\'" class="col-md-3">Oui</div>\r\n                    <div ng-if="!CompteDepot.formulaire.reversementAgio" ng-class="(CompteDepot.enModification && !CompteDepot.hasModifieChamps(\'reversementAgio\')) ? \'recapitulatif-valeur\' : \'recapitulatif-valeur-modifie\'" class="col-md-3">Non</div>\r\n                </span>\r\n            </div>\r\n\r\n        </div>\r\n        <!--Clôture-->\r\n        <div ng-if="CompteDepot.enCloture">\r\n\r\n            <!--pas en Recap et en mode cloture-->\r\n            <span ng-if="!CompteDepot.enRecapitulatif">\r\n\r\n                <div class="form-group">\r\n                    <h1 class="col-md-12 titre-releve"><span data-ng-bind="::CompteDepot.clotureLabel"></span></h1>\r\n                </div>\r\n\r\n                <div class="form-group mw-form-static ng-scope">\r\n                    <span class="col-md-4 control-label" data-ng-bind="::CompteDepot.soldeNetAPayer"></span>\r\n                    <div class="col-md-5">\r\n                        <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                            <span class="font-size-cdd" ng-class="CompteDepot.agiosRemu.soldeNetCDD < 0 ? \'couleur-solde-net\': \'\' " ng-bind="(CompteDepot.soldeNetCDD  | number:2) + \' €\'"></span>\r\n                            &nbsp;&nbsp;\r\n                            <span class="detail-solde-cdd" ng-mouseup="CompteDepot.afficherDetailSoldeEnCloture()">Afficher {{CompteDepot.plusOuMoins}} de détail</span>\r\n\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div ng-if="CompteDepot.afficherDetailSolde">\r\n                    <div class="form-group mw-form-static ng-scope">\r\n                        <span class="col-md-4 control-label" data-ng-bind="::CompteDepot.soldeBrut"></span>\r\n                        <div class="col-md-5">\r\n                            <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                                <span class="font-size-cdd" ng-bind="(CompteDepot.infosCDD.informationsCDD.soldeMinuteCompte | number:2) + \' €\'"></span>\r\n                                &nbsp;&nbsp;<br>\r\n                                <span ng-if="CompteDepot.afficherPerteProfit" class="font-size-cdd detail-solde">\r\n                                    <mwsf-solde-compte ng-show="CompteDepot.detailSoldeOpefi.soldeActuel != CompteDepot.detailSoldeOpefi.soldeDisponible" id="solde-compte-opefi-extourne" compte-principal="CompteDepot.comptePourLeSolde" solde-detail="CompteDepot.detailSoldeOpefi" type-affichage-solde="CompteDepot.typeAffichageSolde"></mwsf-solde-compte>\r\n                                </span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="form-group mw-form-static ng-scope">\r\n                        <span class="col-md-4 control-label" data-ng-bind="::CompteDepot.agiosTrimestriels"></span>\r\n                        <div class="col-md-5">\r\n                            <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                                <span class="font-size-cdd" ng-bind="(CompteDepot.agiosRemu.montantAgiosImputes | number:2) + \' €\'"></span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="form-group mw-form-static ng-scope">\r\n                        <span class="col-md-4 control-label" data-ng-bind="::CompteDepot.reversAgiosTrimestriels"></span>\r\n                        <div class="col-md-5">\r\n                            <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                                <span class="font-size-cdd" ng-bind="(CompteDepot.agiosRemu.montantReversementAgios | number:2) + \' €\'"></span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="form-group mw-form-static ng-scope">\r\n                        <span class="col-md-4 control-label" data-ng-bind="::CompteDepot.remuBruteAnnuelle"></span>\r\n                        <div class="col-md-5">\r\n                            <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                                <span class="font-size-cdd" ng-bind="(CompteDepot.agiosRemu.montantBrutRemunerationCDD | number:2) + \' €\'"></span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div ng-if="CompteDepot.agiosRemu.montantAgiosCalcule != 0" class="form-group mw-form-static ng-scope">\r\n                        <span class="col-md-4 control-label" data-ng-bind="::CompteDepot.agiosCalcules"></span>\r\n                        <div class="col-md-5">\r\n                            <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                                <span class="font-size-cdd" ng-bind="(CompteDepot.agiosRemu.montantAgiosCalcule | number:2) + \' €\'"></span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="form-group mw-form-static ng-scope">\r\n                        <span class="col-md-4 control-label" data-ng-bind="::CompteDepot.fiscaliteAnnuelle"></span>\r\n                        <div class="col-md-5">\r\n                            <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                                <span class="font-size-cdd" ng-bind="(CompteDepot.agiosRemu.montantTotalPrelevements | number:2) + \' €\'"></span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div ng-if="CompteDepot.tarifCFN && CompteDepot.tarifCFN != 0" class="form-group mw-form-static ng-scope">\r\n                        <span class="col-md-4 control-label" data-ng-bind="::CompteDepot.tarifCFNLibelle"></span>\r\n                        <div class="col-md-5">\r\n                            <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                                <span class="font-size-cdd" ng-bind="(CompteDepot.tarifCFN | number:2) + \' €\'"></span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n\r\n\r\n                </div>\r\n\r\n                <br>\r\n                <!--Opefi en clôture-->\r\n\r\n                <br>\r\n                <br>\r\n                <!--ng-show="banqueADistance.isHabiliteEnvoiCodeSms"-->\r\n                <div ng-show="CompteDepot.agiosRemu.soldeNetCDD < 0 ? true : false " ng-if="!CompteDepot.isAgentHabiliteCTX && !CompteDepot.isAgentHabilitePERTE">\r\n                    <span class="error-msg ng-binding col-lg-offset-2 col-lg-7 col-xs-12 col-sm-12 col-md-8">\r\n                        <!--<p> Vous n\'avez pas l\'habilitation nécessaire pour: CompteDepot.habilitationCTX}}{CompteDepot.habilitationPERTE}} </p>-->\r\n                        <p class="center-text">Vous n\'êtes pas habilité à clôturer un compte à découvert.</p>\r\n                    </span>\r\n                </div>\r\n                <br>\r\n                <div class="form-group" ng-show="CompteDepot.agiosRemu.soldeNetCDD < 0 ? true : false ">\r\n                    <div class="allignement-cdd">\r\n                        <button ng-disabled="!CompteDepot.isAgentHabiliteCTX" name="radio-btn-libre" class="btn itce-radio-btn" ng-model="CompteDepot.formulaire.operationFinanciere.codeOperation" btn-radio="\'O\'" id="contentieux" required aria-required="true" ng-required="true">\r\n                            Cloture mise en contentieux\r\n                        </button>\r\n                        <button ng-disabled="!CompteDepot.isAgentHabilitePERTE" ng-click="CompteDepot.showPopupMiseEnPerte()" name="radio-btn-libre2" class="btn itce-radio-btn" ng-model="CompteDepot.formulaire.operationFinanciere.codeOperation" btn-radio="\'P\'" id="perte" required aria-required="true">\r\n                            Cloture pour mise en perte\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n\r\n                <!--Opefi en clôture-->\r\n                <div class="form-horizontal" ng-if="CompteDepot.enCloture && CompteDepot.agiosRemu  && CompteDepot.agiosRemu.soldeNetCDD >= 0 && CompteDepot.boolEndCfn">\r\n                    <mwsf-saisie-operation-financiere operation-financiere="CompteDepot.formulaire.operationFinanciere" code-mode-financier-par-defaut="CompteDepot.formulaire.modeFinancierDefaut" id="saisie-opefi-cloture-cdd" niveau-panel-principal="1" niveau-interieur-panel="2"></mwsf-saisie-operation-financiere>\r\n                </div>\r\n\r\n\r\n                <!--<pre>CompteDepot.formulaire.operationFinanciere | json</pre>-->\r\n\r\n\r\n\r\n            </span>\r\n\r\n            <!--en racap et en cloture-->\r\n            <span ng-show="CompteDepot.enRecapitulatif">\r\n\r\n            </span>\r\n\r\n        </div>\r\n        <!-- Appel composant produit engagé -->\r\n        <div class="form-horizontal" ng-if="CompteDepot.donneesProduitEngagee.indicateurs.indicateurTracabiliteVisible ||\r\n                                                CompteDepot.donneesProduitEngagee.indicateurs.indicateurPartageVisible">\r\n            <mwsf-produit-engage contexte-produit-engage="CompteDepot.donneesProduitEngagee" id="produit-engage-cdd" info-partage-tracab="CompteDepot.infoPartageTracab" produit-engage-formulaire="CompteDepot.formulaireProduitEngage"></mwsf-produit-engage>\r\n        </div>\r\n    </form>\r\n    <!--</span>-->\r\n</mw-produit-service>'),e.put("vues/forcage-popup.html",'<div class="modal-header">\r\n    <!-- <button type="button" ng-click="operationFinanciereCtrl.fermer()" class="close" aria-hidden="true"><span class="icon itce-times"></span></button>-->\r\n    <h3 class="modal-title" ng-bind="::forcageCtrl.data.headerText"></h3>\r\n</div>\r\n<div class="modal-body texte-gros row">\r\n    <div class="comptedepot-message-forcage" ng-bind="::forcageCtrl.data.bodyText"></div>\r\n</div>\r\n<div class="modal-footer">\r\n    <div class="col-lg-offset-6 col-lg-3 col-md-offset-6 col-md-3 col-sm-offset-6 col-sm-3">\r\n        <button ng-bind="::forcageCtrl.data.closeButtonText" type="button" class="btn btn-default" ng-click="forcageCtrl.fermer({ annuler: true, valider: false })"></button>\r\n    </div>\r\n    <div class="col-lg-3 col-md-3 col-sm-3">\r\n        <button ng-bind="::forcageCtrl.data.actionButtonText" type="button" class="btn btn-primary" ng-click="forcageCtrl.enregistrerCompteDepotEnModeForcage()"></button>\r\n    </div>\r\n</div>\r\n'),e.put("vues/operation-financiere-popup.html",'<div class="modal-header">\r\n   <!-- <button type="button" ng-click="operationFinanciereCtrl.fermer()" class="close" aria-hidden="true"><span class="icon itce-times"></span></button>-->\r\n    <h3 class="modal-title">Modification de l\'opération financière</h3>\r\n</div>\r\n<div ng-show="!operationFinanciereCtrl.data.model.isHabiliteForcage" class="popup-warning col-lg-11 col-md-11 col-sm-11">\r\n    <p class="col-lg-10 col-md-9 col-sm-12">\r\n        Opération impossible : Le forçage est impossible car vous ne disposez pas de l\'habilitation SHGCAE. Vérifiez le montant et la date de l\'opération.\r\n    </p>\r\n</div>\r\n<div class="modal-body texte-gros row">\r\n    <div>\r\n        <mwsf-saisie-operation-financiere operation-financiere="operationFinanciereCtrl.data.model.operationFinanciere" niveau-panel-principal="3" niveau-interieur-panel="2"></mwsf-saisie-operation-financiere>\r\n    </div>\r\n</div>\r\n<div class="modal-footer">\r\n    <div class="col-lg-offset-5 col-lg-4 col-md-offset-5 col-md-4 col-sm-offset-5 col-sm-6">\r\n        \r\n        <button type="button" class="btn btn-default" ng-click="operationFinanciereCtrl.fermer({ annuler: true, valider: false })">Abandonner La Mise en Gestion</button>\r\n    </div>\r\n    <div class="col-lg-3 col-md-3 col-sm-3">\r\n        <button type="button" class="btn btn-primary" ng-click="operationFinanciereCtrl.enregistrerCompteDeDepot()">Valider</button>\r\n    </div>\r\n</div>\r\n')}]);