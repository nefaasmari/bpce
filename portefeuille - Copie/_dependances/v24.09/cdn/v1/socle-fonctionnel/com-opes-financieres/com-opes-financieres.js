/**
 * Généré par : SIGCESIE\ct-tfsbuild
 * Changeset TFS : undefined
 * Etiquette TFS : undefined
 * Déclenchement : undefined
 */
"use strict";var myway;!function(e){var i;!function(e){e.module=angular.module("myway.comOpesFinancieres",["ui.bootstrap","moduleAgent","ngSanitize","myway.comInterdomaine","myway.ui"])}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e){this.$scope=e}return e.$inject=["$scope"],e}();e.AccreditifController=i,e.module.controller("accreditifController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/accreditif/accreditif-view.html",scope:{accreditifCoche:"="},controller:"accreditifController",controllerAs:"ctrl",bindToController:!0}}e.mwsfAccreditif=i,e.module.directive("mwsfAccreditif",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function i(e){this.serviceAgentExtended=e}return i.prototype.calcProposition=function(e){var i,n,t,r,o,a,s,c,l;for(s=[0,0,0,0],i=angular.copy(e.coupure),n=angular.copy(e.reste),l=_.template("<%= rest %> <%= coup %> "),this.serviceAgentExtended.Trace.debug("Avant le tri on a "),this.serviceAgentExtended.Trace.debug("Rest Coup        Rest Coup        Rest Coup        Rest Coup"),c="",t=0;4>t;t++)c=c.concat(l({rest:_.padLeft(String(n[t]),4," "),coup:_.padLeft(String(i[t]),6," ")}));for(this.serviceAgentExtended.Trace.debug(c),t=3;t>=0;t--)for(o=i[t],a=t-1;a>=0;a--)o<i[a]&&(o=n[t],n[t]=n[a],n[a]=o,o=i[t],i[t]=i[a],i[a]=o,o=i[t]);for(e.coupure=angular.copy(i),e.reste=angular.copy(n),this.serviceAgentExtended.Trace.debug("Après le tri on a "),this.serviceAgentExtended.Trace.debug("Rest Coup        Rest Coup        Rest Coup        Rest Coup"),c="",t=0;4>t;t++)c=c.concat(l({rest:_.padLeft(String(n[t]),4," "),coup:_.padLeft(String(i[t]),6," ")}));if(this.serviceAgentExtended.Trace.debug(c),e.ventilation=[0,0,0,0],this.distrib(e.montant,i,n,s)){for(t=0;4>t;t++)for(r=0;4>r;r++)i[r]===e.coupure[t]&&(e.ventilation[t]=s[t]);e.statutVentilation=0}return e},i.prototype.distrib=function(e,i,n,t){for(var r=0;4>r;r++)if(e>=i[r]&&n[r]-t[r]>0){if(t[r]++,this.repartit(e-i[r],i,n,t,3))return!0;t[r]=0}return!1},i.prototype.repartit=function(e,i,n,t,r){if(0===e)return!0;for(;r>=0;)if(e>=i[r]&&n[r]-t[r]>0){if(t[r]++,this.repartit(e-i[r],i,n,t,r))return!0;t[r]--,r--}else r--;return!1},i.prototype.premiereRepartissionGabValide=function(i){for(var n=i.length-1,t=i.length-1;t>=0;t--)if(i[t].statutVentilation===e.Constantes.EtatVentilation.OK&&i[t].etatGab===e.Constantes.EtatGAB.OK){n=t;break}return n},i.$inject=["serviceAgentExtended"],i}();i.AlgorithmeDistributionService=n,e.module.service("algorithmeDistributionService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n;!function(n){!function(e){e[e.DEPOT_TMF=0]="DEPOT_TMF",e[e.RETRAIT_TMF=1]="RETRAIT_TMF",e[e.RETRAIT_OAD_TMF=2]="RETRAIT_OAD_TMF"}(n.ModeTMF||(n.ModeTMF={}));var t=n.ModeTMF,r=function(){function n(e,i,n,t,r,o,a,s,c,l,p,m,u,d,E){this.$q=e,this.serviceAgentExtended=i,this.gabEncaisseGabService=n,this.structureserviceInfoAgenceCarteTmfService=t,this.opecartetmfparametreHoraireEdsDateTmfService=r,this.opecartetmfCompteEligibleTmfService=o,this.opecartetmfAutorisationOpeTmfService=a,this.opecartetmfOperationCarteTmfService=s,this.opecartetmfparametrePlafondRetraitService=c,this.opecartetmfparametrePlafondOpeAgenceService=l,this.mwNotificationService=p,this.modalService=m,this.algorithmeDistributionService=u,this.impressionBordereauCarteTMFService=d,this.contractualisationCarteTMFService=E,this.HABILITATION_DEPOT_RETRAIT_TMF="SHDMXK",this.HABILITATION_RETRAIT_OAD_TMF="SHDMXL",this.FORMAT_DATE="YYYY-MM-DD",this.FORMAT_TIME="HHmm",this.RETRAIT_KO_HORS_HEURES_OUVERTURE="Retrait par Carte TMF impossible en dehors des heures d'ouverture de l'agence.",this.DEPOT_KO_HORS_HEURES_OUVERTURE="Dépôt par Carte TMF impossible en dehors des heures d'ouverture de l'agence.",this.PRODUITS_AUTORISES_OAD=["00","01","04","08","11"],this.isDepotRetraitAutorise=!1}return n.prototype.isDepotRetraitTMFAutorise=function(){return this.isDepotRetraitAutorise},n.prototype.isRetraitOADTMFOpposition=function(){return this.compteEligibleTmf&&this.compteEligibleTmf.detailOAD&&this.compteEligibleTmf.detailOAD.detailCompte&&this.compteEligibleTmf.detailOAD.detailCompte.indicateurExistenceOppo},n.prototype.forceRetraitOADTMF=function(){return this.compteEligibleTmf&&this.compteEligibleTmf.numeroCompte&&-1===this.PRODUITS_AUTORISES_OAD.indexOf(this.compteEligibleTmf.numeroCompte.substring(0,2))},n.prototype.initCarteTMFService=function(e,i,n){var r=this,o=this.$q.defer();return this.isAgentHabiliteDepotRetraitTMF(e).then(function(a){a?r.$q.all({isEncaisseGABRepertoriee:r.isEncaisseGABRepertoriee(),isDepotTMFAutoriseDansAgence:e===t.DEPOT_TMF?r.isDepotTMFAutoriseDansAgence():null,isCompteAutoriseTMF:r.isCompteAutoriseTMF(i,e,n)}).then(function(i){i.isEncaisseGABRepertoriee&&(e!==t.DEPOT_TMF||i.isDepotTMFAutoriseDansAgence)&&i.isCompteAutoriseTMF?r.isAgenceOuverteTMF().then(function(i){i?r.isDepotRetraitAutorise=!0:(r.isDepotRetraitAutorise=!1,e===t.DEPOT_TMF?r.mwNotificationService.showNotification(r.DEPOT_KO_HORS_HEURES_OUVERTURE,"information"):r.mwNotificationService.showNotification(r.RETRAIT_KO_HORS_HEURES_OUVERTURE,"information")),o.resolve()})["catch"](function(e){r.modalService.showErreur(1,"",e.libelle),o.reject(e)}):(r.isDepotRetraitAutorise=!1,o.resolve())})["catch"](function(e){o.reject(e)}):o.resolve()})["catch"](function(e){o.reject(e)}),o.promise},n.prototype.isAgentHabiliteDepotRetraitTMF=function(e){var i=this,n=e===t.RETRAIT_OAD_TMF?this.HABILITATION_RETRAIT_OAD_TMF:this.HABILITATION_DEPOT_RETRAIT_TMF;return this.serviceAgentExtended.Habilitation.EstHabilite(n).then(function(n){if(n)return!0;var r=e===t.RETRAIT_OAD_TMF?"L'agent n'est pas habilité aux retraits OAD TMF":"L'agent n'est pas habilité aux dépôts et retraits TMF";return i.serviceAgentExtended.Trace.warning(r,"Chargement CarteTMF"),!1})["catch"](function(e){return i.serviceAgentExtended.Trace.error("Erreur lors de la récupértion de l'habilitation "+n,"Chargement CarteTMF",e),!1})},n.prototype.isEncaisseGABRepertoriee=function(){var e=this;return this.serviceAgentExtended.getAuthentificationInfo().then(function(i){return e.serviceAgentExtended.getParametresComptables().then(function(n){return e.gabEncaisseGabService.getEncaisseGab(i.agentConnecte.referenceExterneAgent,i.codeEtablissement,n.edsInterneRattachementGuichetComptable,i.agentConnecte.referenceExterneAgent)})}).then(function(i){return e.listeEncaisseGab=i,!0})["catch"](function(i){return e.serviceAgentExtended.Trace.error("Erreur lors de la récupération de l'encaisse Gab","Chargement CarteTMF",i),!1})},n.prototype.isDepotTMFAutoriseDansAgence=function(){var e=this;return this.serviceAgentExtended.getAuthentificationInfo().then(function(i){return e.serviceAgentExtended.getParametresComptables().then(function(n){return e.structureserviceInfoAgenceCarteTmfService.getParametreCarteTmf(i.codeEtablissement,n.edsInterneRattachementGuichetComptable)})}).then(function(e){return e&&e.indicateurDepotGabAutorise})["catch"](function(i){return e.serviceAgentExtended.Trace.error("Erreur lors de la récupération des autorisations TMF de l'agence","Chargement CarteTMF",i),!1})},n.prototype.isCompteAutoriseTMF=function(e,n,r){var o=this,a=n===t.RETRAIT_OAD_TMF;return e&&null!=e.codeEtablissement&&null!=e.getGuichet()&&null!=e.codeActiviteCompte&&null!=e.radical&&null!=e.cleCompte?this.opecartetmfCompteEligibleTmfService.getCompteEligibleTmf(e.codeEtablissement,e.getGuichet(),e.codeActiviteCompte+e.radical+e.cleCompte,a,a?void 0:e.cleRice,a?void 0:r,a?void 0:n===t.DEPOT_TMF?i.Constantes.Billetterie.TYPE_OPERATION_BILLETTERIE_DEPOT:i.Constantes.Billetterie.TYPE_OPERATION_BILLETTERIE_RETRAIT).then(function(e){return o.compteEligibleTmf=e,!0})["catch"](function(e){return o.serviceAgentExtended.Trace.error("Erreur lors de la récupération de l'éligibilité TMF du compte","Chargement CarteTMF",e),!1}):(this.serviceAgentExtended.Trace.error("Erreur lors de la récupération de l'éligibilité TMF du compte : le rice n'est pas défini ou est incomplet","Chargement CarteTMF"),this.$q.when(!1))},n.prototype.isAgenceOuverteTMF=function(){var e=this,i=this.$q.defer();return this.serviceAgentExtended.getAuthentificationInfo().then(function(i){return e.serviceAgentExtended.getParametresComptables().then(function(n){return e.opecartetmfparametreHoraireEdsDateTmfService.getHoraireEdsTmf(i.codeEtablissement,n.edsInterneRattachementGuichetComptable,n.edsExterneRattachementGuichetComptable,n.edsTypeRattachementGuichetComptable,moment().format(e.FORMAT_DATE))})}).then(function(n){n&&n.horaireMatin&&n.horaireMatin.heureOuverture&&n.horaireMatin.heureFermeture&&n.horaireApresMidi&&n.horaireApresMidi.heureOuverture&&n.horaireApresMidi.heureFermeture?i.resolve(e.estPlageHoraireAgenceOuverteTMF(n,moment())):i.resolve(!1)})["catch"](function(n){e.serviceAgentExtended.Trace.error("Erreur lors de la récupération des horaires d'ouverture TMF de l'agence","Chargement CarteTMF",n),i.reject(n)}),i.promise},n.prototype.estPlageHoraireAgenceOuverteTMF=function(e,i){var n=moment(_.padLeft(e.horaireMatin.heureOuverture,4,"0"),this.FORMAT_TIME),t=moment(_.padLeft(e.horaireApresMidi.heureFermeture,4,"0"),this.FORMAT_TIME);if("0"===e.horaireMatin.heureFermeture&&"0"===e.horaireApresMidi.heureOuverture)return!i.isBefore(n)&&i.isBefore(t);var r=moment(_.padLeft(e.horaireMatin.heureFermeture,4,"0"),this.FORMAT_TIME),o=moment(_.padLeft(e.horaireApresMidi.heureOuverture,4,"0"),this.FORMAT_TIME);return!i.isBefore(n)&&i.isBefore(r)||!i.isBefore(o)&&i.isBefore(t)},n.prototype.validerDepotTMF=function(e){var n=this,t=this.$q.defer();return this.opecartetmfAutorisationOpeTmfService.getAutorisationOpeCompteCarte(e.compte.rice.codeEtablissement,e.compte.rice.getGuichet(),e.compte.rice.codeActiviteCompte+e.compte.rice.radical+e.compte.rice.cleCompte,e.compte.rice.cleRice,0,i.Constantes.Billetterie.TYPE_OPERATION_BILLETTERIE_DEPOT,i.Constantes.OperationFinanciere.TEXTE_NON_N).then(function(t){var r={headerText:i.Constantes.CarteTMF.TEXTE_ENTETE_INITIALISER_CARTE_TMF,numeroCarte:""};return n.modalService.showModal({templateUrl:"typescript/carte-tempo-multi-fonctions/popup/popup-initialiser-carte-tmf-view.html",controller:"ModalInitialiserCarteTmfController",controllerAs:"ctrl",windowClass:"app-modal-window-MEG",backdrop:!0,keyboard:!0,size:"lg",resolve:{data:function(){return r}}}).then(function(){var o=i.Constantes.CarteTMF.TEXTE_PREFIXE_NUMERO_CARTE_TMF+r.numeroCarte,a=n.getRolePersonneSurContrat(e.signataire),s=e.signataire?e.signataire.nomPrenomParticipant:e.compte.titulaire,c={informationsClientCarte:{identifiantSupportCarte:o,identifiantPersonne:e.client.numeroPersonne,designationPersonneTitulaire:e.compte.titulaire,referencePieceJustificative:e.segmentPrvRio.identiteParticipant,indicateurOperationFaiteParTier:!1,designationPersonneTier:s,premierLibelleReleveCompte:null,topOad:!1,referenceOperationOadTmf:null,montantTotalPriseOrdre:t.montantOperation,typeDistribution:i.Constantes.ChiffreString.CHIFFRE_UN_STRING,montantCoupure1:i.Constantes.ChiffreNumber.CHIFFRE_DIX_NUMBER,nombreBilletsCoupure1:0,montantCoupure2:i.Constantes.ChiffreNumber.CHIFFRE_VINGT_NUMBER,nombreBilletsCoupure2:0,montantCoupure3:i.Constantes.ChiffreNumber.CHIFFRE_CINQUANTE_NUMBER,nombreBilletsCoupure3:0,montantCoupure4:i.Constantes.ChiffreNumber.CHIFFRE_CENT_NUMBER,nombreBilletsCoupure4:0,indicateurOadTmf:null},listeOperationsCarte:[{codeCaisse:t.codeCaisse,codeGuichet:t.codeGuichet,numeroCompte:t.numeroCompte,cleRib:t.cleRib,nomProduitService:e.compte&&e.compte.produit&&e.compte.produit.LCEGCO?e.compte.produit.LCEGCO:"",typeOperation:t.typeOperation,rolePersonneSurContrat:a,designationPersonne:s,codeMotifOpposition:"",codeValidationOpposition:i.Constantes.OperationFinanciere.TEXTE_NON_N,codeMotifOppositionSupprimee:"",indicateurForcageSoldeDebiteur:!1,montantOperation:0}]};return e&&e.signataire&&e.signataire.codeRole===i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_AUTRES_99&&(c.informationsClientCarte.indicateurOperationFaiteParTier=!0),c&&c.informationsClientCarte&&c.informationsClientCarte.designationPersonneTitulaire&&c.informationsClientCarte.designationPersonneTitulaire.length>32&&(c.informationsClientCarte.designationPersonneTitulaire=c.informationsClientCarte.designationPersonneTitulaire.substr(0,32)),c&&c.informationsClientCarte&&c.informationsClientCarte.designationPersonneTier&&c.informationsClientCarte.designationPersonneTier.length>32&&(c.informationsClientCarte.designationPersonneTier=c.informationsClientCarte.designationPersonneTier.substr(0,32)),c&&c.listeOperationsCarte&&c.listeOperationsCarte.length&&c.listeOperationsCarte[0].designationPersonne.length>32&&(c.listeOperationsCarte[0].designationPersonne=c.listeOperationsCarte[0].designationPersonne.substr(0,32)),n.opecartetmfOperationCarteTmfService.postCarteTmf(c).then(function(i){return n.contractualisationCarteTMFService.routerVersSpaContractualisation(e,o).then(function(){return i})})})})["catch"](function(e){return e?(n.serviceAgentExtended.Trace.error("Erreur lors de la création de carte TMF pour dépôt","Création CarteTMF",e),t.reject(e)):t.resolve(null),t.promise})},n.prototype.validerRetraitTMF=function(e,n,t){var r=this;void 0===n&&(n=!1);var o=this.$q.defer();return this.opecartetmfAutorisationOpeTmfService.getAutorisationOpeCompteCarte(e.compte.rice.codeEtablissement,e.compte.rice.getGuichet(),e.compte.rice.codeActiviteCompte+e.compte.rice.radical+e.compte.rice.cleCompte,e.compte.rice.cleRice,e.montant,i.Constantes.Billetterie.TYPE_OPERATION_BILLETTERIE_RETRAIT,n?e.estOperationDepotRetraitInterne?i.Constantes.OperationFinanciere.TEXTE_INTERNE_I:i.Constantes.OperationFinanciere.TEXTE_EXTERNE_E:i.Constantes.OperationFinanciere.TEXTE_NON_N).then(function(a){return function(){return a.indicateurAutorisationOperation?r.$q.when(null):n?r.$q.reject(a.messageAlerte):r.modalService.showConfirm({headerText:i.Constantes.CarteTMF.TEXTE_ENTETE_FORCER_OPERATION_RETRAIT,bodyText:_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_FORCER_SAISIE)({message:a.messageAlerte}),actionButtonText:i.Constantes.CarteTMF.TEXTE_BOUTON_FORCER,closeButtonText:i.Constantes.CarteTMF.TEXTE_BOUTON_ANNULER,size:"md",iconName:"itce-warning"})}().then(function(){return r.opecartetmfparametrePlafondRetraitService.getPlafondRetrait(e.compte.rice.codeEtablissement,e.compte.rice.getGuichet(),e.compte.rice.codeActiviteCompte+e.compte.rice.radical+e.compte.rice.cleCompte,"00"+e.compte.rice.codeActiviteCompte,e.contexteSaisieOperationFinanciere.edsExterneRattachementGuichetComptable,n).then(function(s){return function(){return e.montant>s.montantPlafondRetraitUnitaire?r.forcerOuConfirmerPlafondDepasseCarteTMF(s.indicateurForcageOperation,i.Constantes.CarteTMF.TEXTE_ENTETE_CONFIRMER_OPERATION_RETRAIT,i.Constantes.CarteTMF.TEXTE_BOUTON_CONFIRMER,i.Constantes.CarteTMF.TEXTE_BOUTON_ANNULER,_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_CONFIRMER_SAISIE)({message:i.Constantes.CarteTMF.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_OPERATION}),i.Constantes.CarteTMF.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_OPERATION):r.$q.when(null)}().then(function(){return e.montant+s.montantCumulRetraits>s.montantPlafondRetraitsCumules?r.forcerOuConfirmerPlafondDepasseCarteTMF(s.indicateurForcageCumulRetraits,i.Constantes.CarteTMF.TEXTE_ENTETE_CONFIRMER_OPERATION_RETRAIT,i.Constantes.CarteTMF.TEXTE_BOUTON_CONFIRMER,i.Constantes.CarteTMF.TEXTE_BOUTON_ANNULER,_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_CONFIRMER_SAISIE)({message:i.Constantes.CarteTMF.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_PERIODE}),i.Constantes.CarteTMF.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_PERIODE):r.$q.when(null)}).then(function(){return!n&&e.montant+s.montantCumulRtrtsJournaliersTmf>s.montantPlafondJournalierRetrait?r.forcerOuConfirmerPlafondDepasseCarteTMF(s.indicateurForcagCumulJournalier,i.Constantes.CarteTMF.TEXTE_ENTETE_CONFIRMER_OPERATION_RETRAIT,i.Constantes.CarteTMF.TEXTE_BOUTON_CONFIRMER,i.Constantes.CarteTMF.TEXTE_BOUTON_ANNULER,_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_CONFIRMER_SAISIE)({message:i.Constantes.CarteTMF.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_QUOTIDIEN}),i.Constantes.CarteTMF.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_QUOTIDIEN):r.$q.when(null)}).then(function(){return function(){return n?r.$q.when(null):r.opecartetmfparametrePlafondOpeAgenceService.getPlafondOperationAgence(e.compte.rice.codeEtablissement,e.contexteSaisieOperationFinanciere.edsExterneRattachementGuichetComptable)}().then(function(s){return function(){return s&&e.montant+s.montantOperationRetrait>s.montantPlafondRetrait?r.forcerOuConfirmerPlafondDepasseCarteTMF(s.indicateurForcageOperation,i.Constantes.CarteTMF.TEXTE_ENTETE_FORCER_OPERATION_RETRAIT,i.Constantes.CarteTMF.TEXTE_BOUTON_FORCER,i.Constantes.CarteTMF.TEXTE_BOUTON_ANNULER,i.Constantes.CarteTMF.TEXTE_MESSAGE_FORCAGE_MONTANT_MAXIMUM_AGENCE,i.Constantes.CarteTMF.TEXTE_MESSAGE_ATTEINTE_MONTANT_MAXIMUM_AGENCE):r.$q.when(null)}().then(function(){var s,c=[],l=-1;if(e.choixBilletterieTMF){if(!(e.listeRepartitionBilletterieTMF&&e.listeRepartitionBilletterieTMF.length>0))return o.reject({libelle:i.Constantes.CarteTMF.TEXTE_MESSAGE_VENTILATION_NON_VALIDE}),o.promise;c=e.listeRepartitionBilletterieTMF,l=r.algorithmeDistributionService.premiereRepartissionGabValide(c)}else if(r.listeEncaisseGab)for(var p=0;p<r.listeEncaisseGab.length;p++){s={numeroGab:r.listeEncaisseGab[p].identifiantNumeroNational,etatGab:r.listeEncaisseGab[p].etatGab,montant:e.montant,coupure:[i.Constantes.ChiffreNumber.CHIFFRE_DIX_NUMBER,i.Constantes.ChiffreNumber.CHIFFRE_VINGT_NUMBER,i.Constantes.ChiffreNumber.CHIFFRE_CINQUANTE_NUMBER,i.Constantes.ChiffreNumber.CHIFFRE_CENT_NUMBER],reste:[0,0,0,0],ventilation:null,statutVentilation:-1};for(var m=0;m<r.listeEncaisseGab[p].listesCassettesGab.length;m++)if(+r.listeEncaisseGab[p].listesCassettesGab[m].etatCassette<=i.Constantes.EtatCassette.PRESQUE_VIDE)switch(r.listeEncaisseGab[p].listesCassettesGab[m].montantCoupureCassette){case i.Constantes.ChiffreNumber.CHIFFRE_DIX_NUMBER:s.reste[0]+=r.listeEncaisseGab[p].listesCassettesGab[m].nombreBilletsRestants;break;case i.Constantes.ChiffreNumber.CHIFFRE_VINGT_NUMBER:s.reste[1]+=r.listeEncaisseGab[p].listesCassettesGab[m].nombreBilletsRestants;break;case i.Constantes.ChiffreNumber.CHIFFRE_CINQUANTE_NUMBER:s.reste[2]+=r.listeEncaisseGab[p].listesCassettesGab[m].nombreBilletsRestants;break;case i.Constantes.ChiffreNumber.CHIFFRE_CENT_NUMBER:s.reste[3]+=r.listeEncaisseGab[p].listesCassettesGab[m].nombreBilletsRestants}s=r.algorithmeDistributionService.calcProposition(s),0===s.statutVentilation&&(l=p),c.push(s)}return function(){return 0>l?(o.reject({libelle:i.Constantes.CarteTMF.TEXTE_MESSAGE_MONTANT_NON_DISTRIBUABLE_GAB}),o.promise):r.$q.when(null)}().then(function(){var o={headerText:i.Constantes.CarteTMF.TEXTE_ENTETE_INITIALISER_CARTE_TMF,numeroCarte:"",listeMessageAlerteGab:r.genererListeMessageAlerteGab(c)};return console.log("listeRepartitionProposition",c),console.log("listeMessageAlerteGab",r.genererListeMessageAlerteGab(c)),r.modalService.showModal({templateUrl:"typescript/carte-tempo-multi-fonctions/popup/popup-initialiser-carte-tmf-view.html",controller:"ModalInitialiserCarteTmfController",controllerAs:"ctrl",windowClass:"app-modal-window-MEG",backdrop:!0,keyboard:!0,size:"lg",resolve:{data:function(){return o}}}).then(function(){var s=i.Constantes.CarteTMF.TEXTE_PREFIXE_NUMERO_CARTE_TMF+o.numeroCarte,p=r.getRolePersonneSurContrat(e.signataire),m=e.signataire?e.signataire.nomPrenomParticipant:e.compte.titulaire,u={informationsClientCarte:{identifiantSupportCarte:s,identifiantPersonne:e.client.numeroPersonne,designationPersonneTitulaire:e.compte.titulaire?e.compte.titulaire:"",referencePieceJustificative:e.segmentPrvRio.identiteParticipant,indicateurOperationFaiteParTier:!1,designationPersonneTier:m,premierLibelleReleveCompte:n?e.libelleOperation.libelleLong:null,topOad:n,indicateurOadTmf:null,referenceOperationOadTmf:n&&r.compteEligibleTmf&&r.compteEligibleTmf.detailOAD&&r.compteEligibleTmf.detailOAD.detailCompte?r.compteEligibleTmf.detailOAD.detailCompte.referenceOadTmf:null,montantTotalPriseOrdre:a.montantOperation,typeDistribution:e.choixBilletterieTMF?i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING:i.Constantes.ChiffreString.CHIFFRE_UN_STRING,montantCoupure1:c[l].coupure[0],nombreBilletsCoupure1:c[l].ventilation[0],montantCoupure2:c[l].coupure[1],nombreBilletsCoupure2:c[l].ventilation[1],montantCoupure3:c[l].coupure[2],nombreBilletsCoupure3:c[l].ventilation[2],montantCoupure4:c[l].coupure[3],nombreBilletsCoupure4:c[l].ventilation[3]},listeOperationsCarte:[{codeCaisse:a.codeCaisse,codeGuichet:a.codeGuichet,numeroCompte:a.numeroCompte,cleRib:a.cleRib,nomProduitService:e.compte&&e.compte.produit&&e.compte.produit.LCEGCO?e.compte.produit.LCEGCO:"",typeOperation:a.typeOperation,rolePersonneSurContrat:n?i.Constantes.CarteTMF.TEXTE_CODE_AUTRE_A:p,designationPersonne:e.compte.titulaire,codeMotifOpposition:"",codeValidationOpposition:a.indicateurAutorisationOperation?i.Constantes.OperationFinanciere.TEXTE_NON_N:i.Constantes.OperationFinanciere.TEXTE_OUI_O,codeMotifOppositionSupprimee:"",indicateurForcageSoldeDebiteur:!a.indicateurAutorisationOperation,montantOperation:e.montant}]};return n&&u.informationsClientCarte&&e.signataire&&e.signataire.nomPrenomParticipant&&(""===u.informationsClientCarte.designationPersonneTier&&(u.informationsClientCarte.designationPersonneTier=e.signataire.nomPrenomParticipant),u.listeOperationsCarte&&u.listeOperationsCarte.length>0&&(u.listeOperationsCarte[0].designationPersonne=e.signataire.nomPrenomParticipant)),e&&e.signataire&&e.signataire.codeRole===i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_AUTRES_99&&(u.informationsClientCarte.indicateurOperationFaiteParTier=!0),n&&(u.informationsClientCarte.indicateurOadTmf=t?"I":"E"),u&&u.informationsClientCarte&&u.informationsClientCarte.designationPersonneTitulaire&&u.informationsClientCarte.designationPersonneTitulaire.length>32&&(u.informationsClientCarte.designationPersonneTitulaire=u.informationsClientCarte.designationPersonneTitulaire.substr(0,32)),u&&u.informationsClientCarte&&u.informationsClientCarte.designationPersonneTier&&u.informationsClientCarte.designationPersonneTier.length>32&&(u.informationsClientCarte.designationPersonneTier=u.informationsClientCarte.designationPersonneTier.substr(0,32)),u&&u.listeOperationsCarte&&u.listeOperationsCarte.length&&u.listeOperationsCarte[0].designationPersonne.length>32&&(u.listeOperationsCarte[0].designationPersonne=u.listeOperationsCarte[0].designationPersonne.substr(0,32)),r.opecartetmfOperationCarteTmfService.postCarteTmf(u).then(function(i){return n?r.impressionBordereauCarteTMFService.genererImprimerBordereau(e,s,n).then(function(){return i}):r.contractualisationCarteTMFService.routerVersSpaContractualisation(e,s,n).then(function(){return i})})})})})})})})})})["catch"](function(e){return e?(r.serviceAgentExtended.Trace.error("Erreur lors de la création de carte TMF pour retrait","Création CarteTMF",e),o.reject(e)):o.resolve(null),o.promise})},n.prototype.forcerOuConfirmerPlafondDepasseCarteTMF=function(e,i,n,t,r,o){var a=this.$q.defer();return e?this.modalService.showConfirm({headerText:i,bodyText:r,actionButtonText:n,closeButtonText:t,size:"md",iconName:"itce-warning"}).then(function(){a.resolve(null)})["catch"](function(){a.reject()}):a.reject({libelle:o}),a.promise},n.prototype.genererListeMessageAlerteGab=function(e){var n=[];return _.forEach(e,function(e){if(0!==e.statutVentilation)n.push(_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_GAB_DISTRIBUTION_IMPOSSIBLE)({numero:e.numeroGab}));else if("0"===e.etatGab)n.push(_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_GAB_STATUT)({numero:e.numeroGab,statut:i.Constantes.CarteTMF.TEXTE_STATUT_HORS_SERVICE}));else if("9"===e.etatGab)n.push(_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_GAB_STATUT)({numero:e.numeroGab,statut:i.Constantes.CarteTMF.TEXTE_STATUT_INCONNU}));else if(""===e.etatGab||"1"===e.etatGab){var t=e.ventilation[0]+e.ventilation[1]+e.ventilation[2]+e.ventilation[3];e.reste[0]<e.ventilation[0]||e.reste[1]<e.ventilation[1]||e.reste[2]<e.ventilation[2]||e.reste[3]<e.ventilation[3]?t>=i.Constantes.CarteTMF.SEUIL_DISTRIBUTION_MULTIPLE?n.push(_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_GAB_NON_RESPECT_RISQUE)({numero:e.numeroGab})):n.push(_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_GAB_NON_RESPECT)({numero:e.numeroGab})):t>=i.Constantes.CarteTMF.SEUIL_DISTRIBUTION_MULTIPLE&&n.push(_.template(i.Constantes.CarteTMF.TEXTE_TEMPLATE_MESSAGE_GAB_RISQUE)({numero:e.numeroGab}))}}),n},n.prototype.getRolePersonneSurContrat=function(n){var t=e.comOpesFinancieres.Constantes.CarteTMF.TEXTE_CODE_TITULAIRE_T;if(n)switch(n.codeRole){case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_01:t=e.comOpesFinancieres.Constantes.CarteTMF.TEXTE_CODE_TITULAIRE_T;break;case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_03:t=e.comOpesFinancieres.Constantes.CarteTMF.TEXTE_CODE_MANDATAIRE;break;case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_05:t=e.comOpesFinancieres.Constantes.CarteTMF.TEXTE_CODE_REPRESENTANT}return t},n.$inject=["$q","serviceAgentExtended","gabEncaisseGabService","structureserviceInfoAgenceCarteTmfService","opecartetmfparametreHoraireEdsDateTmfService","opecartetmfCompteEligibleTmfService","opecartetmfAutorisationOpeTmfService","opecartetmfOperationCarteTmfService","opecartetmfparametrePlafondRetraitService","opecartetmfparametrePlafondOpeAgenceService","MwNotificationService","modalService","algorithmeDistributionService","impressionBordereauCarteTMFService","contractualisationCarteTMFService"],n}();n.CarteTempoMultiFonctionsService=r,i.module.service("carteTempoMultiFonctionsService",r)}(n=i.CarteTMF||(i.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(e){this.serviceAgent=e}return e.prototype.getEncaisseGab=function(e,i,n,t){var r={};return null!=e&&(r.codeAgent=e),null!=i&&(r.codeCaisse=i),null!=n&&(r.identifiantEds=n),null!=t&&(r.referenceExterneAgent=t),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/gab-v1/encaisseGab",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:r})},e.$inject=["serviceAgent"],e}();i.GabEncaisseGabService=n,e.module.service("gabEncaisseGabService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(e){this.serviceAgentExtended=e}return e.prototype.getAutorisationOpeCompteCarte=function(e,i,n,t,r,o,a){var s={};return null!=e&&(s.codeCaisse=e),null!=i&&(s.codeGuichet=i),null!=n&&(s.numeroCompte=n),null!=t&&(s.cleRib=t),null!=r&&(s.montantOpe=r),null!=o&&(s.typeOpe=o),null!=a&&(s.indicateurOAD=a),this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/opecartetmf/v1/autorisationOpeTmf",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:s})},e.$inject=["serviceAgentExtended"],e}();i.OpecartetmfAutorisationOpeTmfService=n,e.module.service("opecartetmfAutorisationOpeTmfService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(e){this.serviceAgent=e}return e.prototype.getCompteEligibleTmf=function(e,i,n,t,r,o,a){var s={};return null!=e&&(s.codeCaisse=e),null!=i&&(s.codeGuichet=i),null!=n&&(s.numeroCompte=n),null!=t&&(s.topOAD=t),r&&(s.cleRIB=r),o&&(s.numeroPersonne=o),null!=a&&(s.typeOperation=a),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/opecartetmf-v1/compteEligibleTmf",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:s})},e.$inject=["serviceAgent"],e}();i.OpecartetmfCompteEligibleTmfService=n,e.module.service("opecartetmfCompteEligibleTmfService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(e){this.serviceAgentExtended=e}return e.prototype.postCarteTmf=function(e){return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/opecartetmf/v1/operationCarteTmf",withHeaders:!0,method:MyWay.Services.MethodEnum.POST,data:e})},e.$inject=["serviceAgentExtended"],e}();i.OpecartetmfOperationCarteTmfService=n,e.module.service("opecartetmfOperationCarteTmfService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(e){this.serviceAgent=e}return e.prototype.getHoraireEdsTmf=function(e,i,n,t,r){var o={};return null!=e&&(o.codeCaisse=e),null!=i&&(o.identifiantEds=i),null!=n&&(o.referenceEds=n),null!=t&&(o.typeEds=t),null!=r&&(o.dateHoraireEds=r),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/opecartetmfparametre-v1/horaireEdsDateTmf",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:o})},e.$inject=["serviceAgent"],e}();i.OpecartetmfparametreHoraireEdsDateTmfService=n,e.module.service("opecartetmfparametreHoraireEdsDateTmfService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(e){this.serviceAgentExtended=e}return e.prototype.getPlafondOperationAgence=function(e,i){var n={};return null!=e&&(n.codeCaisse=e),null!=i&&(n.referenceExterneAgence=i),this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/opecartetmfparametre/v1/plafondOpeAgence",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:n})},e.$inject=["serviceAgentExtended"],e}();i.OpecartetmfparametrePlafondOpeAgenceService=n,e.module.service("opecartetmfparametrePlafondOpeAgenceService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(e){this.serviceAgentExtended=e}return e.prototype.getPlafondRetrait=function(e,i,n,t,r,o){var a={};return null!=e&&(a.codeCaisse=e),null!=i&&(a.codeGuichet=i),null!=n&&(a.numeroCompte=n),null!=t&&(a.codeTypeCompte=t),null!=r&&(a.referenceExterneAgence=r),null!=o&&(a.topOAD=o),this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/opecartetmfparametre/v1/plafondRetrait",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:a})},e.$inject=["serviceAgentExtended"],e}();i.OpecartetmfparametrePlafondRetraitService=n,e.module.service("opecartetmfparametrePlafondRetraitService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(e){this.serviceAgent=e}return e.prototype.getParametreCarteTmf=function(e,i){var n={};return null!=e&&(n.codeCaisse=e),null!=i&&(n.identifiantEds=i),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/structureservice-v1/infoAgenceCarteTmf",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,
params:n})},e.$inject=["serviceAgent"],e}();i.StructureserviceInfoAgenceCarteTmfService=n,e.module.service("structureserviceInfoAgenceCarteTmfService",n)}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(n){var t=this;this.$scope=n,this.forcePositiveMontant=!0,this.libelleMontantDeposeOuRetire=e.Constantes.Billetterie.LIBELLE_MONTANT_DEPOSE,null!=this.fonctionnalite&&MyWay.Services.StringUtils.startsWith(this.fonctionnalite.toString(),e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT)&&(this.libelleMontantDeposeOuRetire=e.Constantes.Billetterie.LIBELLE_MONTANT_RETIRE),this.effacerBilletterie(),this.isNegatifDifference=!1,this.afficherSyntheseBilletterie=!1,this.afficherBoutonEffacerBilletterie=!1,this.isDifference=!1,this.maxValeurBilletMonnaie=i.MONTANT_MAX_VALEUR_BILLET_MONNAIE,angular.isUndefined(this.estOuvertParDefaut)&&(this.estOuvertParDefaut=!0),n.$on("montant_changed",function(e,i){null!=i?t.sommeBilletterie():t.effacerBilletterie()}),n.$on("mwsfBilletterie_forcage_opefi",function(e,i){t.coupure=new MyWay.Model.Coupure,t.coupure=i.nombreCoupure,t.montantMonnaie=i.monnaieSansBillet,t.valeurMonnaie=i.monnaieSansBillet,t.valeurBillet5=5*i.nombreCoupure.b5,t.valeurBillet10=10*i.nombreCoupure.b10,t.valeurBillet20=20*i.nombreCoupure.b20,t.valeurBillet50=50*i.nombreCoupure.b50,t.valeurBillet100=100*i.nombreCoupure.b100,t.valeurBillet200=200*i.nombreCoupure.b200,t.valeurBillet500=500*i.nombreCoupure.b500,t.montantBilletterie=t.sommeBilletterie(),t.evalutationBoutonBilletterie(),t.estOuvertParDefaut=!0})}return i.prototype.sortirFocusBillet=function(e,n){if(null===n||isNaN(n)){switch(e){case 500:this.coupure.b500=i.VALEUR_A_ZERO_BILLETTERIE;break;case 200:this.coupure.b200=i.VALEUR_A_ZERO_BILLETTERIE;break;case 100:this.coupure.b100=i.VALEUR_A_ZERO_BILLETTERIE;break;case 50:this.coupure.b50=i.VALEUR_A_ZERO_BILLETTERIE;break;case 20:this.coupure.b20=i.VALEUR_A_ZERO_BILLETTERIE;break;case 10:this.coupure.b10=i.VALEUR_A_ZERO_BILLETTERIE;break;case 5:this.coupure.b5=i.VALEUR_A_ZERO_BILLETTERIE}this.changerValeurBillet(e,i.VALEUR_A_ZERO_BILLETTERIE)}else this.changerValeurBillet(e,n)},i.prototype.verifierFocusMonnaie=function(e){e===i.VALEUR_A_ZERO_BILLETTERIE&&(this.montantMonnaie=null)},i.prototype.sortirFocusMonnaie=function(e){null===e&&(this.montantMonnaie=i.VALEUR_A_ZERO_BILLETTERIE)},i.prototype.verifierFocusBillet=function(e,n){if(n===i.VALEUR_A_ZERO_BILLETTERIE)switch(e){case 500:this.coupure.b500=null;break;case 200:this.coupure.b200=null;break;case 100:this.coupure.b100=null;break;case 50:this.coupure.b50=null;break;case 20:this.coupure.b20=null;break;case 10:this.coupure.b10=null;break;case 5:this.coupure.b5=null}},i.prototype.afficherLaBilletterie=function(e){return e?e&&this.montantBilletterie>i.VALEUR_A_ZERO_BILLETTERIE&&(this.afficherBoutonEffacerBilletterie=!0):this.afficherBoutonEffacerBilletterie=!1,this.afficherBilletterie},i.prototype.changerValeurBillet=function(e,n){var t=i.VALEUR_A_ZERO_BILLETTERIE,r=i.VALEUR_A_ZERO_BILLETTERIE;switch(n>this.maxValeurBilletMonnaie?(t=this.maxValeurBilletMonnaie*e,r=this.maxValeurBilletMonnaie):null===n?(t=i.VALEUR_A_ZERO_BILLETTERIE,r=i.VALEUR_A_ZERO_BILLETTERIE):t=n*e,e){case 500:this.valeurBillet500=t,n>this.maxValeurBilletMonnaie&&(this.coupure.b500=this.maxValeurBilletMonnaie),null===n&&(this.coupure.b500=i.VALEUR_A_ZERO_BILLETTERIE);break;case 200:this.valeurBillet200=t,n>this.maxValeurBilletMonnaie&&(this.coupure.b200=this.maxValeurBilletMonnaie),null===n&&(this.coupure.b200=i.VALEUR_A_ZERO_BILLETTERIE);break;case 100:this.valeurBillet100=t,n>this.maxValeurBilletMonnaie&&(this.coupure.b100=this.maxValeurBilletMonnaie),null===n&&(this.coupure.b100=i.VALEUR_A_ZERO_BILLETTERIE);break;case 50:this.valeurBillet50=t,n>this.maxValeurBilletMonnaie&&(this.coupure.b50=this.maxValeurBilletMonnaie),null===n&&(this.coupure.b50=i.VALEUR_A_ZERO_BILLETTERIE);break;case 20:this.valeurBillet20=t,n>this.maxValeurBilletMonnaie&&(this.coupure.b20=this.maxValeurBilletMonnaie),null===n&&(this.coupure.b20=i.VALEUR_A_ZERO_BILLETTERIE);break;case 10:this.valeurBillet10=t,n>this.maxValeurBilletMonnaie&&(this.coupure.b10=this.maxValeurBilletMonnaie),null===n&&(this.coupure.b10=i.VALEUR_A_ZERO_BILLETTERIE);break;case 5:this.valeurBillet5=t,n>this.maxValeurBilletMonnaie&&(this.coupure.b5=this.maxValeurBilletMonnaie),null===n&&(this.coupure.b5=i.VALEUR_A_ZERO_BILLETTERIE)}this.montantBilletterie=this.sommeBilletterie(),this.evalutationBoutonBilletterie(),this.$scope.$emit("mwsfBilletterie_changement_valeur_coupure",this.coupure)},i.prototype.changerValeurMonnaie=function(e){e>this.maxValeurBilletMonnaie?(this.valeurMonnaie=this.maxValeurBilletMonnaie,this.montantMonnaie=this.maxValeurBilletMonnaie):this.valeurMonnaie=e,this.montantBilletterie=this.sommeBilletterie(),this.$scope.$emit("mwsfBilletterie_changement_valeur_monnaie",this.valeurMonnaie),this.evalutationBoutonBilletterie()},i.prototype.evalutationBoutonBilletterie=function(){this.montantBilletterie>i.VALEUR_A_ZERO_BILLETTERIE?(this.afficherSyntheseBilletterie=!0,this.afficherBoutonEffacerBilletterie=!0):(this.afficherSyntheseBilletterie=!1,this.afficherBoutonEffacerBilletterie=!1)},i.prototype.effacerBilletterie=function(){this.coupure=new MyWay.Model.Coupure,this.valeurBillet500=i.VALEUR_A_ZERO_BILLETTERIE,this.valeurBillet200=i.VALEUR_A_ZERO_BILLETTERIE,this.valeurBillet100=i.VALEUR_A_ZERO_BILLETTERIE,this.valeurBillet50=i.VALEUR_A_ZERO_BILLETTERIE,this.valeurBillet20=i.VALEUR_A_ZERO_BILLETTERIE,this.valeurBillet10=i.VALEUR_A_ZERO_BILLETTERIE,this.valeurBillet5=i.VALEUR_A_ZERO_BILLETTERIE,this.valeurMonnaie=i.VALEUR_A_ZERO_BILLETTERIE,this.montantBilletterie=i.VALEUR_A_ZERO_BILLETTERIE,this.montantMonnaie=i.VALEUR_A_ZERO_BILLETTERIE,this.differenceMontant=i.VALEUR_A_ZERO_BILLETTERIE,this.afficherBoutonEffacerBilletterie=!1,this.afficherSyntheseBilletterie=!1,this.$scope.$emit("mwsfBilletterie_effacer_billetterie")},i.prototype.sommeBilletterie=function(){var e=i.VALEUR_A_ZERO_BILLETTERIE;return e=this.valeurBillet500+this.valeurBillet200+this.valeurBillet100+this.valeurBillet50+this.valeurBillet20+this.valeurBillet10+this.valeurBillet5+this.valeurMonnaie,angular.isDefined(this.montant)&&(this.montant<i.VALEUR_A_ZERO_BILLETTERIE?this.differenceMontant=(-100*this.montant-100*e)/100:this.differenceMontant=Math.round(100*this.montant)/100-Math.round(100*e)/100),this.isNegatifDifference=this.differenceMontant<i.VALEUR_A_ZERO_BILLETTERIE?!0:!1,this.isDifference=this.differenceMontant===i.VALEUR_A_ZERO_BILLETTERIE?!1:!0,this.texteDifferenceMontant=this.differenceMontant.toFixed(2),e},i.$inject=["$scope"],i.MONTANT_MAX_VALEUR_BILLET_MONNAIE=9999999999,i.VALEUR_A_ZERO_BILLETTERIE=0,i}();e.BilletterieController=i,e.module.controller("BilletterieController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/billetterie/billetterie-view.html",scope:{montant:"=",montantBilletterie:"=",afficherBilletterie:"=",coupure:"=",estOuvertParDefaut:"=?",fonctionnalite:"=?"},controller:"BilletterieController",controllerAs:"viewModelBilletterieCtrl",bindToController:!0,link:function(e,i,n){}}}e.mwsfBilletterie=i,e.module.directive("mwsfBilletterie",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,t,r){var o=this;this.$scope=e,this.chequeBanqueService=t,this.serviceAgentExtended=r,this.initialisationVariablesEtDonnes(),t.getNumeroConseiller().then(function(e){e&&angular.isDefined(e)&&(o.numeroConseiller=e)}),e.$on("mode_financier_changed",function(e,r){r&&r===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&t.getChequeBanqueEnCours(o.numeroConseiller).then(function(e){null!==e&&(o.afficherChequeEnCours=!0,o.isChequeEnCours=!0,o.chequeEnCours=e,o.chequeEnCours.derniereContrepartie=!1,o.chequeEnCours.multiRetrait=!1,o.afficherChequeEnCours&&(o.choixCheque=n.CHOIX_CHEQUE_MULTI_BOUTONS_RADIOS_CHEQUE_BANQUE,o.estMultiRetrait=!0,o.remplissageChampsChequeEnCours(e)))})})}return n.prototype.clicChoixCheque=function(t){if(t===n.CHOIX_CHEQUE_UNIQUE_BOUTONS_RADIOS_CHEQUE_BANQUE){if(this.desactiverDernierCheque=!1,this.estMultiRetrait=!0,this.isChequeEnCours&&(this.chequeEnCours.multiRetrait=!0,this.remplissageChampsChequeEnCours(this.chequeEnCours)),this.montant<0&&this.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE){var r=new e.comOpesFinancieres.Model.ChequeBanque;r.beneficiaire=this.beneficiaireCheque,r.devise=this.devise,r.numero=this.numeroCheque,r.modeFinancier=this.modeFinancier,r.multiRetrait=!0,this.dernierCheque&&(this.chequeEnCours&&(this.chequeEnCours.derniereContrepartie=!0),r.derniereContrepartie=!0)}this.emissionChequeDeBanque()}else this.desactiverDernierCheque=!0,this.chequeEnCours&&(this.chequeEnCours.derniereContrepartie=!1,this.chequeEnCours.multiRetrait=!1),this.estMultiRetrait=!1,this.verrouillerChampNumeroCheque=!1,this.numeroCheque="",this.beneficiaireCheque="",this.afficherMontantGlobal=!1,this.montantDeviseTexteGlobalCheque="",this.$scope.$emit("mwsfChequeBanque_effacer_cheque_banque")},n.prototype.clicDernierCheque=function(e){e?this.emissionChequeDeBanque():(this.choixCheque===n.CHOIX_CHEQUE_MULTI_BOUTONS_RADIOS_CHEQUE_BANQUE&&this.montant<n.VARIABLE_A_ZERO_CHEQUE_BANQUE&&this.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&this.chequeEnCours&&(this.chequeEnCours.derniereContrepartie=!0,this.chequeEnCours.multiRetrait=!0),this.emissionChequeDeBanque())},n.prototype.initialisationVariablesEtDonnes=function(){this.desactiverDernierCheque=!0,this.choixCheque=n.CHOIX_CHEQUE_UNIQUE_BOUTONS_RADIOS_CHEQUE_BANQUE,this.beneficiaireCheque="",this.dernierCheque=!1,this.afficherMontantGlobal=!1,this.numeroCheque="",this.verrouillerChampNumeroCheque=!1,this.isChequeEnCours=!1,this.isDerogationImpression=!1,this.montantDeviseTexteGlobalCheque="",this.messageErreurChequeBanque="",this.estMultiRetrait=!1},n.prototype.ouverturePopupConfirmationCheque=function(){var e=this,i=!0;this.chequeBanqueService.openPopupChequeBanque(this.chequeEnCours,i,this.contexteSaisieOpeFi).then(function(i){i&&(e.desactiverDernierCheque=!0,e.choixCheque=n.CHOIX_CHEQUE_UNIQUE_BOUTONS_RADIOS_CHEQUE_BANQUE,e.beneficiaireCheque="",e.dernierCheque=!1,e.afficherMontantGlobal=!1,e.numeroCheque="",e.verrouillerChampNumeroCheque=!1,e.isChequeEnCours=!1,e.isDerogationImpression=!1,e.montantDeviseTexteGlobalCheque="",e.messageErreurChequeBanque="",e.estMultiRetrait=!1)})},n.prototype.remplissageChampsChequeEnCours=function(e){this.numeroCheque=e.numero,this.verrouillerChampNumeroCheque=!0,e.montantGlobal!==n.VARIABLE_A_ZERO_CHEQUE_BANQUE&&(this.afficherMontantGlobal=!0,this.montantDeviseTexteGlobalCheque=e.montantGlobal+" "+e.devise.sigle),this.beneficiaireCheque=e.beneficiaire},n.prototype.affinerNumeroCheque=function(e){this.numeroCheque=null!=this.numeroCheque?_.padLeft(String(e),n.NOMBRE_MAXIMUM_CHIFFRE_NUMERO_CHEQUE_BANQUE,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING):""},n.prototype.emissionChequeDeBanque=function(){var i=new e.comOpesFinancieres.Model.ChequeBanque;i.numero=this.numeroCheque,i.beneficiaire=this.beneficiaireCheque,i.derniereContrepartie=this.dernierCheque,i.multiRetrait=this.estMultiRetrait,this.serviceAgentExtended.Trace.info("Emission du chèque de banque","emissionChequeDeBanque",i),this.$scope.$emit("mwsfChequeBanque_cheque_banque_emis",i)},n.$inject=["$scope","chequeBanqueService","serviceAgentExtended"],n.VARIABLE_A_ZERO_CHEQUE_BANQUE=0,n.NOMBRE_MAXIMUM_CHIFFRE_NUMERO_CHEQUE_BANQUE=7,n.CHOIX_CHEQUE_MULTI_BOUTONS_RADIOS_CHEQUE_BANQUE="chequeMulti",n.CHOIX_CHEQUE_UNIQUE_BOUTONS_RADIOS_CHEQUE_BANQUE="chequeUnique",n}();i.ChequeBanqueController=n,i.module.controller("ChequeBanqueController",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/cheque-banque/cheque-banque-view.html",scope:{modeFinancier:"=",devise:"=",montant:"=",contexteSaisieOpeFi:"="},controller:"ChequeBanqueController",controllerAs:"viewModelChequeBanqueCtrl",bindToController:!0,link:function(e,i,n){}}}e.mwsfChequeBanque=i,e.module.directive("mwsfChequeBanque",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(n){var t=this;this.$scope=n,this.chequeBanqueOperation?(this.numeroCheque=this.chequeBanqueOperation.numeroCheque,this.beneficiaireCheque=this.chequeBanqueOperation.beneficiaireCheque):this.chequeBanqueOperation=new e.comOpesFinancieres.Model.ChequeBanqueOperation,n.$on("mode_financier_changed",function(e,n){null!==n&&n!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&(t.numeroCheque="",t.beneficiaireCheque="",t.$scope.$emit("cheque_banque_operation_modification","",""))})}return n.prototype.affinerNumeroCheque=function(e){this.numeroCheque=null!=this.numeroCheque?_.padLeft(String(e),i.ChequeBanqueController.NOMBRE_MAXIMUM_CHIFFRE_NUMERO_CHEQUE_BANQUE,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING):"",this.chequeBanqueOperation.numeroCheque=this.numeroCheque,this.$scope.$emit("cheque_banque_operation_modification",this.numeroCheque,this.beneficiaireCheque)},n.prototype.modificationBeneficaire=function(e){this.chequeBanqueOperation.beneficiaireCheque=e,this.$scope.$emit("cheque_banque_operation_modification",this.numeroCheque,e)},n.$inject=["$scope"],n}();i.ChequeBanqueOperationControleur=n,i.module.controller("chequeBanqueOperationControleur",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",controller:"chequeBanqueOperationControleur",controllerAs:"ctrl",templateUrl:"typescript/cheque-banque-operation/cheque-banque-operation-view.html",bindToController:!0,scope:{chequeBanqueOperation:"="}}}e.mwsfChequeBanqueOperation=i,e.module.directive("mwsfChequeBanqueOperation",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e.ID_LIBELLE_OPERATION_FINANCIERE="libelle-operation-financiere",e.ID_NUMERO_CHEQUE_BANQUE_OPERATION_FINANCIERE="numero-cheque-banque-operation",e.ID_BENEFICIAIRE_CHEQUE_BANQUE_OPERATION_FINANCIERE="beneficiaire-cheque-banque-operation",e.ID_MONTANT_OPERATION_FINANCIERE="montant-opefi-input",e.ID_OPERATION_DIVERSE="operation-diverse-liste",e.ID_TITULAIRE_COMPTE="titulaire-compte-operation-financiere",e.ID_LISTE_COMPTE_VIREMENT_INTERNE="id-liste-comptes-virement-interne-opefi",e.ID_RICE_SAISIT_VIREMENT_INTERNE="id-rice-virement-interne-opefi",e.ID_REFERENCE_ENVELOPPE="numero-reference-enveloppe",e.ID_BILLETTERIE="billetterie-opefi",e.ID_REFERENCE_OAD="reference-oad-opefi",e.ID_MODE_FINANCIER="mode-financier",e.ID_LIBELLE_COMPLEMENTAIRE="libelle-complementaire2-opefi",e}();e.IdentfiantsChampsOperationsFinancieres=i;var n=function(){function e(){}return e.MESSAGE_LIBELLE_OPERATION_VIDE="Le libellé d'opération est vide",e.MESSAGE_LIBELLE_NUMERO_CHEQUE_BANQUE_VIDE="Le numéro du chèque de banque est vide.",e.MESSAGE_LIBELLE_BENEFICIAIRE_CHEQUE_BANQUE_VIDE="Le bénéficiaire du chèque de banque est vide",e.MESSAGE_MONTANT_VIDE="Le montant de l'opération est vide",e.MESSAGE_OPERATION_DIVERSE="L'opération diverse est incomplète : il manque des zones obligatoires * à saisir",e.MESSAGE_TITULAIRE_COMPTE="Le titulaire du compte est vide",e.MESSAGE_COMPTE_SELECTIONNE_VIREMENT_INTERNE="Le compte sélectionné est incorrect",e.MESSAGE_RICE_SAISIT_VIREMENT_INTERNE="La saisie du RICE est incorrecte",e.MESSAGE_REFERENCE_ENVELOPPE="Le numéro du sac est incorrect",e.MESSAGE_BILLETTERIE_INCORRECT="La billetterie est incorrecte",e.MESSAGE_REFERENCE_OAD="La référence de l'opération est incorrecte",e.MESSAGE_MONTANT_NON_MULTIPLE_DE_10="Le montant est invalide, multiple de 10 obligatoire.",e.MESSAGE_MODE_FINANCIER_VIDE="Le mode financier est invalide.",e.MESSAGE_PLAFOND_VERSEMENT_DEPASSE="Le montant dépasse le seuil d'alerte.",e.MESSAGE_MONTANT_DEPASSE_MONTANT_MAXIMUM="Le montant dépasse le montant maximum.",e.MESSAGE_LIBELLE_COMPLEMENTAIRE="Le libellé complémentaire de l'opération est obligatoire.",e}();e.MessagesErreursChampsOperationsFinancieres=n}(i=e.Constantes||(e.Constantes={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e.TEXTE_CODE_DEVISE_EURO="EUR",e}();e.Devise=i;var n=function(){function e(){}return e.LIBELLE_ROLE_TITULAIRE="Titulaire",e.LIBELLE_ROLE_COTITULAIRE="Cotitulaire",e.LIBELLE_ROLE_PROCURATION_GENERALE="Procuration générale",e.LIBELLE_ROLE_PROCURATION_GENERALE_COMPTE="Procuration général par compte",e.LIBELLE_ROLE_REPRESENTANT_LEGAL="Représentant légal",e.LIBELLE_ROLE_REPRESENTANT_LEGAL_PERS_MORALE="Représentant légal personne morale",e.LIBELLE_ROLE_PROCURATION_GENERALE_PRO="Procuration spéciale porteur de carte pro",e.LIBELLE_ROLE_AUTRES="Autres",e.LIBELLE_ROLE_MANDATAIRE="Mandataire",e}();e.LibelleRoleSignataire=n;var t=function(){function e(){}return e.NOM_TABLE_DV7I="DV7I",e.CODE_ETABLISSEMENT_RUBRIQUE_COCXBQ="COCXBQ",e.CODE_PRODUIT_SERVICE_RUBRIQUE_CODIPR="CODIPR",e.IDENTIFIANT_PRODUIT_SERVICE_RUBRIQUE_IDEGPS="IDEGPS",e.CODE_MODE_GESTION_RUBRIQUE_CIGLDM="CIGLDM",e}();e.TableDelocaliseeDV7I=t;var r=function(){function e(){}return e.COMPTE_88_INTERDIT="0088",e.CODE_RESULTAT_COMMERCIAL_VERSEMENT="2",e.CODE_RESULTAT_COMMERCIAL_RETRAIT="3",e.CODE_NATURE_RESULTAT_COMMERCIAL_NORMALE="0",e.CODE_NATURE_RESULTAT_COMMERCIAL_ANNULATION="3",e.CODE_FAMILLE_RESULTAT_COMMERCIAL="1",e.CODE_INDIC_RATTACHABLE_CRE_RESULTAT_COMMERCIAL="1",e.CODE_MODE_GESTION_LIVRET_RESULTAT_COMMERCIAL="1",e.CODE_ORIGINE_FONDS_DEFAUT_RESULTAT_COMMERCIAL=0,e.CODE_ORIGINE_FONDS_ESPECES_CHB_RESULTAT_COMMERCIAL=1,e}();e.SuiviCommercial=r;var o=function(){function e(){}return e.CONTEXTE_NUM_PLAN="NUMPLAN",e.CONTEXTE_MAJ_JAB="MAJJab",e.CODE_TRANSACTION_MYWA="MyWa",e}();e.JournalApplicatif=o;var a=function(){function e(){}return e.LIBELLE_MODE_FINANCIER_OD_LIJMMI="VIREMENT OPERATION DIVERSE",e.CODE_MODE_FINANCIER_OD_CTGXMF="VIO",e}();e.ModeFinancierOperationDiverse=a;var s=function(){function e(){}return e.URL_REST_RESULTAT_ENTETIEN="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/entretiencommercial-v1/resultatEntretien",e}();e.UrlRest=s;var c=function(){function e(){}return e.MESSAGE_ERREUR_PLAFOND_DEPASSE="Le montant saisi dépasse %%%% € et n’est pas autorisé.",e.TEXTE_BOUTON_OK="OK",e.TEXTE_BOUTON_OUI="Oui",e.TEXTE_BOUTON_NON="Non",e.TITRE_MODAL_ATTENTION="Attention",e.MESSAGE_CONFIRMATION_PLAFOND_DEPASSE="Vous vous apprêtez à saisir une opération de montant supérieur à %%%% €. Confirmez-vous votre saisie ?",e}();e.PlafondVersement=c;var l=function(){function e(){}return e.CODE_OPERATION_N="N",e.CODE_OPERATION_A="A",e.RESERVE_ENCAISSEMENT_DEFAUT_CINQ=5,e.TITRE_PANEL_PRINCIPAL_DEFAUT="Informations opération",e.TEXTE_SOLDE_COMPTE_AVANT_VIREMENT_INTERNE="Solde compte choisi avant virement interne : ",e.TEXTE_NOUVEAU_SOLDE_APRES_VIREMENT_INTERNE="Nouveau solde après virement interne : ",e.TEXTE_LIBELLE_DEPOT_ESP_NUMERO="DEPOT ESP N° ",e.CODE_REFERENCE_OD_VEOD="VEOD",e.TEXTE_OUI_O="O",e.TEXTE_NON_N="N",e.TEXTE_INTERNE_I="I",e.TEXTE_EXTERNE_E="E",e.CODE_MODE_ESPECES_ESP="ESP",e.TEXTE_BOUTON_VALIDER="Valider",e.TEXTE_NUMERO_BORDEREAU="NumeroBordereau",e.TEXTE_BORD_TIRET_BAS="Bord_",e.NOM_FICHIER_PDF_BORDEREAU_OPERATION="siprgce_bordereau_BORD001.pdf",e.MESSAGE_ERREUR_UTILISATEUR_HABILITATION_SHJM25="L'utilisateur n'a pas l'habilitation SHJM25",e.TYPE_RECHERCHE_COMPTE_NUMERO_PERSONNE="numeroPersonne",e.CODE_APPLICATION_BILLETTERIE_AUTO="BILLAUTO",e.LIBELLE_MONTANT_DEFAUT="Montant",e.LIBELLE_MONTANT_RETRAIT="Montant à retirer",e.LIBELLE_MONTANT_DEPOT="Montant déposé",e.LIBELLE_MONTANT_GLOBAL="Montant global à retirer",e.LIBELLE_VIREMENT_INTERNE_DEBITE_DEFAUT="Compte à débiter",e.LIBELLE_VIREMENT_INTERNE_CREDITE="Compte à créditer",e.TEXTE_LIBELLE_ANNULATION_DEPOT_ESP_NUMERO="ANN DEPOT ESP N° ",e.NOM_DONNEES_SAG_OPC="donneesSAGOPC",e.CODE_SORTIE_SAG_OPC=2,e.TEXTE_LIBELLE_ANN_EXTOURNE="ANN. ",e.TEXTE_LIBELLE_ANNULATION_VIREMENT="ANNULATION VIREMENT",e.CODE_PRODUIT_00="00",e.CODE_PRODUIT_17="17",e.CODE_PTU_IMP_CHEQUE_BANQUE="IMPCH",e.LIBELLE_DEFAUT_CHEQUE_BANQUE="RET. CHEQUE DE BANQUE",e.TEXTE_PLAFOND_VERSEMENT="Le plafond maximum de versement est de",e.TEXTE_PLAFOND_RETRAIT="Le plafond maximum de retrait est de",e}();e.OperationFinanciere=l;var p=function(){function e(){}return e.CODE_SAG="SAG",e.CODE_PAP="PAP",e}();e.BordereauJab=p;var m=function(){function e(){}return e.TEXTE_SANS_RESERVE="Sans réserve",e.NOMBRE_JOURS_SANS_RESERVE_00="00",e.TEXTE_JOURS=" jour(s)",e.FORMAT_DATE_DD_MM_YYYY="DD/MM/YYYY",e}();e.Extourne=m;var u=function(){function e(){}return e.LIBELLE_RET_VIREMENT_INTERNE="RET. VIREMENT INTERNE",e.LIBELLE_AN_RET_VIREMENT_INTERNE="AN.RET.VIREMENT INTERNE",e.LIBELLE_DEBUT_RET_VIREMENT_INTERNE="RET.",e.LIBELLE_DEBUT_ANN_RET_VIREMENT_INTERNE="ANN. RET.",e.LIBELLE_CHEQUES_DEPOSES="Chèques déposés ",e.TEXTE_MONTANT_ESPECES_REMETTRE="Montant espèces à remettre au client",e.TEXTE_MONTANT_ESPECES_RECEVOIR="Montant espèces à recevoir du client",e.TEXTE_BILLETTERIE_EUR_RETRAIT="Billetterie EUR retrait :",e.TEXTE_BILLETTERIE_EUR_DEPOT="Billetterie EUR dépôt :",e.TEXTE_MONNAIE="Monnaie: ",e.TEXTE_EUR=" EUR",e.TEXTE_EUR_SANS_ESPACE="EUR",e.TEXTE_OD="OD/ ",e.TEXTE_NUMERO_CHEQUE=" n° ",e.FORMAT_DATE_DD_MM_YYYY="DD/MM/YYYY",e.FORMAT_HEURE_HH_MM_SS="HH:mm:ss",e.TEXTE_OFFRE_NUMERO="Offre n° ",e.TITRE_DOCUMENT="BORDEREAU D'OPERATIONS",e.LIBELLE_PARTICIPANT_AUTRES="Autres",e.CODE_ROLE_SIGNATAIRE_AUTRES="99",e.CODE_ATOME_CLOTURE="C01",e}();e.BordereauOperation=u;var d=function(){function e(){}return e.TEXTE_MESSAGE_ERREUR_GENERATION_BORDEREAU="La génération du bordereau d'opération a échoué",e.TEXTE_MESSAGE_ERREUR_BORDEREAU_NON_CONTEXTE="Le bordereau n'existe pas dans le context",e}();e.MessageErreur=d;var E=function(){function e(){}return e.LIBELLE_FRAIS_DELIVRANCE_VRAC=" * FRAIS DELIVRANCE DE VRAC",e.LIBELLE_FRAIS_CHEQUE_BANQUE=" * FRAIS EMIS. CHEQUE DE BANQUE",e}();e.Facturation=E;var h=function(){function e(){}return e.TEXTE_VERSEMENT_SIMPLE_MAJ="VERSEMENT_SIMPLE",e.TEXTE_CLOTURE_CDD_MAJ="CLOTURE_CDD",e.TEXTE_CLOTURE_COMPTE_MAJ="CLOTURE_COMPTE",e.TEXTE_OUVERTURE_COMPTE_MAJ="OUVERTURE_COMPTE",e.TEXTE_OUVERTURE_CDD_MAJ="OUVERTURE_CDD",e.TEXTE_OUVERTURE_CDD_CCOOP="OUVERTURE_CDD_CCOOP",e.TEXTE_VERSEMENT_MAJ="VERSEMENT",e.TEXTE_OUVERTURE_EPARGNE="OUVERTURE_EPARGNE",e.TEXTE_OUVERTURE_PEL="OUVERTURE_PEL",e.TEXTE_OUVERTURE_CEL="OUVERTURE_CEL",e.TEXTE_COMPTE_CANTONNEMENT="COMPTE_CANTONNEMENT",e.TEXTE_OUVERTURE_VAD="GENERIQUE_VAD",e.TEXTE_OUVERTURE_DAT="OUVERTURE_DAT",e.TEXTE_OUVERTURE_LIVRET_A="LIVRET_A",e.TEXTE_OUVERTURE_PEA="OUVERTURE_PEA",e.TEXTE_EXTOURNE_OUVERTURE_PEA="EXTOURNE_OUVERTURE_PEA",e.TEXTE_EXTOURNE_CLOTURE_PEA="EXTOURNE_CLOTURE_PEA",e.TEXTE_OUVERTURE_COMPTE_ATTENTE="OUVERTURE_COMPTE_ATTENTE",e.TEXTE_OPERATION_RETRAIT="OPERATION_RETRAIT",e.TEXTE_OPERATION_DEPOT="OPERATION_DEPOT",e.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE="OPERATION_RETRAIT_HORS_CLIENTELE",e.TEXTE_OPERATION_DEPOT_HORS_CLIENTELE="OPERATION_DEPOT_HORS_CLIENTELE",e.TEXTE_OPERATION_DEPOT_OAD="OPERATION_DEPOT_OAD",e.TEXTE_OPERATION_RETRAIT_OAD="OPERATION_RETRAIT_OAD",e.TEXTE_OPERATION_DEPOT_DEVISE="OPERATION_DEPOT_DEVISE",e.TEXTE_OPERATION_RETRAIT_DEVISE="OPERATION_RETRAIT_DEVISE",e.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE_COMPTE_88="OPERATION_RETRAIT_HORS_CLIENTELE_COMPTE_88",e.TEXTE_OPERATION_DEPOT_HORS_CLIENTELE_COMPTE_88="OPERATION_DEPOT_HORS_CLIENTELE_COMPTE_88",e.TEXTE_OPERATION_DEPOT_COMPTE_88="OPERATION_DEPOT_COMPTE_88",e.TEXTE_OPERATION_RETRAIT_COMPTE_88="OPERATION_RETRAIT_COMPTE_88",e.TEXTE_OUVERTURE=[e.TEXTE_OUVERTURE_COMPTE_MAJ,e.TEXTE_OUVERTURE_CDD_MAJ,e.TEXTE_OUVERTURE_CDD_CCOOP,e.TEXTE_OUVERTURE_EPARGNE,e.TEXTE_OUVERTURE_PEL,e.TEXTE_OUVERTURE_CEL,e.TEXTE_OUVERTURE_VAD,e.TEXTE_OUVERTURE_DAT,e.TEXTE_OUVERTURE_LIVRET_A,e.TEXTE_OUVERTURE_PEA],e}();e.Fonctionnalite=h;var f=function(){function e(){}return e.MINI_PROFIL_TYPE_RESTITUTION_UNITAIRE="U",e.MINI_PROFIL_TYPE_RECHERCHE_RICE="R",e.MINI_PROFIL_TYPE_RECHERCHE_SOLDE_D="D",e}();e.ConstantesSolde=f;var v=function(){function e(){}return e.MODE_FINANCIER_OPERATIONS_DIVERSES="00",e.MODE_FINANCIER_ESPECES="01",e.MODE_FINANCIER_CHEQUE_RECU="02",e.MODE_FINANCIER_VIREMENT_INTERNE="06",e.MODE_FINANCIER_ESPECES_DIVERS="07",e.MODE_FINANCIER_CHEQUE_BANQUE="09",e.MODE_FINANCIER_DIVERS="10",e.MODE_FINANCIER_OUVERTURE_ZERO="99",e}();e.CodeModeFinancier=v;var C=function(){function e(){}return e.CHIFFRE_ZERO_STRING="0",e.CHIFFRE_UN_STRING="1",e.CHIFFRE_TROIS_ZERO_STRING="000",e}();e.ChiffreString=C;var O=function(){function e(){}return e.CHIFFRE_ZERO_NUMBER=0,e.CHIFFRE_CINQ_NUMBER=5,e.CHIFFRE_DIX_NUMBER=10,e.CHIFFRE_VINGT_NUMBER=20,e.CHIFFRE_CINQUANTE_NUMBER=50,e.CHIFFRE_CENT_NUMBER=100,e.CHIFFRE_DEUX_CENT_NUMBER=200,e.CHIFFRE_CINQ_CENT_NUMBER=500,e}();e.ChiffreNumber=O;var R=function(){function e(){}return e.OK=0,e.PRESQUE_VIDE=1,e.VIDE=2,e.EN_ERREUR=3,e.ABSENTE=9,e}();e.EtatCassette=R;var _=function(){function e(){}return e.OK="1",e.KO="0",e}();e.EtatGAB=_;var g=function(){function e(){}return e.OK=0,e.KO=-1,e}();e.EtatVentilation=g;var T=function(){function e(){}return e.CODE_HABILITATION_SHJE05="SHJE05",e.CODE_HABILITATION_SHJE06="SHJE06",e.CODE_HABILITATION_SHJE07="SHJE07",e.CODE_HABILITATION_SHJM25="SHJM25",e.CODE_HABILITATION_SHKG18="SHKG18",e.CODE_HABILITATION_SHGXG9="SHGXG9",e.CODE_HABILITATION_SHGXHK="SHGXHK",e}();e.CodeHabilitation=T;var F=function(){function e(){}return e.TEXTE_SEGMENTPRVRIO_MAJUSCULE="SEGMENTPRVRIO",e}();e.Segment=F;var S=function(){function e(){}return e.EDS_INTERNE_RATTACHEMENT_GUICHET_COMPTABLE="edsInterneRattachementGuichetComptable",e.EDS_TYPE_RATTACHEMENT_GUICHET_COMPTABLE="edsTypeRattachementGuichetComptable",e.CODE_GUICHET_INTERBANCAIRE="codeGuichetInterbancaire",e.DATE_OPERATION_JOURNEE_COMPTABLE="dateOperationJourneeComptable",e}();e.ParametresComptables=S;var A=function(){function e(){}return e.TABLE_DELOC_FAMILLES_OD_JU2A="JU2A",e.TABLE_DELOC_CODE_REGROUPEMENT_OD_JU2C="JU2C",e.TABLE_DELOC_TYPES_OD_JU2B="JU2B",e.PROPRIETE_TABLE_DELOC_COJOFA="COJOFA",e.PROPRIETE_TABLE_DELOC_YNOXCE="YNOXCE",e.PROPRIETE_TABLE_DELOC_UCGWBD="UCGWBD",e.PROPRIETE_TABLE_DELOC_UCGWGA="UCGWGA",e.PROPRIETE_TABLE_DELOC_UCGWBA="UCGWBA",e.PROPRIETE_TABLE_DELOC_UCGWRT="UCGWRT",e.PROPRIETE_TABLE_DELOC_UCGWMO="UCGWMO",e.PROPRIETE_TABLE_DELOC_CIJOAS="CIJOAS",e.PROPRIETE_TABLE_DELOC_UCGWSR="UCGWSR",e.PROPRIETE_TABLE_DELOC_ULIWFO="ULIWFO",e.PROPRIETE_TABLE_DELOC_UCTXS5="UCTXS5",e.PROPRIETE_TABLE_DELOC_DDEXPH="DDEXPH",e.PROPRIETE_TABLE_DELOC_DFJOVA="DFJOVA",e.PROPRIETE_TABLE_DELOC_LIJMTI="LIJMTI",e.PROPRIETE_TABLE_DELOC_LIJMOB="LIJMOB",e.PROPRIETE_TABLE_DELOC_CIJMTI="CIJMTI",e.PROPRIETE_TABLE_DELOC_CIJMOB="CIJMOB",e.PROPRIETE_TABLE_DELOC_COJXHD="COJXHD",e.PROPRIETE_TABLE_DELOC_ULIWOD="ULIWOD",e.PROPRIETE_TABLE_DELOC_IDSEQ3="IDSEQ3",e}();e.TablesDelocaliseesOperationDiverse=A;var P=function(){function e(){}return e.TABLE_DELOC_PRODUIT="PRODUIT",e.PROPRIETE_TABLE_DELOC_CODIPR="CODIPR",e.PROPRIETE_TABLE_DELOC_COLIDV="COLIDV",e.PROPRIETE_TABLE_DELOC_IDEGPS="IDEGPS",e}();e.TableDelocaliseesProduit=P;var I=function(){function e(){}return e.TABLE_DELOC_LIBELLE_COMPLEMENTAIRE="OU4A",e.PROPRIETE_TABLE_DELOC_CTGXMF="CTGXMF",e.PROPRIETE_TABLE_DELOC_COGXEF="COGXEF",e.PROPRIETE_TABLE_DELOC_COGXAO="COGXAO",e.PROPRIETE_TABLE_DELOC_LBGXOP="LBGXOP",e.PROPRIETE_TABLE_DELOC_LBGXOA="LBGXOA",e}();e.TableDelocaliseesLibelleComplementaire=I;var M=function(){function e(){}return e.TABLE_DELOC_RESERVE_ENCAISSEMENT_GU4E="GU4E",e.PROPRIETE_TABLE_DELOC_CIGXRC="CIGXRC",e.PROPRIETE_TABLE_DELOC_QTGXRE="QTGXRE",e.PROPRIETE_TABLE_DELOC_QTGXR7="QTGXR7",e.PROPRIETE_TABLE_DELOC_CODIPR="CODIPR",e.PROPRIETE_TABLE_DELOC_COHCBQ="COHCBQ",e.PROPRIETE_TABLE_DELOC_MSHCCH="MSHCCH",e.PROPRIETE_TABLE_DELOC_CDMBSR="CDMBSR",e.PROPRIETE_TABLE_DELOC_COMBNC="COMBNC",e.PROPRIETE_TABLE_DELOC_PEHCAM="PEHCAM",e.PROPRIETE_TABLE_DELOC_PEHCAO="PEHCAO",e}();e.TablesDelocaliseesReserveEncaissement=M;var D=function(){function e(){}return e.CODE_VALEUR_5_EUROS="5",e.CODE_VALEUR_10_EUROS="10",e.CODE_VALEUR_20_EUROS="20",e.CODE_VALEUR_50_EUROS="50",e.CODE_VALEUR_100_EUROS="100",e.CODE_VALEUR_200_EUROS="200",e.CODE_VALEUR_500_EUROS="500",e.CODE_VALEUR_MONNAIE="MONNAIE",e.TYPE_OPERATION_BILLETTERIE_DEPOT="D",e.TYPE_OPERATION_BILLETTERIE_RETRAIT="R",e.LIBELLE_MONTANT_DEPOSE="Montant déposé :",e.LIBELLE_MONTANT_RETIRE="Montant retiré :",e}();e.Billetterie=D;var b=function(){function e(){}return e.TEXTE_REMBOURSEMENT="Remboursement",e.TEXTE_CODE_REMBOURSEMENT_R="R",e.TEXTE_CODE_VERSEMENT_V="V",e.TEXTE_VERSEMENT="Versement",e.TEXTE_QUATRE_ETOILES="****",e.TEXTE_DEUX_ETOILES="**",e.TEXTE_UNE_ETOILE="*",e.TEXTE_MODE_APPARITION_CL="CL",e.TEXTE_NOM_MODEL_REGROUPEMENT_OD="MyWay.Model.RegroupementOperationDiverse",e.TEXTE_NOM_MODEL_FAMILLE_OD="MyWay.Model.FamilleOperationDiverse",e.TEXTE_CODE_DECOUPAGE_OD_ZZ="ZZ",e.CODE_INTERDIT_OD_J17O5G01="J17O5G01",e.CODE_INTERDIT_OD_J17O3G01="J17O3G01",e.CODE_INTERDIT_OD_J17O4A01="J17O4A01",e.TEXTE_OUI_O="O",e.CODE_RATTACHEMENT_GUICHET_COMPTABLE_AGENCE_OD_003="003",e}();e.OperationDiverse=b;var N=function(){function e(){}return e.TEXTE_CODE_R="R",e}();e.ReserveEncaissementCheque=N;var y=function(){function e(){}return e.VERSION_1_0_OBJET="1.0",e}();e.ChoixUtilisateurOpeFi=y;var L=function(){function e(){}return e.TEXTE_PREFIXE_NUMERO_CARTE_TMF="92500029334",e.TEXTE_CODE_TITULAIRE_T="T",e.TEXTE_CODE_COTITULAIRE_C="C",e.TEXTE_CODE_MANDATAIRE="M",e.TEXTE_CODE_REPRESENTANT="R",e.TEXTE_CODE_AUTRE_A="A",e.TEXTE_ENTETE_INITIALISER_CARTE_TMF="Initialiser la carte Tempo Multi-Fonctions",e.TEXTE_ENTETE_FORCER_OPERATION_RETRAIT="Forcer l'opération de retrait",e.TEXTE_ENTETE_CONFIRMER_OPERATION_RETRAIT="Confirmer l'opération de retrait",e.TEXTE_ENTETE_CHOIX_BILLETTERIE_TMF="Retrait carte Tempo Multi Fonctions: Choix de la billetteries",e.TEXTE_TEMPLATE_MESSAGE_FORCER_SAISIE="<%= message %><br/>Voulez-vous forcer le retrait sur ce compte ?",e.TEXTE_TEMPLATE_MESSAGE_CONFIRMER_SAISIE="<%= message %><br/>Confirmez-vous votre saisie ?",e.TEXTE_TEMPLATE_MESSAGE_GAB_DISTRIBUTION_IMPOSSIBLE="GAB <%= numero %> : distribution impossible sur cet automate.",e.TEXTE_TEMPLATE_MESSAGE_GAB_STATUT="GAB <%= numero %> : dernier état du GAB remonté au central : <%= statut %>.",e.TEXTE_TEMPLATE_MESSAGE_GAB_NON_RESPECT_RISQUE="GAB <%= numero %> : non respect de la billetterie, risque de distribution multiple.",e.TEXTE_TEMPLATE_MESSAGE_GAB_NON_RESPECT="GAB <%= numero %> : non respect de la billetterie.",e.TEXTE_TEMPLATE_MESSAGE_GAB_RISQUE="GAB <%= numero %> : risque de distribution multiple.",e.TEXTE_STATUT_HORS_SERVICE="Hors service",e.TEXTE_STATUT_INCONNU="Inconnu",e.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_OPERATION="Le montant saisi dépasse le seuil d'alerte fixé par opération.",e.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_PERIODE="Le cumul des montants retraits dépasse le seuil d'alerte sur la période de temps paramétrée.",e.TEXTE_MESSAGE_DEPASSEMENT_SEUIL_QUOTIDIEN="Le cumul des montants retraits dépasse le seuil d'alerte quotidien.",e.TEXTE_MESSAGE_FORCAGE_MONTANT_MAXIMUM_AGENCE="Souhaitez-vous forcer le montant maximum distribuable atteint pour l'agence ?",e.TEXTE_MESSAGE_ATTEINTE_MONTANT_MAXIMUM_AGENCE="Le montant maximum distribuable pour l'agence est atteint.",e.TEXTE_MESSAGE_MONTANT_NON_DISTRIBUABLE_GAB="Aucun GAB ne peut distribuer ce montant.",e.TEXTE_MESSAGE_VENTILATION_NON_VALIDE="La ventilation renseignée dans la billetterie n'est pas valide.",e.TEXTE_BOUTON_FORCER="Forcer",e.TEXTE_BOUTON_CONFIRMER="Confirmer",
e.TEXTE_BOUTON_ANNULER="Annuler",e.SEUIL_DISTRIBUTION_MULTIPLE=40,e}();e.CarteTMF=L;var B=function(){function e(){}return e.CODE_ROLE_SIGNATAIRE_01="01",e.CODE_ROLE_SIGNATAIRE_02="02",e.CODE_ROLE_SIGNATAIRE_03="03",e.CODE_ROLE_SIGNATAIRE_04="04",e.CODE_ROLE_SIGNATAIRE_05="05",e.CODE_ROLE_SIGNATAIRE_06="06",e.CODE_ROLE_SIGNATAIRE_07="07",e.CODE_ROLE_SIGNATAIRE_AUTRES_99="99",e}();e.CodeRoleSignataire=B}(i=e.Constantes||(e.Constantes={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(){}return e.filter=function(){return function(e){var i,n=(+e.TXERVA/1e4).toFixed(2);return e&&"O"===e.COJCSC&&e.TXERVA&&""!==e.TXERVA&&(i=" ( "+n+" % ) "),i}},e}();e.module.filter("odAfficherTaux",n.filter)}(i=e.Filtres||(e.Filtres={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function e(){}return e.filter=function(){return function(e){var i;return e&&(i=e.codeEtablissement+" "+e.codeGuichet.value+" "+e.codeActiviteCompte+e.radical+e.cleCompte+" "+e.cleRice),i}},e}();e.module.filter("compteAffichePourCloture",n.filter)}(i=e.Filtres||(e.Filtres={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i,n){var t=this;this.$scope=e,this.serviceAgentExtended=i,this.facturationAutomatiqueService=n,this.afficherComposantMontant=!1,e.$on("montant_changed_tarification_facturation_automatique",function(e,i){null!=i&&(t.compte&&(t.facturationPrestation.montant.devise=t.compte.devise,t.facturationPrestation.montant.codeDevise=t.compte.devise.code,t.afficherComposantMontant=!0),t.facturationAutomatiqueService.getMontantFacturationAutomatique(t.facturationPrestation,t.compte,i,t.identifiantPersonne).then(function(e){e&&(t.facturationPrestation.montant=e,t.facturationPrestation.estFacturationPrestation=!0)}))})}return e.$inject=["$scope","serviceAgentExtended","facturationAutomatiqueService"],e}();e.FacturationAutomatiqueController=i,e.module.controller("facturationAutomatiqueController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/facturation-automatique/facturation-automatique-view.html",scope:{facturationPrestation:"=",compte:"=",identifiantPersonne:"="},controller:"facturationAutomatiqueController",controllerAs:"ctrl",bindToController:!0}}e.mwsfFacturationAutomatique=i,e.module.directive("mwsfFacturationAutomatique",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i){this.serviceAgentExtended=e,this.tarificationTarificationPrestationService=i}return e.prototype.getMontantFacturationAutomatique=function(e,i,n,t){var r="",o="",a="",s="";return i&&i.rice&&(r=i.rice.codeEtablissement),i&&i.devise&&(s=i.devise.code),i&&i.rice&&(o=i.rice.codeGuichet.value),i&&i.rice?(a=i.rice.codeActiviteCompte+i.rice.radical+i.rice.cleCompte,this.tarificationTarificationPrestationService.getTarificationPrestation(r,parseInt(e.codePrestation),n,s,null,t,o,a,"O").then(function(i){return e.montant.montant=i.montantATarifer,e.libellePrestation=i&&i.libelleReleveCompte1?i.libelleReleveCompte1:"",e.montant})):void 0},e.prototype.getCodePrestationEnFonctionRice=function(e){var i;if(e&&e.codeActiviteCompte)switch(e.codeActiviteCompte){case"00":i="0250";break;case"04":i="0252";break;case"08":i="0256";break;default:i="0254"}return i},e.$inject=["serviceAgentExtended","tarificationTarificationPrestationService"],e}();e.FacturationAutomatiqueService=i,e.module.service("facturationAutomatiqueService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i,n){var t=this;this.$scope=e,this.serviceAgentExtended=i,this.informationClientService=n,this.listeParticipants=[],this.participant=new MyWay.Model.ParticipantInformationClient("","","","","",""),this.listeParticipants.push(this.participant),this.tableauListeParticipants=this.initTableauClient(this.listeParticipants),null===this.participantSelectionne||0===this.participantSelectionne.length?this.serviceAgentExtended.getAuthentificationInfo().then(function(i){t.informationClientService.recupererInformationsParticipants(i.codeEtablissement,t.comptePrincipal,t.numeroPersonne).then(function(i){t.listeParticipants.splice(0),t.participantSelectionne.splice(0),t.participantSelectionne.push(i[0]),t.tableauListeParticipants=t.initTableauClient(i),e.$emit("participant_selectionne",i)})}):e.$emit("participant_selectionne",this.participantSelectionne)}return e.prototype.initTableauClient=function(i){var n={filterEnable:!1,width:e.CLASS_BOOTSTRAP_TAILLE_TABLEAU,orderBy:null,perPage:5,reserve:!1,data:i,columns:[{title:e.TEXTE_ROLE,bind:e.TEXTE_CODE_ROLE,cssClass:e.CLASS_BOOTSTRAP_COLONNE_TABLEAU},{title:e.TEXTE_PARTICIPANT,bind:e.TEXTE_CODE_NOM_PRENOM_PARTICIPANT,cssClass:e.CLASS_BOOTSTRAP_COLONNE_TABLEAU},{title:e.TEXTE_DATE_NAISSANCE,bind:e.TEXTE_CODE_DATE_NAISSANCE,cssClass:e.CLASS_BOOTSTRAP_COLONNE_TABLEAU}],selectedItems:this.participantSelectionne,templateUrl:"",sortEnable:!1,moreEnable:!0,selectionChangeHandler:this,multiSelect:!1};return n},e.prototype.onSelectionChange=function(e){var i=[];i.push(e),this.$scope.$emit("participant_selectionne",i)},e.$inject=["$scope","serviceAgentExtended","informationClientService"],e.TEXTE_ROLE="Rôle",e.TEXTE_CODE_ROLE="codeRole",e.TEXTE_PARTICIPANT="Participants",e.TEXTE_CODE_NOM_PRENOM_PARTICIPANT="nomPrenomParticipant",e.TEXTE_DATE_NAISSANCE="Date de naissance",e.TEXTE_CODE_DATE_NAISSANCE="dateNaissance",e.CLASS_BOOTSTRAP_COLONNE_TABLEAU="col-md-4 col-lg-4 col-sm-4",e.CLASS_BOOTSTRAP_TAILLE_TABLEAU="col-md-12 col-lg-12 col-sm-12",e}();e.InformationClientController=i,e.module.controller("InformationClientController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/information-client/information-client-view.html",scope:{comptePrincipal:"=",numeroPersonne:"=",participantSelectionne:"="},controller:"InformationClientController",controllerAs:"viewModelInformationClientController",bindToController:!0,link:function(e,i,n){}}}e.mwsfInformationClient=i,e.module.directive("mwsfInformationClient",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i,n){this.$q=e,this.serviceAgentExtended=i,this.compteService=n}return e.prototype.recupererInformationsParticipants=function(i,n,t){var r=this,o="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083",a=o+"/"+e.MINI_PROFIL_VERSION+"miniProfil?codeEtablissement="+i;a+="&typeRecherche=R",a+="&typeRestitution=U",a+="&codeGuichetInterbancaire="+n.rice.codeGuichet.value,a+="&codeProduitService=00"+n.rice.codeActiviteCompte,a+="&referenceProduitService="+n.rice.codeActiviteCompte+n.rice.radical+n.rice.cleCompte;var s=[];return this.serviceAgentExtended.sendRequest({url:a,withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){for(var n=e[0].identificationProduit,o=e[0].donneeCommuneProduit,a=n.length,c=0;a>c;++c){var l=o[c].participantProduit,p=l[0].dateNaissance,m=p.substr(0,4),u=p.substr(5,2),d=p.substr(8,2),E=d+"/"+u+"/"+m,h=new MyWay.Model.ParticipantInformationClient(l[0].codeRolePersonne,l[0].identifiantTiers,E,l[0].nomUsage,l[0].prenom,l[0].codeRolePersonne);s.push(h)}return r.recupererListeParticipantsAvecLibelleRole(i,s).then(function(e){return r.recupererTiersLies(i,t).then(function(e){return s=s.concat(e)})})})},e.prototype.recupererListeParticipantsAvecLibelleRole=function(e,i){var n=this,t=[];return angular.forEach(i,function(i){var r=[{propriete:"Key",valeur:i.codeRole,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];t.push(n.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(e,"CODARM",r).then(function(e){return null!=e?e[0].Value:""}))}),this.$q.all(t).then(function(e){for(var n=0;n<e.length;++n)i[n].codeRole=e[n];return i})},e.prototype.recupererTiersLies=function(i,n){var t=this,r="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083",o=r+"/"+e.TIERS_VERSION+"corporateTiersLies?codeEtablissement="+i;return o+="&identifiantTiers="+n,this.serviceAgentExtended.sendRequest({url:o,withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){var i=e.listeLien;return t.filtrerTiersLiesParFamilleEtParSens(i,"RPP",2)})},e.prototype.filtrerTiersLiesParFamilleEtParSens=function(e,i,n){var t=[];return angular.forEach(e,function(e){if(e.codeFamille===i&&e.codeSens===n){var r=new MyWay.Model.ParticipantInformationClient(e.libelleType,e.identifiantTiersEnRelation,null,null,null,e.codePersonnaliteJuridique,e.designationCourte);t.push(r)}}),t},e.MINI_PROFIL_VERSION="syntheseservice-v1/",e.TIERS_VERSION="tiers-v2/",e.$inject=["$q","serviceAgentExtended","compteService"],e}();e.InformationClientService=i,e.module.service("informationClientService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(n,t,r){var o=this;this.$scope=n,this.operationFinanciereService=t,this.serviceAgentExtended=r,this.afficherLibelleCourt=!1,this.estModificationManuelle=!1,this.ouvrirCalendrier=!1,this.estLibelleVide=!1,this.libelleOperation&&""!==this.libelleOperation.libelleLong&&this.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&(this.estDesactive=!0),this.estLibelleOperationDesactive||(this.estLibelleOperationDesactive=!1),this.messageErreurSaisieLibelle=i.TEXTE_MESSAGE_ERREUR_SAISIE_LIBELLE_VIDE,n.$on("numero_reference_sac_changed",function(e,n,t,r){(r===i.MODE_FINANCIER_ESPECES_INFORMATIONS_COMPLEMENTAIRES||r===i.MODE_FINANCIER_ESPECES_DIVERS_INFORMATIONS_COMPLEMENTAIRES)&&(angular.isDefined(n)?isNaN(parseInt(n))&&r===i.MODE_FINANCIER_ESPECES_INFORMATIONS_COMPLEMENTAIRES?(o.libelleOperation.libelleLong=n,o.estDesactive=!1,o.estLibelleVide=!1,o.envoiEvenementLibelleVide()):(o.libelleOperation.libelleLong=i.TEXTE_DEPOT_ESP_NUMERO+n,o.estDesactive=!0,o.estLibelleVide=!1,o.envoiEvenementLibelleVide()):o.estDesactive=!1)}),n.$on("coche_reference_sac_changed",function(e,n,t,r){t!==i.MODE_FINANCIER_ESPECES_INFORMATIONS_COMPLEMENTAIRES||n||(o.estDesactive=!1)}),n.$on("mode_financier_changed",function(e,n){o.estDesactive===!1||n===i.MODE_FINANCIER_ESPECES_INFORMATIONS_COMPLEMENTAIRES&&n===i.MODE_FINANCIER_ESPECES_DIVERS_INFORMATIONS_COMPLEMENTAIRES||(o.estDesactive=!1),n===i.MODE_FINANCIER_ESPECES_DIVERS_INFORMATIONS_COMPLEMENTAIRES&&(o.estDesactive=!0,o.libelleOperation.libelleLong=i.TEXTE_DEPOT_ESP_NUMERO)}),n.$watch(function(){return o.libelleOperation},function(e,i){o.validationLibelleVide()})}return i.prototype.modificationManuelle=function(){this.estModificationManuelle=!0,this.validationLibelleVide()},i.prototype.envoiEvenementLibelleVide=function(){this.$scope.$emit("informations_complementaires_libelle_vide",this.estLibelleVide)},i.prototype.validationLibelleVide=function(){this.libelleOperation&&(this.libelleOperation.libelleLong&&""!==this.libelleOperation.libelleLong?(this.estLibelleVide=!1,this.envoiEvenementLibelleVide()):(this.estLibelleVide=!0,this.envoiEvenementLibelleVide()))},i.$inject=["$scope","operationFinanciereService","serviceAgentExtended"],i.MODE_FINANCIER_ESPECES_INFORMATIONS_COMPLEMENTAIRES="01",i.MODE_FINANCIER_ESPECES_DIVERS_INFORMATIONS_COMPLEMENTAIRES="07",i.TEXTE_DEPOT_ESP_NUMERO="DEPOT ESP N° ",i.TEXTE_MESSAGE_ERREUR_SAISIE_LIBELLE_VIDE="Veuillez saisir un libellé d'opération",i}();e.InformationsComplementairesController=i,e.module.controller("InformationsComplementairesController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/informations-complementaires/informations-complementaires-view.html",scope:{libelleOperation:"=",referenceEnveloppe:"=",dateValeur:"=",estModificationManuelle:"=",texteAnniversaire:"=?",masquerDateValeur:"=?",estLibelleOperationDesactive:"=?",modeFinancier:"=?"},controller:"InformationsComplementairesController",controllerAs:"viewModelInformationsComplementairesCtrl",bindToController:!0,link:function(e,i,n){}}}e.mwsfInformationsComplementaires=i,e.module.directive("mwsfInformationsComplementaires",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e){this.serviceAgent=e}return e.prototype.getDocument=function(e,i){var n={};return null!=e&&(n.codeApplication=e),null!=i&&(n.idDocument=i),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/document/v1/contenu",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:n})},e.$inject=["serviceAgent"],e}();e.DocumentContenuService=i,e.module.service("documentContenuService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,i,n,t,r){this.serviceAgent=e,this.postOperationFinanciereService=i,this.documentContenuService=n,this.$q=t,this.serviceTrace=r}return n.prototype.postBordereauRest=function(e){return console.log("[Post Bordereau dans le JAB]-- Objet REST"),console.log(e),this.serviceTrace.info("postBordereauRest : [Post Bordereau dans le JAB]-- Objet REST",e),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/journalactivitebancaire/v1/bordereau",withHeaders:!0,method:MyWay.Services.MethodEnum.POST,data:e})},n.prototype.postBordereauOperationDansJournalActiviteBancaire=function(n,t,r,o,a,s,c){var l=this;console.log("[Post Bordereau dans le JAB]-- Début du traitement");var p=new e.comOpesFinancieres.Model.JAB.Bordereau,m=new e.comOpesFinancieres.Model.JAB.BordereauJAB,u=a?a:"",d=s?s:"";return m.typeSignatureBordereau=c?i.Constantes.BordereauJab.CODE_SAG:i.Constantes.BordereauJab.CODE_PAP,m.referencePieceJustificative=n.referenceIdentite?n.referenceIdentite:"",m.identifiantBordereauJab=r?r:"",m.codeEmetteurGed=u,m.codeNatureDocumentGed=o&&o.codeTypeNatrDoc?o.codeTypeNatrDoc:"",m.identifiantDossierNumerise=parseInt(d),t&&(m.nomTitulaireCompte=t.designationCourte?t.designationCourte:"",m.identifiantClientOperation=t.numeroPersonne?parseInt(_.padLeft(t.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)):null,m.ligne2AdresseTitulaire=t.ligne2AdresseAFNOR?t.ligne2AdresseAFNOR:"",m.ligne3AdresseTitulaire=t.ligne3AdresseAFNOR?t.ligne3AdresseAFNOR:"",m.ligne4AdresseTitulaire=t.ligne4AdresseAFNOR?t.ligne4AdresseAFNOR:"",m.ligne5AdresseTitulaire=t.ligne5AdresseAFNOR?t.ligne5AdresseAFNOR:"",m.ligne6AdresseTitulaire=t.ligne6AdresseAFNOR?t.ligne6AdresseAFNOR:""),n.participant&&(m.nomSignataire=n.participant.nomParticipant?n.participant.nomParticipant:"",m.prenomSignataire=n.participant.prenomParticipant?n.participant.prenomParticipant:"",m.roleSignataire=n.participant.codeRole?n.participant.codeRole:"",m.identifiantSignataire=n.participant.identifiantParticipant?parseInt(_.padLeft(n.participant.identifiantParticipant,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)):null),p.bordereauJAB=m,p.billetterieJAB=this.gestionBilletterieBordereauJab(n),this.recuperationInformationsDocument(u,d).then(function(e){return e&&(m.identifiantFileNet=e.details&&e.details.idDocument?e.details.idDocument:""),l.postBordereauRest(p)}).then(function(e){return l.serviceTrace.info("postBordereauOperationDansJournalActiviteBancaire : [Post Bordereau dans le JAB] --- Traitement OK",e),e})["catch"](function(e){return l.serviceTrace.error("postBordereauOperationDansJournalActiviteBancaire : [Post Bordereau dans le JAB] --- Erreur",e),l.$q.when(null)})},n.prototype.recuperationInformationsDocument=function(e,i){var n=this;return e&&i?this.documentContenuService.getDocument(e,i).then(function(e){return e?e:n.$q.when(null)})["catch"](function(e){return n.serviceTrace.error("recuperationInformationsDocument : Erreur",e),n.$q.when(null)}):this.$q.when(null)},n.prototype.gestionBilletterieBordereauJab=function(e){var n=[];if(null!=e.billetterieDepot&&this.postOperationFinanciereService.determinerSaisieBilletterie(e.billetterieDepot)){var t=[];t=this.creationValeurTableauBilletterieJab(i.Constantes.Billetterie.TYPE_OPERATION_BILLETTERIE_DEPOT,e.billetterieDepot),Array.prototype.push.apply(n,t)}if(null!=e.billetterieRetrait&&this.postOperationFinanciereService.determinerSaisieBilletterie(e.billetterieRetrait)){var r=[];r=this.creationValeurTableauBilletterieJab(i.Constantes.Billetterie.TYPE_OPERATION_BILLETTERIE_RETRAIT,e.billetterieRetrait),Array.prototype.push.apply(n,r)}return n},n.prototype.creationValeurTableauBilletterieJab=function(n,t){var r=[],o=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;o=this.creationObjetBilletterieJab(i.Constantes.Billetterie.CODE_VALEUR_5_EUROS,n,t.nombreCoupure.b5,null,i.Constantes.ChiffreNumber.CHIFFRE_CINQ_NUMBER),r.push(o);var a=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;a=this.creationObjetBilletterieJab(i.Constantes.Billetterie.CODE_VALEUR_10_EUROS,n,t.nombreCoupure.b10,null,i.Constantes.ChiffreNumber.CHIFFRE_DIX_NUMBER),r.push(a);var s=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;s=this.creationObjetBilletterieJab(i.Constantes.Billetterie.CODE_VALEUR_20_EUROS,n,t.nombreCoupure.b20,null,i.Constantes.ChiffreNumber.CHIFFRE_VINGT_NUMBER),r.push(s);var c=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;c=this.creationObjetBilletterieJab(i.Constantes.Billetterie.CODE_VALEUR_50_EUROS,n,t.nombreCoupure.b50,null,i.Constantes.ChiffreNumber.CHIFFRE_CINQUANTE_NUMBER),r.push(c);var l=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;l=this.creationObjetBilletterieJab(i.Constantes.Billetterie.CODE_VALEUR_100_EUROS,n,t.nombreCoupure.b100,null,i.Constantes.ChiffreNumber.CHIFFRE_CENT_NUMBER),r.push(l);var p=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;p=this.creationObjetBilletterieJab(i.Constantes.Billetterie.CODE_VALEUR_200_EUROS,n,t.nombreCoupure.b200,null,i.Constantes.ChiffreNumber.CHIFFRE_DEUX_CENT_NUMBER),r.push(p);var m=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;m=this.creationObjetBilletterieJab(i.Constantes.Billetterie.CODE_VALEUR_500_EUROS,n,t.nombreCoupure.b500,null,i.Constantes.ChiffreNumber.CHIFFRE_CINQ_CENT_NUMBER),r.push(m);var u=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;return u=this.creationObjetBilletterieJab(i.Constantes.Billetterie.CODE_VALEUR_MONNAIE,n,null,t.monnaieSansBillet),r.push(u),r},n.prototype.creationObjetBilletterieJab=function(n,t,r,o,a){var s=new e.comOpesFinancieres.Model.JAB.BilletterieJAB;return s.codeValeurFaciale=n?n:"",s.typeOperationBilletterie=t?t:"",s.nombreBillet=null===r?0:r,s.montantMonnaie=null===o?0:o,s.montantBilletterie=null!==r?a*s.nombreBillet:0,s.codeDevise=i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO,s},n.$inject=["serviceAgent","postOperationFinanciere","documentContenuService","$q","serviceTrace"],n}();i.JournalActiviteBancaireBordereauService=n,i.module.service("journalActiviteBancaireBordereauService",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,i,n,t,r,o){this.$q=e,this.serviceAgentExtended=i,this.modalService=n,this.operationFinanciereService=t,this.saisieRiceService=r,this.serviceTrace=o}return n.prototype.stringDefi=function(e){return null==e?"":angular.isUndefined(e)?"":String(e)},n.prototype.getAJabber=function(){return this.serviceAgentExtended.getFromContext(i.Constantes.JournalApplicatif.CONTEXTE_MAJ_JAB).then(function(e){return e=null===e?!1:!0})},n.prototype.getNumPlan=function(){return this.serviceAgentExtended.getFromContext(i.Constantes.JournalApplicatif.CONTEXTE_NUM_PLAN).then(function(e){return null===e&&(e=i.Constantes.ChiffreString.CHIFFRE_UN_STRING),e})},n.prototype.alimentationBufferJab=function(e,n,t,r){var o="",a=e.contexteSaisieOperationFinanciere.dateOperationJourneeComptable.substr(4,4)+e.contexteSaisieOperationFinanciere.dateOperationJourneeComptable.substr(2,2)+e.contexteSaisieOperationFinanciere.dateOperationJourneeComptable.substr(0,2);o+=_.padRight(String(""),2," "),o+=_.padRight(String(""),8," "),o+=_.padRight(String(""),6," "),o+=_.padRight(String(""),6," "),o+=_.padRight(this.stringDefi(t.substr(0,8)),8," "),o+=_.padRight(String(""),1," "),o+=_.padRight(String(""),10," "),o+=_.padRight(String(""),28," "),o+=_.padRight(String("0"),1," "),o+=_.padRight(String("1"),1," "),o+=_.padRight(String(""),1," "),o+=_.padRight(this.stringDefi(e.contexteSaisieOperationFinanciere.codeEtablissement),5," "),o+=_.padRight(this.stringDefi(e.contexteSaisieOperationFinanciere.edsExterneGuichetComptable),7," "),o+=_.padRight(this.stringDefi(e.contexteSaisieOperationFinanciere.edsExterneRattachementGuichetComptable),7," "),o+=_.padRight(this.stringDefi(e.contexteSaisieOperationFinanciere.referenceExterneAgent),7," "),o+=n?_.padRight(String(i.Constantes.JournalApplicatif.CODE_TRANSACTION_MYWA),4," "):_.padRight(String(""),4," ");var s;s=!r&&e.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&e.segmentPrvRio&&e.segmentPrvRio.S_PRVRIOUGR&&e.segmentPrvRio.S_PRVRIOUGR.length>1&&""!==e.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte?-1*e.segmentPrvRio.S_PRVRIOUGR[0].montantVirement:e.montant,o+=_.padRight(String(""),1," "),o+=s>=0?"P":"M",o+=_.padLeft(this.stringDefi(Math.round(100*Math.abs(s))),15,"0"),o+=_.padRight(this.stringDefi(e.segmentPrvRio.codeDeviseMontantOperation),3," "),o+=_.padRight(this.stringDefi(e.modeFinancier.CTGXMF),3," ");var c=e.compte.rice.formatRicePourStructureEchange();return c.length>23&&(c=c.substr(0,23)),o+=_.padRight(this.stringDefi(c),23," "),o+=_.padRight(this.stringDefi(a),8," "),o+=_.padRight(t.substr(9,5),5," "),o+=_.padRight(this.stringDefi(e.client.numeroPersonne),9," "),o+=_.padRight(String(""),25," "),o+=_.padRight(String(""),25," "),o+=_.padRight(String(""),25," "),o+=_.padRight(String(""),25," "),o+=_.padRight(String(""),25," "),o+=_.padRight(String(""),8," "),o+=_.padRight(String(""),8," "),o+=_.padRight(String(""),28," "),o+=_.padRight(String(""),1," "),o+=_.padRight(this.stringDefi(e.libelleOperation.libelleLong),40," "),o+=_.padRight(String(""),1," "),o+=_.padRight(String(""),1," "),o+=_.padRight(String(""),1," "),o+=_.padRight(String(""),8," "),o+=_.padRight(String(""),7," "),this.serviceTrace.info("alimentationBufferJab : [Alimentation JAB] --- Buffer JAB -- -",o),o},n.prototype.alimenterPTUsansJAB=function(n,t){var r=this;this.serviceAgentExtended.Trace.info("[Alimentation PTU sans JAB] -- Eligible Sag ? "+t);var o,a,s=n.contexteSaisieOperationFinanciere.identifiantBordereau;return this.getAJabber().then(function(c){return o=c,a=r.alimentationBufferJab(n,o,s),r.alimenterJabBordereauPTU(n,t).then(function(a){var c=r.$q.when();if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&n.facturationPrestation)return r.alimenterJabFacturation(n,o,s,t,!0);if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""===n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte&&n.facturationPrestation)return r.alimenterJabFacturation(n,o,s,t,!1);if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.segmentPrvRio&&n.segmentPrvRio.S_PRVRIOUGR&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""!==n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte&&3===n.segmentPrvRio.S_PRVRIOUGR.length)for(var l=1;l<n.segmentPrvRio.S_PRVRIOUGR.length;l++)if(""!==n.segmentPrvRio.S_PRVRIOUGR[l].numeroCompte){var p=new e.comOpesFinancieres.Model.OperationFinanciere;angular.copy(n,p),p.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A?(p.montant=n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement,p.segmentPrvRio.montantGlobalOperation=n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement):(p.montant=-1*n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement,p.segmentPrvRio.montantGlobalOperation=-1*n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement),p.libelleOperation.libelleLong=n.segmentPrvRio.S_PRVRIOUGR[l].libelleVirement,p.compte.rice=r.transformeEnRice(p.segmentPrvRio.S_PRVRIOUGR[l].numeroCompte),p.compte.solde=0,1===l?n.repartition&&n.repartition.compteCredite2&&(n.repartition.compteCredite2.codeDeviseContrat!==i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite2.valeurProduitDevise?p.compte.solde=n.repartition.compteCredite2.valeurProduitDevise:n.repartition.compteCredite2.codeDeviseContrat===i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite2.valeurProduit&&(p.compte.solde=n.repartition.compteCredite2.valeurProduit)):2===l&&n.repartition&&n.repartition.compteCredite3&&(n.repartition.compteCredite3.codeDeviseContrat!==i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite3.valeurProduitDevise?p.compte.solde=n.repartition.compteCredite3.valeurProduitDevise:n.repartition.compteCredite3.codeDeviseContrat===i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite3.valeurProduit&&(p.compte.solde=n.repartition.compteCredite3.valeurProduit));var m=r.alimentationBufferJab(p,o,s,!0);c=c.then(r.traitementAlimenterJabBordereauEtEnregistrer.bind(r,m,p,t,!0))}if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte){var u=new e.comOpesFinancieres.Model.OperationFinanciere;angular.copy(n,u),(n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE||n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.VERSEMENT_SIMPLE)&&(u.segmentPrvRio.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE),(n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE||n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE)&&(u.segmentPrvRio.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.VERSEMENT_SIMPLE);var d=u&&u.codeOperation&&u.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A?u.codeOperation:i.Constantes.OperationFinanciere.CODE_OPERATION_N;return r.operationFinanciereService.getLibelleOperationFinanciere(u.contexteSaisieOperationFinanciere.codeEtablissement,d,u.segmentPrvRio).then(function(e){u.montant=-u.montant,u.segmentPrvRio.montantGlobalOperation=-u.segmentPrvRio.montantGlobalOperation,u.libelleOperation.libelleLong=e.libelleLong.toUpperCase(),u.libelleOperation.libelleCourt=e.libelleCourt.toUpperCase(),u.segmentPrvRio.libelleOperation1=u.segmentPrvRio.libelleOperation1.toUpperCase(),u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.length>=21&&(u.compte.rice.codeEtablissement=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(0,5),u.compte.rice.codeGuichet=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(5,5),u.compte.rice.codeActiviteCompte=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(10,2),u.compte.rice.radical=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(12,7),u.compte.rice.cleCompte=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(19,2),u.compte.rice.cleRice=r.saisieRiceService.riceKeyCalculator(u.compte.rice)),u.compte.solde=u.soldeCompteAvantVirement,n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE&&(u.compte.solde=u.soldeCompteAvantVirement,u.montant=u.montant<0?-1*u.montant:u.montant,u.segmentPrvRio.montantGlobalOperation=u.segmentPrvRio.montantGlobalOperation<0?-1*u.segmentPrvRio.montantGlobalOperation:u.segmentPrvRio.montantGlobalOperation);var i=r.alimentationBufferJab(u,o,s);return r.traitementAlimenterJabBordereauEtEnregistrer(i,u,t)})}return r.serviceAgentExtended.Trace.info("[Alimentation PTU sans JAB] --- Appel enregistrer JAB ---"),c.then(function(){r.alimenterJabFacturation(n,o,s,t,!1)})})["catch"](function(e){r.serviceAgentExtended.Trace.warning("[Alimentation PTU sans JAB] --- Echec alimenter bordereau PTU ---")})})["catch"](function(e){r.serviceAgentExtended.Trace.warning("[Alimentation PTU sans JAB] --- Echec getAJabber")})},n.prototype.alimenterPTU=function(n,t){var r=this;this.serviceAgentExtended.Trace.info("[Alimentation PTU] -- Eligible Sag ? "+t);var o,a,s=n.contexteSaisieOperationFinanciere.identifiantBordereau;return this.getAJabber().then(function(c){return o=c,a=r.alimentationBufferJab(n,o,s),r.alimenterJabBordereauPTU(n,t).then(function(c){return r.serviceAgentExtended.JAB.Enregistrer(a+c).then(function(a){var c=r.$q.when();if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&n.facturationPrestation)return r.alimenterJabFacturation(n,o,s,t,!0);if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""===n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte&&n.facturationPrestation)return r.alimenterJabFacturation(n,o,s,t,!1);if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.segmentPrvRio&&n.segmentPrvRio.S_PRVRIOUGR&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""!==n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte&&3===n.segmentPrvRio.S_PRVRIOUGR.length)for(var l=1;l<n.segmentPrvRio.S_PRVRIOUGR.length;l++)if(""!==n.segmentPrvRio.S_PRVRIOUGR[l].numeroCompte){var p=new e.comOpesFinancieres.Model.OperationFinanciere;angular.copy(n,p),p.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A?(p.montant=n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement,p.segmentPrvRio.montantGlobalOperation=n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement):(p.montant=-1*n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement,p.segmentPrvRio.montantGlobalOperation=-1*n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement),p.libelleOperation.libelleLong=n.segmentPrvRio.S_PRVRIOUGR[l].libelleVirement,p.compte.rice=r.transformeEnRice(p.segmentPrvRio.S_PRVRIOUGR[l].numeroCompte),p.compte.solde=0,1===l?n.repartition&&n.repartition.compteCredite2&&(n.repartition.compteCredite2.codeDeviseContrat!==i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite2.valeurProduitDevise?p.compte.solde=n.repartition.compteCredite2.valeurProduitDevise:n.repartition.compteCredite2.codeDeviseContrat===i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite2.valeurProduit&&(p.compte.solde=n.repartition.compteCredite2.valeurProduit)):2===l&&n.repartition&&n.repartition.compteCredite3&&(n.repartition.compteCredite3.codeDeviseContrat!==i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite3.valeurProduitDevise?p.compte.solde=n.repartition.compteCredite3.valeurProduitDevise:n.repartition.compteCredite3.codeDeviseContrat===i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite3.valeurProduit&&(p.compte.solde=n.repartition.compteCredite3.valeurProduit));var m=r.alimentationBufferJab(p,o,s,!0);c=c.then(r.traitementAlimenterJabBordereauEtEnregistrer.bind(r,m,p,t,!0))}if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte){var u=new e.comOpesFinancieres.Model.OperationFinanciere;angular.copy(n,u),(n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE||n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.VERSEMENT_SIMPLE)&&(u.segmentPrvRio.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE),(n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE||n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE)&&(u.segmentPrvRio.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.VERSEMENT_SIMPLE);var d=u&&u.codeOperation&&u.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A?u.codeOperation:i.Constantes.OperationFinanciere.CODE_OPERATION_N;return r.operationFinanciereService.getLibelleOperationFinanciere(u.contexteSaisieOperationFinanciere.codeEtablissement,d,u.segmentPrvRio).then(function(e){
u.montant=-u.montant,u.segmentPrvRio.montantGlobalOperation=-u.segmentPrvRio.montantGlobalOperation,u.libelleOperation.libelleLong=e.libelleLong.toUpperCase(),u.libelleOperation.libelleCourt=e.libelleCourt.toUpperCase(),u.segmentPrvRio.libelleOperation1=u.segmentPrvRio.libelleOperation1.toUpperCase(),u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.length>=21&&(u.compte.rice.codeEtablissement=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(0,5),u.compte.rice.codeGuichet=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(5,5),u.compte.rice.codeActiviteCompte=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(10,2),u.compte.rice.radical=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(12,7),u.compte.rice.cleCompte=u.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte.substr(19,2),u.compte.rice.cleRice=r.saisieRiceService.riceKeyCalculator(u.compte.rice)),u.compte.solde=u.soldeCompteAvantVirement,n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE&&(u.compte.solde=u.soldeCompteAvantVirement,u.montant=u.montant<0?-1*u.montant:u.montant,u.segmentPrvRio.montantGlobalOperation=u.segmentPrvRio.montantGlobalOperation<0?-1*u.segmentPrvRio.montantGlobalOperation:u.segmentPrvRio.montantGlobalOperation);var i=r.alimentationBufferJab(u,o,s);return r.traitementAlimenterJabBordereauEtEnregistrer(i,u,t)})}return r.serviceAgentExtended.Trace.info("[Alimentation PTU] --- Appel enregistrer JAB ---"),c.then(function(){r.alimenterJabFacturation(n,o,s,t,!1)})})["catch"](function(e){r.serviceAgentExtended.Trace.warning("[Alimentation PTU] --- Echec enregistrer JAB ---")})})["catch"](function(e){r.serviceAgentExtended.Trace.warning("[Alimentation PTU] --- Echec alimenter bordereau PTU ---")})})["catch"](function(e){r.serviceAgentExtended.Trace.warning("[Alimentation PTU] --- Echec getAJabber")})},n.prototype.traitementAlimenterJabBordereauEtEnregistrer=function(e,i,n,t){var r=this;return this.alimenterJabBordereauPTU(i,n,t).then(function(i){return r.serviceTrace.info("traitementAlimenterJabBordereauEtEnregistrer --->",i),r.serviceAgentExtended.JAB.Enregistrer(e+i).then(function(e){r.serviceTrace.info("traitementAlimenterJabBordereauEtEnregistrer : [Alimentation PTU] --- Appel enregistrer JAB Terminée --->",e)})["catch"](function(e){r.serviceTrace.error("[Alimentation PTU] --- Echec enregistrer JAB --->",e)})})["catch"](function(e){r.serviceTrace.error("[Alimentation PTU] --- Echec alimenter bordereau PTU --->",e)})},n.prototype.alimenterJabFacturation=function(n,t,r,o,a){var s=this.$q.when(null);if(n.facturationPrestation&&n.facturationPrestation.estFacturationPrestation){var c=new e.comOpesFinancieres.Model.OperationFinanciere;angular.copy(n,c),c.montant=n.facturationPrestation.montant&&n.facturationPrestation.montant.montant?-n.facturationPrestation.montant.montant:0,c.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&c.segmentPrvRio&&c.segmentPrvRio.S_PRVRIOUGR&&c.segmentPrvRio.S_PRVRIOUGR.length>0&&""!==c.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte?c.compte.solde=n.compte.solde-n.segmentPrvRio.S_PRVRIOUGR[0].montantVirement:c.compte.solde=n.compte.solde+n.segmentPrvRio.montantGlobalOperation,c.libelleOperation&&(c.libelleOperation.libelleLong=a?i.Constantes.Facturation.LIBELLE_FRAIS_DELIVRANCE_VRAC:i.Constantes.Facturation.LIBELLE_FRAIS_CHEQUE_BANQUE,c.libelleOperation.libelleCourt=""),c.modeFinancier&&(c.modeFinancier.LIJMMI=i.Constantes.ModeFinancierOperationDiverse.LIBELLE_MODE_FINANCIER_OD_LIJMMI,c.modeFinancier.CTGXMF=i.Constantes.ModeFinancierOperationDiverse.CODE_MODE_FINANCIER_OD_CTGXMF,c.modeFinancier.CTGXM1=i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES,c.modeFinancier.CIJMMC="N",c.modeFinancier.CIJMMS="O"),c.segmentPrvRio&&(c.segmentPrvRio.modeFinancierChoisi=i.Constantes.ModeFinancierOperationDiverse.CODE_MODE_FINANCIER_OD_CTGXMF,c.segmentPrvRio.modeFinancierNumerique=i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES,c.segmentPrvRio.montantGlobalOperation=-1*n.facturationPrestation.montant.montant,c.segmentPrvRio.libelleOperation1=a?i.Constantes.Facturation.LIBELLE_FRAIS_DELIVRANCE_VRAC:i.Constantes.Facturation.LIBELLE_FRAIS_CHEQUE_BANQUE,c.segmentPrvRio.numeroCheque="",c.segmentPrvRio.ordreCheque="",c.segmentPrvRio.chequeGlobal=""),c.segmentPrjo&&(c.segmentPrjo.montantOperation=n.facturationPrestation.montant.montant,c.segmentPrjo.codeDeviseOperation=n.segmentPrvRio.codeDeviseMontantOperation,c.segmentPrjo.libelle1SaisiOD=a?i.Constantes.Facturation.LIBELLE_FRAIS_DELIVRANCE_VRAC:i.Constantes.Facturation.LIBELLE_FRAIS_CHEQUE_BANQUE);var l=this.alimentationBufferJab(c,t,r);s=this.traitementAlimenterJabBordereauEtEnregistrer(l,c,o)}return s},n.prototype.transformeEnRice=function(e){var i=e.substr(0,5),n=e.substr(5,5),t=e.substr(10,2),r=e.substr(12,7),o=e.substr(19,2),a=new MyWay.Model.Rice(i,n,t,r,o),s=this.saisieRiceService.riceKeyCalculator(a);return a.cleRice=s,a},n.prototype.alimenterJabBordereauPTU=function(e,n,t){var r=this,o="",a=0;if(n===!1)return this.getNumPlan().then(function(n){o+=_.padRight(String(n),1," "),o+=_.padRight(r.stringDefi(e.signataire.nomParticipant&&e.signataire.nomParticipant.length>=25?e.signataire.nomParticipant.substr(0,25):e.signataire.nomParticipant),25," "),o+=_.padRight(r.stringDefi(e.signataire.prenomParticipant&&e.signataire.prenomParticipant.length>=20?e.signataire.prenomParticipant.substr(0,20):e.signataire.prenomParticipant),20," "),o+=_.padRight(r.stringDefi(e.segmentPrvRio.identiteParticipant),32," "),o+=e.signataire.codeRole===i.Constantes.BordereauOperation.CODE_ROLE_SIGNATAIRE_AUTRES?"  ":_.padRight(r.stringDefi(e.signataire.codeRole.length>=2?e.signataire.codeRole.substr(0,2):e.signataire.codeRole),2," "),o+=_.padRight(r.stringDefi(e.segmentPrvRio.numeroTelephoneParticipant),20," "),o+=_.padRight(r.stringDefi(e.signataire.identifiantParticipant),9," "),o+=_.padRight(r.stringDefi(e.modeFinancier.CTGXM1),2," "),o+=_.padRight(r.stringDefi(e.segmentPrvRio.codeDeviseMontantOperation),3," ");var s="";if(e.segmentPrvRio.dateDeValeur){var c="function"==typeof e.segmentPrvRio.dateDeValeur.toISOString?e.segmentPrvRio.dateDeValeur.toISOString():e.segmentPrvRio.dateDeValeur.toString();s=c.substr(8,2)+c.substr(5,2)+c.substr(0,4)}else s="";o+=_.padRight(s,8," ");var l="";""!==e.libelleOperation.libelleLong&&""===e.libelleOperation.libelleCourt?(l=r.stringDefi(e.libelleOperation.libelleLong).length>40?r.stringDefi(e.libelleOperation.libelleLong).substr(0,40):r.stringDefi(e.libelleOperation.libelleLong),o+=_.padRight(l,40," ")):(l=r.stringDefi(e.libelleOperation.libelleLong).length>24?r.stringDefi(e.libelleOperation.libelleLong).substr(0,24):r.stringDefi(e.libelleOperation.libelleLong),o+=_.padRight(l,24," "),l=r.stringDefi(e.libelleOperation.libelleCourt).length>16?r.stringDefi(e.libelleOperation.libelleCourt).substr(0,16):r.stringDefi(e.libelleOperation.libelleCourt),o+=_.padRight(l,16," "));var p="";if(e.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&e.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&e.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE)p=r.stringDefi(e.segmentPrvRio.libelleOperation2).length>70?r.stringDefi(e.segmentPrvRio.libelleOperation2).substr(0,70).replace(/[\x00-\x1F\x7F-\x9F]/g,""):r.stringDefi(e.segmentPrvRio.libelleOperation2.replace(/[\x00-\x1F\x7F-\x9F]/g,""));else if(e.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&e.facturationPrestation&&""!==e.facturationPrestation.codePrestation)p=r.stringDefi(e.segmentPrvRio.libelleOperation2).length>70?r.stringDefi(e.segmentPrvRio.libelleOperation2).substr(0,70).replace(/[\x00-\x1F\x7F-\x9F]/g,""):r.stringDefi(e.segmentPrvRio.libelleOperation2).replace(/[\x00-\x1F\x7F-\x9F]/g,"");else if(e.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE)p=r.stringDefi(e.segmentPrvRio.ordreCheque).length>70?r.stringDefi(e.segmentPrvRio.ordreCheque).substr(0,70):r.stringDefi(e.segmentPrvRio.ordreCheque);else{var m="OD/ "+e.segmentPrjo.codeReferenceOD+"/ "+e.segmentPrjo.libelleFamilleOD+" "+e.segmentPrjo.libelleTypeOD.replace(/[\x00-\x1F\x7F-\x9F]/g,"");p=r.stringDefi(m).length>70?r.stringDefi(m).substr(0,70):r.stringDefi(m)}e.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A&&e.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&e.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&e.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&(p=""),o+=_.padRight(p,70," "),e.facturationPrestation&&e.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A&&(e.segmentPrvRio.montantGlobalOperation*=-1),o+=e.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A?_.padRight(e.segmentPrvRio.montantGlobalOperation>=0?"M":"P",1," "):_.padRight(e.segmentPrvRio.montantGlobalOperation>=0?"P":"M",1," ");var u=r.stringDefi(Math.abs(e.segmentPrvRio.montantGlobalOperation)).toString(),d=e.segmentPrvRio.montantGlobalOperation;!t&&e.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&e.segmentPrvRio&&e.segmentPrvRio.S_PRVRIOUGR&&e.segmentPrvRio.S_PRVRIOUGR.length>1&&""!==e.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte&&(u=e.segmentPrvRio.S_PRVRIOUGR[0].montantVirement.toString(),d=e.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_N?-1*e.segmentPrvRio.S_PRVRIOUGR[0].montantVirement:e.segmentPrvRio.S_PRVRIOUGR[0].montantVirement),o+=_.padLeft(u,15,"0"),o+=_.padRight(r.stringDefi(e.segmentPrvRio.numeroCheque),7," "),o+=_.padRight(r.stringDefi(e.compte.rice.formatRicePourStructureEchange()).substr(0,23),23," "),o+=_.padRight(r.stringDefi(e.segmentPrvRio.codeDeviseMontantOperation),3," "),a=Math.round(100*(d+(angular.isDefined(e.compte.solde)?e.compte.solde:0)))/100,e&&e.signataire&&e.signataire.codeRole===i.Constantes.BordereauOperation.CODE_ROLE_SIGNATAIRE_AUTRES&&(a=0),e&&e.segmentPrvRio&&e.segmentPrvRio.codeEvenementAtome===i.Constantes.BordereauOperation.CODE_ATOME_CLOTURE&&(a=0),o+=null==e.compte.solde&&e.segmentPrvRio.codeEvenementAtome!==MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE||e&&e.signataire&&e.signataire.codeRole===i.Constantes.BordereauOperation.CODE_ROLE_SIGNATAIRE_AUTRES?_.padLeft(r.stringDefi(""),15," "):_.padLeft(r.stringDefi(a),15," ");var E=e.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_N?"N":"O";o+=E,o+=_.padRight(String(""),32," "),e.segmentPrvRio&&e.segmentPrvRio.codeRoleParticipant&&(o+=_.padRight(r.stringDefi(e.segmentPrvRio.codeRoleParticipant).substr(e.segmentPrvRio.codeRoleParticipant.length-1,1),1," ")),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.monnaieBilleterie.toString()),15,"0"),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.nombreCoupure.b500.toString()),15,"0"),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.nombreCoupure.b200.toString()),15,"0"),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.nombreCoupure.b100.toString()),15,"0"),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.nombreCoupure.b50.toString()),15,"0"),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.nombreCoupure.b20.toString()),15,"0"),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.nombreCoupure.b10.toString()),15,"0"),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.nombreCoupure.b5.toString()),15,"0"),o+=_.padLeft(r.stringDefi(e.segmentPrvRio.S_BILLETERIE.monnaieSansBillet.toString()),15,"0"),o+=_.padRight(r.stringDefi(e.libelleBeneficiaire),100," ");var h="";if(h=r.stringDefi(e.bicBeneficiaire).length>0&&r.stringDefi(e.ibanBeneficiaire).length>0?"IBAN : "+r.stringDefi(e.ibanBeneficiaire)+"          BIC : "+r.stringDefi(e.bicBeneficiaire):"",o+=_.padRight(h,100," "),e.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&e.plusieursCheques&&e.plusieursCheques.length>1){for(var f=25,v=0,C=e.plusieursCheques;v<C.length;v++){var O=C[v];if(O.montant){var R=r.stringDefi(Math.abs(O.montant)).toString();o+=_.padLeft(R,15,"0"),f-=1}}var g=15*f,T="";T=_.padRight(T,g,"0"),o+=T}return o+="$$$",r.serviceTrace.info("alimenterJabBordereauPTU : [Alimentation JAB Bordereau PTU] --- Buffer Bordereau : ",o),o})["catch"](function(e){r.serviceAgentExtended.Trace.warning("[Alimentation JAB Bordereau PTU] -- Echec lecture num plan ---"),o+=_.padRight(String(""),705," "),o+="$$$",r.serviceTrace.info("alimenterJabBordereauPTU : [Alimentation JAB Bordereau PTU] --- Buffer Bordereau : ",o);var i=r.$q.defer();return i.resolve(o),i.promise});o+=_.padRight(String(""),705," "),o+="$$$",this.serviceTrace.info("alimenterJabBordereauPTU : [Alimentation JAB Bordereau PTU] --- Buffer Bordereau : ",o);var s=this.$q.defer();return s.resolve(o),s.promise},n.$inject=["$q","serviceAgentExtended","modalService","operationFinanciereService","saisieRiceService","serviceTrace"],n}();i.JournalApplicatif=n,i.module.service("journalApplicatif",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e}();e.LigneBordereauOperation=i;var n=function(){function e(){this.montantBilletterieDepot=0,this.montantBilletterieRetrait=0}return e}();e.BordereauOperation=n}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e}();e.ChequeBanqueOperation=i;var n=function(){function e(){}return e}();e.ChequeBanque=n;var t=function(){function e(){this.titrePopup="",this.styleBoutonImprimer="",this.styleBoutonNePasImprimer=""}return e}();e.ParamPopupChequeBanque=t}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e}();e.ChoixUtilisateurOpeFi=i;var n=function(){function e(){}return e}();e.ModeFinancierEspecesEtEspecesDivers=n;var t=function(){function e(){}return e}();e.ModeFinancierCheque=t;var r=function(){function e(){}return e}();e.ModeFinancierVirInterne=r;var o=function(){function e(){}return e}();e.ModeFinancierOperationDiverse=o;var a=function(){function e(){}return e}();e.ModeFinanciereChequeBanque=a}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e}();e.ContexteSaisieOperationFinanciere=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var __extends=this&&this.__extends||function(e,i){function n(){this.constructor=e}for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)},myway;!function(e){var i;!function(e){var i=function(){function e(){}return e}();e.ProprietesDoc=i;var n=function(){function e(){}return e}();e.ConsulterDocumentOutput=n;var t=function(){function e(){}return e}();e.Fichier=t;var r=function(e){function i(){e.call(this)}return __extends(i,e),i}(i);e.Details=r;var o=function(){function e(){}return e}();e.Annotation=o;var a=function(){function e(){}return e}();e.ConsulterDocumentInput=a}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(e){this.codePrestation=e,this.montant=new MyWay.Model.MontantDevise,this.estFacturationPrestation=!1,this.libellePrestation=""}return e}();e.FacturationPrestation=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e}();e.Bordereau=i;var n=function(){function e(){}return e}();e.BilletterieJAB=n;var t=function(){function e(){}return e}();e.BordereauJAB=t}(i=e.JAB||(e.JAB={}))}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(e,i){this.libelleCourt=e,this.libelleLong=i}return e}();e.LibelleOperation=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e}();e.OperationFinanciere=i;var n=function(){function e(){}return e}();e.ChampErreurOperationFinanciere=n}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this.estAfficherMessageErreurPlafondVersement=!1,this.estAfficherPopupPlafondVersement=!1,this.plafondVersementRest=null}return e}();e.PlafondVersementParametre=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(e,i){this.isCocher=e,this.numeroReferenceEnveloppe=i}return e}();e.ReferenceEnveloppe=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(e,i,n,t,r){this.montantTotal=i,this.parametreListeComptes=e,this.rice=n,this.iban=t,this.repartitionMemorisee=r}return e}();e.ParametreRepartition=i;var n=function(){function e(){this.numeroCompte="",this.montant=0,this.libelle=""}return e}();e.TableauRepartitionExtourne=n;var t=function(){function e(e,i,n,t,r,o,a,s,c,l){this.montantDevise1=e,this.libelle1=i,this.montantDevise2=n,this.libelle2=t,this.compteCredite2=r,this.rice2=this.rice2,this.montantDevise3=a,this.libelle3=s,this.compteCredite3=c,this.rice3=l}return e.prototype.valideRepartition=function(){if(this.montantDevise1&&this.montantDevise1.montant&&this.libelle1){if(!this.montantDevise2||!this.montantDevise2.montant)return this.montantDevise3&&this.montantDevise3.montant?this.verifieLiaison(this.compteCredite3,this.montantDevise3,this.libelle3,this.rice3):!0;if(this.verifieLiaison(this.compteCredite2,this.montantDevise2,this.libelle2,this.rice2))return this.montantDevise3&&this.montantDevise3.montant?this.verifieLiaison(this.compteCredite3,this.montantDevise3,this.libelle3,this.rice3):!0}return!1},e.prototype.getIsValid=function(){this.isValid=this.valideRepartition()},e.prototype.verifieLiaison=function(e,i,n,t){return i&&i.montant>0&&n&&(e&&!e.itemBottomSelectionne||e&&e.itemBottomSelectionne&&t&&t.isComplete()&&t.$valid)?!0:i&&!i.montant?!0:!1},e}();e.Repartition=t}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(i,t,r){var o=this;this.$scope=i,this.operationDiverseService=t,this.$q=r,this.listeTypeOperationDiverse=[],this.listeFamilleParSens=[],this.estOuvertPanneau=!1,this.estForcageOperationFinanciere=!1,this.estListeTypesODVide=!1,this.ancienMontantOpeFi=0,this.initialisationVariablesEtDonnes(),i.$on("est_operation_diverse_opefi",function(i,t){o.estOperationDiverse=t,o.initialisationVariablesEtDonnes(),o.estOperationDiverse&&(o.estEnChargement=!0,o.initialisationFamilles().then(function(){o.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,o.segmentPrjo.numeroCompteclient=o.rice.formatRicePourStructureEchange(),o.segmentPrjo.montantCommission=n.MONTANT_COMMISSION_A_ZERO_OD,o.segmentPrjo.detailAImprimer="",o.segmentPrjo.codeDeviseOperation=o.devise.code,o.estOuvertPanneau=!0})["finally"](function(){o.estEnChargement=!1}))}),i.$on("montant_changed",function(e,i){o.estOperationDiverse&&((i<n.TEST_MONTANT_A_ZERO_OD&&o.ancienMontantOpeFi>n.TEST_MONTANT_A_ZERO_OD||i>n.TEST_MONTANT_A_ZERO_OD&&o.ancienMontantOpeFi<n.TEST_MONTANT_A_ZERO_OD)&&(o.estEnChargement=!0,o.initialisationFamilles().then(function(){o.estOuvertPanneau=!0})["finally"](function(){o.estEnChargement=!1})),i!==o.ancienMontantOpeFi&&(o.segmentPrjo.montantOperation=i)),o.ancienMontantOpeFi=i}),i.$on("mwsfOperationDiverse_forcage_opefi",function(e,i,t){var r,a,s;o.estForcageOperationFinanciere=!0,t&&(r=t.libelle2SaisiOD,o.segmentPrjo.codeReferenceOD===n.CODE_TYPE_OD_ICCC?s=o.segmentPrjo.libelle1SaisiOD:a=o.segmentPrjo.libelle1SaisiOD),o.estEnChargement=!0,o.initialisationFamilles().then(function(){return o.listeFamilleParSens.length>0&&(o.familleSelectionneForcage=_.find(o.listeFamilleParSens,i.familleOperationDiverse),o.indexFamilleSelectionneForcage=_.findIndex(o.listeFamilleParSens,i.familleOperationDiverse)),o.operationDiverseService.getAllTypesParFamilleSelectionne(i.familleOperationDiverse.COJOFA,i.familleOperationDiverse.YNOXCE)}).then(function(e){o.libelleCodeFamille=i.familleOperationDiverse.COJOFA,o.libelleFamille=i.familleOperationDiverse.ULIWFO,o.familleOdChoix.COJOFA=o.libelleCodeFamille,o.familleOdChoix.ULIWFO=o.libelleFamille,o.familleOdChoix.YNOXCE=i.familleOperationDiverse.YNOXCE,o.familleOdChoix.UCGWBD=i.familleOperationDiverse.UCGWBD,o.familleOdChoix.UCGWGA=i.familleOperationDiverse.UCGWGA,o.familleOdChoix.UCGWBA=i.familleOperationDiverse.UCGWBA,o.familleOdChoix.UCGWRT=i.familleOperationDiverse.UCGWRT,o.familleOdChoix.UCGWMO=i.familleOperationDiverse.UCGWMO,o.familleOdChoix.CIJOAS=i.familleOperationDiverse.CIJOAS,o.familleOdChoix.UCGWSR=i.familleOperationDiverse.UCGWSR,o.initialisationListeType(e),o.listeTypeOperationDiverse.length>0&&(o.typeSelectionneForcage=_.find(o.listeTypeOperationDiverse,i.typeOperationDiverse),o.indexTypeSelectionneForcage=_.findIndex(o.listeTypeOperationDiverse,i.typeOperationDiverse))})["finally"](function(){o.onSelectionChangeNavcolList(i.typeOperationDiverse,n.ID_COLONNE_TYPE_COMPOSANT_COLONNE_OD),o.segmentPrjo.montantOperation=t.montantOperation,o.saisieLibelleUlip07=r,o.segmentPrjo.codeReferenceOD===n.CODE_TYPE_OD_ICCC?o.saisieLibelleUlip08=s:o.saisieLibelleUlip06=a,o.estEnChargement=!1,o.estOperationDiverseValide=!0})})}return n.prototype.initialisationVariablesEtDonnes=function(){this.texteLibelleUlip06="",this.texteLibelleUlip07="",this.texteLibelleUlip08="",this.operationDiverseSearch="",this.estForcageOperationFinanciere||(this.saisieLibelleUlip06="",this.saisieLibelleUlip07="",this.saisieLibelleUlip08=""),this.messageErreurSaisieNumeroCommande=n.TEXTE_MESSAGE_ERREUR_SAISIE_NUM_COMMANDE_OD,this.messageErreurSaisieObligatoire=n.TEXTE_MESSAGE_ERREUR_SAISIE_OBLIGATOIRE_OD,this.titrePanneauRetractableOperationDiverse=n.TEXTE_TITRE_OPERATION_DIVERSE,this.isAfficherMessageSaisieObligatoireUlip06=!1,this.isAfficherMessageSaisieObligatoireUlip07=!1,this.isAfficherBlocSaisieLibelle=!1,this.isAfficherLibelleUlip06=!1,this.isAfficherLibelleUlip08=!1,this.estOperationDiverseValide=!1,this.champRequisUlip06=!1,this.champRequisUlip07=!1,this.verificationDesChampsRequis=!1,this.familleOdChoix=new MyWay.Model.FamilleOperationDiverse,this.typeOdChoix=new MyWay.Model.TypeOperationDiverse,this.estEnChargement=!0,this.rice&&(this.rice=new MyWay.Model.Rice(this.rice.codeEtablissement?this.rice.codeEtablissement:"",this.rice.codeGuichet?this.rice.codeGuichet:null,this.rice.codeActiviteCompte?this.rice.codeActiviteCompte:"",this.rice.radical?this.rice.radical:"",this.rice.cleCompte?this.rice.cleCompte:"",this.rice.cleRice?this.rice.cleRice:"",this.rice.riceNonExistant?this.rice.riceNonExistant:null,this.rice.$valid?this.rice.$valid:null,this.rice.erreurBloquante?this.rice.erreurBloquante:null))},n.prototype.validationOperationDiverse=function(){this.libelleCodeType===n.CODE_TYPE_OD_ICCC?""===this.saisieLibelleUlip06&&(this.isAfficherMessageNumeroCommande=!0):this.indicateurZoneTiers===n.INDICATEUR_ZONE_OBJET_A_O_OD&&""===this.saisieLibelleUlip06?this.isAfficherMessageSaisieObligatoireUlip06=!0:""!==this.saisieLibelleUlip06&&(this.isAfficherMessageSaisieObligatoireUlip06=!1),this.indicateurZoneObjet===n.INDICATEUR_ZONE_OBJET_A_O_OD&&""===this.saisieLibelleUlip07?this.isAfficherMessageSaisieObligatoireUlip07=!0:""!==this.saisieLibelleUlip07&&(this.isAfficherMessageSaisieObligatoireUlip07=!1),this.isAfficherMessageSaisieObligatoireUlip07||this.isAfficherMessageSaisieObligatoireUlip06||this.isAfficherMessageNumeroCommande?this.estOperationDiverseValide=!1:this.estOperationDiverseValide=!0,this.segmentPrjo.libelleFamilleOD=this.libelleFamille,this.segmentPrjo.libelleTypeOD=this.libelleType,this.segmentPrjo.codeTransaction=this.codeIdentificationRequete,this.segmentPrjo.codeReferenceOD=this.libelleCodeType,this.segmentPrjo.codeFamilleOD=this.libelleCodeFamille,this.segmentPrjo.libelle2SaisiOD=this.saisieLibelleUlip07,this.libelleCodeType===n.CODE_TYPE_OD_ICCC?this.segmentPrjo.libelle1SaisiOD=_.padLeft(this.saisieLibelleUlip08,32,"0"):this.segmentPrjo.libelle1SaisiOD=this.saisieLibelleUlip06,this.listeOperationDiverse=new MyWay.Model.OperationDiverse(this.familleOdChoix,this.typeOdChoix),this.verificationDesChampsRequis||(this.champRequisUlip07=this.isAfficherMessageSaisieObligatoireUlip07?!0:!1,this.champRequisUlip06=this.isAfficherMessageNumeroCommande||this.isAfficherMessageSaisieObligatoireUlip06?!0:!1),this.$scope.$emit("mwsfOperation_Diverse",this.listeOperationDiverse)},n.prototype.initialisationFamilles=function(){var e=this,t=this.$q.defer();return this.listeTypeOperationDiverse=[],this.isAfficherBlocSaisieLibelle=!1,this.operationDiverseService.getParametresComptables().then(function(t){return t?(e.codeInterneRattachementGuichetComptable=t[i.Constantes.ParametresComptables.EDS_INTERNE_RATTACHEMENT_GUICHET_COMPTABLE],e.typeRattachementGuichetComptable=t[i.Constantes.ParametresComptables.EDS_TYPE_RATTACHEMENT_GUICHET_COMPTABLE],e.codeGuichetInterbancaire=t[i.Constantes.ParametresComptables.CODE_GUICHET_INTERBANCAIRE],e.dateOperationJourneeComptable=t[i.Constantes.ParametresComptables.DATE_OPERATION_JOURNEE_COMPTABLE]):e.dateOperationJourneeComptable=moment().format(n.FORMAT_DATE_JOURNEE_COMPTABLE),e.operationDiverseService.getAllCodeRegroupement(e.codeInterneRattachementGuichetComptable,e.codeGuichetInterbancaire)}).then(function(i){return e.tableauDesRegroupements=i,e.operationDiverseService.getFamillesFiltre(e.codeInterneRattachementGuichetComptable,e.codeGuichetInterbancaire,e.typeRattachementGuichetComptable,e.montant)}).then(function(i){return e.listeFamilleParSens=i,e.estOuvertPanneau=!0,t.resolve(),t.promise})},n.prototype.initialisationListeType=function(e){var i=[];return i=this.operationDiverseService.getTypesFiltre(e,this.typeRattachementGuichetComptable,this.tableauDesRegroupements,this.montant,this.dateOperationJourneeComptable,this.devise.code,this.fonctionnalite.toString()),this.listeTypeOperationDiverse=this.operationDiverseService.getTypesPourAffichage(i),this.listeTypeOperationDiverse.length===n.TEST_MONTANT_A_ZERO_OD&&(this.estListeTypesODVide=!0,this.segmentPrjo.libelleFamilleOD="",this.segmentPrjo.libelleTypeOD="",this.segmentPrjo.codeTransaction="",this.segmentPrjo.codeReferenceOD="",this.segmentPrjo.codeFamilleOD="",this.segmentPrjo.libelle2SaisiOD="",this.segmentPrjo.libelle1SaisiOD="",this.estOperationDiverseValide=!1),this.listeTypeOperationDiverse},n.prototype.onSelectionChangeNavcolList=function(e,t){var r=this;t===n.ID_COLONNE_FAMILLE_COMPOSANT_COLONNE_OD&&(this.isAfficherBlocSaisieLibelle=!1,this.estListeTypesODVide=!1,this.estForcageOperationFinanciere||(this.saisieLibelleUlip06="",this.saisieLibelleUlip07="",this.saisieLibelleUlip08=""),""!==this.saisieLibelleUlip06&&(this.saisieLibelleUlip06=""),""!==this.saisieLibelleUlip07&&(this.saisieLibelleUlip07=""),""!==this.saisieLibelleUlip08&&(this.saisieLibelleUlip08=""),this.titrePanneauRetractableOperationDiverse=n.TEXTE_TITRE_OPERATION_DIVERSE,this.segmentPrjo.montantOperation=this.montant,this.estEnChargement=!0,this.operationDiverseService.getAllTypesParFamilleSelectionne(e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_COJOFA],e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_YNOXCE]).then(function(n){r.libelleCodeFamille=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_COJOFA],r.libelleFamille=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_ULIWFO],r.familleOdChoix.COJOFA=r.libelleCodeFamille,r.familleOdChoix.ULIWFO=r.libelleFamille,r.familleOdChoix.YNOXCE=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_YNOXCE],r.familleOdChoix.UCGWBD=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWBD],r.familleOdChoix.UCGWGA=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWGA],r.familleOdChoix.UCGWBA=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWBA],r.familleOdChoix.UCGWRT=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWRT],r.familleOdChoix.UCGWMO=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWMO],r.familleOdChoix.CIJOAS=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_CIJOAS],r.familleOdChoix.UCGWSR=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWSR],r.initialisationListeType(n),r.$scope.$apply()})["finally"](function(){r.estEnChargement=!1,r.$scope.$apply()})),t===n.ID_COLONNE_TYPE_COMPOSANT_COLONNE_OD?e&&(this.estForcageOperationFinanciere||(this.saisieLibelleUlip06="",this.saisieLibelleUlip07="",this.saisieLibelleUlip08=""),this.titrePanneauRetractableOperationDiverse=n.TEXTE_TITRE_OPERATION_DIVERSE,this.isAfficherBlocSaisieLibelle=!0,this.isAfficherMessageNumeroCommande=!1,this.isAfficherMessageSaisieObligatoireUlip06=!1,this.isAfficherMessageSaisieObligatoireUlip07=!1,this.champRequisUlip06=!1,this.champRequisUlip07=!1,this.verificationDesChampsRequis=!1,this.libelleCodeType=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_COJXHD],this.libelleType=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_ULIWOD],this.codeIdentificationRequete=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_IDSEQ3],this.texteLibelleUlip06=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_LIJMTI],this.texteLibelleUlip07=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_LIJMOB],this.texteLibelleUlip08=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_LIJMTI],this.indicateurZoneTiers=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_CIJMTI],this.indicateurZoneObjet=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_CIJMOB],this.typeOdChoix.IDSEQ3=this.codeIdentificationRequete,this.typeOdChoix.CIJMOB=this.indicateurZoneObjet,this.typeOdChoix.CIJMTI=this.indicateurZoneTiers,this.typeOdChoix.ULIWOD=this.libelleType,this.typeOdChoix.COJXHD=this.libelleCodeType,this.typeOdChoix.COJOFA=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_COJOFA],this.typeOdChoix.UCTXS5=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCTXS5],this.typeOdChoix.UCGWMO=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWMO],this.typeOdChoix.UCGWBD=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWBD],this.typeOdChoix.UCGWBA=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWBA],this.typeOdChoix.UCGWRT=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_UCGWRT],this.typeOdChoix.DDEXPH=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_DDEXPH],this.typeOdChoix.DFJOVA=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_DFJOVA],
this.typeOdChoix.LIJMTI=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_LIJMTI],this.typeOdChoix.LIJMOB=e[i.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_LIJMOB],this.titrePanneauRetractableOperationDiverse=n.TEXTE_TITRE_OPERATION_DIVERSE+" ("+this.typeOdChoix.COJXHD+"/ "+this.familleOdChoix.ULIWFO+" "+this.typeOdChoix.ULIWOD+")",this.libelleCodeType===n.CODE_TYPE_OD_ICCC?(this.isAfficherLibelleUlip06=!1,this.isAfficherLibelleUlip08=!0):(this.isAfficherLibelleUlip06=!0,this.isAfficherLibelleUlip08=!1),this.validationOperationDiverse(),this.estOuvertPanneau=!1):this.isAfficherBlocSaisieLibelle=!1},n.prototype.onNavcolRecherche=function(e){e||e.length!==n.TEST_MONTANT_A_ZERO_OD||(this.operationDiverseSearch=""),this.operationDiverseSearch=e},n.$inject=["$scope","operationDiverseService","$q"],n.TEXTE_MESSAGE_ERREUR_SAISIE_NUM_COMMANDE_OD="Saisie obligatoire du numéro de commande",n.TEXTE_MESSAGE_ERREUR_SAISIE_OBLIGATOIRE_OD="Saisie obligatoire",n.INDICATEUR_ZONE_OBJET_A_O_OD="O",n.CODE_TYPE_OD_ICCC="ICCC",n.MONTANT_COMMISSION_A_ZERO_OD=0,n.TEST_MONTANT_A_ZERO_OD=0,n.ID_COLONNE_FAMILLE_COMPOSANT_COLONNE_OD="colonne-famille",n.ID_COLONNE_TYPE_COMPOSANT_COLONNE_OD="colonne-type",n.FORMAT_DATE_JOURNEE_COMPTABLE="DDMMYYYY",n.TEXTE_TITRE_OPERATION_DIVERSE="Operation Diverse",n}();i.OperationDiverseController=n,i.module.controller("OperationDiverseController",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/operation-diverse/operation-diverse-view.html",scope:{montant:"=",listeOperationDiverse:"=",fonctionnalite:"=",rice:"=",devise:"=",segmentPrjo:"=",estOperationDiverseValide:"="},controller:"OperationDiverseController",controllerAs:"viewModelOperationDiverseCtrl",bindToController:!0,link:function(e,i,n){}}}e.mwsfOperationDiverse=i,e.module.directive("mwsfOperationDiverse",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(i,n){this.$q=i,this.serviceAgentExtended=n,this.TEXTE_DEVISE_EURO=e.Constantes.Devise.TEXTE_CODE_DEVISE_EURO,this.TABLE_DELOC_JU2A_FAMILLES=e.Constantes.TablesDelocaliseesOperationDiverse.TABLE_DELOC_FAMILLES_OD_JU2A,this.TABLE_DELOC_JU2C_TYPES=e.Constantes.TablesDelocaliseesOperationDiverse.TABLE_DELOC_CODE_REGROUPEMENT_OD_JU2C,this.TABLE_DELOC_JU2B_CODE_REGROUPEMENT=e.Constantes.TablesDelocaliseesOperationDiverse.TABLE_DELOC_TYPES_OD_JU2B,this.PROPRIETE_TABLE_DELOC_COJOFA=e.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_COJOFA,this.PROPRIETE_TABLE_DELOC_YNOXCE=e.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_YNOXCE,this.TEXTE_REMBOURSEMENT=e.Constantes.OperationDiverse.TEXTE_REMBOURSEMENT,this.TEXTE_CODE_R=e.Constantes.OperationDiverse.TEXTE_CODE_REMBOURSEMENT_R,this.TEXTE_CODE_V=e.Constantes.OperationDiverse.TEXTE_CODE_VERSEMENT_V,this.TEXTE_VERSEMENT=e.Constantes.OperationDiverse.TEXTE_VERSEMENT,this.TEXTE_SEGMENTPRVRIO_MAJ=e.Constantes.Segment.TEXTE_SEGMENTPRVRIO_MAJUSCULE,this.TEXTE_QUATRE_ETOILES=e.Constantes.OperationDiverse.TEXTE_QUATRE_ETOILES,this.TEXTE_NOM_MODEL_REGROUPEMENT_OD=e.Constantes.OperationDiverse.TEXTE_NOM_MODEL_REGROUPEMENT_OD,this.TEXTE_MODE_APPARITION_CL=e.Constantes.OperationDiverse.TEXTE_MODE_APPARITION_CL,this.TEXTE_DEUX_ETOILES=e.Constantes.OperationDiverse.TEXTE_DEUX_ETOILES,this.TEXTE_UNE_ETOILE=e.Constantes.OperationDiverse.TEXTE_UNE_ETOILE,this.TEXTE_VERSEMENT_SIMPLE_MAJ=e.Constantes.Fonctionnalite.TEXTE_VERSEMENT_SIMPLE_MAJ,this.TEXTE_CODE_DECOUPAGE_ZZ=e.Constantes.OperationDiverse.TEXTE_CODE_DECOUPAGE_OD_ZZ,this.CODE_INTERDIT_OD_J17O5G01=e.Constantes.OperationDiverse.CODE_INTERDIT_OD_J17O5G01,this.CODE_INTERDIT_OD_J17O3G01=e.Constantes.OperationDiverse.CODE_INTERDIT_OD_J17O3G01,this.CODE_INTERDIT_OD_J17O4A01=e.Constantes.OperationDiverse.CODE_INTERDIT_OD_J17O4A01,this.TEXTE_OUI_O=e.Constantes.OperationDiverse.TEXTE_OUI_O,this.CODE_RATTACHEMENT_GUICHET_COMPTABLE_AGENCE_OD_003=e.Constantes.OperationDiverse.CODE_RATTACHEMENT_GUICHET_COMPTABLE_AGENCE_OD_003,this.TEXTE_NOM_MODEL_FAMILLE_OD=e.Constantes.OperationDiverse.TEXTE_NOM_MODEL_FAMILLE_OD}return i.prototype.getAllFamilles=function(){return this.serviceAgentExtended.getListDonneesDelocalisees(this.TABLE_DELOC_JU2A_FAMILLES,this.TEXTE_NOM_MODEL_FAMILLE_OD).then(function(e){return e})},i.prototype.getTypeParCodeTypeEtCodeFamille=function(i,n,t){var r=this.$q.defer(),o=[{propriete:e.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_COJXHD,valeur:i,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:this.PROPRIETE_TABLE_DELOC_YNOXCE,valeur:n,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:e.Constantes.TablesDelocaliseesOperationDiverse.PROPRIETE_TABLE_DELOC_COJOFA,valeur:t,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];return this.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(n,this.TABLE_DELOC_JU2B_CODE_REGROUPEMENT,o).then(function(e){r.resolve(e[0])}),r.promise},i.prototype.getFamilleParCodeFamille=function(e,i){var n=this.$q.defer(),t=[{propriete:this.PROPRIETE_TABLE_DELOC_COJOFA,valeur:e,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:this.PROPRIETE_TABLE_DELOC_YNOXCE,valeur:i,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];return this.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(i,this.TABLE_DELOC_JU2A_FAMILLES,t).then(function(e){n.resolve(e[0])}),n.promise},i.prototype.getFamillesFiltre=function(e,i,n,t){var r=this,o=[];return this.getAllFamilles().then(function(e){return e}).then(function(a){return r.getAllCodeRegroupement(e,i).then(function(e){return angular.forEach(a,function(i){if(-1!==e.tableauRegroupementCodeCaisseEpargne.indexOf(i.YNOXCE)&&""!==i.COJOFA&&(i.UCGWMO===r.TEXTE_MODE_APPARITION_CL||i.UCGWMO===r.TEXTE_DEUX_ETOILES)){var a=i.UCGWBD,s=i.UCGWBA,c=i.UCGWRT;if(n===r.CODE_RATTACHEMENT_GUICHET_COMPTABLE_AGENCE_OD_003){if(a===r.TEXTE_OUI_O){var l=r.testValiditeFamilleOdFiltre3(t,i.CIJOAS);l&&o.push(i)}else if(s===r.TEXTE_OUI_O&&-1!==e.tableauRegroupementBackOffice.indexOf(c)&&c!==r.TEXTE_QUATRE_ETOILES){var l=r.testValiditeFamilleOdFiltre3(t,i.CIJOAS);l&&o.push(i)}}else if(s===r.TEXTE_OUI_O&&(-1!==e.tableauRegroupementBackOffice.indexOf(c)||c===r.TEXTE_QUATRE_ETOILES)){var l=r.testValiditeFamilleOdFiltre3(t,i.CIJOAS);l&&o.push(i)}}}),o})})},i.prototype.testValiditeFamilleOdFiltre3=function(e,i){var n=!1;return 0!==e&&(i===this.TEXTE_CODE_R||i===this.TEXTE_UNE_ETOILE?n=!0:(i===this.TEXTE_CODE_V||i===this.TEXTE_UNE_ETOILE)&&(n=!0)),n},i.prototype.getTypesFiltre=function(i,n,t,r,o,a,s){var c,l=this,p=[];if(o)c=o.replace(/(\d{2})(\d{2})(\d{4})/,"$3$2$1");else{var m=new Date;c="0"+m.getDate()+"0"+m.getMonth()+m.getFullYear()}return(s===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT||s===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE||s===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_DEVISE||s===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_COMPTE_88)&&(r=-1*r),angular.forEach(i,function(e){var i=e.COJXHD.substr(0,2),o=n===l.CODE_RATTACHEMENT_GUICHET_COMPTABLE_AGENCE_OD_003,m=e.UCGWBD===l.TEXTE_OUI_O,u=e.UCGWBA===l.TEXTE_OUI_O,d=e.UCGWRT!==l.TEXTE_QUATRE_ETOILES,E=e.UCTXS5===l.TEXTE_CODE_R,h=e.UCTXS5===l.TEXTE_CODE_V,f=e.UCTXS5===l.TEXTE_UNE_ETOILE;o&&m?(f||E&&r>0||h&&0>r)&&l.estValideFiltre456(e,c,i,a,s)&&p.push(e):o&&u&&d&&-1!==t.tableauRegroupementBackOffice.indexOf(e.UCGWRT)?(f||E&&r>0||h&&0>r)&&l.estValideFiltre456(e,c,i,a,s)&&p.push(e):!o&&u&&(f||E&&r>0||h&&0>r)&&l.estValideFiltre456(e,c,i,a,s)&&p.push(e)}),p},i.prototype.estValideFiltre456=function(e,i,n,t,r){var o=this.testValiditeTypeOdFiltre4(e.DDEXPH,e.DFJOVA,i),a=this.testValiditeTypeOdFiltre5(e.IDSEQ3),s=this.testValiditeTypeOdFiltre6(n,t,r);return o&&a&&s?!0:!1},i.prototype.testValiditeTypeOdFiltre5=function(e){var i=!0;return(e===this.CODE_INTERDIT_OD_J17O5G01||e===this.CODE_INTERDIT_OD_J17O3G01||e===this.CODE_INTERDIT_OD_J17O4A01)&&(i=!1),i},i.prototype.testValiditeTypeOdFiltre4=function(e,i,n){var t=!1;return n>=e&&i>=n&&(t=!0),t},i.prototype.testValiditeTypeOdFiltre6=function(e,i,n){var t=!1;return e===this.TEXTE_CODE_DECOUPAGE_ZZ?i!==this.TEXTE_DEVISE_EURO&&""!==i&&n!==this.TEXTE_VERSEMENT_SIMPLE_MAJ&&(t=!0):(i===this.TEXTE_DEVISE_EURO||""===i)&&(t=!0),t},i.prototype.getAllTypesParFamilleSelectionne=function(e,i){var n=this,t=this.$q.defer(),r=[],o=[{propriete:this.PROPRIETE_TABLE_DELOC_COJOFA,valeur:e,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:this.PROPRIETE_TABLE_DELOC_YNOXCE,valeur:i,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];return this.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(i,this.TABLE_DELOC_JU2B_CODE_REGROUPEMENT,o).then(function(e){angular.forEach(e,function(e){""!==e.ULIWOD&&(e.UCGWMO===n.TEXTE_MODE_APPARITION_CL||e.UCGWMO===n.TEXTE_DEUX_ETOILES)&&r.push(e)}),t.resolve(r)}),t.promise},i.prototype.getAllCodeRegroupement=function(e,i){var n=this;return this.serviceAgentExtended.getListDonneesDelocalisees(this.TABLE_DELOC_JU2C_TYPES,this.TEXTE_NOM_MODEL_REGROUPEMENT_OD).then(function(t){var r=[],o=[];angular.forEach(t,function(t){var a=t.NOCEEL,s=t.YNOXCE;a!==e&&s!==i&&(t.UCGWRT=n.TEXTE_QUATRE_ETOILES),-1===r.indexOf(t.UCGWRT)&&r.push(t.UCGWRT),-1===o.indexOf(t.YNOXCE)&&o.push(t.YNOXCE)});var a;return a=new MyWay.Model.TableauDeRegroupementOperationDiverse,a.tableauRegroupementBackOffice=r,a.tableauRegroupementCodeCaisseEpargne=o,a})},i.prototype.getParametresComptables=function(){return this.serviceAgentExtended.getParametresComptables().then(function(e){return e&&angular.isDefined(e)?e:void 0})},i.prototype.getDevise=function(){var e;return this.serviceAgentExtended.getFromContext(this.TEXTE_SEGMENTPRVRIO_MAJ).then(function(i){return e=null===i?"":i.codeDeviseMontantOperation})},i.prototype.getTypesPourAffichage=function(e){var i=this,n=[];angular.forEach(e,function(e){e.UCTXS5===i.TEXTE_CODE_R&&(e.UCTXS5=i.TEXTE_REMBOURSEMENT,n.push(e)),e.UCTXS5===i.TEXTE_CODE_V&&(e.UCTXS5=i.TEXTE_VERSEMENT,n.push(e))});var t=[];return t=_.sortBy(n,this.triTypesOd)},i.prototype.triTypesOd=function(e){return e.COJXHD},i.$inject=["$q","serviceAgentExtended"],i}();e.OperationDiverseService=i,e.module.service("operationDiverseService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,n,t,r,o,a){var s=this;if(this.$scope=e,this.operationFinanciereService=n,this.operationDiverseService=t,this.$q=r,this.postOperationFinanciere=o,this.miniProfilService=a,this.typeAffichageSolde=i.TypeAffichageSolde.ACTUEL,this.afficherReserveEncaissement=!1,this.afficherReferenceSac=!1,this.afficherOD=!1,this.afficherChequeBanque=!1,this.afficherTitulaireCompte=!1,this.afficherDateValeur=!1,this.afficherReferenceOAD=!1,this.afficherBilletterie=!1,this.afficherTableauRepartitionChequeBanque=!1,this.afficherVirementInterne=!1,this.afficherLibelleNonModifiable=!1,this.afficherSolde=!0,this.chargement=!0,this.operationFinanciere&&this.operationFinanciere.compte&&this.operationFinanciere.compte.rice&&this.operationFinanciere.segmentPrvRio){var c=this.operationFinanciere.libelleOperation.libelleLong,l=this.operationFinanciere.modeFinancier.CTGXM1;this.operationFinanciere.segmentPrvRio.modeFinancierChoisi=this.operationFinanciere.modeFinancier.CTGXMF,this.operationFinanciereService.creationContexteSaisieOperationFinanciere().then(function(n){s.operationFinanciere.contexteSaisieOperationFinanciere=n,s.operationFinanciereService.getLibelleOperationFinanciere(s.operationFinanciere.compte.rice.codeEtablissement,i.Constantes.OperationFinanciere.CODE_OPERATION_A,s.operationFinanciere.segmentPrvRio).then(function(e){l===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&s.operationFinanciere.facturationPrestation&&"0"!==s.operationFinanciere.facturationPrestation.codePrestation?(s.operationFinanciere.libelleOperation.libelleLong=i.Constantes.OperationFinanciere.TEXTE_LIBELLE_ANN_EXTOURNE+c,s.operationFinanciere.segmentPrvRio.libelleOperation1=s.operationFinanciere.libelleOperation.libelleLong,s.operationFinanciere.segmentPrvRio.libelleOperation2=s.operationFinanciere.libelleOperation.libelleCourt):(s.operationFinanciere.libelleOperation=e,s.operationFinanciere.segmentPrvRio.libelleOperation1=e.libelleLong,s.operationFinanciere.segmentPrvRio.libelleOperation2=e.libelleCourt),s.estRepartitionChequeBanque=s.operationFinanciere&&s.operationFinanciere.estExtourneRepartitionChequeBanque?!0:!1})["finally"](function(){s.traitementModeFinancierOD(l).then(function(){return s.traitementChequeBanque(l)}).then(function(){s.traitementReferenceSac(l),s.afficherBilletterie=l===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES?!0:!1,s.traitementReserveEncaissement(l,s.operationFinanciere.segmentPrvRio.nombreJourReserveEncaissement),s.traitementVirementInterne(l,s.operationFinanciere.segmentPrvRio.S_PRVRIOUGR),s.afficherTitulaireCompte=s.traitementAfficherTitulaireCompte(s.operationFinanciere.fonctionnalite,s.operationFinanciere.titulaireCompte),s.operationFinanciere.fonctionnalite&&(s.libelleMontant=s.getLibelleMontant(s.operationFinanciere.fonctionnalite.toString())),s.afficherReferenceOAD=s.traitementAfficherReferenceOAD(s.operationFinanciere.fonctionnalite,s.operationFinanciere.referenceOAD),s.comptePourLeSolde=s.traitementPourLeSolde(s.operationFinanciere.compte.rice,s.operationFinanciere.compte.devise),s.afficherDateValeur=s.traitementDateDevaleur(s.operationFinanciere.segmentPrvRio.dateDeValeur),s.chargement=!1,e.$emit("chargement_extourne_emit_opefi",l)})})})}e.$on("mwsfBilletterie_changement_valeur_monnaie",function(e,i){s.operationFinanciere.segmentPrvRio.S_BILLETERIE.monnaieSansBillet=i})}return n.prototype.traitementChequeBanque=function(e){var n=this;if(e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&this.operationFinanciere.segmentPrvRio){if(this.afficherChequeBanque=!0,this.estRepartitionChequeBanque&&this.operationFinanciere.segmentPrvRio.S_PRVRIOUGR.length>0){this.montantGlobalRepartition=this.operationFinanciere.montant?this.operationFinanciere.montant:0;for(var t=[],r=0,o=this.operationFinanciere.segmentPrvRio.S_PRVRIOUGR;r<o.length;r++){var a=o[r];if(""!==a.numeroCompte){var s=new i.Model.TableauRepartitionExtourne;s.montant=a.montantVirement,s.numeroCompte=this.decoupageRicePourAffichage(a.numeroCompte),s.libelle=a.libelleVirement,t.push(s)}}return this.tableauRepartitionChequeBanque={width:"col-md-9",reserve:!1,orderBy:"",perPage:5,multiSelect:!1,filterEnable:!1,sortEnable:!1,moreEnable:!1,columns:[{title:i.Constantes.Extourne.TABLEAU_REPARTITION_CHB_TITRE_NUMERO_COMPTE,bind:"numeroCompte",cssClass:"col-md-3 col-lg-3"},{title:i.Constantes.Extourne.TABLEAU_REPARTITION_CHB_TITRE_NUMERO_COMPTE,bind:"montant | number:2",cssClass:"col-md-2 col-lg-2 text-align-right"}],selectedItems:[],disabledItems:null,templateUrl:"",data:t,selectionChangeHandler:this,theadSticky:".zone-travail",caption:"Liste des comptes"},this.afficherTableauRepartitionChequeBanque=!0,""!==this.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].numeroCompte?(this.operationFinanciere.repartition=new i.Model.Repartition(null,null,null,null,null,null,null,null,null,null),this.traitementRecuperationInformationsComptesRepartitionChequeBanque(this.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].numeroCompte,this.operationFinanciere.compte.devise.code).then(function(e){return n.operationFinanciere.repartition.compteCredite2=e,""!==n.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].numeroCompte?n.traitementRecuperationInformationsComptesRepartitionChequeBanque(n.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].numeroCompte,n.operationFinanciere.compte.devise.code).then(function(e){return n.operationFinanciere.repartition.compteCredite3=e,n.operationFinanciere.repartition}):n.operationFinanciere.repartition})):this.$q.when(null)}return this.$q.when(null)}return this.$q.when(null)},n.prototype.traitementRecuperationInformationsComptesRepartitionChequeBanque=function(e,i){var n=this,t=new MyWay.Model.Contrat;if(t.valeurProduit=0,t.valeurProduitDevise=0,t.libelleProduit="",t.codeDeviseContrat=i,e&&""!==e){var r=e.substring(0,5),o=e.substring(10,12),a=e.substring(5,10),s=e.substring(10,21);return this.postOperationFinanciere.recupererLibelleProduitPourUnCompte(r,o,i,a,s).then(function(i){return t.libelleProduit=i,n.miniProfilService.getSoldeMinuteCompte(e).then(function(e){return e&&(t.valeurProduit=e,t.valeurProduitDevise=e),t})["catch"](function(e){return t})})["catch"](function(e){return t})}return this.$q.when(t)},n.prototype.onSelectionChange=function(e){},n.prototype.traitementVirementInterne=function(e,n){e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&n&&n.length>0&&""!==n[0].numeroCompte&&(this.afficherVirementInterne=!0,this.numeroRiceCompteCredite=this.decoupageRicePourAffichage(n[0].numeroCompte),this.afficherLibelleNonModifiable=!0,this.operationFinanciere&&this.operationFinanciere.detailDuSolde&&this.operationFinanciere.detailDuSolde.soldeActuel&&(this.operationFinanciere.soldeCompteAvantVirement=this.operationFinanciere.detailDuSolde.soldeActuel))},n.prototype.traitementDateDevaleur=function(e){var n=!1;return e&&(this.dateValeur=this.operationFinanciere.segmentPrvRio.dateDeValeur?moment(this.operationFinanciere.segmentPrvRio.dateDeValeur).format(i.Constantes.Extourne.FORMAT_DATE_DD_MM_YYYY).toString():"",n=!0),n},n.prototype.traitementPourLeSolde=function(e,i){var n=new MyWay.Model.Contrat;return n.riceContrat=e.formatRicePourStructureEchange(),n.devise=i,n.codeDeviseContrat=i.code,n},n.prototype.traitementReserveEncaissement=function(e,n){if(e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU){this.afficherReserveEncaissement=!0;var t=n.substring(1,3);t===i.Constantes.Extourne.NOMBRE_JOURS_SANS_RESERVE_00?this.libelleReserveEncaissement=i.Constantes.Extourne.TEXTE_SANS_RESERVE:this.libelleReserveEncaissement=t+i.Constantes.Extourne.TEXTE_JOURS}},n.prototype.traitementAfficherReferenceOAD=function(e,i){var n=!1;return!i||""===i||e!==MyWay.Model.Fonctionnalite.OPERATION_DEPOT_OAD&&e!==MyWay.Model.Fonctionnalite.OPERATION_RETRAIT_OAD||(n=!0),n},n.prototype.traitementAfficherTitulaireCompte=function(e,i){var n=!1;return!i||""===i||e!==MyWay.Model.Fonctionnalite.OPERATION_DEPOT_OAD&&e!==MyWay.Model.Fonctionnalite.OPERATION_RETRAIT_OAD||(n=!0),n},n.prototype.traitementReferenceSac=function(n){n!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&n!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS||null==this.operationFinanciere.referenceEnveloppe.numeroReferenceEnveloppe||""===this.operationFinanciere.referenceEnveloppe.numeroReferenceEnveloppe||(this.afficherReferenceSac=!0,this.afficherLibelleNonModifiable=!0,this.operationFinanciere.libelleOperation.libelleLong=i.Constantes.OperationFinanciere.TEXTE_LIBELLE_DEPOT_ESP_NUMERO+this.operationFinanciere.referenceEnveloppe.numeroReferenceEnveloppe,this.operationFinanciere.segmentPrvRio.libelleOperation1=this.operationFinanciere.libelleOperation.libelleLong),n===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&this.operationFinanciere&&(this.operationFinanciere.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,this.operationFinanciere.segmentPrjo.codeReferenceOD=i.Constantes.OperationFinanciere.CODE_REFERENCE_OD_VEOD,this.operationFinanciere.segmentPrjo.libelle1SaisiOD="",this.operationFinanciere.segmentPrjo.libelle2SaisiOD="",this.operationFinanciere.segmentPrjo.codeDeviseOperation=this.operationFinanciere.compte.devise.code)},n.prototype.traitementModeFinancierOD=function(e){var n=this;if(e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&this.operationFinanciere.facturationPrestation&&"0"!==this.operationFinanciere.facturationPrestation.codePrestation)this.afficherOD=!1;else if(e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&this.operationFinanciere.operationDiverse){this.afficherOD=!0;var t=new MyWay.Model.OperationDiverse;return this.operationDiverseService.getFamilleParCodeFamille(this.operationFinanciere.segmentPrjo.codeFamilleOD,this.operationFinanciere.compte.rice.codeEtablissement).then(function(e){return n.operationDiverseService.getTypeParCodeTypeEtCodeFamille(n.operationFinanciere.segmentPrjo.codeReferenceOD,n.operationFinanciere.compte.rice.codeEtablissement,n.operationFinanciere.segmentPrjo.codeFamilleOD).then(function(i){return e&&(t.familleOperationDiverse=e),i?(t.typeOperationDiverse=i,n.operationFinanciere.operationDiverse=t,n.libelleOperationDiverse=n.operationFinanciere.operationDiverse.typeOperationDiverse.COJXHD+" - "+n.operationFinanciere.operationDiverse.typeOperationDiverse.ULIWOD,n.operationFinanciere.operationDiverse):void 0})["catch"](function(e){return n.$q.when(null)})})["catch"](function(e){return n.$q.when(null)})}return this.$q.when(null)},n.prototype.modificationLibelleOperation=function(){this.operationFinanciere&&this.operationFinanciere.segmentPrvRio&&this.operationFinanciere.libelleOperation&&(this.operationFinanciere.segmentPrvRio.libelleOperation1=this.operationFinanciere.libelleOperation.libelleLong,this.operationFinanciere.segmentPrvRio.libelleOperation2=this.operationFinanciere.libelleOperation.libelleCourt)},n.prototype.getLibelleMontant=function(e){var n;return n=e===MyWay.Model.Fonctionnalite.OPERATION_DEPOT_HORS_CLIENTELE||e===MyWay.Model.Fonctionnalite.OPERATION_DEPOT||e===MyWay.Model.Fonctionnalite.OPERATION_DEPOT_DEVISE||e===MyWay.Model.Fonctionnalite.OPERATION_DEPOT_OAD?i.Constantes.OperationFinanciere.LIBELLE_MONTANT_DEPOT:e===MyWay.Model.Fonctionnalite.OPERATION_RETRAIT||e===MyWay.Model.Fonctionnalite.OPERATION_RETRAIT_DEVISE||e===MyWay.Model.Fonctionnalite.OPERATION_RETRAIT_HORS_CLIENTELE||e===MyWay.Model.Fonctionnalite.OPERATION_RETRAIT_OAD?i.Constantes.OperationFinanciere.LIBELLE_MONTANT_RETRAIT:i.Constantes.OperationFinanciere.LIBELLE_MONTANT_DEFAUT},n.prototype.decoupageRicePourAffichage=function(e){var i="";return""!==e&&(i=e.substr(0,5)+" "+e.substr(5,5)+" "+e.substr(10,9)+" "+e.substr(19,2)),i},n.$inject=["$scope","operationFinanciereService","operationDiverseService","$q","postOperationFinanciere","miniProfilService"],n}();i.OperationFinanciereExtourneController=n,i.module.controller("operationFinanciereExtourneController",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/operation-financiere-extourne/operation-financiere-extourne-view.html",replace:!0,controller:"operationFinanciereExtourneController",controllerAs:"ctrl",bindToController:!0,scope:{operationFinanciere:"="}}}e.mwsfOperationFinanciereExtourne=i,e.module.directive("mwsfOperationFinanciereExtourne",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,n,t){var r=this;this.$scope=e,this.operationDiverseService=n,this.$q=t,this.estForcageOperationFinanciere=!1,this.listeTypeOperationDiverse=[],this.listeFamilleParSens=[],this.ancienMontantOpeFi=0,this.isSchemaComptableMutliple=!1,this.initialisationDonneesVariables(),e.$on("est_operation_diverse_opefi",function(e,i){r.estOperationDiverse=i,r.initialisationDonneesVariables(),r.estOperationDiverse&&(r.estEnChargement=!0,r.initialisationListeDeroulante())}),e.$on("mwsfOperationDiverse_forcage_opefi",function(e,i,n){var t,o;r.estForcageOperationFinanciere=!0,n&&(t=r.segmentPrjo.libelle1SaisiOD,o=n.libelle2SaisiOD),r.estEnChargement=!0,r.initialisationListeDeroulante().then(function(){r.segmentPrjo.montantOperation=n.montantOperation,r.saisieLibelleUlip06=t,r.saisieLibelleUlip07=o,r.libelleCodeFamille=i.familleOperationDiverse.COJOFA,r.libelleFamille=i.familleOperationDiverse.ULIWFO,r.typeOdChoix=i.typeOperationDiverse,r.selectionOD(),r.estEnChargement=!1,r.estOperationDiverseValide=!0,r.estForcageOperationFinanciere=!1})}),e.$on("montant_changed",function(e,n){r.estOperationDiverse&&((n<i.OperationDiverseController.TEST_MONTANT_A_ZERO_OD&&r.ancienMontantOpeFi>i.OperationDiverseController.TEST_MONTANT_A_ZERO_OD||n>i.OperationDiverseController.TEST_MONTANT_A_ZERO_OD&&r.ancienMontantOpeFi<i.OperationDiverseController.TEST_MONTANT_A_ZERO_OD)&&(r.estEnChargement=!0,r.initialisationListeDeroulante()),n!==r.ancienMontantOpeFi&&(r.segmentPrjo.montantOperation=n)),r.ancienMontantOpeFi=n})}return n.prototype.initialisationListeDeroulante=function(){var n=this;return this.estEnChargement=!0,this.initialisationFamilles().then(function(){n.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,n.segmentPrjo.numeroCompteclient=n.rice.formatRicePourStructureEchange(),n.segmentPrjo.montantCommission=i.OperationDiverseController.MONTANT_COMMISSION_A_ZERO_OD,n.segmentPrjo.detailAImprimer="",n.segmentPrjo.codeDeviseOperation=n.devise.code;var t=[],r=n.listeFamilleParSens.map(function(e){return n.operationDiverseService.getAllTypesParFamilleSelectionne(e.COJOFA,e.YNOXCE)["catch"](function(e){return[]})});return n.$q.all(r).then(function(e){t=_.flatten(e),n.initialisationListeType(t)})})["finally"](function(){n.estEnChargement=!1})},n.prototype.initialisationListeType=function(e){var i=[];return i=this.operationDiverseService.getTypesFiltre(e,this.typeRattachementGuichetComptable,this.tableauDesRegroupements,this.montant,this.dateOperationJourneeComptable,this.devise.code,this.fonctionnalite.toString()),this.listeTypeOperationDiverse=this.operationDiverseService.getTypesPourAffichage(i),0===this.listeTypeOperationDiverse.length&&(this.segmentPrjo.libelleFamilleOD="",this.segmentPrjo.libelleTypeOD="",this.segmentPrjo.codeTransaction="",this.segmentPrjo.codeReferenceOD="",this.segmentPrjo.codeFamilleOD="",this.segmentPrjo.libelle2SaisiOD="",this.segmentPrjo.libelle1SaisiOD="",this.estOperationDiverseValide=!1),this.listeTypeOperationDiverse},n.prototype.initialisationDonneesVariables=function(){this.estEnChargement=!0,this.texteLibelleUlip06="",this.texteLibelleUlip07="",this.isSchemaComptableMutliple=!1,this.montantSchemaComptableMultiple=0,this.estForcageOperationFinanciere||(this.saisieLibelleUlip06="",this.saisieLibelleUlip07=""),this.messageErreurSaisieNumeroCommande=n.TEXTE_MESSAGE_ERREUR_SAISIE_NUM_COMMANDE_OD,this.messageErreurSaisieObligatoire=n.TEXTE_MESSAGE_ERREUR_SAISIE_OBLIGATOIRE_OD,this.isAfficherMessageSaisieObligatoireUlip06=!1,this.isAfficherMessageSaisieObligatoireUlip07=!1,this.isAfficherBlocSaisieLibelle=!1,this.isAfficherLibelleNumerique=!1,this.estOperationDiverseValide=!1,this.champRequisUlip06=!1,this.champRequisUlip07=!1,this.verificationDesChampsRequis=!1,this.rice&&(this.rice=new MyWay.Model.Rice(this.rice.codeEtablissement?this.rice.codeEtablissement:"",this.rice.codeGuichet?this.rice.codeGuichet:null,this.rice.codeActiviteCompte?this.rice.codeActiviteCompte:"",this.rice.radical?this.rice.radical:"",this.rice.cleCompte?this.rice.cleCompte:"",this.rice.cleRice?this.rice.cleRice:"",this.rice.riceNonExistant?this.rice.riceNonExistant:null,this.rice.$valid?this.rice.$valid:null,this.rice.erreurBloquante?this.rice.erreurBloquante:null))},n.prototype.selectionOD=function(){if(this.estForcageOperationFinanciere||(this.saisieLibelleUlip06="",this.saisieLibelleUlip07=""),this.segmentPrjo&&(this.segmentPrjo.montantOperation=this.montant),this.familleOdChoix=new MyWay.Model.FamilleOperationDiverse,this.familleOdChoix=_.find(this.listeFamilleParSens,{COJOFA:this.typeOdChoix.COJOFA}),this.libelleCodeFamille=this.familleOdChoix.COJOFA,this.libelleFamille=this.familleOdChoix.ULIWFO,this.isAfficherBlocSaisieLibelle=!0,this.isAfficherMessageSaisieObligatoireUlip06=!1,this.isAfficherMessageSaisieObligatoireUlip07=!1,this.champRequisUlip06=!1,this.champRequisUlip07=!1,this.verificationDesChampsRequis=!1,this.isSchemaComptableMutliple="O"===this.typeOdChoix.COJCSC&&this.typeOdChoix.TXERVA&&""!==this.typeOdChoix.TXERVA?!0:!1,this.isSchemaComptableMutliple){var e=Number((+this.typeOdChoix.TXERVA/1e4).toFixed(2));this.montantTaux=e.toFixed(2);var n=Number((Math.round(this.ancienMontantOpeFi*(e/100)*100)/100).toFixed(2));this.montantTVA=this.familleOdChoix.MTJOTV=n.toFixed(2),this.montantHorsTaxe=this.familleOdChoix.MTJOHT=(this.ancienMontantOpeFi-n).toFixed(2),this.comjtc=this.familleOdChoix.COMJTC="02"}this.libelleCodeType=this.typeOdChoix.COJXHD,this.libelleType=this.typeOdChoix.ULIWOD,this.codeIdentificationRequete=this.typeOdChoix.IDSEQ3,this.texteLibelleUlip06=this.typeOdChoix.LIJMTI,this.texteLibelleUlip07=this.typeOdChoix.LIJMOB,this.indicateurZoneTiers=this.typeOdChoix.CIJMTI,this.indicateurZoneObjet=this.typeOdChoix.CIJMOB,this.libelleCodeType===i.OperationDiverseController.CODE_TYPE_OD_ICCC?this.isAfficherLibelleNumerique=!0:this.isAfficherLibelleNumerique=!1,this.validationOperationDiverse(),this.listeOperationDiverse=new MyWay.Model.OperationDiverse(this.familleOdChoix,this.typeOdChoix)},n.prototype.validationOperationDiverse=function(){this.indicateurZoneTiers===n.INDICATEUR_ZONE_OBJET_A_O_OD&&""===this.saisieLibelleUlip06?this.isAfficherMessageSaisieObligatoireUlip06=!0:""!==this.saisieLibelleUlip06&&(this.isAfficherMessageSaisieObligatoireUlip06=!1),this.indicateurZoneObjet===n.INDICATEUR_ZONE_OBJET_A_O_OD&&""===this.saisieLibelleUlip07?this.isAfficherMessageSaisieObligatoireUlip07=!0:""!==this.saisieLibelleUlip07&&(this.isAfficherMessageSaisieObligatoireUlip07=!1),this.isAfficherMessageSaisieObligatoireUlip07||this.isAfficherMessageSaisieObligatoireUlip06?this.estOperationDiverseValide=!1:this.estOperationDiverseValide=!0,this.segmentPrjo.libelleFamilleOD=this.libelleFamille,this.segmentPrjo.libelleTypeOD=this.libelleType,this.segmentPrjo.codeTransaction=this.codeIdentificationRequete,this.segmentPrjo.codeReferenceOD=this.libelleCodeType,this.segmentPrjo.codeFamilleOD=this.libelleCodeFamille,this.segmentPrjo.libelle1SaisiOD=this.libelleCodeType===i.OperationDiverseController.CODE_TYPE_OD_ICCC?_.padLeft(this.saisieLibelleUlip06,32,"0"):this.saisieLibelleUlip06,this.segmentPrjo.libelle2SaisiOD=this.saisieLibelleUlip07,this.listeOperationDiverse=new MyWay.Model.OperationDiverse(this.familleOdChoix,this.typeOdChoix),this.verificationDesChampsRequis||(this.champRequisUlip07=this.indicateurZoneObjet===n.INDICATEUR_ZONE_OBJET_A_O_OD?!0:!1,this.champRequisUlip06=this.indicateurZoneTiers===n.INDICATEUR_ZONE_OBJET_A_O_OD?!0:!1),this.$scope.$emit("mwsfOperation_Diverse",this.listeOperationDiverse)},n.prototype.initialisationFamilles=function(){var e=this,n=this.$q.defer();return this.listeTypeOperationDiverse=[],this.isAfficherBlocSaisieLibelle=!1,this.operationDiverseService.getParametresComptables().then(function(n){return n?(e.codeInterneRattachementGuichetComptable=n[i.Constantes.ParametresComptables.EDS_INTERNE_RATTACHEMENT_GUICHET_COMPTABLE],e.typeRattachementGuichetComptable=n[i.Constantes.ParametresComptables.EDS_TYPE_RATTACHEMENT_GUICHET_COMPTABLE],e.codeGuichetInterbancaire=n[i.Constantes.ParametresComptables.CODE_GUICHET_INTERBANCAIRE],e.dateOperationJourneeComptable=n[i.Constantes.ParametresComptables.DATE_OPERATION_JOURNEE_COMPTABLE]):e.dateOperationJourneeComptable=moment().format(i.OperationDiverseController.FORMAT_DATE_JOURNEE_COMPTABLE),e.operationDiverseService.getAllCodeRegroupement(e.codeInterneRattachementGuichetComptable,e.codeGuichetInterbancaire)}).then(function(i){return e.tableauDesRegroupements=i,e.operationDiverseService.getFamillesFiltre(e.codeInterneRattachementGuichetComptable,e.codeGuichetInterbancaire,e.typeRattachementGuichetComptable,e.montant)}).then(function(i){return e.listeFamilleParSens=i,n.resolve(),n.promise})},n.$inject=["$scope","operationDiverseService","$q"],n.INDICATEUR_ZONE_OBJET_A_O_OD="O",
n.TEXTE_MESSAGE_ERREUR_SAISIE_OBLIGATOIRE_OD="Saisie obligatoire",n.TEXTE_MESSAGE_ERREUR_SAISIE_NUM_COMMANDE_OD="Saisie obligatoire du numéro de commande",n}();i.OperationDiverseListeController=n,i.module.controller("OperationDiverseListeController",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/operation-diverse-liste/operation-diverse-liste-view.html",scope:{montant:"=",listeOperationDiverse:"=",fonctionnalite:"=",rice:"=",devise:"=",segmentPrjo:"=",estOperationDiverseValide:"="},controller:"OperationDiverseListeController",controllerAs:"ctrl",bindToController:!0,link:function(e,i,n){}}}e.mwsfOperationDiverseListe=i,e.module.directive("mwsfOperationDiverseListe",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i,n,t,r,o,a,s){var c=this;if(this.$scope=e,this.serviceAgentExtended=i,this.montantDepose=n,this.$modalInstance=t,this.data=r,this.chequesSaisis=o,this.modalService=a,this.$timeout=s,this.chequesSaisis){this.focus=[],this.visibles=[],this.cheques=this.chequesSaisis,this.cheques.length>2&&(this.deuxMontantsSaisis=!0);for(var l=0;l<this.cheques.length+1;l++)this.visibles.push(!0);for(var l=this.cheques.length;25>l;l++)this.cheques.push(new MyWay.Model.MontantDevise(null,this.montantDepose.codeDevise)),l>this.cheques.length&&(this.focus.push(!1),this.visibles.push(!1))}else this.reinitialiser();this.$scope.$watch(function(){return c.total},function(e,i){if(i!==e){var n=void 0;e&&(n=Math.round(100*e)/100),c.montantTotal=new MyWay.Model.MontantDevise(n,c.montantDepose.codeDevise)}})}return e.prototype.calculTotal=function(){var e=this;return this.total=0,angular.forEach(this.cheques,function(i){e.total+=Math.round(100*i.montant)/100}),this.total=Math.round(100*this.total)/100,this.total},e.prototype.valider=function(){var e=this;if(this.total&&(this.total=Math.round(100*this.total)/100),this.total!==this.montantDepose.montant)if(this.montantDepose.montant){var i={actionButtonText:"Confirmer",closeButtonText:"Annuler",headerText:"Confirmer le montant de l'opération de dépôt de chèques",bodyText:"<div class='montant-operation'>Montant de l'opération : "+this.total+" "+this.montantDepose.devise.symboleDevise+"</div><br/><br/>Le montant déposé saisi initialement ("+this.montantDepose.montant+" "+this.montantDepose.devise.symboleDevise+") est différent du montant total calculé des chèques ("+this.total+" "+this.montantDepose.devise.symboleDevise+").<br/>Le montant déposé sera remplacé par le montant total des chèques pour cette opération. <br/> <br/>",iconName:"",size:"lg"};this.modalService.showConfirm(i).then(function(i){e.montantDepose.montant=e.total,e.$modalInstance.close(e.supprimerMontantsVides())})}else this.montantDepose.montant=this.total,this.$modalInstance.close(this.supprimerMontantsVides());else this.$modalInstance.close(this.supprimerMontantsVides())},e.prototype.reinitialiser=function(){this.focus=[],this.visibles=[],this.cheques=[],this.deuxMontantsSaisis=!1;for(var e=0;25>e;e++)this.cheques.push(new MyWay.Model.MontantDevise(null,this.montantDepose.codeDevise)),this.focus.push(!1),this.visibles.push(!1);this.visibles[0]=!0,this.visibles[1]=!0,this.focus[0]=!0},e.prototype.annuler=function(){this.$modalInstance.close(this.chequesSaisis)},e.prototype.supprimerMontantsVides=function(){var e=[];return angular.forEach(this.cheques,function(i){i.montant&&i.montant>0&&e.push(i)}),e},e.prototype.donneFocusAuMontantSuivant=function(e){for(var i=0;5>i;i++)this.focus[i]=!1;e>0&&24>e&&(this.focus[e+1]=!0,this.visibles[e+1]=!0)},e.prototype.afficheMontantSuivant=function(e){e>0&&24>e&&(this.visibles[e+1]=!0)},e.prototype.actionEntree=function(e){var i=this;this.focus[e]=!1,0===e?this.focus[e+1]=!0:this.focus[e-1]=!0,this.$timeout(function(){i.valider()},250)},e.prototype.getConditionAffichageMontants=function(e){return e>1?this.visibles[e]&&this.focus[e]&&this.cheques[e-1].montant||this.visibles[e]&&!this.focus[e]&&(this.cheques[e-2].montant||this.cheques[e-1].montant)?!0:!1:!0},e.$inject=["$scope","serviceAgentExtended","montantDepose","$modalInstance","data","chequesSaisis","modalService","$timeout"],e}();e.PlusieursChequesController=i,e.module.controller("PlusieursChequesController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/plusieurs-cheques/plusieurs-cheques-view.html",scope:{montantDepose:"=montantDepose",ngModel:"=ngModel"},controller:"PlusieursChequesController",controllerAs:"ctrl",bindToController:!0,link:function(e,i,n){if(!("ngModel"in n))throw new Error('ng-model est un paramètre obligatoire.   ==> <  mwsf-plusieurs-cheques montant-depose="myObject" data-ng-model="myObject" >\n');if(!("montantDepose"in n))throw new Error('parametre est un paramètre obligatoire.   ==> <  mwsf-plusieurs-cheques  montant-depose="myObject" data-ng-model="myObject" >\n')}}}e.mwsfPlusieursCheques=i,e.module.directive("mwsfPlusieursCheques",i),e.module.directive("ngEnter",function(){return function(e,i,n){i.bind("keydown keypress",function(i){13===i.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),i.preventDefault())})}}),e.module.directive("ngTab",function(){return function(e,i,n){i.bind("keydown keypress",function(i){9===i.which&&e.$apply(function(){e.$eval(n.ngTab)})})}})}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i){this.serviceAgentExtended=e,this.modalService=i}return e.prototype.ouvrirPlusieursCheques=function(e,i){var n={closeButtonText:"Annuler",actionButtonText:"Valider",headerText:"Plusieurs chèques",iconName:"",bodyText:""},t={templateUrl:"typescript/plusieurs-cheques/plusieurs-cheques-view.html",controller:"PlusieursChequesController",controllerAs:"ctrl",windowClass:"app-modal-window-MEG",backdrop:!1,keyboard:!0,size:"md",resolve:{montantDepose:function(){return e},chequesSaisis:function(){return i},data:function(){return n}}};return this.modalService.showModal(t).then(function(e){return e})},e.$inject=["serviceAgentExtended","modalService"],e}();e.PlusieursChequesService=i,e.module.service("plusieursChequesService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(t,r,o){var a=this;this.$scope=t,this.$q=r,this.saisieReferenceEnveloppeService=o,this.referenceEnveloppe=new e.comOpesFinancieres.Model.ReferenceEnveloppe(!1,""),this.isNumeroEnveloppeVisible=!0,this.texteMessageConfirmation=n.MESSAGE_CONFIRMATION_REFERENCE_ENVELOPPE,this.recuperationHabilitation(),t.$on("mode_financier_changed",function(e,n){a.modeFinancier=n,a.isVisible=a.afficherOuNonReference(a.modeFinancier),!n||n!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&n!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS||angular.isDefined(a.referenceEnveloppe.numeroReferenceEnveloppe)&&a.affinerNumeroEnveloppe(a.referenceEnveloppe.numeroReferenceEnveloppe)}),t.$on("mwsfRefEnveloppe_forcage_opefi",function(e,i,n){a.referenceEnveloppe=i,a.recuperationHabilitation(),a.modeFinancier=n,a.isVisible=a.afficherOuNonReference(a.modeFinancier)})}return n.prototype.clicCaseACocherRefEnveloppe=function(){this.referenceEnveloppe.isCocher?(this.isNumeroEnveloppeVisible=!1,this.isAfficherMessage=!0,this.referenceEnveloppe.numeroReferenceEnveloppe=""):(this.isNumeroEnveloppeVisible=!0,this.isAfficherMessage=!1)},n.prototype.recuperationHabilitation=function(){var e=this;this.saisieReferenceEnveloppeService.estHabilite().then(function(i){e.isHabilitationSHJE05=i[0],e.isHabilitationSHJE06=i[1],e.isHabilitationSHJE07=i[2]})},n.prototype.afficherOuNonReference=function(e){var n=!1;return e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES?this.isHabilitationSHJE07?n=!1:this.isHabilitationSHJE05||this.isHabilitationSHJE06||this.isHabilitationSHJE07?(this.isHabilitationSHJE05&&(this.isDesactiverCochage=!0,this.isNumeroEnveloppeSaisit=!1,this.referenceEnveloppe.isCocher=!0,n=!0),this.isHabilitationSHJE06&&(this.referenceEnveloppe.isCocher=!0,this.isDesactiverCochage=!1,n=!0)):(this.isDesactiverCochage=!0,this.isNumeroEnveloppeSaisit=!1,this.referenceEnveloppe.isCocher=!0,n=!0):e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&(this.referenceEnveloppe.isCocher=!0,this.isDesactiverCochage=!0,this.isNumeroEnveloppeSaisit=!1,n=!0),n},n.prototype.affinerNumeroEnveloppe=function(e){angular.isDefined(e)&&""!==e&&e!==i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING?(this.isNumeroEnveloppeSaisit=!0,this.referenceEnveloppe.numeroReferenceEnveloppe=_.padLeft(String(e),n.MAX_NOMBRE_REFERENCE_ENVELOPPE,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)):(this.referenceEnveloppe.numeroReferenceEnveloppe="",this.isNumeroEnveloppeSaisit=!1)},n.$inject=["$scope","$q","saisieReferenceEnveloppeService"],n.MAX_NOMBRE_REFERENCE_ENVELOPPE=10,n.MESSAGE_CONFIRMATION_REFERENCE_ENVELOPPE="Etes-vous sûr qu'il ne s'agit pas d'un dépôt sous enveloppe/sac ? Dans ce cas, vous devez cocher la case ref env/sac et saisir la référence de l'enveloppe/sac",n}();i.SaisirReferenceEnveloppeControleur=n,i.module.controller("SaisirReferenceEnveloppeControleur",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/reference-enveloppe/saisie-reference-enveloppe-view.html",scope:{referenceEnveloppe:"=",setFocus:"=",modeFinancier:"="},controller:"SaisirReferenceEnveloppeControleur",controllerAs:"viewModelReferenceEnveloppeCtrl",bindToController:!0,link:function(e,i,n){if(!("setFocus"in n))throw new Error('setFocus est un paramètre obligatoire.   ==> < mwsf-saisie-reference-enveloppe set-focus="true or false" >\n')}}}e.mwsfSaisieReferenceEnveloppe=i,e.module.directive("mwsfSaisieReferenceEnveloppe",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(e,i){this.$q=e,this.serviceAgentExtended=i}return i.prototype.estHabilite=function(){return this.serviceAgentExtended.Habilitation.EstHabilite([e.Constantes.CodeHabilitation.CODE_HABILITATION_SHJE05,e.Constantes.CodeHabilitation.CODE_HABILITATION_SHJE06,e.Constantes.CodeHabilitation.CODE_HABILITATION_SHJE07]).then(function(e){return e})},i.$inject=["$q","serviceAgentExtended"],i}();e.SaisieReferenceEnveloppeService=i,e.module.service("saisieReferenceEnveloppeService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(t,r,o){var a=this;this.$scope=t,this.$q=r,this.saisieReferenceEnveloppeService=o,angular.isDefined(this.referenceEnveloppe)?this.miseAJourSac():this.referenceEnveloppe=new e.comOpesFinancieres.Model.ReferenceEnveloppe(!1,""),this.isNumeroEnveloppeVisible=!0,this.texteMessageConfirmation=n.MESSAGE_CONFIRMATION_REFERENCE_ENVELOPPE,this.recuperationHabilitation().then(function(){a.isVisible=a.afficherOuNonReference(a.modeFinancier)}),t.$on("mode_financier_changed",function(n,t){a.modeFinancier=t,a.isVisible=a.afficherOuNonReference(a.modeFinancier),a.isVisible||(a.referenceEnveloppe=new e.comOpesFinancieres.Model.ReferenceEnveloppe(!1,"")),!t||t!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&t!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS||angular.isDefined(a.referenceEnveloppe.numeroReferenceEnveloppe)&&a.affinerNumeroEnveloppe()}),t.$on("mwsfRefEnveloppe_forcage_opefi",function(e,i,n){a.referenceEnveloppe=i,a.recuperationHabilitation(),a.modeFinancier=n,a.isVisible=a.afficherOuNonReference(a.modeFinancier)})}return n.prototype.recuperationHabilitation=function(){var e=this;return this.saisieReferenceEnveloppeService.estHabilite().then(function(i){return e.isHabilitationSHJE05=i[0],e.isHabilitationSHJE06=i[1],e.isHabilitationSHJE07=i[2],!0})},n.prototype.miseAJourSac=function(){angular.isDefined(this.numeroReferenceEnveloppeSaisie)&&(this.referenceEnveloppe.numeroReferenceEnveloppe=this.numeroReferenceEnveloppeSaisie),this.affinerNumeroEnveloppe(),this.numeroReferenceEnveloppeSaisie=this.referenceEnveloppe.numeroReferenceEnveloppe},n.prototype.afficherOuNonReference=function(e){var n=!1;return e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES?!this.fonctionnalite||this.fonctionnalite!==MyWay.Model.Fonctionnalite.OPERATION_RETRAIT&&this.fonctionnalite!==MyWay.Model.Fonctionnalite.OPERATION_RETRAIT_DEVISE&&this.fonctionnalite!==MyWay.Model.Fonctionnalite.OPERATION_RETRAIT_HORS_CLIENTELE&&this.fonctionnalite!==MyWay.Model.Fonctionnalite.OPERATION_RETRAIT_OAD?this.isHabilitationSHJE07?n=!1:this.isHabilitationSHJE06||this.isHabilitationSHJE07?(this.isHabilitationSHJE05&&(this.afficherMessageErreurReferenceSac=!0),this.isHabilitationSHJE06&&(this.referenceEnveloppe.isCocher=!1,this.saisieReferenceSacObligatoire=!1,this.isNumeroEnveloppeSaisit=!1,n=!0)):(this.saisieReferenceSacObligatoire=!0,this.isNumeroEnveloppeSaisit=!1,this.referenceEnveloppe.isCocher=!0,n=!0):n=!1:e===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&(this.referenceEnveloppe.isCocher=!0,this.saisieReferenceSacObligatoire=!0,this.isNumeroEnveloppeSaisit=!1,n=!0),n},n.prototype.modificationNumeroEnveloppe=function(){/^\d+$/.test(this.referenceEnveloppe.numeroReferenceEnveloppe)?this.referenceEnveloppe.numeroReferenceEnveloppe=this.referenceEnveloppe.numeroReferenceEnveloppe:this.referenceEnveloppe.numeroReferenceEnveloppe=this.referenceEnveloppe.numeroReferenceEnveloppe.replace(new RegExp("\\D","g"),""),null!=this.referenceEnveloppe.numeroReferenceEnveloppe&&this.referenceEnveloppe.numeroReferenceEnveloppe.length>10&&(this.referenceEnveloppe.numeroReferenceEnveloppe=this.referenceEnveloppe.numeroReferenceEnveloppe.substring(0,10))},n.prototype.affinerNumeroEnveloppe=function(){null!=this.referenceEnveloppe.numeroReferenceEnveloppe&&""!==this.referenceEnveloppe.numeroReferenceEnveloppe&&this.referenceEnveloppe.numeroReferenceEnveloppe!==i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING?(this.isNumeroEnveloppeSaisit=!0,this.referenceEnveloppe.numeroReferenceEnveloppe=_.padLeft(String(this.referenceEnveloppe.numeroReferenceEnveloppe),i.SaisirReferenceEnveloppeControleur.MAX_NOMBRE_REFERENCE_ENVELOPPE,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)):(this.referenceEnveloppe.numeroReferenceEnveloppe="",this.isNumeroEnveloppeSaisit=!1)},n.$inject=["$scope","$q","referenceEnveloppeOperationService"],n.MAX_NOMBRE_REFERENCE_ENVELOPPE=10,n.MESSAGE_CONFIRMATION_REFERENCE_ENVELOPPE="Etes-vous sûr qu'il ne s'agit pas d'un dépôt en sac ? Si c'est le cas, vous devez saisir la référence du sac",n}();i.ReferenceEnveloppeOperationControleur=n,i.module.controller("referenceEnveloppeOperationControleur",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/reference-enveloppe-operation/reference-enveloppe-operation-view.html",scope:{referenceEnveloppe:"=",setFocus:"=",modeFinancier:"=",fonctionnalite:"=?"},controller:"referenceEnveloppeOperationControleur",controllerAs:"ctrl",bindToController:!0,link:function(e,i,n){if(!("setFocus"in n))throw new Error('setFocus est un paramètre obligatoire.   ==> < mwsf-reference-enveloppe-operation set-focus="true or false" >\n')}}}e.mwsfReferenceEnveloppeOperation=i,e.module.directive("mwsfReferenceEnveloppeOperation",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(e,i){this.$q=e,this.serviceAgentExtended=i}return i.prototype.estHabilite=function(){return this.serviceAgentExtended.Habilitation.EstHabilite([e.Constantes.CodeHabilitation.CODE_HABILITATION_SHJE05,e.Constantes.CodeHabilitation.CODE_HABILITATION_SHJE06,e.Constantes.CodeHabilitation.CODE_HABILITATION_SHJE07]).then(function(e){return e})},i.$inject=["$q","serviceAgentExtended"],i}();e.ReferenceEnveloppeOperationService=i,e.module.service("referenceEnveloppeOperationService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,i,n,t,r,o){var a=this;this.$scope=e,this.serviceAgentExtended=i,this.$modalInstance=n,this.data=t,this.parametre=r,this.modalService=o,this.parametre.repartitionMemorisee&&(this.donnees=this.parametre.repartitionMemorisee,this.afficheRice2=!1,this.afficheRice3=!1,this.afficheRice2SiRepartitionMemorisee(),this.afficheRice3SiRepartitionMemorisee()),this.initData(),this.$scope.$watch(function(){return a.parametre.montantTotal.montant},function(e,i){e&&a.verifieChampsSaisisModeRepartition()}),this.$scope.$watch(function(){return a.differenceRepartition},function(e,i){a.verifieChampsSaisisModeRepartition()}),this.$scope.$watch(function(){return a.donnees.rice2&&a.donnees.rice2.cleRice&&a.donnees.rice2.$valid},function(e,i){a.verifieChampsSaisisModeRepartition()}),this.$scope.$watch(function(){return a.donnees.rice3&&a.donnees.rice3.cleRice&&a.donnees.rice3.$valid},function(e,i){a.verifieChampsSaisisModeRepartition()}),this.$scope.$watch(function(){return a.donnees.compteCredite2},function(e,i){e&&e.itemBottomSelectionne&&i!==e&&(a.donnees.rice2.clear(),a.verifieChampsSaisisModeRepartition())}),this.$scope.$watch(function(){return a.donnees.compteCredite3},function(e,i){e&&e.itemBottomSelectionne&&i!==e&&(a.donnees.rice3.clear(),a.verifieChampsSaisisModeRepartition())})}return n.prototype.changementLibelleRepartition=function(){this.verifieChampsSaisisModeRepartition()},n.prototype.verifieChampsSaisisModeRepartition=function(){this.differenceRepartition||0!==this.differenceRepartition?this.donnees.isValid=!1:this.donnees.getIsValid()},n.prototype.initData=function(){var n=this;if(this.donnees||(this.donnees=new e.comOpesFinancieres.Model.Repartition),!this.parametre||this.parametre&&(!this.parametre.montantTotal||!this.parametre.parametreListeComptes))throw new MyWay.Services.Erreur("Veuillez renseigner les propriétés MontantTotal et ParametreListeComptes");if(this.donnees.libelle1=this.donnees.libelle1?this.donnees.libelle1:i.Constantes.OperationFinanciere.LIBELLE_DEFAUT_CHEQUE_BANQUE,this.donnees.libelle2=this.donnees.libelle2?this.donnees.libelle2:i.Constantes.OperationFinanciere.LIBELLE_DEFAUT_CHEQUE_BANQUE,this.donnees.libelle3=this.donnees.libelle3?this.donnees.libelle3:i.Constantes.OperationFinanciere.LIBELLE_DEFAUT_CHEQUE_BANQUE,this.donnees.montantDevise1=this.donnees.montantDevise1?this.donnees.montantDevise1:new MyWay.Model.MontantDevise(null,this.parametre.montantTotal.codeDevise),this.donnees.montantDevise2=this.donnees.montantDevise2?this.donnees.montantDevise2:new MyWay.Model.MontantDevise(null,this.parametre.montantTotal.codeDevise),this.donnees.montantDevise3=this.donnees.montantDevise3?this.donnees.montantDevise3:new MyWay.Model.MontantDevise(null,this.parametre.montantTotal.codeDevise),this.max=999999999,this.parametre.iban&&!this.parametre.rice&&(this.parametre.rice=this.convertIbanToRice()),this.parametre.parametreListeComptes.compteAEnlever||(this.parametre.parametreListeComptes.compteAEnlever=new MyWay.Model.Contrat,this.parametre.rice&&(this.parametre.parametreListeComptes.compteAEnlever.riceContrat=this.parametre.rice.formatRicePourStructureEchange())),this.parametre.parametreListeComptes.compteAEnlever&&""!==this.parametre.parametreListeComptes.compteAEnlever.riceContrat&&23===this.parametre.parametreListeComptes.compteAEnlever.riceContrat.length){var t=this.parametre.parametreListeComptes.compteAEnlever.riceContrat.substring(0,21);this.parametre.parametreListeComptes.compteAEnlever.riceContrat=t}this.parametreListeComptes2=angular.copy(this.parametre.parametreListeComptes),this.parametreListeComptes3=angular.copy(this.parametre.parametreListeComptes),this.parametre.rice?this.parametre.rice.codeEtablissement&&this.parametre.rice.codeGuichet?(this.donnees.rice2=this.donnees.rice2?this.donnees.rice2:new MyWay.Model.Rice(this.parametre.rice.codeEtablissement,this.parametre.rice.codeGuichet),this.donnees.rice3=this.donnees.rice3?this.donnees.rice3:new MyWay.Model.Rice(this.parametre.rice.codeEtablissement,this.parametre.rice.codeGuichet)):this.serviceAgentExtended.getAuthentificationInfo().then(function(e){n.serviceAgentExtended.getParametresComptables().then(function(i){n.parametre.rice=new MyWay.Model.Rice(e.codeEtablissement,i.codeGuichetInterbancaire),n.donnees.rice2=n.donnees.rice2?n.donnees.rice2:new MyWay.Model.Rice(e.codeEtablissement,i.codeGuichetInterbancaire),n.donnees.rice3=n.donnees.rice3?n.donnees.rice3:new MyWay.Model.Rice(e.codeEtablissement,i.codeGuichetInterbancaire)})}):this.serviceAgentExtended.getAuthentificationInfo().then(function(e){n.serviceAgentExtended.getParametresComptables().then(function(i){n.donnees.rice2=n.donnees.rice2?n.donnees.rice2:new MyWay.Model.Rice(e.codeEtablissement,i.codeGuichetInterbancaire),n.donnees.rice3=n.donnees.rice3?n.donnees.rice3:new MyWay.Model.Rice(e.codeEtablissement,i.codeGuichetInterbancaire)})})},n.prototype.onSelect2=function(){this.parametreListeComptes3.compteAEnlever=this.donnees.compteCredite2,this.donnees.rice2.clear(),this.verifieChampsSaisisModeRepartition()},n.prototype.onSelect3=function(){this.parametreListeComptes2.compteAEnlever=this.donnees.compteCredite3,this.donnees.rice3.clear(),this.verifieChampsSaisisModeRepartition()},n.prototype.convertIbanToRice=function(){var e=this.parametre.iban.substr(4,5),i=this.parametre.iban.substr(9,5),n=this.parametre.iban.substr(14,2),t=this.parametre.iban.substr(16,7),r=this.parametre.iban.substr(23,2),o=this.parametre.iban.substr(25,2);return new MyWay.Model.Rice(e,i,n,t,r,o)},n.prototype.valider=function(){!this.donnees.montantDevise2||this.donnees.montantDevise2.montant&&0!==this.donnees.montantDevise2.montant||(this.donnees.compteCredite2=null,this.donnees.rice2.clear(),this.donnees.libelle2=""),!this.donnees.montantDevise3||this.donnees.montantDevise3.montant&&0!==this.donnees.montantDevise3.montant||(this.donnees.compteCredite3=null,this.donnees.rice3.clear(),this.donnees.libelle3=""),this.$modalInstance.close(this.donnees)},n.prototype.afficheRice2SiRepartitionMemorisee=function(){this.parametre.repartitionMemorisee&&this.donnees.compteCredite2&&this.donnees.compteCredite2.itemBottomSelectionne===!0?this.afficheRice2=!0:this.afficheRice2=!1},n.prototype.afficheRice3SiRepartitionMemorisee=function(){this.parametre.repartitionMemorisee&&this.donnees.compteCredite3&&this.donnees.compteCredite3.itemBottomSelectionne===!0?this.afficheRice3=!0:this.afficheRice3=!1},n.prototype.getDifferenceRepartition=function(){this.differenceRepartition=0;var e=0,i=0;return this.parametre&&this.parametre.montantTotal&&this.parametre.montantTotal.montant&&(e=Math.round(100*this.parametre.montantTotal.montant)/100),this.montantTotalRepartition?(i=Math.round(100*this.montantTotalRepartition)/100,this.differenceRepartition=Math.round(100*(e-i))/100):this.differenceRepartition=e,this.verifieChampsSaisisModeRepartition(),this.differenceRepartition},n.prototype.getMontantTotalRepartition=function(){this.montantTotalRepartition=0;var e=0,i=0,n=0;return this.donnees&&(this.donnees.montantDevise1&&this.donnees.montantDevise1.montant&&(e=Math.round(100*this.donnees.montantDevise1.montant)/100),this.donnees.montantDevise2&&this.donnees.montantDevise2.montant&&(i=Math.round(100*this.donnees.montantDevise2.montant)/100),this.donnees.montantDevise3&&this.donnees.montantDevise3.montant&&(n=Math.round(100*this.donnees.montantDevise3.montant)/100),this.montantTotalRepartition=Math.round(100*(e+i+n))/100),this.verifieChampsSaisisModeRepartition(),this.montantTotalRepartition},n.$inject=["$scope","serviceAgentExtended","$modalInstance","data","parametre","modalService"],n}();i.RepartitionController=n,i.module.controller("RepartitionController",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i){this.serviceAgentExtended=e,this.modalService=i}return e.prototype.ouvrirRepartition=function(e){var i={closeButtonText:"Annuler",actionButtonText:"Valider",headerText:"Répartition",iconName:"",bodyText:""},n={templateUrl:"typescript/repartition/repartition-view.html",controller:"RepartitionController",controllerAs:"ctrl",windowClass:"app-modal-window-MEG",backdrop:!1,keyboard:!0,size:"full",resolve:{parametre:function(){return e},data:function(){return i}}};return this.modalService.showModal(n).then(function(e){return e})},e.$inject=["serviceAgentExtended","modalService"],e}();e.RepartitionService=i,e.module.service("repartitionService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(t,r,o,a,s,c,l,p,m,u,d,E,h,f,v,C,O,R,g,T){var F=this;this.$scope=t,this.serviceAgentExtended=r,this.operationFinanciereService=o,this.compteService=a,this.modeFinancierService=s,this.deviseService=c,this.modalService=l,this.interDomainCoreService=p,this.$q=m,this.repartitionService=u,this.plusieursChequesService=d,this.facturationAutomatiqueService=E,this.miniProfilService=h,this.carteTempoMultiFonctionsService=f,this.caisseAutoService=v,this.saisieRiceService=C,this.listeCompteService=O,this.champsErreursOpeFiService=R,this.libelleComplementaire2Service=g,this.operationFinanciereValueService=T,this.participantSelectionne=[],this.estLibelleOperationVide=!1,this.billetterieAutoPourBascule=!1,this.typeAffichageSolde=i.TypeAffichageSolde.ACTUEL,this.estTraitementMontantTermine=!0,this.estTraitementRiceTermine=!0,this.estTraitementRiceInterneTermine=!0,this.estTraitementListeCompteTermine=!0,this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_DEFAUT,this.montantPourOperationDiverseListe=1,this.carteTMFModeDepotActive=!1,this.carteTMFModeRetraitActive=!1,this.carteTMFModeRetraitOADActive=!1,this.afficherCaseCarteTMF=!1,this.carteTMFCochee=!1,this.habiliteChoixBilletterie=!0,this.choixBilletterieChecked=!1,this.loading=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1,this.afficherLibelleComplementaire2ParModeFinancier=!1,this.estObligatoireSaisieLibelleComplementaire2=!1,this.libelleVirementInterne=i.Constantes.OperationFinanciere.LIBELLE_VIREMENT_INTERNE_DEBITE_DEFAUT,this.authentificationInfo=void 0,this.afficheErreurChampMontant=!1,this.modeFinancierPrecedent=new MyWay.Model.ModeFinancier,this.initialisationInformationsComplementaires=!1,console.log("CONSTRUCTION ---> SaisieOperationFinanciereController",this.operationFinanciere),this.estTraitementTermineDeferred=this.$q.defer(),this.estTraitementTermine=this.$q.when(),this.modeFinancierObligatoire=!0,this.estPlacerFocusModeFinancierInitialisation=!1,this.modeFinancierDesactive=this.estModeFinancierDesactive?this.estModeFinancierDesactive:!1,this.operationFinanciere=this.checkMemoOperationFinanciere("saisie-operation-financiere-controller.ts => constructor => "),this.operationFinanciere&&this.operationFinanciere.signataire?this.participantSelectionne.push(this.operationFinanciere.signataire):this.participantSelectionne.push(new MyWay.Model.ParticipantInformationClient("","","","","","")),(null===this.niveauInterieurPanel||angular.isUndefined(this.niveauInterieurPanel))&&(this.niveauInterieurPanel=n.NIVEAU_DEFAUT_INTERIEUR_PANEL),(null===this.niveauPanelPrincipal||angular.isUndefined(this.niveauPanelPrincipal))&&(this.niveauPanelPrincipal=n.NIVEAU_DEFAUT_PANEL_PRINCIPAL),this.operationFinanciere&&(angular.isUndefined(this.operationFinanciere.titrePanelPrincipal)||null===this.operationFinanciere.titrePanelPrincipal)&&(this.operationFinanciere.titrePanelPrincipal=i.Constantes.OperationFinanciere.TITRE_PANEL_PRINCIPAL_DEFAUT),this.operationFinanciere&&this.operationFinanciere.compte&&this.operationFinanciere.compte.devise&&(angular.isUndefined(this.operationFinanciere.compte.devise.sigle)||null===this.operationFinanciere.compte.devise.sigle)&&this.deviseService.getDeviseByCode(this.operationFinanciere.compte.devise.code).then(function(e){F.operationFinanciere.compte.devise=e}),this.debounceChargerPlafondVersement=_.debounce(function(){F.verifierPlafondVersement()},800),this.serviceAgentExtended.getAuthentificationInfo().then(function(i){F.authentificationInfo=i,F.serviceAgentExtended.getParametresComptables().then(function(n){var t=new e.comOpesFinancieres.Model.ContexteSaisieOperationFinanciere;t.codeEtablissement=i.codeEtablissement,t.referenceExterneAgent=i.agentConnecte.referenceExterneAgent,t.edsExterneGuichetComptable=n.edsExterneGuichetComptable,t.edsExterneRattachementGuichetComptable=n.edsExterneRattachementGuichetComptable,t.dateOperationJourneeComptable=n.dateOperationJourneeComptable,t.libelleEdsRattachementGuichetComptable=n.libelleEdsRattachementGuichetComptable,t.numTelEdsRattachementguichetComptable=n.numTelEdsRattachementGuichetComptable,t.typeCA=n.typeCA,F.operationFinanciereService.getCaracteristiquesEDS(t.codeEtablissement,parseInt(n.edsExterneRattachementGuichetComptable),n.edsTypeRattachementGuichetComptable).then(function(e){var i=e&&e.infoEDS?e.infoEDS.ligne6.substring(6,e.infoEDS.ligne6.length):"";t.localiteEdsExterneGuichetComptable=i,F.operationFinanciere.contexteSaisieOperationFinanciere=t})["catch"](function(e){F.serviceAgentExtended.Trace.error("Problème de récupération des coordonnees EDS","getCoordonneesEDS",e)})})["catch"](function(e){F.serviceAgentExtended.Trace.error("Problème de récupération des paramètres comptables","getParametresComptables",e)})})["catch"](function(e){F.serviceAgentExtended.Trace.error("Problème de récupération des données d'authentification","getAuthentificationInfo",e)}).then(function(){F.traitementSpecifiqueDepotRetraitOpérationMultiple(),F.operationFinanciere&&F.operationFinanciere.libelleOperation&&F.operationFinanciere.estRepriseOffre&&(F.getLibelleOperationMemorise(),F.estModificationManuelleLibelleOperation=!1),F.initialisationInformationsComplementaires=!0,F.operationFinanciere&&F.operationFinanciere.modeFinancier&&F.operationFinanciere.modeFinancier.CTGXM1&&(F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS)&&F.calculPlafondVersementService(),F.determinerActivationBoutonValider()}),this.initialisationDonneesVariables(),this.typeRechercheCompte=i.Constantes.OperationFinanciere.TYPE_RECHERCHE_COMPTE_NUMERO_PERSONNE,this.montantDevise=new MyWay.Model.MontantDevise,this.montantDevise.codeDevise=this.operationFinanciere.compte.devise.code,MyWay.Services.StringUtils.startsWith(this.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_CLOTURE_COMPTE_MAJ)&&MyWay.Services.StringUtils.startsWith(this.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_CLOTURE_CDD_MAJ)||angular.isDefined(this.operationFinanciere.montant)&&null!==this.operationFinanciere.montant&&(this.montantDevise.montant=this.operationFinanciere.montant),this.GetCurrentProcessId().then(function(e){var n=e+"_"+i.Constantes.Segment.TEXTE_SEGMENTPRVRIO_MAJUSCULE+"_"+F.operationFinanciere.client.numeroPersonne,t=e+"_MODE_FINANCIER_"+F.operationFinanciere.client.numeroPersonne;return F.cleSegmentPrvRrio=n,F.cleModeFinancier=t,n}).then(function(e){return F.serviceAgentExtended.getFromContext(e).then(function(e){return e})}).then(function(e){return e=F.checkMemoSegmentPrvRio(e,"saisie-operation-financiere-controller.ts =>  constructor =>"),null!==e&&F.operationFinanciere.estForcageOperationFinanciere?(F.operationFinanciere.segmentPrvRio=e,F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,
F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,e).then(function(){F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts =>  constructor => segmentPrvRio présent => segmentPrvRio = ",JSON.stringify(e))}),void 0):F.serviceAgentExtended.Habilitation.EstHabilite(i.Constantes.CodeHabilitation.CODE_HABILITATION_SHJM25).then(function(e){MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_COMPTE_MAJ)||MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_CDD_MAJ)?F.initialisationOuvertureCompte(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_CDD_CCOOP)?F.initialisationOuvertureCompte(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_CLOTURE_COMPTE_MAJ)||MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_CLOTURE_CDD_MAJ)?F.initialisationClotureCompte(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_VERSEMENT_MAJ)?F.initialisationVersement(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_EPARGNE)?F.initialisationOuvertureEpargne(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_PEL)?F.initialisationOuverturePEL(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_CEL)?F.initialisationOuvertureCEL(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_COMPTE_CANTONNEMENT)?F.initialisationOuvertureCompteCantonnement(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_VAD)?F.initialisationOuvertureCompte(!1):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_DAT)?F.initialisationOuvertureCompteDat(!1):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_LIVRET_A)?F.initialisationOuvertureEpargne(!1):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_COMPTE_ATTENTE)?F.initialisationOuvertureEpargne(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_PEA)?F.initialisationOuverturePEA(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_EXTOURNE_OUVERTURE_PEA)?F.initialisationExtourneOuverturePEA(e):MyWay.Services.StringUtils.startsWith(F.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_EXTOURNE_CLOTURE_PEA)?F.initialisationExtourneCloturePEA(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT?F.initialisationOperationDepot(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT?F.initialisationOperationRetrait(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_HORS_CLIENTELE?F.initialisationOperationDepot(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE?F.initialisationOperationRetrait(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_COMPTE_88?F.initialisationOperationDepot(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_COMPTE_88?F.initialisationOperationRetrait(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_HORS_CLIENTELE_COMPTE_88?F.initialisationOperationDepot(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE_COMPTE_88?F.initialisationOperationRetrait(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_OAD?F.initialisationOperationDepotOAD(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_OAD?F.initialisationOperationRetraitOAD(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_DEVISE?F.initialisationOperationDepot(e):F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_DEVISE?F.initialisationOperationRetrait(e):F.serviceAgentExtended.Trace.error("saisie-operation-financiere-controller.ts =>  constructor => PAS DE BRANCHE => this.operationFinanciere = "+JSON.stringify(F.operationFinanciere)),F.operationFinanciereValueService.operationFinanciere=F.operationFinanciere})["catch"](function(e){F.serviceAgentExtended.Trace.warning(i.Constantes.OperationFinanciere.MESSAGE_ERREUR_UTILISATEUR_HABILITATION_SHJM25,"habilitationSHJM25",e)})}),this.interDomainCoreService.isApplicationBascule(i.Constantes.OperationFinanciere.CODE_APPLICATION_BILLETTERIE_AUTO).then(function(e){F.billetterieAutoPourBascule=e}),this.traitementSpecifiqueDepotRetrait(),this.traitementSpecifiqueCloture(),this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT?(this.loading=!0,this.carteTempoMultiFonctionsService.initCarteTMFService(i.CarteTMF.ModeTMF.DEPOT_TMF,this.operationFinanciere.compte?this.operationFinanciere.compte.rice:null,Number(this.operationFinanciere.client.numeroPersonne))["finally"](function(){F.carteTMFModeDepotActive=!0,F.loading=!1})):this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT?(this.loading=!0,this.carteTempoMultiFonctionsService.initCarteTMFService(i.CarteTMF.ModeTMF.RETRAIT_TMF,this.operationFinanciere.compte?this.operationFinanciere.compte.rice:null,Number(this.operationFinanciere.client.numeroPersonne))["finally"](function(){F.carteTMFModeRetraitActive=!0,F.loading=!1})):this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_OAD&&(this.loading=!0,this.carteTempoMultiFonctionsService.initCarteTMFService(i.CarteTMF.ModeTMF.RETRAIT_OAD_TMF,this.operationFinanciere.compte?this.operationFinanciere.compte.rice:null)["finally"](function(){F.carteTMFModeRetraitOADActive=!0,F.forceRetraitOADTMF()&&(F.carteTMFCochee=!0),F.loading=!1})),this.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts =>  constructor =>CodeHabilitation.CODE_HABILITATION_SHKG18 = ",i.Constantes.CodeHabilitation.CODE_HABILITATION_SHKG18),this.serviceAgentExtended.Habilitation.EstHabilite(i.Constantes.CodeHabilitation.CODE_HABILITATION_SHKG18).then(function(e){F.habiliteChoixBilletterie=!e}),t.$watch(function(){return F.montantDevise.montant},function(e,n){e!==n&&(F.operationFinanciere.montant=F.montantDevise.montant,F.montantDevise.montant&&(F.montantPourOperationDiverseListe=F.montantDevise.montant),F.determinerActivationBoutonValider(),F.estTraitementMontantTermine=!1,F.estTraitementTermineDeferred=F.$q.defer(),F.estTraitementTermine=F.estTraitementTermineDeferred.promise,F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(r){if(F.estUneOuverture04VPC()&&F.operationFinanciere.segmentPrvRio&&(r.modeFinancierChoisi=F.operationFinanciere.segmentPrvRio.modeFinancierChoisi,r.modeFinancierNumerique=F.operationFinanciere.segmentPrvRio.modeFinancierNumerique),r=F.checkMemoSegmentPrvRio(r,"saisie-operation-financiere-controller.ts => $watch(() => this.montantDevise.montant => "),angular.isDefined(r)&&null!==r&&(r.montantGlobalOperation=e),e!==n&&F.operationFinanciere&&(F.verifierPlafondVersement(),F.operationFinanciere.plafondVersement.estAfficherPopupPlafondVersement=!1),F.debounceChargerPlafondVersement(),t.$broadcast("montant_changed",e),t.$emit("montant_changed_emit_opefi",e),F.afficherVracParModeFinancier&&t.$broadcast("montant_changed_tarification_vrac",e),F.afficherFacturationAutomatiqueParModeFinancier&&t.$broadcast("montant_changed_tarification_facturation_automatique",e),F.operationFinanciere.segmentPrvRio=r,F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=r,F.operationFinanciere.montant=e,F.operationFinanciereValueService.operationFinanciere.montant=e,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio),angular.isDefined(F.operationFinanciere.modeFinancier)){if(F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&null!=e?(F.afficherOperationDiverse=!0,t.$broadcast("est_operation_diverse_opefi",F.afficherOperationDiverse),F.estMontantVidePourOd=!1,F.operationFinanciere&&F.operationFinanciere.operationDiverse&&t.$broadcast("mwsfOperationDiverse_forcage_opefi",F.operationFinanciere.operationDiverse,F.operationFinanciere.segmentPrjo)):(F.afficherOperationDiverse=!1,t.$broadcast("est_operation_diverse_opefi",F.afficherOperationDiverse),F.estMontantVidePourOd=!0,F.operationFinanciere&&F.operationFinanciere.operationDiverse&&t.$broadcast("mwsfOperationDiverse_forcage_opefi",F.operationFinanciere.operationDiverse,F.operationFinanciere.segmentPrjo)),F.operationFinanciere.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&(F.estMontantVidePourOd=!1),null!=F.operationFinanciere.soldeCompteAvantVirement&&F.operationFinanciere.soldeCompteAvantVirement!==i.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER){F.operationFinanciere.nouveauSoldeCompteVirementApresVirement=Math.round(100*(F.operationFinanciere.soldeCompteAvantVirement-e))/100,F.operationFinanciereValueService.operationFinanciere.nouveauSoldeCompteVirementApresVirement=F.operationFinanciere.nouveauSoldeCompteVirementApresVirement;var o=i.Constantes.OperationFinanciere.TEXTE_NOUVEAU_SOLDE_APRES_VIREMENT_INTERNE+F.operationFinanciere.nouveauSoldeCompteVirementApresVirement;F.serviceAgentExtended.Trace.debug(o)}F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&t.$broadcast("montant_changed_type_cheque",e),(F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS||F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES)&&(F.operationFinanciere.segmentPrjo.montantOperation=e,F.operationFinanciereValueService.operationFinanciere.segmentPrjo.montantOperation=e)}F.estTraitementMontantTermine=!0,F.verifieEstTraitementTermine()}),e>0?angular.isDefined(F.operationFinanciere.modeFinancier)&&(F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES?F.operationFinanciere.billetterieOuvertParDefaut=!1:F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&(F.operationFinanciere.billetterieOuvertParDefaut=F.billetterieAutoPourBascule)):null===e?F.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1:(F.operationFinanciere.billetterieOuvertParDefaut=!1,F.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1),e>0&&F.estVersement&&F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&(F.loading=!0,F.serviceAgentExtended.Context.GetAuthentificationInfo().then(function(e){F.caisseAutoService.deposerEspeces(e.agentConnecte.referenceExterneAgent,F.operationFinanciere.client.numeroPersonne,F.montantDevise.montant).then(function(e){0!==e&&(F.montantDevise.montant=e/100,F.montantDesactive=!0,F.modeFinancierDesactive=!0,F.afficherCaseCarteTMF=!1)})["finally"](function(){F.loading=!1})})),F.operationFinanciereValueService.operationFinanciere=F.operationFinanciere,F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => $scope.$watch(() => this.montantDevise.montant modifié => this.operationFinanciere = ",JSON.stringify(F.operationFinanciere)),F.serviceAgentExtended.addToContext(F.cleModeFinancier,F.operationFinanciere.modeFinancier).then(function(){F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts =>$scope.$watch(() => this.montantDevise.montant => this.operationFinanciere.modeFinancier Ajouté au contexte : ",JSON.stringify(F.operationFinanciere.modeFinancier))}))}),t.$watch(function(){return F.operationFinanciere.modeFinancier},function(n,r){F.authentificationInfo&&(n&&!angular.equals(n,r)?(F.determinerActivationBoutonValider(),F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(o){if(o=F.checkMemoSegmentPrvRio(o,"saisie-operation-financiere-controller.ts => $watch(() => this.operationFinanciere.modeFinancier => "),angular.isDefined(o)&&null!==o){if(o.modeFinancierNumerique=n.CTGXM1,o.modeFinancierChoisi=n.CTGXMF,o.codePrestationTarifaire="",F.operationFinanciere&&F.operationFinanciere.repartition&&(F.operationFinanciere.repartition=null),F.operationFinanciere&&F.operationFinanciere.plusieursCheques&&(F.operationFinanciere.plusieursCheques=null),F.operationFinanciere&&F.operationFinanciere.facturationPrestation&&n&&n.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&(F.operationFinanciere.facturationPrestation=null),angular.isUndefined(F.operationFinanciere.montant)?o.montantGlobalOperation=0:(o.montantGlobalOperation=F.operationFinanciere.montant,F.verifierPlafondVersement(),F.operationFinanciere.montant>0&&(n&&n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES?F.operationFinanciere.billetterieOuvertParDefaut=!0:n&&n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&(F.operationFinanciere.billetterieOuvertParDefaut=F.billetterieAutoPourBascule))),F.operationFinanciere.segmentPrvRio=o,F.operationFinanciere.estForcageOperationFinanciere||((angular.isUndefined(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)||null==F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)&&(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR=[new e.comOpesFinancieres.Model.SegmentPRVRIOUGR]),F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte="",F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement="",F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].montantVirement=0),n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES||n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS?F.operationFinanciere.segmentPrvRio.indicateurOD=i.Constantes.OperationFinanciere.TEXTE_OUI_O:F.operationFinanciere.segmentPrvRio.indicateurOD=i.Constantes.OperationFinanciere.TEXTE_NON_N,r&&r.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&(F.operationFinanciere.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,F.estMontantVidePourOd=!1),r&&r.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&(F.operationFinanciere.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO),n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&(F.operationFinanciere.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,F.operationFinanciere.segmentPrjo.codeReferenceOD=i.Constantes.OperationFinanciere.CODE_REFERENCE_OD_VEOD,F.operationFinanciere.segmentPrjo.libelle1SaisiOD="",F.operationFinanciere.segmentPrjo.libelle2SaisiOD="",F.operationFinanciere.segmentPrjo.codeDeviseOperation=F.montantDevise.codeDevise),n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU?(F.operationFinanciere.segmentPrvRio.typeCheque=i.Constantes.ChiffreString.CHIFFRE_UN_STRING,F.operationFinanciere.segmentPrvRio.nombreJourReserveEncaissement=MyWay.Services.StringUtils.padLeftNumber(F.reserveEncaissement.delaiEncaissement.toString(),i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,3)):(F.operationFinanciere.segmentPrvRio.typeCheque="",F.operationFinanciere.segmentPrvRio.nombreJourReserveEncaissement=MyWay.Services.StringUtils.padLeftNumber(i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,3)),(n.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||n.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS)&&(F.operationFinanciere.segmentPrvRio.S_BILLETERIE.nombreCoupure=new MyWay.Model.Coupure,F.operationFinanciere.segmentPrvRio.S_BILLETERIE.monnaieSansBillet=0),n.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&F.estUneOuverture04VPC()?F.montantDesactive=!1:n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&F.estUneOuverture04VPC()?(F.montantDesactive=!0,F.montantDevise.montant=F.operationFinanciere.montant=0):(n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS)&&(F.operationFinanciere.segmentPrvRio.S_BILLETERIE.nombreCoupure=F.coupure,F.calculPlafondVersementService()),"99"===n.CTGXM1&&F.estUneOuverture04VPC()&&(F.montantDesactive=!0,F.montantDevise.montant=F.operationFinanciere.montant=0),F.estVersement&&n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&F.operationFinanciere.montant>0&&(F.loading=!0,F.caisseAutoService.deposerEspeces(F.authentificationInfo.agentConnecte.referenceExterneAgent,F.operationFinanciere.client.numeroPersonne,F.montantDevise.montant).then(function(e){0!==e&&(F.montantDevise.montant=e/100,F.montantDesactive=!0,F.modeFinancierDesactive=!0,F.afficherCaseCarteTMF=!1)})["finally"](function(){F.loading=!1})),n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&F.operationFinanciere&&F.operationFinanciere.compte){var a=F.facturationAutomatiqueService.getCodePrestationEnFonctionRice(F.operationFinanciere.compte.rice);F.operationFinanciere.segmentPrvRio.codePrestationTarifaire=a,F.operationFinanciere.facturationPrestation=new e.comOpesFinancieres.Model.FacturationPrestation(a)}n.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&null===F.operationFinanciere.compteVirementInterneSelectionne&&(F.operationFinanciere.estValide=!1),F.estModificationManuelleLibelleOperation=!1,F.operationFinanciereService.getLibelleOperationFinanciere(F.authentificationInfo.codeEtablissement,F.operationFinanciere.codeOperation,F.operationFinanciere.segmentPrvRio).then(function(e){var i;F.operationFinanciere&&F.operationFinanciere.estLibelleOperationPersonnalise?i=F.operationFinanciere.libelleOperation:(i=e,F.operationFinanciere.libelleOperation=i),F.operationFinanciere.segmentPrvRio.libelleOperation1=MyWay.Services.StringUtils.padRight(i.libelleLong," ",24)+i.libelleCourt,F.operationFinanciereValueService.operationFinanciere=F.operationFinanciere,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio).then(function(){F.libelleOperationMemorise=angular.copy(i),F.libelleOperation1Memorise=angular.copy(F.operationFinanciere.segmentPrvRio.libelleOperation1),F.serviceAgentExtended.addToContext(F.cleModeFinancier,F.operationFinanciere.modeFinancier).then(function(){F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => $scope.$watch(() => this.operationFinanciere.modeFinancier => modeFinancier Ajouté au contexte : ",JSON.stringify(F.operationFinanciere.modeFinancier)),t.$broadcast("mode_financier_changed",n.CTGXM1),t.$emit("modeFinancier_changed_emit_opefi",n.CTGXM1)})})}),(F.carteTMFModeDepotActive||F.carteTMFModeRetraitActive||F.carteTMFModeRetraitOADActive)&&F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&F.carteTempoMultiFonctionsService.isDepotRetraitTMFAutorise()&&F.operationFinanciere.compte&&F.operationFinanciere.compte.rice&&F.operationFinanciere.compte.rice.codeActiviteCompte!==i.Constantes.OperationFinanciere.CODE_PRODUIT_17?(F.afficherCaseCarteTMF=!0,F.carteTMFCochee=!0):(F.afficherCaseCarteTMF=!1,F.carteTMFCochee=!1)}}),F.affichageBlocsParModeFinancier(n.CTGXM1).then(function(){t.$broadcast("desactivation_case_vrac")})["catch"](function(){})):F.operationFinanciere.estForcageOperationFinanciere&&angular.isUndefined(n)&&angular.isDefined(r)&&(F.operationFinanciere.modeFinancier=r,F.operationFinanciereValueService.operationFinanciere.modeFinancier=r),F.debounceChargerPlafondVersement())}),t.$watch(function(){return F.referenceEnveloppe.numeroReferenceEnveloppe},function(n,r){n!==r&&void 0!==r&&(F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(r){angular.isDefined(r)&&null!==r&&(F.operationFinanciere.segmentPrvRio=r,angular.isDefined(n)&&(""!==n?(t.$broadcast("numero_reference_sac_changed",n,F.referenceEnveloppe.isCocher,F.operationFinanciere.modeFinancier.CTGXM1),F.operationFinanciere.segmentPrvRio.libelleOperation1=i.Constantes.OperationFinanciere.TEXTE_LIBELLE_DEPOT_ESP_NUMERO+n+" "+F.operationFinanciere.libelleOperation.libelleCourt,F.operationFinanciere.libelleOperation=new e.comOpesFinancieres.Model.LibelleOperation(F.operationFinanciere.libelleOperation.libelleCourt,F.operationFinanciere.segmentPrvRio.libelleOperation1),F.referenceEnveloppe&&(F.operationFinanciere.referenceEnveloppe=F.referenceEnveloppe)):(angular.isUndefined(F.libelleOperationMemorise)&&(F.libelleOperationMemorise=new e.comOpesFinancieres.Model.LibelleOperation("","")),t.$broadcast("numero_reference_sac_changed",F.libelleOperation1Memorise,F.referenceEnveloppe.isCocher,F.operationFinanciere.modeFinancier.CTGXM1),F.operationFinanciere.libelleOperation=angular.copy(F.libelleOperationMemorise),F.operationFinanciere.segmentPrvRio.libelleOperation1=angular.copy(F.libelleOperation1Memorise),F.referenceEnveloppe&&(F.operationFinanciere.referenceEnveloppe=F.referenceEnveloppe))),F.operationFinanciereValueService.operationFinanciere=F.operationFinanciere,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio).then(function(){F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => $scope.$watch(() => this.referenceEnveloppe.numeroReferenceEnveloppe => segmentPrvRio Ajouté au contexte :",JSON.stringify(F.operationFinanciere.segmentPrvRio))}))}),F.determinerActivationBoutonValider())}),t.$watch(function(){return F.referenceEnveloppe.isCocher},function(e,i){e!==i&&F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(i){i||(i=angular.copy(F.operationFinanciere.segmentPrvRio)),F.serviceAgentExtended.Context.GetAuthentificationInfo().then(function(n){F.operationFinanciereService.getLibelleOperationFinanciere(n.codeEtablissement,F.operationFinanciere.codeOperation,i).then(function(i){F.operationFinanciere.libelleOperation=angular.copy(i),F.operationFinanciereValueService.operationFinanciere.libelleOperation=angular.copy(i),t.$broadcast("coche_reference_sac_changed",e,F.operationFinanciere.modeFinancier.CTGXM1,i)})})})}),t.$watch(function(){return F.estOperationDiverseValide},function(e,i){e!==i&&F.determinerActivationBoutonValider(),e&&(F.operationFinanciere.operationDiverse=new MyWay.Model.OperationDiverse,F.operationFinanciereValueService.operationFinanciere.operationDiverse=new MyWay.Model.OperationDiverse,F.operationFinanciere.operationDiverse=F.listeOperationDiverse,F.operationFinanciereValueService.operationFinanciere.operationDiverse=F.listeOperationDiverse)}),t.$watch(function(){return F.dateValeur},function(e,i){e!==i&&F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(i){i=F.checkMemoSegmentPrvRio(i,"saisie-operation-financiere-controller.ts => $watch(() => this.dateValeur => "),angular.isDefined(i)&&null!==i&&(i.dateDeValeur=e,F.operationFinanciere.segmentPrvRio=i,F.estModificationManuelleLibelleOperation&&(F.operationFinanciere.segmentPrvRio.libelleOperation1=angular.copy(F.operationFinanciere.libelleOperation.libelleLong)),F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio).then(function(){F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts =>   $scope.$watch(() => this.dateValeur => segmentPrvRio Ajouté au contexte :",JSON.stringify(F.operationFinanciere.segmentPrvRio))}))})}),t.$watch(function(){return F.operationFinanciere.libelleOperation},function(e,i){e!==i&&F.estModificationManuelleLibelleOperation&&F.operationFinanciere&&F.operationFinanciere.segmentPrvRio&&(e.libelleLong=e.libelleLong.replace(/[\x00-\x1F\x7F-\x9F]/g,""),F.operationFinanciere.segmentPrvRio.libelleOperation1=MyWay.Services.StringUtils.padRight(e.libelleLong," ",24)+e.libelleCourt,F.operationFinanciere.libelleOperation=e,F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.operationFinanciereValueService.operationFinanciere.libelleOperation=e,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio))},!0),t.$watch(function(){return F.carteTMFCochee},function(e,i){e!==i&&(F.operationFinanciere.estOperationDepotRetraitCarteTMF=e?!0:!1,F.determinerActivationBoutonValider(),e||(F.choixBilletterieChecked=!1,F.operationFinanciere.choixBilletterieTMF=!1),F.operationFinanciereValueService.operationFinanciere.estOperationDepotRetraitCarteTMF=F.operationFinanciere.estOperationDepotRetraitCarteTMF,F.operationFinanciereValueService.operationFinanciere.choixBilletterieTMF=F.operationFinanciere.choixBilletterieTMF)}),t.$watch(function(){return F.operationFinanciere.estForcageOperationFinanciere},function(e,n){e&&(F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => $scope.$watch(() => estForcageOperationFinanciere => ",JSON.stringify(e)),null!=F.operationFinanciere.modeFinancier&&(F.operationFinanciereValueService.operationFinanciere.modeFinancier=F.operationFinanciere.modeFinancier,F.affichageBlocsParModeFinancier(F.operationFinanciere.modeFinancier.CTGXM1),F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&F.operationFinanciere.segmentPrvRio.nombreJourReserveEncaissement!==i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING&&t.$broadcast("mwsfTypeCheque_reserve_encaissement_forcage",F.operationFinanciere.segmentPrvRio.nombreJourReserveEncaissement),(F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS)&&(F.calculPlafondVersementService(),F.operationFinanciere.segmentPrvRio.S_BILLETERIE&&t.$broadcast("mwsfBilletterie_forcage_opefi",F.operationFinanciere.segmentPrvRio.S_BILLETERIE)),F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&(F.operationFinanciere.compteVirementInterneSelectionne?t.$broadcast("mwsfVirementInterne_forcage_opefi",F.operationFinanciere.compteVirementInterneSelectionne):t.$broadcast("mwsfVirementInterneSaisie_forcage_opefi",F.operationFinanciere.riceVirementInterneSaisie)),(F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS||F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES)&&F.operationFinanciere.referenceEnveloppe&&t.$broadcast("mwsfRefEnveloppe_forcage_opefi",F.operationFinanciere.referenceEnveloppe,F.operationFinanciere.modeFinancier.CTGXM1),F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&F.operationFinanciere.operationDiverse&&(F.listeOperationDiverse=F.operationFinanciere.operationDiverse,F.afficherOperationDiverse=!0,t.$broadcast("est_operation_diverse_opefi",F.afficherOperationDiverse),t.$broadcast("mwsfOperationDiverse_forcage_opefi",F.operationFinanciere.operationDiverse,F.operationFinanciere.segmentPrjo))),F.operationFinanciere.segmentPrvRio&&F.operationFinanciere.segmentPrvRio.dateDeValeur&&(F.dateValeur=F.operationFinanciere.segmentPrvRio.dateDeValeur),F.operationFinanciere.segmentPrvRio&&F.operationFinanciere.segmentPrvRio.identiteParticipant&&(F.referenceIdentite=F.operationFinanciere.segmentPrvRio.identiteParticipant),F.determinerActivationBoutonValider())}),t.$watch(function(){return F.choixBilletterieChecked},function(e,i){t.$broadcast("mwsfChoixBilletterie_cheked",F.choixBilletterieChecked)}),t.$on("participant_selectionne",function(e,i){F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(e){null!==e&&(F.operationFinanciere.segmentPrvRio=e,F.operationFinanciere.segmentPrvRio=F.valorisationSegmentAvecParticipantSelectionne(F.operationFinanciere.segmentPrvRio,i),F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio))})}),t.$on("informations_complementaires_libelle_vide",function(e,i){F.estLibelleOperationVide=i,F.determinerActivationBoutonValider()}),t.$on("cheque_banque_operation_modification",function(e,n,t){F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(e){null!=e&&(F.operationFinanciere.segmentPrvRio=e,F.operationFinanciere.segmentPrvRio.numeroCheque=n,F.operationFinanciere.segmentPrvRio.ordreCheque=t,F.operationFinanciere.segmentPrvRio.chequeGlobal=i.Constantes.OperationFinanciere.TEXTE_NON_N,F.operationFinanciere.segmentPrvRio.derniereContrepartie=i.Constantes.OperationFinanciere.TEXTE_OUI_O,F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio)),F.determinerActivationBoutonValider()})}),t.$on("rice_virement_interne_manuel",function(n,t){F.estTraitementRiceTermine=!1,F.estTraitementTermineDeferred=F.$q.defer(),F.estTraitementTermine=F.estTraitementTermineDeferred.promise,F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(n){if(n=F.checkMemoSegmentPrvRio(n,"saisie-operation-financiere-controller.ts => $scope.$on('rice_virement_interne_manuel') => "),F.operationFinanciere.segmentPrvRio=n,angular.isDefined(t)&&angular.isDefined(t.codeActiviteCompte)&&angular.isDefined(t.radical)&&angular.isDefined(t.cleCompte)&&angular.isDefined(t.cleRice)&&t.codeActiviteCompte&&t.radical&&t.cleCompte&&t.cleRice){var r="";angular.isDefined(F.operationFinanciere.segmentPrvRio)&&null!==F.operationFinanciere.segmentPrvRio&&F.operationFinanciere.segmentPrvRio.codeEvenementAtome&&F.operationFinanciere.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE&&(r=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE),angular.isDefined(F.operationFinanciere.segmentPrvRio)&&null!==F.operationFinanciere.segmentPrvRio&&F.operationFinanciereService.getLibelleComplementaire(t.codeEtablissement,F.operationFinanciere.codeOperation,r,F.operationFinanciere.segmentPrvRio.modeFinancierChoisi).then(function(i){(angular.isUndefined(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)||null==F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)&&(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR=[new e.comOpesFinancieres.Model.SegmentPRVRIOUGR]),F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte=F.riceVirementInterneSaisie.formatRicePourStructureEchange(),F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement=i,F.operationFinanciere.riceVirementInterneSaisie=F.riceVirementInterneSaisie,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio),F.determinerActivationBoutonValider()})}else angular.isDefined(F.operationFinanciere.segmentPrvRio)&&null!==F.operationFinanciere.segmentPrvRio&&((angular.isUndefined(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)||null==F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)&&(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR=[new e.comOpesFinancieres.Model.SegmentPRVRIOUGR]),
F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte="",F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement="",angular.isDefined(F.operationFinanciere.modeFinancier)&&F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&(F.operationFinanciere.estValide=!1));F.operationFinanciereValueService.operationFinanciere=F.operationFinanciere,F.determinerActivationBoutonValider(),F.saisieRiceService.getAppelTermine().then(function(){F.estTraitementRiceTermine=!0,F.verifieEstTraitementTermine()})})}),t.$on("rice_virement_interne",function(n,t,r){F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(n){F.estTraitementRiceInterneTermine=!1,F.estTraitementListeCompteTermine=!1,F.estTraitementTermineDeferred=F.$q.defer(),F.estTraitementTermine=F.estTraitementTermineDeferred.promise,F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => $scope.$on(rice_virement_interne) => operationFinanciere  = ",JSON.stringify(F.operationFinanciereValueService.operationFinanciere)),F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(o){o=F.checkMemoSegmentPrvRio(o,"saisie-operation-financiere-controller.ts => $scope.$on('rice_virement_interne') => "),F.operationFinanciere.segmentPrvRio=o,F.serviceAgentExtended.Context.GetAuthentificationInfo().then(function(o){var a="";angular.isDefined(F.operationFinanciere.segmentPrvRio)&&null!==F.operationFinanciere.segmentPrvRio&&F.operationFinanciere.segmentPrvRio.codeEvenementAtome&&F.operationFinanciere.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE&&(a=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE),F.determinerActivationBoutonValider(),angular.isDefined(F.operationFinanciere.segmentPrvRio)&&null!==F.operationFinanciere.segmentPrvRio?F.operationFinanciereService.getLibelleComplementaire(o.codeEtablissement,F.operationFinanciere.codeOperation,a,F.operationFinanciere.segmentPrvRio.modeFinancierChoisi).then(function(o){var a=i.Constantes.OperationFinanciere.TEXTE_SOLDE_COMPTE_AVANT_VIREMENT_INTERNE+r;F.serviceAgentExtended.Trace.debug(a),F.operationFinanciere.soldeCompteAvantVirement=r,n?F.operationFinanciere.nouveauSoldeCompteVirementApresVirement=Math.round(100*(r-n.montantGlobalOperation))/100:F.operationFinanciere.nouveauSoldeCompteVirementApresVirement=0;var s=i.Constantes.OperationFinanciere.TEXTE_NOUVEAU_SOLDE_APRES_VIREMENT_INTERNE+F.operationFinanciere.nouveauSoldeCompteVirementApresVirement;F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => rice_virement_interne => texteTraceNouveauSoldeCompte = ",s),(angular.isUndefined(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)||null==F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)&&(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR=[new e.comOpesFinancieres.Model.SegmentPRVRIOUGR]),null!==t?F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte=t.riceContrat:(""===F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte||F.operationFinanciere.estForcageOperationFinanciere||(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte=""),angular.isDefined(F.operationFinanciere.modeFinancier)&&F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&(F.operationFinanciere.estValide=!1)),(angular.isUndefined(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)||null==F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)&&(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR=[new e.comOpesFinancieres.Model.SegmentPRVRIOUGR]),null!==t?F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement=o:(""===F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement||F.operationFinanciere.estForcageOperationFinanciere||(F.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement=""),angular.isDefined(F.operationFinanciere.modeFinancier)&&F.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&(F.operationFinanciere.estValide=!1)),F.operationFinanciere.compteVirementInterneSelectionne=t,F.operationFinanciereValueService.operationFinanciere=F.operationFinanciere,F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => $scope.$on(rice_virement_interne) =>  operationFinanciereValue = ",JSON.stringify(F.operationFinanciereValueService.operationFinanciere)),F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio).then(function(){F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts =>   $scope.$on(rice_virement_interne) => segmentPrvRio Ajouté au contexte : ",JSON.stringify(F.operationFinanciere.segmentPrvRio)),F.serviceAgentExtended.addToContext(F.cleModeFinancier,F.operationFinanciere.modeFinancier).then(function(){F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts =>  $scope.$on(rice_virement_interne)  => modeFinancier Ajouté au contexte : ",JSON.stringify(F.operationFinanciere.modeFinancier))})}),F.estTraitementRiceInterneTermine=!0,F.verifieEstTraitementTermine()})["finally"](function(){F.listeCompteService.getListeCompteCharge().then(function(){F.estTraitementListeCompteTermine=!0,F.verifieEstTraitementTermine()})}):F.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => $scope.$on(rice_virement_interne) =>  operationFinanciere (non modifié) = ",JSON.stringify(F.operationFinanciere))})})})}),t.$on("mwsfSoldeCompte_valeur_solde_actuel",function(e,n){if(F.operationFinanciere&&F.operationFinanciere.fonctionnalite&&(F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_CLOTURE_COMPTE_MAJ||F.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_CLOTURE_CDD_MAJ)){var t=F.operationFinanciere.montant<0?-1*F.operationFinanciere.montant:F.operationFinanciere.montant;t===n&&(F.afficherSolde=!1)}}),t.$on("mwsfBilletterie_changement_valeur_coupure",function(e,i){F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(e){F.operationFinanciere.segmentPrvRio=e,F.operationFinanciere.segmentPrvRio.S_BILLETERIE.nombreCoupure=i,F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio),F.determinerActivationBoutonValider()})}),t.$on("mwsfBilletterie_changement_valeur_monnaie",function(e,i){F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(e){F.operationFinanciere.segmentPrvRio=e,F.operationFinanciere.segmentPrvRio.S_BILLETERIE.monnaieSansBillet=i,F.operationFinanciere.segmentPrvRio.S_BILLETERIE.monnaieBilleterie=i,F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio),F.determinerActivationBoutonValider()})}),t.$on("mwsfBilletterie_effacer_billetterie",function(i){F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(i){null!=i&&(F.operationFinanciere.segmentPrvRio=i,F.operationFinanciere.segmentPrvRio.S_BILLETERIE=new e.comOpesFinancieres.Model.SegmentBilleterie,F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio),F.determinerActivationBoutonValider())})}),t.$on("mwsfChequeBanque_cheque_banque_emis",function(e,n){F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(e){null!=e&&(F.operationFinanciere.segmentPrvRio=e,F.operationFinanciere.segmentPrvRio.numeroCheque=n.numero,F.operationFinanciere.segmentPrvRio.ordreCheque=n.beneficiaire,n.multiRetrait?(F.operationFinanciere.segmentPrvRio.chequeGlobal=i.Constantes.OperationFinanciere.TEXTE_OUI_O,n.derniereContrepartie?F.operationFinanciere.segmentPrvRio.derniereContrepartie=i.Constantes.OperationFinanciere.TEXTE_OUI_O:F.operationFinanciere.segmentPrvRio.derniereContrepartie=i.Constantes.OperationFinanciere.TEXTE_NON_N):(F.operationFinanciere.segmentPrvRio.chequeGlobal=i.Constantes.OperationFinanciere.TEXTE_NON_N,F.operationFinanciere.segmentPrvRio.derniereContrepartie=i.Constantes.OperationFinanciere.TEXTE_OUI_O),F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio))})}),t.$on("mwsfChequeBanque_effacer_cheque_banque",function(e){F.serviceAgentExtended.getFromContext(F.cleSegmentPrvRrio).then(function(e){null!=e&&(F.operationFinanciere.segmentPrvRio=e,F.operationFinanciere.segmentPrvRio.numeroCheque="",F.operationFinanciere.segmentPrvRio.ordreCheque="",F.operationFinanciere.segmentPrvRio.derniereContrepartie="",F.operationFinanciere.segmentPrvRio.chequeGlobal="",F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio))})}),t.$on("mwsfTypeCheque_reserve_encaissement",function(e,n){angular.isDefined(F.operationFinanciere.segmentPrvRio)&&null!==F.operationFinanciere.segmentPrvRio&&(F.operationFinanciere.segmentPrvRio.nombreJourReserveEncaissement=MyWay.Services.StringUtils.padLeftNumber(n.delaiEncaissement.toString(),i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,3),F.operationFinanciereValueService.operationFinanciere.segmentPrvRio=F.operationFinanciere.segmentPrvRio,F.serviceAgentExtended.addToContext(F.cleSegmentPrvRrio,F.operationFinanciere.segmentPrvRio))}),t.$on("mwsfOperation_Diverse",function(e,i){i&&(F.operationFinanciere.operationDiverse=i,F.operationFinanciereValueService.operationFinanciere.operationDiverse=i)})}return n.prototype.isFonctionOverture=function(){var e=this,n=!1;return this.operationFinanciere&&this.operationFinanciere.fonctionnalite&&i.Constantes.Fonctionnalite.TEXTE_OUVERTURE.forEach(function(i){n=n||MyWay.Services.StringUtils.startsWith(e.operationFinanciere.fonctionnalite.toString(),i)}),n},n.prototype.getLibelleOperation=function(){var e=this;return this.operationFinanciere&&this.operationFinanciere.modeFinancier&&this.operationFinanciere.modeFinancier.CTGXMF&&this.operationFinanciere.segmentPrvRio&&this.operationFinanciere.segmentPrvRio.codeEvenementAtome?this.operationFinanciereService.getLibelleOperationFinanciere(this.authentificationInfo.codeEtablissement,this.operationFinanciere.codeOperation,{modeFinancierChoisi:this.operationFinanciere.modeFinancier.CTGXMF,codeEvenementAtome:this.operationFinanciere.segmentPrvRio.codeEvenementAtome}).then(function(i){return e.operationFinanciere&&!e.operationFinanciere.estLibelleOperationPersonnalise&&(e.operationFinanciere.libelleOperation=angular.copy(i)),i}):this.$q.when(this.operationFinanciere.libelleOperation)},n.prototype.getLibelleOperationMemorise=function(){var e=this;return this.operationFinanciereService.getLibelleOperationFinanciere(this.authentificationInfo.codeEtablissement,this.operationFinanciere.codeOperation,this.operationFinanciere.segmentPrvRio).then(function(i){var n;return e.operationFinanciere&&e.operationFinanciere.estLibelleOperationPersonnalise||(n=i),e.libelleOperationMemorise=angular.copy(n),e.libelleOperation1Memorise=angular.copy(MyWay.Services.StringUtils.padRight(n.libelleLong," ",24)+n.libelleCourt),n})},n.prototype.GetCurrentProcessId=function(){var e=this.$q.defer();return this.serviceAgentExtended.Context.GetCurrentProcessId().then(function(i){e.resolve(i)})["catch"](function(i){e.reject(i)}),e.promise},n.prototype.valorisationSegmentAvecParticipantSelectionne=function(e,n){return e.codeRoleParticipant=n[0].codePersonnaliteJuridique,e.nomPatronymiqueParticipant=n[0].nomParticipant,e.prenomParticipant=n[0].prenomParticipant,e.numeroPersonneSignataire=MyWay.Services.StringUtils.padLeftNumber(n[0].identifiantParticipant.toString(),i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,9),e},n.prototype.determinerActivationBoutonValider=function(){this.champsErreursOpefi=this.operationFinanciereService.reinitialisationListeChampsEnErreursOperationFinancieres();var e,n;if(angular.isDefined(this.operationFinanciere.segmentPrvRio)&&null!==this.operationFinanciere.segmentPrvRio&&(e=this.operationFinanciere.segmentPrvRio.montantMinimum),angular.isDefined(this.operationFinanciere.segmentPrvRio)&&null!==this.operationFinanciere.segmentPrvRio&&(n=this.operationFinanciere.segmentPrvRio.montantMaximum),this.operationFinanciere.modeFinancier){switch(this.operationFinanciere.modeFinancier.CTGXM1){case i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES:this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderOperationDiverse(this.operationFinanciere.montant,this.estOperationDiverseValide,this.estLibelleOperationVide);break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES:this.carteTMFModeDepotActive&&this.operationFinanciere.estOperationDepotRetraitCarteTMF?this.operationFinanciere.estValide=!0:this.carteTMFModeRetraitActive&&this.operationFinanciere.estOperationDepotRetraitCarteTMF?this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderEspecesRetraitCarteTMF(this.operationFinanciere,this.estLibelleOperationVide,!1):this.carteTMFModeRetraitOADActive&&this.operationFinanciere.estOperationDepotRetraitCarteTMF?this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderEspecesRetraitCarteTMF(this.operationFinanciere,this.estLibelleOperationVide,!0):this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderEspeces(this.operationFinanciere.montant,this.montantBilletterie,this.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement,this.estLibelleOperationVide,this.referenceEnveloppe,this.afficherTitulaireCompteParFonctionnalite,this.operationFinanciere.titulaireCompte,this.afficherReferenceOAD,this.operationFinanciere.referenceOAD,this.estObligatoireSaisieLibelleComplementaire2,this.operationFinanciere.libelleComplementaire2);break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU:this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderCheque(this.operationFinanciere.montant,this.estLibelleOperationVide);break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE:this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderVirementInterne(this.operationFinanciere.montant,this.riceVirementInterneSaisie,this.operationFinanciere.compteVirementInterneSelectionne,this.estLibelleOperationVide);break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS:this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderEspecesDivers(this.operationFinanciere.montant,this.referenceEnveloppe.numeroReferenceEnveloppe,this.montantBilletterie,this.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement,this.estLibelleOperationVide,this.estObligatoireSaisieLibelleComplementaire2,this.operationFinanciere.libelleComplementaire2);break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE:this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderChequeBanque(this.operationFinanciere.montant,this.estLibelleOperationVide,this.operationFinanciere.chequeBanqueOperation.numeroCheque,this.operationFinanciere.chequeBanqueOperation.beneficiaireCheque,this.afficherReferenceOAD,this.operationFinanciere.referenceOAD);break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_DIVERS:this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderDivers(this.operationFinanciere.montant,this.estLibelleOperationVide,this.afficherTitulaireCompteParFonctionnalite,this.operationFinanciere.titulaireCompte,this.afficherReferenceOAD,this.operationFinanciere.referenceOAD);break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_OUVERTURE_ZERO:this.operationFinanciere.estValide=this.operationFinanciereService.determinerActivationBoutonValiderEspeces(this.operationFinanciere.montant,this.montantBilletterie,this.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement,this.estLibelleOperationVide,this.referenceEnveloppe,this.afficherTitulaireCompteParFonctionnalite,this.operationFinanciere.titulaireCompte,this.afficherReferenceOAD,this.operationFinanciere.referenceOAD,this.estObligatoireSaisieLibelleComplementaire2,this.operationFinanciere.libelleComplementaire2);break;default:this.operationFinanciere.estValide=!1}!this.operationFinanciere.estOperationDepotRetraitCarteTMF&&this.operationFinanciere.montant>0&&(this.operationFinanciere.montant<e?this.operationFinanciere.estValide=!1:this.operationFinanciere.montant>n&&(this.operationFinanciere.estValide=!1,this.operationFinanciereService.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurDepassementMontantMax()))),this.operationFinanciereValueService.operationFinanciere=this.operationFinanciere;var t=this.operationFinanciereService.getListeChampsEnErreursOperationFinancieres();t&&t.length>0&&(this.champsErreursOpefi=t)}},n.prototype.affichageBlocsParModeFinancier=function(e){var n=this.$q.defer();switch(e){case i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES:null==this.montantDevise.montant&&(this.estMontantVidePourOd=!0),this.afficherOperationDiverse=!0,this.$scope.$broadcast("est_operation_diverse_opefi",this.afficherOperationDiverse),this.isAfficherBilletterie=!1,this.afficherVirementInterne=!1,this.afficherReserveEncaissement=!1,this.afficherChequeBanque=!1,this.afficherVracParFonctionnalite&&(this.afficherVracParModeFinancier=!1),this.afficherRepartitionParFonctionnalite&&(this.afficherRepartitionParModeFinancier=!1),this.afficherPlusieursChequesParFonctionnalite&&(this.afficherPlusieursChequesParModeFinancier=!1),this.afficherFacturationAutomatiqueParFonctionnalite&&(this.afficherFacturationAutomatiqueParModeFinancier=!1),this.afficherLibelleComplementaire2ParFonctionnalite&&(this.afficherLibelleComplementaire2ParModeFinancier=!1),n.resolve();break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES:if(this.operationFinanciere.contexteSaisieOperationFinanciere?!this.estUneOuverture04VPC()&&(null==this.operationFinanciere.contexteSaisieOperationFinanciere.typeCA||""===this.operationFinanciere.contexteSaisieOperationFinanciere.typeCA||this.estVersement&&"D"===this.operationFinanciere.contexteSaisieOperationFinanciere.typeCA)?this.isAfficherBilletterie=!0:this.isAfficherBilletterie=!1:void 0!==this.operationFinanciere.estRepriseOffre&&this.operationFinanciere.estRepriseOffre&&this.estUneOuverture04VPC()?this.isAfficherBilletterie=!1:this.isAfficherBilletterie=!0,this.afficherOperationDiverse=!1,this.$scope.$broadcast("est_operation_diverse_opefi",this.afficherOperationDiverse),this.afficherVirementInterne=!1,this.afficherReserveEncaissement=!1,this.afficherChequeBanque=!1,this.afficherVracParFonctionnalite){var t=9999;this.montantDevise&&angular.isDefined(this.montantDevise.montant)&&null!==this.montantDevise.montant&&(t=this.montantDevise.montant,this.operationFinanciereValueService.operationFinanciere.montant=t,this.operationFinanciereValueService.operationFinanciere.segmentPrvRio.montantGlobalOperation=t),this.afficherVracParModeFinancier=!0,this.$scope.$broadcast("montant_changed_tarification_vrac",t)}this.afficherPlusieursChequesParFonctionnalite&&(this.afficherPlusieursChequesParModeFinancier=!1),this.afficherFacturationAutomatiqueParFonctionnalite&&(this.afficherFacturationAutomatiqueParModeFinancier=!1),this.afficherRepartitionParFonctionnalite&&(this.afficherRepartitionParModeFinancier=!1),this.afficherLibelleComplementaire2ParFonctionnalite&&(this.afficherLibelleComplementaire2ParModeFinancier=!0),n.resolve();break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU:this.afficherReserveEncaissement=!0,this.afficherVirementInterne=!1,this.afficherOperationDiverse=!1,this.$scope.$broadcast("est_operation_diverse_opefi",this.afficherOperationDiverse),this.isAfficherBilletterie=!1,this.afficherChequeBanque=!1,this.afficherVracParFonctionnalite&&(this.afficherVracParModeFinancier=!1),this.afficherPlusieursChequesParFonctionnalite&&(this.afficherPlusieursChequesParModeFinancier=!0),this.afficherFacturationAutomatiqueParFonctionnalite&&(this.afficherFacturationAutomatiqueParModeFinancier=!1),this.afficherRepartitionParFonctionnalite&&(this.afficherRepartitionParModeFinancier=!1),this.afficherLibelleComplementaire2ParFonctionnalite&&(this.afficherLibelleComplementaire2ParModeFinancier=!1),n.resolve();break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE:this.afficherVirementInterne=!0,this.afficherOperationDiverse=!1,this.$scope.$broadcast("est_operation_diverse_opefi",this.afficherOperationDiverse),this.isAfficherBilletterie=!1,this.afficherReserveEncaissement=!1,this.afficherChequeBanque=!1,this.afficherVracParFonctionnalite&&(this.afficherVracParModeFinancier=!1),this.afficherPlusieursChequesParFonctionnalite&&(this.afficherPlusieursChequesParModeFinancier=!1),this.afficherFacturationAutomatiqueParFonctionnalite&&(this.afficherFacturationAutomatiqueParModeFinancier=!1),this.afficherRepartitionParFonctionnalite&&(this.afficherRepartitionParModeFinancier=!1),this.afficherLibelleComplementaire2ParFonctionnalite&&(this.afficherLibelleComplementaire2ParModeFinancier=!1),n.resolve();break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS:this.isAfficherBilletterie=!1,this.afficherOperationDiverse=!1,this.$scope.$broadcast("est_operation_diverse_opefi",this.afficherOperationDiverse),this.afficherVirementInterne=!1,this.afficherReserveEncaissement=!1,this.afficherChequeBanque=!1,this.afficherVracParFonctionnalite&&(this.afficherVracParModeFinancier=!1),this.afficherPlusieursChequesParFonctionnalite&&(this.afficherPlusieursChequesParModeFinancier=!1),this.afficherFacturationAutomatiqueParFonctionnalite&&(this.afficherFacturationAutomatiqueParModeFinancier=!1),this.afficherRepartitionParFonctionnalite&&(this.afficherRepartitionParModeFinancier=!1),this.afficherLibelleComplementaire2ParFonctionnalite&&(this.afficherLibelleComplementaire2ParModeFinancier=!0),n.resolve();break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE:this.afficherOperationDiverse=!1,this.$scope.$broadcast("est_operation_diverse_opefi",this.afficherOperationDiverse),this.afficherVirementInterne=!1,this.afficherReserveEncaissement=!1,this.isAfficherBilletterie=!1,this.afficherChequeBanque=!0,this.afficherVracParFonctionnalite&&(this.afficherVracParModeFinancier=!1),this.afficherPlusieursChequesParFonctionnalite&&(this.afficherPlusieursChequesParModeFinancier=!1),this.afficherFacturationAutomatiqueParFonctionnalite&&(this.afficherFacturationAutomatiqueParModeFinancier=!0,this.operationFinanciere&&this.operationFinanciere.montant&&(this.operationFinanciereValueService.operationFinanciere.montant=this.operationFinanciere.montant,this.$scope.$broadcast("montant_changed_tarification_facturation_automatique",this.operationFinanciere.montant))),this.afficherRepartitionParFonctionnalite&&(this.afficherRepartitionParModeFinancier=!0),this.afficherLibelleComplementaire2ParFonctionnalite&&(this.afficherLibelleComplementaire2ParModeFinancier=!1),n.resolve();break;default:this.afficherVirementInterne=!1,this.afficherOperationDiverse=!1,this.$scope.$broadcast("est_operation_diverse_opefi",this.afficherOperationDiverse),this.isAfficherBilletterie=!1,this.afficherVracParFonctionnalite&&(this.afficherVracParModeFinancier=!1),this.afficherPlusieursChequesParFonctionnalite&&(this.afficherPlusieursChequesParModeFinancier=!1),this.afficherRepartitionParFonctionnalite&&(this.afficherRepartitionParModeFinancier=!1),this.afficherReserveEncaissement=!1,this.afficherChequeBanque=!1,this.afficherFacturationAutomatiqueParFonctionnalite&&(this.afficherFacturationAutomatiqueParModeFinancier=!1),this.afficherLibelleComplementaire2ParFonctionnalite&&(this.afficherLibelleComplementaire2ParModeFinancier=!1),n.resolve()}return n.promise},n.prototype.initialisationDonneesVariables=function(){this.operationFinanciere.montant&&(this.montantPourOperationDiverseListe=angular.copy(this.operationFinanciere.montant)),this.operationFinanciere&&this.operationFinanciere.referenceEnveloppe&&this.operationFinanciere.referenceEnveloppe.numeroReferenceEnveloppe&&""!==this.operationFinanciere.referenceEnveloppe.numeroReferenceEnveloppe&&this.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS?this.referenceEnveloppe=new e.comOpesFinancieres.Model.ReferenceEnveloppe(!0,this.operationFinanciere.referenceEnveloppe.numeroReferenceEnveloppe):this.referenceEnveloppe=new e.comOpesFinancieres.Model.ReferenceEnveloppe(!1,""),this.operationFinanciere&&this.operationFinanciere.modeFinancier&&"99"===this.operationFinanciere.modeFinancier.CTGXM1&&this.estUneOuverture04VPC()&&(this.montantDesactive=!0,this.operationFinanciere.montant=0),this.afficherVracParModeFinancier=!1,this.afficherVracParFonctionnalite=!1,this.isAfficherBilletterie=!1,this.afficherOperationDiverse=!1,this.$scope.$broadcast("est_operation_diverse_opefi",this.afficherOperationDiverse),this.afficherChequeBanque=!1,this.afficherSolde=!1,this.estOperationDiverseValide=!1,this.estMontantVidePourOd=!1,this.estExtourne=!1,this.afficherVirementInterne=!1,this.operationFinanciere&&(this.operationFinanciere.plafondVersement=new e.comOpesFinancieres.Model.PlafondVersementParametre,this.operationFinanciereValueService.operationFinanciere=this.operationFinanciere),this.reserveEncaissement=new MyWay.Model.ReserveEncaissement(!0,i.Constantes.OperationFinanciere.RESERVE_ENCAISSEMENT_DEFAUT_CINQ),this.riceVirementInterneSaisie=new MyWay.Model.Rice,this.operationFinanciere&&this.operationFinanciere.compte&&this.operationFinanciere.compte.rice&&(this.riceVirementInterneSaisie.codeEtablissement=this.operationFinanciere.compte.rice.codeEtablissement,this.riceVirementInterneSaisie.codeGuichet=this.operationFinanciere.compte.rice.codeGuichet),this.operationFinanciere.billetterieOuvertParDefaut=!1,this.operationFinanciere.estForcageOperationFinanciere||(this.operationFinanciere.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,this.operationFinanciereValueService.operationFinanciere.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO),this.operationFinanciere.segmentPrjo&&(this.operationFinanciere.segmentPrjo.montantOperation=angular.copy(this.operationFinanciere.montant)),null===this.operationFinanciere.segmentPrjo&&(this.operationFinanciere.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,this.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS&&(this.operationFinanciere.segmentPrjo.codeReferenceOD=i.Constantes.OperationFinanciere.CODE_REFERENCE_OD_VEOD,this.operationFinanciere.segmentPrjo.libelle1SaisiOD="",this.operationFinanciere.segmentPrjo.libelle2SaisiOD="",this.operationFinanciere.segmentPrjo.montantOperation=angular.copy(this.operationFinanciere.montant)),this.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&(this.operationFinanciere.segmentPrjo.montantOperation=angular.copy(this.operationFinanciere.montant))),this.operationFinanciere&&!this.operationFinanciere.codeOperation&&(this.operationFinanciere.fonctionnalite&&(MyWay.Services.StringUtils.startsWith(this.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_EXTOURNE_OUVERTURE_PEA)||MyWay.Services.StringUtils.startsWith(this.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_EXTOURNE_CLOTURE_PEA))?this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_A:this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.operationFinanciereValueService.operationFinanciere.codeOperation=this.operationFinanciere.codeOperation),this.afficherReferenceIdentite=!0,this.estVersement=!1},n.prototype.verifierPlafondVersement=function(){this.afficheErreurChampMontant=!1,angular.isDefined(this.operationFinanciere.modeFinancier)&&(this.operationFinanciereValueService.operationFinanciere.modeFinancier=this.operationFinanciere.modeFinancier,this.operationFinanciere.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&this.operationFinanciere.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS||null==this.montantDevise.montant?(this.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1,this.operationFinanciereValueService.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1):(this.operationFinanciere.compte&&this.operationFinanciere.compte.produit&&""!==this.operationFinanciere.compte.produit.CODIPR&&null!==this.operationFinanciere.compte.produit.CODIPR||!this.operationFinanciere.estOperationDepotRetraitInterne&&this.operationFinanciere.estValide&&this.operationFinanciere.contexteSaisieOperationFinanciere)&&(angular.isDefined(this.operationFinanciere.segmentPrvRio)&&null!==this.operationFinanciere.segmentPrvRio&&this.operationFinanciere.segmentPrvRio.montantMaximum&&this.montantDevise.montant<this.operationFinanciere.segmentPrvRio.montantMaximum?(this.texteErreurPlafondMaximumVersement=i.Constantes.OperationFinanciere.TEXTE_PLAFOND_VERSEMENT,this.operationFinanciere&&this.operationFinanciere.fonctionnalite&&this.operationFinanciere.fonctionnalite.toString().indexOf("RETRAIT")>0&&(this.texteErreurPlafondMaximumVersement=i.Constantes.OperationFinanciere.TEXTE_PLAFOND_RETRAIT),this.operationFinanciere.plafondVersement&&this.operationFinanciere.plafondVersement.plafondVersementRest&&(this.operationFinanciere.plafondVersement.plafondVersementRest.montantPlafondVersement&&this.montantDevise.montant>this.operationFinanciere.plafondVersement.plafondVersementRest.montantPlafondVersement?(this.montantMaximumPlafondVersement=this.operationFinanciere.plafondVersement.plafondVersementRest.montantPlafondVersement,this.devisePlafondVersement=this.operationFinanciere.plafondVersement.plafondVersementRest.codeDevise,this.afficheErreurChampMontant=!0,this.operationFinanciere.plafondVersement.estAfficherPopupPlafondVersement||(this.operationFinanciere.plafondVersement.plafondVersementRest.indicateurForcageOperation?(this.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1,this.operationFinanciereValueService.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1,this.operationFinanciere&&(this.operationFinanciere.plafondVersement.estAfficherPopupPlafondVersement=!1,this.operationFinanciereValueService.operationFinanciere.plafondVersement.estAfficherPopupPlafondVersement=!1),this.determinerActivationBoutonValider()):this.ouverturePopupErreurPlafondVersement())):(this.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1,this.operationFinanciereValueService.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1,this.determinerActivationBoutonValider()))):(this.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1,this.operationFinanciereValueService.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1)))},n.prototype.ouverturePopupErreurPlafondVersement=function(){var e=this;this.modalService.showErreur(MyWay.UI.TYPE_POPUP_ERREUR.BLOQUANT,"",i.Constantes.PlafondVersement.MESSAGE_ERREUR_PLAFOND_DEPASSE.replace("%%%%",this.operationFinanciere.plafondVersement.plafondVersementRest.montantPlafondVersement.toLocaleString()),i.Constantes.PlafondVersement.TEXTE_BOUTON_OK)["finally"](function(){
e.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!0,e.operationFinanciereValueService.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!0,e.operationFinanciere&&(e.operationFinanciere.plafondVersement.estAfficherPopupPlafondVersement=!0,e.operationFinanciereValueService.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!0),e.determinerActivationBoutonValider()})},n.prototype.ouverturePopupConfirmationPlafondVersement=function(){var e=this,n={actionButtonText:i.Constantes.PlafondVersement.TEXTE_BOUTON_OUI,closeButtonText:i.Constantes.PlafondVersement.TEXTE_BOUTON_NON,headerText:i.Constantes.PlafondVersement.TITRE_MODAL_ATTENTION,bodyText:i.Constantes.PlafondVersement.MESSAGE_CONFIRMATION_PLAFOND_DEPASSE.replace("%%%%",this.operationFinanciere.plafondVersement.plafondVersementRest.montantPlafondVersement.toLocaleString()),iconName:"itce-question",size:"md"};this.modalService.showConfirm(n).then(function(i){e.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1,e.operationFinanciere&&(e.operationFinanciere.plafondVersement.estAfficherPopupPlafondVersement=!0),e.determinerActivationBoutonValider()},function(i){e.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement=!1,e.operationFinanciere&&(e.operationFinanciere.plafondVersement.estAfficherPopupPlafondVersement=!1),e.determinerActivationBoutonValider()})},n.prototype.initialisationOuvertureCompte=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.afficherSolde=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioOuvertureCompte(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio||(n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e))}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1,this.estVersement=!0},n.prototype.initialisationOperationRetraitOAD=function(e){var n=this;this.operationFinanciere&&this.operationFinanciere.codeOperation!==i.Constantes.OperationFinanciere.CODE_OPERATION_A&&(this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N),this.operationFinanciere.billetterieOuvertParDefaut=!1,this.operationFinanciere&&this.operationFinanciere.estOperationDepotRetraitInterne?this.afficherSolde=!0:this.afficherSolde=!1,this.afficherTitulaireCompteParFonctionnalite=!0,this.afficherReferenceIdentite=!1,this.afficherRepartitionParFonctionnalite=!1,this.afficherAccreditif=!0,this.afficherReferenceOAD=!0,this.operationFinanciere.compte&&(this.comptePourLeSolde=new MyWay.Model.Contrat,this.comptePourLeSolde.riceContrat=this.operationFinanciere.compte.rice.formatRicePourStructureEchange(),this.comptePourLeSolde.devise=this.operationFinanciere.compte.devise,this.comptePourLeSolde.codeDeviseContrat=this.operationFinanciere.compte.devise.code),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.operationFinanciereService.initSegmentPrvRioOperationRetrait(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,n.operationFinanciere&&n.operationFinanciere.compte&&n.operationFinanciere.compte.rice&&("01"===n.operationFinanciere.compte.rice.codeActiviteCompte||"04"===n.operationFinanciere.compte.rice.codeActiviteCompte||"05"===n.operationFinanciere.compte.rice.codeActiviteCompte||"06"===n.operationFinanciere.compte.rice.codeActiviteCompte||"10"===n.operationFinanciere.compte.rice.codeActiviteCompte||"11"===n.operationFinanciere.compte.rice.codeActiviteCompte?n.operationFinanciere.segmentPrvRio.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_OAD_INTERNE_CTR:"08"===n.operationFinanciere.compte.rice.codeActiviteCompte&&(n.operationFinanciere.segmentPrvRio.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_OAD_EXTERNE)),null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_RETRAIT,this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!0,this.traitementSpecifiqueLibelleComplementaire2(),this.estVersement=!1},n.prototype.initialisationOperationDepotOAD=function(e){var n=this;this.operationFinanciere&&this.operationFinanciere.codeOperation!==i.Constantes.OperationFinanciere.CODE_OPERATION_A&&(this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N),this.operationFinanciere.billetterieOuvertParDefaut=!1,this.afficherTitulaireCompteParFonctionnalite=!0,this.operationFinanciere&&this.operationFinanciere.estOperationDepotRetraitInterne?this.afficherSolde=!0:this.afficherSolde=!1,this.afficherVracParFonctionnalite=!1,this.afficherAccreditif=!1,this.afficherReferenceOAD=!0,this.afficherReferenceIdentite=!1,this.operationFinanciere.compte&&(this.comptePourLeSolde=new MyWay.Model.Contrat,this.comptePourLeSolde.riceContrat=this.operationFinanciere.compte.rice.formatRicePourStructureEchange(),this.comptePourLeSolde.devise=this.operationFinanciere.compte.devise,this.comptePourLeSolde.codeDeviseContrat=this.operationFinanciere.compte.devise.code),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.operationFinanciereService.initSegmentPrvRioOperationDepot(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,n.operationFinanciere&&n.operationFinanciere.compte&&n.operationFinanciere.compte.rice&&("01"===n.operationFinanciere.compte.rice.codeActiviteCompte||"04"===n.operationFinanciere.compte.rice.codeActiviteCompte||"05"===n.operationFinanciere.compte.rice.codeActiviteCompte||"06"===n.operationFinanciere.compte.rice.codeActiviteCompte||"10"===n.operationFinanciere.compte.rice.codeActiviteCompte||"11"===n.operationFinanciere.compte.rice.codeActiviteCompte?n.operationFinanciere.segmentPrvRio.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.VERSEMENT_OAD_INTERNE_CTR:"08"===n.operationFinanciere.compte.rice.codeActiviteCompte&&(n.operationFinanciere.segmentPrvRio.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.VERSEMENT_OAD_EXTERNE)),null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_DEPOT,this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.traitementSpecifiqueLibelleComplementaire2(),this.estVersement=!0},n.prototype.initialisationOperationRetrait=function(e){var n=this;this.operationFinanciere&&this.operationFinanciere.codeOperation!==i.Constantes.OperationFinanciere.CODE_OPERATION_A&&(this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N),this.operationFinanciere.billetterieOuvertParDefaut=!1,this.afficherSolde=!0,this.afficherReferenceIdentite=!1,this.afficherRepartitionParFonctionnalite=!0,this.afficherAccreditif=!1,this.operationFinanciere.compte&&(this.comptePourLeSolde=new MyWay.Model.Contrat,this.comptePourLeSolde.riceContrat=this.operationFinanciere.compte.rice.formatRicePourStructureEchange(),this.comptePourLeSolde.devise=this.operationFinanciere.compte.devise,this.comptePourLeSolde.codeDeviseContrat=this.operationFinanciere.compte.devise.code),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.operationFinanciereService.initSegmentPrvRioOperationRetrait(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_RETRAIT,this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!0,this.estVersement=!1,this.traitementSpecifiqueLibelleComplementaire2()},n.prototype.initialisationOperationDepot=function(e){var n=this;this.operationFinanciere&&this.operationFinanciere.codeOperation!==i.Constantes.OperationFinanciere.CODE_OPERATION_A&&(this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N),this.operationFinanciere.billetterieOuvertParDefaut=!1,this.afficherSolde=!0,this.operationFinanciere&&!this.operationFinanciere.estOperationRegularisation&&(this.afficherVracParFonctionnalite=!0),this.afficherReferenceIdentite=!1,this.afficherAccreditif=!1,this.operationFinanciere.compte&&(this.comptePourLeSolde=new MyWay.Model.Contrat,this.comptePourLeSolde.riceContrat=this.operationFinanciere.compte.rice.formatRicePourStructureEchange(),this.comptePourLeSolde.devise=this.operationFinanciere.compte.devise,this.comptePourLeSolde.codeDeviseContrat=this.operationFinanciere.compte.devise.code),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.operationFinanciereService.initSegmentPrvRioOperationDepot(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_DEPOT,this.afficherPlusieursChequesParFonctionnalite=!0,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.estVersement=!0,this.traitementSpecifiqueLibelleComplementaire2()},n.prototype.initialisationOuvertureCompteDat=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.afficherSolde=!1,this.montantDesactive=!0,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioOuvertureCompte(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1,this.estVersement=!0},n.prototype.initialisationOuvertureCompteCantonnement=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.afficherSolde=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioOuvertureCompteCantonnement(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.estVersement=!0,this.afficherLibelleComplementaire2ParFonctionnalite=!1},n.prototype.modificationReferenceIdentite=function(){angular.isDefined(this.operationFinanciere.segmentPrvRio)&&null!==this.operationFinanciere.segmentPrvRio&&(this.operationFinanciere.segmentPrvRio.identiteParticipant=this.referenceIdentite,this.serviceAgentExtended.addToContext(this.cleSegmentPrvRrio,this.operationFinanciere.segmentPrvRio))},n.prototype.modificationTitulaireCompte=function(){this.determinerActivationBoutonValider()},n.prototype.modificationLibelleComplementaire=function(){this.determinerActivationBoutonValider()},n.prototype.modificationReferenceOAD=function(){this.determinerActivationBoutonValider()},n.prototype.initialisationOuvertureEpargne=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.operationFinanciereValueService.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.afficherSolde=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioOuvertureLivret(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=n.checkMemoSegmentPrvRio(e,"saisie-operantion-financiere.ts => initialisationOuvertureEpargne() => "),null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut&&n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(e){e&&(n.operationFinanciere.segmentPrvRio.modeFinancierNumerique=n.codeModeFinancierParDefaut,n.operationFinanciere.segmentPrvRio.modeFinancierChoisi=e.CTGXMF,n.operationFinanciereValueService.operationFinanciere.modeFinancier=e,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,n.operationFinanciere.segmentPrvRio).then(function(){n.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => initialisationOuvertureEpargne() => segmentPrvRio Ajouté au contexte : ",JSON.stringify(n.operationFinanciere.segmentPrvRio)),n.serviceAgentExtended.addToContext(n.cleModeFinancier,e).then(function(){n.operationFinanciere.modeFinancier=e,n.serviceAgentExtended.Trace.debug("saisie-operation-financiere-controller.ts => initialisationOuvertureEpargne()  => modeFinancier Ajouté au contexte : ",JSON.stringify(n.operationFinanciere.modeFinancier))})}))}),n.operationFinanciereValueService.operationFinanciere.segmentPrvRio=n.operationFinanciere.segmentPrvRio}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.estVersement=!0,this.afficherLibelleComplementaire2ParFonctionnalite=!1},n.prototype.initialisationExtourneOuverturePEA=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_A,this.afficherSolde=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!0,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.libelleVirementInterne=i.Constantes.OperationFinanciere.LIBELLE_VIREMENT_INTERNE_CREDITE,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioPEA(this.operationFinanciere,e,MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1,this.estVersement=!1},n.prototype.initialisationExtourneCloturePEA=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_A,this.afficherSolde=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!0,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioPEA(this.operationFinanciere,e,MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1,this.estVersement=!0},n.prototype.initialisationOuverturePEA=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.afficherSolde=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.libelleVirementInterne=i.Constantes.OperationFinanciere.LIBELLE_VIREMENT_INTERNE_DEBITE_DEFAUT,this.desactiveSigneMoins=!0,this.afficherRice=!1,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioPEA(this.operationFinanciere,e,MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1,this.estVersement=!0},n.prototype.initialisationOuvertureCEL=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.afficherSolde=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.desactiveSigneMoins=!0,this.afficherRice=!1,this.operationFinanciereService.initSegmentPrvRioOuvertureCEL(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){i&&(e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i}))}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.estVersement=!0,this.afficherLibelleComplementaire2ParFonctionnalite=!1},n.prototype.calculPlafondVersementService=function(){var e=this,i=this.$q.defer();return this.operationFinanciere.compte&&!this.operationFinanciere.compte.produit&&this.operationFinanciere.compte.rice&&""!==this.operationFinanciere.compte.rice.codeActiviteCompte&&null!==this.operationFinanciere.compte.rice.codeActiviteCompte&&(this.operationFinanciere.compte.produit=new MyWay.Model.Produit,this.operationFinanciere.compte.produit.CODIPR="00"+this.operationFinanciere.compte.rice.codeActiviteCompte,console.log("Code Produit corrigé : "+this.operationFinanciere.compte.produit.CODIPR)),this.operationFinanciere&&this.operationFinanciere.contexteSaisieOperationFinanciere&&this.operationFinanciere.modeFinancier&&this.operationFinanciere.compte&&this.operationFinanciere.compte.produit?this.operationFinanciereService.getPlafondVersement(this.operationFinanciere.contexteSaisieOperationFinanciere.codeEtablissement,this.operationFinanciere.modeFinancier.CTGXM1,this.operationFinanciere.compte.produit.CODIPR).then(function(n){e.operationFinanciere.plafondVersement.plafondVersementRest=n,i.resolve()})["catch"](function(n){e.operationFinanciere.plafondVersement.plafondVersementRest=null,i.resolve()}):i.resolve(),i.promise},n.prototype.initialisationClotureCompte=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.afficherSolde=!0,this.montantDesactive=!0,this.afficherRice=!0,this.afficherAccreditif=!1,this.libelleVirementInterne=i.Constantes.OperationFinanciere.LIBELLE_VIREMENT_INTERNE_CREDITE,this.operationFinanciere.compte&&(this.comptePourLeSolde=new MyWay.Model.Contrat,this.comptePourLeSolde.riceContrat=this.operationFinanciere.compte.rice.formatRicePourStructureEchange(),this.comptePourLeSolde.devise=this.operationFinanciere.compte.devise,this.comptePourLeSolde.codeDeviseContrat=this.operationFinanciere.compte.devise.code),this.operationFinanciereService.initSegmentPrvRioClotureCompte(this.operationFinanciere,e,!1).then(function(e){n.operationFinanciere.montant=-1*n.operationFinanciere.montant,n.montantDevise.montant=n.operationFinanciere.montant,n.operationFinanciere.segmentPrvRio=e,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1;var t=new MyWay.Model.Contrat;t.riceContrat=this.operationFinanciere.compte&&this.operationFinanciere.compte.rice?this.operationFinanciere.compte.rice.formatRicePourStructureEchange():"",t.identifiantPersonne=this.operationFinanciere.client?this.operationFinanciere.client.numeroPersonne:"",this.operationFinanciere.compteAEnleverListeComptesVirementInterne=t},n.prototype.ouvertureRepartition=function(){var i=this,n=new e.comOpesFinancieres.Model.ParametreRepartition;this.montantDevise&&(n.montantTotal=this.montantDevise),this.operationFinanciere.compte&&this.operationFinanciere.compte.rice&&(n.rice=this.operationFinanciere.compte.rice);var t=null;this.operationFinanciere.typeRechercheListeCompteVirementInterne&&(t=this.operationFinanciere.typeRechercheListeCompteVirementInterne);var r=null;this.operationFinanciere.codeEtatRechercheListeCompteVirementInterne&&(r=this.operationFinanciere.codeEtatRechercheListeCompteVirementInterne);var o=null;this.operationFinanciere.listeNumerosPersonnesPourVirementInterne&&(o=this.operationFinanciere.listeNumerosPersonnesPourVirementInterne);var a;this.operationFinanciere.client.numeroPersonne&&(a=this.operationFinanciere.client.numeroPersonne);var s=null;this.operationFinanciere.listeTypesProduitsPourVirementInterne&&(s=this.operationFinanciere.listeTypesProduitsPourVirementInterne);var c=null;this.operationFinanciere.compte&&this.operationFinanciere.compte.devise&&this.operationFinanciere.compte.devise.code&&(c=this.operationFinanciere.compte.devise.code);var l=null;this.operationFinanciere.compteAEnleverListeComptesVirementInterne&&(l=this.operationFinanciere.compteAEnleverListeComptesVirementInterne);var p=!1;this.operationFinanciere.restituerCompteCCIPourListeComptes&&(p=this.operationFinanciere.restituerCompteCCIPourListeComptes),n.parametreListeComptes=this.operationFinanciereService.creationObjetParametreListeComptes(t,r,o,a,s,c,l,p),this.operationFinanciere&&this.operationFinanciere.repartition&&(n.repartitionMemorisee=this.operationFinanciere.repartition),this.repartitionService.ouvrirRepartition(n).then(function(n){n&&(i.operationFinanciere.repartition=n,i.operationFinanciereValueService.operationFinanciere.repartition=n,i.operationFinanciere.segmentPrvRio&&((angular.isUndefined(i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)||null==i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR)&&(i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR=[new e.comOpesFinancieres.Model.SegmentPRVRIOUGR]),i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte=i.operationFinanciere.compte&&i.operationFinanciere.compte.rice?i.operationFinanciere.compte.rice.formatRicePourStructureEchange():"",n.montantDevise1&&n.montantDevise1.montant?(i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].montantVirement=n.montantDevise1.montant,i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement=n.libelle1&&""!==n.libelle1?n.libelle1:""):(i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].montantVirement=0,i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement=""),n.compteCredite2&&n.compteCredite2.riceContrat?i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].numeroCompte=n.compteCredite2.riceContrat:n.compteCredite2&&n.compteCredite2.itemBottomSelectionne&&n.rice2&&n.rice2.isComplete()?i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].numeroCompte=n.rice2.formatRicePourStructureEchange():i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].numeroCompte="",n.montantDevise2&&n.montantDevise2.montant?(i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].montantVirement=n.montantDevise2.montant,i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].libelleVirement=n.libelle2&&""!==n.libelle2?n.libelle2:""):(i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].montantVirement=0,i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[1].libelleVirement=""),n.compteCredite3&&n.compteCredite3.riceContrat?i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].numeroCompte=n.compteCredite3.riceContrat:n.compteCredite3&&n.compteCredite3.itemBottomSelectionne&&n.rice3&&n.rice3.isComplete()?i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].numeroCompte=n.rice3.formatRicePourStructureEchange():i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].numeroCompte="",n.montantDevise3&&n.montantDevise3.montant?(i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].montantVirement=n.montantDevise3.montant,i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].libelleVirement=n.libelle3&&""!==n.libelle3?n.libelle3:""):(i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].montantVirement=0,i.operationFinanciere.segmentPrvRio.S_PRVRIOUGR[2].libelleVirement=""),i.operationFinanciereValueService.operationFinanciere.segmentPrvRio=i.operationFinanciere.segmentPrvRio,i.serviceAgentExtended.addToContext(i.cleSegmentPrvRrio,i.operationFinanciere.segmentPrvRio)))})},n.prototype.initialisationVersement=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),this.typeRechercheCompte="rice",this.afficherRice=!0,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioVersement(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1,this.estVersement=!0},n.prototype.initialisationOuverturePEL=function(e){var n=this;this.operationFinanciere.codeOperation=i.Constantes.OperationFinanciere.CODE_OPERATION_N,this.afficherSolde=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)?this.montantDesactive=this.operationFinanciere.estDesactiverSaisieMontant:this.montantDesactive=!1,angular.isDefined(this.operationFinanciere.estDesactiverSaisieMontant)&&angular.isDefined(this.operationFinanciere.montant)&&(this.montantDevise.montant=this.operationFinanciere.montant),
this.desactiveSigneMoins=!0,this.afficherRice=!1,this.afficherAccreditif=!1,this.operationFinanciereService.initSegmentPrvRioOuverturePEL(this.operationFinanciere,e).then(function(e){n.operationFinanciere.segmentPrvRio=e,null!==n.codeModeFinancierParDefaut&&angular.isDefined(n.codeModeFinancierParDefaut)&&""!==n.codeModeFinancierParDefaut?n.modeFinancierService.getByCTGXM1(n.codeModeFinancierParDefaut).then(function(i){e.modeFinancierNumerique=n.codeModeFinancierParDefaut,e.modeFinancierChoisi=i.CTGXMF,n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e).then(function(){n.operationFinanciere.modeFinancier=i})}):n.serviceAgentExtended.addToContext(n.cleSegmentPrvRrio,e)}),this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherLibelleComplementaire2ParFonctionnalite=!1,this.estVersement=!0},n.prototype.ouverturePlusieursCheques=function(){var i=this;this.plusieursChequesService.ouvrirPlusieursCheques(this.montantDevise,this.operationFinanciere.plusieursCheques).then(function(n){i.operationFinanciere.plusieursCheques=n,i.operationFinanciere&&i.operationFinanciere.modeFinancier&&i.operationFinanciere.modeFinancier.CTGXM1===e.comOpesFinancieres.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&n&&n.length>0&&(i.operationFinanciere.segmentPrvRio.S_CHEQUE=new e.comOpesFinancieres.Model.SegmentCheque,i.operationFinanciere.segmentPrvRio.S_CHEQUE.modeFonctionnement="0",i.operationFinanciere.segmentPrvRio.S_CHEQUE.montant=i.operationFinanciere.montant,i.operationFinanciere.segmentPrvRio.S_CHEQUE.deviseMontant=i.operationFinanciere.compte.devise.code,angular.forEach(n,function(n){if(n&&n.montant){var t=new e.comOpesFinancieres.Model.SegmentInfoCheque;t.deviseCheque=n.codeDevise,t.montantCheque=n.montant,i.operationFinanciere.segmentPrvRio.S_CHEQUE.S_INFOCHEQUE.push(t)}}))})},n.prototype.afficheFacturationAuto=function(){var e=!1;return this.afficherFacturationAutomatiqueParModeFinancier&&this.operationFinanciere.facturationPrestation&&this.operationFinanciere.facturationPrestation.montant&&this.operationFinanciere.facturationPrestation.montant.montant>0&&(e=!0),e},n.prototype.traitementSpecifiqueCloture=function(){if(this.operationFinanciere&&this.operationFinanciere.fonctionnalite&&(this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_CLOTURE_COMPTE_MAJ||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_CLOTURE_CDD_MAJ)){var e=new MyWay.Model.Contrat;e.riceContrat=this.operationFinanciere.compte&&this.operationFinanciere.compte.rice?this.operationFinanciere.compte.rice.formatRicePourStructureEchange():"",e.identifiantPersonne=this.operationFinanciere.client?this.operationFinanciere.client.numeroPersonne:"",this.operationFinanciere.compteAEnleverListeComptesVirementInterne=e,this.libelleVirementInterne=i.Constantes.OperationFinanciere.LIBELLE_VIREMENT_INTERNE_CREDITE}},n.prototype.traitementSpecifiqueDepotRetrait=function(){var e=this;if(this.traitementSpecifiqueLibelleComplementaire2(),this.operationFinanciere&&this.operationFinanciere.fonctionnalite&&this.operationFinanciere.fonctionnalite.toString().indexOf("DEPOT")>0&&(this.operationFinanciere.billetterieOuvertParDefaut=!1,this.operationFinanciere.compte&&this.operationFinanciere.compte.rice&&("12"===this.operationFinanciere.compte.rice.codeActiviteCompte||"13"===this.operationFinanciere.compte.rice.codeActiviteCompte||"14"===this.operationFinanciere.compte.rice.codeActiviteCompte||"15"===this.operationFinanciere.compte.rice.codeActiviteCompte||"16"===this.operationFinanciere.compte.rice.codeActiviteCompte))){var n=this.operationFinanciere.compte.rice.codeActiviteCompte+this.operationFinanciere.compte.rice.radical+this.operationFinanciere.compte.rice.cleCompte;this.miniProfilService.getMiniProfil(this.operationFinanciere.compte.rice.codeEtablissement,i.Constantes.ConstantesSolde.MINI_PROFIL_TYPE_RECHERCHE_RICE,i.Constantes.ConstantesSolde.MINI_PROFIL_TYPE_RESTITUTION_UNITAIRE,this.operationFinanciere.compte.rice.codeGuichet.value,"00"+this.operationFinanciere.compte.rice.codeActiviteCompte,n).then(function(i){i&&1===i.length&&i[0].detailSoldeDisponible&&("NR"===i[0].detailSoldeDisponible.codeEtatContractuelAnniversaire?e.texteAnniversaire="Non-Respect au dernier anniversaire":"RT"===i[0].detailSoldeDisponible.codeEtatContractuelAnniversaire&&(e.texteAnniversaire="Respect au dernier anniversaire"))})}this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_COMPTE_88?(this.operationFinanciere.billetterieOuvertParDefaut=!1,this.operationFinanciere.compte&&(this.comptePourLeSolde=new MyWay.Model.Contrat,this.comptePourLeSolde.riceContrat=this.operationFinanciere.compte.rice.formatRicePourStructureEchange(),this.comptePourLeSolde.devise=this.operationFinanciere.compte.devise,this.comptePourLeSolde.codeDeviseContrat=this.operationFinanciere.compte.devise.code),this.afficherSolde=!0,this.operationFinanciere&&!this.operationFinanciere.estOperationRegularisation&&(this.afficherVracParFonctionnalite=!0),this.afficherPlusieursChequesParFonctionnalite=!0,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_DEPOT,this.afficherReferenceIdentite=!1):this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_COMPTE_88?(this.operationFinanciere.billetterieOuvertParDefaut=!1,this.operationFinanciere.compte&&(this.comptePourLeSolde=new MyWay.Model.Contrat,this.comptePourLeSolde.riceContrat=this.operationFinanciere.compte.rice.formatRicePourStructureEchange(),this.comptePourLeSolde.devise=this.operationFinanciere.compte.devise,this.comptePourLeSolde.codeDeviseContrat=this.operationFinanciere.compte.devise.code),this.afficherSolde=!0,this.afficherVracParFonctionnalite=!1,this.afficherRepartitionParFonctionnalite=!0,this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!0,this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_RETRAIT,this.afficherReferenceIdentite=!1):this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_OAD?(this.operationFinanciere.billetterieOuvertParDefaut=!1,this.afficherTitulaireCompteParFonctionnalite=!0,this.operationFinanciere&&this.operationFinanciere.estOperationDepotRetraitInterne?this.afficherSolde=!0:this.afficherSolde=!1,this.afficherVracParFonctionnalite=!1,this.afficherReferenceIdentite=!1,this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!1,this.afficherRepartitionParFonctionnalite=!1,this.afficherAccreditif=!1,this.afficherReferenceOAD=!0,this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_DEPOT):this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_OAD?(this.operationFinanciere.billetterieOuvertParDefaut=!1,this.afficherTitulaireCompteParFonctionnalite=!0,this.operationFinanciere&&this.operationFinanciere.estOperationDepotRetraitInterne?this.afficherSolde=!0:this.afficherSolde=!1,this.operationFinanciere.compte&&(this.comptePourLeSolde=new MyWay.Model.Contrat,this.comptePourLeSolde.riceContrat=this.operationFinanciere.compte.rice.formatRicePourStructureEchange(),this.comptePourLeSolde.devise=this.operationFinanciere.compte.devise,this.comptePourLeSolde.codeDeviseContrat=this.operationFinanciere.compte.devise.code),this.afficherVracParFonctionnalite=!1,this.afficherReferenceIdentite=!1,this.afficherPlusieursChequesParFonctionnalite=!1,this.afficherFacturationAutomatiqueParFonctionnalite=!0,this.afficherRepartitionParFonctionnalite=!1,this.operationFinanciere&&this.operationFinanciere.modeFinancier&&this.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&(this.afficherChequeBanque=!0),this.afficherAccreditif=!0,this.afficherReferenceOAD=!0,this.libelleMontant=i.Constantes.OperationFinanciere.LIBELLE_MONTANT_RETRAIT):this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_EXTOURNE_OUVERTURE_PEA&&(this.libelleVirementInterne=i.Constantes.OperationFinanciere.LIBELLE_VIREMENT_INTERNE_CREDITE)},n.prototype.traitementSpecifiqueDepotRetraitOpérationMultiple=function(){var n=this;return this.operationFinanciere&&this.operationFinanciere.modeFinancier&&this.operationFinanciere.modeFinancier.CTGXM1&&!this.isFonctionOverture()&&!this.operationFinanciere.estRepriseOffre?(this.operationFinanciere.libelleOperation=new e.comOpesFinancieres.Model.LibelleOperation("",""),this.getLibelleOperation().then(function(){return n.$scope.$broadcast("mode_financier_changed",n.operationFinanciere.modeFinancier.CTGXM1),n.affichageBlocsParModeFinancier(n.operationFinanciere.modeFinancier.CTGXM1)}).then(function(){n.$scope.$broadcast("desactivation_case_vrac")}).then(function(){return n.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||n.operationFinanciere.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS?n.calculPlafondVersementService():void 0})):void 0},n.prototype.showTitulaireCompteParFonctionnalite=function(){return this.isCarteTMFRetraitOAD()?!1:this.afficherTitulaireCompteParFonctionnalite},n.prototype.isCompteDebiteEnOpposition=function(){return this.carteTMFModeRetraitOADActive&&this.carteTMFCochee&&this.carteTempoMultiFonctionsService.isRetraitOADTMFOpposition()},n.prototype.forceRetraitOADTMF=function(){return this.carteTMFModeRetraitOADActive&&this.carteTempoMultiFonctionsService.forceRetraitOADTMF()},n.prototype.isCarteTMFRetraitOAD=function(){return this.carteTMFModeRetraitOADActive&&this.afficherCaseCarteTMF&&this.carteTMFCochee},n.prototype.isCarteTMFRetrait=function(){return this.carteTMFModeRetraitActive&&this.afficherCaseCarteTMF&&this.carteTMFCochee},n.prototype.isCarteTMFDepot=function(){return this.carteTMFModeDepotActive&&this.afficherCaseCarteTMF&&this.carteTMFCochee},n.prototype.verifieEstTraitementTermine=function(){this.estTraitementMontantTermine&&(this.estTraitementRiceTermine||this.estTraitementRiceInterneTermine||this.estTraitementListeCompteTermine)&&(this.estTraitementTermineDeferred.resolve(),(this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE_COMPTE_88||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_HORS_CLIENTELE||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_HORS_CLIENTELE_COMPTE_88)&&document.getElementById("mode-financier")&&this.estPlacerFocusModeFinancierInitialisation===!1&&(document.getElementById("mode-financier").focus(),this.estPlacerFocusModeFinancierInitialisation=!0))},n.prototype.traitementSpecifiqueLibelleComplementaire2=function(){var e=this;this.operationFinanciere&&this.operationFinanciere.compte&&this.operationFinanciere.compte.rice&&this.operationFinanciere.client&&this.operationFinanciere.compte&&this.operationFinanciere.compte.rice&&"08"===this.operationFinanciere.compte.rice.codeActiviteCompte&&(this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE||this.operationFinanciere.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_HORS_CLIENTELE)&&(this.afficherLibelleComplementaire2ParFonctionnalite=!0,this.loading=!0,this.libelleComplementaire2Service.estLibelleComplementaire2Obligatoire(this.operationFinanciere.compte.rice.codeEtablissement,parseInt(this.operationFinanciere.client.numeroPersonne)).then(function(i){e.loading=!1,e.estObligatoireSaisieLibelleComplementaire2=i})["finally"](function(){e.loading=!1}))},n.prototype.actionCaseChoixBilletterie=function(){this.choixBilletterieChecked?this.operationFinanciere.choixBilletterieTMF=!0:this.operationFinanciere.choixBilletterieTMF=!1},n.prototype.checkMemoSegmentPrvRio=function(e,i){return null!==e?(this.operationFinanciere.segmentPrvRio=e,this.serviceAgentExtended.Trace.debug(i+"this.operationFinanciere.segmentPrvRio Déjà initialisé =>",JSON.stringify(this.operationFinanciere.segmentPrvRio)),null!==this.operationFinanciereValueService.operationFinanciere.segmentPrvRio?(this.serviceAgentExtended.Trace.warning(i+"this.operationFinanciereValueService.operationFinanciere.segmentPrvRio Déjà initialisé =>",JSON.stringify(this.operationFinanciereValueService.operationFinanciere.segmentPrvRio)),angular.equals(this.operationFinanciere,this.operationFinanciereValueService.operationFinanciere)?(this.serviceAgentExtended.Trace.debug(i+"this.operationFinanciereValueService.operationFinanciere.segmentPrvRio Egal à this.operationFinanciere.segmentPrvRio",null),this.operationFinanciereValueService.operationFinanciere=this.operationFinanciere):(this.serviceAgentExtended.Trace.warning(i+"this.operationFinanciereValueService.operationFinanciere.segmentPrvRio Différent de this.operationFinanciere.segmentPrvRio",null),this.operationFinanciereValueService.operationFinanciere=this.operationFinanciere,this.serviceAgentExtended.Trace.warning(i+"this.operationFinanciereValueService.operationFinanciere Ré-Initialisé ",null))):(this.operationFinanciereValueService.operationFinanciere=this.operationFinanciere,this.serviceAgentExtended.Trace.warning(i+"this.operationFinanciereValueService.operationFinanciere.segmentPrvRio Initialisé =>",JSON.stringify(this.operationFinanciereValueService.operationFinanciere.segmentPrvRio))),this.serviceAgentExtended.Trace.debug(i+"this.operationFinanciere = ",JSON.stringify(this.operationFinanciere)),e):null!==this.operationFinanciereValueService.operationFinanciere.segmentPrvRio?(this.operationFinanciere=this.operationFinanciereValueService.operationFinanciere,this.serviceAgentExtended.Trace.debug(i+"this.operationFinanciere RE-initialisé => ",JSON.stringify(this.operationFinanciere.segmentPrvRio)),this.serviceAgentExtended.Trace.debug(i+"this.operationFinanciere = ",JSON.stringify(this.operationFinanciere)),this.operationFinanciereValueService.operationFinanciere.segmentPrvRio):(this.serviceAgentExtended.Trace.error(i+"this.operationFinanciere.segmentPrvRio Non initialisé => ",JSON.stringify(this.operationFinanciere.segmentPrvRio)),null)},n.prototype.checkMemoOperationFinanciere=function(e){return angular.isUndefined(this.operationFinanciere)||null===this.operationFinanciere?angular.isDefined(this.operationFinanciereValueService.operationFinanciere)&&null!==this.operationFinanciereValueService.operationFinanciere?(this.operationFinanciere=this.operationFinanciereValueService.operationFinanciere,this.serviceAgentExtended.Trace.debug(e+" this.operationFinanciere RE-initialisé =>",JSON.stringify(this.operationFinanciere)),this.operationFinanciereValueService.operationFinanciere):(this.serviceAgentExtended.Trace.error(e+" this.operationFinanciere Non initialisé =>",JSON.stringify(this.operationFinanciere)),null):(this.serviceAgentExtended.Trace.debug(e+" this.operationFinanciere Déjà initialisé =>",JSON.stringify(this.operationFinanciere)),angular.isUndefined(this.operationFinanciereValueService.operationFinanciere)||null===this.operationFinanciereValueService.operationFinanciere?(this.operationFinanciereValueService.operationFinanciere=this.operationFinanciere,this.serviceAgentExtended.Trace.debug(e+" this.operationFinanciereValueService.operationFinanciere Initialisé => ",JSON.stringify(this.operationFinanciere))):(this.serviceAgentExtended.Trace.debug(e+" this.operationFinanciereValueService.operationFinanciere Déjà initialisé => ",JSON.stringify(this.operationFinanciereValueService.operationFinanciere)),angular.equals(this.operationFinanciere,this.operationFinanciereValueService.operationFinanciere)?this.serviceAgentExtended.Trace.warning(e+" this.operationFinanciereValueService.operationFinanciere Egal à this.operationFinanciere"):(this.serviceAgentExtended.Trace.warning(e+" this.operationFinanciereValueService.operationFinanciere Différent de this.operationFinanciere",null),this.operationFinanciereValueService.operationFinanciere=this.operationFinanciere,this.serviceAgentExtended.Trace.debug(e+" this.operationFinanciereValueService.operationFinanciere RE-Initialisé => ",JSON.stringify(this.operationFinanciere)))),this.operationFinanciere)},n.prototype.estUneOuverture04VPC=function(){return this.remplirModesFinancier(),MyWay.Services.StringUtils.startsWith(this.operationFinanciere.fonctionnalite.toString(),i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_CDD_MAJ)&&"04"===this.operationFinanciere.compte.rice.codeActiviteCompte&&"TL"===this.operationFinanciere.canal&&"VPC"===this.operationFinanciere.modeDeVente},n.prototype.remplirModesFinancier=function(){if(this.modeFinancierDesactive=!1,this.modeFinancierModes||(this.modeFinancierModes=[]),this.modeFinancierModes&&0===this.modeFinancierModes.length&&this.$scope.$$childHead&&this.$scope.$$childHead.modeFinancierController&&this.$scope.$$childHead.modeFinancierController.modes){this.modeFinancierModes=angular.copy(this.$scope.$$childHead.modeFinancierController.modes);var e=new MyWay.Model.ModeFinancier;e.CIJMMC="O",e.CIJMMS="O",e.CTGXM1="99",e.CTGXMF="ESP",e.LIJMMI="OUVERTURE À ZERO EURO",this.modeFinancierModes.push(e)}},n.prototype.labelModesFinancier=function(e){return e?e.CTGXM1+" "+e.LIJMMI:"***ERREUR***"},n.$inject=["$scope","serviceAgentExtended","operationFinanciereService","compteService","modeFinancierService","mwsfDeviseService","modalService","InterDomainCoreService","$q","repartitionService","plusieursChequesService","facturationAutomatiqueService","miniProfilService","carteTempoMultiFonctionsService","caisseAutoService","saisieRiceService","listeCompteService","champsErreursOpeFiService","libelleComplementaire2Service","operationFinanciereValueService"],n.NIVEAU_DEFAUT_INTERIEUR_PANEL="3",n.NIVEAU_DEFAUT_PANEL_PRINCIPAL="2",n}();i.SaisieOperationFinanciereController=n,i.module.controller("SaisieOperationFinanciereController",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/saisie-operation-financiere/saisie-operation-financiere-view.html",replace:!0,controller:"SaisieOperationFinanciereController",controllerAs:"viewSaisieOperationFinanciere",bindToController:!0,scope:{operationFinanciere:"=",codeModeFinancierParDefaut:"=?",niveauInterieurPanel:"@?",niveauPanelPrincipal:"@?",estTraitementTermine:"=?",champsErreursOpefi:"=?",estModeFinancierDesactive:"=?",estLibelleOperationDesactive:"=?"}}}e.mwsfSaisieOperationFinanciere=i,e.module.directive("mwsfSaisieOperationFinanciere",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i){this.serviceAgentExtended=e,this.identifiantBordereauService=i}return e.prototype.getNumPlan=function(){return this.serviceAgentExtended.getFromContext("NUMPLAN").then(function(e){return null===e&&(e="1"),console.log("numplan :"+e),e})},e.prototype.deposerEspeces=function(e,i,n){var t=this;console.log("appel isPosteCaisseAuto");var r=this.serviceAgentExtended;return r.getParametresComptables().then(function(o){if(console.log(o.typeCA),"R"!==o.typeCA)return 0;console.log("depotcaisse");var a="DEPOT";return a+=_.padLeft(e,7,"0"),a+="EUR",t.identifiantBordereauService.getIdentifiantBordereau(i,!1).then(function(i){return a+=_.padLeft(i,14," "),a+=_.padLeft(String(n),15,"0"),t.getNumPlan().then(function(o){return a+=o,a+=_.padLeft("",255," "),a+=_.padLeft("",255," "),t.serviceAgentExtended.TraitementNsdk.Lancer("depot",a).then(function(t){console.log("retourdepotcaisse"),console.log("-->"+t);var o=Number(t.replace(/"/g,""));return console.log("-->"+o),0!==o?r.Context.AddToContext("DepotCAR",_.padLeft(e,7,"0")+"|EUR|"+_.padLeft(i,13," ")+"|"+_.padLeft(String(n),15,"0")).then(function(){return o}):0})})})})},e.prototype.annulerDepotEspeces=function(){var e=this;console.log("passage dans annuler dépot");var i=this.serviceAgentExtended;return i.getParametresComptables().then(function(n){return console.log(n.typeCA),"R"!==n.typeCA?0:void i.Context.GetFromContext("DepotCAR").then(function(n){if(console.log("la valeur recuperee est :"+n),n){var t=n.split("|");console.log("annulcaisse");var r="ANDEP";return r+=t[0],r+=t[1],r+=t[2],r+=t[3],e.getNumPlan().then(function(n){r+=n,r+=_.padLeft("",255," "),r+=_.padLeft("",255," "),console.log(r);var t;return e.serviceAgentExtended.TraitementNsdk.Lancer("annul",r).then(function(e){console.log("retourannulcaisse"),console.log("-->"+e),t=Number(e.replace('"',"").replace('"',""))})["finally"](function(){i.Context.AddToContext("DepotCAR","").then(function(){return t})})})}return 0})})},e.prototype.inventaireEspeces=function(){var e=this;console.log("appel isPosteCaisseAuto");var i=this.serviceAgentExtended;return i.getParametresComptables().then(function(i){if(console.log(i.typeCA),"R"!==i.typeCA)return 0;console.log("depotcaisse");var n="INVEN9990774EURO0SEC281-12345         123.12";return n+=_.padLeft("",255," "),n+=_.padLeft("",255," "),e.serviceAgentExtended.TraitementNsdk.Lancer("depot",n).then(function(e){console.log("retourdepotcaisse"),console.log("-->"+e);var i=Number(e.replace(/"/g,""));return i})})},e.$inject=["serviceAgentExtended","identifiantBordereauService"],e}();e.CaisseAutoService=i,e.module.service("caisseAutoService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(){}return i.prototype.getChampErreurModeFinancierVide=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_MODE_FINANCIER,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_MODE_FINANCIER_VIDE};return i},i.prototype.getChampErreurReferenceOAD=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_REFERENCE_OAD,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_REFERENCE_OAD};return i},i.prototype.getChampErreurPlafondVersementDepasse=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_MONTANT_OPERATION_FINANCIERE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_PLAFOND_VERSEMENT_DEPASSE};return i},i.prototype.getChampErreurLibelleOperationVide=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_LIBELLE_OPERATION_FINANCIERE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_LIBELLE_OPERATION_VIDE};return i},i.prototype.getChampErreurNumeroChequeBanqueVide=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_NUMERO_CHEQUE_BANQUE_OPERATION_FINANCIERE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_LIBELLE_NUMERO_CHEQUE_BANQUE_VIDE};return i},i.prototype.getChampErreurBeneficiaireChequeBanqueVide=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_BENEFICIAIRE_CHEQUE_BANQUE_OPERATION_FINANCIERE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_LIBELLE_BENEFICIAIRE_CHEQUE_BANQUE_VIDE};return i},i.prototype.getChampErreurMontantVide=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_MONTANT_OPERATION_FINANCIERE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_MONTANT_VIDE};return i},i.prototype.getChampErreurBilletterieIncorrect=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_BILLETTERIE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_BILLETTERIE_INCORRECT};return i},i.prototype.getChampErreurOperationDiverse=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_OPERATION_DIVERSE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_OPERATION_DIVERSE};return i},i.prototype.getChampErreurTitulaireCompte=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_TITULAIRE_COMPTE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_TITULAIRE_COMPTE};return i},i.prototype.getChampErreurLibelleComplementaire=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_LIBELLE_COMPLEMENTAIRE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_LIBELLE_COMPLEMENTAIRE};return i},i.prototype.getChampErreurCompteNonSelectionneVirementInterne=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_LISTE_COMPTE_VIREMENT_INTERNE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_COMPTE_SELECTIONNE_VIREMENT_INTERNE};return i},i.prototype.getChampErreurRiceSaisieIncorrectVirementInterne=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_RICE_SAISIT_VIREMENT_INTERNE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_RICE_SAISIT_VIREMENT_INTERNE};return i},i.prototype.getChampErreurReferenceSac=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_REFERENCE_ENVELOPPE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_REFERENCE_ENVELOPPE};return i},i.prototype.getChampErreurDepassementMontantMax=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_MONTANT_OPERATION_FINANCIERE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_MONTANT_DEPASSE_MONTANT_MAXIMUM};return i},i.prototype.getChampErreurMontantNonMultipleDe10=function(){var i={idChampErreurOpeFi:e.Constantes.IdentfiantsChampsOperationsFinancieres.ID_MONTANT_OPERATION_FINANCIERE,messageErreurChampErreurOpeFi:e.Constantes.MessagesErreursChampsOperationsFinancieres.MESSAGE_MONTANT_NON_MULTIPLE_DE_10};return i},i.$inject=[],i}();e.ChampsErreursOpeFiService=i,e.module.service("champsErreursOpeFiService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function i(e,i,n,t){this.serviceAgentExtended=e,this.modalService=i,this.impressionService=n,this.$q=t}return i.prototype.openPopupChequeBanque=function(i,n,t,r){var o=this;return angular.isUndefined(r)&&(r=new e.comOpesFinancieres.Model.ParamPopupChequeBanque,r.titrePopup="Confirmation XM038A",r.styleBoutonImprimer="secondaire",r.styleBoutonNePasImprimer="principale"),this.impressionService.derogationImpression().then(function(e){var a={headerText:r.titrePopup,numeroCheque:i.numero,montantCheque:i.montantGlobal,deviseCheque:i.devise.code,isDerogationImpression:e,estDerniereContrepartie:i.derniereContrepartie,nePasReprendreChequeEnCours:n,multiRetrait:i.multiRetrait,contexteSaisieOpeFi:t,chequeDeBanqueEnCours:i,styleBoutonImprimer:r.styleBoutonImprimer,styleBoutonNePasImprimer:r.styleBoutonNePasImprimer},s={templateUrl:"typescript/cheque-banque/popup/popup-cheque-banque-view.html",controller:"ModalChequeBanqueController",controllerAs:"viewModelModalChequeBanqueCtrl",windowClass:"app-modal-window-MEG",backdrop:!1,keyboard:!0,size:"lg",resolve:{data:function(){return a}}};return o.modalService.showModal(s).then(function(e){return"ne_pas_imprimer"===e||"imprimer"===e?!0:!1})["catch"](function(e){return o.serviceAgentExtended.Trace.error(e.libelle),!1})})},i.prototype.openPopupChequeBanqueOperationDepotRetrait=function(i,n,t,r,o){var a=this;angular.isUndefined(o)&&(o=new e.comOpesFinancieres.Model.ParamPopupChequeBanque,o.titrePopup="Confirmation XM038A",o.styleBoutonImprimer="secondaire",o.styleBoutonNePasImprimer="principale");var s={headerText:o.titrePopup,numeroCheque:i.numero,montantCheque:i.montantGlobal,deviseCheque:i.devise.code,isDerogationImpression:r,nePasReprendreChequeEnCours:n,contexteSaisieOpeFi:t,chequeDeBanqueEnCours:i,styleBoutonImprimer:o.styleBoutonImprimer,styleBoutonNePasImprimer:o.styleBoutonNePasImprimer},c={templateUrl:"typescript/cheque-banque-operation/popup/popup-cheque-banque-depot-retrait-view.html",controller:"modalChequeBanqueOperationDepotRetraitController",controllerAs:"ctrl",windowClass:"app-modal-window-MEG",backdrop:!1,keyboard:!0,size:"lg",resolve:{data:function(){return s}}};return this.modalService.showModal(c).then(function(e){return"ne_pas_imprimer"===e?!0:"imprimer"===e?!0:!1})["catch"](function(e){return a.serviceAgentExtended.Trace.error(e.libelle),!1})},i.prototype.getNumeroConseiller=function(){return this.serviceAgentExtended.getAuthentificationInfo().then(function(e){var i="";return i=null!=e?i=e.agentConnecte.referenceExterneAgent:""})},i.prototype.getChequeBanqueEnCours=function(e){var i="CLECHEQUEBANQUE_"+e;return this.serviceAgentExtended.getFromSharedContext(i).then(function(e){return e})},i.prototype.setChequeGlobal=function(e,i,n){var t=this,r="CLECHEQUEBANQUE_"+n;return this.serviceAgentExtended.getFromSharedContext(r).then(function(n){var o="";return null!=n?n.numero===e.numero?n.devise.code===e.devise.code?n.modeFinancier.CTGXM1===e.modeFinancier.CTGXM1?(0>i&&(n.montantGlobal+=-1*i),n.beneficiaire=e.beneficiaire,n.derniereContrepartie=e.derniereContrepartie,t.serviceAgentExtended.addToSharedContext(r,n)):o="Le numero de cheque est introuvable pour ce mode financier":o="Le numero de cheque est introuvable pour cette devise":o="Un chèque gobal est déjà réservé (N°"+n.numero+") à l'ordre de "+n.beneficiaire:(e.montantGlobal=-1*i,t.serviceAgentExtended.addToSharedContext(r,e)),""!==o?t.$q.reject(o):o})},i.prototype.imprimerChequeBanque=function(e,i,n){var t,r=this;this.getNumeroConseiller().then(function(o){e.multiRetrait?r.setChequeGlobal(e,i,o).then(function(i){e.derniereContrepartie&&r.getChequeBanqueEnCours(o).then(function(e){return t=e,r.razChequeGlobal(e,o)}).then(function(e){return r.openPopupChequeBanque(t,!1,n)}).then(function(e){})["catch"](function(e){return e})}):r.setChequeGlobal(e,i,o).then(function(e){return r.getChequeBanqueEnCours(o)}).then(function(e){return t=e,r.razChequeGlobal(e,o)}).then(function(e){return r.openPopupChequeBanque(t,!1,n)}).then(function(e){})["catch"](function(e){return e})})},i.prototype.razChequeGlobal=function(e,i){var n=this,t="CLECHEQUEBANQUE_"+i;return this.serviceAgentExtended.getFromSharedContext(t).then(function(i){if(null!=i){var r="";return i.numero===e.numero&&i.devise.code===e.devise.code&&i.modeFinancier.CTGXM1===e.modeFinancier.CTGXM1?n.serviceAgentExtended.removeFromSharedContext(t):r="Le numéro de chèque est introuvable pour cette devise",""!==r?n.$q.reject(r):r}})},i.$inject=["serviceAgentExtended","modalService","impressionService","$q"],i}();i.ChequeBanqueService=n,i.module.service("chequeBanqueService",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,i,n,t){this.serviceAgentExtended=e,
this.$q=i,this.$filter=n,this.operationFinanciereService=t}return n.prototype.postResultatEntretien=function(e,n){console.log("[Suivi commercial] Objet REST :"),console.log(e);var t={};return null!=n&&(t.versionTraitement=n),this.serviceAgentExtended.sendRequest({url:i.Constantes.UrlRest.URL_REST_RESULTAT_ENTETIEN,withHeaders:!0,method:MyWay.Services.MethodEnum.POST,params:t,data:e})},n.prototype.postSuiviCommercialRepartitionChequeBanque=function(e,i,n){var t=this;return this.alimentationObjetEntretienCommercial(e,i,n,!1).then(function(e){return t.postResultatEntretien(e,"B").then(function(){console.log("[Suivi Commercial] Post de la repartition - OK")})})},n.prototype.postSuiviCommercialVirementInterneContrepartie=function(e,i,n,t){var r=this;return e.compte.rice=i?i.rice:null,e.compte.produit=i&&i.produit?i.produit:null,this.alimentationObjetEntretienCommercial(e,!t,n,!1).then(function(e){return r.postResultatEntretien(e,"B").then(function(){console.log("[Suivi Commercial] Post de la contrepartie de virement interne - OK")})})},n.prototype.postSuiviCommercialFacturation=function(e,i){var n=this;return e.facturationPrestation&&e.facturationPrestation.estFacturationPrestation&&""!==e.facturationPrestation.codePrestation?this.alimentationObjetEntretienCommercial(e,!1,i,!0).then(function(i){var t=e.facturationPrestation.montant.montant?e.facturationPrestation.montant.montant:0;return i.montantResultatCommercial=Math.round(t),n.postResultatEntretien(i).then(function(){console.log("[Suivi Commercial] Post de la facturation - OK")})}):this.$q.when(null)},n.prototype.suiviCommercialOperationFinanciere=function(n,t,r,o,a,s){var c=this,l=null!=n.estOperationDepotRetraitCarteTMF&&n.estOperationDepotRetraitCarteTMF?!0:!1;return n&&n.compte&&n.compte.rice&&n.compte.rice.codeActiviteCompte!==i.Constantes.SuiviCommercial.COMPTE_88_INTERDIT&&null!=o&&o&&!l?this.alimentationObjetEntretienCommercial(n,r,t,!1).then(function(i){return n.modeFinancier.CTGXM1===e.comOpesFinancieres.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.segmentPrvRio&&n.segmentPrvRio.S_PRVRIOUGR&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""!==n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte&&(i.montantResultatCommercial=Math.round(n.segmentPrvRio.S_PRVRIOUGR[0].montantVirement)),c.postResultatEntretien(i,"B").then(function(i){if(n.modeFinancier){if(n.modeFinancier.CTGXM1===e.comOpesFinancieres.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES)return c.postSuiviCommercialFacturation(n,t);if(n.modeFinancier.CTGXM1===e.comOpesFinancieres.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&n.segmentPrvRio&&n.segmentPrvRio.S_PRVRIOUGR&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""!==n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte&&null!=a&&a&&null!=s)return c.postSuiviCommercialVirementInterneContrepartie(n,s,t,r);if(n.modeFinancier.CTGXM1===e.comOpesFinancieres.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.segmentPrvRio&&n.segmentPrvRio.S_PRVRIOUGR&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""!==n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte){for(var o=c.$q.when(),l=1;l<n.segmentPrvRio.S_PRVRIOUGR.length;l++)if(""!==n.segmentPrvRio.S_PRVRIOUGR[l].numeroCompte){var p=new e.comOpesFinancieres.Model.OperationFinanciere;angular.copy(n,p),console.log("[Suivi Commercial] -- Repartition Cheque de Banque -- Numero "+l+" sur "+n.segmentPrvRio.S_PRVRIOUGR.length),p.montant=-1*n.segmentPrvRio.S_PRVRIOUGR[l].montantVirement,p.compte.rice=c.operationFinanciereService.decoupageEtCreationRice(n.segmentPrvRio.S_PRVRIOUGR[l].numeroCompte),n.repartition&&(1===l&&n.repartition.compteCredite2?p.compte.produit.IDEGPS=n.repartition.compteCredite2.identifiantProduit?n.repartition.compteCredite2.identifiantProduit.toString():null:2===l&&n.repartition.compteCredite3&&(p.compte.produit.IDEGPS=n.repartition.compteCredite3.identifiantProduit?n.repartition.compteCredite3.identifiantProduit.toString():null)),o=o.then(c.postSuiviCommercialRepartitionChequeBanque.bind(c,p,r,t))}return o.then(function(){return c.postSuiviCommercialFacturation(n,t)})}}})}):this.$q.when(null)},n.prototype.alimentationObjetEntretienCommercial=function(n,t,r,o){var a=n.compte.produit&&n.compte.produit.IDEGPS?parseInt(n.compte.produit.IDEGPS):null,s=n.montant<0?-1*n.montant:n.montant,c={identifiantPersonne:n.client&&n.client.numeroPersonne?parseInt(n.client.numeroPersonne):null,codeTypeProduitServiceGCP:null,codeTypeFamilleResultat:i.Constantes.SuiviCommercial.CODE_FAMILLE_RESULTAT_COMMERCIAL,codeOrigineFonds:i.Constantes.SuiviCommercial.CODE_ORIGINE_FONDS_DEFAUT_RESULTAT_COMMERCIAL,montantResultatCommercial:Math.round(s),indicRattachableCRE:i.Constantes.SuiviCommercial.CODE_INDIC_RATTACHABLE_CRE_RESULTAT_COMMERCIAL,identifiantProduitService:a,codeTypeProduitService:n.compte.rice.codeActiviteCompte?i.Constantes.OperationFinanciere.CODE_PRODUIT_00+n.compte.rice.codeActiviteCompte:null,sousCodeProduitService:null,codeProduitCarte:"",codeModeFinancier:"",codeCaractereForfaitaireOffre:"",indicProduitServiceObligatoire:"",codeNatureResultatCommercial:i.Constantes.SuiviCommercial.CODE_NATURE_RESULTAT_COMMERCIAL_NORMALE};c.codeTypeResultatCommercial=t?i.Constantes.SuiviCommercial.CODE_RESULTAT_COMMERCIAL_VERSEMENT:i.Constantes.SuiviCommercial.CODE_RESULTAT_COMMERCIAL_RETRAIT,r&&(c.codeNatureResultatCommercial=i.Constantes.SuiviCommercial.CODE_NATURE_RESULTAT_COMMERCIAL_ANNULATION,c.montantResultatCommercial<0&&(c.montantResultatCommercial=-1*c.montantResultatCommercial)),c.codeModeGestionLivret=o?"":i.Constantes.SuiviCommercial.CODE_MODE_GESTION_LIVRET_RESULTAT_COMMERCIAL,!n.modeFinancier||n.modeFinancier.CTGXM1!==e.comOpesFinancieres.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.modeFinancier.CTGXM1!==e.comOpesFinancieres.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||(c.codeOrigineFonds=i.Constantes.SuiviCommercial.CODE_ORIGINE_FONDS_ESPECES_CHB_RESULTAT_COMMERCIAL);var l=n.compte&&n.compte.rice?n.compte.rice.codeEtablissement:"",p=a?_.padLeft(a.toString(),7,"0"):null;return this.recupererDonneesUsageProduitsServicesTableDV7I(l,c.codeTypeProduitService,p).then(function(e){return e&&e.length>0&&(c.codeTypeProduitServiceGCP=e[0].CODMPR?_.padLeft(e[0].CODMPR,6," "):"",c.sousCodeProduitService=e[0].COEXSP?e[0].COEXSP:""),c})["catch"](function(e){return c})},n.prototype.recupererDonneesUsageProduitsServicesTableDV7I=function(e,n,t){var r=[{propriete:i.Constantes.TableDelocaliseeDV7I.CODE_ETABLISSEMENT_RUBRIQUE_COCXBQ,valeur:e,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseeDV7I.IDENTIFIANT_PRODUIT_SERVICE_RUBRIQUE_IDEGPS,valeur:t,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseeDV7I.CODE_PRODUIT_SERVICE_RUBRIQUE_CODIPR,valeur:n,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseeDV7I.CODE_MODE_GESTION_RUBRIQUE_CIGLDM,valeur:"1",operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];return this.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(e,i.Constantes.TableDelocaliseeDV7I.NOM_TABLE_DV7I,r).then(function(e){return e.length>0?e:null})},n.$inject=["serviceAgentExtended","$q","$filter","operationFinanciereService"],n}();i.EntretiencommercialResultatEntretienService=n,i.module.service("entretiencommercialResultatEntretienService",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e){this.serviceAgent=e}return e.prototype.getIdentification=function(e,i,n,t){var r={};return null!=e&&(r.codeEtablissement=e),null!=i&&(r.identifiantPersonne=i),null!=n&&(r.eligibiliteEAI=n),null!=t&&(r.parametreAppel=t),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/tiers/v3/identification",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:r})},e.prototype.getCodeObligationSecondLibelle=function(e,i){var n={};return null!=e&&(n.codeEtablissement=e),null!=i&&(n.codeSegmentation=i),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/operationfinanciereparametre/v1/codeObligationLibelle2",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:n})},e.prototype.estLibelleComplementaire2Obligatoire=function(e,i){var n=this,t=!1;return this.getIdentification(e,i,null,"S").then(function(i){if(i&&i.listMarche.length>0){var r=i.listMarche[0].codeTypeSegmentation+i.listMarche[0].codeMarche;return n.getCodeObligationSecondLibelle(e,r).then(function(e){return e&&e.length>0&&(t=e[0].indicateurSaisieSecondLibelle),t})}return t})["finally"](function(){return t})},e.$inject=["serviceAgent"],e}();e.LibelleComplementaire2Service=i,e.module.service("libelleComplementaire2Service",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(e){this.serviceAgentExtended=e}return i.prototype.getMiniProfil=function(e,i,n,t,r,o,a,s,c){var l={};return null!=e&&(l.codeEtablissement=e),null!=t&&(l.codeGuichetInterbancaire=t),null!=r&&(l.codeProduitService=r),null!=o&&(l.referenceProduitService=o),null!=a&&(l.numeroCarteBancaire=a),null!=s&&(l.identifiantEntiteTitulaire=s),null!=c&&(l.identifiantTiers=c),null!=i&&(l.typeRecherche=i),null!=n&&(l.typeRestitution=n),this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/syntheseservice-v1/miniProfil",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:l})},i.prototype.getSoldeMinuteCompte=function(i){if(i&&""!==i){var n=i.substring(0,5),t=i.substring(10,12),r=i.substring(5,10),o=i.substring(10,21);return this.getMiniProfil(n,e.Constantes.ConstantesSolde.MINI_PROFIL_TYPE_RECHERCHE_SOLDE_D,e.Constantes.ConstantesSolde.MINI_PROFIL_TYPE_RESTITUTION_UNITAIRE,r,"00"+t,o).then(function(e){return e&&1===e.length&&e[0].detailSoldeDisponible?e[0].detailSoldeDisponible.soldeMinuteCompte:void 0})["catch"](function(e){return null})}return null},i.$inject=["serviceAgentExtended"],i}();e.MiniProfilService=i,e.module.service("miniProfilService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,i,n,t,r,o,a){this.$q=e,this.modalService=i,this.serviceAgentExtended=n,this.modeFinancierService=t,this.deviseService=r,this.operationDiverseService=o,this.champsErreursOpeFiService=a}return n.prototype.reinitialisationListeChampsEnErreursOperationFinancieres=function(){return this.listeErreursChampsOperationFinancieres=[],this.listeErreursChampsOperationFinancieres},n.prototype.getListeChampsEnErreursOperationFinancieres=function(){return this.listeErreursChampsOperationFinancieres.length>0?this.listeErreursChampsOperationFinancieres:null},n.prototype.determinerChampsEnErreurInitialisation=function(e,i){return this.listeErreursChampsOperationFinancieres=[],e.modeFinancier||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurModeFinancierVide()),e.montant||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantVide()),e.libelleOperation||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),!i||e.titulaireCompte&&""!==e.titulaireCompte||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurTitulaireCompte()),!i||e.referenceOAD&&""!==e.referenceOAD||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurReferenceOAD()),this.listeErreursChampsOperationFinancieres},n.prototype.libelleRoleSignataireParCodeRole=function(e,n){var t;switch(e){case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_01:n&&1===n?t=i.Constantes.LibelleRoleSignataire.LIBELLE_ROLE_TITULAIRE:n&&2===n&&(t=i.Constantes.LibelleRoleSignataire.LIBELLE_ROLE_COTITULAIRE);break;case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_02:t=i.Constantes.LibelleRoleSignataire.LIBELLE_ROLE_REPRESENTANT_LEGAL;break;case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_03:t=i.Constantes.LibelleRoleSignataire.LIBELLE_ROLE_MANDATAIRE;break;case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_04:t=i.Constantes.LibelleRoleSignataire.LIBELLE_ROLE_AUTRES}return t},n.prototype.mappingCodeRoleBatSignatairesVersOpefi=function(e,n){var t="";switch(e){case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_01:t=n&&1===n?i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_01:n&&2===n?i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_02:i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_02;break;case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_02:t=i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_05;break;case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_03:t=i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_03;break;case i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_04:t=i.Constantes.CodeRoleSignataire.CODE_ROLE_SIGNATAIRE_AUTRES_99}return t},n.prototype.creationContexteSaisieOperationFinanciere=function(){var i=this,n=new e.comOpesFinancieres.Model.ContexteSaisieOperationFinanciere;return this.serviceAgentExtended.getAuthentificationInfo().then(function(e){return i.serviceAgentExtended.getParametresComptables().then(function(t){return n.codeEtablissement=e.codeEtablissement,n.referenceExterneAgent=e.agentConnecte.referenceExterneAgent,n.edsExterneGuichetComptable=t.edsExterneGuichetComptable,n.edsExterneRattachementGuichetComptable=t.edsExterneRattachementGuichetComptable,n.dateOperationJourneeComptable=t.dateOperationJourneeComptable,n.libelleEdsRattachementGuichetComptable=t.libelleEdsRattachementGuichetComptable,n.numTelEdsRattachementguichetComptable=t.numTelEdsRattachementGuichetComptable,n.typeCA=t.typeCA,i.getCaracteristiquesEDS(n.codeEtablissement,parseInt(t.edsExterneRattachementGuichetComptable),t.edsTypeRattachementGuichetComptable).then(function(e){var i=e&&e.infoEDS?e.infoEDS.ligne6.substring(6,e.infoEDS.ligne6.length):"";return n.localiteEdsExterneGuichetComptable=i,n})["catch"](function(e){return i.serviceAgentExtended.Trace.error("Problème de récupération des coordonnees EDS","getCoordonneesEDS",e),n})})["catch"](function(e){return i.serviceAgentExtended.Trace.error("Problème de récupération des paramètres comptables","getParametresComptables",e),n})})["catch"](function(e){return i.serviceAgentExtended.Trace.error("Problème de récupération des données d'authentification","getAuthentificationInfo",e),n})},n.prototype.addChampEnErreurListeOperationFinancieres=function(e){this.listeErreursChampsOperationFinancieres.push(e)},n.prototype.getPlafondVersement=function(e,i,n){var t={codeEtablissement:e,modeFinancier:i,codeProduit:n};return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/operationfinanciereparametre/v1/plafondVersement",withHeaders:!0,params:t}).then(function(e){return e})},n.prototype.getCaracteristiquesEDS=function(e,i,n){var t={codeEtablissement:e,referenceExterneEDS:i,typeEDS:n};return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/structure/v2/caracteristiqueEDS",withHeaders:!0,params:t}).then(function(e){return e})},n.prototype.appeller=function(e){var i={templateUrl:"saisie-operation-financiere/saisie-operation-financiere-modal-view.html",controller:"MwgfSaisirOperationFinanciereModalController",controllerAs:"operationFinanciereModal",backdrop:"static",keyboard:!1,modalFade:!0,size:"lg",resolve:{operation:function(){return angular.copy(e)}}};return this.modalService.showModal(i)},n.prototype.initSegmentPrvRioOuvertureCompte=function(n,t){var r=new e.comOpesFinancieres.Model.SegmentPRVRIO,o=n.fonctionnalite.toString();if(t&&(o+="_DIVERS"),r.montantMinimum=0,r.montantMaximum=9999999999999.99,r.texteBoutonValidation=i.Constantes.OperationFinanciere.TEXTE_BOUTON_VALIDER,r.codeDeviseMontantParametre=n.compte.devise.code,r.codeDeviseMontantOperation=n.compte.devise.code,r.supportLivret="1",r.anneesProrogationPEL="",r.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE,n.fonctionnalite===MyWay.Model.Fonctionnalite.OUVERTURE_COMPTE_ATTENTE?(r.modeFinancierNumerique=i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES,r.modeFinancierChoisi=i.Constantes.OperationFinanciere.CODE_MODE_ESPECES_ESP):(r.modeFinancierNumerique="",r.modeFinancierChoisi=""),r.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[o],r.titre="Versement pour l'ouverture "+n.compte.produit.LNEGCO,n.fonctionnalite===MyWay.Model.Fonctionnalite.OUVERTURE_CDD){var a=new e.comOpesFinancieres.Model.SegmentCheque;a.deviseMontant="",a.modeFonctionnement="",a.montant=0,a.S_INFOCHEQUE.push(new e.comOpesFinancieres.Model.SegmentInfoCheque),r.S_CHEQUE=a}return r.indicateurOD=i.Constantes.OperationFinanciere.TEXTE_NON_N,r.presentationLivret="",r.ancienSoldeLivret=0,r.indicateurBlocageAncienSolde="",r.prochainNumeroLigneAImprimer="000",r.ligneBlocage="",r.codeDeviseSoldeLivret="",angular.isDefined(n.signataire)&&null!==n.signataire&&(r.codeRoleParticipant=n.signataire.codePersonnaliteJuridique,r.nomPatronymiqueParticipant=n.signataire.nomParticipant,r.prenomParticipant=n.signataire.prenomParticipant,r.numeroPersonneSignataire=_.padLeft(n.signataire.identifiantParticipant,9,"0")),this.$q.when(r)},n.prototype.initSegmentPrvRioOuvertureCompteCantonnement=function(n,t){var r=new e.comOpesFinancieres.Model.SegmentPRVRIO,o=n.fonctionnalite.toString();if(t&&(o+="_DIVERS"),r.montantMinimum=0,r.montantMaximum=9999999.99,r.texteBoutonValidation=i.Constantes.OperationFinanciere.TEXTE_BOUTON_VALIDER,r.codeDeviseMontantParametre=n.compte.devise.code,r.codeDeviseMontantOperation=n.compte.devise.code,r.supportLivret="1",r.anneesProrogationPEL="",r.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE,n.fonctionnalite===MyWay.Model.Fonctionnalite.OUVERTURE_COMPTE_ATTENTE?(r.modeFinancierNumerique=i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES,r.modeFinancierChoisi=i.Constantes.OperationFinanciere.CODE_MODE_ESPECES_ESP):(r.modeFinancierNumerique="",r.modeFinancierChoisi=""),r.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[o],r.titre="Versement pour l'ouverture "+n.compte.produit.LNEGCO,n.fonctionnalite===MyWay.Model.Fonctionnalite.OUVERTURE_CDD){var a=new e.comOpesFinancieres.Model.SegmentCheque;a.deviseMontant="",a.modeFonctionnement="",a.montant=0,a.S_INFOCHEQUE.push(new e.comOpesFinancieres.Model.SegmentInfoCheque),r.S_CHEQUE=a}return r.indicateurOD=i.Constantes.OperationFinanciere.TEXTE_NON_N,r.presentationLivret="",r.ancienSoldeLivret=0,r.indicateurBlocageAncienSolde="",r.prochainNumeroLigneAImprimer="000",r.ligneBlocage="",r.codeDeviseSoldeLivret="",angular.isDefined(n.signataire)&&null!==n.signataire&&(r.codeRoleParticipant=n.signataire.codePersonnaliteJuridique,r.nomPatronymiqueParticipant=n.signataire.nomParticipant,r.prenomParticipant=n.signataire.prenomParticipant,r.numeroPersonneSignataire=_.padLeft(n.signataire.identifiantParticipant,9,"0")),this.$q.when(r)},n.prototype.initSegmentPrvRioOuvertureLivret=function(i,n){var t=new e.comOpesFinancieres.Model.SegmentPRVRIO,r=i.fonctionnalite.toString();n&&(r+="_DIVERS"),t.montantGlobalOperation=0,t.montantMinimum=0,t.montantMaximum=999999999.99,t.texteBoutonValidation="Valider",t.codeDeviseMontantParametre=i.compte.devise.code,t.codeDeviseMontantOperation=i.compte.devise.code,t.supportLivret="1",t.presentationLivret="N",t.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE,t.modeFinancierNumerique="",t.modeFinancierChoisi="",t.libelleOperation1="",t.ancienSoldeLivret=0,t.indicateurBlocageAncienSolde="O",t.prochainNumeroLigneAImprimer="01",t.ligneBlocage="O",t.indicOblig="N",t.titre="Versement pour l'ouverture "+i.compte.produit.LNEGCO,t.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r];var o=new e.comOpesFinancieres.Model.SegmentCheque;return o.deviseMontant="",o.modeFonctionnement="",o.montant=0,t.S_CHEQUE=o,t.indicateurOD="N",angular.isDefined(i.signataire)&&null!==i.signataire&&(t.codeRoleParticipant=i.signataire.codePersonnaliteJuridique,t.nomPatronymiqueParticipant=i.signataire.nomParticipant,t.prenomParticipant=i.signataire.prenomParticipant,t.numeroPersonneSignataire=_.padLeft(i.signataire.identifiantParticipant,9,"0")),this.$q.when(t)},n.prototype.initSegmentPrvRioPEA=function(i,n,t){var r=new e.comOpesFinancieres.Model.SegmentPRVRIO,o=i.fonctionnalite.toString();n&&(o+="_DIVERS"),r.montantGlobalOperation=0,r.montantMinimum=0,r.montantMaximum=9999999.99,r.texteBoutonValidation="Valider",r.codeDeviseMontantParametre=i.compte.devise.code,r.codeDeviseMontantOperation=i.compte.devise.code,r.supportLivret="1",r.presentationLivret="N",r.codeEvenementAtome=t,r.modeFinancierNumerique="",r.modeFinancierChoisi="",r.libelleOperation1="",r.ancienSoldeLivret=0,r.indicateurBlocageAncienSolde="O",r.prochainNumeroLigneAImprimer="01",r.ligneBlocage="O",r.indicOblig="N",t===MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE?r.titre="Remboursement pour la clôture "+i.compte.produit.LNEGCO:r.titre="Versement pour l'ouverture "+i.compte.produit.LNEGCO,r.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[o];var a=new e.comOpesFinancieres.Model.SegmentCheque;return a.deviseMontant="",a.modeFonctionnement="",a.montant=0,r.S_CHEQUE=a,r.indicateurOD="N",angular.isDefined(i.signataire)&&null!==i.signataire&&(r.codeRoleParticipant=i.signataire.codePersonnaliteJuridique,r.nomPatronymiqueParticipant=i.signataire.nomParticipant,r.prenomParticipant=i.signataire.prenomParticipant,r.numeroPersonneSignataire=_.padLeft(i.signataire.identifiantParticipant,9,"0")),this.$q.when(r)},n.prototype.initSegmentPrvRioOuvertureCEL=function(i,n){var t=new e.comOpesFinancieres.Model.SegmentPRVRIO,r=i.fonctionnalite.toString();n&&(r+="_DIVERS"),t.montantGlobalOperation=0,t.montantMinimum=0,t.montantMaximum=15300,t.texteBoutonValidation="Valider",t.codeDeviseMontantParametre=i.compte.devise.code,t.codeDeviseMontantOperation=i.compte.devise.code,t.supportLivret="1",t.presentationLivret="N",t.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE,t.modeFinancierNumerique="",t.modeFinancierChoisi="",t.libelleOperation1="",t.ancienSoldeLivret=0,t.indicateurBlocageAncienSolde="O",t.prochainNumeroLigneAImprimer="01",t.ligneBlocage="O",t.indicOblig="N",t.titre="Versement pour l'ouverture "+i.compte.produit.LNEGCO,t.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r];var o=new e.comOpesFinancieres.Model.SegmentCheque;return o.deviseMontant="",o.modeFonctionnement="",o.montant=0,t.S_CHEQUE=o,t.indicateurOD="N",angular.isDefined(i.signataire)&&null!==i.signataire&&(t.codeRoleParticipant=i.signataire.codePersonnaliteJuridique,t.nomPatronymiqueParticipant=i.signataire.nomParticipant,t.prenomParticipant=i.signataire.prenomParticipant,t.numeroPersonneSignataire=_.padLeft(i.signataire.identifiantParticipant,9,"0")),this.$q.when(t)},n.prototype.initSegmentPrvRioOuverturePEL=function(i,n){var t=new e.comOpesFinancieres.Model.SegmentPRVRIO,r=i.fonctionnalite.toString();n&&(r+="_DIVERS"),t.montantGlobalOperation=0,t.montantMinimum=225,t.montantMaximum=9999999.99,t.texteBoutonValidation="Valider",t.codeDeviseMontantParametre=i.compte.devise.code,t.codeDeviseMontantOperation=i.compte.devise.code,t.supportLivret="1",t.presentationLivret="N",t.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE,t.modeFinancierNumerique="",t.modeFinancierChoisi="",t.libelleOperation1="",t.ancienSoldeLivret=0,t.indicateurBlocageAncienSolde="O",t.prochainNumeroLigneAImprimer="01",t.ligneBlocage="O",t.indicOblig="N",t.titre="Versement pour l'ouverture "+i.compte.produit.LNEGCO,t.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r];var o=new e.comOpesFinancieres.Model.SegmentCheque;return o.deviseMontant="",o.modeFonctionnement="",o.montant=0,t.S_CHEQUE=o,t.indicateurOD="N",angular.isDefined(i.signataire)&&null!==i.signataire&&(t.codeRoleParticipant=i.signataire.codePersonnaliteJuridique,t.nomPatronymiqueParticipant=i.signataire.nomParticipant,t.prenomParticipant=i.signataire.prenomParticipant,t.numeroPersonneSignataire=_.padLeft(i.signataire.identifiantParticipant,9,"0")),this.$q.when(t)},n.prototype.initSegmentPrvRioClotureCompte=function(i,n,t){var r=new e.comOpesFinancieres.Model.SegmentPRVRIO,o=i.fonctionnalite.toString();return n&&(o+="_DIVERS"),t?(r.montantGlobalOperation=0,r.montantMinimum=0,r.montantMaximum=0,r.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[i.fonctionnalite.toString()+"_CONTENTIEUX"],r.modeFinancierNumerique="10",r.modeFinancierChoisi="DIV"):(r.montantGlobalOperation=-1*i.compte.solde,r.montantMinimum=-1*i.compte.solde,r.montantMaximum=-1*i.compte.solde,r.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[o],r.modeFinancierNumerique="",r.modeFinancierChoisi=""),r.texteBoutonValidation="Valider",r.codeDeviseMontantParametre=i.compte.devise.code,r.codeDeviseMontantOperation=i.compte.devise.code,r.supportLivret="1",r.anneesProrogationPEL="  ",r.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE,r.titre="Remboursement pour la clôture "+i.compte.produit.LNEGCO,r.numeroCompteRice=i.compte.rice.formatRicePourStructureEchange(),r.prochainNumeroLigneAImprimer="000",this.$q.when(r)},n.prototype.initSegmentPrvRioClotureLivret=function(i,n){var t=new e.comOpesFinancieres.Model.SegmentPRVRIO,r=i.fonctionnalite.toString();return n&&(r+="_DIVERS"),t.montantGlobalOperation=-1*i.compte.solde,t.montantMinimum=-1*i.compte.solde,t.montantMaximum=-1*i.compte.solde,t.texteBoutonValidation="Valider",t.codeDeviseMontantParametre=i.compte.devise.code,t.codeDeviseMontantOperation=i.compte.devise.code,t.supportLivret="1",t.presentationLivret="N",t.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE,t.modeFinancierNumerique="",t.modeFinancierChoisi="",t.libelleOperation1="",t.ancienSoldeLivret=0,t.prochainNumeroLigneAImprimer="",t.indicOblig="N",t.indicateurDateBlocage="N",t.titre="Remboursement pour la côture "+i.compte.produit.LNEGCO,t.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r],t.numeroCompteRice=i.compte.rice.formatRicePourStructureEchange(),this.$q.when(t)},n.prototype.initSegmentPrvRioAnnulation=function(i,n,t,r){var o=new e.comOpesFinancieres.Model.SegmentPRVRIO,a=i.fonctionnalite.toString();n&&(a+="_DIVERS"),t&&(a+="_CONTENTIEUX");var s=new e.comOpesFinancieres.Model.SegmentCheque;return s.deviseMontant="",s.modeFonctionnement="",s.montant=0,o.S_CHEQUE=s,i.fonctionnalite===MyWay.Model.Fonctionnalite.ANNULATION_OUVERTURE_COMPTE_ATTENTE?(o.montantMinimum=0,o.montantMaximum=1e9,o.modeFinancierChoisi="ESP",o.modeFinancierNumerique="01"):(o.montantGlobalOperation=i.compte.solde,o.modeFinancierChoisi=i.modeFinancier.CTGXMF,o.montantMinimum=i.compte.solde,o.montantMaximum=i.compte.solde,o.modeFinancierNumerique=i.modeFinancier.CTGXM1),o.codeDeviseMontantParametre=i.compte.devise.code,o.codeDeviseMontantOperation=i.compte.devise.code,o.texteBoutonValidation="Valider",o.anneesProrogationPEL="",r?i.fonctionnalite===MyWay.Model.Fonctionnalite.ANNULATION_CLOTURE_COMPTE_ATTENTE&&(o.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE,o.titre="Versement pour l'annulation de clôture "+i.compte.produit.LNEGCO):i.fonctionnalite===MyWay.Model.Fonctionnalite.ANNULATION_OUVERTURE_CDD?(o.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE,o.titre="Remboursement pour l'extourne d'ouverture "+i.compte.produit.LNEGCO):i.fonctionnalite===MyWay.Model.Fonctionnalite.ANNULATION_OUVERTURE_COMPTE_ATTENTE&&(o.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE,o.titre="Versement pour l'extourne d'ouverture "+i.compte.produit.LNEGCO),o.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[a],o.supportLivret="1",o.numeroCompteRice=i.compte.rice.formatRicePourStructureEchange(),this.$q.when(o)},n.prototype.initSegmentPrvRioAnnulationOuvertureLivret=function(i,n,t){var r=i.fonctionnalite.toString();n&&(r+="_DIVERS");var o=new e.comOpesFinancieres.Model.SegmentPRVRIO,a=new e.comOpesFinancieres.Model.SegmentCheque;return a.deviseMontant="",a.modeFonctionnement="",a.montant=0,o.S_CHEQUE=a,o.montantGlobalOperation=0,o.montantMinimum=0,o.montantMaximum=9999999.99,o.texteBoutonValidation="Valider",o.codeDeviseMontantParametre=i.compte.devise.code,o.codeDeviseMontantOperation=i.compte.devise.code,o.supportLivret="1",o.presentationLivret="N",o.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE,o.modeFinancierNumerique=i.modeFinancier.CTGXM1,o.modeFinancierChoisi=i.modeFinancier.CTGXMF,o.libelleOperation1=i.libelleOperation.libelleLong,o.ancienSoldeLivret=i.compte.solde,o.indicateurBlocageAncienSolde="O",o.prochainNumeroLigneAImprimer="",o.indicOblig="N",o.titre="Remboursement pour l'extourne d'ouverture "+i.compte.produit.LNEGCO,o.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r],o.numeroCompteRice=i.compte.rice.formatRicePourStructureEchange(),this.$q.when(o)},n.prototype.initSegmentPrvRioAnnulationClotureLivret=function(i,n){var t=new e.comOpesFinancieres.Model.SegmentPRVRIO,r=i.fonctionnalite.toString();return n&&(r+="_DIVERS"),t.montantGlobalOperation=-1*i.compte.solde,t.montantMinimum=-1*i.compte.solde,t.montantMaximum=-1*i.compte.solde,t.texteBoutonValidation="Valider",t.codeDeviseMontantParametre=i.compte.devise.code,t.codeDeviseMontantOperation=i.compte.devise.code,t.supportLivret="1",t.presentationLivret="N",t.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE,"CHQ"===i.modeFinancier.CTGXMF?(t.modeFinancierNumerique="09",t.modeFinancierChoisi="CHB"):(t.modeFinancierNumerique=i.modeFinancier.CTGXM1,t.modeFinancierChoisi=i.modeFinancier.CTGXMF),t.indicateurBlocageAncienSolde="O",t.prochainNumeroLigneAImprimer="01",t.indicOblig="N",t.titre="Remboursement pour l'extourne d'ouverture "+i.compte.produit.LNEGCO,t.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r],t.numeroCompteRice=i.compte.rice.formatRicePourStructureEchange(),t.indicateurBlocageAncienSolde="O",this.$q.when(t)},n.prototype.initSegmentPrvRioVersement=function(i,n){var t=new e.comOpesFinancieres.Model.SegmentPRVRIO,r=i.fonctionnalite.toString();return n&&(r+="_DIVERS"),i.fonctionnalite===MyWay.Model.Fonctionnalite.VERSEMENT_SIMPLE?t.titre="Versement / Remboursement":i.fonctionnalite===MyWay.Model.Fonctionnalite.OAD?t.titre="Versement / Remboursement OAD":i.fonctionnalite===MyWay.Model.Fonctionnalite.CORRECTION_OAD&&(t.titre="Correction Versement / Remboursement OAD"),t.texteBoutonValidation="Enregistrer",t.codeDeviseMontantParametre=i.compte.devise.code,t.codeDeviseMontantOperation=i.compte.devise.code,t.modeFinancierNumerique="06",t.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r],t.numeroCompteRice=i.compte.rice.formatRicePourStructureEchange(),this.$q.when(t)},n.prototype.initSegmentPrvRioOperationDepot=function(i,n){var t=new e.comOpesFinancieres.Model.SegmentPRVRIO,r=i.fonctionnalite.toString();n&&(r+="_DIVERS"),t.montantGlobalOperation=0,t.montantMinimum=0,t.montantMaximum=999999999.99,t.texteBoutonValidation="Valider",t.supportLivret="1",t.presentationLivret="N",t.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.VERSEMENT_SIMPLE,t.indicOblig="N",t.texteBoutonValidation="Enregistrer",t.codeDeviseMontantParametre=i.compte.devise.code,t.codeDeviseMontantOperation=i.compte.devise.code,t.modeFinancierNumerique="",t.modeFinancierChoisi="",t.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r],t.libelleOperation1="",t.ancienSoldeLivret=0,t.indicateurBlocageAncienSolde="O",t.prochainNumeroLigneAImprimer="01",t.ligneBlocage="O";var o=new e.comOpesFinancieres.Model.SegmentCheque;return o.deviseMontant="",o.modeFonctionnement="",o.montant=0,t.S_CHEQUE=o,t.indicateurOD="N",angular.isDefined(i.signataire)&&null!==i.signataire&&(t.codeRoleParticipant=i.signataire.codePersonnaliteJuridique,
t.nomPatronymiqueParticipant=i.signataire.nomParticipant,t.prenomParticipant=i.signataire.prenomParticipant,t.numeroPersonneSignataire=_.padLeft(i.signataire.identifiantParticipant,9,"0")),this.$q.when(t)},n.prototype.initSegmentPrvRioOperationRetrait=function(i,n){var t=new e.comOpesFinancieres.Model.SegmentPRVRIO,r=i.fonctionnalite.toString();n&&(r+="_DIVERS"),t.montantGlobalOperation=0,t.montantMinimum=0,t.montantMaximum=999999999.99,t.texteBoutonValidation="Valider",t.supportLivret="1",t.presentationLivret="N",t.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE,t.indicOblig="N",t.texteBoutonValidation="Enregistrer",t.codeDeviseMontantParametre=i.compte.devise.code,t.codeDeviseMontantOperation=i.compte.devise.code,t.modeFinancierNumerique="",t.modeFinancierChoisi="",t.mfIndicateur=MyWay.Model.IndicateurModeFinancier.MAP_INDICATEUR_FINANCIER[r],t.libelleOperation1="",t.ancienSoldeLivret=0,t.indicateurBlocageAncienSolde="O",t.prochainNumeroLigneAImprimer="01",t.ligneBlocage="O";var o=new e.comOpesFinancieres.Model.SegmentCheque;return o.deviseMontant="",o.modeFonctionnement="",o.montant=0,t.S_CHEQUE=o,t.indicateurOD="N",angular.isDefined(i.signataire)&&null!==i.signataire&&(t.codeRoleParticipant=i.signataire.codePersonnaliteJuridique,t.nomPatronymiqueParticipant=i.signataire.nomParticipant,t.prenomParticipant=i.signataire.prenomParticipant,t.numeroPersonneSignataire=_.padLeft(i.signataire.identifiantParticipant,9,"0")),this.$q.when(t)},n.prototype.getLibelleOperationFinanciere=function(n,t,r){var o=this.$q.defer(),a=[{propriete:i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_COGXAO,valeur:t,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_COGXEF,valeur:r.codeEvenementAtome,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_CTGXMF,valeur:r.modeFinancierChoisi,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];return this.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(n,i.Constantes.TableDelocaliseesLibelleComplementaire.TABLE_DELOC_LIBELLE_COMPLEMENTAIRE,a).then(function(n){var t;t=n.length>0?new e.comOpesFinancieres.Model.LibelleOperation(n[0][i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_LBGXOA],n[0][i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_LBGXOP]):new e.comOpesFinancieres.Model.LibelleOperation("",""),o.resolve(t)}),o.promise},n.prototype.getLibelleComplementaire=function(e,n,t,r){var o,a=this.$q.defer(),s=[{propriete:i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_COGXAO,valeur:n,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_COGXEF,valeur:t,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_CTGXMF,valeur:r,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];return this.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(e,i.Constantes.TableDelocaliseesLibelleComplementaire.TABLE_DELOC_LIBELLE_COMPLEMENTAIRE,s).then(function(e){o=e.length>0?e[0][i.Constantes.TableDelocaliseesLibelleComplementaire.PROPRIETE_TABLE_DELOC_LBGXOP]:"",a.resolve(o)}),a.promise},n.prototype.determinerActivationBoutonValiderCheque=function(e,i){var n=!1;return angular.isDefined(e)&&angular.isNumber(e)&&!i&&(n=!0),!n&&i&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),n||null!=e||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantVide()),n},n.prototype.determinerActivationBoutonValiderOperationDiverse=function(e,i,n){var t=!1;return angular.isDefined(e)&&angular.isNumber(e)&&i===!0&&!n&&(t=!0),t||null!=e||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantVide()),!t&&n&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),t||i||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurOperationDiverse()),t},n.prototype.determinerActivationBoutonValiderVirementInterne=function(e,i,n,t){var r=!1;return n&&n.itemBottomSelectionne!==!0&&angular.isDefined(e)&&angular.isNumber(e)&&!t?r=!0:angular.isDefined(i)&&angular.isDefined(e)&&angular.isNumber(e)&&angular.isDefined(i.codeActiviteCompte)&&angular.isDefined(i.radical)&&angular.isDefined(i.cleCompte)&&angular.isDefined(i.cleRice)&&i.codeActiviteCompte&&i.radical&&i.cleCompte&&i.cleRice&&i.$valid&&!t&&(r=!0),r||null!=e||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantVide()),!r&&t&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),r||n?!r&&angular.isUndefined(i)&&angular.isUndefined(i.codeActiviteCompte)&&angular.isUndefined(i.radical)&&angular.isUndefined(i.cleCompte)&&angular.isUndefined(i.cleRice)&&!i.$valid&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurRiceSaisieIncorrectVirementInterne()):this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurCompteNonSelectionneVirementInterne()),r},n.prototype.determinerActivationBoutonValiderEspeces=function(e,i,n,t,r,o,a,s,c,l,p){var m=!1,u=i>0,d=!1,E=!1;return null!=r&&r.isCocher&&(E=!0,null!=r.numeroReferenceEnveloppe&&""!==r.numeroReferenceEnveloppe&&/^\d{10}$/.test(r.numeroReferenceEnveloppe)&&(d=!0)),angular.isDefined(e)&&angular.isNumber(e)&&u&&e===i&&!n&&!t?E&&d?m=!0:E?(m=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurReferenceSac())):m=!0:!angular.isDefined(e)||!angular.isNumber(e)||u||n||t||(E&&d?m=!0:E?(m=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurReferenceSac())):m=!0),!s||c&&""!==c||(m=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurReferenceOAD())),m||null!=e||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantVide()),!m&&u&&e!==i&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurBilletterieIncorrect()),!m&&t&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),!m&&n&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurPlafondVersementDepasse()),!o||a&&""!==a||(m=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurTitulaireCompte())),!l||p&&""!==p||(m=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleComplementaire())),m},n.prototype.determinerActivationBoutonValiderEspecesRetraitCarteTMF=function(e,i,n){var t=!0;return null!=e.montant&&angular.isNumber(e.montant)&&e.montant%10===0||(this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantNonMultipleDe10()),t=!1),n&&i&&(this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),t=!1),t},n.prototype.determinerActivationBoutonValiderEspecesDivers=function(e,i,n,t,r,o,a){var s=!1,c=n>0;return angular.isDefined(e)&&angular.isNumber(e)&&angular.isDefined(i)&&angular.isString(i)&&""!==i&&!t&&!r&&/^\d{10}$/.test(i)&&(c?e===n&&(s=!0):s=!0),s||!angular.isDefined(i)||!angular.isString(i)||""!==i&&/^\d{10}$/.test(i)||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurReferenceSac()),s||null!=e||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantVide()),!s&&c&&e!==n&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurBilletterieIncorrect()),!s&&t&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurPlafondVersementDepasse()),!s&&r&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),!o||a&&""!==a||(s=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleComplementaire())),s},n.prototype.determinerActivationBoutonValiderChequeBanque=function(e,i,n,t,r,o){var a=!1;return angular.isDefined(e)&&angular.isNumber(e)&&!i&&angular.isDefined(n)&&""!==n&&angular.isDefined(t)&&""!==t&&(a=!0),!a&&i&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),!r||o&&""!==o||(a=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurReferenceOAD())),a||null!=n&&""!==n||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurNumeroChequeBanqueVide()),a||null!=t&&""!==t||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurBeneficiaireChequeBanqueVide()),a||null!=e||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantVide()),a},n.prototype.determinerActivationBoutonValiderDivers=function(e,i,n,t,r,o){var a=!1;return angular.isDefined(e)&&angular.isNumber(e)&&!i&&(a=!0),!n||t&&""!==t||(a=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurTitulaireCompte())),!r||o&&""!==o||(a=!1,this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurReferenceOAD())),a||null!=e||this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurMontantVide()),!a&&i&&this.addChampEnErreurListeOperationFinancieres(this.champsErreursOpeFiService.getChampErreurLibelleOperationVide()),a},n.prototype.initSegmentPrvRioOuvertureViaChoixUtilisateurs=function(n,t,r){var o=new e.comOpesFinancieres.Model.SegmentPRVRIO;if(o.montantMinimum=0,o.montantMaximum=9999999.99,o.texteBoutonValidation=i.Constantes.OperationFinanciere.TEXTE_BOUTON_VALIDER,o.codeDeviseMontantParametre=t.code,o.codeDeviseMontantOperation=t.code,o.supportLivret="1",o.anneesProrogationPEL="",o.montantGlobalOperation=n&&n.montant?n.montant:0,o.typeCheque="",o.nombreJourReserveEncaissement=MyWay.Services.StringUtils.padLeftNumber(i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,3),o.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE,o.modeFinancierNumerique=n.modeFinancier.CTGXM1,o.modeFinancierChoisi=n.modeFinancier.CTGXMF,n.fonctionnalite===MyWay.Model.Fonctionnalite.OUVERTURE_CDD){var a=new e.comOpesFinancieres.Model.SegmentCheque;a.deviseMontant="",a.modeFonctionnement="",a.montant=0,a.S_INFOCHEQUE.push(new e.comOpesFinancieres.Model.SegmentInfoCheque),o.S_CHEQUE=a}return o.indicateurOD=i.Constantes.OperationFinanciere.TEXTE_NON_N,o.presentationLivret="",o.ancienSoldeLivret=0,o.indicateurBlocageAncienSolde="",o.prochainNumeroLigneAImprimer="000",o.ligneBlocage="",o.codeDeviseSoldeLivret="",null!=n.signataire&&(o.codeRoleParticipant=n.signataire.codePersonnaliteJuridique,o.nomPatronymiqueParticipant=n.signataire.nomParticipant,o.prenomParticipant=n.signataire.prenomParticipant,o.numeroPersonneSignataire=_.padLeft(n.signataire.identifiantParticipant,9,"0")),o},n.prototype.alimentationOpeFiAvecChoixUtil=function(i){var n=new e.comOpesFinancieres.Model.OperationFinanciere;return n.montant=i.montant,n.estMajeur=i.estMajeur,n.codeOperation=i.codeOperation,n.libelleOperation=new e.comOpesFinancieres.Model.LibelleOperation(i.libelleCourtOpeFi,i.libelleLongOpeFi),n.estForcageOperationFinanciere=!0,n.client=new MyWay.Model.Client,n.client.numeroPersonne=i.numeroPersonne,n},n.prototype.alimentationSegmentPrvrioAvecChoixUtil=function(e,n){var t=angular.copy(n);switch(e.referenceIdentite&&""!==e.referenceIdentite&&(t.identiteParticipant=e.referenceIdentite),e.dateValeur&&(t.dateDeValeur=e.dateValeur),e.montant&&(t.montantGlobalOperation=e.montant),e.libelleLongOpeFi&&(t.libelleOperation1=MyWay.Services.StringUtils.padRight(e.libelleLongOpeFi," ",24)),e.libelleCourtOpeFi&&(t.libelleOperation1=t.libelleOperation1+e.libelleCourtOpeFi),e.codeModeFinancier){case i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU:t.typeCheque=i.Constantes.ChiffreString.CHIFFRE_UN_STRING,e.modeFiCheque&&(t.nombreJourReserveEncaissement=MyWay.Services.StringUtils.padLeftNumber(e.modeFiCheque.delaiEncaissement.toString(),i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,3));break;case i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE:e.modeFiChequeBanque&&(t.numeroCheque=e.modeFiChequeBanque.chequeDeBanque.numero,t.ordreCheque=e.modeFiChequeBanque.chequeDeBanque.beneficiaire,e.modeFiChequeBanque.chequeDeBanque.multiRetrait?(t.chequeGlobal=i.Constantes.OperationFinanciere.TEXTE_OUI_O,e.modeFiChequeBanque.chequeDeBanque.derniereContrepartie?t.derniereContrepartie=i.Constantes.OperationFinanciere.TEXTE_OUI_O:t.derniereContrepartie=i.Constantes.OperationFinanciere.TEXTE_NON_N):(t.chequeGlobal=i.Constantes.OperationFinanciere.TEXTE_NON_N,t.derniereContrepartie=i.Constantes.OperationFinanciere.TEXTE_OUI_O))}return t},n.prototype.creationObjetChoixUtilisateursParObjetOpeFi=function(n){var t=new e.comOpesFinancieres.Model.ChoixUtilisateurOpeFi;if(n){if(t.version=i.Constantes.ChoixUtilisateurOpeFi.VERSION_1_0_OBJET,n.compte.devise&&(t.codeDevise=n.compte.devise.code),n.modeFinancier&&(t.codeModeFinancier=n.modeFinancier.CTGXM1),n.client&&(t.numeroPersonne=n.client.numeroPersonne),null!==n.montant&&void 0!==n.montant&&NaN!==n.montant&&(t.montant=n.montant),n.segmentPrvRio&&(t.referenceIdentite=n.segmentPrvRio.identiteParticipant,t.dateValeur=n.segmentPrvRio.dateDeValeur),n.libelleOperation&&(t.libelleCourtOpeFi=n.libelleOperation.libelleCourt,t.libelleLongOpeFi=n.libelleOperation.libelleLong),n.codeOperation&&(t.codeOperation=n.codeOperation),n.estMajeur&&(t.estMajeur=n.estMajeur),n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES){var r=new e.comOpesFinancieres.Model.ModeFinancierOperationDiverse;n.operationDiverse&&(n.operationDiverse.familleOperationDiverse&&(r.codeFamille=n.operationDiverse.familleOperationDiverse.COJOFA,r.codeGuichet=n.operationDiverse.familleOperationDiverse.YNOXCE),n.operationDiverse.typeOperationDiverse&&(r.codeType=n.operationDiverse.typeOperationDiverse.COJXHD,r.codeTransaction=n.operationDiverse.typeOperationDiverse.IDSEQ3),n.segmentPrjo&&(r.libelle1SaisiOD=n.segmentPrjo.libelle1SaisiOD,r.libelle2SaisiOD=n.segmentPrjo.libelle2SaisiOD)),t.modeFiOD=r}else if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS){var o=new e.comOpesFinancieres.Model.ModeFinancierEspecesEtEspecesDivers;n.referenceEnveloppe?(o.presenceReferenceEnveloppe=!0,o.numeroReferenceEnveloppe=n.referenceEnveloppe.numeroReferenceEnveloppe,o.referenceEnveloppeIsCocher=n.referenceEnveloppe.isCocher):o.presenceReferenceEnveloppe=!1,n.segmentPrvRio&&n.segmentPrvRio.S_BILLETERIE&&(o.coupure=n.segmentPrvRio.S_BILLETERIE.nombreCoupure,o.monnaieBilleterie=n.segmentPrvRio.S_BILLETERIE.monnaieBilleterie),t.modeFiEspecesEtEspecesDivers=o}else if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU){var a=new e.comOpesFinancieres.Model.ModeFinancierCheque;n.segmentPrvRio&&(a.delaiEncaissement=parseInt(n.segmentPrvRio.nombreJourReserveEncaissement)),t.modeFiCheque=a}else if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE){var s=new e.comOpesFinancieres.Model.ModeFinancierVirInterne;n.compteVirementInterneSelectionne&&n.compteVirementInterneSelectionne.riceContrat&&""!==n.compteVirementInterneSelectionne.riceContrat?(s.estVirementInterneSelectionne=!0,s.numeroRice=n.compteVirementInterneSelectionne.riceContrat):n.riceVirementInterneSaisie?(s.estVirementInterneSelectionne=!1,s.numeroRice=n.riceVirementInterneSaisie.formatRicePourStructureEchange()):s=null,t.modeFiVirInterne=s}else if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE){var c=new e.comOpesFinancieres.Model.ModeFinanciereChequeBanque;n.segmentPrvRio&&(c.chequeDeBanque=new e.comOpesFinancieres.Model.ChequeBanque,c.chequeDeBanque.numero=n.segmentPrvRio.numeroCheque,c.chequeDeBanque.beneficiaire=n.segmentPrvRio.ordreCheque,"O"===n.segmentPrvRio.chequeGlobal?(c.chequeDeBanque.multiRetrait=!0,"O"===n.segmentPrvRio.derniereContrepartie?c.chequeDeBanque.derniereContrepartie=!0:c.chequeDeBanque.derniereContrepartie=!1):(c.chequeDeBanque.multiRetrait=!1,c.chequeDeBanque.derniereContrepartie=!0)),c.chequeDeBanque.devise=n.compte.devise,c.chequeDeBanque.modeFinancier=n.modeFinancier,c.chequeDeBanque.montantGlobal=n.montant,t.modeFiChequeBanque=c}return t}return null},n.prototype.ajoutSegmentDansContext=function(e,n){var t=this,r=this.$q.defer();return this.serviceAgentExtended.Context.GetCurrentProcessId().then(function(o){var a=o+"_"+i.Constantes.Segment.TEXTE_SEGMENTPRVRIO_MAJUSCULE+"_"+n;t.serviceAgentExtended.addToContext(a,e).then(function(){r.resolve()})}),r.promise},n.prototype.traitementODPourRepriseChoixUtilVersOpefi=function(i,n){var t=this;return i.operationDiverse=new MyWay.Model.OperationDiverse,i.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,i.segmentPrjo.codeDeviseOperation=n.codeDevise,i.segmentPrjo.montantOperation=angular.copy(n.montant),i.segmentPrjo.codeTransaction=n.modeFiOD.codeTransaction,i.segmentPrjo.libelle1SaisiOD=n.modeFiOD.libelle1SaisiOD,i.segmentPrjo.libelle2SaisiOD=n.modeFiOD.libelle2SaisiOD,this.operationDiverseService.getFamilleParCodeFamille(n.modeFiOD.codeFamille,n.modeFiOD.codeGuichet).then(function(e){return e&&(i.operationDiverse.familleOperationDiverse=new MyWay.Model.FamilleOperationDiverse,i.operationDiverse.familleOperationDiverse=e,i.segmentPrjo.codeFamilleOD=e.COJOFA,i.segmentPrjo.libelleFamilleOD=e.ULIWFO),t.operationDiverseService.getTypeParCodeTypeEtCodeFamille(n.modeFiOD.codeType,n.modeFiOD.codeGuichet,n.modeFiOD.codeFamille)}).then(function(e){return e&&(i.operationDiverse.typeOperationDiverse=new MyWay.Model.TypeOperationDiverse,i.operationDiverse.typeOperationDiverse=e,i.segmentPrjo.libelleTypeOD=e.ULIWOD,i.segmentPrjo.codeReferenceOD=e.COJXHD),t.ajoutSegmentDansContext(i.segmentPrvRio,i.client.numeroPersonne)}).then(function(){return console.log("[Operation Financiere Reprise DV] Ajout dans le contexte du segment"),i})},n.prototype.traitementVirementInternePourRepriseChoixUtilVersOpefi=function(e,n){var t=this,r=n.modeFiVirInterne.numeroRice&&""!==n.modeFiVirInterne.numeroRice?n.modeFiVirInterne.numeroRice.substring(0,5):"";return n.modeFiVirInterne.estVirementInterneSelectionne?(e.compteVirementInterneSelectionne=new MyWay.Model.Contrat,e.compteVirementInterneSelectionne.riceContrat=n.modeFiVirInterne.numeroRice,e.compteVirementInterneSelectionne.identifiantPersonne=n.numeroPersonne,e.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte=e.compteVirementInterneSelectionne.riceContrat,n.codeDevise!==i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&e.compteVirementInterneSelectionne.valeurProduitDevise?e.soldeCompteAvantVirement=e.compteVirementInterneSelectionne.valeurProduitDevise:e.compteVirementInterneSelectionne.valeurProduit&&(e.soldeCompteAvantVirement=e.compteVirementInterneSelectionne.valeurProduit),e.nouveauSoldeCompteVirementApresVirement=e.soldeCompteAvantVirement?Math.round(100*(e.soldeCompteAvantVirement-e.montant))/100:0):(e.riceVirementInterneSaisie=this.decoupageEtCreationRice(n.modeFiVirInterne.numeroRice),e.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte=n.modeFiVirInterne.numeroRice),this.getLibelleComplementaire(r,n.codeOperation,MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE,e.modeFinancier.CTGXMF).then(function(i){return i&&e.segmentPrvRio&&e.segmentPrvRio.S_PRVRIOUGR.length>0&&(e.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement=i),t.ajoutSegmentDansContext(e.segmentPrvRio,e.client.numeroPersonne).then(function(){return console.log("[Operation Financiere Reprise DV] Ajout dans le contexte du segment"),e})})["catch"](function(i){return t.ajoutSegmentDansContext(e.segmentPrvRio,e.client.numeroPersonne).then(function(){return console.log("[Operation Financiere Reprise DV] Ajout dans le contexte du segment"),e})})},n.prototype.creationObjetOpeFiParObjetChoixUtilisateurs=function(n){var t=this,r=this.alimentationOpeFiAvecChoixUtil(n),o=new MyWay.Model.Devise;return r.compte=new MyWay.Model.Compte,r.compte.rice=new MyWay.Model.Rice,this.deviseService.getDeviseByCode(n.codeDevise).then(function(e){return o=e,r.compte.devise=e,"99"===n.codeModeFinancier?t.modeFinancierService.getByCTGXM1("01").then(function(e){return e.CTGXM1="99",e.LIJMMI="OUVERTURE À ZERO EURO",console.log("getByCTGXM1 2",e),e}):t.modeFinancierService.getByCTGXM1(n.codeModeFinancier)}).then(function(e){return r.modeFinancier=e,t.serviceAgentExtended.Habilitation.EstHabilite(i.Constantes.CodeHabilitation.CODE_HABILITATION_SHJM25)}).then(function(a){var s=t.initSegmentPrvRioOuvertureViaChoixUtilisateurs(r,o,a);if(r.segmentPrvRio=t.alimentationSegmentPrvrioAvecChoixUtil(n,s),n.codeModeFinancier===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES){if(null!=n.modeFiOD)return t.traitementODPourRepriseChoixUtilVersOpefi(r,n)}else if(n.codeModeFinancier===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE){if(null!=n.modeFiVirInterne)return t.traitementVirementInternePourRepriseChoixUtilVersOpefi(r,n)}else if(n.codeModeFinancier===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||n.codeModeFinancier===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS){if(null!=n.modeFiEspecesEtEspecesDivers){if(n.modeFiEspecesEtEspecesDivers.presenceReferenceEnveloppe){var c=new e.comOpesFinancieres.Model.ReferenceEnveloppe(n.modeFiEspecesEtEspecesDivers.referenceEnveloppeIsCocher,n.modeFiEspecesEtEspecesDivers.numeroReferenceEnveloppe);r.referenceEnveloppe=c,""!==n.modeFiEspecesEtEspecesDivers.numeroReferenceEnveloppe&&(r.segmentPrvRio.libelleOperation1=i.Constantes.OperationFinanciere.TEXTE_LIBELLE_DEPOT_ESP_NUMERO+n.modeFiEspecesEtEspecesDivers.numeroReferenceEnveloppe+" "+r.libelleOperation.libelleCourt,r.libelleOperation=new e.comOpesFinancieres.Model.LibelleOperation("",r.segmentPrvRio.libelleOperation1))}(n.modeFiEspecesEtEspecesDivers.coupure||n.modeFiEspecesEtEspecesDivers.monnaieBilleterie)&&(r.segmentPrvRio.S_BILLETERIE=new e.comOpesFinancieres.Model.SegmentBilleterie,n.modeFiEspecesEtEspecesDivers.coupure&&(r.segmentPrvRio.S_BILLETERIE.nombreCoupure=n.modeFiEspecesEtEspecesDivers.coupure),n.modeFiEspecesEtEspecesDivers.monnaieBilleterie&&(r.segmentPrvRio.S_BILLETERIE.monnaieSansBillet=n.modeFiEspecesEtEspecesDivers.monnaieBilleterie,r.segmentPrvRio.S_BILLETERIE.monnaieBilleterie=n.modeFiEspecesEtEspecesDivers.monnaieBilleterie))}r.segmentPrjo||n.codeModeFinancier!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES_DIVERS||(r.segmentPrjo=new e.comOpesFinancieres.Model.SegmentPRJO,r.segmentPrjo.codeReferenceOD=i.Constantes.OperationFinanciere.CODE_REFERENCE_OD_VEOD,r.segmentPrjo.libelle1SaisiOD="",r.segmentPrjo.libelle2SaisiOD="",r.segmentPrjo.codeDeviseOperation=n.codeDevise,r.segmentPrjo.montantOperation=n.montant)}return t.ajoutSegmentDansContext(r.segmentPrvRio,r.client.numeroPersonne)}).then(function(){return console.log("operationFinanciere SERVICES",r),r})},n.prototype.creationObjetParametreListeComptes=function(e,n,t,r,o,a,s,c){var l=new MyWay.Model.ParametresListeComptes;return(null===e||angular.isUndefined(e))&&(e=i.VirementInterneController.TEXTE_LETTRE_TYPE_RECHERCHE_B),(null===n||angular.isUndefined(n))&&(n=i.VirementInterneController.TEXTE_LETTRE_CODE_ETAT_RECHERCHE_T),angular.isArray(t)&&0!==t.length||(t=[],t.push(r)),l=angular.isArray(o)&&o.length>0?a?new MyWay.Model.ParametresListeComptes(t,e,n,o,a,null,i.VirementInterneController.TEXTE_SAISIR_AUTRE_COMPTE,null,s,null,{restituerComptesCCI:c}):new MyWay.Model.ParametresListeComptes(t,e,n,o,null,null,i.VirementInterneController.TEXTE_SAISIR_AUTRE_COMPTE,null,s,null,{restituerComptesCCI:c}):a?new MyWay.Model.ParametresListeComptes(t,e,n,null,a,null,i.VirementInterneController.TEXTE_SAISIR_AUTRE_COMPTE,null,s,null,{restituerComptesCCI:c}):new MyWay.Model.ParametresListeComptes(t,e,n,null,null,null,i.VirementInterneController.TEXTE_SAISIR_AUTRE_COMPTE,null,s,null,{restituerComptesCCI:c})},n.prototype.decoupageEtCreationRice=function(e){var i=new MyWay.Model.Rice;return null!=e&&""!==e&&(i.codeEtablissement=e.substring(0,5),i.codeActiviteCompte=e.substring(10,12),i.codeGuichet=e.substring(5,10),i.radical=e.substring(12,19),i.cleCompte=e.substring(19,21),i.cleRice=e.substring(21,23)),i},n.$inject=["$q","modalService","serviceAgentExtended","modeFinancierService","mwsfDeviseService","operationDiverseService","champsErreursOpeFiService"],n}();i.OperationFinanciereService=n,i.module.service("operationFinanciereService",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e){this.serviceAgentExtended=e}return Object.defineProperty(e.prototype,"operationFinanciere",{get:function(){return this._operationFinanciere},set:function(e){this._operationFinanciere=e},enumerable:!0,configurable:!0}),e.$inject=["serviceAgentExtended"],e}();e.OperationFinanciereValueService=i,e.module.service("operationFinanciereValueService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,i,n,t,r,o,a,s,c){this.$q=e,this.serviceAgentExtended=i,this.journalApplicatif=n,this.identifiantBordereauService=t,this.operationFinanciereService=r,this.riceService=o,this.caisseAutoService=a,this.$filter=s,this.miniProfilService=c}return n.prototype.repriseStockageBordereauOperationMyWay=function(e){return e&&e.contexteSaisieOperationFinanciere?this.alimenterBordereau(e):null},n.prototype.traitementPostOperationFinanciereSansPTU=function(e,i){var n=this;if(i)return angular.isUndefined(e.contexteSaisieOperationFinanciere.identifiantBordereau)||0===e.contexteSaisieOperationFinanciere.identifiantBordereau.length?this.identifiantBordereauService.getIdentifiantBordereau(e.client.numeroPersonne,i).then(function(i){return e.contexteSaisieOperationFinanciere.identifiantBordereau=i,n.alimenterBordereau(e)},function(e){return e}):this.alimenterBordereau(e)},n.prototype.traitementPostOperationFinanciereSansJABlocal=function(e,i){var n=this;return angular.isUndefined(e.contexteSaisieOperationFinanciere.identifiantBordereau)||0===e.contexteSaisieOperationFinanciere.identifiantBordereau.length?this.identifiantBordereauService.getIdentifiantBordereau(e.client.numeroPersonne,i).then(function(t){return e.contexteSaisieOperationFinanciere.identifiantBordereau=t,n.journalApplicatif.alimenterPTUsansJAB(e,i)["finally"](function(){return i?n.alimenterBordereau(e):void 0})},function(e){return e}):this.journalApplicatif.alimenterPTUsansJAB(e,i)["finally"](function(){return i?n.alimenterBordereau(e):void 0})},n.prototype.traitementPostOperationFinanciere=function(e,i){var n=this;return angular.isUndefined(e.contexteSaisieOperationFinanciere.identifiantBordereau)||0===e.contexteSaisieOperationFinanciere.identifiantBordereau.length?this.identifiantBordereauService.getIdentifiantBordereau(e.client.numeroPersonne,i).then(function(t){return e.contexteSaisieOperationFinanciere.identifiantBordereau=t,n.journalApplicatif.alimenterPTU(e,i)["finally"](function(){return i?n.alimenterBordereau(e):void 0})},function(e){return e}):this.journalApplicatif.alimenterPTU(e,i)["finally"](function(){return i?n.alimenterBordereau(e):void 0})},n.prototype.traitementAnnulOperationFinanciere=function(){return this.caisseAutoService.annulerDepotEspeces().then(function(){})},n.prototype.GetCurrentProcessId=function(){var e=this.$q.defer();return this.serviceAgentExtended.Context.GetCurrentProcessId().then(function(i){e.resolve(i)}),e.promise},n.prototype.alimenterBordereau=function(n){var t=this;return this.GetCurrentProcessId().then(function(){var r=i.Constantes.OperationFinanciere.TEXTE_BORD_TIRET_BAS+_.padLeft(n.client.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+n.contexteSaisieOperationFinanciere.identifiantBordereau;return t.serviceAgentExtended.getFromContext(r).then(function(o){null===o&&(o=new e.comOpesFinancieres.Model.BordereauOperation,o.lignesBordereauOperation=[],o.participant=n.signataire,o.referenceIdentite=n.segmentPrvRio.identiteParticipant);var a;if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.segmentPrvRio&&n.segmentPrvRio.S_PRVRIOUGR&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""!==n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte){for(var s=0;s<n.segmentPrvRio.S_PRVRIOUGR.length;s++)if(""!==n.segmentPrvRio.S_PRVRIOUGR[s].numeroCompte){var c=new e.comOpesFinancieres.Model.OperationFinanciere;angular.copy(n,c),c.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A?(c.montant=n.segmentPrvRio.S_PRVRIOUGR[s].montantVirement,c.segmentPrvRio.montantGlobalOperation=n.segmentPrvRio.S_PRVRIOUGR[s].montantVirement):(c.montant=-1*n.segmentPrvRio.S_PRVRIOUGR[s].montantVirement,c.segmentPrvRio.montantGlobalOperation=-1*n.segmentPrvRio.S_PRVRIOUGR[s].montantVirement),c.libelleOperation.libelleLong=n.segmentPrvRio.S_PRVRIOUGR[s].libelleVirement,c.compte.rice=t.journalApplicatif.transformeEnRice(c.segmentPrvRio.S_PRVRIOUGR[s].numeroCompte),1===s?n.repartition&&n.repartition.compteCredite2&&(n.repartition.compteCredite2.codeDeviseContrat!==i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite2.valeurProduitDevise?c.compte.solde=n.repartition.compteCredite2.valeurProduitDevise:n.repartition.compteCredite2.codeDeviseContrat===i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite2.valeurProduit&&(c.compte.solde=n.repartition.compteCredite2.valeurProduit),c.compte.libelle=n.repartition.compteCredite2.libelleProduit?n.repartition.compteCredite2.libelleProduit:""):2===s&&n.repartition&&n.repartition.compteCredite3&&(n.repartition.compteCredite3.codeDeviseContrat!==i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite3.valeurProduitDevise?c.compte.solde=n.repartition.compteCredite3.valeurProduitDevise:n.repartition.compteCredite3.codeDeviseContrat===i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&n.repartition.compteCredite3.valeurProduit&&(c.compte.solde=n.repartition.compteCredite3.valeurProduit),c.compte.libelle=n.repartition.compteCredite3.libelleProduit?n.repartition.compteCredite3.libelleProduit:""),a=t.alimenterLigneBordereau(c),o.lignesBordereauOperation.push(a)}}else a=t.alimenterLigneBordereau(n),o.lignesBordereauOperation.push(a);if(n&&n.modeFinancier&&n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&n.facturationPrestation&&n.facturationPrestation.estFacturationPrestation){var l=t.alimenterLigneBordereauPourTarification(n,i.Constantes.Facturation.LIBELLE_FRAIS_DELIVRANCE_VRAC,!0);o.lignesBordereauOperation.push(l)}if(n&&n.modeFinancier&&n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.facturationPrestation&&n.facturationPrestation.estFacturationPrestation){var p=t.alimenterLigneBordereauPourTarification(n,i.Constantes.Facturation.LIBELLE_FRAIS_CHEQUE_BANQUE,!1);o.lignesBordereauOperation.push(p)}if(n&&n.modeFinancier&&n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&n.plusieursCheques&&n.plusieursCheques.length>1){
for(var m=[],u=0,d=n.plusieursCheques;u<d.length;u++){var E=d[u];if(E.montant){var h=void 0;h=t.$filter("number")(E.montant,2),m.push(h)}}a.plusieursCheques=m}if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&t.determinerSaisieBilletterie(n.segmentPrvRio.S_BILLETERIE)){var f=new MyWay.Model.Coupure;"+"===a.sensOperation?(angular.isUndefined(o.billetterieDepot)&&(o.billetterieDepot=new e.comOpesFinancieres.Model.SegmentBilleterie,o.billetterieDepot.nombreCoupure=f),o.billetterieDepot=t.alimenterBilletterie(o.billetterieDepot,n.segmentPrvRio.S_BILLETERIE),o.montantBilletterieDepot+=n.montant):(angular.isUndefined(o.billetterieRetrait)&&(o.billetterieRetrait=new e.comOpesFinancieres.Model.SegmentBilleterie,o.billetterieRetrait.nombreCoupure=f),o.billetterieRetrait=t.alimenterBilletterie(o.billetterieRetrait,n.segmentPrvRio.S_BILLETERIE),o.montantBilletterieRetrait+=n.montant)}else n.modeFinancier.CTGXM1!==i.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||t.determinerSaisieBilletterie(n.segmentPrvRio.S_BILLETERIE)||("+"===a.sensOperation?o.montantBilletterieDepot+=n.montant:o.montantBilletterieRetrait+=n.montant);if(n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&n.segmentPrvRio&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte&&""!==n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte){var v=t.alimenterLigneBordereau(n);if(n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE||n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE){var C=new e.comOpesFinancieres.Model.SegmentPRVRIO;angular.copy(n.segmentPrvRio,C),(n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.OUVERTURE_SIMPLE||n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.VERSEMENT_SIMPLE)&&(C.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE),(n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.CLOTURE_SIMPLE||n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE)&&(C.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.VERSEMENT_SIMPLE),n.segmentPrvRio.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE&&n.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A&&(C.codeEvenementAtome=MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE),v.rice=n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte;var O,R=v.rice.substring(0,5),_=v.rice.substring(10,12),g=v.rice.substring(5,10),T=v.rice.substring(10,21);return t.recupererLibelleProduitPourUnCompte(R,_,v.devise,g,T).then(function(e){O=e;var r=n&&n.codeOperation&&n.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A?n.codeOperation:i.Constantes.OperationFinanciere.CODE_OPERATION_N;return t.operationFinanciereService.getLibelleOperationFinanciere(n.contexteSaisieOperationFinanciere.codeEtablissement,r,C)}).then(function(e){C.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.VERSEMENT_SIMPLE?(v.sensOperation="+",o.lignesBordereauOperation.length>0&&(o.lignesBordereauOperation[0].sensOperation="-")):v.sensOperation="-";var a="";return a=n&&n.segmentPrvRio&&n.segmentPrvRio.libelleOperation1?n.segmentPrvRio.libelleOperation1:n.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement,""!==n.segmentPrvRio.S_PRVRIOUGR[0].libelleVirement&&n.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A?v.intituleOperation=a:v.intituleOperation=a+" "+e.libelleCourt,n.codeOperation!==i.Constantes.OperationFinanciere.CODE_OPERATION_A?(C.montantGlobalOperation=-1*C.montantGlobalOperation,n.montant=-1*n.montant):n.codeOperation===i.Constantes.OperationFinanciere.CODE_OPERATION_A&&C.codeEvenementAtome===MyWay.Model.CodeFinancierAtome.REMBOURSEMENT_SIMPLE&&C.montantGlobalOperation>0&&(C.montantGlobalOperation=-1*C.montantGlobalOperation),v.montantOperation=C.montantGlobalOperation,null==n.soldeCompteAvantVirement?v.nouveauSolde=null:v.nouveauSolde=Math.round(100*(n.soldeCompteAvantVirement+C.montantGlobalOperation))/100,n.compteVirementInterneSelectionne&&n.compteVirementInterneSelectionne.riceContrat?(v.libelleProduit=n.compteVirementInterneSelectionne.libelleProduit?n.compteVirementInterneSelectionne.libelleProduit:"",v.rice=t.formatageRice(n.compteVirementInterneSelectionne.riceContrat),v.compteVirementInterneSelectionne=n.compteVirementInterneSelectionne):v.libelleProduit=O,o.lignesBordereauOperation.push(v),t.serviceAgentExtended.addToSharedContext(r,o)})}return t.serviceAgentExtended.addToSharedContext(r,o)}return t.serviceAgentExtended.addToSharedContext(r,o)})})},n.prototype.alimenterLigneBordereauPourTarification=function(n,t,r){var o=new e.comOpesFinancieres.Model.LigneBordereauOperation;return o.devise=n.segmentPrvRio.codeDeviseMontantOperation,o.dateDeValeur="",o.intituleOperation=t,o.sensOperation="-",o.montantOperation=-1*n.facturationPrestation.montant.montant,o.libelleProduit=n.compte.libelle,o.riceCompte=n.compte.rice.formatRicePourStructureEchange(),r?o.nouveauSolde=Math.round(100*(n.compte.solde+n.segmentPrvRio.montantGlobalOperation-n.facturationPrestation.montant.montant))/100:n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&n.segmentPrvRio&&n.segmentPrvRio.S_PRVRIOUGR&&n.segmentPrvRio.S_PRVRIOUGR.length>0&&""!==n.segmentPrvRio.S_PRVRIOUGR[0].numeroCompte?o.nouveauSolde=Math.round(100*(n.compte.solde-n.segmentPrvRio.S_PRVRIOUGR[0].montantVirement-n.facturationPrestation.montant.montant))/100:o.nouveauSolde=Math.round(100*(n.compte.solde+n.segmentPrvRio.montantGlobalOperation-n.facturationPrestation.montant.montant))/100,o},n.prototype.alimenterLigneBordereau=function(n){var t=new e.comOpesFinancieres.Model.LigneBordereauOperation;if(t.devise=n.segmentPrvRio.codeDeviseMontantOperation,n.segmentPrvRio.dateDeValeur){var r="function"==typeof n.segmentPrvRio.dateDeValeur.toISOString?n.segmentPrvRio.dateDeValeur.toISOString():n.segmentPrvRio.dateDeValeur.toString();t.dateDeValeur=this.conversionDateSegmentEnFormatDateStandard(r)}else t.dateDeValeur="";if(n&&n.fonctionnalite&&(t.fonctionnalite=n.fonctionnalite),t.intituleOperation=n.segmentPrvRio.libelleOperation1,n.segmentPrvRio.codeEvenementAtome&&n.segmentPrvRio.codeEvenementAtome.length&&"V"===n.segmentPrvRio.codeEvenementAtome[0]&&"A"===n.codeOperation&&n.segmentPrvRio.montantGlobalOperation>0?n.segmentPrvRio.montantGlobalOperation*=-1:n.segmentPrvRio.codeEvenementAtome&&n.segmentPrvRio.codeEvenementAtome.length&&"R"===n.segmentPrvRio.codeEvenementAtome[0]&&"A"===n.codeOperation&&n.segmentPrvRio.montantGlobalOperation<0&&(n.segmentPrvRio.montantGlobalOperation*=-1),n.segmentPrvRio.montantGlobalOperation>0?t.sensOperation="+":t.sensOperation="-",t.montantOperation=n.segmentPrvRio.montantGlobalOperation,t.libelleProduit=n.compte.libelle,t.riceCompte=n.compte.rice.formatRicePourStructureEchange(),t.devise=n.segmentPrvRio.codeDeviseMontantOperation,n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE){var o=new e.comOpesFinancieres.Model.ChequeBanque;o.numero=n.segmentPrvRio.numeroCheque,o.beneficiaire=n.segmentPrvRio.ordreCheque,o.devise=n.compte.devise,o.modeFinancier=n.modeFinancier,o.montantGlobal=n.montant,n.segmentPrvRio.chequeGlobal===i.Constantes.OperationFinanciere.TEXTE_NON_N?o.multiRetrait=!1:n.segmentPrvRio.chequeGlobal===i.Constantes.OperationFinanciere.TEXTE_OUI_O&&(o.multiRetrait=!0),n.segmentPrvRio.derniereContrepartie===i.Constantes.OperationFinanciere.TEXTE_OUI_O?o.derniereContrepartie=!0:n.segmentPrvRio.derniereContrepartie===i.Constantes.OperationFinanciere.TEXTE_NON_N&&(o.derniereContrepartie=!1),t.chequeDeBanque=o}return n.modeFinancier.CTGXM1===i.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&n.operationDiverse&&(t.operationDiverse=n.operationDiverse),t.modeFinancier=n.modeFinancier.CTGXM1,n.compte&&null!==n.compte.solde&&void 0!==n.compte.solde&&n.fonctionnalite&&(n.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT||n.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_OAD||n.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_COMPTE_88)?t.nouveauSolde=Math.round(100*(n.compte.solde+n.segmentPrvRio.montantGlobalOperation))/100:n.compte&&null!==n.compte.solde&&void 0!==n.compte.solde&&n.fonctionnalite&&(n.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT||n.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_OAD||n.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_COMPTE_88)?t.nouveauSolde=Math.round(100*(n.segmentPrvRio.montantGlobalOperation+n.compte.solde))/100:n.fonctionnalite&&n.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OUVERTURE_VAD?t.nouveauSolde=n.segmentPrvRio.montantGlobalOperation:n.fonctionnalite&&MyWay.Services.StringUtils.startsWith(n.fonctionnalite.toString(),"OUVERTURE")?t.nouveauSolde=n.segmentPrvRio.montantGlobalOperation:n.fonctionnalite&&MyWay.Services.StringUtils.startsWith(n.fonctionnalite.toString(),"CLOTURE")?t.nouveauSolde=0:n.fonctionnalite&&MyWay.Services.StringUtils.startsWith(n.fonctionnalite.toString(),"VERSEMENT")&&(t.nouveauSolde=Math.round(100*(n.segmentPrvRio.montantGlobalOperation+n.compte.solde))/100),t},n.prototype.determinerSaisieBilletterie=function(e){var i=!0,n=e.nombreCoupure;return 0===n.b5&&0===n.b10&&0===n.b20&&0===n.b50&&0===n.b100&&0===n.b200&&0===n.b500&&0===e.monnaieSansBillet&&(i=!1),i},n.prototype.alimenterBilletterie=function(e,i){return e.nombreCoupure.b5+=i.nombreCoupure.b5,e.nombreCoupure.b10+=i.nombreCoupure.b10,e.nombreCoupure.b20+=i.nombreCoupure.b20,e.nombreCoupure.b50+=i.nombreCoupure.b50,e.nombreCoupure.b100+=i.nombreCoupure.b100,e.nombreCoupure.b200+=i.nombreCoupure.b200,e.nombreCoupure.b500+=i.nombreCoupure.b500,e.monnaieSansBillet+=i.monnaieSansBillet,e},n.prototype.recupererLibelleProduitPourUnCompte=function(e,n,t,r,o){var a=this,s=i.Constantes.OperationFinanciere.CODE_PRODUIT_00+n,c="";return this.miniProfilService.getMiniProfil(e,i.Constantes.ConstantesSolde.MINI_PROFIL_TYPE_RECHERCHE_RICE,i.Constantes.ConstantesSolde.MINI_PROFIL_TYPE_RESTITUTION_UNITAIRE,r,s,o).then(function(n){if(n&&n.length>0&&n[0]){var r="";n[0].identificationProduit&&n[0].identificationProduit.length>0&&(r=n[0].identificationProduit[0].identifiantProduitService?_.padLeft(n[0].identificationProduit[0].identifiantProduitService.toString(),7,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING):"");var o=[{propriete:i.Constantes.TableDelocaliseesProduit.PROPRIETE_TABLE_DELOC_CODIPR,valeur:s,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseesProduit.PROPRIETE_TABLE_DELOC_COLIDV,valeur:t,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:i.Constantes.TableDelocaliseesProduit.PROPRIETE_TABLE_DELOC_IDEGPS,valeur:r,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];return a.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(e,i.Constantes.TableDelocaliseesProduit.TABLE_DELOC_PRODUIT,o).then(function(e){return angular.isDefined(e)&&e.length>0?e[0].LCEGCO:c})["catch"](function(e){return c})}return c})["catch"](function(e){return c})},n.prototype.formatageRice=function(e){var i=e.substring(0,5),n=e.substring(5,10),t=e.substring(10,12),r=e.substring(12,19),o=e.substring(19,21),a=this.riceService.formatteRICE(i,n,t+r,o);return e+this.riceService.riceKeyCalculator(a)},n.prototype.conversionDateSegmentEnFormatDateStandard=function(e){var i=e.substring(0,4),n=e.substring(5,7),t=e.substring(8,10);return t+"/"+n+"/"+i},n.$inject=["$q","serviceAgentExtended","journalApplicatif","identifiantBordereauService","operationFinanciereService","saisieRiceService","caisseAutoService","$filter","miniProfilService"],n}();i.PostOperationFinanciereService=n,i.module.service("postOperationFinanciere",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i){this.$q=e,this.$timeout=i}return e.prototype.getProduits=function(){var e=[];return e.push.apply(e,[new MyWay.Model.Produit({CODIPR:"0088",COEXSP:"0000",IDEGPS:"0001487",LCEGCO:"COMPTE INTERNE",LNEGCO:"COMPTE INTERNE (CCI)"}),new MyWay.Model.Produit({CODIPR:"0004",COEXSP:"0000",IDEGPS:"0000019",LCEGCO:"C.D.D",LNEGCO:"COMPTE DE DEPOT"}),new MyWay.Model.Produit({CODIPR:"0002",COEXSP:"0050",IDEGPS:"0005037",LCEGCO:"CPT INSTANCE",LNEGCO:"COMPTE D'INSTANCE"}),new MyWay.Model.Produit({CODIPR:"0002",COEXSP:"0001",IDEGPS:"0001533",LCEGCO:"COMPTE ATTENTE",LNEGCO:"COMPTE D'ATTENTE"}),new MyWay.Model.Produit({CODIPR:"0000",COEXSP:"0060",IDEGPS:"0001238",LCEGCO:"LIVRET A",LNEGCO:"LIVRET A PERSONNE PHYSIQUE"}),new MyWay.Model.Produit({CODIPR:"0012",COEXSP:"0000",IDEGPS:"0000015",LCEGCO:"PEL",LNEGCO:"PLAN EPARGNE LOGEMENT"}),new MyWay.Model.Produit({CODIPR:"0011",COEXSP:"0000",IDEGPS:"0000026",LCEGCO:"CEL",LNEGCO:"COMPTE EPARGNE LOGEMENT"}),new MyWay.Model.Produit({CODIPR:"0021",COEXSP:"0050",IDEGPS:"0000000",LCEGCO:"PIVOT PEA",LNEGCO:"PIVOT P.E.A."})]),this.$timeout(function(){return e},100)},e.$inject=["$q","$timeout"],e}();e.ProduitService=i,e.module.service("produitService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e){this.serviceAgent=e}return e.prototype.getTarificationPrestation=function(e,i,n,t,r,o,a,s,c){var l={};return null!=e&&(l.codeEtablissement=e),null!=i&&(l.codePrestationTarifiable=i),null!=n&&(l.montantDeReferencePrestation=n),null!=t&&(l.monnaieMontantReference=t),null!=r&&(l.numeroEntiteTitulaire=r),null!=o&&(l.identifiantPersonne=o),null!=a&&(l.codeGuichet=a),null!=s&&(l.numeroCompte=s),null!=c&&(l.topTarifAuto=c),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/tarification-v1/tarificationPrestation",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:l})},e.$inject=["serviceAgent"],e}();e.TarificationTarificationPrestationService=i,e.module.service("tarificationTarificationPrestationService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i){this.$q=e,this.$timeout=i,this.objectenfragement=[],this.historiqueLog="",this.maxSizeObject=10922,this.nombrefragement=0,this.colors={debug:"#283B82",error:"#C74F0C",info:"#336924",warning:"#9E0808"}}return e.prototype.log=function(e,i,n){if(void 0===e&&(e=""),window.console&&console.log){var t=-1!==navigator.userAgent.indexOf("Trident"),r="\n",o="***",a="padding:2px 10px; background-color:"+this.colors[this.logType]+"; color: white;";console.log(r),t?console.log(o+" "+n.toUpperCase()+" "+o+" --> "+e+" ("+this.getTime()+")"):console.log("%c "+e+" ("+this.getTime()+")",a),angular.isDefined(i)&&console.log(i),console.log(r)}},e.prototype.debug=function(e,i,n){void 0===n&&(n=!1),this.traceServiceLogger("debug",e,i,n)},e.prototype.error=function(e,i,n){void 0===n&&(n=!1),this.traceServiceLogger("error",e,i,n)},e.prototype.info=function(e,i,n){void 0===n&&(n=!1),this.traceServiceLogger("info",e,i,n)},e.prototype.warning=function(e,i,n){void 0===n&&(n=!1),this.traceServiceLogger("warning",e,i,n)},e.prototype.warn=function(e,i,n){void 0===n&&(n=!1),this.warning(e,i,n)},e.prototype.traceServiceLogger=function(i,n,t,r){void 0===r&&(r=!1);var o,a=null,s="",c=null;if(this.logType=i,this.log(n,t,i),r&&angular.isDefined(t))try{this.historiqueLog+="<span style='padding:2px 10px; background-color:"+this.colors[this.logType]+"; color: white;'><strong>"+this.getTime()+"</strong> : "+n+"</span><pre>"+JSON.stringify(t)+"</pre > <br>"}catch(l){console.log("\n\n\n*************************************************************************\n"),console.log("Trace Service ERROR in this.historiqueLog JSON.stringify(object)\n"),console.log(t),console.log(l),console.log("*************************************************************************\n\n\n")}if(t=this.objectToString(t),t.length<=this.maxSizeObject)switch(this.logType){case"debug":try{e.logger.debug(n+" : %1",t)}catch(l){c="debug",o=l}break;case"info":try{e.logger.info(n+" : %1",t)}catch(l){c="info",o=l}break;case"error":try{e.logger.error(n+" : %1",t)}catch(l){c="error",o=l}break;case"warn":try{e.logger.warn(n+" : %1",t)}catch(l){c="warn",o=l}}else{switch(a=this.objetToFragment(t),console.warn("$$$$ = > Object to fragment   ->"+a),this.logType){case"debug":for(var p=0;p<this.nombrefragement;p++){0===p?s=" Debut de l'objet ":p===this.nombrefragement-1&&(s=" Fin de l'objet ");try{e.logger.debug(n+" : %1",s+" | Partie "+p+" | "+a[p]),console.log(n+" : %1",s+" | Partie "+p+" | "+a[p])}catch(l){c="debug",o=l}}break;case"info":for(var p=1;p<=a.length;p++)try{e.logger.info(n+" : %1",s+"Partie"+p+a[p])}catch(l){c="info",o=l}break;case"error":for(var p=1;p<=a.length;p++)try{e.logger.error(n+" : %1",s+" | Partie "+p+" | "+a[p])}catch(l){c="debug",o=l}break;case"warn":for(var p=1;p<=a.length;p++)try{e.logger.warn(n+" : %1",s+"Partie"+p+a[p])}catch(l){c="warn",o=l}}null!==c&&(this.logType="error",this.log("TraceService Error : ServiceTrace.logger."+c,o))}},e.prototype.getTime=function(){var e=new Date;return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds()},e.prototype.clearHistoriqueLog=function(){this.historiqueLog=""},Object.defineProperty(e.prototype,"logType",{get:function(){return this._logType},set:function(e){this._logType=e},enumerable:!0,configurable:!0}),e.prototype.objectToString=function(e){return e="string"!=typeof e&&"null"!==e&&"undefined"!=typeof e?JSON.stringify(e):""},e.prototype.objetToFragment=function(e){var i=e,n=0,t=n+this.maxSizeObject;if("null"!==e&&"undefined"!=typeof e){e.length>this.maxSizeObject&&(this.nombrefragement=e.length/this.maxSizeObject,this.nombrefragement>Math.floor(this.nombrefragement)&&(this.nombrefragement=Math.floor(this.nombrefragement)+1));for(var r=1;r<=this.nombrefragement;r++)e=i.substring(n,t),this.objectenfragement.push(e),n=t,r===this.nombrefragement?(n=t-5,t=e.length):(n=t,t=t+this.maxSizeObject-1)}return this.objectenfragement},e.CLASS_NAME="myway.c0410.commun.ServiceTrace",e.logger=MyWay.Services.Loggers.LoggerFactory.INSTANCE.getClass(e.CLASS_NAME),e.$inject=["$q","$timeout"],e}();e.ServiceTrace=i,e.module.service("serviceTrace",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(i,t,r,o,a){var s=this;this.$scope=i,this.modalService=t,this.miniProfilService=r,this.operationFinanciereService=o,this.soldeCompteService=a,this.affichageSoldeActuel=!1,this.codeDevise=e.Constantes.Devise.TEXTE_CODE_DEVISE_EURO,this.chargementSolde=!1,this.afficherBoutonSolde=!0,i.$watch(function(){return s.comptePrincipal},function(e,i){e&&e!==i&&s.traitementRecuperationSolde()}),this.masquerBoutonDetail&&(this.afficherBoutonSolde=!1),this.typeAffichageSolde&&this.typeAffichageSolde===n.ACTUEL&&(this.affichageSoldeActuel=!0),this.initialisationVariablesEtDonnees(),this.comptePrincipal?this.traitementRecuperationSolde():this.chargementSolde=!0}return i.prototype.traitementRecuperationSolde=function(){var i=this;this.chargementSolde=!0,this.initialisationVariablesEtDonnees();var n=this.operationFinanciereService.decoupageEtCreationRice(this.comptePrincipal.riceContrat),t=this.comptePrincipal.riceContrat&&""!==this.comptePrincipal.riceContrat?this.comptePrincipal.riceContrat.substring(5,10):"";n&&n.codeActiviteCompte&&(this.codeProduit=n.codeActiviteCompte);var r=n.codeActiviteCompte+n.radical+n.cleCompte;this.soldeCompteService.getSoldeMinuteCompte(this.comptePrincipal.riceContrat).then(function(o){null!=o?(i.soldeMinuteCompte=o,null!=i.comptePrincipal.codeDeviseContrat&&i.comptePrincipal.codeDeviseContrat!==e.Constantes.Devise.TEXTE_CODE_DEVISE_EURO||null!=i.comptePrincipal.devise&&i.comptePrincipal.devise.code&&i.comptePrincipal.devise.code!==e.Constantes.Devise.TEXTE_CODE_DEVISE_EURO?(i.comptePrincipal.valeurProduitDevise=o,i.calculerSoldeDisponible(),i.chargementSolde=!1):i.traitementMiniProfil(n,t,r)):i.traitementMiniProfil(n,t,r)})["catch"](function(e){i.traitementMiniProfil(n,t,r),i.afficherBoutonSolde=!1})},i.prototype.afficherPopupSolde=function(){var e=this;this.modalService.showModal({templateUrl:"typescript/solde-compte/solde-compte-modal-view.html",controller:"soldeCompteModalControleur",controllerAs:"soldeCompteModal",backdrop:!0,keyboard:!0,size:"lg",resolve:{soldeDetail:function(){return e.soldeDetail},codeProduit:function(){return e.codeProduit}}})},i.prototype.traitementMiniProfil=function(i,n,t){var r=this;this.miniProfilService.getMiniProfil(i.codeEtablissement,e.Constantes.ConstantesSolde.MINI_PROFIL_TYPE_RECHERCHE_SOLDE_D,e.Constantes.ConstantesSolde.MINI_PROFIL_TYPE_RESTITUTION_UNITAIRE,n,"00"+i.codeActiviteCompte,t).then(function(e){e&&1===e.length&&e[0].detailSoldeDisponible&&r.soldeDetail&&(r.soldeDetail.impayesSurPret=e[0].detailSoldeDisponible.montantCumuleImpayePret,r.soldeDetail.decouvertAutorise=e[0].detailSoldeDisponible.montantDecouvertAutorise,r.soldeDetail.delaiEncaissement=e[0].detailSoldeDisponible.montantEffetEncaissement,r.soldeDetail.ecartes=e[0].detailSoldeDisponible.montantCumuleOperationEcartee,r.soldeDetail.soldeActuel=e[0].detailSoldeDisponible.soldeMinuteCompte,r.soldeDetail.fondsMisADisposition=e[0].detailSoldeDisponible.cumulFondsMisADispoinstpay,r.soldeDetail.fondsReserves=e[0].detailSoldeDisponible.cumulReservesFondsInstpay,r.$scope.$emit("mwsfSoldeCompte_valeur_solde_actuel",r.soldeDetail.soldeActuel)),r.calculerSoldeDisponible(),r.chargementSolde=!1})["catch"](function(e){r.chargementSolde=!1,r.initialisationVariablesEtDonnees(),r.afficherBoutonSolde=!1})},i.prototype.initialisationVariablesEtDonnees=function(){var i;i=e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER,this.comptePrincipal&&(this.comptePrincipal.codeDeviseContrat===e.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&this.comptePrincipal.valeurProduit?i=this.comptePrincipal.valeurProduit:this.comptePrincipal.codeDeviseContrat!==e.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&this.comptePrincipal.valeurProduitDevise&&(i=this.comptePrincipal.valeurProduitDevise)),this.soldeDetail={decouvertAutorise:e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER,delaiEncaissement:e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER,ecartes:e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER,impayesSurPret:e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER,soldeActuel:i,soldeDisponible:e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER,codeDevise:this.codeDevise,soldeDisponibleDetail:e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER,fondsMisADisposition:e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER,fondsReserves:e.Constantes.ChiffreNumber.CHIFFRE_ZERO_NUMBER}},i.prototype.calculerSoldeDisponible=function(){this.soldeDetail&&(this.soldeDetail.soldeDisponibleDetail=this.soldeDetail.soldeActuel+this.soldeDetail.decouvertAutorise-this.soldeDetail.delaiEncaissement-this.soldeDetail.ecartes-this.soldeDetail.impayesSurPret+this.soldeDetail.fondsMisADisposition-this.soldeDetail.fondsReserves),this.soldeMinuteCompte&&(this.soldeDetail.soldeDisponible=this.soldeMinuteCompte),this.soldeDetail&&this.soldeDetail.soldeDisponibleDetail===this.soldeDetail.soldeActuel&&0===this.soldeDetail.decouvertAutorise||this.masquerBoutonDetail?this.afficherBoutonSolde=!1:this.afficherBoutonSolde=!0,this.comptePrincipal.codeDeviseContrat!==e.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&null!=this.comptePrincipal.valeurProduitDevise&&(this.affichageSoldeActuel?this.soldeDetail.soldeActuel=this.comptePrincipal.valeurProduitDevise:this.soldeDetail.soldeDisponible=this.comptePrincipal.valeurProduitDevise,this.afficherBoutonSolde=!1,this.codeDevise=this.comptePrincipal.codeDeviseContrat)},i.$inject=["$scope","modalService","miniProfilService","operationFinanciereService","soldeCompteService"],i}();e.SoldeCompteController=i,function(e){e[e.DISPONIBLE=0]="DISPONIBLE",e[e.ACTUEL=1]="ACTUEL"}(e.TypeAffichageSolde||(e.TypeAffichageSolde={}));var n=e.TypeAffichageSolde;e.module.controller("SoldeCompteController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/solde-compte/solde-compte-view.html",scope:{comptePrincipal:"=",soldeDetail:"=?",typeAffichageSolde:"=?",masquerBoutonDetail:"=?",isOpposition:"=?",fonctionnalite:"=?"},controller:"SoldeCompteController",controllerAs:"viewModelSoldeCompteCtrl",bindToController:!0,link:function(e,i,n){}}}e.mwsfSoldeCompte=i,e.module.directive("mwsfSoldeCompte",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i,n){this.$modalInstance=e,this.soldeDetail=i,this.codeProduit=n}return e.prototype.annuler=function(){this.$modalInstance.dismiss("annuler")},e.$inject=["$modalInstance","soldeDetail","codeProduit"],e}();e.module.controller("soldeCompteModalControleur",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e){this.serviceAgent=e}return e.prototype.getControleCpteEmetteur=function(e,i,n,t,r){var o={};return null!=e&&(o.codeEtablissement=e),null!=i&&(o.codeGuichet=i),null!=n&&(o.numeroCompteClientDonneurOrdre=n),null!=t&&(o.cleRibNumeroCompte=t),null!=r&&(o.typeVirementImmediat=r),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/opefinanciereservice/v1/controleCpteEmetteur",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:o})},e.prototype.getSoldeMinuteCompte=function(e){return e&&""!==e?this.getControleCpteEmetteur(e.substring(0,5),e.substring(5,10),e.substring(10,21),e.substring(21,23),"1").then(function(e){return e&&e.infoCompte?e.infoCompte.soldeMinuteCompte/100:void 0})["catch"](function(e){return null}):null},e.$inject=["serviceAgent"],e}();e.SoldeCompteService=i,e.module.service("soldeCompteService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(n,t,r,o){var a=this;this.$scope=n,this.serviceAgentExtended=t,this.typeChequeService=r,this.$q=o,this.reserveEncaissement=new MyWay.Model.ReserveEncaissement(!1,0),this.nbJoursRecup=0,this.estForcageOpeFi=!1,this.estHabiliteSHGXHK=!0,this.recuperationReserveEncaissementPromise=this.recuperationReserveEncaissementInit(),this.recuperationReserveEncaissementPromise.then(function(){a.changementDelaiEncaissement(),a.miseEnPlaceReserveEncaissementIHM()}),this.serviceAgentExtended.Habilitation.EstHabilite(e.Constantes.CodeHabilitation.CODE_HABILITATION_SHGXHK).then(function(e){console.log("CODE_HABILITATION_SHGXHK",{estHabilite:e}),void 0!==e&&null!==e&&(a.estHabiliteSHGXHK=e)}),n.$on("mwsfTypeCheque_reserve_encaissement_forcage",function(t,r){a.recuperationReserveEncaissementPromise.then(function(){a.estForcageOpeFi=!0,r!==e.Constantes.ChiffreString.CHIFFRE_TROIS_ZERO_STRING?(a.reserveEncaissement=new MyWay.Model.ReserveEncaissement(!1,parseInt(r)),a.choixTypeCheque=i.CHOIX_DELAI_ENCAISSEMENT_TYPE_CHEQUE):(a.choixTypeCheque=i.CHOIX_SANS_RESERVE_TYPE_CHEQUE,a.reserveEncaissement=new MyWay.Model.ReserveEncaissement(!0,i.DELAI_ENCAISSEMENT_A_ZERO_TYPE_CHEQUE))}),n.$emit("mwsfTypeCheque_reserve_encaissement",a.reserveEncaissement)}),n.$on("montant_changed_type_cheque",function(e,n){a.montantOperationFinanciere=n,a.miseEnPlaceReserveEncaissementIHM(),a.recalculReserveEncaissement().then(function(){a.clicCaseCocherTypeCheque(a.reserveEncaissement.sansReserve?i.CHOIX_SANS_RESERVE_TYPE_CHEQUE:i.CHOIX_DELAI_ENCAISSEMENT_TYPE_CHEQUE)})}),n.$on("mode_financier_changed",function(n,t){null!==t&&t===e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&a.recalculReserveEncaissement().then(function(){a.clicCaseCocherTypeCheque(a.reserveEncaissement.sansReserve?i.CHOIX_SANS_RESERVE_TYPE_CHEQUE:i.CHOIX_DELAI_ENCAISSEMENT_TYPE_CHEQUE)})})}return i.prototype.texteStaticReserveEncaissement=function(){return""+this.reserveEncaissement.delaiEncaissement.toString()+i.TEXTE_JOURS},i.prototype.clicCaseCocherTypeCheque=function(e){e===i.CHOIX_SANS_RESERVE_TYPE_CHEQUE?(this.reserveEncaissement.delaiEncaissement=i.DELAI_ENCAISSEMENT_A_ZERO_TYPE_CHEQUE,this.reserveEncaissement.sansReserve=!0):(this.reserveEncaissement.delaiEncaissement=this.typeChequeService.calculerNombreJoursReserveEncaissement(this.nbJoursRecup),this.reserveEncaissement.sansReserve=!1),this.$scope.$emit("mwsfTypeCheque_reserve_encaissement",this.reserveEncaissement)},i.prototype.recuperationReserveEncaissementInit=function(){var e,i=this,n=this.$q.when();return this.estForcageOpeFi||(n=n.then(function(){return i.serviceAgentExtended.getParametresComptables()}).then(function(n){return e=n.edsInterneRattachementGuichetComptable,i.serviceAgentExtended.Context.GetAuthentificationInfo()}).then(function(n){return i.codeEtablissement=n.codeEtablissement,i.typeChequeService.getEncaissementChequeService(i.codeEtablissement,e,i.rice)}).then(function(e){return i.encaissementCheque=e,i.typeChequeService.calculerReserveEncaissement(e,i.codeEtablissement,i.rice.codeActiviteCompte,i.montantOperationFinanciere)}).then(function(e){i.reserveEncaissement=e,i.miseEnPlaceReserveEncaissementIHM()})["catch"](function(e){i.reserveEncaissement=new MyWay.Model.ReserveEncaissement(!0,0),i.miseEnPlaceReserveEncaissementIHM()})),n},i.prototype.miseEnPlaceReserveEncaissementIHM=function(){this.nbJoursRecup=this.reserveEncaissement.delaiEncaissement,this.choixTypeCheque=this.reserveEncaissement.sansReserve?i.CHOIX_SANS_RESERVE_TYPE_CHEQUE:i.CHOIX_DELAI_ENCAISSEMENT_TYPE_CHEQUE,this.reserveEncaissement.sansReserve&&(this.reserveEncaissement.delaiEncaissement=i.DELAI_ENCAISSEMENT_A_ZERO_TYPE_CHEQUE)},i.prototype.recalculReserveEncaissement=function(){var e=this,i=this.$q.when();return this.estForcageOpeFi||(i=i.then(function(){return e.typeChequeService.calculerReserveEncaissement(e.encaissementCheque,e.codeEtablissement,e.rice.codeActiviteCompte,e.montantOperationFinanciere)}).then(function(i){e.reserveEncaissement=i,e.miseEnPlaceReserveEncaissementIHM()})),i},i.prototype.changementDelaiEncaissement=function(){this.$scope.$emit("mwsfTypeCheque_reserve_encaissement",this.reserveEncaissement)},i.$inject=["$scope","serviceAgentExtended","typeChequeService","$q"],i.CHOIX_SANS_RESERVE_TYPE_CHEQUE="sansReserve",i.CHOIX_DELAI_ENCAISSEMENT_TYPE_CHEQUE="delaiEncaissement",i.DELAI_ENCAISSEMENT_A_ZERO_TYPE_CHEQUE=0,i.TEXTE_JOURS=" jours",i}();e.TypeChequeController=i,e.module.controller("TypeChequeController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/type-cheque/type-cheque-view.html",scope:{reserveEncaissement:"=",rice:"="},controller:"TypeChequeController",controllerAs:"viewModelTypeChequeCtrl",bindToController:!0,link:function(e,i,n){if(!("rice"in n))throw new Error('rice est un paramètre obligatoire.   ==> <  mwsf-type-cheque rice="true or false" > \n')}}}e.mwsfTypeCheque=i,e.module.directive("mwsfTypeCheque",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(e,i){this.$q=e,this.serviceAgentExtended=i}return i.prototype.getEncaissementChequeService=function(e,n,t){var r="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083",o="";o=angular.isObject(t.codeGuichet)?t.codeGuichet.value:t.codeGuichet.toString();var a=r+i.MOYEN_PAIEMENT_VERSION+"encaissementCheque?codeEtablissement="+e;return a+="&identifiantElementStructure="+n,a+="&controleAideCoherenceCheque="+e,a+="&codeGuichetBanque="+o,a+=t.radical&&t.cleCompte?"&referenceProduitService="+t.codeActiviteCompte+t.radical+t.cleCompte:"&referenceProduitService="+t.codeActiviteCompte+"000000000",this.serviceAgentExtended.sendRequest({
url:a,withHeaders:!0,method:MyWay.Services.MethodEnum.GET}).then(function(e){return 1===e.length?e[0]:null})},i.prototype.calculerReserveEncaissement=function(i,n,t,r){var o,a=this;if(i&&i.indicePresenceListeBlanche===e.Constantes.OperationFinanciere.TEXTE_NON_N){var s=MyWay.Services.StringUtils.padLeftNumber(i.montantSeuilCheque.toString(),e.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,12),c=MyWay.Services.StringUtils.padLeftNumber(i.delaiMiniAlerteApresOuvertureCompte.toString(),e.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,3),l=MyWay.Services.StringUtils.padLeftNumber(i.delaiMaxiAlerteAprèsOuvertureCompte.toString(),e.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,3),p=MyWay.Services.StringUtils.padLeftNumber(t,e.Constantes.ChiffreString.CHIFFRE_ZERO_STRING,4),m=[{propriete:e.Constantes.TablesDelocaliseesReserveEncaissement.PROPRIETE_TABLE_DELOC_CODIPR,valeur:p,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:e.Constantes.TablesDelocaliseesReserveEncaissement.PROPRIETE_TABLE_DELOC_COHCBQ,valeur:n,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:e.Constantes.TablesDelocaliseesReserveEncaissement.PROPRIETE_TABLE_DELOC_MSHCCH,valeur:s,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:e.Constantes.TablesDelocaliseesReserveEncaissement.PROPRIETE_TABLE_DELOC_CDMBSR,valeur:i.codeSegmentRisqueCategorieClient,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:e.Constantes.TablesDelocaliseesReserveEncaissement.PROPRIETE_TABLE_DELOC_COMBNC,valeur:i.noteBPCE,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:e.Constantes.TablesDelocaliseesReserveEncaissement.PROPRIETE_TABLE_DELOC_PEHCAM,valeur:c,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL},{propriete:e.Constantes.TablesDelocaliseesReserveEncaissement.PROPRIETE_TABLE_DELOC_PEHCAO,valeur:l,operateur:MyWay.Services.DonneesDelocalisees.CRITERES_OPERATEUR.EGAL}];return this.serviceAgentExtended.DonneesDelocalisees.getDonneesParCriteres(n,e.Constantes.TablesDelocaliseesReserveEncaissement.TABLE_DELOC_RESERVE_ENCAISSEMENT_GU4E,m).then(function(n){var t=0;return n&&n.length>0?(t=i.codeEtatRemiseCheque===e.Constantes.OperationFinanciere.TEXTE_OUI_O?a.calculerNombreJoursReserveEncaissement(parseInt(n[0].QTGXR7)):a.calculerNombreJoursReserveEncaissement(parseInt(n[0].QTGXRE)),o=n[0].CIGXRC===e.Constantes.OperationFinanciere.TEXTE_NON_N?new MyWay.Model.ReserveEncaissement(!0,t):new MyWay.Model.ReserveEncaissement(!1,t),n[0].CIGXRC===e.Constantes.ReserveEncaissementCheque.TEXTE_CODE_R&&(o=r&&r>i.montantSeuilCheque/100?new MyWay.Model.ReserveEncaissement(!1,t):new MyWay.Model.ReserveEncaissement(!0,t))):o=new MyWay.Model.ReserveEncaissement(!0,t),a.$q.when(o)})}return o=new MyWay.Model.ReserveEncaissement(!0,0),this.$q.when(o)},i.prototype.calculerNombreJoursReserveEncaissement=function(e){var i=e;return 0===e?i=5:e>100&&(i=parseInt(e.toString().substring(1,e.toString().length-1))),i},i.MOYEN_PAIEMENT_VERSION="/moyenpaiementparametre-v1/",i.$inject=["$q","serviceAgentExtended"],i}();e.TypeChequeService=i,e.module.service("typeChequeService",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function i(e,i,n,t){var r=this;this.$q=e,this.$scope=i,this.serviceAgentExtended=n,this.tarificationTarificationPrestationService=t,this.codeDevise="",this.afficherCaseCocher=!1,i.$on("montant_changed_tarification_vrac",function(e,i){if(null!=i){var n="",t="",o="";r.compte&&r.compte.rice&&(n=r.compte.rice.codeEtablissement),r.compte&&r.compte.devise&&(r.codeDevise=r.compte.devise.code),r.compte&&r.compte.rice&&(t=r.compte.rice.codeGuichet.value),r.compte&&r.compte.rice&&(o=r.compte.rice.codeActiviteCompte+r.compte.rice.radical+r.compte.rice.cleCompte),r.calculMontantTarification(i,n,r.codeDevise,r.identifiantPersonne,t,o).then(function(e){e?(r.montantTarification=e,r.afficherCaseCocher=!0):r.afficherCaseCocher=!1})["catch"](function(){r.afficherCaseCocher=!1})}}),i.$on("desactivation_case_vrac",function(e){r.caseCoche=!1,r.facturationPrestation&&(r.facturationPrestation.estFacturationPrestation=!1)})}return i.prototype.calculMontantTarification=function(i,n,t,r,o,a){var s=this,c=this.$q.defer(),l=1134;return this.codePrestationTarifiable="1134",this.facturationPrestation=new e.comOpesFinancieres.Model.FacturationPrestation(this.codePrestationTarifiable),this.facturationPrestation.montant.codeDevise=t,this.cocheDuVrac(),this.compte&&this.compte.devise&&(this.facturationPrestation.montant.devise=this.compte.devise),this.tarificationTarificationPrestationService.getTarificationPrestation(n,l,i,t,null,r,o,a,"O").then(function(e){e.montantATarifer>0?(s.facturationPrestation.libellePrestation=e.libelleReleveCompte1,s.facturationPrestation.montant.montant=e.montantATarifer,s.afficherCaseCocher=!0,c.resolve(e.montantATarifer)):(s.afficherCaseCocher=!1,c.resolve(null))})["catch"](function(e){c.reject(e)}),c.promise},i.prototype.cocheDuVrac=function(){this.caseCoche&&this.facturationPrestation?this.facturationPrestation.estFacturationPrestation=!0:this.facturationPrestation.estFacturationPrestation=!1},i.$inject=["$q","$scope","serviceAgentExtended","tarificationTarificationPrestationService"],i}();i.VracTarificationController=n,i.module.controller("vracTarificationController",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/vrac-tarification/vrac-tarification-view.html",scope:{compte:"=",identifiantPersonne:"=",codePrestationTarifiable:"=?",facturationPrestation:"="},controller:"vracTarificationController",controllerAs:"ctrl",bindToController:!0}}e.mwsfVracTarification=i,e.module.directive("mwsfVracTarification",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(n,t,r){var o=this;this.$scope=n,this.serviceAgentExtended=t,this.operationFinanciereService=r,this.afficherBoutonSaisirCompte=!0,this.estForcage=!1,this.texteBouton=i.TEXTE_SAISIR_AUTRE_COMPTE,this.traitementRechercheComptes(),angular.isUndefined(this.blocageEditionVirement)&&(this.blocageEditionVirement=!1),null!=this.forcerAffichageRiceSaisie&&(this.afficherBoutonSaisirCompte=!1,null!=this.riceSaisiePreRemplit&&(this.rice=this.riceSaisiePreRemplit,this.afficherBoutonSaisirCompte=!1,n.$emit("rice_virement_interne_manuel",this.rice))),angular.isUndefined(this.codeGuichet)?this.serviceAgentExtended.getParametresComptables().then(function(e){e&&!o.estForcage&&(o.rice.codeGuichet={id:0,value:e.codeGuichetInterbancaire})}):this.rice.codeGuichet={id:0,value:this.codeGuichet},n.$watch(function(){return o.compteSelectionne},function(i,t){angular.equals(i,t)||(null!=i?(null!=i.valeurProduit&&(i.codeDeviseContrat!==e.Constantes.Devise.TEXTE_CODE_DEVISE_EURO&&i.valeurProduitDevise?o.soldeCompteChoisi=i.valeurProduitDevise:o.soldeCompteChoisi=i.valeurProduit),n.$emit("rice_virement_interne",i,o.soldeCompteChoisi)):o.estForcage||n.$emit("rice_virement_interne",null,0))}),n.$on("mode_financier_changed",function(i,n){null!==n&&n!==e.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&(o.compteSelectionne=null,o.rice&&(o.rice=new MyWay.Model.Rice(o.rice.codeEtablissement,o.rice.codeGuichet)))}),n.$watch(function(){return o.rice},function(e,i){e===i||!e.isComplete()&&null!==e.radical||(o.rice=e,n.$emit("rice_virement_interne_manuel",e))},!0),n.$watchCollection(function(){return o.listeNumerosPersonnes},function(e,i){o.traitementRechercheComptes()}),n.$watch(function(){return o.blocageEditionVirement},function(e,i){e!==i&&(o.blocageEditionVirement=e)}),n.$on("mwsfVirementInterne_forcage_opefi",function(e,i){o.compteSelectionne=i,o.afficherBoutonSaisirCompte=!0,o.estForcage=!0}),n.$on("mwsfVirementInterneSaisie_forcage_opefi",function(e,i){o.rice=i,o.afficherBoutonSaisirCompte=!1,o.estForcage=!0,n.$emit("rice_virement_interne_manuel",i)})}return i.prototype.traitementRechercheComptes=function(){this.parametreListeComptes=this.operationFinanciereService.creationObjetParametreListeComptes(this.typeRecherche,this.codeEtatRecherche,this.listeNumerosPersonnes,this.numeroPersonne,this.listeTypesProduits,this.codeDevise,this.compteEnleverListe)},i.prototype.boutonSaisirCleanCompteSelectionne=function(){this.afficherBoutonSaisirCompte=!1,this.texteBouton=i.TEXTE_BOUTON_AFFICHER_LISTE,this.compteSelectionne=null},i.prototype.boutonSaisirCompte=function(){this.afficherBoutonSaisirCompte?(this.afficherBoutonSaisirCompte=!1,this.texteBouton=i.TEXTE_BOUTON_AFFICHER_LISTE,this.compteSelectionne=null,this.$scope.$emit("rice_virement_interne",null,0)):(this.afficherBoutonSaisirCompte=!0,this.texteBouton=i.TEXTE_SAISIR_AUTRE_COMPTE,this.compteSelectionne=null,this.rice=new MyWay.Model.Rice(this.rice.codeEtablissement,this.rice.codeGuichet),this.$scope.$emit("rice_virement_interne_manuel",this.rice))},i.$inject=["$scope","serviceAgentExtended","operationFinanciereService"],i.TEXTE_SAISIR_AUTRE_COMPTE="Saisir un autre compte",i.TEXTE_BOUTON_AFFICHER_LISTE="Afficher la liste des comptes",i.TEXTE_LETTRE_CODE_ETAT_RECHERCHE_T="T",i.TEXTE_LETTRE_TYPE_RECHERCHE_B="B",i}();e.VirementInterneController=i,e.module.controller("VirementInterneController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/virement-interne/virement-interne-view.html",scope:{rice:"=",numeroPersonne:"=",compteSelectionne:"=",typeRecherche:"=?",codeEtatRecherche:"=?",listeNumerosPersonnes:"=?",listeTypesProduits:"=?",codeDevise:"=?",blocageEditionVirement:"=?",compteEnleverListe:"=?",forcerAffichageRiceSaisie:"=?",riceSaisiePreRemplit:"=?",codeGuichet:"=?"},controller:"VirementInterneController",controllerAs:"viewModelVirementInterneCtrl",bindToController:!0,link:function(e,i,n){}}}e.mwsfVirementInterne=i,e.module.directive("mwsfVirementInterne",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(e,i,n,t,r){var o=this;this.$scope=e,this.serviceAgentExtended=i,this.gabEncaisseGabService=n,this.algorithmeDistributionService=t,this.carteTempoMultiFonctionsService=r,this.modeChoixBilletterie=!1,this.nombreColTable="col-md-12, col-lg-12",this.nombreColEspace="",this.modeChoixBilletterie&&this.initialiserBilletterie(),this.estOuvertParDefaut=!0,e.$on("montant_changed",function(e,i){o.modeChoixBilletterie&&o.initialiserBilletterie()}),e.$on("mwsfChoixBilletterie_cheked",function(e,i){o.modeChoixBilletterie=i,o.modeChoixBilletterie&&o.initialiserBilletterie()})}return i.prototype.onSelectionChange=function(e){},i.prototype.initialiserBilletterie=function(){var e=this;this.tableauHorsDirective={currentPage:1,itemPerPage:4},_.isNumber(this.montantRetrait)||(this.montantRetrait=0),this.serviceAgentExtended.getAuthentificationInfo().then(function(i){return e.serviceAgentExtended.getParametresComptables().then(function(n){return e.gabEncaisseGabService.getEncaisseGab(i.agentConnecte.referenceExterneAgent,i.codeEtablissement,n.edsInterneRattachementGuichetComptable,i.agentConnecte.referenceExterneAgent)})}).then(function(i){e.listeEncaisseGab=i,e.calculerlisteRepartition(),_.isNumber(e.indiceGabDistribuable)&&e.indiceGabDistribuable>=0&&(e.ventilation10=e.listeRepartitionProposition[e.indiceGabDistribuable].ventilation[0],e.ventilation20=e.listeRepartitionProposition[e.indiceGabDistribuable].ventilation[1],e.ventilation50=e.listeRepartitionProposition[e.indiceGabDistribuable].ventilation[2],e.ventilation100=e.listeRepartitionProposition[e.indiceGabDistribuable].ventilation[3]),e.verifierMontant()})["catch"](function(i){e.serviceAgentExtended.Trace.error("Erreur lors de la récupération de l'encaisse Gab","Chargement CarteTMF",i)})},i.prototype.calculerlisteRepartition=function(){var i,n=this;if(this.indiceGabDistribuable=-1,this.listeRepartitionProposition=[],this.listeEncaisseGab){for(var t=0;t<this.listeEncaisseGab.length;t++){i={numeroGab:this.listeEncaisseGab[t].identifiantNumeroNational,etatGab:this.listeEncaisseGab[t].etatGab,montant:this.montantRetrait,coupure:[e.Constantes.ChiffreNumber.CHIFFRE_DIX_NUMBER,e.Constantes.ChiffreNumber.CHIFFRE_VINGT_NUMBER,e.Constantes.ChiffreNumber.CHIFFRE_CINQUANTE_NUMBER,e.Constantes.ChiffreNumber.CHIFFRE_CENT_NUMBER],reste:[0,0,0,0],ventilation:null,statutVentilation:-1};for(var r=0;r<this.listeEncaisseGab[t].listesCassettesGab.length;r++)if(+this.listeEncaisseGab[t].listesCassettesGab[r].etatCassette<=e.Constantes.EtatCassette.PRESQUE_VIDE)switch(this.listeEncaisseGab[t].listesCassettesGab[r].montantCoupureCassette){case e.Constantes.ChiffreNumber.CHIFFRE_DIX_NUMBER:i.reste[0]+=this.listeEncaisseGab[t].listesCassettesGab[r].nombreBilletsRestants;break;case e.Constantes.ChiffreNumber.CHIFFRE_VINGT_NUMBER:i.reste[1]+=this.listeEncaisseGab[t].listesCassettesGab[r].nombreBilletsRestants;break;case e.Constantes.ChiffreNumber.CHIFFRE_CINQUANTE_NUMBER:i.reste[2]+=this.listeEncaisseGab[t].listesCassettesGab[r].nombreBilletsRestants;break;case e.Constantes.ChiffreNumber.CHIFFRE_CENT_NUMBER:i.reste[3]+=this.listeEncaisseGab[t].listesCassettesGab[r].nombreBilletsRestants}i=this.algorithmeDistributionService.calcProposition(i),0===i.statutVentilation&&(this.indiceGabDistribuable=t),this.listeRepartitionProposition.push(i),this.indiceGabDistribuable>=0&&_.forEach(this.listeRepartitionProposition,function(e){if(0===e.statutVentilation)for(var i=0;i<e.ventilation.length;i++)e.ventilation[i]=n.listeRepartitionProposition[n.indiceGabDistribuable].ventilation[i]})}this.ventilationValide=this.indiceGabDistribuable<0?!1:!0,this.ventilationValide?this.listeRepartition=angular.copy(this.listeRepartitionProposition):this.listeRepartition=null,this.construireListeRepartitionAffiche()}},i.prototype.verifierUndefined=function(){void 0===this.ventilation10&&(this.ventilation10=0,this.verifierMontant()),void 0===this.ventilation20&&(this.ventilation20=0,this.verifierMontant()),void 0===this.ventilation50&&(this.ventilation50=0,this.verifierMontant()),void 0===this.ventilation100&&(this.ventilation100=0,this.verifierMontant())},i.prototype.verifierMontant=function(){this.ventilationValide=!0,this.montantDistribue=0,this.montantDifference=0,_.isNumber(this.ventilation10)||_.isNumber(this.ventilation20)||_.isNumber(this.ventilation50)||_.isNumber(this.ventilation100)?(_.isNumber(this.ventilation10)&&(this.montantDistribue+=10*this.ventilation10),_.isNumber(this.ventilation20)&&(this.montantDistribue+=20*this.ventilation20),_.isNumber(this.ventilation50)&&(this.montantDistribue+=50*this.ventilation50),_.isNumber(this.ventilation100)&&(this.montantDistribue+=100*this.ventilation100),this.montantDistribue!==this.montantRetrait&&(this.ventilationValide=!1),this.montantDifference=this.montantRetrait-this.montantDistribue):this.ventilationValide=!1,this.miseAjourListeRepartition()},i.prototype.miseAjourListeRepartition=function(){var e=this;this.ventilationValide?(this.listeRepartition=angular.copy(this.listeRepartitionProposition),_.forEach(this.listeRepartition,function(i){0===i.statutVentilation&&(i.ventilation[0]=e.ventilation10,i.ventilation[1]=e.ventilation20,i.ventilation[2]=e.ventilation50,i.ventilation[3]=e.ventilation100)})):this.listeRepartition=null},i.prototype.construireListeRepartitionAffiche=function(){if(this.listeRepartitionAffiche=angular.copy(this.listeRepartitionProposition),this.listeRepartitionProposition&&this.listeRepartitionProposition.length>0)for(var e=this.tableauHorsDirective.itemPerPage,i=Math.floor(this.listeRepartitionProposition.length/e),n=e-(this.listeRepartitionProposition.length-i*e),t=0;n>t;t++){var r={};this.listeRepartitionAffiche.push(angular.copy(r))}},i.$inject=["$scope","serviceAgentExtended","gabEncaisseGabService","algorithmeDistributionService","carteTempoMultiFonctionsService"],i}();e.ChoixBilletterieController=i,e.module.controller("ChoixBilletterieController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(){return{restrict:"E",templateUrl:"typescript/carte-tempo-multi-fonctions/choix-billetterie/choix-billetterie-view.html",scope:{montantRetrait:"=",listeRepartition:"="},controller:"ChoixBilletterieController",controllerAs:"choixBilletterieCtrl",bindToController:!0,link:function(e,i,n){}}}e.mwsfChoixBilletterie=i,e.module.directive("mwsfChoixBilletterie",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i;!function(e){var i;!function(e){function i(){var i=new e.SikggceBordTmfArchiverParams;return i.obligatoires.parametresGenerationFichier.typeFichier=MyWay.Services.Fichier.TYPE_FICHIER.PDF,i.optionnels.nomFichier="sikggceBordTmf.pdf",i.optionnels.archivage.gceContextSoapHeader.codeTypeIdntExtn="W",i.optionnels.archivage.gceContextSoapHeader.idntAgnt="A0070767",i.optionnels.archivage.gceContextSoapHeader.idntAgntAcces="A0070767",i.optionnels.archivage.gceContextSoapHeader.idntAgntTech="T0070767",i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt="131",i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt=i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt+"40",i.optionnels.archivage.gceContextSoapHeader.idntExtnConx="0070767",i.optionnels.archivage.gceContextSoapHeader.idntInteEdsAgnt="0070767",i.optionnels.archivage.gceContextSoapHeader.refrExtnAgnt="0070767",i.optionnels.archivage.gceContextSoapHeader.refrPosteFoncAgnt="12321",i.optionnels.archivage.gceContextSoapHeader.typePrflAgnt="2",i.optionnels.archivage.gceContextSoapHeader.extendedProperties="1",i.optionnels.archivage.aQstnCreerDoc.donnCntx.codeEtablissement="131",i.optionnels.archivage.aQstnCreerDoc.donnCntx.codeEtablissement=i.optionnels.archivage.aQstnCreerDoc.donnCntx.codeEtablissement+"35",i.optionnels.archivage.aQstnCreerDoc.donnCntx.idntCmpstApplf="PDC",i.optionnels.archivage.aQstnCreerDoc.document.fichierDoc.nomFich="sikggceBordTmf.pdf",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeNatrDoc="PACN",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeAttrb="1",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb="131",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb=i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb+"3500080200123981",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateDeliv=new Date,i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateNumr=new Date,i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.inttAttr="DocTestGceDoc",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeStck="L",i}function n(){var i=new e.SikggceBordTmfGenererParams;return i.obligatoires.parametresGenerationFichier.typeFichier=MyWay.Services.Fichier.TYPE_FICHIER.PDF,i.optionnels.nomFichier="sikggceBordTmf.pdf",i}function t(){var i=new e.SikggceBordTmfArchiverGenererParams;return i.obligatoires.parametresGenerationFichier.typeFichier=MyWay.Services.Fichier.TYPE_FICHIER.PDF,i.optionnels.nomFichier="sikggceBordTmf.pdf",i.optionnels.archivage.gceContextSoapHeader.codeTypeIdntExtn="W",i.optionnels.archivage.gceContextSoapHeader.idntAgnt="A0070767",i.optionnels.archivage.gceContextSoapHeader.idntAgntAcces="A0070767",i.optionnels.archivage.gceContextSoapHeader.idntAgntTech="T0070767",i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt="131",i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt=i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt+"40",i.optionnels.archivage.gceContextSoapHeader.idntExtnConx="0070767",i.optionnels.archivage.gceContextSoapHeader.idntInteEdsAgnt="0070767",i.optionnels.archivage.gceContextSoapHeader.refrExtnAgnt="0070767",i.optionnels.archivage.gceContextSoapHeader.refrPosteFoncAgnt="12321",i.optionnels.archivage.gceContextSoapHeader.typePrflAgnt="2",i.optionnels.archivage.gceContextSoapHeader.extendedProperties="1",i.optionnels.archivage.aQstnCreerDoc.donnCntx.codeEtablissement="131",i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt=i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt+"35",i.optionnels.archivage.aQstnCreerDoc.donnCntx.idntCmpstApplf="PDC",i.optionnels.archivage.aQstnCreerDoc.document.fichierDoc.nomFich="sikggceBordTmf.pdf",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeNatrDoc="PACN",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeAttrb="1",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb="131",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb=i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb+"3500080200123981",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateDeliv=new Date,i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateNumr=new Date,i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.inttAttr="DocTestGceDoc",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeStck="L",i}function r(){var i=new e.SikggceBordTmfImpressionParams;return i.obligatoires.parametresGenerationFichier.typeFichier=MyWay.Services.Fichier.TYPE_FICHIER.PDF,i.obligatoires.nomFichier="sikggceBordTmf.pdf",i.optionnels.parametreActiveX.annul=!1,i.optionnels.parametreActiveX.impdef=!1,i.optionnels.parametreActiveX.affred=!1,i.optionnels.parametreActiveX.reimp=!1,i.optionnels.parametreActiveX.enregistrer=!1,i.optionnels.parametreActiveX.voir=!1,i.optionnels.parametreActiveX.blocnbex=!1,i.optionnels.parametreActiveX.maxcop=1,i.optionnels.parametreActiveX.mincop=1,i.optionnels.parametreActiveX.nbcopiesdef=1,i}function o(){var i=new e.SikggceBordTmfArchiverImpressionParams;return i.obligatoires.parametresGenerationFichier.typeFichier=MyWay.Services.Fichier.TYPE_FICHIER.PDF,i.obligatoires.nomFichier="sikggceBordTmf.pdf",i.optionnels.parametreActiveX.annul=!1,i.optionnels.parametreActiveX.impdef=!1,i.optionnels.parametreActiveX.affred=!1,i.optionnels.parametreActiveX.reimp=!1,i.optionnels.parametreActiveX.enregistrer=!1,i.optionnels.parametreActiveX.voir=!1,i.optionnels.parametreActiveX.blocnbex=!1,i.optionnels.parametreActiveX.maxcop=1,i.optionnels.parametreActiveX.mincop=1,i.optionnels.parametreActiveX.nbcopiesdef=1,i.optionnels.archivage.gceContextSoapHeader.codeTypeIdntExtn="W",i.optionnels.archivage.gceContextSoapHeader.idntAgnt="A0070767",i.optionnels.archivage.gceContextSoapHeader.idntAgntAcces="A0070767",i.optionnels.archivage.gceContextSoapHeader.idntAgntTech="T0070767",i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt="131",i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt=i.optionnels.archivage.gceContextSoapHeader.idntEtabEntt+"40",i.optionnels.archivage.gceContextSoapHeader.idntExtnConx="0070767",i.optionnels.archivage.gceContextSoapHeader.idntInteEdsAgnt="0070767",i.optionnels.archivage.gceContextSoapHeader.refrExtnAgnt="0070767",i.optionnels.archivage.gceContextSoapHeader.refrPosteFoncAgnt="12321",i.optionnels.archivage.gceContextSoapHeader.typePrflAgnt="2",i.optionnels.archivage.gceContextSoapHeader.extendedProperties="1",i.optionnels.archivage.aQstnCreerDoc.donnCntx.codeEtablissement="131",i.optionnels.archivage.aQstnCreerDoc.donnCntx.codeEtablissement=i.optionnels.archivage.aQstnCreerDoc.donnCntx.codeEtablissement+"35",i.optionnels.archivage.aQstnCreerDoc.donnCntx.idntCmpstApplf="PDC",i.optionnels.archivage.aQstnCreerDoc.document.fichierDoc.nomFich="sikggceBordTmf.pdf",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeNatrDoc="PACN",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeAttrb="1",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb="131",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb=i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.idntAttrb+"3500080200123981",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateDeliv=new Date,i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.dateNumr=new Date,i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.inttAttr="DocTestGceDoc",i.optionnels.archivage.aQstnCreerDoc.document.proprietesDoc.codeTypeStck="L",i}function a(){var i=new e.SikggceBordTmfImpressionLotParams;return i.parametresLot.numeroOrdre=1,i.parametresLot.codeEtablissement="131",i.parametresLot.codeEtablissement=i.parametresLot.codeEtablissement+"35",i.parametresLot.composantApplicatif=void 0,i.parametresLot.fichier="FLUX pdf base 64",i.parametresLot.idGed=void 0,i.parametresLot.impressionParams.obligatoires.nomFichier="sikggceBordTmf.pdf",i.parametresLot.impressionParams.optionnels.parametresActiveXIndividuels.enregistrer=!0,i.parametresLot.impressionParams.optionnels.parametresActiveXIndividuels.voir=!0,i.parametresLot.impressionParams.optionnels.parametresActiveXIndividuels.nbcopiesdef=1,i.parametresLot.impressionParams.optionnels.parametresActiveXIndividuels.maxcop=2,i.parametresLot.impressionParams.optionnels.parametresActiveXIndividuels.mincop=1,i}function s(i,n,t,r){var o=new e.SikggceBordTmf,a={},s=new Array,l=new Array,p={},m={};m.nomclient=r.nomclient,m.adresse=r.adresse,p.blClient=m,l.push(p);var u={},d={};d.nomclient=r.nomclient,d.numcarte=r.numcarte,u.blTexte=d,l.push(u);var E={},h={},f={},v={};v.libligne=r.libligne,f.ligne1=[v],h.listemouv=[f],E.blMouvements=h,l.push(E);var C={},O={};O.etablissement=t.delaEtab1,O.agent=i.agentConnecte.designationLongueAgent,O.piece=r.piece,C.blSignature=O,l.push(C),a.blocChoiceJson=l,s.push(a),o.section1=s,o.genericEnteteets=c(i,n);var R={};return o.genericPiedpageets=R,o}function c(e,i){var n={},t=new Array,r={};return r.attributeContent=0,r.valueImgJson=e.codeEtablissement+".jpg",n.logoEtablissement=r,n.libelleAgence=i.libelleEdsRattachementGuichetComptable,n.coceelAgence=i.edsExterneGuichetComptable,n.nodatpAgence=i.numTelEdsRattachementGuichetComptable,n.dateEdition=moment().format("DD/MM/YYYY"),n.heureEdition=moment().format("HH:mm:ss"),n.numRefdoc="Document non contractuel (Sous réserve d'opérations en cours)",n.codeBarre=null,n.refActe=null,t.push(n),t}e.createArchiverParams=i,e.createGenererParams=n,e.createArchiverGenererParams=t,e.createImpressionParams=r,e.createArchiverImpressionParams=o,e.createImpressionLotParams=a,e.createDocument=s,e.genererEntete=c}(i=e.sikggceBordTmf||(e.sikggceBordTmf={}))}(i=e.impression||(e.impression={}))}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this.attributeId="SIKGGCE_BordTMF.docx",this.attributeXmlns="http://SIKGGCE_BordTMF.xsd",this.attributeCamel="O"}return e}();e.SikggceBordTmf=i;var n=function(){function e(){this.systeme={typeName:"sikggceBordTmf",typeFullName:"comOpesFinancieres.CarteTMF.impression.sikggceBordTmf.sikggceBordTmf",librairie:"comOpesFinancieres.CarteTMF.Impression_04-EPARGNE_OPRETDEL_SIKGGCE_BordTMF"},this.obligatoires={action:MyWay.Services.Impression.GENERATION_ACTION.archiver,parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDF,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"04-epargne/opretdel_doc"}},this.optionnels={nomFichier:"sikggceBordTmf.pdf",archivage:{gceContextSoapHeader:{codeTypeIdntExtn:"W",idntAgnt:"A0070767",idntAgntAcces:"A0070767",idntAgntTech:"T0070767",idntEtabEntt:"00000",idntExtnConx:"0070767",idntInteEdsAgnt:"0070767",refrExtnAgnt:"0070767",refrPosteFoncAgnt:"12321",typePrflAgnt:"2",extendedProperties:"1"},aQstnCreerDoc:{donnCntx:{codeEtablissement:"00000",idntCmpstApplf:"PDC"},document:{proprietesDoc:{codeTypeNatrDoc:"PACN",codeTypeAttrb:"1",idntAttrb:"0000000080200123981",dateDeliv:new Date,dateNumr:new Date,inttAttr:"DocTestGceDoc",codeTypeStck:"L"},fichierDoc:{nomFich:"sikggceBordTmf.pdf"}}}}}}return e}();e.SikggceBordTmfArchiverParams=n;var t=function(){function e(){this.systeme={typeName:"sikggceBordTmf",typeFullName:"comOpesFinancieres.CarteTMF.impression.sikggceBordTmf.sikggceBordTmf",librairie:"comOpesFinancieres.CarteTMF.Impression_04-EPARGNE_OPRETDEL_SIKGGCE_BordTMF"},this.obligatoires={action:MyWay.Services.Impression.GENERATION_ACTION.getFichier,parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDF,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"04-epargne/opretdel_doc"}},this.optionnels={nomFichier:"sikggceBordTmf.pdf"}}return e}();e.SikggceBordTmfGenererParams=t;var r=function(){function e(){this.systeme={typeName:"sikggceBordTmf",typeFullName:"comOpesFinancieres.CarteTMF.impression.sikggceBordTmf.sikggceBordTmf",librairie:"comOpesFinancieres.CarteTMF.Impression_04-EPARGNE_OPRETDEL_SIKGGCE_BordTMF"},this.obligatoires={action:MyWay.Services.Impression.GENERATION_ACTION.archiverAndGetFichier,parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDF,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"04-epargne/opretdel_doc"}},this.optionnels={nomFichier:"sikggceBordTmf.pdf",archivage:{gceContextSoapHeader:{codeTypeIdntExtn:"W",idntAgnt:"A0070767",idntAgntAcces:"A0070767",idntAgntTech:"T0070767",idntEtabEntt:"00000",idntExtnConx:"0070767",idntInteEdsAgnt:"0070767",refrExtnAgnt:"0070767",refrPosteFoncAgnt:"12321",typePrflAgnt:"2",extendedProperties:"1"},aQstnCreerDoc:{donnCntx:{codeEtablissement:"00000",idntCmpstApplf:"PDC"},document:{proprietesDoc:{codeTypeNatrDoc:"PACN",codeTypeAttrb:"1",idntAttrb:"0000000080200123981",dateDeliv:new Date,dateNumr:new Date,inttAttr:"DocTestGceDoc",codeTypeStck:"L"},fichierDoc:{nomFich:"sikggceBordTmf.pdf"}}}}}}return e}();e.SikggceBordTmfArchiverGenererParams=r;var o=function(){function e(){this.systeme={typeName:"sikggceBordTmf",typeFullName:"comOpesFinancieres.CarteTMF.impression.sikggceBordTmf.sikggceBordTmf",librairie:"comOpesFinancieres.CarteTMF.Impression_04-EPARGNE_OPRETDEL_SIKGGCE_BordTMF"},this.obligatoires={action:MyWay.Services.Impression.GENERATION_IMPRESSION_ACTION.getFichier,nomFichier:"sikggceBordTmf.pdf",parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDF,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"04-epargne/opretdel_doc"}},this.optionnels={parametreActiveX:{annul:!1,enregistrer:!1,voir:!1,impdef:!1,affred:!1,reimp:!1,blocnbex:!1,maxcop:0,mincop:0,nbcopiesdef:1}}}return e}();e.SikggceBordTmfImpressionParams=o;var a=function(){function e(){this.systeme={typeName:"sikggceBordTmf",typeFullName:"comOpesFinancieres.CarteTMF.impression.sikggceBordTmf.sikggceBordTmf",librairie:"comOpesFinancieres.CarteTMF.Impression_04-EPARGNE_OPRETDEL_SIKGGCE_BordTMF"},this.obligatoires={action:MyWay.Services.Impression.GENERATION_IMPRESSION_ACTION.archiverAndGetFichier,nomFichier:"sikggceBordTmf.pdf",parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDF,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"04-epargne/opretdel_doc"}},this.optionnels={parametreActiveX:{annul:!1,enregistrer:!1,voir:!1,impdef:!1,affred:!1,reimp:!1,blocnbex:!1,maxcop:0,mincop:0,nbcopiesdef:1},archivage:{gceContextSoapHeader:{codeTypeIdntExtn:"W",idntAgnt:"A0070767",idntAgntAcces:"A0070767",idntAgntTech:"T0070767",idntEtabEntt:"00000",idntExtnConx:"0070767",idntInteEdsAgnt:"0070767",refrExtnAgnt:"0070767",refrPosteFoncAgnt:"12321",typePrflAgnt:"2",extendedProperties:"1"},aQstnCreerDoc:{donnCntx:{codeEtablissement:"00000",idntCmpstApplf:"PDC"},document:{proprietesDoc:{codeTypeNatrDoc:"PACN",codeTypeAttrb:"1",idntAttrb:"0000000080200123981",dateDeliv:new Date,dateNumr:new Date,inttAttr:"DocTestGceDoc",
codeTypeStck:"L"},fichierDoc:{nomFich:"sikggceBordTmf.pdf"}}}}}}return e}();e.SikggceBordTmfArchiverImpressionParams=a;var s=function(){function e(){this.parametresLot={numeroOrdre:1,fichier:null,idGed:null,composantApplicatif:"compAppli",codeEtablissement:"00000",impressionParams:{obligatoires:{nomFichier:"sikggceBordTmf.pdf"},optionnels:{parametresActiveXIndividuels:{voir:!1,enregistrer:!1,blocnbex:!1,nbcopiesdef:1,maxcop:0,mincop:0}}}}}return e}();e.SikggceBordTmfImpressionLotParams=s}(i=e.sikggceBordTmf||(e.sikggceBordTmf={}))}(i=e.impression||(e.impression={}))}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n;!function(i){var n=function(){function i(e,i,n,t){this.serviceAgentExtended=e,this.$q=i,this.$filter=n,this.libelleCaisseService=t}return i.prototype.routerVersSpaContractualisation=function(i,n,t){var r=this;void 0===t&&(t=!1);var o=this.$q.defer();return this.serviceAgentExtended.getAuthentificationInfo().then(function(a){r.ressourceAdresse(i.client.numeroPersonne,i.compte.rice.codeEtablissement).then(function(s){var c="";s&&s.length>0&&angular.forEach(s,function(i){i.codeTypeAdresse===e.Constantes.ChiffreString.CHIFFRE_UN_STRING&&(c=i.ligne1AdresseAFNOR?i.ligne1AdresseAFNOR+" ":"",c+=i.ligne2AdresseAFNOR?i.ligne2AdresseAFNOR+" ":"",c+=i.ligne3AdresseAFNOR?i.ligne3AdresseAFNOR+" ":"",c+=i.ligne4AdresseAFNOR?i.ligne4AdresseAFNOR+" ":"",c+=i.ligne5AdresseAFNOR?i.ligne5AdresseAFNOR+" ":"",c+=i.ligne6AdresseAFNOR?i.ligne6AdresseAFNOR+" ":"")});var l={identifiantPersonne:+i.client.numeroPersonne,identifiantAttributaire:String(i.client.numeroPersonne),intituleAttributaire:i.signataire.nomPrenomParticipant,identificationSignataire:{referenceIdentite:i.segmentPrvRio.identiteParticipant?i.segmentPrvRio.identiteParticipant.substring(0,32):"",identifie:i.segmentPrvRio.identiteParticipant?!0:!1},acte:{codeActeGestion:"BO00003293",codeCanal:"FF",codeModeMiseGestion:"M",libelleActe:"Remise de carte",listeOperationFinanciere:null,listeSignatairesActe:[{numeroPersonne:i.signataire?i.signataire.identifiantParticipant:i.client.numeroPersonne,adresseMailSign:null,rangSign:null}],listeTitulairesActe:[{numeroPersonne:i.client.numeroPersonne,adresseMail:null}]},referenceIdentite:i.segmentPrvRio.identiteParticipant?i.segmentPrvRio.identiteParticipant.substring(0,32):"",typeBordereau:"REMISE_CARTE_TEMPO",donneesBordereau:{referenceActe:"",titreDocument:"BORDEREAU DE REMISE DE CARTE TEMPO MULTI FONCTIONS",titreRolePersonne:i.signataire.libelleRole,civilite:"",nomPrenomClient:i.compte.titulaire,nomPrenomSignataire:i.signataire?i.signataire.nomPrenomParticipant:"",prefixeNomUsage:"",nomUsage:"",prefixeDateNaissance:"",dateNaissance:"",lieuNaissance:"",adresse:c,telephone:"",situationFamille:"",regimeMatrimonial:"",nationalite:"",identifiantPersonne:"",numeroCarteTempo:t?n+", dans le cadre d'une opération à distance":n,operation:[{numeroCompte:i.compte.rice.codeEtablissement+" "+i.compte.rice.getGuichet()+" "+i.compte.rice.codeActiviteCompte+i.compte.rice.radical+i.compte.rice.cleCompte+" "+i.compte.rice.cleRice,typeOperation:i.fonctionnalite===e.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT?"Dépôt espèces":"Retrait espèces",montant:i.fonctionnalite===e.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT?"":r.$filter("number")(i.montant,2),titreRolePersonne:i.signataire.libelleRole}],libelleAgentSignataire:a.agentConnecte.designationLongueAgent,libelleEtablissementSignataire:r.libelleCaisseService.getLibelleCaisse(a.codeEtablissement)}};r.serviceAgentExtended.addToContext(e.Constantes.OperationFinanciere.NOM_DONNEES_SAG_OPC,l).then(function(){return r.serviceAgentExtended.Lisa.Next(e.Constantes.OperationFinanciere.CODE_SORTIE_SAG_OPC)})["catch"](function(e){r.serviceAgentExtended.Trace.warning("Génération KO","routerVersSpaContractualisation",e),o.reject(e)})}).then(function(){o.resolve()})["catch"](function(e){r.serviceAgentExtended.Trace.warning("Génération KO","routerVersSpaContractualisation",e),o.reject(e)})})["catch"](function(e){r.serviceAgentExtended.Trace.warning("Génération KO","routerVersSpaContractualisation",e),o.reject(e)}),o.promise},i.prototype.ressourceAdresse=function(e,i){var n=this,t={codeEtablissement:i,idPersonne:e};return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/tiers/v3/adresse",withHeaders:!0,params:t}).then(function(e){return e})["catch"](function(e){return n.serviceAgentExtended.Trace.error("Ressource de récupération du /tiers/v3/adresse en erreur","ressourceAdresse",e),null})},i.$inject=["serviceAgentExtended","$q","$filter","libelleCaisseService"],i}();i.ContractualisationCarteTMFService=n,e.module.service("contractualisationCarteTMFService",n)}(n=i.impression||(i.impression={}))}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n;!function(i){var n=function(){function n(e,i,n,t){this.serviceAgentExtended=e,this.$q=i,this.$filter=n,this.libelleCaisseService=t}return n.prototype.genererImprimerBordereau=function(n,t,r){var o=this;void 0===r&&(r=!1);var a=this.$q.defer();return this.$q.all({authentificationInfo:this.serviceAgentExtended.getAuthentificationInfo(),parametresComptables:this.serviceAgentExtended.getParametresComptables()}).then(function(a){var s={alaEtab1:o.libelleCaisseService.getLibelleCaisse(a.authentificationInfo.codeEtablissement,i.ArticleCaisse.A_LA),laEtab1:o.libelleCaisseService.getLibelleCaisse(a.authentificationInfo.codeEtablissement,i.ArticleCaisse.LA,!0),laEtab11:o.libelleCaisseService.getLibelleCaisse(a.authentificationInfo.codeEtablissement,i.ArticleCaisse.LA),laEtab2:o.libelleCaisseService.getLibelleCaisse(a.authentificationInfo.codeEtablissement,i.ArticleCaisse.LA,!0),delaEtab1:o.libelleCaisseService.getLibelleCaisse(a.authentificationInfo.codeEtablissement,i.ArticleCaisse.DE_LA),laEtab21:o.libelleCaisseService.getLibelleCaisse(a.authentificationInfo.codeEtablissement,i.ArticleCaisse.LA)},c={nomclient:n.signataire.nomPrenomParticipant,adresse:"",numcarte:r?t+", dans le cadre d'une opération à distance":t,libligne:(n.fonctionnalite===e.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT?"Dépôt espèces":"Retrait espèces de "+o.$filter("number")(n.montant,2)+" "+n.compte.devise.libelle+"s")+" sur le compte "+n.compte.rice.codeEtablissement+" "+n.compte.rice.getGuichet()+" "+n.compte.rice.codeActiviteCompte+n.compte.rice.radical+n.compte.rice.cleCompte+" "+n.compte.rice.cleRice+" ("+n.signataire.libelleRole+")",piece:r?n.segmentPrvRio.identiteParticipant:n.segmentPrvRio.identiteParticipant?"Pièce(s) d'identité : "+n.segmentPrvRio.identiteParticipant:""},l=i.sikggceBordTmf.createDocument(a.authentificationInfo,a.parametresComptables,s,c),p=new i.sikggceBordTmf.SikggceBordTmfArchiverImpressionParams;return o.serviceAgentExtended.Impression.genererImprimer(l,p)}).then(function(e){a.resolve(e)})["catch"](function(e){o.serviceAgentExtended.Trace.warning("Génération KO","genererImprimerBordereau",e),a.reject(e)}),a.promise},n.$inject=["serviceAgentExtended","$q","$filter","libelleCaisseService"],n}();i.ImpressionBordereauCarteTMFService=n,e.module.service("impressionBordereauCarteTMFService",n)}(n=i.impression||(i.impression={}))}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n;!function(i){function n(e){return e===t.DES}!function(e){e[e.DES=0]="DES",e[e.LA=1]="LA",e[e.SA=2]="SA",e[e.A_LA=3]="A_LA",e[e.PAR_LA=4]="PAR_LA",e[e.DE_SA=5]="DE_SA",e[e.DE_LA=6]="DE_LA"}(i.ArticleCaisse||(i.ArticleCaisse={}));var t=i.ArticleCaisse;i.isArticlePluriel=n,function(e){e[e.F=0]="F",e[e.M=1]="M"}(i.Genre||(i.Genre={}));var r=i.Genre,o=function(){function e(){this.articlesFeminin={A_LA:"à la",LA:"la",SA:"sa",PAR_LA:"par la",DE_SA:"de sa",DE_LA:"de la",DES:"des"},this.articlesMasculin={A_LA:"au",LA:"le",SA:"son",PAR_LA:"par le",DE_SA:"de son",DE_LA:"du",DES:"des"},this.defaultLibelleCaisse={genre:r.F,libelleSingulier:"Caisse d'Epargne",libellePluriel:"Caisses d'Epargne"},this.exceptionsLibelleCaisse={12579:{genre:r.F,libelleSingulier:"Banque BCP",libellePluriel:"Banques BCP"},13220:{genre:r.F,libelleSingulier:"SOCOREC",libellePluriel:"SOCOREC"},13798:{genre:r.F,libelleSingulier:"Caisse Solidaire",libellePluriel:"Caisses Solidaires"},30258:{genre:r.F,libelleSingulier:"Banque BTP",libellePluriel:"Banques BTP"},42559:{genre:r.M,libelleSingulier:"Crédit COOP",libellePluriel:"Crédits COOP"},43199:{genre:r.M,libelleSingulier:"Crédit Foncier de France",libellePluriel:"Crédits Fonciers de France"}},angular.noop()}return e.prototype.getLibelleCaisse=function(e,i,o){if(void 0===o&&(o=!1),null==e||0===e.length)return null;var a=this.exceptionsLibelleCaisse.hasOwnProperty(e)?this.exceptionsLibelleCaisse[e]:this.defaultLibelleCaisse,s=a.genre===r.M?this.articlesMasculin:this.articlesFeminin;switch(i){case t.DES:return this.genererLibelle(a,s.DES,n(t.DES),o);case t.A_LA:return this.genererLibelle(a,s.A_LA,n(t.A_LA),o);case t.DE_LA:return this.genererLibelle(a,s.DE_LA,n(t.DE_LA),o);case t.DE_SA:return this.genererLibelle(a,s.DE_SA,n(t.DE_SA),o);case t.LA:return this.genererLibelle(a,s.LA,n(t.LA),o);case t.PAR_LA:return this.genererLibelle(a,s.PAR_LA,n(t.PAR_LA),o);case t.SA:return this.genererLibelle(a,s.SA,n(t.SA),o);default:return a.libelleSingulier}},e.prototype.genererLibelle=function(e,i,n,t){var r=t?i[0].toUpperCase()+i.substr(1):i,o=r+" ";return o+=n?e.libellePluriel:e.libelleSingulier},e}();i.LibelleCaisseService=o,e.module.service("libelleCaisseService",o)}(n=i.impression||(i.impression={}))}(i=e.CarteTMF||(e.CarteTMF={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){function i(e,i){return{restrict:"A",link:function(n,t,r,o){var a=n.$eval(r.focusChargementEnabled);a!==!1&&i.ready(function(){var i=r.focusChargementSelector;e(function(){if(i){var e=angular.element(t[0].querySelector(i));angular.isDefined(e)&&angular.isDefined(e[0])&&e[0].focus()}else t[0].focus()},500)})}}}e.module.directive("focusChargement",["$timeout","$document",i])}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function i(i,n,t,r){this.$scope=i,this.$modalInstance=n,this.modalService=t,this.constantes=e.Constantes,this.modalDatas=r,this.estVerifie=!1,this.estAvecAlertesGab=this.modalDatas.listeMessageAlerteGab&&this.modalDatas.listeMessageAlerteGab.length>0}return i.prototype.actionEntree=function(){this.valider()},i.prototype.verifierFormulaire=function(){return this.estVerifie=!0,!this.saisieErroneeNumeroCarte()},i.prototype.changementNumeroTmf=function(){var e=this,i=!1;MyWay.Services.StringUtils.startsWith(this.modalDatas.numeroCarte,"M")||MyWay.Services.StringUtils.startsWith(this.modalDatas.numeroCarte,"m")?this.modalDatas.numeroCarte.length>=20&&(/[Mm]\d{19}/.test(this.modalDatas.numeroCarte.substring(0,20))?this.modalDatas.numeroCarte=this.modalDatas.numeroCarte.substring(12,20):i=!0):this.modalDatas.numeroCarte.length>=8&&(/\d{8}/.test(this.modalDatas.numeroCarte.substring(0,8))?this.modalDatas.numeroCarte=this.modalDatas.numeroCarte.substring(0,8):i=!0),i&&this.modalService.showPopup({headerText:"Erreur",bodyText:"Numéro de carte incorrect. Vérifiez que la touche Verr. MAJ n’est pas active et renseignez à nouveau le numéro de carte.",closeButtonText:"Fermer",iconName:"itce-ban",size:"md"})["finally"](function(){e.modalDatas.numeroCarte=""})},i.prototype.saisieErroneeNumeroCarte=function(){return this.estVerifie&&(this.form.numerocarte.$invalid||!this.modalDatas.numeroCarte||8!==this.modalDatas.numeroCarte.length)},i.prototype.annuler=function(){this.$modalInstance.dismiss()},i.prototype.valider=function(){this.verifierFormulaire()&&this.$modalInstance.close("valider")},i.$inject=["$scope","$modalInstance","modalService","data"],i}();e.ModalInitialiserCarteTmfController=i,e.module.controller("ModalInitialiserCarteTmfController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i,n,t,r){this.$scope=e,this.impressionChequeDeBanqueService=i,this.chequeBanqueService=n,this.$modalInstance=t,this.modalDatas=r}return e.prototype.close=function(){this.$modalInstance.dismiss("cancel")},e.prototype.nePasImprimer=function(){var e=this;this.chequeBanqueService.getNumeroConseiller().then(function(i){e.chequeBanqueService.razChequeGlobal(e.modalDatas.chequeDeBanqueEnCours,i),e.$modalInstance.close("ne_pas_imprimer")})},e.prototype.imprimer=function(){var e=this;this.impressionChequeDeBanqueService.genererChequeDeBanque(this.modalDatas.chequeDeBanqueEnCours,this.modalDatas.contexteSaisieOpeFi).then(function(){e.$modalInstance.close("imprimer")})["catch"](function(i){e.$modalInstance.dismiss(i)})},e.$inject=["$scope","impressionChequeDeBanqueService","chequeBanqueService","$modalInstance","data"],e}();e.ModalChequeBanqueController=i,e.module.controller("ModalChequeBanqueController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i=function(){function e(e,i,n,t,r){this.$scope=e,this.impressionChequeDeBanqueService=i,this.chequeBanqueService=n,this.$modalInstance=t,this.modalDatas=r}return e.prototype.close=function(){this.$modalInstance.dismiss("cancel")},e.prototype.nePasImprimer=function(){this.$modalInstance.close("ne_pas_imprimer")},e.prototype.imprimer=function(){var e=this;this.impressionChequeDeBanqueService.genererChequeDeBanque(this.modalDatas.chequeDeBanqueEnCours,this.modalDatas.contexteSaisieOpeFi).then(function(){e.$modalInstance.close("imprimer")})["catch"](function(i){e.$modalInstance.dismiss(i)})},e.$inject=["$scope","impressionChequeDeBanqueService","chequeBanqueService","$modalInstance","data"],e}();e.ModalChequeBanqueOperationDepotRetraitController=i,e.module.controller("modalChequeBanqueOperationDepotRetraitController",i)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this.monnaieBilleterie=0,this.nombreCoupure=new MyWay.Model.Coupure,this.monnaieSansBillet=0}return e}();e.SegmentBilleterie=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this.S_INFOCHEQUE=[],this.modeFonctionnement="",this.montant=0,this.deviseMontant="",this.S_INFOCHEQUE=[]}return e}();e.SegmentCheque=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this.deviseCheque="",this.numeroCheque="",this.zoneInterBancaire="",this.zoneInterne="",this.montantCheque=0}return e}();e.SegmentInfoCheque=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this.mode="",this.codeRegroupement="",this.modeSerie="",this.codeRequete="",this.codeFamilleOd="",this.codeTypeOd="",this.codeSensOd="",this.libelleFamilleOd="",this.libelleTypeOd="",this.libelleIndicateurZoneTiers="",this.indicateurZoneTiers="",this.libelleIndicateurZoneObligatoire="",this.indicateurZoneObjetObligatoire=""}return e}();e.SegmentInfoOd=i;var n=function(){function e(){this.numeroCompteclient="",this.codeDeviseOperation="",this.montantCommission=0,this.montantOperation=0,this.libelleFamilleOD="",this.libelleTypeOD="",this.detailAImprimer="",this.codeTransaction="",this.codeReferenceOD="",this.codeFamilleOD="",this.libelle1SaisiOD="",this.libelle2SaisiOD=""}return e}();e.SegmentPRJO=n}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n;!function(i){var n=function(){function i(){this.titre="",this.mfIndicateur="",this.texteBoutonValidation="",this.montantMinimum=0,this.montantMaximum=0,this.codeDeviseMontantParametre="",this.numeroCompteRice="",this.anneesProrogationPEL="",this.modeFinancierNumerique="",this.codeEvenementAtome="",this.codePrestationTarifaire="",this.modeFinancierChoisi="",this.codeDeviseMontantOperation="",this.montantGlobalOperation=0,this.libelleOperation1="",this.indicateurLibelleBlocage="",this.dateDeValeur=null,this.indicateurDateBlocage="",this.codeRoleParticipant="",this.nomPatronymiqueParticipant="",this.prenomParticipant="",this.prenomParticipant="",this.identiteParticipant="",this.numeroTelephoneParticipant="",this.numeroCheque="",this.ordreCheque="",this.chequeGlobal="",this.derniereContrepartie="",this.typeCheque="",this.nombreJourReserveEncaissement="",this.supportLivret="",this.presentationLivret="",this.indicOblig="",this.ancienSoldeLivret=0,this.indicateurBlocageAncienSolde="",this.prochainNumeroLigneAImprimer="",this.ligneBlocage="",this.codeDeviseSoldeLivret="",this.indicateurOD="",this.S_BILLETERIE=new e.comOpesFinancieres.Model.SegmentBilleterie,this.S_PRVRIOUGR=[],this.S_PRVRIOUGR.push(new e.comOpesFinancieres.Model.SegmentPRVRIOUGR),this.S_PRVRIOUGR.push(new e.comOpesFinancieres.Model.SegmentPRVRIOUGR),this.S_PRVRIOUGR.push(new e.comOpesFinancieres.Model.SegmentPRVRIOUGR),this.libelleOperation2="",this.numeroPersonneSignataire=""}return i}();i.SegmentPRVRIO=n}(n=i.Model||(i.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this.numeroCompte="",this.montantVirement=0,this.libelleVirement=""}return e}();e.SegmentPRVRIOUGR=i}(i=e.Model||(e.Model={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function n(e,i,n,t){this.serviceAgentExtended=e,this.$q=i,this.libelleCaisseService=n,this.impressionBordereauService=t}return n.prototype.routerVersSpaContractualisation=function(n,t,r){var o,a,s,c=this,l=this.$q.defer();return this.serviceAgentExtended.getAuthentificationInfo().then(function(p){c.impressionBordereauService.recupererInformationsClientPourBordereau(n.numeroPersonne,t.codeEtablissement).then(function(i){return o=i.designationCourte,a=i.ligne1AdresseAFNOR?i.ligne1AdresseAFNOR+" ":"",a+=i.ligne2AdresseAFNOR?i.ligne2AdresseAFNOR+" ":"",a+=i.ligne3AdresseAFNOR?i.ligne3AdresseAFNOR+" ":"",a+=i.ligne4AdresseAFNOR?i.ligne4AdresseAFNOR+" ":"",a+=i.ligne5AdresseAFNOR?i.ligne5AdresseAFNOR:"",a+="|",a+=i.ligne6AdresseAFNOR?i.ligne6AdresseAFNOR+" ":"",s=e.Constantes.OperationFinanciere.TEXTE_BORD_TIRET_BAS+_.padLeft(r.client.numeroPersonne,9,e.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+t.identifiantBordereau,c.serviceAgentExtended.getFromContext(s)}).then(function(s){var m=null!==s.montantBilletterieDepot&&0!==s.montantBilletterieDepot,u=m&&null!==s.billetterieDepot&&angular.isDefined(s.billetterieDepot),d=u&&null!==s.billetterieDepot.monnaieSansBillet&&0!==s.billetterieDepot.monnaieSansBillet,E=null!==s.montantBilletterieRetrait&&0!==s.montantBilletterieRetrait,h=E&&null!==s.billetterieRetrait&&angular.isDefined(s.billetterieRetrait),f=h&&null!==s.billetterieRetrait.monnaieSansBillet&&0!==s.billetterieRetrait.monnaieSansBillet,v=moment().format(e.Constantes.BordereauOperation.FORMAT_DATE_DD_MM_YYYY),C={identifiantPersonne:+n.numeroPersonne,identifiantAttributaire:String(n.numeroPersonne),intituleAttributaire:o,referenceIdentite:s.referenceIdentite,identificationSignataire:{referenceIdentite:s.referenceIdentite?s.referenceIdentite.substring(0,32):"",identifie:s.referenceIdentite?!0:!1},acte:{codeActeGestion:"BO00003291",codeCanal:"FF",codeModeMiseGestion:"M",libelleActe:"Opération financière",listeOperationFinanciere:[],listeSignatairesActe:[{numeroPersonne:s.participant.identifiantParticipant,adresseMailSign:null,rangSign:null}],listeTitulairesActe:[{numeroPersonne:r&&r.client&&r.client.numeroPersonne?r.client.numeroPersonne:s.participant.identifiantParticipant,adresseMail:null}]},typeBordereau:"OPERATION_FINANCIERE",donneesBordereau:{referenceActe:"",titreDocument:e.Constantes.BordereauOperation.TITRE_DOCUMENT,titreRolePersonne:s.participant.libelleRole,civilite:"",nomPrenomClient:s.participant.nomPrenomParticipant,prefixeNomUsage:"",nomUsage:"",prefixeDateNaissance:"",dateNaissance:"",lieuNaissance:"",adresse:a,telephone:"",situationFamille:"",regimeMatrimonial:"",nationalite:"",identifiantPersonne:"",listeOperation:[],montantEspecesDepot:m?i.GenerationBordereauUtils.formatageMontantPourBordereau(s.montantBilletterieDepot):"",montantMonnaieDepot:d?i.GenerationBordereauUtils.formatageMontantPourBordereau(s.billetterieDepot.monnaieSansBillet):"",detailsBilleterieDepot:u&&s.billetterieDepot.nombreCoupure?{nbBillets5:s.billetterieDepot.nombreCoupure.b5>0?String(s.billetterieDepot.nombreCoupure.b5):"",nbBillets10:s.billetterieDepot.nombreCoupure.b10>0?String(s.billetterieDepot.nombreCoupure.b10):"",nbBillets20:s.billetterieDepot.nombreCoupure.b20>0?String(s.billetterieDepot.nombreCoupure.b20):"",nbBillets50:s.billetterieDepot.nombreCoupure.b50>0?String(s.billetterieDepot.nombreCoupure.b50):"",nbBillets100:s.billetterieDepot.nombreCoupure.b100>0?String(s.billetterieDepot.nombreCoupure.b100):"",nbBillets200:s.billetterieDepot.nombreCoupure.b200>0?String(s.billetterieDepot.nombreCoupure.b200):"",nbBillets500:s.billetterieDepot.nombreCoupure.b500>0?String(s.billetterieDepot.nombreCoupure.b500):""}:null,montantEspecesRetrait:E?i.GenerationBordereauUtils.formatageMontantPourBordereau(-1*s.montantBilletterieRetrait):"",montantMonnaieRetrait:f?i.GenerationBordereauUtils.formatageMontantPourBordereau(-1*s.billetterieRetrait.monnaieSansBillet):"",detailsBilleterieRetrait:h&&s.billetterieRetrait.nombreCoupure?{nbBillets5:s.billetterieRetrait.nombreCoupure.b5>0?String(s.billetterieRetrait.nombreCoupure.b5):"",nbBillets10:s.billetterieRetrait.nombreCoupure.b10>0?String(s.billetterieRetrait.nombreCoupure.b10):"",nbBillets20:s.billetterieRetrait.nombreCoupure.b20>0?String(s.billetterieRetrait.nombreCoupure.b20):"",nbBillets50:s.billetterieRetrait.nombreCoupure.b50>0?String(s.billetterieRetrait.nombreCoupure.b50):"",nbBillets100:s.billetterieRetrait.nombreCoupure.b100>0?String(s.billetterieRetrait.nombreCoupure.b100):"",nbBillets200:s.billetterieRetrait.nombreCoupure.b200>0?String(s.billetterieRetrait.nombreCoupure.b200):"",nbBillets500:s.billetterieRetrait.nombreCoupure.b500>0?String(s.billetterieRetrait.nombreCoupure.b500):""}:null,libelleAgentSignataire:p.agentConnecte.designationLongueAgent,libelleEtablissementSignataire:c.libelleCaisseService.getLibelleCaisse(p.codeEtablissement),poste:t.identifiantBordereau,bureauGuichet:t.edsExterneGuichetComptable,numeroAgent:t.referenceExterneAgent,affichageAvis:!1}};_.forEach(s.lignesBordereauOperation,function(t){var r=t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&Boolean(t.rice),o=t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&(_.startsWith(t.intituleOperation,e.Constantes.BordereauOperation.LIBELLE_DEBUT_RET_VIREMENT_INTERNE)||_.startsWith(t.intituleOperation,e.Constantes.BordereauOperation.LIBELLE_DEBUT_ANN_RET_VIREMENT_INTERNE)),a=t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&_.startsWith(t.intituleOperation,e.Constantes.BordereauOperation.LIBELLE_RET_VIREMENT_INTERNE)&&!t.compteVirementInterneSelectionne,c=t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE,l=null!==t.nouveauSolde&&s.participant.codeRole!==e.Constantes.BordereauOperation.CODE_ROLE_SIGNATAIRE_AUTRES,p=null;if(t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&t.plusieursCheques&&t.plusieursCheques.length>1){p=[];for(var m=0,u=t.plusieursCheques;m<u.length;m++){var d=u[m];p.push(d)}}var E=t.dateDeValeur&&t.dateDeValeur!==v?t.dateDeValeur.substr(0,2)+"/"+t.dateDeValeur.substr(3,2)+"/"+t.dateDeValeur.substr(6,4):"",h="";t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES&&(t.operationDiverse&&t.operationDiverse.typeOperationDiverse&&t.operationDiverse.typeOperationDiverse.COJXHD&&(h=e.Constantes.BordereauOperation.TEXTE_OD+h+t.operationDiverse.typeOperationDiverse.COJXHD+"/ "),t.operationDiverse&&t.operationDiverse.familleOperationDiverse&&t.operationDiverse.familleOperationDiverse.ULIWFO&&(h+=t.operationDiverse.familleOperationDiverse.ULIWFO+" "),t.operationDiverse&&t.operationDiverse.typeOperationDiverse&&t.operationDiverse.typeOperationDiverse.ULIWOD&&(h+=t.operationDiverse.typeOperationDiverse.ULIWOD+" ")),C.donneesBordereau.affichageAvis||t.modeFinancier!==e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&(t.modeFinancier!==e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES||t.fonctionnalite.toString()===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT||t.fonctionnalite.toString()===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_OAD||t.fonctionnalite.toString()===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_COMPTE_88||t.fonctionnalite.toString()===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_DEVISE||t.fonctionnalite.toString()===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE||t.fonctionnalite.toString()===e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE_COMPTE_88)||(C.donneesBordereau.affichageAvis=!0);var f={intituleOperation:t.intituleOperation,dateOperation:E,libelleComplementaire:h,sensImputationCompte:o?t.sensOperation:"",montant:i.GenerationBordereauUtils.formatageMontantPourBordereau(t.montantOperation),numChequeBanque:c?t.chequeDeBanque.numero:"",listeMontantCheques:p,libelleCompte:t.libelleProduit,numeroCompte:r?i.GenerationBordereauUtils.formatageRicePourBordereau(t.rice):i.GenerationBordereauUtils.formatageRicePourBordereau(t.riceCompte),codeDevise:t.devise,soldeCompte:l&&!a?i.GenerationBordereauUtils.formatageMontantPourBordereau(t.nouveauSolde):"",beneficiaireChequeBanque:c?t.chequeDeBanque.beneficiaire:""};C.donneesBordereau.listeOperation.push(f);var O={numeroPersonne:n.numeroPersonne,montantOperation:Math.abs(t.montantOperation),codeDevise:t.devise,libelleClientOperation:t.intituleOperation,libelleCompteOperation:t.libelleProduit,dateOperation:E?moment(E,"DD-MM-YYYY").toDate():null,natureOperation:""};C.acte.listeOperationFinanciere.push(O)}),c.serviceAgentExtended.addToContext(e.Constantes.OperationFinanciere.NOM_DONNEES_SAG_OPC,C).then(function(){return c.serviceAgentExtended.Lisa.Next(e.Constantes.OperationFinanciere.CODE_SORTIE_SAG_OPC)})["catch"](function(e){c.serviceAgentExtended.Trace.warning("Génération KO","routerVersSpaContractualisation",e),l.reject(e)})}).then(function(){l.resolve()})["catch"](function(e){c.serviceAgentExtended.Trace.warning("Génération KO","routerVersSpaContractualisation",e),l.reject(e)})})["catch"](function(e){c.serviceAgentExtended.Trace.warning("Génération KO","routerVersSpaContractualisation",e),l.reject(e)}),l.promise},n.prototype.ressourceAdresse=function(e,i){var n=this,t={codeEtablissement:i,idPersonne:e};return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/tiers/v3/adresse",withHeaders:!0,params:t}).then(function(e){return e})["catch"](function(e){return n.serviceAgentExtended.Trace.error("Ressource de récupération du /tiers/v3/adresse en erreur","ressourceAdresse",e),null})},n.$inject=["serviceAgentExtended","$q","libelleCaisseService","impressionBordereauService"],n}();i.ContractualisationOperationService=n,e.module.service("contractualisationOperationService",n)}(i=e.ImpressionBordereau||(e.ImpressionBordereau={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){}return e.formatageRicePourBordereau=function(e){var i="",n=e.substring(0,5),t=e.substring(5,10),r=e.substring(10,12),o=e.substring(12,19),a=e.substring(19,21),s=e.substring(21,23);return i=n+" "+t+" "+r+"."+o+"."+a+" "+s},e.formatageMontantPourBordereau=function(e){for(var i="",n=e.toString(),t=n.split("."),r=0,o=t[0].length-1;o>=0;o--)i=0!==r&&r%3===0?t[0][o]+" "+i:t[0][o]+i,r++;return i+=angular.isDefined(t[1])?","+t[1]:",00",angular.isDefined(t[1])&&1===t[1].length&&(i+="0"),i},e}();e.GenerationBordereauUtils=i}(i=e.ImpressionBordereau||(e.ImpressionBordereau={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function n(){}return n.prototype.createDocument=function(e,i,n,t){var r=this.initialisationBordereau(),o=new Array,a=this.constructionBlocTitre(),s=this.constructionBlocAvis(e.lignesBordereauOperation),c=this.constructionBlocInfosGenerales(i,n),l=this.constructionBlocLignes(),p=this.constructionBlocLignes2();l=this.constructionBlocOperationLigne2(l,e.lignesBordereauOperation,e.participant.codeRole);var m=this.constructionBlocEntete(t,n),u={},d=this.constructionBlocSignature(e.participant,e.referenceIdentite),E=null,h=null,f=null,v=null;null!=e.billetterieDepot&&null!==e.montantBilletterieDepot&&0!==e.montantBilletterieDepot?E=this.constructionBlocSyntheseBilletterieDepot(e.lignesBordereauOperation,e.montantBilletterieDepot,e.billetterieDepot):e.billetterieDepot||null===e.montantBilletterieDepot||0===e.montantBilletterieDepot||(E=this.constructionBlocSyntheseBilletterieDepotSansMonnaieEtBilletterie(e.lignesBordereauOperation,e.montantBilletterieDepot)),null!=e.billetterieRetrait&&null!==e.montantBilletterieRetrait&&0!==e.montantBilletterieRetrait?h=this.constructionBlocSyntheseBilletterieRetrait(e.lignesBordereauOperation,e.montantBilletterieRetrait,e.billetterieRetrait):e.billetterieRetrait||null===e.montantBilletterieRetrait||0===e.montantBilletterieRetrait||(h=this.constructionBlocSyntheseBilletterieRetraitSansMonnaieEtBilletterie(e.lignesBordereauOperation,e.montantBilletterieRetrait)),null!=e.billetterieDepot&&(f=this.constructionBlocTableauBilletterieDepot(e.lignesBordereauOperation,e.billetterieDepot)),null!=e.billetterieRetrait&&(v=this.constructionBlocTableauBilletterieRetrait(e.lignesBordereauOperation,e.billetterieRetrait)),o.push(a),o.push(c),o.push(l),o.push(p),null!==E&&o.push(E),null!==f&&o.push(f),null!==h&&o.push(h),null!==v&&o.push(v),null!==s&&o.push(s),o.push(d);var C={};return C._blocChoice_=o,r.SECTION1.push(C),r.GENERIC_ENTETEETS=m,r.GENERIC_PIEDPAGEETS=u,r},n.prototype.initialisationBordereau=function(){var e=new i.siprgce_bordereau_BORD001,n=new Array;return e.SECTION1=n,e},n.prototype.constructionBlocTitre=function(){var i={},n={};return n.TITRE=e.Constantes.BordereauOperation.TITRE_DOCUMENT,i.BL_1=n,i},n.prototype.constructionBlocEntete=function(i,n){var t={},r=new Array,o={};return o._attribute_Content=MyWay.Services.Impression.TYPE_IMAGE.Id,o._value_=i.codeEtablissement+".jpg",t.LOGO_ETABLISSEMENT=o,t.LIBELLE_AGENCE=n.libelleEdsRattachementGuichetComptable,t.COCEEL_AGENCE=n.edsExterneGuichetComptable,t.NODATP_AGENCE=n.numTelEdsRattachementguichetComptable,t.DATE_EDITION=moment().format(e.Constantes.BordereauOperation.FORMAT_DATE_DD_MM_YYYY),t.HEURE_EDITION="   "+moment().format(e.Constantes.BordereauOperation.FORMAT_HEURE_HH_MM_SS),n.numeroOffre&&(t.REF_ACTE=e.Constantes.BordereauOperation.TEXTE_OFFRE_NUMERO+n.numeroOffre),r.push(t),r},n.prototype.constructionBlocPiedPage=function(){var e=new Array;return e},n.prototype.constructionBlocAvis=function(i){for(var n=null,t=0;t<i.length;++t)if(i[t].modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU||i[t].modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES&&i[t].fonctionnalite.toString()!==e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT&&i[t].fonctionnalite.toString()!==e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_OAD&&i[t].fonctionnalite.toString()!==e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_COMPTE_88&&i[t].fonctionnalite.toString()!==e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_DEVISE&&i[t].fonctionnalite.toString()!==e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE&&i[t].fonctionnalite.toString()!==e.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_HORS_CLIENTELE_COMPTE_88){
n={},n.BL_Avis=1;break}return n},n.prototype.constructionBlocInfosGenerales=function(e,i){var n={},t={};return e?(t.D3=e.designationCourte,t.D4=e.ligne2AdresseAFNOR,t.D5=e.ligne3AdresseAFNOR,t.D6=e.ligne4AdresseAFNOR,t.D7=e.ligne5AdresseAFNOR,t.D8=e.ligne6AdresseAFNOR):(t.D3="",t.D4="",t.D5="",t.D6="",t.D7="",t.D8=""),t.D9=i.identifiantBordereau,t.D10=i.edsExterneGuichetComptable,t.D12=i.referenceExterneAgent,n.BL_Infosgene=t,n},n.prototype.constructionBlocLignes=function(){var e={},i={};i._blocChoice_=new Array;var n={};n.LIGNE1=1,i._blocChoice_.push(n);var t={};return t.Tableau_Lignes=i,e.BL_Lignes=t,e},n.prototype.constructionBlocLignes2=function(){var e={},i={};return i.LIGNE2=2,e.BL_Lignes2=i,e},n.prototype.constructionBlocOperationLigne2=function(n,t,r){var o=this;return angular.forEach(t,function(t,a){var s={};if(s.D1=t.intituleOperation,""!==t.dateDeValeur){var c=moment().format(e.Constantes.BordereauOperation.FORMAT_DATE_DD_MM_YYYY);if(t.dateDeValeur!==c){var l=t.dateDeValeur.substring(0,2),p=t.dateDeValeur.substring(3,5),m=t.dateDeValeur.substring(6,10);s.D2=l+"/"+p+"/"+m}}t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&(MyWay.Services.StringUtils.startsWith(t.intituleOperation,e.Constantes.BordereauOperation.LIBELLE_DEBUT_RET_VIREMENT_INTERNE)||MyWay.Services.StringUtils.startsWith(t.intituleOperation,e.Constantes.BordereauOperation.LIBELLE_DEBUT_ANN_RET_VIREMENT_INTERNE))?"-"===t.sensOperation&&t.montantOperation<0?s.D3=_.padRight(i.GenerationBordereauUtils.formatageMontantPourBordereau(t.montantOperation)+" "+t.devise,20):s.D3=t.sensOperation+_.padRight(i.GenerationBordereauUtils.formatageMontantPourBordereau(t.montantOperation)+" "+t.devise,20):s.D3=_.padRight(i.GenerationBordereauUtils.formatageMontantPourBordereau(t.montantOperation)+" "+t.devise,20),t&&null!=t.nouveauSolde?r&&r===e.Constantes.BordereauOperation.CODE_ROLE_SIGNATAIRE_AUTRES?s.D4="":s.D4=_.padRight(i.GenerationBordereauUtils.formatageMontantPourBordereau(t.nouveauSolde)+" "+t.devise,22):s.D4="";var u={};u.LIGNE2=s,n.BL_Lignes.Tableau_Lignes._blocChoice_.push(u),n=o.constructionLignes3(n,t),t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&(n=o.constructionLignes6(n,t.chequeDeBanque.beneficiaire)),t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_RECU&&t.plusieursCheques&&t.plusieursCheques.length>1&&(n=o.constructionLignes3PlusieursCheques(n,t.plusieursCheques))}),n},n.prototype.constructionLignes3=function(n,t){var r={};if(r.D6=t.libelleProduit,t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_VIREMENT_INTERNE&&t.rice?r.D7=i.GenerationBordereauUtils.formatageRicePourBordereau(t.rice):r.D7=i.GenerationBordereauUtils.formatageRicePourBordereau(t.riceCompte),t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&(r.D8=e.Constantes.BordereauOperation.TEXTE_NUMERO_CHEQUE+t.chequeDeBanque.numero),t.modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_OPERATIONS_DIVERSES){var o="";t.operationDiverse&&t.operationDiverse.typeOperationDiverse&&t.operationDiverse.typeOperationDiverse.COJXHD&&(o=e.Constantes.BordereauOperation.TEXTE_OD+o+t.operationDiverse.typeOperationDiverse.COJXHD+"/ "),t.operationDiverse&&t.operationDiverse.familleOperationDiverse&&t.operationDiverse.familleOperationDiverse.ULIWFO&&(o=o+t.operationDiverse.familleOperationDiverse.ULIWFO+" "),t.operationDiverse&&t.operationDiverse.typeOperationDiverse&&t.operationDiverse.typeOperationDiverse.ULIWOD&&(o=o+t.operationDiverse.typeOperationDiverse.ULIWOD+" "),r.D9=o}var a={};return a.LIGNE3=r,n.BL_Lignes.Tableau_Lignes._blocChoice_.push(a),n},n.prototype.constructionLignes4=function(e){var i={};return i.LIGNE4=4,e.BL_Lignes.Tableau_Lignes._blocChoice_.push(i),e},n.prototype.constructionLignes5=function(e,i){var n={};n.D21=i.chequeDeBanque.beneficiaire,n.D22="LIGNE 5 D22",n.D23="LIGNE 5 D23",n.D24="LIGNE 5 D24";var t={};return t.LIGNE5=n,e.BL_Lignes.Tableau_Lignes._blocChoice_.push(t),e},n.prototype.constructionLignes5Bis=function(e){var i={};i.D21B="LIGNE 5 D21 BIS",i.D22B="LIGNE 5 D22 BIS",i.D23B="LIGNE 5 D23 BIS",i.D24B="LIGNE 5 D24 BIS";var n={};return n.LIGNE5BIS=i,e.BL_Lignes.Tableau_Lignes._blocChoice_.push(n),e},n.prototype.constructionLignes6=function(e,i){var n={},t=_.padLeft(i,5," ");n.D31=t;var r={};return r.LIGNE6=n,e.BL_Lignes.Tableau_Lignes._blocChoice_.push(r),e},n.prototype.constructionLignes3PlusieursCheques=function(i,n){for(var t={},r=e.Constantes.BordereauOperation.LIBELLE_CHEQUES_DEPOSES,o=0,a=n;o<a.length;o++){var s=a[o];r+=s+"  "}t.D8=r;var c={};return c.LIGNE3=t,i.BL_Lignes.Tableau_Lignes._blocChoice_.push(c),i},n.prototype.constructionBlocSyntheseBilletterieDepotSansMonnaieEtBilletterie=function(n,t){for(var r={},o={},a=0;a<n.length;a++)if(n[a].modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES){if("+"===n[a].sensOperation){o.D1=e.Constantes.BordereauOperation.TEXTE_MONTANT_ESPECES_RECEVOIR;var s=i.GenerationBordereauUtils.formatageMontantPourBordereau(t)+e.Constantes.BordereauOperation.TEXTE_EUR;s=_.padLeft(s,20," "),o.D2=s}r.BL_Suite=o}else r.BL_Suite=null;return r},n.prototype.constructionBlocSyntheseBilletterieDepot=function(n,t,r){for(var o={},a={},s=0;s<n.length;s++)if(n[s].modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES){if("+"===n[s].sensOperation){a.D1=e.Constantes.BordereauOperation.TEXTE_MONTANT_ESPECES_RECEVOIR;var c=i.GenerationBordereauUtils.formatageMontantPourBordereau(t)+e.Constantes.BordereauOperation.TEXTE_EUR;if(c=_.padLeft(c,20," "),a.D2=c,a.D5=e.Constantes.BordereauOperation.TEXTE_BILLETTERIE_EUR_DEPOT,null!=r&&null!=r.monnaieSansBillet&&0!==r.monnaieSansBillet){a.D7=e.Constantes.BordereauOperation.TEXTE_MONNAIE;var l=i.GenerationBordereauUtils.formatageMontantPourBordereau(r.monnaieSansBillet);a.D8=l+e.Constantes.BordereauOperation.TEXTE_EUR}}o.BL_Suite=a}else o.BL_Suite=null;return o},n.prototype.constructionBlocSyntheseBilletterieRetraitSansMonnaieEtBilletterie=function(n,t){for(var r={},o={},a=0;a<n.length;a++)if(n[a].modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES){if("-"===n[a].sensOperation){o.D1=e.Constantes.BordereauOperation.TEXTE_MONTANT_ESPECES_REMETTRE;var s=i.GenerationBordereauUtils.formatageMontantPourBordereau(-1*t)+e.Constantes.BordereauOperation.TEXTE_EUR;s=_.padLeft(s,20," "),o.D2=s}r.BL_Suite=o}else r.BL_Suite=null;return r},n.prototype.constructionBlocSyntheseBilletterieRetrait=function(n,t,r){for(var o={},a={},s=0;s<n.length;s++)if(n[s].modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES){if("-"===n[s].sensOperation){a.D1=e.Constantes.BordereauOperation.TEXTE_MONTANT_ESPECES_REMETTRE;var c=i.GenerationBordereauUtils.formatageMontantPourBordereau(-1*t)+e.Constantes.BordereauOperation.TEXTE_EUR;if(c=_.padLeft(c,20," "),a.D2=c,a.D5=e.Constantes.BordereauOperation.TEXTE_BILLETTERIE_EUR_RETRAIT,null!=r&&null!=r.monnaieSansBillet&&0!==r.monnaieSansBillet){a.D7=e.Constantes.BordereauOperation.TEXTE_MONNAIE;var l=i.GenerationBordereauUtils.formatageMontantPourBordereau(-1*r.monnaieSansBillet);a.D8=l+e.Constantes.BordereauOperation.TEXTE_EUR}}o.BL_Suite=a}else o.BL_Suite=null;return o},n.prototype.constructionBlocTableauBilletterieDepot=function(i,n){for(var t={},r={},o=0;o<i.length;++o)i[o].modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES?("+"===i[o].sensOperation&&n&&n.nombreCoupure&&(r.D5=n.nombreCoupure.b5&&0!==n.nombreCoupure.b5?n.nombreCoupure.b5.toString():"",r.D6=n.nombreCoupure.b10&&0!==n.nombreCoupure.b10?n.nombreCoupure.b10.toString():"",r.D7=n.nombreCoupure.b20&&0!==n.nombreCoupure.b20?n.nombreCoupure.b20.toString():"",r.D8=n.nombreCoupure.b50&&0!==n.nombreCoupure.b50?n.nombreCoupure.b50.toString():"",r.D9=n.nombreCoupure.b100&&0!==n.nombreCoupure.b100?n.nombreCoupure.b100.toString():"",r.D10=n.nombreCoupure.b200&&0!==n.nombreCoupure.b200?n.nombreCoupure.b200.toString():"",r.D11=n.nombreCoupure.b500&&0!==n.nombreCoupure.b500?n.nombreCoupure.b500.toString():""),t.BL_SuiteFin=r):t.BL_SuiteFin=null;return t},n.prototype.constructionBlocTableauBilletterieRetrait=function(i,n){for(var t={},r={},o=0;o<i.length;++o)i[o].modeFinancier===e.Constantes.CodeModeFinancier.MODE_FINANCIER_ESPECES?("-"===i[o].sensOperation&&n&&n.nombreCoupure&&(r.D5=n.nombreCoupure.b5&&0!==n.nombreCoupure.b5?n.nombreCoupure.b5.toString():"",r.D6=n.nombreCoupure.b10&&0!==n.nombreCoupure.b10?n.nombreCoupure.b10.toString():"",r.D7=n.nombreCoupure.b20&&0!==n.nombreCoupure.b20?n.nombreCoupure.b20.toString():"",r.D8=n.nombreCoupure.b50&&0!==n.nombreCoupure.b50?n.nombreCoupure.b50.toString():"",r.D9=n.nombreCoupure.b100&&0!==n.nombreCoupure.b100?n.nombreCoupure.b100.toString():"",r.D10=n.nombreCoupure.b200&&0!==n.nombreCoupure.b200?n.nombreCoupure.b200.toString():"",r.D11=n.nombreCoupure.b500&&0!==n.nombreCoupure.b500?n.nombreCoupure.b500.toString():""),t.BL_SuiteFin=r):t.BL_SuiteFin=null;return t},n.prototype.constructionBlocSignature=function(e,i){var n={},t={};return t.QUALITE_SIGNATAIRE=e.libelleRole,t.LIDANM=e.nomParticipant,t.LIDAPP=e.prenomParticipant,t.LIB_PROCURATION="Référence identité : "+i,n.GENERIC_SIGNATURE_BORD=t,n},n}();i.GenerationBordereau=n}(i=e.ImpressionBordereau||(e.ImpressionBordereau={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e,i,n,t){this.serviceAgentExtended=e,this.journalActiviteBancaireBordereauService=i,this.$q=n,this.serviceTrace=t}return n.prototype.visualiserBordereau=function(n,t){var r=this,o=new MyWay.Model.Client,a=new MyWay.Services.Context.AuthentificationInfo;this.recupererInformationsClientPourBordereau(n.numeroPersonne,t.codeEtablissement).then(function(e){return o=e,r.serviceAgentExtended.getAuthentificationInfo()}).then(function(e){a=e;var o=i.Constantes.OperationFinanciere.TEXTE_BORD_TIRET_BAS+_.padLeft(n.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+t.identifiantBordereau;return r.serviceAgentExtended.getFromContext(o)}).then(function(i){var n=new e.comOpesFinancieres.ImpressionBordereau.GenerationBordereau,s=n.createDocument(i,o,t,a),c=new e.comOpesFinancieres.ImpressionBordereau.siprgce_bordereau_BORD001GenerationParams(MyWay.Services.Impression.GENERATION_ACTION.getFichier);return r.serviceAgentExtended.Impression.generer(s,c)}).then(function(e){r.serviceAgentExtended.Fichier.saveAs(e.Fichier,MyWay.Services.Fichier.TYPE_FICHIER.PDF,i.Constantes.OperationFinanciere.NOM_FICHIER_PDF_BORDEREAU_OPERATION,MyWay.Services.Fichier.TYPE_DONNEES_A_SAUVER.BASE64)})["catch"](function(e){return r.serviceAgentExtended.Trace.warning("Génération KO","visualiserBordereau",e)})},n.prototype.genererImprimerBordereau=function(n,t){var r,o=this,a=new MyWay.Model.Client,s=new MyWay.Services.Context.AuthentificationInfo,c=this.$q.defer();return this.recupererInformationsClientPourBordereau(n.numeroPersonne,t.codeEtablissement).then(function(e){return a=e,o.serviceAgentExtended.getAuthentificationInfo()}).then(function(e){return s=e,r=i.Constantes.OperationFinanciere.TEXTE_BORD_TIRET_BAS+_.padLeft(n.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+t.identifiantBordereau,o.serviceAgentExtended.getFromContext(r)}).then(function(c){var l=new e.comOpesFinancieres.ImpressionBordereau.GenerationBordereau,p=l.createDocument(c,a,t,s),m=new e.comOpesFinancieres.ImpressionBordereau.siprgce_bordereau_BORD001GenerationImpressionParams(MyWay.Services.Impression.GENERATION_IMPRESSION_ACTION.getFichier);return o.serviceAgentExtended.removeFromSharedContext(r),o.serviceAgentExtended.Context.GetCurrentProcessId().then(function(e){var t=i.Constantes.OperationFinanciere.TEXTE_NUMERO_BORDEREAU+_.padLeft(n.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+e;o.serviceAgentExtended.removeFromSharedContext(t)}),o.serviceAgentExtended.Impression.genererImprimer(p,m)}).then(function(e){c.resolve(e)})["catch"](function(e){o.serviceAgentExtended.Trace.warning("Génération KO","genererImprimerBordereau",e),c.reject(e)}),c.promise},n.prototype.genererImprimerBordereauMyWaySansSag=function(n,t,r){var o,a,s=this,c=new MyWay.Model.Client,l=new MyWay.Services.Context.AuthentificationInfo,p=this.$q.defer();return a=r&&r.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_RETRAIT_OAD&&r.compte&&r.compte.rice?r.compte.rice.codeEtablissement:r&&r.fonctionnalite.toString()===i.Constantes.Fonctionnalite.TEXTE_OPERATION_DEPOT_OAD&&r.compte&&r.compte.rice?r.compte.rice.codeEtablissement:t.codeEtablissement,this.recupererInformationsClientPourBordereau(n.numeroPersonne,a).then(function(e){return c=e,c&&""===c.designationCourte&&r&&r.titulaireCompte&&(c.designationCourte=r.titulaireCompte),s.serviceAgentExtended.getAuthentificationInfo()}).then(function(e){return l=e,o=i.Constantes.OperationFinanciere.TEXTE_BORD_TIRET_BAS+_.padLeft(r.client.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+t.identifiantBordereau,s.serviceAgentExtended.getFromContext(o)}).then(function(r){if(r){var a=new e.comOpesFinancieres.ImpressionBordereau.GenerationBordereau,m=a.createDocument(r,c,t,l),u=new e.comOpesFinancieres.ImpressionBordereau.siprgce_bordereau_BORD001GenerationImpressionMyWayParams;s.serviceAgentExtended.removeFromSharedContext(o).then(function(){s.serviceAgentExtended.Context.GetCurrentProcessId().then(function(e){var o=i.Constantes.OperationFinanciere.TEXTE_NUMERO_BORDEREAU+_.padLeft(n.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+e;s.serviceAgentExtended.removeFromSharedContext(o).then(function(){s.journalActiviteBancaireBordereauService.postBordereauOperationDansJournalActiviteBancaire(r,c,t.identifiantBordereau).then(function(){s.serviceAgentExtended.Impression.genererImprimer(m,u).then(function(e){p.resolve(e)})["catch"](function(e){s.serviceAgentExtended.Trace.warning("Génération KO","genererImprimerBordereau",e),p.reject(e)})})})})})}else{var d=new MyWay.Services.Erreur("bordereauKO");d.libelle=i.Constantes.MessageErreur.TEXTE_MESSAGE_ERREUR_GENERATION_BORDEREAU,p.reject(d)}}),p.promise},n.prototype.genererBordereau=function(n,t){var r,o=this,a=new MyWay.Model.Client,s=new MyWay.Services.Context.AuthentificationInfo;return this.recupererInformationsClientPourBordereau(n.numeroPersonne,t.codeEtablissement).then(function(e){return a=e,o.serviceAgentExtended.getAuthentificationInfo()}).then(function(e){return s=e,r=i.Constantes.OperationFinanciere.TEXTE_BORD_TIRET_BAS+_.padLeft(n.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+t.identifiantBordereau,o.serviceAgentExtended.getFromContext(r)}).then(function(c){var l=new e.comOpesFinancieres.ImpressionBordereau.GenerationBordereau,p=l.createDocument(c,a,t,s),m=new e.comOpesFinancieres.ImpressionBordereau.siprgce_bordereau_BORD001GenerationParams(MyWay.Services.Impression.GENERATION_ACTION.getFichier);return o.serviceAgentExtended.removeFromSharedContext(r),o.serviceAgentExtended.Context.GetCurrentProcessId().then(function(e){var t=i.Constantes.OperationFinanciere.TEXTE_NUMERO_BORDEREAU+_.padLeft(n.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+e;o.serviceAgentExtended.removeFromSharedContext(t)}),o.serviceAgentExtended.Impression.generer(p,m)}).then(function(e){return e})["catch"](function(e){return o.serviceAgentExtended.Trace.warning("Génération KO","genererBordereau",e),null})},n.prototype.genererArchiverBordereau=function(n,t,r,o){var a,s,c,l=this,p="",m=new MyWay.Model.Client;return this.recupererInformationsClientPourBordereau(n.numeroPersonne,t.codeEtablissement).then(function(e){return m=e,l.serviceAgentExtended.getAuthentificationInfo()}).then(function(e){return s=e,a=i.Constantes.OperationFinanciere.TEXTE_BORD_TIRET_BAS+_.padLeft(n.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+t.identifiantBordereau,l.serviceAgentExtended.getFromContext(a)}).then(function(p){if(p){c=p;var u=new e.comOpesFinancieres.ImpressionBordereau.GenerationBordereau,d=u.createDocument(p,m,t,s),E=new e.comOpesFinancieres.ImpressionBordereau.siprgce_bordereau_BORD001GenerationParams(MyWay.Services.Impression.GENERATION_ACTION.archiverAndGetFichier,r,o);return l.serviceAgentExtended.removeFromSharedContext(a),l.serviceAgentExtended.Context.GetCurrentProcessId().then(function(e){var t=i.Constantes.OperationFinanciere.TEXTE_NUMERO_BORDEREAU+_.padLeft(n.numeroPersonne,9,i.Constantes.ChiffreString.CHIFFRE_ZERO_STRING)+"_"+e;l.serviceAgentExtended.removeFromSharedContext(t)}),l.serviceAgentExtended.Impression.generer(d,E)}var h=new MyWay.Services.Erreur("bordereauKO");return h.libelle=i.Constantes.MessageErreur.TEXTE_MESSAGE_ERREUR_BORDEREAU_NON_CONTEXTE,l.serviceAgentExtended.Trace.error("Génération KO","genererArchiverBordereau",h),l.$q.reject(null)}).then(function(e){return p=e.IdntPJ,m.numeroPersonne=n&&n.numeroPersonne?n.numeroPersonne:null,l.journalActiviteBancaireBordereauService.postBordereauOperationDansJournalActiviteBancaire(c,m,t.identifiantBordereau,o,r,p)}).then(function(e){return l.serviceTrace.info("genererArchiverBordereau :  Bordereau des operations généré et d'archivé  --> ",e),p})["catch"](function(e){return e&&l.serviceAgentExtended.Trace.error("Génération KO","genererArchiverBordereau",e),p})},n.prototype.ressourceIdentificationParNumeroPersonne=function(e,i){var n=this,t={codeEtablissement:i,idPersonne:e};return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/tiers-v1/identification",withHeaders:!0,params:t}).then(function(e){return e})["catch"](function(e){return n.serviceAgentExtended.Trace.error("Ressource de récupération du tiers-v1/identification en erreur","ressourceIdentificationParNumeroPersonne",e),null})},n.prototype.ressourceInformationPersonneMorale=function(e,i){var n=this,t={codeEtablissement:i,identifiantTiers:e};return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/tiers-v2/corporateInformation",withHeaders:!0,params:t}).then(function(e){return e})["catch"](function(e){return n.serviceAgentExtended.Trace.error("Ressource de récupération du tiers-v2/corporateInformation en erreur","ressourceInformationPersonneMorale",e),null})},n.prototype.ressourceInformationParticulier=function(e,i){var n=this,t={codeEtablissement:i,idPersonne:e};return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/tiers-v1/particulierInformation",withHeaders:!0,params:t}).then(function(e){return e})["catch"](function(e){return n.serviceAgentExtended.Trace.error("Ressource de récupération du /tiers-v1/particulierInformation en erreur","ressourceInformationParticulier",e),null})},n.prototype.ressourceAdresse=function(e,i){var n=this,t={codeEtablissement:i,idPersonne:e};return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/tiers-v1/adresse",withHeaders:!0,params:t}).then(function(e){return e})["catch"](function(e){return n.serviceAgentExtended.Trace.error("Ressource de récupération du /tiers-v1/adresse en erreur","ressourceAdresse",e),null})},n.prototype.recupererInformationsClientPourBordereau=function(e,n){var t=this,r=new MyWay.Model.Client;return r.designationCourte="",this.ressourceIdentificationParNumeroPersonne(e,n).then(function(o){return o?o.codePersonnaliteJuridique===i.Constantes.ChiffreString.CHIFFRE_UN_STRING?t.ressourceInformationParticulier(e,n).then(function(e){return e&&(r.designationCourte=e.designationCourte,r.ligne2AdresseAFNOR=e.ligne2AdresseAFNOR,r.ligne3AdresseAFNOR=e.ligne3AdresseAFNOR,r.ligne4AdresseAFNOR=e.ligne4AdresseAFNOR,r.ligne5AdresseAFNOR=e.ligne5AdresseAFNOR,r.ligne6AdresseAFNOR=e.ligne6AdresseAFNOR),r})["catch"](function(e){return t.serviceAgentExtended.Trace.error("Ressource de récupération du tiers-v1/particulierInformation","ressourceAdresse",e),r}):t.ressourceInformationPersonneMorale(e,n).then(function(o){return o&&(r.designationCourte=o.raisonSociale),t.ressourceAdresse(e,n).then(function(e){return e&&angular.forEach(e,function(e){e.codeTypeAdresse===i.Constantes.ChiffreString.CHIFFRE_UN_STRING&&(r.ligne1AdresseAFNOR=e.ligne1AdresseAFNOR,r.ligne2AdresseAFNOR=e.ligne2AdresseAFNOR,r.ligne3AdresseAFNOR=e.ligne3AdresseAFNOR,r.ligne4AdresseAFNOR=e.ligne4AdresseAFNOR,r.ligne5AdresseAFNOR=e.ligne5AdresseAFNOR,r.ligne6AdresseAFNOR=e.ligne6AdresseAFNOR)}),r})})["catch"](function(e){return t.serviceAgentExtended.Trace.error("Ressource de récupération du tiers-v1/particulierInformation","ressourceAdresse",e),r}):r})["catch"](function(e){return t.serviceAgentExtended.Trace.error("Ressource de récupération du tiers-v1/identification en erreur","ressourceAdresse",e),r})},n.$inject=["serviceAgentExtended","journalActiviteBancaireBordereauService","$q","serviceTrace"],n}();i.ImpressionBordereauService=n,i.module.service("impressionBordereauService",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this._attribute_id="siprgce_bordereau_BORD001.docx",this._attribute_xmlns="http://myWayDocument.xsd"}return e}();e.siprgce_bordereau_BORD001=i;var n=function(){function e(e,i,n){if(this.systeme={typeName:"siprgce_bordereau_BORD001",typeFullName:"Gce.EditiqueVente.Services.Documents.siprgce_bordereau_BORD001.siprgce_bordereau_BORD001",librairie:"Gce.EditiqueVente.Services.Documents_12-COMPTA_BORDOPE_siprgce_bordereau_BORD001"},this.obligatoires={action:e,parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDFA_1B,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"12-compta/bordope_doc"}},null===i||angular.isUndefined(i))this.optionnels={nomFichier:"siprgce_bordereau_BORD001.pdf"};else{var t={idntCmpstApplf:i},r={nomFich:"siprgce_bordereau_BORD001.pdf"},o={proprietesDoc:n,fichierDoc:r},a={donnCntx:t,document:o},s={aQstnCreerDoc:a};this.optionnels={nomFichier:"siprgce_bordereau_BORD001.pdf",archivage:s}}}return e}();e.siprgce_bordereau_BORD001GenerationParams=n;var t=function(){function e(){this.obligatoires={nomFichier:"siprgce_bordereau_BORD001.pdf"},this.optionnels={}}return e}();e.siprgce_bordereau_BORD001ImpressionParams=t;var r=function(){function e(){this.systeme={typeName:"siprgce_bordereau_BORD001",typeFullName:"Gce.EditiqueVente.Services.Documents.siprgce_bordereau_BORD001.siprgce_bordereau_BORD001",librairie:"Gce.EditiqueVente.Services.Documents_12-COMPTA_BORDOPE_siprgce_bordereau_BORD001"},this.obligatoires={action:MyWay.Services.Impression.GENERATION_IMPRESSION_ACTION.getFichier,nomFichier:"siprgce_bordereau_BORD001.pdf",parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDF,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"12-compta/bordope_doc"}},this.optionnels={parametreActiveX:{annul:!1,enregistrer:!1,voir:!1,maxcop:2,mincop:1,nbcopiesdef:2}}}return e}();e.siprgce_bordereau_BORD001GenerationImpressionMyWayParams=r;var o=function(){function e(e,i,n){if(this.systeme={typeName:"siprgce_bordereau_BORD001",typeFullName:"Gce.EditiqueVente.Services.Documents.siprgce_bordereau_BORD001.siprgce_bordereau_BORD001",librairie:"Gce.EditiqueVente.Services.Documents_12-COMPTA_BORDOPE_siprgce_bordereau_BORD001"},this.obligatoires={action:e,nomFichier:"siprgce_bordereau_BORD001.pdf",parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDFA_1B,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"12-compta/bordope_doc"}},null===i||angular.isUndefined(i));else{var t={idntCmpstApplf:i},r={nomFich:"siprgce_bordereau_BORD001.pdf"},o={proprietesDoc:n,fichierDoc:r},a={donnCntx:t,document:o},s={aQstnCreerDoc:a};this.optionnels={archivage:s}}}return e}();e.siprgce_bordereau_BORD001GenerationImpressionParams=o}(i=e.ImpressionBordereau||(e.ImpressionBordereau={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(i){var n=function(){function i(){}return i.couperMontantLettresEnDeuxLignes=function(i,n){var t,r,o="",a="",s=!1,c=[];if(i===e.Constantes.CodeModeFinancier.MODE_FINANCIER_CHEQUE_BANQUE&&(t=44,r=65),n.length<44)o=n,c.push(o),c.push(a);else{for(var l=t-1,p=n.charAt(l);!s;)" "!==p?(l--,p=n.charAt(l)):s=!0;o=n.substr(0,l),c.push(o),a=n.substring(l+1,r+l),c.push(a)}return c},i}();i.GenerationChequeBanqueUtils=n}(i=e.ImpressionChequeDeBanque||(e.ImpressionChequeDeBanque={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n;!function(i){var n=function(){function n(){}return n.prototype.creerChequeDeBanque=function(n,t,r){var o=new i.cheque_de_banque,a=[];a=e.comOpesFinancieres.ImpressionChequeDeBanque.GenerationChequeBanqueUtils.couperMontantLettresEnDeuxLignes("09",r),o.montantligne1=a[0],o.montantligne2=a[1],o.beneficiare=n.beneficiaire;var s=e.comOpesFinancieres.ImpressionBordereau.GenerationBordereauUtils.formatageMontantPourBordereau(n.montantGlobal),c=_.padLeft(s,14,"*");o.montantchiffre=c,o.lieu=t.localiteEdsExterneGuichetComptable;var l=t.dateOperationJourneeComptable.substr(0,2),p=t.dateOperationJourneeComptable.substr(2,2),m=t.dateOperationJourneeComptable.substr(4,4),u=l+"/"+p+"/"+m;return o.date=u,o},n}();i.GenerationChequeDeBanque=n}(n=i.ImpressionChequeDeBanque||(i.ImpressionChequeDeBanque={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(i){var n=function(){function n(e){this.serviceAgentExtended=e}return n.prototype.getNumPlan=function(){return this.serviceAgentExtended.getFromContext("NUMPLAN").then(function(e){return null===e&&(e="1"),console.log("numplan :"+e),e})},n.prototype.genererChequeDeBanque=function(e,n){var t=this;console.log("appel impression chq banque");var r=i.Constantes.OperationFinanciere.CODE_PTU_IMP_CHEQUE_BANQUE;return r+=_.padLeft("",7,"0"),r+=i.Constantes.Devise.TEXTE_CODE_DEVISE_EURO,r+=_.padLeft("",14," "),r+=_.padLeft(String(e.montantGlobal),15,"0"),this.getNumPlan().then(function(o){return r+=o,r+=_.padRight(e.beneficiaire,255," "),r+=_.padRight(n.localiteEdsExterneGuichetComptable,255," "),console.log("Message ImprChequeBanque",+r),t.serviceAgentExtended.TraitementNsdk.Lancer(i.Constantes.OperationFinanciere.CODE_PTU_IMP_CHEQUE_BANQUE,r).then(function(e){return console.log("retourIMPCH"),console.log("-->"+e),null})})},n.prototype.impressionChequeDeBanque=function(i,n){var t=this,r=new e.comOpesFinancieres.ImpressionChequeDeBanque.GenerationChequeDeBanque;this.convertirNombreEnLettres(i.montantGlobal).then(function(e){return e}).then(function(o){var a=r.creerChequeDeBanque(i,n,o.nombreEnLettres),s=new e.comOpesFinancieres.ImpressionChequeDeBanque.cheque_de_banqueImpressionParams;t.serviceAgentExtended.Impression.imprimer(a,s).then(function(e){t.serviceAgentExtended.Trace.info("Impression du chèque de banque OK")})["catch"](function(e){t.serviceAgentExtended.Trace.warning("Impression du chèque de banque KO","impressionChequeBanque",e)})})},n.prototype.convertirNombreEnLettres=function(e){var i=this,t="http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083",r=t+"/"+n.OUTIL_COMMUN;r+="/"+n.VERSION,r+="/"+n.NOM_RESSOURCE_CONVERSION;var o={nombre:e},a={url:r,method:MyWay.Services.MethodEnum.GET,withHeaders:!0,params:o};return this.serviceAgentExtended.sendRequest(a).then(function(e){return e})["catch"](function(e){i.serviceAgentExtended.Trace.warning("Erreur de récuperation du montant en lettres","convertirNombreEnLettres",e);var n="";return n})},n.$inject=["serviceAgentExtended"],n.OUTIL_COMMUN="outilcommun",n.VERSION="v1",n.NOM_RESSOURCE_CONVERSION="conversionNombreTexte",n}();i.ImpressionChequeDeBanqueService=n,i.module.service("impressionChequeDeBanqueService",n)}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={}));var myway;!function(e){var i;!function(e){var i;!function(e){var i=function(){function e(){this._attribute_id="cheque_de_banque.docx",this._attribute_xmlns="http://cheque_de_banque.xsd"}return e}();e.cheque_de_banque=i;var n=function(){function e(){this.systeme={typeName:"cheque_de_banque",typeFullName:"cb.cheque_de_banque.cheque_de_banque",librairie:"cheque_de_banque"},this.obligatoires={action:MyWay.Services.Impression.GENERATION_ACTION.getFichier,parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDF,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"05-DEPOTS-SRV/CHQ-BANK_doc"}},this.optionnels={nomFichier:"cheque_de_banque.pdf"}}return e}();e.cheque_de_banqueGenerationParams=n;var t=function(){function e(){this.obligatoires={nomFichier:"cheque_de_banque.pdf"},this.optionnels={}}return e}();e.cheque_de_banqueImpressionParams=t;var r=function(){function e(){this.systeme={typeName:"cheque_de_banque",typeFullName:"cb.cheque_de_banque.cheque_de_banque",librairie:"cheque_de_banque"},this.obligatoires={action:MyWay.Services.Impression.GENERATION_IMPRESSION_ACTION.getFichier,nomFichier:"cheque_de_banque.pdf",parametresGenerationFichier:{typeFichier:MyWay.Services.Fichier.TYPE_FICHIER.PDF,restitutionVersion:MyWay.Services.Impression.RESTITUTION_VERSION.V180,sousRepModele:"05-DEPOTS-SRV/CHQ-BANK_doc"}},this.optionnels={}}return e}();e.cheque_de_banqueGenerationImpressionParams=r}(i=e.ImpressionChequeDeBanque||(e.ImpressionChequeDeBanque={}))}(i=e.comOpesFinancieres||(e.comOpesFinancieres={}))}(myway||(myway={})),angular.module("myway.comOpesFinancieres").run(["$templateCache",function(e){e.put("typescript/accreditif/accreditif-view.html",'<label class="col-md-2 control-label" for="accreditif">Accréditif</label>\r\n<div class="col-md-3">\r\n    <div class="mw-input-check case-accreditif">\r\n        <label id="label-accreditif" for="accreditif" class="col-md-12">\r\n            <input id="accreditif" type="checkbox" ng-model="ctrl.accreditifCoche" ng-attr-aria-checked="ctrl.accreditifCoche" aria-labelledby="accreditif">\r\n            <span aria-hidden="true" class="icon" ng-class="{\'itce-fa-check\':ctrl.accreditifCoche}"></span>\r\n        </label>\r\n    </div>\r\n    <mw-infobulle-aide id-champ="OperationADistance.indicateurAccreditif" id="id-infobulle-accreditif-opefi">\r\n    </mw-infobulle-aide>\r\n</div>'),e.put("typescript/billetterie/billetterie-view.html",'<div data-ng-show="viewModelBilletterieCtrl.afficherLaBilletterie(viewModelBilletterieCtrl.afficherBilletterie)">\r\n    <form class="form-horizontal mwsf-billetterie">\r\n        <mw-hretractable id="billetterie-opefi" open="viewModelBilletterieCtrl.estOuvertParDefaut">\r\n            <mw-hretractable-titre id="id-panneau-retractable-titre-billetterie-opefi">\r\n                <!-- DEBUT CORRECTION PROBLEME CHARTRE V2 : ajout classe my-container -->\r\n                <div class="from-group col-md-12">\r\n                    <div class="my-container billetterie col-lg-3 col-md-3 col-sm-3 col-xs-3">\r\n                        <span>Billetterie</span>\r\n                    </div>\r\n                    <div class="my-container montant col-lg-3 col-md-3 col-sm-3 col-xs-3" ng-show="!viewModelBilletterieCtrl.estOuvertParDefaut">\r\n                        <span data-ng-bind="viewModelBilletterieCtrl.libelleMontantDeposeOuRetire"></span>\r\n                        <span class="titre-colonne-billetterie" data-ng-bind="viewModelBilletterieCtrl.montant | number:2"></span>\r\n                    </div>\r\n                    <div class="my-container montant col-lg-3 col-md-3 col-sm-3 col-xs-3" ng-show="!viewModelBilletterieCtrl.estOuvertParDefaut">\r\n                        <span>Montant réparti :</span>\r\n                        <span class="titre-colonne-billetterie" data-ng-bind="viewModelBilletterieCtrl.montantBilletterie | number:2"></span>\r\n                    </div>\r\n                    <div class="my-container difference col-lg-3 col-md-3 col-sm-3 col-xs-3" ng-show="!viewModelBilletterieCtrl.estOuvertParDefaut">\r\n                        <span>Différence : </span>\r\n                        <span class="titre-colonne-billetterie" ng-class="{\'difference-texte-rouge-billetterie\' : viewModelBilletterieCtrl.isDifference}" data-ng-bind="viewModelBilletterieCtrl.differenceMontant | number:2"></span>\r\n                    </div>\r\n                </div>\r\n                <!-- FIN CORRECTION PROBLEME CHARTRE V2 -->\r\n            </mw-hretractable-titre>\r\n            <div class="form-group col-md-12" ng-show="viewModelBilletterieCtrl.estOuvertParDefaut">\r\n                <div class="col-md-3">\r\n                    <span data-ng-bind="viewModelBilletterieCtrl.libelleMontantDeposeOuRetire"></span>\r\n                    <span class="titre-colonne-billetterie" data-ng-bind="viewModelBilletterieCtrl.montant | number:2"></span>\r\n                </div>\r\n                <div class="col-md-3">\r\n                    <span>Montant réparti :</span>\r\n                    <span class="titre-colonne-billetterie" data-ng-bind="viewModelBilletterieCtrl.montantBilletterie | number:2"></span>\r\n                </div>\r\n                <div class="col-md-3">\r\n                    <span class="">Différence : </span>\r\n                    <span class="titre-colonne-billetterie" ng-class="{\'difference-texte-rouge-billetterie\' : viewModelBilletterieCtrl.isDifference}" data-ng-bind="viewModelBilletterieCtrl.differenceMontant | number:2">\r\n\r\n                    </span>\r\n                </div>\r\n                <div class="col-md-3" data-ng-show="viewModelBilletterieCtrl.afficherBoutonEffacerBilletterie">\r\n                    <button type="submit" class="btn btn-success" id="bouton-effacer-billetterie-opefi" data-ng-click="viewModelBilletterieCtrl.effacerBilletterie()">\r\n                        <span>Ré-initialiser</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <div class="form-group col-md-12" ng-show="viewModelBilletterieCtrl.estOuvertParDefaut">\r\n                <hr>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4 alignement-droite-billetterie-opefi">\r\n                    <span class="titre-colonne-billetterie">Nombre</span>\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3 alignement-droite-billetterie-opefi">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5">\r\n                        <span class="titre-colonne-billetterie">Coupure</span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4 alignement-droite-billetterie-opefi">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5">\r\n                        <span class="titre-colonne-billetterie">Valeur</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <input id="billet500" name="billet500" class="form-control" type="number" min="0" step="1" pattern="[0-9]*" mw-montant="0" max="viewModelBilletterieCtrl.maxValeurBilletMonnaie" data-ng-model="viewModelBilletterieCtrl.coupure.b500" autocomplete="off" ng-focus="viewModelBilletterieCtrl.verifierFocusBillet(500, viewModelBilletterieCtrl.coupure.b500)" ng-blur="viewModelBilletterieCtrl.sortirFocusBillet(500, viewModelBilletterieCtrl.coupure.b500)">\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <span>500</span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <label data-ng-bind="viewModelBilletterieCtrl.valeurBillet500" for="billet500"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <input id="billet200" name="billet200" class="form-control" type="number" min="0" step="1" pattern="[0-9]*" mw-montant="0" max="viewModelBilletterieCtrl.maxValeurBilletMonnaie" data-ng-model="viewModelBilletterieCtrl.coupure.b200" autocomplete="off" ng-focus="viewModelBilletterieCtrl.verifierFocusBillet(200, viewModelBilletterieCtrl.coupure.b200)" ng-blur="viewModelBilletterieCtrl.sortirFocusBillet(200, viewModelBilletterieCtrl.coupure.b200)">\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <span>200</span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <label data-ng-bind="viewModelBilletterieCtrl.valeurBillet200" for="billet200"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <input id="billet100" name="billet100" class="form-control" type="number" min="0" step="1" pattern="[0-9]*" mw-montant="0" max="viewModelBilletterieCtrl.maxValeurBilletMonnaie" data-ng-model="viewModelBilletterieCtrl.coupure.b100" autocomplete="off" ng-focus="viewModelBilletterieCtrl.verifierFocusBillet(100, viewModelBilletterieCtrl.coupure.b100)" ng-blur="viewModelBilletterieCtrl.sortirFocusBillet(100, viewModelBilletterieCtrl.coupure.b100)">\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3 alignement-droite-billetterie-opefi">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5">\r\n                        <span>100</span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <label data-ng-bind="viewModelBilletterieCtrl.valeurBillet100" for="billet100"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <input id="billet50" name="billet50" class="form-control" type="number" min="0" step="1" pattern="[0-9]*" mw-montant="0" max="viewModelBilletterieCtrl.maxValeurBilletMonnaie" data-ng-model="viewModelBilletterieCtrl.coupure.b50" autocomplete="off" ng-focus="viewModelBilletterieCtrl.verifierFocusBillet(50, viewModelBilletterieCtrl.coupure.b50)" ng-blur="viewModelBilletterieCtrl.sortirFocusBillet(50, viewModelBilletterieCtrl.coupure.b50)">\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <span>50</span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <label data-ng-bind="viewModelBilletterieCtrl.valeurBillet50" for="billet50"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <input id="billet20" name="billet20" class="form-control" type="number" min="0" step="1" pattern="[0-9]*" mw-montant="0" max="viewModelBilletterieCtrl.maxValeurBilletMonnaie" data-ng-model="viewModelBilletterieCtrl.coupure.b20" autocomplete="off" ng-focus="viewModelBilletterieCtrl.verifierFocusBillet(20, viewModelBilletterieCtrl.coupure.b20)" ng-blur="viewModelBilletterieCtrl.sortirFocusBillet(20, viewModelBilletterieCtrl.coupure.b20)">\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <span>20</span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <label data-ng-bind="viewModelBilletterieCtrl.valeurBillet20" for="billet20"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <input id="billet10" name="billet10" class="form-control" type="number" min="0" step="1" pattern="[0-9]*" mw-montant="0" max="viewModelBilletterieCtrl.maxValeurBilletMonnaie" data-ng-model="viewModelBilletterieCtrl.coupure.b10" autocomplete="off" ng-focus="viewModelBilletterieCtrl.verifierFocusBillet(10, viewModelBilletterieCtrl.coupure.b10)" ng-blur="viewModelBilletterieCtrl.sortirFocusBillet(10, viewModelBilletterieCtrl.coupure.b10)">\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <span>10</span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <label data-ng-bind="viewModelBilletterieCtrl.valeurBillet10" for="billet10"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <input id="billet5" name="billet5" class="form-control" type="number" min="0" step="1" pattern="[0-9]*" mw-montant="0" max="viewModelBilletterieCtrl.maxValeurBilletMonnaie" data-ng-model="viewModelBilletterieCtrl.coupure.b5" autocomplete="off" ng-focus="viewModelBilletterieCtrl.verifierFocusBillet(5, viewModelBilletterieCtrl.coupure.b5)" ng-blur="viewModelBilletterieCtrl.sortirFocusBillet(5, viewModelBilletterieCtrl.coupure.b5)">\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <span>5</span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <label data-ng-bind="viewModelBilletterieCtrl.valeurBillet5" for="billet5"></label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                </div>\r\n                <div class="col-md-3 col-sm-3 col-lg-3">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5 alignement-droite-billetterie-opefi">\r\n                        <label for="montant-monnaie">Monnaie</label>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-4 col-sm-4 col-lg-4">\r\n                    <div class="col-md-offset-5 col-sm-offset-5 col-lg-offset-5">\r\n                        <input id="montant-monnaie" name="montantMonnaie" class="form-control alignement-droite-billetterie-opefi" type="text" mwsf-montant force-positive="viewModelBilletterieCtrl.forcePositiveMontant" data-ng-model="viewModelBilletterieCtrl.montantMonnaie" autocomplete="off" ng-focus="viewModelBilletterieCtrl.verifierFocusMonnaie(viewModelBilletterieCtrl.montantMonnaie)" ng-blur="viewModelBilletterieCtrl.sortirFocusMonnaie(viewModelBilletterieCtrl.montantMonnaie)" ng-change="viewModelBilletterieCtrl.changerValeurMonnaie(viewModelBilletterieCtrl.montantMonnaie)">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </mw-hretractable>\r\n        <!--<mw-panel niveau="3" titre="Synthèse billetterie" data-ng-show="viewModelBilletterieCtrl.afficherSyntheseBilletterie">\r\n            <div class="form-group">\r\n                <div class="col-md-2 col-lg-1 col-sm-4"></div>\r\n                <div class="col-md-4 col-lg-4 col-sm-6"><span>Montant billetterie</span></div>\r\n                <div class="col-md-2 col-lg-1 col-sm-4"><span data-ng-bind="viewModelBilletterieCtrl.montantBilletterie"></span></div>\r\n            </div>\r\n\r\n            <div class="form-group">\r\n                <div class="col-md-2 col-lg-1 col-sm-4"></div>\r\n                <div class="col-md-4 col-lg-4 col-sm-6"><span>Différence</span></div>\r\n                <div class="col-md-2 col-lg-1 col-sm-4">\r\n                    <span data-ng-class="{\'negatif\': viewModelBilletterieCtrl.isNegatifDifference}" data-ng-bind="viewModelBilletterieCtrl.differenceMontant"></span>\r\n                </div>\r\n            </div>\r\n        </mw-panel>-->\r\n    </form>\r\n</div>\r\n'),
e.put("typescript/cheque-banque/cheque-banque-view.html",'<form class="form-horizontal mwsf-cheque-banque" data-ng-class="{\'mw-form-static\' : viewModelChequeBanqueCtrl.verrouillerChampNumeroCheque}">\r\n    <div class="form-group">\r\n        <div class="col-md-2 col-sm-2 col-lg-2">\r\n            <label class="control-label" for="numero-cheque-banque-opefi">N° du chèque</label>\r\n        </div>\r\n        <div class="col-md-4 col-sm-4 col-lg-4">\r\n            <input id="numero-cheque-banque-opefi" name="numero-cheque" class="form-control" type="text" placeholder="N° du chèque" ng-model="viewModelChequeBanqueCtrl.numeroCheque" data-ng-blur="viewModelChequeBanqueCtrl.affinerNumeroCheque(viewModelChequeBanqueCtrl.numeroCheque)" mw-statictext="viewModelChequeBanqueCtrl.verrouillerChampNumeroCheque" data-ng-class="{\'texte-gras\' : viewModelChequeBanqueCtrl.verrouillerChampNumeroCheque}" maxlength="7" mw-reset-field>\r\n        </div>\r\n        <div class="col-md-6 col-sm-5 col-lg-5" data-ng-show="viewModelChequeBanqueCtrl.isChequeEnCours">\r\n            <mw-button modele="secondaire" texte="Ne pas reprendre le chèque" id="bouton-cheque-banque-ne-pas-reprendre-cheque" data-ng-click="viewModelChequeBanqueCtrl.ouverturePopupConfirmationCheque()"></mw-button>\r\n        </div>\r\n    </div>\r\n    <div class="form-group" data-ng-show="!viewModelChequeBanqueCtrl.isChequeEnCours">\r\n        <div class="col-md-2 col-sm-2 col-lg-2"></div>\r\n        <div class="col-md-5 col-sm-6 col-lg-5">\r\n            <button class="btn itce-radio-btn col-md-12 col-lg-12 col-sm-12" type="button" id="id-cheque-unique" name="chequeUnique" data-ng-model="viewModelChequeBanqueCtrl.choixCheque" data-ng-click="viewModelChequeBanqueCtrl.clicChoixCheque(viewModelChequeBanqueCtrl.choixCheque)" btn-radio="\'chequeUnique\'">\r\n                Chèque retrait unique\r\n            </button>\r\n        </div>\r\n        <div class="col-md-5 col-sm-5 col-lg-5"></div>\r\n    </div>\r\n    <div class="form-group">\r\n        <div class="col-md-2 col-sm-2 col-lg-2" data-ng-show="!viewModelChequeBanqueCtrl.isChequeEnCours"></div>\r\n        <div data-ng-show="viewModelChequeBanqueCtrl.isChequeEnCours">\r\n            <span class="control-label col-md-2 col-lg-2 col-sm-2">Type de retrait</span>\r\n            <span class="col-md-4 col-lg-4 col-sm-4 texte-montant" id="id-cheque-multi-texte">Chèque multiretrait</span>\r\n        </div>\r\n        <div class="col-md-5 col-sm-6 col-lg-5" data-ng-show="!viewModelChequeBanqueCtrl.isChequeEnCours">\r\n            <button class="btn itce-radio-btn col-md-12 col-lg-12 col-sm-12" type="button" id="id-cheque-multi" name="chequeMulti" data-ng-model="viewModelChequeBanqueCtrl.choixCheque" data-ng-click="viewModelChequeBanqueCtrl.clicChoixCheque(viewModelChequeBanqueCtrl.choixCheque)" btn-radio="\'chequeMulti\'">\r\n                Chèque multiretrait\r\n            </button>\r\n        </div>\r\n        <div class="col-md-5 col-sm-4 col-lg-4">\r\n            <button class="btn itce-checkbox col-md-12 col-lg-12 col-sm-12" type="button" id="dernier-cheque" name="dernierCheque" data-ng-disabled="viewModelChequeBanqueCtrl.desactiverDernierCheque" data-ng-model="viewModelChequeBanqueCtrl.dernierCheque" data-ng-click="viewModelChequeBanqueCtrl.clicDernierCheque(viewModelChequeBanqueCtrl.dernierCheque)" btn-checkbox>\r\n                Dernier retrait (impression chèque)\r\n            </button>\r\n        </div>\r\n    </div>\r\n    <div class="form-group" data-ng-show="viewModelChequeBanqueCtrl.afficherMontantGlobal">\r\n        <div class="col-md-2 col-sm-2 col-lg-2">\r\n            <span class="control-label">Mont. global</span>\r\n        </div>\r\n        <span class="col-md-4 col-sm-4 col-lg-4 texte-montant" id="montant-global" data-ng-bind="viewModelChequeBanqueCtrl.montantDeviseTexteGlobalCheque"></span>\r\n    </div>\r\n    <div class="form-group">\r\n        <div>\r\n            <div class="col-md-2 col-sm-2 col-lg-2">\r\n                <label class="control-label" for="id-beneficiaire-cheque">Bénéficiaire</label>\r\n            </div>\r\n            <div class="col-md-7 col-sm-8 col-lg-4">\r\n                <input id="id-beneficiaire-cheque" name="beneficiaire" class="form-control" type="text" placeholder="Personne bénéficiaire" ng-model="viewModelChequeBanqueCtrl.beneficiaireCheque" ng-blur="viewModelChequeBanqueCtrl.emissionChequeDeBanque()" maxlength="32" mw-reset-field>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="form-group">\r\n        <span class="error-msg col-md-12 col-sm-12 col-lg-12" ng-show="viewModelChequeBanqueCtrl.messageErreurChequeBanque !== \'\'" role="alert" ng-bind="viewModelChequeBanqueCtrl.messageErreurChequeBanque">\r\n        </span>\r\n    </div>\r\n</form>'),e.put("typescript/cheque-banque-operation/cheque-banque-operation-view.html",'<div class="form-horizontal">\r\n    <div class="form-group">\r\n        <label class="control-label col-md-2" for="numero-cheque-banque-operation">Numéro du chèque</label>\r\n        <div class="col-md-5">\r\n            <input id="numero-cheque-banque-operation" name="numero-cheque" class="form-control" type="text" ng-model="ctrl.numeroCheque" required data-ng-blur="ctrl.affinerNumeroCheque(ctrl.numeroCheque)" maxlength="7">\r\n        </div>\r\n    </div>\r\n    <div class="form-group">\r\n        <label class="control-label col-md-2" for="beneficiaire-cheque-banque-operation">Bénéficiaire</label>\r\n        <div class="col-md-5">\r\n            <input id="beneficiaire-cheque-banque-operation" name="beneficiaire-cheque-banque-operation" class="form-control" type="text" required ng-change="ctrl.modificationBeneficaire(ctrl.beneficiaireCheque)" ng-model="ctrl.beneficiaireCheque" maxlength="32">\r\n        </div>\r\n    </div>\r\n</div>'),e.put("typescript/facturation-automatique/facturation-automatique-view.html",'<div data-ng-if="ctrl.afficherComposantMontant" class="mw-form-static">\r\n    <span class="col-md-2 control-label">Facturation automatique</span>\r\n    <div class="col-md-10">\r\n        <span class="form-control-static" data-ng-bind="ctrl.facturationPrestation.montant.montant | number:2" id="montant-facturation-auto-opefi"></span>\r\n        <span class="form-control-static" data-ng-bind="ctrl.facturationPrestation.montant.codeDevise" id="devise-facturation-auto-opefi"></span>\r\n    </div>\r\n</div>'),e.put("typescript/information-client/information-client-view.html",'<mw-table options="viewModelInformationClientController.tableauListeParticipants" id="tableau-participants"></mw-table>'),e.put("typescript/informations-complementaires/informations-complementaires-view.html",'<data-ng-form class="form-horizontal mwsf-informations-complementaires" name="formInformationsComplementaires" role="form" data-ng-class="{\'mw-form-static\' : viewModelInformationsComplementairesCtrl.estDesactive}">\r\n    <!--<mw-hretractable id="panneau-retractable-informations-complementaires-opefi"\r\n                     titre="Libellé Opération / Date de valeur">\r\n        <div class="panel">-->\r\n    <div class="form-group" data-ng-class="{\'has-error\': viewModelInformationsComplementairesCtrl.estLibelleVide}">\r\n        <label class="col-md-2 col-sm-2 col-lg-2 control-label asterisque" for="libelle-operation-financiere">Libellé opération</label>\r\n        <div class="col-md-5" data-ng-class="{\'has-error\': viewModelInformationsComplementairesCtrl.estLibelleVide}">\r\n            <input id="libelle-operation-financiere" data-ng-model="viewModelInformationsComplementairesCtrl.libelleOperation.libelleLong" mw-statictext="viewModelInformationsComplementairesCtrl.estDesactive" data-ng-change="viewModelInformationsComplementairesCtrl.modificationManuelle()" class="form-control" data-ng-required="viewModelInformationsComplementairesCtrl.estLibelleVide" autocomplete="off" maxlength="24" name="libelle-operation-financiere" type="text" placeholder="" ng-disabled="viewModelInformationsComplementairesCtrl.estLibelleOperationDesactive">\r\n        </div>\r\n        <div class="col-md-1 col-sm-2 col-lg-2 libelle-operation" data-ng-show="viewModelInformationsComplementairesCtrl.afficherLibelleCourt">\r\n            <span data-ng-bind="viewModelInformationsComplementairesCtrl.libelleOperation.libelleCourt" id="id-texte-libelle-court-operation-financiere"></span>\r\n        </div>\r\n        <div class="col-md-12 col-lg-12 col-sm-12" data-ng-show="viewModelInformationsComplementairesCtrl.estLibelleVide">\r\n            <div class="col-md-2 col-sm-2 col-lg-2"></div>\r\n            <div class="col-md-7 col-sm-8 col-lg-8 error-msg">\r\n                <span data-ng-bind="viewModelInformationsComplementairesCtrl.messageErreurSaisieLibelle"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="form-group" ng-hide="viewModelInformationsComplementairesCtrl.masquerDateValeur">\r\n        <label class="col-md-2 col-sm-2 col-lg-2 control-label" for="date-valeur-operation-financiere">Date de valeur</label>\r\n        <div class="col-md-5 has-feedback">\r\n            <input type="text" class="form-control" id="date-valeur-operation-financiere" name="date-informations-opefi" ng-required="false" autocomplete="off" ng-model="viewModelInformationsComplementairesCtrl.dateValeur" mw-date-legere is-open="viewModelInformationsComplementairesCtrl.ouvrirCalendrier" uib-datepicker-popup="dd/MM/yyyy" datepicker-options="{ showWeeks: false, startingDay:1}">\r\n            <span class="btn btn-success form-control-feedback" ng-click="viewModelInformationsComplementairesCtrl.ouvrirCalendrier = true">\r\n                <button class="btn btn-icone icodate sm" id="id-calendrier-date-valeur-opef" title="Calendrier" ng-click="angular.noop()">\r\n                    <span class="icon itce-calendar" aria-hidden="true"></span>\r\n                    <span></span>\r\n                </button>\r\n            </span>\r\n        </div>\r\n    </div>\r\n    <div class="form-group">\r\n        <div class="col-md-offset-2 col-md-10">\r\n            <span data-ng-bind="viewModelInformationsComplementairesCtrl.texteAnniversaire"></span>\r\n        </div>\r\n    </div>\r\n    <!--</div>\r\n    </mw-hretractable>-->\r\n</data-ng-form>\r\n'),e.put("typescript/operation-diverse/operation-diverse-view.html",'<div class="mwsf-operation-diverse">\r\n    <mw-hretractable id="panneau-retractrable-operation-diverse-opefi" open="viewModelOperationDiverseCtrl.estOuvertPanneau">\r\n        <mw-hretractable-titre id="id-panneau-retractable-titre-operation-diverse-opefi">\r\n            <span data-ng-class="{\'icon itce-exclamation point-exclamation-orange\': !viewModelOperationDiverseCtrl.estOperationDiverseValide}" aria-hidden="true"></span>\r\n            <span data-ng-bind="viewModelOperationDiverseCtrl.titrePanneauRetractableOperationDiverse"></span>\r\n        </mw-hretractable-titre>\r\n        <div class="col-md-12 col-lg-12 col-sm-12" data-ng-show="viewModelOperationDiverseCtrl.estListeTypesODVide">\r\n            <span class="error-msg" aria-hidden="true">\r\n                Il n\'y a pas d\'OD de disponible pour cette famille\r\n            </span>\r\n        </div>\r\n        <div class="panel panel-sans-titre" mw-chargement="viewModelOperationDiverseCtrl.estEnChargement">\r\n            <mw-navcol id="id-operation-diverse-navigation-colonne" handler="viewModelOperationDiverseCtrl">\r\n                <mw-navcol-list titre="Famille" distinct-field="ULIWFO" datalist="viewModelOperationDiverseCtrl.listeFamilleParSens" id="colonne-famille" template-url="template-colonne-famille" class="mw-navcol-lg" pre-selected-active-item="viewModelOperationDiverseCtrl.listeFamilleParSens[viewModelOperationDiverseCtrl.indexFamilleSelectionneForcage]">\r\n                    <script type="text/ng-template" id="template-colonne-famille">\r\n                        <span data-ng-bind="item.COJOFA + \' - \' + item.ULIWFO"></span>\r\n                    </script>\r\n                </mw-navcol-list>\r\n                <mw-navcol-list titre="Type" distinct-field="ULIWOD" datalist="viewModelOperationDiverseCtrl.listeTypeOperationDiverse" id="colonne-type" template-url="template-colonne-type" data-ng-show="!viewModelOperationDiverseCtrl.estListeTypesODVide" class="mw-navcol-lg" pre-selected-active-item="viewModelOperationDiverseCtrl.typeSelectionneForcage[viewModelOperationDiverseCtrl.indexTypeSelectionneForcage]" last-column="true">\r\n                    <script type="text/ng-template" id="template-colonne-type">\r\n                        <span data-ng-bind="item.COJXHD + \' - \' + item.ULIWOD"></span>\r\n                    </script>\r\n                </mw-navcol-list>\r\n            </mw-navcol>\r\n        </div>\r\n    </mw-hretractable>\r\n</div>\r\n\r\n<div data-ng-show="viewModelOperationDiverseCtrl.isAfficherBlocSaisieLibelle">\r\n    <div class="col-md-12 col-sm-12 col-lg-12 form-group">\r\n        <h2>Saisie Opération Diverse</h2>\r\n    </div>\r\n    <!--<mw-panel niveau="3" titre="Saisie Opération Diverse" data-ng-show="viewModelOperationDiverseCtrl.isAfficherBlocSaisieLibelle">-->\r\n    <div class="form-group">\r\n        <div class="col-md-3 col-sm-4 col-lg-3"><span data-ng-bind="viewModelOperationDiverseCtrl.libelleCodeFamille"></span></div>\r\n        <div class="col-md-7 col-sm-7 col-lg-7"><span data-ng-bind="viewModelOperationDiverseCtrl.libelleFamille"></span></div>\r\n    </div>\r\n    <div class="form-group">\r\n        <div class="col-md-3 col-sm-4 col-lg-3"><span data-ng-bind="viewModelOperationDiverseCtrl.libelleCodeType"></span></div>\r\n        <div class="col-md-7 col-sm-7 col-lg-7"><span data-ng-bind="viewModelOperationDiverseCtrl.libelleType"></span></div>\r\n    </div>\r\n    <div class="form-group">\r\n        <div class="col-md-8 col-sm-11 col-lg-9"><span data-ng-bind="viewModelOperationDiverseCtrl.codeIdentificationRequete"></span></div>\r\n    </div>\r\n    <div class="form-horizontal">\r\n        <div class="form-group">\r\n            <div data-ng-show="viewModelOperationDiverseCtrl.isAfficherLibelleUlip06">\r\n                <label class="col-md-3 col-sm-5 col-lg-3 control-label" for="saisie-libelle-ulip06" data-ng-bind="viewModelOperationDiverseCtrl.texteLibelleUlip06" data-ng-class="{\'asterisque\' : viewModelOperationDiverseCtrl.champRequisUlip06}">\r\n                </label>\r\n                <div class="col-md-7 col-sm-7 col-lg-7">\r\n                    <input id="saisie-libelle-ulip06" class="form-control" data-ng-model="viewModelOperationDiverseCtrl.saisieLibelleUlip06" data-ng-change="viewModelOperationDiverseCtrl.validationOperationDiverse()" data-ng-model-options="{ allowInvalid: true }" autocomplete="off" data-ng-required="viewModelOperationDiverseCtrl.champRequisUlip06" type="text" placeholder="" maxlength="32" mwsf-operation-diverse-regex>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div data-ng-show="viewModelOperationDiverseCtrl.isAfficherLibelleUlip08">\r\n            <label class="col-md-3 col-sm-5 col-lg-3 control-label" for="saisie-libelle-ulip08" data-ng-bind="viewModelOperationDiverseCtrl.texteLibelleUlip08"></label>\r\n            <div class="col-md-7 col-sm-7 col-lg-7">\r\n                <input id="saisie-libelle-ulip08" data-ng-model="viewModelOperationDiverseCtrl.saisieLibelleUlip08" autocomplete="off" data-ng-change="viewModelOperationDiverseCtrl.validationOperationDiverse()" class="form-control" type="text" placeholder="" maxlength="20" mwsf-numbers-only-input>\r\n            </div>\r\n        </div>\r\n        <div class="form-group">\r\n            <label class="col-md-3 col-sm-5 col-lg-3 control-label" for="saisie-libelle-ulip07" data-ng-bind="viewModelOperationDiverseCtrl.texteLibelleUlip07" data-ng-class="{\'asterisque\' : viewModelOperationDiverseCtrl.champRequisUlip07}"></label>\r\n            <div class="col-md-7 col-sm-7 col-lg-7">\r\n                <input id="saisie-libelle-ulip07" class="form-control" type="text" placeholder="" maxlength="30" data-ng-model="viewModelOperationDiverseCtrl.saisieLibelleUlip07" autocomplete="off" data-ng-change="viewModelOperationDiverseCtrl.validationOperationDiverse()" data-ng-model-options="{ allowInvalid: true }" data-ng-required="viewModelOperationDiverseCtrl.champRequisUlip07">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!--</mw-panel>-->\r\n</div>'),e.put("typescript/operation-diverse-liste/operation-diverse-liste-view.html",'<form class="form-horizontal" name="form">\r\n    <div class="form-group">\r\n        <label class="col-md-2 control-label" for="operation-diverse-liste">Opération Diverse</label>\r\n        <div class="col-md-10" mw-chargement="ctrl.estEnChargement">\r\n            <script type="text/ng-template" id="template-liste-operation-diverse">\r\n                <a href="">\r\n                    <span ng-bind-html="match.model.COJXHD | mwComboboxHighlight:query"></span> - <span ng-bind-html="match.model.ULIWOD | mwComboboxHighlight:query"></span>&emsp;<label><span ng-bind-html="match.model | odAfficherTaux"></span></label>\r\n                </a>\r\n            </script>\r\n            <input type="text" id="operation-diverse-liste" ng-model="ctrl.typeOdChoix" class="form-control" name="operation-diverse-liste" mw-combobox="type as type.ULIWOD for type in ctrl.listeTypeOperationDiverse" mw-combobox-min-length="0" mw-combobox-on-select="ctrl.selectionOD()" mw-combobox-with-scroll="true" mw-combobox-template-url="template-liste-operation-diverse" mw-combobox-loading="ctrl.estEnChargement" required>\r\n\r\n        </div>\r\n    </div>\r\n\r\n    <div class="form-horizontal" data-ng-show="ctrl.isSchemaComptableMutliple && ctrl.ancienMontantOpeFi > 0 && ctrl.isAfficherBlocSaisieLibelle ">\r\n        <div class="form-group">\r\n            <span class="col-md-2"></span>\r\n            <div class="col-md-5">\r\n                <label>Montant H.T : {{ctrl.montantHorsTaxe}} € &emsp;&emsp;&emsp; T.V.A : {{ctrl.montantTVA}} € &emsp;&emsp;&emsp; Taux : {{ ctrl.montantTaux }} %</label>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div data-ng-show="ctrl.isAfficherBlocSaisieLibelle">\r\n        <div class="form-group">\r\n            <div data-ng-show="!ctrl.isAfficherLibelleNumerique">\r\n                <label class="col-md-2 control-label" for="saisie-libelle-ulip06" data-ng-bind="ctrl.texteLibelleUlip06" data-ng-class="{\'asterisque\' : ctrl.champRequisUlip06}">\r\n                </label>\r\n                <div class="col-md-5">\r\n                    <input id="saisie-libelle-ulip06" class="form-control" data-ng-model="ctrl.saisieLibelleUlip06" data-ng-change="ctrl.validationOperationDiverse()" data-ng-model-options="{allowInvalid: true}" autocomplete="off" data-ng-required="ctrl.champRequisUlip06" type="text" placeholder="" maxlength="32" mwsf-operation-diverse-regex>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="form-group">\r\n            <div data-ng-show="ctrl.isAfficherLibelleNumerique">\r\n                <label class="col-md-2 control-label" for="saisie-libelle-ulip08" data-ng-bind="ctrl.texteLibelleUlip06" data-ng-class="{\'asterisque\' : ctrl.champRequisUlip06}"></label>\r\n                <div class="col-md-5">\r\n                    <input id="saisie-libelle-ulip08" class="form-control" data-ng-model="ctrl.saisieLibelleUlip06" data-ng-change="ctrl.validationOperationDiverse()" data-ng-model-options="{ allowInvalid: true }" autocomplete="off" data-ng-required="ctrl.champRequisUlip06" type="text" placeholder="" maxlength="20" mwsf-numbers-only-input>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="form-group">\r\n            <label class="col-md-2 control-label" for="saisie-libelle-ulip07" data-ng-bind="ctrl.texteLibelleUlip07" data-ng-class="{\'asterisque\' : ctrl.champRequisUlip07}"></label>\r\n            <div class="col-md-5">\r\n                <input id="saisie-libelle-ulip07" class="form-control" type="text" placeholder="" maxlength="30" data-ng-model="ctrl.saisieLibelleUlip07" autocomplete="off" data-ng-change="ctrl.validationOperationDiverse()" data-ng-model-options="{ allowInvalid: true }" data-ng-required="ctrl.champRequisUlip07">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</form>'),e.put("typescript/operation-financiere-extourne/operation-financiere-extourne-view.html",'<div class="col-md-12 col-sm-12 col-lg-12" mw-chargement="ctrl.chargement">\r\n    <form class="form-horizontal mw-form-static">\r\n        <div class="form-group">\r\n            <span class="titre-operation-financiere" data-ng-bind="ctrl.operationFinanciere.titrePanelPrincipal"></span>\r\n        </div>\r\n\r\n        <div class="form-group" ng-show="ctrl.afficherTitulaireCompte">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label">Titulaire du compte</span>\r\n            <div class="col-md-5 col-sm-8 col-lg-6">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.operationFinanciere.titulaireCompte"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label">Mode financier</span>\r\n            <div class="col-md-5 col-sm-8 col-lg-6">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.operationFinanciere.modeFinancier.CTGXM1"></span> -\r\n                    <span data-ng-bind="ctrl.operationFinanciere.modeFinancier.LIJMMI"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <!--<div class="form-group" data-ng-if="ctrl.afficherAccreditif">\r\n            <mwsf-accreditif accreditif-coche="ctrl.operationFinanciere.accreditifCoche"></mwsf-accreditif>\r\n        </div>-->\r\n\r\n        <div class="form-group" data-ng-if="ctrl.afficherSolde">\r\n            <span class="col-md-2 control-label">Solde actuel</span>\r\n            <div class="col-md-5 ol-sm-6 col-lg-5 form-control-static">\r\n                <mwsf-solde-compte id="solde-compte-opefi-extourne" compte-principal="ctrl.comptePourLeSolde" solde-detail="ctrl.operationFinanciere.detailDuSolde" type-affichage-solde="ctrl.typeAffichageSolde"></mwsf-solde-compte>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label" data-ng-bind="ctrl.libelleMontant">\r\n            </span>\r\n            <div class="col-md-6 col-sm-3 col-lg-4">\r\n                <p class="form-control-static" ng-show="!ctrl.estRepartitionChequeBanque">\r\n                    <span data-ng-bind="ctrl.operationFinanciere.montant | number:2"></span>\r\n                    <span data-ng-bind="ctrl.operationFinanciere.compte.devise.code"></span>\r\n                </p>\r\n                <p class="form-control-static" ng-show="ctrl.estRepartitionChequeBanque">\r\n                    <span data-ng-bind="ctrl.montantGlobalRepartition | number:2"></span>\r\n                    <span data-ng-bind="ctrl.operationFinanciere.compte.devise.code"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-if="ctrl.afficherTableauRepartitionChequeBanque">\r\n            <mw-table options="ctrl.tableauRepartitionChequeBanque" id="tableau-repartition-cheque-banque-extourne-opefi"></mw-table>\r\n        </div>\r\n\r\n        <div class="form-group" data-ng-show="ctrl.afficherBilletterie">\r\n            <div class="col-md-12 col-sm-12 col-lg-12">\r\n                <mwsf-billetterie id="billetterie-opefi-extourne" montant-billetterie="ctrl.montantBilletterie" montant="ctrl.operationFinanciere.montant" afficher-billetterie="ctrl.afficherBilletterie" coupure="ctrl.operationFinanciere.segmentPrvRio.S_BILLETERIE.nombreCoupure">\r\n                </mwsf-billetterie>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" data-ng-show="ctrl.afficherReferenceOAD">\r\n            <span class="control-label col-md-2">Référence</span>\r\n            <div class="col-md-3">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.operationFinanciere.referenceOAD"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" data-ng-show="ctrl.afficherReferenceSac">\r\n            <span class="control-label col-md-2">Numéro du sac</span>\r\n            <div class="col-md-3">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.operationFinanciere.referenceEnveloppe.numeroReferenceEnveloppe"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-show="ctrl.afficherLibelleNonModifiable">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label">Libellé opération</span>\r\n            <div class="col-md-4">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.operationFinanciere.libelleOperation.libelleLong"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n        <div class="form-group" ng-show="!ctrl.afficherLibelleNonModifiable">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label asterisque">Libellé opération</span>\r\n            <div class="col-md-4 col-sm-4 col-lg-4">\r\n                <input id="libelle-operation-financiere-extourne" data-ng-model="ctrl.operationFinanciere.libelleOperation.libelleLong" class="form-control" autocomplete="off" maxlength="24" name="libelle-operation-financiere" ng-change="ctrl.modificationLibelleOperation()" type="text" placeholder="">\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-show="ctrl.afficherDateValeur">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label">Date de valeur</span>\r\n            <div class="col-md-4 col-sm-5 col-lg-3">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.dateValeur"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-show="ctrl.afficherOD">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label">Opération Diverse</span>\r\n            <div class="col-md-5 col-sm-5 col-lg-5">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.libelleOperationDiverse"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-show="ctrl.afficherReserveEncaissement">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label">Délai d\'encaissement</span>\r\n            <div class="col-md-4 col-sm-5 col-lg-3">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.libelleReserveEncaissement"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-show="ctrl.afficherVirementInterne">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 control-label">Compte crédité</span>\r\n            <div class="col-md-4 col-sm-5 col-lg-3">\r\n                <p class="form-control-static">\r\n                    <span data-ng-bind="ctrl.numeroRiceCompteCredite"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div ng-show="ctrl.afficherChequeBanque">\r\n            <div class="form-group">\r\n                <span class="control-label col-md-2 col-sm-2 col-lg-2">Numéro du chèque</span>\r\n                <div class="col-md-4 col-sm-5 col-lg-3">\r\n                    <p class="form-control-static">\r\n                        <span data-ng-bind="ctrl.operationFinanciere.segmentPrvRio.numeroCheque"></span>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n            <div class="form-group">\r\n                <span class="control-label col-md-2 col-sm-2 col-lg-2">Bénéficiaire</span>\r\n                <div class="col-md-4 col-sm-5 col-lg-3">\r\n                    <p class="form-control-static">\r\n                        <span data-ng-bind="ctrl.operationFinanciere.segmentPrvRio.ordreCheque"></span>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </form>\r\n</div>\r\n'),e.put("typescript/plusieurs-cheques/plusieurs-cheques-view.html",'<div class="modal-header mwsf-plusieurs-cheques">\r\n    <button type="button" ng-click="ctrl.annuler();" class="close" id="id-bouton-annuler-plusieurs-cheques-opefi">\r\n        <span class="icon itce-times croix-modale" aria-hidden="true"> </span>\r\n        <span class="adobe-blank">Fermer la fenêtre modale</span>\r\n    </button>\r\n    <h1>\r\n        Répartir en plusieurs chèques\r\n    </h1>\r\n</div>\r\n<div class="modal-body texte-gros row" role="document">\r\n    <form class="form-horizontal mwsf-plusieurs-cheques form-montants">\r\n\r\n        <div class="col-lg-12 col-md-12 col-sm-12">\r\n            <div class="form-group">\r\n                <span class="col-lg-offset-2 col-md-offset-2 col-lg-3 col-md-3 col-sm-5 control-label">Montant déposé</span>\r\n                <div class="col-sm-6 col-md-6 col-lg-6">\r\n                    <mwsf-saisie-montant-devise id="depose" value="ctrl.montantDepose" read-only="true">\r\n                    </mwsf-saisie-montant-devise>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="col-lg-12 col-md-12 col-sm-12" ng-repeat="montant in ctrl.cheques">\r\n            <div class="form-group" ng-show="ctrl.getConditionAffichageMontants($index)">\r\n                <span class="col-lg-offset-2 col-md-offset-2 col-lg-3 col-md-3 col-sm-5 control-label">Montant {{$index + 1}}</span>\r\n                <div class="col-lg-5 col-md-5 col-sm-5">\r\n                    <mwsf-saisie-montant-devise id="montant" value="montant" derogation-acc030="true" force-positive="false" min="0" ng-tab="ctrl.donneFocusAuMontantSuivant($index)" ng-focus="ctrl.focus[$index]" ng-enter="ctrl.actionEntree($index)" ng-click="ctrl.afficheMontantSuivant($index)">\r\n                    </mwsf-saisie-montant-devise>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="col-lg-12 col-md-12 col-sm-12">\r\n            <div class="form-group">\r\n                <span class="col-lg-offset-2 col-md-offset-2 col-lg-3 col-md-3 col-sm-5 control-label">TOTAL</span>\r\n                <div class="col-lg-5 col-md-5 col-sm-5">\r\n                    <mwsf-saisie-montant-devise id="total" value="ctrl.montantTotal" read-only="true">\r\n                    </mwsf-saisie-montant-devise>\r\n                </div>\r\n                <span ng-hide="true" ng-bind="ctrl.calculTotal()"></span>\r\n            </div>\r\n        </div>\r\n    </form>\r\n</div>\r\n<div class="modal-footer modal-footer-custom">\r\n    <div class="col-lg-offset-3 col-sm-offset-3 col-md-offset-3 col-lg-3 col-md-3 col-sm-3">\r\n        <button type="button" class="btn btn-default" ng-click="ctrl.annuler()" id="id-bouton-annuler-bas-plusieurs-cheques-opefi">Annuler</button>\r\n    </div>\r\n    <div class="col-lg-3 col-md-3 col-sm-3">\r\n        <button type="button" class="btn btn-contextuel" ng-click="ctrl.reinitialiser()" id="id-bouton-reinitialiser-plusieurs-cheques-opefi">Ré-initialiser</button>\r\n    </div>\r\n    <div class="col-lg-3 col-md-3 col-sm-3">\r\n        <button type="button" class="btn btn-primary" ng-click="ctrl.valider()" id="id-bouton-valider-plusieurs-cheques-opefi">Valider</button>\r\n    </div>\r\n</div>\r\n\r\n\r\n'),e.put("typescript/reference-enveloppe/saisie-reference-enveloppe-view.html",'<div class="form-horizontal mwsf-saisie-reference-enveloppe" ng-show="viewModelReferenceEnveloppeCtrl.isVisible">\r\n    <div class="form-group">\r\n        <div class="col-md-4 col-sm-4 col-lg-4">\r\n            <button class="btn itce-checkbox" type="button" id="btn-numero-reference-enveloppe" name="numero-reference-enveloppe" data-ng-model="viewModelReferenceEnveloppeCtrl.referenceEnveloppe.isCocher" data-ng-disabled="viewModelReferenceEnveloppeCtrl.isDesactiverCochage" data-ng-click="viewModelReferenceEnveloppeCtrl.clicCaseACocherRefEnveloppe()" data-ng-class="{\'active\': viewModelReferenceEnveloppeCtrl.isCocher}" btn-checkbox>\r\n            </button><label class="control-label" for="numero-reference-enveloppe">Ref. Enveloppe Sac</label>\r\n        </div>\r\n        <div class="col-md-4 col-sm-4 col-lg-3" data-ng-show="viewModelReferenceEnveloppeCtrl.isNumeroEnveloppeVisible" data-ng-class="{\'has-error\':!viewModelReferenceEnveloppeCtrl.isNumeroEnveloppeSaisit}">\r\n            <input id="numero-reference-enveloppe" class="form-control" type="text" maxlength="10" name="numero-reference-enveloppe" data-ng-model="viewModelReferenceEnveloppeCtrl.referenceEnveloppe.numeroReferenceEnveloppe" data-ng-blur="viewModelReferenceEnveloppeCtrl.affinerNumeroEnveloppe(viewModelReferenceEnveloppeCtrl.referenceEnveloppe.numeroReferenceEnveloppe)" ng-required="!viewModelReferenceEnveloppeCtrl.isNumeroEnveloppeSaisit" mwsf-numbers-only-input mwsf-focus-if-bool="{{viewModelReferenceEnveloppeCtrl.setFocus}}">\r\n        </div>\r\n    </div>\r\n    <div class="form-group" data-ng-show="viewModelReferenceEnveloppeCtrl.isAfficherMessage">\r\n        <div class="col-md-2 col-sm-2 col-lg-2"></div>\r\n        <div class="col-md-10 col-sm-10 col-lg-11 error-msg">\r\n            <span data-ng-bind="viewModelReferenceEnveloppeCtrl.texteMessageConfirmation"></span>\r\n        </div>\r\n    </div>\r\n</div>'),
e.put("typescript/reference-enveloppe-operation/reference-enveloppe-operation-view.html",'<div class="form-horizontal" ng-show="ctrl.isVisible">\r\n    <div class="form-group">\r\n        <label class="control-label col-md-2" for="numero-reference-enveloppe" ng-class="{\'asterisque\':ctrl.saisieReferenceSacObligatoire}">Numéro du sac</label>\r\n        <div class="col-md-3" data-ng-show="ctrl.isNumeroEnveloppeVisible">\r\n            <input id="numero-reference-enveloppe" class="form-control" type="text" name="numero-reference-enveloppe" data-ng-model="ctrl.numeroReferenceEnveloppeSaisie" ng-blur="ctrl.miseAJourSac()" maxlength="10" ng-keyup="$event.keyCode == 13 && ctrl.miseAJourSac()">\r\n        </div>\r\n    </div>\r\n    <div class="form-group mw-static-form" data-ng-show="ctrl.afficherMessageErreurReferenceSac && !ctrl.isNumeroEnveloppeSaisit">\r\n        <div class="col-md-12 error-msg">\r\n            <span class="form-control-static" data-ng-bind="ctrl.texteMessageConfirmation"></span>\r\n        </div>\r\n    </div>\r\n</div>'),e.put("typescript/repartition/repartition-view.html",'<div class="modal-header">\r\n    <button type="button" ng-click="ctrl.$modalInstance.close();" class="close" id="id-bouton-annuler-repartition-opefi">\r\n        <span class="icon itce-times" aria-hidden="true"> </span>\r\n        <span class="adobe-blank">Fermer la fenêtre modale</span>\r\n    </button>\r\n    <h1 class="modal-title">Répartir le montant</h1>\r\n</div>\r\n<div class="modal-body texte-gros row" role="document">\r\n    <form class="form-horizontal mwsf-repartition">\r\n        <!--Répartition-->\r\n        <div class="row form-group aligne-gauche">\r\n            <span class="col-lg-4 col-md-5 col-sm-5 control-label aligne-gauche">Comptes débités</span>\r\n            <span class="col-lg-3 col-md-3 col-sm-3 control-label aligne-gauche">Montants</span>\r\n            <span class="col-lg-5 col-md-4 col-sm-4 control-label aligne-gauche">Libellés opération</span>\r\n\r\n        </div>\r\n        <div class="row form-group">\r\n            <div class="col-lg-4 col-md-5 col-sm-5 mw-form-static">\r\n                <mwsf-saisie-rice ng-if="ctrl.parametre.rice" data-ng-model="ctrl.parametre.rice" data-read-only="true" data-mode-appel="Guichet" data-controle="false" id="id-rice1-repartition-opefi"></mwsf-saisie-rice>\r\n            </div>\r\n            <div class="col-lg-3 col-md-3 col-sm-3">\r\n                <mwsf-saisie-montant-devise id="montant-1" value="ctrl.donnees.montantDevise1" force-positive="false" min="0" max="ctrl.max">\r\n                </mwsf-saisie-montant-devise>\r\n            </div>\r\n            <div class="col-lg-5 col-md-4 col-sm-4">\r\n                <input id="libelle-1" class="form-control" ng-model="ctrl.donnees.libelle1" ng-change="ctrl.changementLibelleRepartition()" type="text" ng-required="true">\r\n            </div>\r\n        </div>\r\n\r\n        <div class="row form-group">\r\n            <div class="col-lg-4 col-md-5 col-sm-5">\r\n                <mwsf-liste-compte compte-selectionne="ctrl.donnees.compteCredite2" on-bottom-action="ctrl.afficheRice2 = true;" on-select="ctrl.afficheRice2=false; ctrl.onSelect2();" parametres="ctrl.parametreListeComptes2" ng-required="ctrl.donnees.montantDevise2 && ctrl.donnees.montantDevise2.montant" id="id-liste-comptes2-repartition-opefi">\r\n                </mwsf-liste-compte>\r\n            </div>\r\n            <div class="col-lg-3 col-md-3 col-sm-3">\r\n                <mwsf-saisie-montant-devise id="montant-2" value="ctrl.donnees.montantDevise2" force-positive="false" min="ctrl.min" max="ctrl.max">\r\n                </mwsf-saisie-montant-devise>\r\n            </div>\r\n            <div class="col-lg-5 col-md-4 col-sm-4">\r\n                <input id="libelle-2" class="form-control" ng-model="ctrl.donnees.libelle2" type="text" ng-change="ctrl.changementLibelleRepartition()" ng-required="ctrl.donnees.montantDevise2 && ctrl.donnees.montantDevise2.montant">\r\n            </div>\r\n            <div class="col-lg-12 col-md-12 col-sm-12 rice-margin-left" ng-if="ctrl.afficheRice2 && ctrl.donnees.rice2">\r\n                <mwsf-saisie-rice data-ng-model="ctrl.donnees.rice2" data-read-only="false" data-mode-appel="Etablissement" data-controle="false" id="id-rice2-repartition-opefi"></mwsf-saisie-rice>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="row form-group">\r\n            <div class="col-lg-4 col-md-5 col-sm-5">\r\n                <mwsf-liste-compte compte-selectionne="ctrl.donnees.compteCredite3" on-bottom-action="ctrl.afficheRice3 = true;" on-select="ctrl.afficheRice3=false; ctrl.onSelect3();" parametres="ctrl.parametreListeComptes3" ng-required="ctrl.donnees.montantDevise3 && ctrl.donnees.montantDevise3.montant" id="id-liste-comptes3-repartition-opefi">\r\n                </mwsf-liste-compte>\r\n            </div>\r\n            <div class="col-lg-3 col-md-3 col-sm-3">\r\n                <mwsf-saisie-montant-devise id="montant-3" value="ctrl.donnees.montantDevise3" force-positive="false" min="ctrl.min" max="ctrl.max">\r\n                </mwsf-saisie-montant-devise>\r\n            </div>\r\n            <div class="col-lg-5 col-md-4 col-sm-4">\r\n                <input id="libelle-3" class="form-control" ng-model="ctrl.donnees.libelle3" ng-change="ctrl.changementLibelleRepartition()" type="text">\r\n            </div>\r\n            <div class="col-lg-12 col-md-12 col-sm-12 rice-margin-left" ng-if="ctrl.afficheRice3 && ctrl.donnees.rice3">\r\n                <mwsf-saisie-rice data-ng-model="ctrl.donnees.rice3" data-read-only="false" data-mode-appel="Etablissement" data-controle="false" id="id-rice3-repartition-opefi"></mwsf-saisie-rice>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="row mw-form-static">\r\n            <span class="col-lg-4 col-md-5 col-sm-5 control-label">Montant (sous total)</span>\r\n            <div class="col-lg-3 col-md-3 col-sm-4 total-montant">\r\n                <p id="montant-total" class="form-control-static">\r\n                    <span ng-bind="ctrl.getMontantTotalRepartition() | number : 2"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="row mw-form-static">\r\n            <span class="col-lg-4 col-md-5 col-sm-5 control-label">Différence</span>\r\n            <div class="col-lg-3 col-md-3 col-sm-4 total-montant">\r\n                <!--<div class="col-lg-1 col-md-1 col-sm-1 icon-margin-top">\r\n                    <span aria-hidden="true" class="icon itce-plus"></span>\r\n                </div>-->\r\n\r\n                <p id="difference" class="form-control-static">\r\n                    <span ng-bind="ctrl.getDifferenceRepartition() | number : 2">+</span></p>\r\n            </div>\r\n        </div>\r\n        <!--Fin Répartition-->\r\n    </form>\r\n</div>\r\n<div class="modal-footer modal-footer-custom">\r\n    <div class="col-lg-offset-6 col-lg-3 col-md-offset-6 col-md-3 col-sm-offset-6 col-sm-3">\r\n        <button type="button" class="btn btn-default" ng-click="ctrl.$modalInstance.close();" id="id-bouton-annuler2-repartition-opefi">Annuler</button>\r\n    </div>\r\n    <div class="col-lg-3 col-md-3 col-sm-3">\r\n        <button type="button" class="btn btn-primary" ng-click="ctrl.valider();" ng-disabled="!ctrl.donnees.isValid" id="id-bouton-valider-repartition-opefi">Répartir</button>\r\n    </div>\r\n</div>\r\n\r\n\r\n'),e.put("typescript/saisie-operation-financiere/saisie-operation-financiere-view.html",'<div class="col-md-12 col-sm-12 col-lg-12 mwsf-saisie-operation-financiere mw-form-static">\r\n    <div data-ng-form="operationVersementForm" class="form-horizontal" mw-chargement="viewSaisieOperationFinanciere.loading">\r\n        <div class="form-group">\r\n            <span class="titre-operation-financiere" ng-bind="::viewSaisieOperationFinanciere.operationFinanciere.titrePanelPrincipal"></span>\r\n        </div>\r\n\r\n        <div class="form-group mw-form-static" ng-if="viewSaisieOperationFinanciere.afficherRice">\r\n            <span class="col-md-2 control-label">Numéro de compte</span>\r\n            <div class="col-md-5">\r\n                <p aria-labelledby="compte-beneficiaire-label" class="form-control-static">\r\n                    <span ng-bind="viewSaisieOperationFinanciere.operationFinanciere.compte.rice | compteAffichePourCloture"></span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n        <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.showTitulaireCompteParFonctionnalite()">\r\n            <label class="col-md-2 col-sm-2 col-lg-2 control-label" for="titulaire-compte-operation-financiere">Titulaire du compte</label>\r\n            <div class="col-md-5 col-sm-5 col-lg-5">\r\n                <input id="titulaire-compte-operation-financiere" class="form-control" type="text" placeholder="" autocomplete="off" maxlength="24" required data-ng-model="viewSaisieOperationFinanciere.operationFinanciere.titulaireCompte" data-ng-change="viewSaisieOperationFinanciere.modificationTitulaireCompte()">\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-hide="viewSaisieOperationFinanciere.estUneOuverture04VPC()">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 asterisque control-label">Mode financier</span>\r\n            <div class="col-md-10">\r\n                <mwsf-saisie-mode-financier value="viewSaisieOperationFinanciere.operationFinanciere.modeFinancier" fonctionnalite="viewSaisieOperationFinanciere.operationFinanciere.fonctionnalite" produit="viewSaisieOperationFinanciere.operationFinanciere.compte.produit" devise-euro="viewSaisieOperationFinanciere.operationFinanciere.compte.isDeviseEuro()" canal="viewSaisieOperationFinanciere.operationFinanciere.canal" mode-vente="viewSaisieOperationFinanciere.operationFinanciere.modeDeVente" majeur="viewSaisieOperationFinanciere.operationFinanciere.estMajeur" code-mode-financier-defaut="viewSaisieOperationFinanciere.codeModeFinancierParDefaut" required="viewSaisieOperationFinanciere.modeFinancierObligatoire" read-only="viewSaisieOperationFinanciere.modeFinancierDesactive" id="id-mode-financier-liste-operation-financiere-page-generale">\r\n                </mwsf-saisie-mode-financier>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-if="viewSaisieOperationFinanciere.estUneOuverture04VPC()">\r\n            <span class="col-md-2 col-sm-2 col-lg-2 asterisque control-label">Mode financier</span>\r\n            <div class="col-md-10" ng-class="{\'has-error\':form.nombre.$error.required}">\r\n                <input type="text" id="nombre1" class="form-control" name="nombre" required ng-model="viewSaisieOperationFinanciere.operationFinanciere.modeFinancier" mw-combobox="mode as viewSaisieOperationFinanciere.labelModesFinancier(mode) for mode in viewSaisieOperationFinanciere.modeFinancierModes">\r\n            </div>\r\n        </div>\r\n\r\n        <div class="form-group" ng-show="viewSaisieOperationFinanciere.afficherCaseCarteTMF">\r\n            <label class="col-md-2 control-label" for="carte-tmf">Carte Tempo Multi-Fonctions</label>\r\n            <div class="col-md-3">\r\n                <div class="mw-input-check">\r\n                    <label class="col-md-12" for="carte-tmf">\r\n                        <input id="carte-tmf" type="checkbox" ng-model="viewSaisieOperationFinanciere.carteTMFCochee" ng-attr-aria-checked="viewSaisieOperationFinanciere.carteTMFCochee" aria-labelledby="carte-tmf" ng-disabled="viewSaisieOperationFinanciere.forceRetraitOADTMF()">\r\n                        <span aria-hidden="true" class="icon" ng-class="{\'itce-fa-check\':viewSaisieOperationFinanciere.carteTMFCochee}"></span>\r\n                    </label>\r\n                </div>\r\n                <mw-infobulle-aide id="infobulle-carte-tmf" id-champ="OperationCarteTMF">\r\n                </mw-infobulle-aide>\r\n            </div>\r\n        </div>\r\n        <div class="form-group" ng-show="viewSaisieOperationFinanciere.afficherCaseCarteTMF && viewSaisieOperationFinanciere.carteTMFCochee\r\n             && !viewSaisieOperationFinanciere.carteTMFModeDepotActive && viewSaisieOperationFinanciere.habiliteChoixBilletterie">\r\n\r\n            <label class="col-md-2 control-label" for="carte-tmf">Choix de la billetterie</label>\r\n            <div class="col-md-3">\r\n                <div class="mw-input-check">\r\n                    <label class="col-md-12" for="choix-billetterie">\r\n                        <input id="choix-billetterie" type="checkbox" ng-model="viewSaisieOperationFinanciere.choixBilletterieChecked" ng-attr-aria-checked="viewSaisieOperationFinanciere.choixBilletterieChecked" aria-labelledby="carte-tmf" ng-checked="viewSaisieOperationFinanciere.actionCaseChoixBilletterie()">\r\n                        <span aria-hidden="true" class="icon" ng-class="{\'itce-fa-check\':viewSaisieOperationFinanciere.choixBilletterieChecked}"></span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="form-group" ng-hide="viewSaisieOperationFinanciere.isCarteTMFRetraitOAD()">\r\n            <div data-ng-if="viewSaisieOperationFinanciere.afficherAccreditif">\r\n                <mwsf-accreditif accreditif-coche="viewSaisieOperationFinanciere.operationFinanciere.accreditifCoche" id="id-accreditif-operation-financiere-page-generale"></mwsf-accreditif>\r\n            </div>\r\n        </div>\r\n        <div class="form-group" ng-hide="viewSaisieOperationFinanciere.isCarteTMFRetraitOAD()">\r\n            <div data-ng-show="viewSaisieOperationFinanciere.afficherReferenceOAD">\r\n                <label class="col-md-2 control-label" for="reference-oad-opefi">Référence</label>\r\n                <div class="col-md-5">\r\n                    <input id="reference-oad-opefi" name="reference-oad" class="form-control" type="text" ng-model="viewSaisieOperationFinanciere.operationFinanciere.referenceOAD" required maxlength="6" data-ng-change="viewSaisieOperationFinanciere.modificationReferenceOAD()">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="form-group" data-ng-if="viewSaisieOperationFinanciere.afficherSolde">\r\n            <span class="col-md-2 control-label">Solde actuel</span>\r\n            <div class="col-md-5 form-control-static">\r\n                <mwsf-solde-compte compte-principal="viewSaisieOperationFinanciere.comptePourLeSolde" solde-detail="viewSaisieOperationFinanciere.operationFinanciere.detailDuSolde" type-affichage-solde="viewSaisieOperationFinanciere.typeAffichageSolde" id="solde-compte-opefi" fonctionnalite="viewSaisieOperationFinanciere.operationFinanciere.fonctionnalite" is-opposition="viewSaisieOperationFinanciere.isCompteDebiteEnOpposition()"></mwsf-solde-compte>\r\n            </div>\r\n        </div>\r\n        <div ng-hide="viewSaisieOperationFinanciere.isCarteTMFDepot()">\r\n            <div class="form-group">\r\n                <span class="col-md-2 col-sm-2 col-lg-2 asterisque control-label" data-ng-bind="viewSaisieOperationFinanciere.libelleMontant">\r\n                </span>\r\n                <div class="col-md-5" ng-show="!viewSaisieOperationFinanciere.montantDesactive">\r\n                    <mwsf-saisie-montant-devise id="montant-opefi" value="viewSaisieOperationFinanciere.montantDevise" force-positive="{{viewSaisieOperationFinanciere.desactiveSigneMoins}}" read-only="viewSaisieOperationFinanciere.montantDesactive" min="viewSaisieOperationFinanciere.operationFinanciere.segmentPrvRio.montantMinimum" max="viewSaisieOperationFinanciere.operationFinanciere.segmentPrvRio.montantMaximum" required="false">\r\n                    </mwsf-saisie-montant-devise>\r\n                </div>\r\n                <div class="col-md-5 form-control-static" ng-show="viewSaisieOperationFinanciere.montantDesactive">\r\n                    <span ng-bind="viewSaisieOperationFinanciere.montantDevise.montant | number:2"></span> <span ng-bind="viewSaisieOperationFinanciere.montantDevise.codeDevise"></span>\r\n                </div>\r\n                <div class="col-md-5" data-ng-show="viewSaisieOperationFinanciere.afficherPlusieursChequesParModeFinancier">\r\n                    <button class="btn btn-block btn-zone" data-ng-click="viewSaisieOperationFinanciere.ouverturePlusieursCheques()" id="id-bouton-ouverture-popup-plusieurs-cheques-operation-financiere-page-generale">\r\n                        Plusieurs chèques\r\n                    </button>\r\n                </div>\r\n\r\n                <div class="col-md-5" data-ng-show="viewSaisieOperationFinanciere.afficherVracParModeFinancier">\r\n                    <mwsf-vrac-tarification compte="viewSaisieOperationFinanciere.operationFinanciere.compte" identifiant-personne="viewSaisieOperationFinanciere.operationFinanciere.client.numeroPersonne" code-prestation-tarifiable="viewSaisieOperationFinanciere.operationFinanciere.segmentPrvRio.codePrestationTarifaire" facturation-prestation="viewSaisieOperationFinanciere.operationFinanciere.facturationPrestation" id="id-vrac-tarification-operation-financiere-page-generale">\r\n                    </mwsf-vrac-tarification>\r\n                </div>\r\n                <div class="col-md-5" data-ng-show="viewSaisieOperationFinanciere.afficherRepartitionParModeFinancier">\r\n                    <button class="btn btn-block btn-zone" data-ng-click="viewSaisieOperationFinanciere.ouvertureRepartition()" id="id-bouton-ouverture-popup-repartition-operation-financiere-page-generale">\r\n                        Répartir\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.operationFinanciere.plafondVersement.estAfficherMessageErreurPlafondVersement\r\n                 || viewSaisieOperationFinanciere.afficheErreurChampMontant">\r\n                <div class="error-msg col-md-offset-2 col-md-10">\r\n                    <span data-ng-bind="viewSaisieOperationFinanciere.texteErreurPlafondMaximumVersement"></span>&nbsp;\r\n                    <span data-ng-bind="viewSaisieOperationFinanciere.montantMaximumPlafondVersement | number:2"></span>&nbsp;\r\n                    <span data-ng-bind="viewSaisieOperationFinanciere.devisePlafondVersement"></span>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="form-group" ng-hide="!viewSaisieOperationFinanciere.choixBilletterieChecked">\r\n                <div class="col-md-10 col-sm-10 col-lg-10 col-lg-offset-2 col-md-offset-2 col-sm-offset-2">\r\n                    <mwsf-choix-billetterie montant-retrait="viewSaisieOperationFinanciere.operationFinanciere.montant" liste-repartition="viewSaisieOperationFinanciere.operationFinanciere.listeRepartitionBilletterieTMF" id="id-billetterie-operation-financiere-page-generale">\r\n                    </mwsf-choix-billetterie>\r\n                </div>\r\n            </div>\r\n\r\n            <div ng-hide="viewSaisieOperationFinanciere.isCarteTMFRetrait()">\r\n                <div ng-hide="viewSaisieOperationFinanciere.isCarteTMFRetraitOAD()">\r\n                    <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.afficherChequeBanque">\r\n                        <div class="col-md-12">\r\n                            <mwsf-cheque-banque-operation cheque-banque-operation="viewSaisieOperationFinanciere.operationFinanciere.chequeBanqueOperation" id="id-cheque-banque-operation-financiere-page-generale">\r\n                            </mwsf-cheque-banque-operation>\r\n                        </div>\r\n                    </div>\r\n                    <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.isAfficherBilletterie">\r\n                        <div class="col-md-10 col-sm-10 col-lg-10 col-lg-offset-2 col-md-offset-2 col-sm-offset-2">\r\n                            <mwsf-billetterie montant-billetterie="viewSaisieOperationFinanciere.montantBilletterie" montant="viewSaisieOperationFinanciere.operationFinanciere.montant" afficher-billetterie="viewSaisieOperationFinanciere.isAfficherBilletterie" coupure="viewSaisieOperationFinanciere.coupure" est-ouvert-par-defaut="viewSaisieOperationFinanciere.operationFinanciere.billetterieOuvertParDefaut" fonctionnalite="viewSaisieOperationFinanciere.operationFinanciere.fonctionnalite" id="id-billetterie-operation-financiere-page-generale">\r\n                            </mwsf-billetterie>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <mwsf-reference-enveloppe-operation reference-enveloppe="viewSaisieOperationFinanciere.referenceEnveloppe" set-focus="false" mode-financier="viewSaisieOperationFinanciere.operationFinanciere.modeFinancier.CTGXM1" id="id-reference-enveloppe-operation-financiere-page-generale" fonctionnalite="viewSaisieOperationFinanciere.operationFinanciere.fonctionnalite">\r\n                        </mwsf-reference-enveloppe-operation>\r\n                    </div>\r\n                    <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.afficherReferenceIdentite">\r\n                        <label class="col-md-2 col-sm-2 col-lg-2 control-label" for="reference-identite">Réf. identité</label>\r\n                        <div class="col-md-5">\r\n                            <input id="reference-identite" class="form-control" type="text" placeholder="" autocomplete="off" maxlength="32" data-ng-model="viewSaisieOperationFinanciere.referenceIdentite" data-ng-change="viewSaisieOperationFinanciere.modificationReferenceIdentite()">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="form-group">\r\n                    <div class="col-md-12 col-sm-12 col-lg-12">\r\n                        <mwsf-informations-complementaires ng-if="viewSaisieOperationFinanciere.initialisationInformationsComplementaires" libelle-operation="viewSaisieOperationFinanciere.operationFinanciere.libelleOperation" reference-enveloppe="viewSaisieOperationFinanciere.referenceEnveloppe" date-valeur="viewSaisieOperationFinanciere.dateValeur" est-modification-manuelle="viewSaisieOperationFinanciere.estModificationManuelleLibelleOperation" texte-anniversaire="viewSaisieOperationFinanciere.texteAnniversaire" id="id-informations-complementaires-operation-financiere-page-generale" masquer-date-valeur="viewSaisieOperationFinanciere.isCarteTMFRetraitOAD()" est-libelle-operation-desactive="viewSaisieOperationFinanciere.estLibelleOperationDesactive" mode-financier="viewSaisieOperationFinanciere.operationFinanciere.modeFinancier.CTGXM1">\r\n                        </mwsf-informations-complementaires>\r\n                    </div>\r\n                </div>\r\n                <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.afficherLibelleComplementaire2ParModeFinancier">\r\n                    <label class="col-md-2 col-sm-2 col-lg-2 control-label" for="libelle-complementaire2-opefi" ng-class="{\'asterisque\':viewSaisieOperationFinanciere.estObligatoireSaisieLibelleComplementaire2}">Libellé complémentaire</label>\r\n                    <div class="col-md-5 col-sm-5 col-lg-5">\r\n                        <input id="libelle-complementaire2-opefi" class="form-control" type="text" placeholder="" autocomplete="off" maxlength="32" data-ng-model="viewSaisieOperationFinanciere.operationFinanciere.libelleComplementaire2" ng-change="viewSaisieOperationFinanciere.modificationLibelleComplementaire()" ng-required="viewSaisieOperationFinanciere.estObligatoireSaisieLibelleComplementaire2">\r\n                    </div>\r\n                </div>\r\n                <div ng-hide="viewSaisieOperationFinanciere.isCarteTMFRetraitOAD()">\r\n                    <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.afficheFacturationAuto()">\r\n                        <div class="col-md-12">\r\n                            <mwsf-facturation-automatique facturation-prestation="viewSaisieOperationFinanciere.operationFinanciere.facturationPrestation" compte="viewSaisieOperationFinanciere.operationFinanciere.compte" identifiant-personne="viewSaisieOperationFinanciere.operationFinanciere.client.numeroPersonne" id="id-facturation-automatique-operation-financiere-page-generale">\r\n                            </mwsf-facturation-automatique>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.afficherOperationDiverse">\r\n                        <div class="col-lg-12 col-md-12 col-sm-12">\r\n                            <mwsf-operation-diverse-liste montant="viewSaisieOperationFinanciere.montantPourOperationDiverseListe" liste-operation-diverse="viewSaisieOperationFinanciere.listeOperationDiverse" fonctionnalite="viewSaisieOperationFinanciere.operationFinanciere.fonctionnalite" rice="::viewSaisieOperationFinanciere.operationFinanciere.compte.rice" devise="viewSaisieOperationFinanciere.operationFinanciere.compte.devise" segment-prjo="viewSaisieOperationFinanciere.operationFinanciere.segmentPrjo" est-operation-diverse-valide="viewSaisieOperationFinanciere.estOperationDiverseValide" id="id-operation-diverse-liste-operation-financiere-page-generale">\r\n                            </mwsf-operation-diverse-liste>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.afficherVirementInterne">\r\n                        <span class="col-md-2 col-sm-2 col-lg-2 control-label" data-ng-bind="viewSaisieOperationFinanciere.libelleVirementInterne">\r\n                        </span>\r\n                        <div class="col-md-10 col-sm-10 col-lg-10">\r\n                            <mwsf-virement-interne id="virementinterne" numero-personne="viewSaisieOperationFinanciere.operationFinanciere.client.numeroPersonne" rice="viewSaisieOperationFinanciere.riceVirementInterneSaisie" compte-selectionne="viewSaisieOperationFinanciere.operationFinanciere.compteVirementInterneSelectionne" type-recherche="viewSaisieOperationFinanciere.operationFinanciere.typeRechercheListeCompteVirementInterne" code-etat-recherche="viewSaisieOperationFinanciere.operationFinanciere.codeEtatRechercheListeCompteVirementInterne" liste-numeros-personnes="viewSaisieOperationFinanciere.operationFinanciere.listeNumerosPersonnesPourVirementInterne" liste-types-produits="viewSaisieOperationFinanciere.operationFinanciere.listeTypesProduitsPourVirementInterne" code-devise="viewSaisieOperationFinanciere.operationFinanciere.compte.devise.code" compte-enlever-liste="viewSaisieOperationFinanciere.operationFinanciere.compteAEnleverListeComptesVirementInterne" forcer-affichage-rice-saisie="viewSaisieOperationFinanciere.operationFinanciere.forcerAffichageRiceSaisieDansVirementInterne" rice-saisie-pre-remplit="viewSaisieOperationFinanciere.operationFinanciere.riceVirementInterneSaisie">\r\n                            </mwsf-virement-interne>\r\n                        </div>\r\n                    </div>\r\n                    <div class="form-group" data-ng-show="viewSaisieOperationFinanciere.afficherReserveEncaissement">\r\n                        <div class="col-md-12">\r\n                            <mwsf-type-cheque reserve-encaissement="viewSaisieOperationFinanciere.reserveEncaissement" rice="viewSaisieOperationFinanciere.operationFinanciere.compte.rice" id="id-type-cheque-operation-financiere-page-generale">\r\n                            </mwsf-type-cheque>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!--</mw-panel>-->\r\n    </div>\r\n</div>'),e.put("typescript/solde-compte/solde-compte-modal-view.html",'<div class="modal-header">\r\n    <button type="button" ng-click="soldeCompteModal.annuler()" class="close" id="id-bouton-fermer-modale-solde-compte-opefi">\r\n        <span class="icon itce-times" aria-hidden="true"> </span>\r\n        <span class="adobe-blank">Fermer la fenêtre modale</span>\r\n    </button>\r\n    <h1 class="modal-title">Détail du solde</h1>\r\n</div>\r\n<div class="modal-body texte-gros row" role="document">\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-4">Solde actuel</div>\r\n        <div class="col-md-4 text-align-right">\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.soldeActuel | number:2"></span></strong>\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.codeDevise"></span></strong>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-8"><hr></div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-4">+ découvert autorisé</div>\r\n        <div class="col-md-4 text-align-right">\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.decouvertAutorise | number:2"></span></strong>\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.codeDevise"></span></strong>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-4">- délai d\'encaissement</div>\r\n        <div class="col-md-4 text-align-right">\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.delaiEncaissement | number:2"></span></strong>\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.codeDevise"></span></strong>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-4">- écartés MAD</div>\r\n        <div class="col-md-4 text-align-right">\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.ecartes  | number:2"></span></strong>\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.codeDevise"></span></strong>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-4">- impayés sur prêt</div>\r\n        <div class="col-md-4 text-align-right">\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.impayesSurPret | number:2"></span></strong>\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.codeDevise"></span></strong>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-4">+ fonds mis à disposition</div>\r\n        <div class="col-md-4 text-align-right">\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.fondsMisADisposition | number:2"></span></strong>\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.codeDevise"></span></strong>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-4">- fonds réservés</div>\r\n        <div class="col-md-4 text-align-right">\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.fondsReserves | number:2"></span></strong>\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.codeDevise"></span></strong>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-8"><hr></div>\r\n    </div>\r\n\r\n    <div class="row">\r\n        <div class="col-md-offset-2 col-md-4">Solde disponible</div>\r\n        <div class="col-md-4 text-align-right">\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.soldeDisponibleDetail | number:2"></span></strong>\r\n            <strong><span data-ng-bind="soldeCompteModal.soldeDetail.codeDevise"></span></strong>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="modal-footer modal-footer-custom">\r\n    <div class="pull-right col-md-3">\r\n        <button type="button" class="btn btn-default" ng-click="soldeCompteModal.annuler()" id="id-bouton-annuler-modale-solde-opefi">Fermer</button>\r\n    </div>\r\n</div>'),
e.put("typescript/solde-compte/solde-compte-view.html",'<form class="form-horizontal mw-form-static">\r\n    <div mw-chargement="viewModelSoldeCompteCtrl.chargementSolde">\r\n        <div class="col-md-6">\r\n            <span ng-show="!viewModelSoldeCompteCtrl.affichageSoldeActuel" class="form-control-static" data-ng-bind="viewModelSoldeCompteCtrl.soldeDetail.soldeDisponible | number:2"></span>\r\n            <span ng-show="viewModelSoldeCompteCtrl.affichageSoldeActuel" class="form-control-static" data-ng-bind="viewModelSoldeCompteCtrl.soldeDetail.soldeActuel | number:2"></span>\r\n            <span class="form-control-static" data-ng-bind="viewModelSoldeCompteCtrl.codeDevise"></span>\r\n            <span class="form-control-static" data-ng-show="viewModelSoldeCompteCtrl.isOpposition">OPPO</span>\r\n        </div>\r\n        <div class="col-md-6" data-ng-show="viewModelSoldeCompteCtrl.afficherBoutonSolde">\r\n            <button type="button" class="btn-link" data-ng-click="viewModelSoldeCompteCtrl.afficherPopupSolde()" id="id-bouton-afficher-solde-compte-opefi">Voir le détail</button>\r\n        </div>\r\n    </div>\r\n</form>'),e.put("typescript/type-cheque/type-cheque-view.html",'<fieldset class="form-group mw-radio-group">\r\n    <legend class="col-md-2 col-sm-2 control-label">Délai d\'encaissement</legend>\r\n    <ul class="col-md-10 list-inline">\r\n        <li class="mw-radio-btn" id="id-case-cocher-sans-reserve-type-cheque">\r\n            <input id="case-type-cheque-sans-reserve" type="radio" name="radio-btn-libre" ng-change="viewModelTypeChequeCtrl.clicCaseCocherTypeCheque(\'sansReserve\')" value="sansReserve" ng-model="viewModelTypeChequeCtrl.choixTypeCheque" ng-disabled="!viewModelTypeChequeCtrl.estHabiliteSHGXHK">\r\n            <label for="case-type-cheque-sans-reserve">\r\n                Sans réserve\r\n            </label>\r\n        </li>\r\n        <li class="mw-radio-btn" id="id-case-cocher-avec-reserve-type-cheque">\r\n            <input id="case-type-cheque-delai-encaissement" type="radio" name="radio-btn-libre" ng-change="viewModelTypeChequeCtrl.clicCaseCocherTypeCheque(\'delaiEncaissement\')" value="delaiEncaissement" ng-model="viewModelTypeChequeCtrl.choixTypeCheque" ng-disabled="!viewModelTypeChequeCtrl.estHabiliteSHGXHK">\r\n            <label for="case-type-cheque-delai-encaissement">\r\n                Avec réserve\r\n            </label>\r\n        </li>\r\n    </ul>\r\n</fieldset>\r\n\r\n<div class="form-group" ng-show="!viewModelTypeChequeCtrl.reserveEncaissement.sansReserve">\r\n    <label class="col-md-2 control-label" for="delai-encaissement">Nombre de jours</label>\r\n    <div class="col-md-5">\r\n        <input id="delai-encaissement" data-ng-model="viewModelTypeChequeCtrl.reserveEncaissement.delaiEncaissement" data-ng-change="viewModelTypeChequeCtrl.changementDelaiEncaissement()" autocomplete="off" mw-allowed-chars="0-9" class="form-control" type="text" placeholder="" maxlength="2" ng-disabled="!viewModelTypeChequeCtrl.estHabiliteSHGXHK">\r\n    </div>\r\n</div>'),e.put("typescript/virement-interne/virement-interne-view.html",'<form class="form-horizontal">\r\n    <div class="form-group">\r\n        <div class="col-md-12 col-sm-12 col-lg-12" data-ng-show="viewModelVirementInterneCtrl.afficherBoutonSaisirCompte">\r\n            <mwsf-liste-compte compte-selectionne="viewModelVirementInterneCtrl.compteSelectionne" parametres="viewModelVirementInterneCtrl.parametreListeComptes" ng-disabled="viewModelVirementInterneCtrl.blocageEditionVirement" on-bottom-action="viewModelVirementInterneCtrl.boutonSaisirCleanCompteSelectionne()" id="id-liste-comptes-virement-interne-opefi">\r\n            </mwsf-liste-compte>\r\n        </div>\r\n        <div class="col-md-12 col-sm-12 col-lg-12" data-ng-show="!viewModelVirementInterneCtrl.afficherBoutonSaisirCompte">\r\n            <mwsf-saisie-rice ng-model="viewModelVirementInterneCtrl.rice" data-read-only="viewModelVirementInterneCtrl.blocageEditionVirement" data-mode-appel="Guichet" id="id-rice-virement-interne-opefi">\r\n            </mwsf-saisie-rice>\r\n        </div>\r\n    </div>\r\n    <div class="form-group" data-ng-show="!viewModelVirementInterneCtrl.afficherBoutonSaisirCompte">\r\n        <span class="afficher-compte-rice-lien col-md-12 col-sm-12 col-lg-12" id="lien-virement-interne-switch-rice-compte" data-ng-click="viewModelVirementInterneCtrl.boutonSaisirCompte()">\r\n            {{viewModelVirementInterneCtrl.texteBouton}}\r\n        </span>\r\n    </div>\r\n</form>'),e.put("typescript/vrac-tarification/vrac-tarification-view.html",'<div class="form-horizontal" data-ng-show="ctrl.afficherCaseCocher">\r\n    <div class="mw-input-check vertical-alignement">\r\n        <div class="col-md-5">\r\n            <label for="id-case-vrac" id="id-label-vrac" class="col-md-2 col-md-offset-2">\r\n                <input id="id-case-vrac" type="checkbox" ng-model="ctrl.caseCoche" ng-attr-aria-checked="ctrl.caseCoche" aria-labelledby="id-label-vrac" ng-change="ctrl.cocheDuVrac()">\r\n                <span aria-hidden="true" class="icon" ng-class="{\'itce-fa-check\':ctrl.caseCoche}"></span>\r\n                Vrac\r\n            </label>\r\n        </div>\r\n        <div class="col-md-7 mw-static-form" data-ng-show="ctrl.caseCoche && ctrl.montantTarification > 0">\r\n            <span class="form-control-static">Tarification :</span>\r\n            <span class="form-control-static" ng-bind="ctrl.montantTarification | number: 2"></span> <span class="form-control-static" ng-bind="ctrl.codeDevise"></span>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n'),e.put("typescript/carte-tempo-multi-fonctions/choix-billetterie/choix-billetterie-view.html",'\r\n<form class="form-horizontal mwsf-choix-billetterie">\r\n    <mw-hretractable id="choix-billetterie-opefi" open="choixBilletterieCtrl.estOuvertParDefaut">\r\n        <mw-hretractable-titre id="id-panneau-retractable-titre-choix-billetterie">\r\n            <span>Retrait carte Tempo Multi Fonctions : Choix de la billetterie</span>\r\n        </mw-hretractable-titre>\r\n        <div class="panel panel-sans-titre" ng-show="choixBilletterieCtrl.listeRepartitionAffiche && choixBilletterieCtrl.listeRepartitionAffiche.length>0">\r\n            <div class="form-group panel-body">\r\n                <div class="col-md-3 col-sm-3 col-lg-3">\r\n                    <span>Montant retrait : </span>\r\n                    <strong><span ng-bind="choixBilletterieCtrl.montantRetrait | currency"></span></strong>\r\n                </div>\r\n                <div class="col-md-4">\r\n                    <span>Montant distribué :</span>\r\n                    <strong><span ng-bind="choixBilletterieCtrl.montantDistribue | currency"></span></strong>\r\n                </div>\r\n                <div class="col-md-3">\r\n                    <span class="">Différence : </span>\r\n                    <strong>\r\n                        <span ng-class="{\'difference-texte-rouge\' : !choixBilletterieCtrl.ventilationValide}" ng-bind="choixBilletterieCtrl.montantDifference | number:2">\r\n                        </span>\r\n                        <span ng-class="{\'difference-texte-rouge\' : !choixBilletterieCtrl.ventilationValide}">€</span>\r\n                    </strong>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="form-group">\r\n                <table class="table table-interactive">\r\n                    <caption ng-show="false">Choix de la billetterie</caption>\r\n                    <thead>\r\n                        <tr>\r\n                            <th colspan="2" class="col-md-2 col-sm-2 col-lg-2" scope="col"></th>\r\n                            <th colspan="2" class="col-md-2 col-sm-2 col-lg-2 bordure-left" scope="col" ng-repeat="encaisseGab in choixBilletterieCtrl.listeRepartitionAffiche\r\n                            | mwStartFrom:((choixBilletterieCtrl.tableauHorsDirective.currentPage-1)*choixBilletterieCtrl.tableauHorsDirective.itemPerPage)\r\n                            | limitTo:choixBilletterieCtrl.tableauHorsDirective.itemPerPage track by $index">\r\n                                <span class="led-vert-sm" ng-show="(encaisseGab.statutVentilation === 0 || choixBilletterieCtrl.montantRetrait === 0) && encaisseGab.etatGab === \'1\'"></span>\r\n                                <span class="led-gris-sm" ng-show="encaisseGab.etatGab && encaisseGab.etatGab !== \'1\' \r\n                                      && (encaisseGab.statutVentilation === 0 || choixBilletterieCtrl.montantRetrait === 0) "></span>\r\n                                <span class="led-rouge-sm" ng-show="encaisseGab.statutVentilation && encaisseGab.statutVentilation !== 0 && choixBilletterieCtrl.montantRetrait !== 0"></span>\r\n                                <span ng-show="encaisseGab.numeroGab" class="text-gab"><strong>GAB</strong></span><span class="text-gab" ng-bind="encaisseGab.numeroGab"></span>\r\n                            </th>\r\n                        </tr>\r\n                    </thead>\r\n                    <thead>\r\n                        <tr>\r\n                            <th colspan="2" class="col-md-2 col-sm-2 col-lg-2" id="titre-distrub" scope="col"><strong>A distribuer</strong></th>\r\n                            <th class="col-md-1 col-sm-1 col-lg-1 bordure-left" scope="col" ng-repeat-start="encaisseGab in choixBilletterieCtrl.listeRepartitionAffiche\r\n                            | mwStartFrom:((choixBilletterieCtrl.tableauHorsDirective.currentPage-1)*choixBilletterieCtrl.tableauHorsDirective.itemPerPage)\r\n                            | limitTo:choixBilletterieCtrl.tableauHorsDirective.itemPerPage track by $index">\r\n                                <span ng-show="encaisseGab.reste"><strong>Caisse</strong></span>\r\n                            </th>\r\n                            <th class="col-md-1 col-sm-1 col-lg-1" scope="col" ng-repeat-end>\r\n                                <span ng-show="encaisseGab.ventilation"><strong>Ventil</strong></span>\r\n                            </th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tr>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1">100</td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1">\r\n                            <input type="text" class="form-control input-centre" mw-montant="0" ng-model="choixBilletterieCtrl.ventilation100" name="billet-100" id="billet-100" ng-blur="choixBilletterieCtrl.verifierUndefined()" ng-change="choixBilletterieCtrl.verifierMontant()">\r\n                        </td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1 bordure-left" ng-repeat-start="encaisseGab in choixBilletterieCtrl.listeRepartitionAffiche\r\n                            | mwStartFrom:((choixBilletterieCtrl.tableauHorsDirective.currentPage-1)*choixBilletterieCtrl.tableauHorsDirective.itemPerPage)\r\n                            | limitTo:choixBilletterieCtrl.tableauHorsDirective.itemPerPage track by $index">\r\n                            <div class="col-text-center">\r\n                                <span ng-bind="encaisseGab.reste[3]">\r\n                                </span>\r\n                            </div>\r\n                        </td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1" ng-repeat-end>\r\n                            <div class="col-text-center">\r\n                                <span ng-bind="encaisseGab.ventilation[3]">\r\n                                </span>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1">50</td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1">\r\n                            <input type="text" class="form-control input-centre" mw-montant="0" ng-model="choixBilletterieCtrl.ventilation50" name="billet-50" id="billet-50" ng-blur="choixBilletterieCtrl.verifierUndefined()" ng-change="choixBilletterieCtrl.verifierMontant()">\r\n\r\n                        </td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1 bordure-left" ng-repeat-start="encaisseGab in choixBilletterieCtrl.listeRepartitionAffiche\r\n                            | mwStartFrom:((choixBilletterieCtrl.tableauHorsDirective.currentPage-1)*choixBilletterieCtrl.tableauHorsDirective.itemPerPage)\r\n                            | limitTo:choixBilletterieCtrl.tableauHorsDirective.itemPerPage track by $index">\r\n                            <div class="col-text-center">\r\n                                <span ng-bind="encaisseGab.reste[2]">\r\n                                </span>\r\n                            </div>\r\n                        </td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1" ng-repeat-end>\r\n                            <div class="col-text-center">\r\n                                <span ng-bind="encaisseGab.ventilation[2]">\r\n                                </span>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1">20</td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1">\r\n                            <input type="text" class="form-control input-centre" mw-montant="0" ng-model="choixBilletterieCtrl.ventilation20" name="billet-20" id="billet-20" ng-blur="choixBilletterieCtrl.verifierUndefined()" ng-change="choixBilletterieCtrl.verifierMontant()">\r\n                        </td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1 bordure-left" ng-repeat-start="encaisseGab in choixBilletterieCtrl.listeRepartitionAffiche\r\n                            | mwStartFrom:((choixBilletterieCtrl.tableauHorsDirective.currentPage-1)*choixBilletterieCtrl.tableauHorsDirective.itemPerPage)\r\n                            | limitTo:choixBilletterieCtrl.tableauHorsDirective.itemPerPage track by $index">\r\n                            <div class="col-text-center">\r\n                                <span ng-bind="encaisseGab.reste[1]">\r\n                                </span>\r\n                            </div>\r\n                        </td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1" ng-repeat-end>\r\n                            <div class="col-text-center">\r\n                                <span ng-bind="encaisseGab.ventilation[1]">\r\n                                </span>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1">10</td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1">\r\n                            <input type="text" class="form-control input-centre" mw-montant="0" ng-model="choixBilletterieCtrl.ventilation10" name="billet-10" id="billet-10" ng-blur="choixBilletterieCtrl.verifierUndefined()" ng-change="choixBilletterieCtrl.verifierMontant()">\r\n                        </td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1 bordure-left" ng-repeat-start="encaisseGab in choixBilletterieCtrl.listeRepartitionAffiche\r\n                            | mwStartFrom:((choixBilletterieCtrl.tableauHorsDirective.currentPage-1)*choixBilletterieCtrl.tableauHorsDirective.itemPerPage)\r\n                            | limitTo:choixBilletterieCtrl.tableauHorsDirective.itemPerPage track by $index">\r\n                            <div class="col-text-center">\r\n                                <span ng-bind="encaisseGab.reste[0]">\r\n                                </span>\r\n                            </div>\r\n                        </td>\r\n                        <td class="col-md-1 col-sm-1 col-lg-1" ng-repeat-end>\r\n                            <div class="col-text-center">\r\n                                <span ng-bind="encaisseGab.ventilation[0]">\r\n                                </span>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n                <!--<div ng-class="choixBilletterieCtrl.nombreColEspace"></div>-->\r\n            </div>\r\n\r\n            <div class="form-group">\r\n                <pagination id="id-pagination" total-items="choixBilletterieCtrl.listeRepartitionProposition.length" items-per-page="choixBilletterieCtrl.tableauHorsDirective.itemPerPage" ng-model="choixBilletterieCtrl.tableauHorsDirective.currentPage" max-size="10" class="pagination-sm pull-right" previous-text="<" first-text="|<" next-text=">" last-text=">|" boundary-links="true">\r\n                </pagination>\r\n\r\n            </div>\r\n        </div>\r\n\r\n\r\n        <div ng-show="!choixBilletterieCtrl.listeRepartitionAffiche || choixBilletterieCtrl.listeRepartitionAffiche.length<1">\r\n            <p>Erreur lors de la récupération de l\'encaisse Gab.</p>\r\n        </div>\r\n</mw-hretractable>\r\n\r\n</form>\r\n\r\n'),e.put("typescript/carte-tempo-multi-fonctions/popup/popup-initialiser-carte-tmf-view.html",'<div class="modal-header">\r\n    <button type="button" id="id-bouton-fermeture-popup-initialiser-carte-tmf" ng-click="ctrl.annuler()" class="close" aria-hidden="true">\r\n        <span class="icon itce-times" aria-hidden="true"></span>\r\n    </button>\r\n    <h3 class="modal-title" ng-bind="ctrl.modalDatas.headerText"></h3>\r\n</div>\r\n\r\n<div class="modal-body texte-gros row">\r\n    <ng-form class="form-horizontal mw-form-static" name="ctrl.form" role="form" novalidate>\r\n        <div class="row" ng-if="::ctrl.estAvecAlertesGab">\r\n            <div class="col-md-12">\r\n                <div class="form-group">\r\n                    <ul class="col-md-offset-1 col-md-11">\r\n                        <li class="form-control-static alerte-gab" ng-repeat="amessageAlerteGab in ctrl.modalDatas.listeMessageAlerteGab track by $index" ng-bind="::amessageAlerteGab">\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="row">\r\n            <div class="col-md-12">\r\n                <div class="form-group">\r\n                    <label class="col-md-4 control-label" for="numero-carte-tmf">Numéro de carte</label>\r\n                    <div class="col-md-2">\r\n                        <p class="form-control-static text-align-right" ng-bind="::ctrl.constantes.CarteTMF.TEXTE_PREFIXE_NUMERO_CARTE_TMF"></p>\r\n                    </div>\r\n                    <div class="col-md-2" ng-class="{\'has-error\': ctrl.saisieErroneeNumeroCarte()}">\r\n                        <input id="numero-carte-tmf" name="numerocarte" ng-required="true" ng-model="ctrl.modalDatas.numeroCarte" class="form-control" type="text" focus-chargement ng-enter="ctrl.actionEntree()" ng-model-options="{ allowInvalid : true }" ng-change="ctrl.changementNumeroTmf()" autofocus>\r\n                        <span class="error-msg col-md-12" ng-show="ctrl.saisieErroneeNumeroCarte()" role="alert">\r\n                            Le suffixe du numéro de carte doit comporter 8 caractères.\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="row">\r\n            <div class="col-md-12">\r\n                <div class="form-group">\r\n                    <div class="col-md-5"></div>\r\n                    <div class="col-md-3">\r\n                        <button id="id-bouton-annuler-initialisation-carte-tmf" class="btn btn-block btn-default" ng-click="ctrl.annuler()">\r\n                            Annuler\r\n                        </button>\r\n                    </div>\r\n                    <div class="col-md-3">\r\n                        <button id="id-bouton-valider-initialisation-carte-tmf" class="btn btn-block btn-primary" ng-click="ctrl.valider()">\r\n                            Valider\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </ng-form>\r\n</div>\r\n'),e.put("typescript/cheque-banque/popup/popup-cheque-banque-view.html",'<div class="modal-header">\r\n    <button type="button" id="id-bouton-fermeture-popup-cheque-banque-opefi" ng-click="viewModelModalChequeBanqueCtrl.close()" class="close" aria-hidden="true">\r\n        <span class="icon itce-times" aria-hidden="true"></span>\r\n    </button>\r\n    <h3 class="modal-title" ng-bind="viewModelModalChequeBanqueCtrl.modalDatas.headerText"></h3>\r\n</div>\r\n\r\n<div class="modal-body texte-gros row">\r\n    <div class="form-group row" data-ng-show="viewModelModalChequeBanqueCtrl.modalDatas.multiRetrait">\r\n        <div class="col-md-2"></div>\r\n        <div class="col-md-10">\r\n            Dernière contrepartie du chèque n°<span class="texte-montant" data-ng-bind="viewModelModalChequeBanqueCtrl.modalDatas.numeroCheque" for="numero-cheque-banque-operation"></span>\r\n            d\'un montant de <span class="texte-montant" data-ng-bind="viewModelModalChequeBanqueCtrl.modalDatas.montantCheque | number:2" for="montant-cheque-banque-operation"></span> <span class="texte-montant" data-ng-bind="viewModelModalChequeBanqueCtrl.modalDatas.deviseCheque" for="devise-cheque-banque-operation"></span>\r\n        </div>\r\n    </div>\r\n    <div cass="form-group">\r\n        <div class="col-md-2"></div>\r\n        <div class="col-md-3" data-ng-show="viewModelModalChequeBanqueCtrl.modalDatas.nePasReprendreChequeEnCours">\r\n            <mw-button modele="secondaire" id="id-bouton-annuler-cheque-banque-opefi" texte="Annuler" etat="" ng-click="viewModelModalChequeBanqueCtrl.close()">\r\n            </mw-button>\r\n        </div>\r\n        <div class="col-md-3">\r\n            <mw-button modele="{{::viewModelModalChequeBanqueCtrl.modalDatas.styleBoutonImprimer}}" texte="Imprimer" id="id-bouton-imprimer-cheque-banque-opefi" etat="" ng-click="viewModelModalChequeBanqueCtrl.imprimer()">\r\n            </mw-button>\r\n        </div>\r\n        <div class="col-md-3" data-ng-show="viewModelModalChequeBanqueCtrl.modalDatas.isDerogationImpression">\r\n            <mw-button modele="{{::viewModelModalChequeBanqueCtrl.modalDatas.styleBoutonNePasImprimer}}" texte="Ne pas imprimer" id="id-bouton-ne-pas-imprimer-cheque-banque-opefi" etat="" ng-click="viewModelModalChequeBanqueCtrl.nePasImprimer()">\r\n            </mw-button>\r\n        </div>\r\n    </div>\r\n</div>'),e.put("typescript/cheque-banque-operation/popup/popup-cheque-banque-depot-retrait-view.html",'<div class="modal-header">\r\n    <button type="button" id="id-bouton-fermeture-popup-cheque-banque-opefi" ng-click="ctrl.close()" class="close" aria-hidden="true">\r\n        <span class="icon itce-times" aria-hidden="true"></span>\r\n    </button>\r\n    <h3 class="modal-title" ng-bind="ctrl.modalDatas.headerText"></h3>\r\n</div>\r\n\r\n<div class="modal-body texte-gros row">\r\n    <div class="form-group row">\r\n        <div class="col-md-2"></div>\r\n        <div class="col-md-10">\r\n            Chèque n°<span class="texte-montant" data-ng-bind="ctrl.modalDatas.numeroCheque"></span>\r\n            d\'un montant de <span class="texte-montant" data-ng-bind="ctrl.modalDatas.montantCheque | number:2"></span> <span class="texte-montant" data-ng-bind="ctrl.modalDatas.deviseCheque"></span>\r\n        </div>\r\n    </div>\r\n    <div cass="form-group">\r\n        <div class="col-md-2"></div>\r\n        <div class="col-md-3" data-ng-show="ctrl.modalDatas.nePasReprendreChequeEnCours">\r\n            <mw-button modele="secondaire" id="id-bouton-annuler-cheque-banque-opefi" texte="Annuler" etat="" ng-click="ctrl.close()">\r\n            </mw-button>\r\n        </div>\r\n        <div class="col-md-3" data-ng-show="ctrl.modalDatas.isDerogationImpression">\r\n            <mw-button modele="{{::ctrl.modalDatas.styleBoutonNePasImprimer}}" texte="Ne pas imprimer" id="id-bouton-ne-pas-imprimer-cheque-banque-opefi" etat="" ng-click="ctrl.nePasImprimer()">\r\n            </mw-button>\r\n        </div>\r\n        <div class="col-md-3">\r\n            <mw-button modele="{{::ctrl.modalDatas.styleBoutonImprimer}}" texte="Imprimer" id="id-bouton-imprimer-cheque-banque-opefi" etat="" ng-click="ctrl.imprimer()">\r\n            </mw-button>\r\n        </div>\r\n    </div>\r\n</div>')}]);