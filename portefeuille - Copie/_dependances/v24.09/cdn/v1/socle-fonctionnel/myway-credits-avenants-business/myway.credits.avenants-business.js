/**
 * Généré par : pipeline RIA
 * Build_ID : 16
 * Build_DisplayName : undefined
 * Job_Name : CEE22/CEE22-MYWAYRIAV1-ECUGEST-CREDITS/cecf3-avenants-business/release%2F24.09
 * Branch_Name : release/24.09
 */
var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";e.app=angular.module("AvenantsBusiness",["moduleAgent","myway.comInterdomaine","myway.comAdresseDqe","myway.comGestionClient","AvenantsApi","AvenantsRest"])}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n;!function(t){var n;!function(t){t.quantieme={type:e.Commun.Enum.ModificationCredit.Quantieme,label:"Quantième",checked:!1,disabled:!1,saisieInterdite:!1,messageHelp:null},t.financier={type:e.Commun.Enum.ModificationCredit.Financier,label:"Financier (taux et durée)",checked:!1,disabled:!1,saisieInterdite:!1,messageHelp:null},t.assurance={type:e.Commun.Enum.ModificationCredit.Assurance,label:"Assurances",checked:!1,disabled:!1,saisieInterdite:!1,messageHelp:null},t.reportFinPret={type:e.Commun.Enum.ModificationCredit.ReportFinPret,label:"Report fin de prêt",checked:!1,disabled:!1,saisieInterdite:!1,messageHelp:null},t.amenagementTemporaireEcheances={type:e.Commun.Enum.ModificationCredit.AmenagementTemporaireEcheances,label:"Aménagement temporaire d'échéances",checked:!1,disabled:!1,saisieInterdite:!1,messageHelp:null},t.garantie={type:e.Commun.Enum.ModificationCredit.Garantie,label:"Garanties",checked:!1,disabled:!1,saisieInterdite:!1,messageHelp:null},t.objet={type:e.Commun.Enum.ModificationCredit.Objet,label:"Objet",checked:!1,disabled:!1,saisieInterdite:!1,messageHelp:null},t.personnes={type:e.Commun.Enum.ModificationCredit.Personne,label:"Personnes",checked:!1,disabled:!1,saisieInterdite:!1,messageHelp:null}}(n=t.TypeModificationCreditUnitaire||(t.TypeModificationCreditUnitaire={})),t.listeModificationCreation=[n.quantieme,n.financier,n.assurance,n.reportFinPret,n.amenagementTemporaireEcheances,n.garantie,n.personnes,n.objet],t.listeModificationOuverture=[n.financier,n.assurance,n.garantie];var i;!function(t){t.recouvrementJudiciaire={type:e.Commun.Enum.CodeSousTypeAvenant.RecouvrementJudiciaire,label:"Recouvrement judiciaire"},t.recouvrementImpose={type:e.Commun.Enum.CodeSousTypeAvenant.RecouvrementImpose,label:"Recouvrement imposé"},t.surendettementNegocie={type:e.Commun.Enum.CodeSousTypeAvenant.SurendettementNegocie,label:"Surendettement négocié"},t.surendettementImpose={type:e.Commun.Enum.CodeSousTypeAvenant.SurendettementImpose,label:"Surendettement imposé"},t.restructurationMediationPge={type:e.Commun.Enum.CodeSousTypeAvenant.RestructurationMediationPge,label:"Restructuration médiation PGE"}}(i||(i={})),t.listeSousTypeModificationCreditCreation=[i.recouvrementJudiciaire,i.recouvrementImpose,i.surendettementNegocie,i.surendettementImpose,i.restructurationMediationPge]}(n=t.Avenant||(t.Avenant={}))}(n=t.Constantes||(t.Constantes={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){"use strict";var t;!function(e){e.choixRefusClient="Client",e.choixRefusEtablissement="Etablissement"}(t=e.Refus||(e.Refus={}));var n;!function(e){e.codeAnnulationSimulationEtablissement="A02",e.codeActionRefusEtablissement="RE",e.codeActionRefusClient="RC",e.codeActionAccordEntrepriseClient="AT",e.codeActionAccordEtablissement="AE",e.libelleAnnulationSimulationEtablissement="ANNULATION SIMULATION ETABLISSE",e.codeRefusAvenantClientSignature="A02",e.codeRefusAvenantClientSansSignature="A01",e.codeRefusAvenantEtablissementSignature="A12",e.codeRefusAvenantEtablissementSansSignature="A11",e.codeIhmAutre="Autre"}(n=e.MotifRefus||(e.MotifRefus={}));var i;!function(e){e.codeEtablissement="AE",e.codeClient="AC",e.codeAccordTotal="AT",e.libelleAttenteDecisionEtablissement="Attente décision établissement",e.libelleAttenteAccordEtablissement="Attente accord établissement",e.libelleAttenteEditionOffre="Attente édition d'offre"}(i=e.Avenant||(e.Avenant={}));var r;!function(e){e.choixEdition="Edition",e.choixTransformer="Transformation"}(r=e.ChoixDecision||(e.ChoixDecision={}));var a;!function(e){e.mandat="Mandat",e.propositionResiliation="Proposition commerciale de résiliation",e.propositionRenegociation="Proposition commerciale de renégociation",e.lettrePointVente="Lettre point vente",e.tableauAmortissement="T.A.",e.engagementCaution="Engagement caution",e.lettreEnvoi="Lettre d'envoi",e.idDocPropositionRenegociation="SAR0000-01",e.idDocPropositionResiliation="SAS0000-01",e.idDocMandat="SAM0000-01",e.idNoticeRevision="1D0700-NR",e.idDocInfoSimulation="1D0700-SI"}(a=e.Documents||(e.Documents={}));var o;!function(e){e.enGestion="En gestion",e.enElaboration="En élaboration",e.supprime="Supprimé"}(o=e.Statut||(e.Statut={}))}(t=e.Contractualisation||(e.Contractualisation={}))}(t=e.Constantes||(e.Constantes={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){"use strict";var t;!function(e){var t;!function(e){e.avenant="JC",e.simulation="BC"}(t=e.CreationActeIDN||(e.CreationActeIDN={}));var n;!function(e){e.avenant="JD",e.simulation="BD"}(n=e.ValidationHierarchie||(e.ValidationHierarchie={}));var i;!function(e){e.avenant="JE",e.simulation="BE"}(i=e.RemiseOffre||(e.RemiseOffre={}));var r;!function(e){e.avenant="JF",e.simulation="BF"}(r=e.AccuseReceptionOffre||(e.AccuseReceptionOffre={}));var a;!function(e){e.avenant="JH",e.simulation="BH"}(a=e.RefusHierarchiqueRetourPapier||(e.RefusHierarchiqueRetourPapier={}));var o;!function(e){e.avenant="JI",e.simulation="BI"}(o=e.ActivationEspaceSignature||(e.ActivationEspaceSignature={}));var s;!function(e){e.avenant="JK",e.simulation="BK"}(s=e.SignatureOffreEmprunteur||(e.SignatureOffreEmprunteur={}));var u;!function(e){e.avenant="JM",e.simulation="BM"}(u=e.Conclue||(e.Conclue={}));var c;!function(e){e.avenant="JN",e.simulation="BN"}(c=e.AbandonSignatureClient||(e.AbandonSignatureClient={}));var l;!function(e){e.avenant="JO",e.simulation="BO"}(l=e.PersonnePeutSigner||(e.PersonnePeutSigner={}));var d;!function(e){e.avenant="JR",e.simulation="BR"}(d=e.AnnulerCaduqueIDN||(e.AnnulerCaduqueIDN={}));var m;!function(e){e.avenant="JQ",e.simulation="BQ"}(m=e.AnomalieTraitementAutomatique||(e.AnomalieTraitementAutomatique={})),e.tracerEligibilite="IS"}(t=e.EvenementHisto||(e.EvenementHisto={}))}(t=e.SignatureElectronique||(e.SignatureElectronique={}))}(t=e.Constantes||(e.Constantes={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Ate||(e.Ate={}))}(t=e.Enum||(e.Enum={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";!function(e){e[e.Annuler=0]="Annuler",e[e.Modifier=1]="Modifier",e[e.Enregistrer=2]="Enregistrer",e[e.Supprimer=3]="Supprimer"}(e.ActionManipulationElement||(e.ActionManipulationElement={}));e.ActionManipulationElement;!function(e){e[e.IsCreation=0]="IsCreation",e[e.IsModified=1]="IsModified",e[e.ToDelete=2]="ToDelete",e[e.Unchanged=3]="Unchanged"}(e.EtatManipulation||(e.EtatManipulation={}));e.EtatManipulation;!function(e){e[e.Impossible=0]="Impossible",e[e.Possible=1]="Possible",e[e.Effectue=2]="Effectue"}(e.EtatDecision||(e.EtatDecision={}));e.EtatDecision;!function(e){e[e.QuotePart=0]="QuotePart",e[e.MontantFixe=1]="MontantFixe"}(e.PayeurMoyenRepartition||(e.PayeurMoyenRepartition={}));e.PayeurMoyenRepartition;!function(e){e[e.OneIsPersonnes=0]="OneIsPersonnes",e[e.TwoIsObjet=1]="TwoIsObjet",e[e.ThreeIsAutre=2]="ThreeIsAutre"}(e.StepAvenant||(e.StepAvenant={}));e.StepAvenant}(t=e.Enum||(e.Enum={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.attendu=new t("A","Attendu"),t.recu=new t("R","Reçu"),t.clos=new t("C","Clos"),t}(MyWay.Services.StringEnum);e.JustificatifStatut=t}(t=e.Enum||(e.Enum={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";!function(e){e[e.FraisPreleves=0]="FraisPreleves",e[e.FraisIntegresCrd=1]="FraisIntegresCrd"}(e.TypeFrais||(e.TypeFrais={}));e.TypeFrais}(t=e.Enum||(e.Enum={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Enum||(e.Enum={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";!function(e){e[e.Passee=0]="Passee",e[e.EncoursOuFuture=1]="EncoursOuFuture"}(e.StatutPhase||(e.StatutPhase={}));e.StatutPhase;!function(e){e[e.Obligatoire="Obligatoire"]="Obligatoire",e[e.Facultatif="Facultatif"]="Facultatif",e[e.Interdit="Interdit"]="Interdit",e[e.Inconnu=""]="Inconnu"}(e.TypeFinancement||(e.TypeFinancement={}));e.TypeFinancement;!function(e){e[e.TauxFixe=0]="TauxFixe",e[e.TauxIndexe=1]="TauxIndexe",e[e.TauxAppel=2]="TauxAppel"}(e.ModeCalculTaux||(e.ModeCalculTaux={}));e.ModeCalculTaux;!function(e){e[e.TotalementAbsorbe="T"]="TotalementAbsorbe",e[e.PartiellementAbsorbe="P"]="PartiellementAbsorbe",e[e.PasAbsorbe=""]="PasAbsorbe"}(e.StatutAbsorption||(e.StatutAbsorption={}));e.StatutAbsorption}(t=e.Enum||(e.Enum={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";!function(e){e[e.CreationActeIDN=0]="CreationActeIDN",e[e.ValidationHierarchie=1]="ValidationHierarchie",e[e.RemiseOffre=2]="RemiseOffre",e[e.AccuseReceptionOffre=3]="AccuseReceptionOffre",e[e.RefusHierarchiqueRetourPapier=4]="RefusHierarchiqueRetourPapier",e[e.ActivationEspaceSignature=5]="ActivationEspaceSignature",e[e.SignatureOffreEmprunteur=6]="SignatureOffreEmprunteur",e[e.Conclue=7]="Conclue",e[e.AbandonSignatureClient=8]="AbandonSignatureClient",e[e.PersonnePeutSigner=9]="PersonnePeutSigner",e[e.AnnulerCaduqueIDN=10]="AnnulerCaduqueIDN",e[e.AnomalieTraitementAutomatique=11]="AnomalieTraitementAutomatique",e[e.TracerEligibilite=12]="TracerEligibilite"}(e.EvenementHistoSED||(e.EvenementHistoSED={}));e.EvenementHistoSED}(t=e.Enum||(e.Enum={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(t){"use strict";var n=function(){function n(){}return n.getResult=function(e,t,n,i){return{idEmprunteur:e.dureeVersements.identifiantEmprunteur,idProduit:this.getIdProduit(n,t,i),montantActualiseCredit:e.montantCredit.montantActualiseCredit,dureeCredit:e.tempsCredit.dureeCredit,uniteDureeCredit:this.getUniteDureeCredit(n,t),listePhaseCaraFinan:this.getListePhase(t,n,i),listePhaseGaranties:this.getListePhaseGaranties(t,n,i)}},n.getIdProduit=function(e,t,n){return null!=e?e.identifiantProduit:null!=n?n.identifiantProduit:t.identifiantProduit},n.getUniteDureeCredit=function(e,t){return null!=e?e.uniteDureeCredit:t.uniteDureeCredit},n.getListePhase=function(e,n,i){if(null!==i){var r=_.filter(i.phases||[],function(e){return e.numeroPhase>1});return _.map(r||[],function(e){return t.CaracteristiqueFinanPhaseBuilder.getPhaseForInit(e,e.numeroRelatifSimulationAvenant,!0)})}if(null!==e){var r=this.getPhasesPourAppel(e);return _.map(r||[],function(e){return t.CaracteristiqueFinanPhaseBuilder.getPhaseForInit(e,e.numeroRelatifSimulationAvenant,!1)})}return angular.copy(n.phases)},n.getListePhaseGaranties=function(e,n,i){if(null!==i){var r=_.filter(i.phases||[],function(e){return e.numeroPhase>1});return _.map(r||[],function(e){return t.RestGarantiesPhaseBuilder.getPhaseForInit(e,!0)})}if(null!==e){var r=this.getPhasesPourAppel(e);return _.map(r||[],function(e){return t.RestGarantiesPhaseBuilder.getPhaseForInit(e,!1)})}return _.map(n.phases||[],function(e){return t.RestGarantiesPhaseBuilder.getPhaseForInitCaraFinan(e)})},n.getPhasesPourAppel=function(t){for(var n=t.phases,i=[],r=0,a=n;r<a.length;r++){var o=a[r];o.elementModifiableParAvenant=e.ToolsFunctionals.FonctionsPhasePalier.getElementModifiableParAvenant(o,t,moment(t.dateFinPrefinancementReelle).toDate()),o.numeroPhase>=t.numeroPhase&&"O"===o.elementModifiableParAvenant&&i.push(o)}return i},n}();t.DataBuildFluxCaraFinanBuilder=n}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.ToolsFunctionals.Accessoire,r=e.Commun.ToolsFunctionals.Credit,a=e.Commun.Tools.Object,o=function(){function e(e,n,o,s,u){this._devise=u;var c=o||{};this.idIhm=e,this.isPeriodique=a.isStringNotEmpty(n.codeTypePhase),this.numeroPhase=n.numeroPhase,this.libelleTypePhase=r.getLibelleTypePhase(n.codeTypePhase),this.libelleStandard=a.stringToExpressionCase(n.libelleStandard),this.titreNumPhase=this.isPeriodique?"Phase "+n.numeroPhase:null,this.libelleTypePhase=this.isPeriodique?r.getLibelleTypePhase(n.codeTypePhase):null,this.numeroRegleApplicationElement=null!=c.numeroRegleApplicationElement?c.numeroRegleApplicationElement:n.numeroRegleApplicationAccess,this.libelleTypeAssiette=this.isPeriodique?i.getLibelleTypeAssiette(c.codeTypeAssietteCalculElement||n.codeTypeAssietteCalculAccess,this.numeroRegleApplicationElement):null,this.libelleTypeAccessoire=a.stringToExpressionCase(n.libelleTypeAccessoire),this.numeroRelatif=null!=c.numeroRelatif?c.numeroRelatif:n.numRelatifPhaseTypePhaseProduit,this.numRelatifPhaseTypePhaseProduit=null!=c.numeroRelatif?c.numRelatifPhaseTypePhaseProduit:n.numRelatifPhaseTypePhaseProduit,this.codeTypePhase=null!=c.codeTypePhase?c.codeTypePhase:n.codeTypePhase,this.periodiciteApplicationElement=this.getPeriodicite(n,c,s),this.codeRoleCreditAvenant=null!=c.codeRoleCreditAvenant?c.codeRoleCreditAvenant:null,this.identifiantAssurance=null!=c.identifiantAssurance?c.identifiantAssurance:"",this.codeTypeAssietteCalculElement=null!=c.codeTypeAssietteCalculElement?c.codeTypeAssietteCalculElement:n.codeTypeAssietteCalculAccess,this.accessoireParConvention=n,this.detailAccessoire=null,this.ligneDetail=null,this.couleurTuile=null,this.etatManipulationAccessoire=t.Enum.EtatManipulation.Unchanged,this.isElementCalculPresentInFlux=null}return Object.defineProperty(e.prototype,"titreTuile",{get:function(){return this.isPeriodique?this.titreNumPhase:this.libelleTypeAccessoire},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ligne1Tuile",{get:function(){return this.isPeriodique?this.libelleTypeAccessoire:this.libelleStandard},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ligne2Tuile",{get:function(){return this.isPeriodique?this.libelleTypeAssiette:this.ligneDetail},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ligne3Tuile",{get:function(){return this.isPeriodique?this.ligneDetail:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ligne4Tuile",{get:function(){return this.isPeriodique&&this.detailAccessoire.elementUn.showMontantContractuel?n.AccessoireHelper.getLigneDetailComplement(this.detailAccessoire.elementUn,this._devise):""},enumerable:!0,configurable:!0}),e.prototype.setListeTauxChoix=function(e){this.detailAccessoire.elementUn.setListeTauxChoix(e)},e.prototype.setTauxMontant=function(e,i,r){this.etatManipulationAccessoire!==t.Enum.EtatManipulation.IsCreation&&this.setAccessoireToModified(),null!=this.detailAccessoire&&(this.detailAccessoire.elementUn.taux=e,this.detailAccessoire.elementUn.montant=i,this.detailAccessoire.elementUn.showMontantContractuel&&null!=r&&(this.detailAccessoire.elementUn.montantContractuel=r),this.ligneDetail=n.AccessoireHelper.getLigneDetail(this.detailAccessoire.elementUn,this._devise))},e.prototype.setAccessoireToModified=function(){this.etatManipulationAccessoire=t.Enum.EtatManipulation.IsModified},e.prototype.getPeriodicite=function(e,t,n){return null!=t.periodiciteApplicationElement?t.periodiciteApplicationElement:null!=n?n:e.periodiciteApplicationAccess},e}();n.AbstractAccessoire=o}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.Object,r=function(r){function a(a,o,s,u,c,l){r.call(this,a,s,null,u,l),this.isPeriodique=!i.isStringNotEmpty(s.regleAppelAccessoireAperiodique),this.codeSousTypeAccessoireCompl=o.codeSousTypeAccessoireCompl,this.codeAppelReversementTiers=o.codeAppelReversementTiers,this.etatManipulationAccessoire=c?t.Enum.EtatManipulation.IsCreation:t.Enum.EtatManipulation.Unchanged,this.numeroRelatif=o.numeroRelatif,this.codeAccessoireCalculTEG=o.codeAccessoireCalculTEG,this.codeAppelLecheance=o.codeAppelLecheance,this.codeNatureAccessoire=o.codeNatureAccessoire,this.codeModeCalculAccessoire1=o.codeModeCalculAccessoire1,this.regleDateDebutApplicatAccess=o.regleDateDebutApplicatAccess,this.regleDateDebutAppliAccCatalogue=o.regleDateDebutAppliAccCatalogue,this.regleEvenementDeclench1erAppel=o.regleEvenementDeclench1erAppel,this.indicateurAccessoireObligatoire=o.indicateurAccessoireObligatoire,this.indicateurAccessoireValide=o.indicateurAccessoireValide,this.indicateurAccessoireAnnuleAv=o.indicateurAccessoireAnnuleAv,this.indicAccessoireCreeParAvenant=o.indicAccessoireCreeParAvenant;var d={montantElement:o.montant,tauxElement:o.taux};this.detailAccessoire=this.getDetailAccessoire(s,d,l),this.couleurTuile=this.getCouleurTuile(c),null!=this.detailAccessoire&&(this.ligneDetail=n.AccessoireHelper.getLigneDetail(this.detailAccessoire.elementUn,l)),null!=o.dateFin&&"9999-12-31"!==o.dateFin&&(this.dateFin=moment(o.dateFin).toDate()),this.tauxOrigine=o.taux,this.dateFinOrigine=null!=o.dateFin?o.dateFin:"9999-12-31",this.libellePeriodiciteApplicationElement=e.Commun.ToolsFunctionals.Periodicite.getLibellePeriodicite(this.periodiciteApplicationElement),this.identifiantTiers=o.identifiantTiers}return __extends(a,r),Object.defineProperty(a.prototype,"texteMarquage",{get:function(){return this.etatManipulationAccessoire===t.Enum.EtatManipulation.IsCreation?e.Business.Constantes.Contractualisation.Statut.enElaboration:this.etatManipulationAccessoire===t.Enum.EtatManipulation.ToDelete?e.Business.Constantes.Contractualisation.Statut.supprime:e.Business.Constantes.Contractualisation.Statut.enGestion},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"titreTuile",{get:function(){return this.libelleTypeAccessoire},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ligne1Tuile",{get:function(){return this.isPeriodique?this.libelleTypeAssiette:this.ligneDetail},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ligne2Tuile",{get:function(){return this.isPeriodique?this.ligneDetail:""},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ligne3Tuile",{get:function(){return this.isPeriodique?"Périodique":"Apériodique"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ligne4Tuile",{get:function(){return this.isPeriodique&&null!=this.dateFin?"Fin : "+e.Commun.Tools.DateUtils.format(this.dateFin):""},enumerable:!0,configurable:!0}),a.prototype.getCouleurTuile=function(e){return e?"couleur-sombre":"couleur-vert"},a.prototype.getDetailAccessoire=function(e,t,i){return{elementUn:new n.DetailAccessoirePrincipalAnnexe(e,t,i),elementDeux:0!==n.AccessoireHelper.getMontantPlafond(t.mtPlafondTrancheCalculAccess1,e.mtPlafondTrancheCalculAccess1)?new n.DetailAccessoireAutre(2,t.tauxElement,e.tauxMinimumAccessoire1,e.tauxMaximumAccessoire1,e.tauxElement,e.mtPlafondTrancheCalculAccess1):null,elementTrois:0!==n.AccessoireHelper.getMontantPlafond(t.mtPlafondTrancheCalculAccess2,e.mtPlafondTrancheCalculAccess2)?new n.DetailAccessoireAutre(3,t.tauxElement1,e.tauxMinimumAccessoire2,e.tauxMaximumAccessoire2,e.tauxElement1,e.mtPlafondTrancheCalculAccess2):null,elementQuatre:0!==n.AccessoireHelper.getMontantPlafond(t.mtPlafondTrancheCalculAccess3,e.mtPlafondTrancheCalculAccess3)?new n.DetailAccessoireAutre(4,t.tauxElement2,e.tauxMinimumAccessoire3,e.tauxMaximumAccessoire3,e.tauxElement2,e.mtPlafondTrancheCalculAccess3):null,elementCinq:0!==n.AccessoireHelper.getMontantPlafond(t.mtPlafondTrancheCalculAccess4,e.mtPlafondTrancheCalculAccess4)?new n.DetailAccessoireAutre(5,t.tauxElement3,e.tauxMinimumAccessoire4,e.tauxMaximumAccessoire4,e.tauxElement3,e.mtPlafondTrancheCalculAccess4):null}},a.isAccessoiresAnnexesEquals=function(e,t){return e.codeNatureAccessoire===t.codeNatureAccessoire&&e.codeSousTypeAccessoireCompl===t.codeSousTypeAccessoireCompl&&e.dateFinOrigine===t.dateFinOrigine},a.isAccessoiresAnnexesEqualsCaracteristiqueFinanAccessoire=function(t,n){return n.codeNatureAccessoire===t.codeNatureAccessoire&&n.codeSousTypeAccessoireCompl===t.codeSousTypeAccessoireCompl&&n.dateFinApplicationElement===moment(t.dateFin).format(e.Commun.Constantes.Format.DATE_REST)},a.isExistAccessoiresAnnexesSurPhase=function(t,n){return _.any(t,function(t){return e.Business.Modeles.AccessoireAnnexe.isAccessoiresAnnexesEqualsCaracteristiqueFinanAccessoire(t,n)&&t.numeroPhase===n.numeroPhase})},a.FindAccessoireAnnexeSurPhase=function(t,n){return _.find(t,function(t){return e.Business.Modeles.AccessoireAnnexe.isAccessoiresAnnexesEqualsCaracteristiqueFinanAccessoire(t,n)&&t.numeroPhase===n.numeroPhase})},a}(n.AbstractAccessoire);n.AccessoireAnnexe=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.Object,r=e.Commun.ToolsFunctionals.Periodicite,a=function(e){function a(i,r,a,o,s,u,c,l){e.call(this,i,a,o,u,c),l&&(this.etatManipulationAccessoire=t.Enum.EtatManipulation.IsModified),this.idAssuranceIhm=r;var d=o||{};this.detailAccessoire=this.getDetailAccessoire(a,d,c),null!=this.detailAccessoire&&(this.ligneDetail=n.AccessoireHelper.getLigneDetail(this.detailAccessoire.elementUn,c),this.couleurTuile=n.AccessoireHelper.getCouleurTuile(this.detailAccessoire.elementUn)),this.isElementCalculPresentInFlux=null!=o,this.codeTypeAccessoireConvention=s,this.codeTypeAccessoire=a.codeTypeAccessoire,this.codeModeCalculAccessoire=a.codeModeCalculAccessoire,this.libelleLongTranche=this.getLibelleLongAccessoire(s,a)}return __extends(a,e),a.prototype.getLibelleLongAccessoire=function(e,t){if("AG"===e)return t.codeTypeAccessoire+" "+t.codeTypePhase+" "+t.numeroTranche+" Age mini: "+t.ageMinimumEntreeAssurance+" Age maxi: "+t.ageMaximumEntreeAssurance+(" - "+t.libelleTypeAccessoire+" - "+t.libelleStandard+" - "+t.regleAppelAccessoireAperiodique+" "+t.numeroRegleApplicationAccess+" "+t.numeroTranche);if("PE"===e)return"Période "+t.dureeApplicationAccessoire+" "+r.getLibellePeriodiciteAccessoire(t.uniteDureeApplicAccess)+(" "+t.libelleTypeAccessoire+" "+t.libelleStandard+" "+t.regleAppelAccessoireAperiodique+" "+t.numeroRegleApplicationAccess+" "+t.numeroTranche);if(""!==t.codeTypePhase){var n=""!==t.periodiciteApplicationAccess?t.periodiciteApplicationAccess:"S815.PTFCIN";return t.codeTypeAccessoire+" "+t.codeTypePhase+" "+t.libelleStandard+" N° relatif phase crédit: "+t.numeroPhase+(" - "+t.libelleTypeAccessoire+" "+i.stringNotNull(t.regleAppelAccessoireAperiodique)+" "+i.stringNotNull(n))+(" "+t.numeroRegleApplicationAccess+" "+t.numeroTranche)}return t.codeTypeAccessoire+" "+t.codeTypePhase+" "+t.libelleTypeAccessoire+" "+t.libelleStandard+" "+t.regleAppelAccessoireAperiodique+" "+t.numeroRegleApplicationAccess+" "+t.numeroTranche},a.prototype.getDetailAccessoire=function(e,t,i){return{elementUn:new n.DetailAccessoirePrincipalAssurance(e,t,i),elementDeux:0!==n.AccessoireHelper.getMontantPlafond(t.mtPlafondTrancheCalculAccess1,e.mtPlafondTrancheCalculAccess1)?new n.DetailAccessoireAutre(2,t.tauxElement,e.tauxMinimumAccessoire1,e.tauxMaximumAccessoire1,e.tauxElement,e.mtPlafondTrancheCalculAccess1):null,elementTrois:0!==n.AccessoireHelper.getMontantPlafond(t.mtPlafondTrancheCalculAccess2,e.mtPlafondTrancheCalculAccess2)?new n.DetailAccessoireAutre(3,t.tauxElement1,e.tauxMinimumAccessoire2,e.tauxMaximumAccessoire2,e.tauxElement1,e.mtPlafondTrancheCalculAccess2):null,elementQuatre:0!==n.AccessoireHelper.getMontantPlafond(t.mtPlafondTrancheCalculAccess3,e.mtPlafondTrancheCalculAccess3)?new n.DetailAccessoireAutre(4,t.tauxElement2,e.tauxMinimumAccessoire3,e.tauxMaximumAccessoire3,e.tauxElement2,e.mtPlafondTrancheCalculAccess3):null,elementCinq:0!==n.AccessoireHelper.getMontantPlafond(t.mtPlafondTrancheCalculAccess4,e.mtPlafondTrancheCalculAccess4)?new n.DetailAccessoireAutre(5,t.tauxElement3,e.tauxMinimumAccessoire4,e.tauxMaximumAccessoire4,e.tauxElement3,e.mtPlafondTrancheCalculAccess4):null}},a}(n.AbstractAccessoire);n.AccessoireAssurance=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getAccessoireConvention=function(e,t,n){var i=angular.copy(e);return i.numeroPhase=t,i.numRelatifPhaseTypePhaseProduit=n.numRelatifPhaseTypePhaseProduit,i.codeTypeAccessoire=n.codeTypeAccessoire,i.codeTypePhase=n.codeTypePhase,i.indicateurBanalise="E",i},e}();e.AccessoireConventionBuilder=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(t){"use strict";var n=function(n){function i(i,r,a,o,s,u){var c=a||{};n.call(this,i,new t.AccessoireConventionAdapaterCaraFinan(r),new t.EltCalculAdapaterCaraFinan(c),o,s),this.detailAccessoire=this.getDetailAccessoire(r,c,s),this.ligneDetail=t.AccessoireHelper.getLigneDetail(this.detailAccessoire.elementUn,s),this.couleurTuile=t.AccessoireHelper.getCouleurTuile(this.detailAccessoire.elementUn),this.isElementCalculPresentInFlux=null!=a,this.etatManipulationAccessoire=u?e.Enum.EtatManipulation.IsCreation:e.Enum.EtatManipulation.Unchanged,this.modeComptaRecouvraccessoire=null!=c.modeComptaRecouvraccessoire?c.modeComptaRecouvraccessoire:null,this.indicAccessoireCreeParAvenant=null!=c.indicAccessoireCreeParAvenant?c.indicAccessoireCreeParAvenant:null,this.regleAppelAccessoireAperiodique=null!=c.regleAppelAccessoireAperiodique?c.regleAppelAccessoireAperiodique:r.regleAppelAccessoireAperiodique,this.codeTypologieAccessoire=null!=c.codeTypologieAccessoire?c.codeTypologieAccessoire:null}return __extends(i,n),i.prototype.getDetailAccessoire=function(e,n,i){return{elementUn:new t.DetailAccessoirePrincipalGarantie(e,n,i),elementDeux:0!==t.AccessoireHelper.getMontantPlafond(n.mtPlafondTrancheCalculAccessoi1,e.mtPlafondTrancheCalculAccessoi1)?new t.DetailAccessoireAutre(2,n.tauxElement,e.tauxMinimumAccessoire1,e.tauxMaximumAccessoire1,e.tauxElement,e.mtPlafondTrancheCalculAccessoi1):null,elementTrois:0!==t.AccessoireHelper.getMontantPlafond(n.mtPlafondTrancheCalculAccessoi2,e.mtPlafondTrancheCalculAccessoi2)?new t.DetailAccessoireAutre(3,n.tauxElement1,e.tauxMinimumAccessoire2,e.tauxMaximumAccessoire2,e.tauxElement1,e.mtPlafondTrancheCalculAccessoi2):null,elementQuatre:0!==t.AccessoireHelper.getMontantPlafond(n.mtPlafondTrancheCalculAccessoi3,e.mtPlafondTrancheCalculAccessoi3)?new t.DetailAccessoireAutre(4,n.tauxElement2,e.tauxMinimumAccessoire3,e.tauxMaximumAccessoire3,e.tauxElement2,e.mtPlafondTrancheCalculAccessoi3):null,elementCinq:0!==t.AccessoireHelper.getMontantPlafond(n.mtPlafondTrancheCalculAccessoi4,e.mtPlafondTrancheCalculAccessoi4)?new t.DetailAccessoireAutre(5,n.tauxElement3,e.tauxMinimumAccessoire4,e.tauxMaximumAccessoire4,e.tauxElement3,e.mtPlafondTrancheCalculAccessoi4):null}},i}(t.AbstractAccessoire);t.AccessoireGarantie=n}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.Object,i=function(){function t(){}return t.getCouleurTuile=function(t){return t.modeCalcul===e.Commun.Enum.ModeCalcul.TauxChoix||t.modeCalcul===e.Commun.Enum.ModeCalcul.TauxSaisissable?"couleur-sombre":"couleur-vert"},t.getMontantPlafond=function(e,t){return null!=e?e:null!=t?t:0},t.getLigneDetail=function(t,i){return t.modeCalcul===e.Commun.Enum.ModeCalcul.TauxChoix||t.modeCalcul===e.Commun.Enum.ModeCalcul.TauxSaisissable?"Taux : "+n.numberToString(t.taux,4)+" %":"Montant : "+n.numberToString(t.montant,2)+" "+i},t.getLigneDetailComplement=function(e,t){return e.showMontantContractuel?"Montant : "+n.numberToString(e.montantContractuel,2)+" "+t:""},t}();t.AccessoireHelper=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(){}return t.getTypeAssurance=function(t){switch(t){case"F":return e.Commun.Enum.TypeAssurance.Facultatif;case"O":case"P":return e.Commun.Enum.TypeAssurance.Obligatoire;default:return e.Commun.Enum.TypeAssurance.NonDefini}},t.isPhaseAvailable=function(e,t){switch(e.codeTypePhase){case"PF":return e.dureeAjusteePhaseCredit<=t.dureeMaxiPrefiPourConvention;case"DT":return e.dureeAjusteePhaseCredit<=t.dureeMaxiDifTotalPourConvention;case"DA":return e.dureeAjusteePhaseCredit<=t.dureeMaxiDifAmortPourConvention;default:return!0}},t.getMotifDeliaison=function(t,n,i){if(!t)return e.Commun.Enum.MotifDeliaisonAssurance.autre;var r=moment(i).add(1,"year").toDate();return e.Commun.Tools.DateUtils.isBefore(n,r)?e.Commun.Enum.MotifDeliaisonAssurance.substitutionAnnee:e.Commun.Enum.MotifDeliaisonAssurance.substitutionAnniversaire},t.getCompagnie=function(e){return{isCompagnieExterne:!1,numeroExterneConvention:e.numeroExterneConvention,codeEtablissement:e.codeEtablissement,libelleLong:e.libelleTiers+" - "+e.numeroExterneConvention,libelleTiers:e.libelleTiers,listeConvention:[]}},t.getMotifReserve=function(e){return{code:e.codeReserveExclusionAssurance,libelle:e.libelleReservesExclusions}},t}();t.AssuranceHelper=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.List,a=e.Commun.Tools.Object,o=e.Commun.ToolsFunctionals.Assurance,s=e.Commun.ToolsFunctionals.PeriodiciteConverter,u=function(){function u(a,s,u,c,l,d,m,h,p,f,A,P,v,g,C,E,b,T,y,M){if(this._devise=d,this._dateFinCredit=p,this._dateEffet=m,this._dateTraitement=h,this._dateEmission=i.parse(A.dateDecisionEmission),this._dataForAssurance=f,this._creditInfos=A,this._creditCaraFinan=P,this._creditObjet=M,this._phasesByCreditCaraFinan=null!=P.phases?P.phases:_.map(A.phases,function(e){return new n.PhaseInfoCreditAdapaterCaraFinan(e)}),this._isChangementProduit=v,this._phaseModifiables=E,this._creditAvenantFinancier=T,this._dureeRestanteCreditMois=null!=this._creditAvenantFinancier?e.Commun.ToolsFunctionals.PeriodiciteConverter.getPeriodiciteMensuelle(T.uniteDureeCredit,T.dureeResiduelle):-1,this.dataListePersonne=u,this.dataListeReserveExclusion=l,this.idIhm=a,this.isPhaseEnCoursPeriodiciteScinde=g,
this.isAvenantPeriodicite=C,this._listeEncoursPersonneAssu=y,null===s){var D=b.conventionAssurance||{},x=this.getPersonneSelected(b,u);this.etatManipulation=t.Enum.EtatManipulation.Unchanged,this.dataListeCompagnie=this.filterListeCompagnieApplicable(this._dataForAssurance,c,D),this._compagnieSelected=this.getCompagnieSelected(D.numeroExterneConvention,this.dataListeCompagnie),this._numCompagnieInitiale=this._compagnieSelected.numeroExterneConvention,this._compagnieSelected.listeConvention=this.getListeConventionApplicable(this._compagnieSelected,this._dateEffet,this._dateEmission,b.codeActionPourMiseAJour,b.codeAncienneteAssuranceGarantie,x,this._dataForAssurance,this._creditInfos,this._phasesByCreditCaraFinan,D.identifiantConvention),this._conventionSelected=r.findOrEmpty(this._compagnieSelected.listeConvention,function(e){return e.idConvention===D.identifiantConvention}),this.titre="Assurance n°"+b.identifiantAssurance,this.isCreationFirstEdition=!1,this.identifiant=b.identifiantAssurance,this.statut="A"===b.codeAncienneteAssuranceGarantie?e.Business.Constantes.Contractualisation.Statut.enGestion:e.Business.Constantes.Contractualisation.Statut.enElaboration,this._personneSelected=x,this.personneSelected=x,this.typeAssurance=n.AssuranceHelper.getTypeAssurance(b.codeAssuranceObligatoire),this.codeAssuranceObligatoireInit=b.codeAssuranceObligatoire,this._datePriseEnCharge=i.parse(b.datePriseEffetAssurance),this.isDatePriseEnChargeEditable="G01"===D.regleDateEffetAssurgarantie,this._dateFinPriseEnCharge=i.parse(b.dateFinEffetAssurance),this.quotite=b.quotiteCouvertureCredit,this.quotiteIncluseTeg=b.quotiteAccessoireInclusTeg,this.quotiteNonInclusTeg=b.quotiteAccessNonInclusTeg,this.coutHuitAns=b.montant8AnsAssuranceExterne,this.coutTotal=b.montantTotalAssuranceExterne,this.montant=b.montantEcheanceCouvertAssurance,this.reserveSelected=r.findOrEmpty(l,function(e){return e.code===b.codeReserveExclusionAssurance}),this.beneficiaireAvantVersement=b.beneficiaireAssuAvantVersem,this.libelleAssuranceExterne=b.libelleAssuranceExterne,this.refExterne=b.numeroDossierChezLAssureur,this.motifDeliaison=o.getMotifDeliaisonByCode(b.codeMotifResiliation),this.showMotifDeliaison=!1,this.codeActionPourMiseAJour=b.codeActionPourMiseAJour,this.codeAncienneteAssuranceGarantie=b.codeAncienneteAssuranceGarantie,this.listeAccessoire=this.getListeAccessoire(this._isChangementProduit?2:A.numeroPhase,b.elementsCalculAccessoires,this.conventionSelected.listeAccessoireParConvention,this.conventionSelected.codeTypeAccessoireConvention,i.parse(b.datePriseEffetAssurance),m,h,this.personneSelected.dateNaissance,d,E),this.listeComposantes=this.getListeComposantes(b.composantes,b.dateFinEffetAssurance,f.listeTypesSinistres),this.setDataWithConvention(this.conventionSelected),this.setExtensionPersonnesAgees("O"===b.codeCouvertureTypeExtension),this.risque=o.getRisqueByCode(b.codeTypeRisque)||null,this.codeGrilleTarifaire=o.getCodeGrilleTarifaireByCode(b.codeGrilleTarifaire),this.sommeAllTauxAccessoireBeforeAvenant=this.getSommeAllTauxAccessoire(),this.modeEdition=!1}else this.etatManipulation=t.Enum.EtatManipulation.IsCreation,this.dataListeCompagnie=c,this.identifiant=s.toString(),this.titre="Nouvelle assurance n°"+s.toString(),this.statut="En élaboration",this.typeAssurance=e.Commun.Enum.TypeAssurance.Obligatoire,this.quotiteIncluseTeg=100,this.quotiteNonInclusTeg=0,this.coutHuitAns=null,this.coutTotal=null,this.modeEdition=!0,this.isCreationFirstEdition=!0,this.codeActionPourMiseAJour=e.Commun.Enum.CodeTypeAcces.Creation.toString(),this.codeAncienneteAssuranceGarantie="N",this.codeGrilleTarifaire=null,this.sommeAllTauxAccessoireBeforeAvenant=0}return u.prototype.onChangeCoutHuitAns=function(){void 0===this.coutHuitAns&&(this.coutHuitAns=null)},u.prototype.onChangeCoutTotals=function(){void 0===this.coutTotal&&(this.coutTotal=null)},u.prototype.getShowMotifDeliaison=function(){return this.showMotifDeliaison||!!this.motifDeliaison&&this.motifDeliaison.key!==e.Commun.Enum.MotifDeliaisonAssurance.aucun.key},Object.defineProperty(u.prototype,"montantEncoursAssure",{get:function(){var e=null!=this.quotite?this.montantEncoursAssureHorsCredit+(this.isLoiLemoine_novembre2023_applicable?this._creditInfos.montantCapitalRestantSurCredit*this.quotite/100:0):this.montantEncoursAssureHorsCredit;return e},enumerable:!0,configurable:!0}),u.prototype.getCodeGrilleTarifaireInit=function(){return this._personneSelected&&this._conventionSelected?this._conventionSelected.estLoiLemoine202311&&this.showMontantEncoursAssure&&(this.montantEncoursAssureHorsCredit>2e5&&"€"===this._devise||moment(this._creditInfos.dateFinCredit).diff(moment(this._personneSelected.dateNaissance),"Y")>=60)?(this.interdit=!1,e.Commun.Enum.CodeGrilleTarifaire.tarifAvecQuestionnaireSante):(this.interdit=!0,e.Commun.Enum.CodeGrilleTarifaire.tarifSansQuestionnaireSante):null},Object.defineProperty(u.prototype,"quotite",{get:function(){return this._quotite},set:function(t){return this._quotite=t,this.showMontantEncoursAssure&&this.montantEncoursAssure>2e5&&"€"===this._devise?void(this.interdit&&(this.codeGrilleTarifaire=e.Commun.Enum.CodeGrilleTarifaire.tarifAvecQuestionnaireSante,this.interdit=!1)):(this.getCodeGrilleTarifaireInit(),void(this.interdit&&(this.codeGrilleTarifaire=e.Commun.Enum.CodeGrilleTarifaire.tarifSansQuestionnaireSante)))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"personneSelected",{get:function(){return this._personneSelected},set:function(t){(angular.isUndefined(t)||null===t||t!==this._personneSelected)&&this.resetDataPersonne(),this._personneSelected=t,this.montantEncoursAssureHorsCredit=e.Business.Modeles.PersonneAssurableGarantBuilder.getEncoursPersonneAssu(this._listeEncoursPersonneAssu,this._personneSelected.identifiantPersonne).montantEncours},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"compagnieSelected",{get:function(){return this._compagnieSelected},set:function(e){return(angular.isUndefined(e)||null===e||e!==this._compagnieSelected)&&this.resetDataCompagnie(),null!=e&&e!==this._compagnieSelected?(e.listeConvention=this.getListeConventionApplicable(e,this._dateEffet,this._dateEmission,this.codeActionPourMiseAJour,this.codeAncienneteAssuranceGarantie,this.personneSelected,this._dataForAssurance,this._creditInfos,this._phasesByCreditCaraFinan),this._compagnieSelected=e,void(_.isEmpty(e.listeConvention)||1!==e.listeConvention.length||(this.conventionSelected=e.listeConvention[0]))):void(this._compagnieSelected=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"conventionSelected",{get:function(){return this._conventionSelected},set:function(e){(angular.isUndefined(e)||null===e||e!==this._conventionSelected)&&this.resetDataConvention(),null!=e&&e!==this._conventionSelected&&(this.setDataWithNewConvention(e),e.estGereeEnComposantes&&!e.estPerteEmploi?this.listeComposantes=this.getListeComposantes(this._dataForAssurance.listeComposantesVierges,moment(this._dateFinPriseEnCharge).format("YYYY-MM-DD"),this._dataForAssurance.listeTypesSinistres,this.identifiant):this.listeComposantes=null),this._conventionSelected=e,null!=this._conventionSelected&&(this.codeGrilleTarifaire=this.getCodeGrilleTarifaireInit())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showExtensionPersonnesAgees",{get:function(){return this._showExtensionPersonnesAgees},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showLibelleAssuranceExterne",{get:function(){return this._showLibelleAssuranceExterne},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isAssuranceExterne",{get:function(){return this._isAssuranceExterne},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isShowCout8Ans",{get:function(){return this._isShowCout8Ans},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isShowCout8AnsConsult",{get:function(){return this._isShowCout8Ans&&null!=this.coutHuitAns},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isShowCoutTotalConsult",{get:function(){return this.isNewAssuranceExterne&&null!=this.coutTotal},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"extensionPersonnesAgees",{get:function(){return this._extensionPersonnesAgees},set:function(e){this.setExtensionPersonnesAgees(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"modeCalculByQuotite",{get:function(){return this._modeCalculByQuotite},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"libelleHelpQuotite",{get:function(){return this._libelleHelpQuotite},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"modeCalculByMontant",{get:function(){return this._modeCalculByMontant},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"libelleHelpMontant",{get:function(){return this._libelleHelpMontant},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"datePriseEnCharge",{get:function(){return this._datePriseEnCharge},set:function(e){angular.isUndefined(e)||null===e?this._dateFinPriseEnCharge=null:null!=e&&e!==this._datePriseEnCharge&&(this._dateFinPriseEnCharge=this.getDateFinPriseCharge(this.personneSelected.estPersonnePhysique,this.conventionSelected.ageMaximumCouvertureAssurance,this.conventionSelected.ageMaximumCouvertureEnExtension,this.extensionPersonnesAgees,this.personneSelected.dateNaissance)),this._datePriseEnCharge=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"dateFinPriseEnCharge",{get:function(){return this._dateFinPriseEnCharge},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"dataListeRisque",{get:function(){return this._dataListeRisque},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"listeComposantes",{get:function(){return this._listeComposantes||[]},set:function(e){this._listeComposantes=e,this._listeComposantesSocleRetenues=_.filter(this._listeComposantes||[],function(e){return e.estRetenue&&e.estSocle}),this._listeComposantesOptionRetenues=_.filter(this._listeComposantes||[],function(e){return e.estRetenue&&!e.estSocle})},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"listeComposantesSocleRetenues",{get:function(){return this._listeComposantesSocleRetenues||[]},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"listeComposantesOptionRetenues",{get:function(){return this._listeComposantesOptionRetenues||[]},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isEditionCanBeCanceled",{get:function(){return this.modeEdition&&!this.isCreationFirstEdition},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"infosLevel1Valid",{get:function(){return null!=this.personneSelected&&null!=this.compagnieSelected&&null!=this.conventionSelected},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"infosLevel2Valid",{get:function(){return this.infosLevel1Valid&&null!=this.reserveSelected},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"infosLevel3Valid",{get:function(){return this.infosLevel2Valid&&null!=this.risque},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isInvalid",{get:function(){return!this.isQuotiteValid()||!this.isMontantValid()||!this.isCoutHuitAnsValid()||!this.isCoutTotalValid()||this.isErreurCoutTotal()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"hasComposantes",{get:function(){return(this._listeComposantes||[]).length>0},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isObligatoire",{get:function(){return(this._listeComposantes||[]).length>0&&null!=this.compagnieSelected&&"A341H"!==this.compagnieSelected.numeroExterneConvention},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showTypeAssurance",{get:function(){return!this.hasComposantes||!this.isObligatoire},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showTopQSConsultation",{get:function(){return null!=this.codeGrilleTarifaire&&(this.codeGrilleTarifaire.key===e.Commun.Enum.CodeGrilleTarifaire.tarifSansQuestionnaireSante.key||this.codeGrilleTarifaire.key===e.Commun.Enum.CodeGrilleTarifaire.tarifAvecQuestionnaireSante.key)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showTopQSSaisissable",{get:function(){return this.etatManipulation===t.Enum.EtatManipulation.IsCreation||null!=this.compagnieSelected&&this.compagnieSelected.numeroExterneConvention!==this._numCompagnieInitiale?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showMontantEncoursAssure",{get:function(){return this.showTopQSSaisissable&&this.isLoiLemoine_novembre2023_applicable},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isLoiLemoine_novembre2023_applicable",{get:function(){return!this.isAssuranceExterne&&e.Business.ToolsFunctionals.Assurance.estCreditLoiLemoine202311(this._creditCaraFinan,this._creditInfos,this._creditObjet)&&(void 0===this._creditObjet||null===this._creditObjet||void 0===this._creditObjet.codeUtilisationObjetDansCredit||_.include(["F","M"],this._creditObjet.codeUtilisationObjetDansCredit))&&null!=this._conventionSelected&&this._conventionSelected.estLoiLemoine202311&&moment(this._dateFinPriseEnCharge).isAfter(new Date)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"libelleErreurCoutTotal",{get:function(){return this._libelleErreurCoutTotal},enumerable:!0,configurable:!0}),u.prototype.getTypeAssuranceCreation=function(t){return!_.isEmpty(t)&&!_.isEmpty(this._creditInfos)&&!_.isEmpty(this._creditInfos.typeLoi)&&"2"===this._creditInfos.typeLoi&&this.quotiteIncluseTeg>0?e.Commun.Enum.TypeAssurance.Obligatoire:e.Commun.Enum.TypeAssurance.Facultatif},u.prototype.isQuotiteValid=function(){return this.modeCalculByQuotite?null!=this.quotite&&this.quotite>=this.conventionSelected.quotiteMinimumParBeneficiaire&&this.quotite<=this.conventionSelected.quotiteMaximumParBeneficiaire&&a.isModuloRespected(this.quotite,this.conventionSelected.pasQuotiteParBeneficiaire):!0},u.prototype.isMontantValid=function(){return this.modeCalculByMontant?null!=this.montant&&this.montant>=this.conventionSelected.montantMinimumGarantiParTete&&this.montant<=this.conventionSelected.montantMaximumGarantiParTete&&a.isModuloRespected(this.montant,this.conventionSelected.pasMontantGarantiParTete):!0},Object.defineProperty(u.prototype,"isNewAssuranceModeEdition",{get:function(){return this.etatManipulation===t.Enum.EtatManipulation.IsCreation&&this.modeEdition},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isNewAssuranceExterne",{get:function(){return this.isAssuranceExterne&&(this.etatManipulation===t.Enum.EtatManipulation.IsCreation||null!=this.compagnieSelected&&this.compagnieSelected.numeroExterneConvention!==this._numCompagnieInitiale)},enumerable:!0,configurable:!0}),u.prototype.getShowCout8Ans=function(){return this.isNewAssuranceExterne&&(this._dureeRestanteCreditMois>=96||this._dureeRestanteCreditMois<0)},u.prototype.isCoutHuitAnsValid=function(){return!0},u.prototype.isCoutTotalValid=function(){return!0},u.prototype.isErreurCoutTotal=function(){var e=this.isShowCout8Ans&&!!this.coutHuitAns&&!!this.coutTotal&&this.coutTotal<this.coutHuitAns;return this._libelleErreurCoutTotal=e?"Le coût total ne peut pas être inférieur au coût à 8 ans.":"",e},u.prototype.setAccessoires=function(e,t){_.forEach(this.listeAccessoire,function(n){(n.titreNumPhase===e.titreNumPhase||t&&n.codeModeCalculAccessoire===e.codeModeCalculAccessoire)&&n.setTauxMontant(e.detailAccessoire.elementUn.taux,e.detailAccessoire.elementUn.montant,e.detailAccessoire.elementUn.montantContractuel)})},u.prototype.setComposantes=function(e,t){if(t&&(this._listeComposantesOptionRetenues.forEach(function(e){e.estPerteEmploi||(e.estRetenue=!1)}),this._listeComposantesOptionRetenues=_.filter(this._listeComposantesOptionRetenues,function(e){return e.estRetenue})),(e||[]).length>0){var n=_.filter(this._listeComposantes,function(e){return!e.estSocle});this.listeComposantes=_.union(e,n)}},u.prototype.estPerteEmploi=function(){return this._conventionSelected.estPerteEmploi},u.prototype.getSommeAllTauxAccessoire=function(){var e=this;return _.reduce(_.filter(this.listeAccessoire,function(e){return"33"===e.codeTypeAssietteCalculElement&&"A03"===e.numeroRegleApplicationElement}),function(t,n){return t+n.detailAccessoire.elementUn.taux*e.quotite/100},0)},u.prototype.getCompagnieSelected=function(e,t){var n=_.find(t,function(t){return t.numeroExterneConvention===e});return null!=n?n:_.first(t)},u.prototype.getPersonneSelected=function(e,t){return r.findOrEmpty(t,function(t){return e.personneAssuree.identifiantPersonneEstAssure===t.identifiantPersonne&&e.personneAssuree.typeRolePersonne===(null!=t.role?t.role.key:void 0)})},u.prototype.getDateFinPriseCharge=function(e,t,n,i,r){if(e){if(!i&&999!==t)return this.getDateFinPriseChargeCalculee(r,t);if(i)return this.getDateFinPriseChargeCalculee(r,n)}return null},u.prototype.getDateFinPriseChargeCalculee=function(e,t){var n=e.getFullYear()+t,i=new Date(n,e.getMonth(),e.getDate());return moment(i).isValid?i:moment(i).add(1,"days").toDate()},u.prototype.filterListeCompagnieApplicable=function(e,t,n){if(null!=n&&"Q1"===n.codeIdentificationConventionJur)return t;var i=_.chain(e.listeConventionAssurance).filter(function(e){return"Q1"===e.codeIdentificationConventionJur}).map(function(e){return e.numeroExterneConvention}).value();return _.filter(t,function(e){return!_.contains(i,e.numeroExterneConvention)})},u.prototype.getListeConventionApplicable=function(e,t,i,r,a,o,s,u,c,l){var d=this;void 0===l&&(l=null);var m=_.filter(s.listeConventionAssurance,function(n){if(l===n.identifiantConvention)return!0;var m=n.codeFamilleProduit===u.identifiantProduit.substring(0,5)&&n.numeroRelatifProduit===u.identifiantProduit.substring(5)&&d.isConventionAvailable(t,i,o,r,a,n,s,u,c);return e.isCompagnieExterne?m:m&&n.numeroExterneConvention===e.numeroExterneConvention&&n.codeEtablissement===e.codeEtablissement});return _.sortByOrder(_.map(m,function(e){return new n.ConventionApplicable(e,s.listeAccessoireParConvention)}),function(e){return e.libelleLongConvention},!0)},u.prototype.isConventionAvailable=function(t,i,r,a,o,s,u,c,l){if(c.montantActualiseCredit>s.mtMaximumCreditConvention||c.montantActualiseCredit<s.mtMinimumCreditConvention||c.dureeCredit>s.dureeMaxiCreditObtentionConv||c.dureeCredit<s.dureeMiniCreditObtentionConv)return!1;var d=n.AvenantDescription.getNumEcheanceDebutFinPhase(c),m=d[1]===c.numeroEcheance,h=_.filter(l,function(e){return e.identifiantCredit===c.identifiantCredit&&e.codeRoleCreditAvenant===c.codeRoleCreditAvenant&&(e.numeroPhase>c.numeroPhase||!m&&e.numeroPhase===c.numeroPhase)});if(_.any(h,function(e){return!n.AssuranceHelper.isPhaseAvailable(e,s)}))return!1;var p=_.reduce(_.filter(h,function(e){return"AM"===e.codeTypePhase}),function(e,t){return e+t.dureeAjusteePhaseCredit},0);if(p>s.dureeMaxiAmortisspourConvention)return!1;if("N"!==s.codeTypeObjetAutorise){var f=_.any(u.listeConventionApplicableObjet,function(e){return e.identifiantConvention===s.identifiantConvention&&e.typeObjetFinanceGaranti===c.typeObjetFinanceGaranti});if(!f)return!1}if("C"===s.codeTypeObjetAutorise){var A=_.any(u.listeConventionApplicableEmprunteur,function(e){return e.identifiantConvention===s.identifiantConvention&&e.codeCategorieEmprunteur===c.codeCategorieEmprunteur});if(!A)return!1}if(r.estPersonnePhysique){var P=a===e.Commun.Enum.CodeTypeAcces.Creation.toString()||"N"===o?t:i,v=moment(P).diff(moment(r.dateNaissance),"years");if(999!==s.ageMaximumEntreeAssurance&&v>s.ageMaximumEntreeAssurance||999!==s.ageMinimumEntreeAssurance&&v<s.ageMinimumEntreeAssurance)return!1}if(s.montantMaximumEncoursGaranti>0&&s.montantMaximumEncoursGaranti<99999999999.99){var g=_.filter(u.listeEnCoursPersonneConvention,function(e){return e.identifiantPersonneEstAssure===r.identifiantPersonne&&e.identifiantConvention===s.identifiantConvention}),C=_.reduce(g,function(e,t){return e+(t.montantMaximumEncoursGaranti||0)},0);if(C>s.montantMaximumEncoursGaranti)return!1}return!0},u.prototype.getListeAccessoire=function(e,t,i,a,o,s,u,c,l,d){var m=this,h=this.getListeAccessoiresActif(e,i,a,o,s,u,c,d);if(this._isChangementProduit&&!_.isEmpty(t)&&t.length>h.length)for(var p=function(e){e.numeroPhase>1&&(_.some(h,function(t){return t.numeroPhase===e.numeroPhase})||h.push(n.AccessoireConventionBuilder.getAccessoireConvention(_.find(h,function(e){return 2===e.numeroPhase}),e.numeroPhase,_.find(t,function(t){return t.numeroPhase===e.numeroPhase}))))},f=0,A=d;f<A.length;f++){var P=A[f];p(P)}var v=0;return _.map(h,function(e){return new n.AccessoireAssurance(v++,m.idIhm,e,_.find(t,function(t){return e.numeroPhase===t.numeroPhase}),a,r.findOrEmpty(m._creditInfos.phases,function(t){return t.numeroPhase===e.numeroPhase}).periodiciteCalculInterets,l,m._isChangementProduit)})},u.prototype.getListeAccessoiresActif=function(e,t,n,a,o,u,c,l){return _.filter(t,function(t){if(t.numeroPhase<e)return!1;if(t.numeroPhase===e){var d=r.findOrEmpty(l||[],function(e){return e.numeroPhase===t.numeroPhase});if(!_.isEmpty(d)&&"N"===d.elementModifiableParAvenant)return!1}if(i.isBefore(o,t.dateDebutApplication)||i.isAfter(o,t.dateFinApplication))return!1;if("AG"===n){var m=moment(u).diff(moment(c),"years");return m<t.ageMaximumEntreeAssurance}if("PE"===n){var h=t.dureeApplicationAccessoire*s.getPeriodiciteMensuelle(t.uniteDureeApplicAccess,1),p=moment(a).add(h,"month").toDate();return i.isBefore(o,p)}return!0})},u.prototype.getListeComposantes=function(e,t,i,r){var a=this;return void 0===r&&(r=null),_.map(e,function(e,o){var s=a.getLibelleTypeSinistre(i,e.typeComposante);return e.identifiantAssurance?n.Composante.buildDefault(e,t,s):n.Composante.buildVirgin(e,t,s,r,o+1)})},u.prototype.getLibelleTypeSinistre=function(e,t){var n=_.find(e||[],function(e){return t===e.codeTypeSinistre});return(n||{}).libelleTypeSinistre},u.prototype.resetDataPersonne=function(){this.compagnieSelected=null,this.resetDataCompagnie()},u.prototype.resetDataCompagnie=function(){this._conventionSelected=null,this.resetDataConvention()},u.prototype.resetDataConvention=function(){this.reserveSelected=null,this.quotite=null,this.montant=null,this.risque=null,this.libelleAssuranceExterne=null,this.beneficiaireAvantVersement=this.etatManipulation===t.Enum.EtatManipulation.IsCreation?"Assuré à défaut les ayants droit":null,this.refExterne=null,this.motifDeliaison=null,this.listeAccessoire=[],this.codeGrilleTarifaire=null},u.prototype.setDataWithNewConvention=function(t){if(this.listeAccessoire=this.getListeAccessoire(this._isChangementProduit?2:this._creditInfos.numeroPhase,[],t.listeAccessoireParConvention,t.codeTypeAccessoireConvention,new Date,this._dateEffet,this._dateTraitement,this.personneSelected.dateNaissance,this._devise,this._phaseModifiables),this.isAvenantPeriodicite&&this.isPhaseEnCoursPeriodiciteScinde)for(var r=0,a=this.listeAccessoire;r<a.length;r++){var o=a[r];o.numeroPhase+=1,o.titreNumPhase="Phase "+o.numeroPhase}this.setDataWithConvention(t),this.setExtensionPersonnesAgees(this.showExtensionPersonnesAgees),this._datePriseEnCharge=this._dateEffet,this._dateFinPriseEnCharge=this.getDateFinPriseCharge(this.personneSelected.estPersonnePhysique,t.ageMaximumCouvertureAssurance,t.ageMaximumCouvertureEnExtension,this.extensionPersonnesAgees,this.personneSelected.dateNaissance),this.motifDeliaison=this.showMotifDeliaison?n.AssuranceHelper.getMotifDeliaison(this.compagnieSelected.isCompagnieExterne,this._dateTraitement,i.parse(this._creditInfos.dateMiseRecouvrementZero)):e.Commun.Enum.MotifDeliaisonAssurance.aucun,this.typeAssurance=this.getTypeAssuranceCreation(t)},u.prototype.setDataWithConvention=function(e){this.setShowLibelleAssuranceExterne(e),this.setAssuranceExterne(e),this.setModeCalculByQuotite(e),this.setLibelleHelpQuotite(e),this.setModeCalculByMontant(e),this.setLibelleHelpMontant(e),this.setShowExtensionPersonnesAgees(this.personneSelected,e)},u.prototype.setModeCalculByQuotite=function(e){this._modeCalculByQuotite=!(!e||"Q"!==e.codeModeExpressionGaranAccordee)},u.prototype.setLibelleHelpQuotite=function(e){this._libelleHelpQuotite="["+e.quotiteMinimumParBeneficiaire+".."+e.quotiteMaximumParBeneficiaire+"; "+e.pasQuotiteParBeneficiaire+"]"},u.prototype.setModeCalculByMontant=function(e){this._modeCalculByMontant=!(!e||!_.contains(["M","K"],e.codeModeExpressionGaranAccordee))},u.prototype.setLibelleHelpMontant=function(e){this._libelleHelpMontant="["+e.montantMinimumGarantiParTete+".."+e.montantMaximumGarantiParTete+"; "+e.pasMontantGarantiParTete+"]"},u.prototype.setShowLibelleAssuranceExterne=function(e){this._showLibelleAssuranceExterne=!(!e||!e.autoriseLibelleIntervenantExterne)},u.prototype.setAssuranceExterne=function(e){this._isAssuranceExterne=e&&e.estExterne,this.showMotifDeliaison=this.showMotifDeliaison||this.isNewAssuranceExterne,this._isShowCout8Ans=this.getShowCout8Ans()},u.prototype.setShowExtensionPersonnesAgees=function(e,t){null!=e&&null!=t?this._showExtensionPersonnesAgees=e.estPersonnePhysique&&t.autoriseExtensionPersonneAgee&&999!==t.ageMaximumCouvertureAssurance&&moment(this._dateFinCredit).diff(moment(e.dateNaissance),"years")>t.ageMaximumCouvertureAssurance:this._showExtensionPersonnesAgees=!1},u.prototype.setExtensionPersonnesAgees=function(e){this._extensionPersonnesAgees=e,_.forEach(this.listeAccessoire||[],function(t){return t.setListeTauxChoix(e)}),this.risque=null,this.setDataListeRisque(e)},u.prototype.setDataListeRisque=function(t){t?(this._dataListeRisque=[e.Commun.Enum.RisqueAssurance.extensionVieux],this.risque=e.Commun.Enum.RisqueAssurance.extensionVieux):this._dataListeRisque=[e.Commun.Enum.RisqueAssurance.risqueSimple,e.Commun.Enum.RisqueAssurance.risqueAggrave]},u}();n.Assurance=u}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(e,t,n,i,r,a,o,s,u){this.identifiantAssurance=e,this.numeroRelatif=t,this.dateDebut=n,this.dateFin=i,this.type=r,this.estRetenue=a,this.taux=o,this.montant=s,this._codeComposanteOptionnelle=u}return Object.defineProperty(t.prototype,"estDeces",{get:function(){return this.type&&this.type.estDeces},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"estPerteEmploi",{get:function(){return this.type&&this.type.estPerteEmploi},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"estSocle",{get:function(){return"N"===this._codeComposanteOptionnelle},enumerable:!0,configurable:!0}),t.prototype.transformToComposanteAssurance=function(e){return{codeEtablissement:e.codeEtablissement,identifiantAssurance:this.identifiantAssurance,identifiantCredit:e.idCredit,numeroRelatif:this.numeroRelatif,dateDebutComposante:this.dateDebut,dateFinComposante:this.dateFin,typeComposante:this.type&&this.type.code||"",codeComposanteOptionnelle:this._codeComposanteOptionnelle,indicateurComposanteRetenue:this.estRetenue,tauxComposante:this.taux,montantComposante:this.montant}},t.buildDefault=function(e,n,r){return new t(e.identifiantAssurance,e.numeroRelatif,e.dateDebutComposante,e.dateFinComposante||n,new i(e.typeComposante,r),e.indicateurComposanteRetenue,e.tauxComposante,e.montantComposante,e.codeComposanteOptionnelle)},t.buildVirgin=function(n,r,a,o,s){var u=new i(n.typeComposante,a);return new t(o,s,moment().format(e.Commun.Constantes.Format.DATE_REST),r,u,!0,n.tauxComposante,n.montantComposante,"N")},t}();t.Composante=n;var i=function(){function t(e,t){this.code=e,this.libelle=t}return Object.defineProperty(t.prototype,"estDeces",{get:function(){return e.Commun.Constantes.Donnees.codeTypeComposanteDeces===this.code},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"estPerteEmploi",{get:function(){return e.Commun.Constantes.Donnees.codeTypeComposantePerteEmploi===this.code},enumerable:!0,configurable:!0}),t}();t.TypeComposante=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.Assurance,i=function(){function e(e,t){this.idConvention=e.identifiantConvention,this.libelleLongConvention=e.libelleCourtTypeAssurance+" - "+e.libelleLongConvention+" - "+e.numeroExterneConvention+" - "+e.identifiantConvention,this.codeTypeAccessoireConvention=e.codeTypeAccessoireConvention,this.codeModeExpressionGaranAccordee=e.cdModeExpressionGaranAccordee,this.ageMaximumCouvertureAssurance=e.ageMaximumCouvertureAssurance,this.ageMaximumCouvertureEnExtension=e.ageMaximumCouvertureEnExtension,this.quotiteMinimumParBeneficiaire=e.quotiteMinimumParBeneficiaire,this.quotiteMaximumParBeneficiaire=e.quotiteMaximumParBeneficiaire,this.pasQuotiteParBeneficiaire=e.pasQuotiteParBeneficiaire,this.montantMinimumGarantiParTete=e.montantMinimumGarantiParTete,this.montantMaximumGarantiParTete=e.montantMaximumGarantiParTete,this.pasMontantGarantiParTete=e.pasMontantGarantiParTete,this.autoriseExtensionPersonneAgee="O"===e.cdPossibiliteExtensionCouv,this.autoriseLibelleIntervenantExterne="N"===e.cdCommissionIntervenantExterne,this.estExterne="EX"===e.codeIdentificationConventionJur,this.estPerteEmploi=n.estCodeTypeAssurancePerteEmploi(e.codeTypeAssurance),this.estLoiLemoine202311=n.estCodeTypeAssuranceLoiLemoine202311(e.codeTypeAssurance),this.estGereeEnComposantes="Q1"===e.codeIdentificationConventionJur,this.listeAccessoireParConvention=this.getListeAccessoireParConvention(t,e.identifiantConvention)}return e.prototype.getListeAccessoireParConvention=function(e,t){var n=_.filter(e,function(e){return e.identifiantConvention===t}),i=_.filter(n,function(e){return"E"===e.indicateurBanalise||!(null!=_.find(n,function(e){return"E"===e.indicateurBanalise}))});return _.sortByOrder(i,function(e){return e.numeroPhase},!0)},e}();t.ConventionApplicable=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.FonctionsAvenant,i=e.Commun.Tools.List,r=function(){function t(t,n,i,r,a,o){this.codeTypeAcces=t,this.isModeConsultationModification=t===e.Commun.Enum.CodeTypeAcces.Lecture||t===e.Commun.Enum.CodeTypeAcces.Modification,this.isAteCree=t===e.Commun.Enum.CodeTypeAcces.Creation?!1:!0,this.isAteInit=!0,this.echeanceAmenagees=t===e.Commun.Enum.CodeTypeAcces.Creation?0:this.getCodeTypeEchAmenageeModif(_.first(r.echeancesAmenagees).codeTypeEcheanceAmenagee),this.nouvelleEcheance=t===e.Commun.Enum.CodeTypeAcces.Creation?null:_.first(r.echeancesAmenagees).montantRemboursementSaisi,this.paimentInteretReportes=t===e.Commun.Enum.CodeTypeAcces.Creation?0:this.getCodeTypeCalculInteretsModif(_.first(r.echeancesAmenagees).codeTypeCalculInterets),this.impactTa=t===e.Commun.Enum.CodeTypeAcces.Creation?1:this.getImpactTaModif(_.first(r.echeancesAmenagees).nouvelleDureeResiduelle),this.dureeResiduelle=n.dureeResteAFinancer,this.nouvelleDureeResiduelle=n.dureeResteAFinancer,this.montantRemboursementSaisi=0,this.dureeResteAFinancer=n.dureeResteAFinancer,this.periodiciteCalculInterets=this.getPeriodiciteCalculInterets(n),this.getValidCreationAte=this.controleCreationAte(n,i,r,a,o),this.getValidCreationAte?(this.nbPeriodesMiniLAmenagement=0,this.nbPeriodesMaxiLAmenagement=0):(this.nbPeriodesMiniLAmenagement=_.first(this.getPeriodesMinMaxLAmenagement(i,n)),this.nbPeriodesMaxiLAmenagement=_.last(this.getPeriodesMinMaxLAmenagement(i,n))),this.echeancesReportees=t===e.Commun.Enum.CodeTypeAcces.Creation?this.nbPeriodesMiniLAmenagement:_.first(r.echeancesAmenagees).nombreEcheancesReportees,this.libelleHelpNbPeriodes="["+this.nbPeriodesMiniLAmenagement+" ... "+this.nbPeriodesMaxiLAmenagement+"]",
this.messagesErreurNbrEcheances=[],this.messageErreurNouvelleEcheance="",this.uniteDureePhase=this.getUniteDureePhase(n),this.montantInteretsOrdreMiseRecouvrement=n.mntInteretsOrdreMiseRecouvrmnt,this.uniteDureeCredit=n.uniteDureeCredit,this.messageErreurNouvelleDureeResiduelle="",this.dureeCredit=this.getDureeCredit(n),this.dateFinCredit=this.getDateFinCredit(n)}return t.prototype.getCodeTypeEchAmenagee=function(){return 0===this.echeanceAmenagees?this.codeTypeEcheanceAmenagee="T":1===this.echeanceAmenagees?this.codeTypeEcheanceAmenagee="P":2===this.echeanceAmenagees&&(this.codeTypeEcheanceAmenagee="N"),this.codeTypeEcheanceAmenagee},t.prototype.getCodeTypeEchAmenageeModif=function(e){return"T"===e?0:"P"===e?1:"N"===e?2:void 0},t.prototype.getMontantRemboursementSaisi=function(){return 0===this.echeanceAmenagees?this.montantRemboursementSaisi=0:1===this.echeanceAmenagees?this.montantRemboursementSaisi=0:2===this.echeanceAmenagees&&(this.montantRemboursementSaisi=this.nouvelleEcheance),this.montantRemboursementSaisi},t.prototype.getCodeTypeCalculInterets=function(){return 0===this.echeanceAmenagees?0===this.paimentInteretReportes?this.codeTypeCalculInterets="C":1===this.paimentInteretReportes&&(this.codeTypeCalculInterets="P"):this.codeTypeCalculInterets="",this.codeTypeCalculInterets},t.prototype.getCodeTypeCalculInteretsModif=function(e){return"C"===e?0:"P"===e?1:void 0},t.prototype.getNouvelleDureeResiduelle=function(){switch(this.impactTa){case 0:return 0;case 1:return this.nouvelleDureeResiduelle;case 2:return 0}},t.prototype.getCodeTypeRecalculTA=function(){switch(this.impactTa){case 0:return"D";case 1:return"1";case 2:return"E"}},t.prototype.getImpactTaModif=function(e){return e>0?1:0},t.prototype.getPeriodiciteCalculInterets=function(e){var t="";return null==e||_.isEmpty(e)||e.phases.forEach(function(n){e.numeroPhase===n.numeroPhase&&(t=n.periodiciteCalculInterets)}),t},t.prototype.controleCreationAte=function(t,n,r,a,o){var s=[];if(a)s.push(!0);else if(_.some(o,function(e){return e.isDureePhaseAbsorbee}))s.push(!0);else{var u=null!=t?i.findOrEmpty(t.phases,function(e){return e.numeroPhase===t.numeroPhase}):{},c=null==n||_.isEmpty(u)?{}:i.findOrEmpty(n.phases,function(e){return e.codeTypePhase===u.codeTypePhase&&e.noRelatifPhaseTypePhaseProduit===u.noRelatifPhaseTypePhaseProduit});if(!_.isEmpty(u)&&!_.isEmpty(c)){for(var l=_.first(c.amenagementsEcheances),d=!1,m=!1,h=!1,p=!1,f=0,A=t.accessoires;f<A.length;f++){var P=A[f];"21"===P.codeNatureAccessoire&&"A"!==P.codeActionEcranListe&&1===P.noRelatifPhaseTypePhaseProduit&&u.numeroPhase===t.numeroPhase&&(d=!0,null!=P.dateDebutApplicationElement&&(m=!0))}null!=l&&"O"===t.amenagementEchsurPretCombine&&"AM"===t.codeTypePhase&&u.numeroPhase===t.numeroPhase&&(h=!0);for(var v=0,g=u.paliersTauxInterets;v<g.length;v++){var C=g[v];"9"===C.typeRemboursement&&(p=!0)}d||h||p?s.push(!1):s.push(!0)}null!=r&&(null==r.echeancesAmenagees||this.codeTypeAcces!==e.Commun.Enum.CodeTypeAcces.Creation&&this.codeTypeAcces!==e.Commun.Enum.CodeTypeAcces.Lecture?null!=r.echeancesAmenagees&&this.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Modification?s.push(!1):s.push(!1):s.push(!0))}return s.some(function(e){return e===!0})},t.prototype.getPeriodesMinMaxLAmenagement=function(e,t){var n=null!==t?i.findOrEmpty(t.phases,function(e){return e.numeroPhase===t.numeroPhase}):{};if(!_.isEmpty(n)){var r=null!==e?i.findOrEmpty(e.phases,function(e){return e.codeTypePhase===n.codeTypePhase&&e.noRelatifPhaseTypePhaseProduit===n.noRelatifPhaseTypePhaseProduit}):{};if(!_.isEmpty(r)){var a=i.firstOrEmpty(r.amenagementsEcheances);if(!_.isEmpty(a))return[a.nbPeriodesMiniLAmenagement,a.nbPeriodesMaxiLAmenagement]}}return[0,0]},t.prototype.getUniteDureePhase=function(e){var t=null!=e?i.findOrEmpty(e.phases,function(t){return t.numeroPhase===e.numeroPhase}):{};return _.isEmpty(t)?"":t.uniteDureePhase},t.prototype.controleNombreEcheances=function(){this.messagesErreurNbrEcheances.splice(0,this.messagesErreurNbrEcheances.length),(this.echeancesReportees<this.nbPeriodesMiniLAmenagement||this.echeancesReportees>this.nbPeriodesMaxiLAmenagement)&&this.messagesErreurNbrEcheances.push("Nombre d'échéances à reporter hors des bornes catalogues ["+this.nbPeriodesMiniLAmenagement+" "+this.nbPeriodesMaxiLAmenagement+"]."),n.simulConvDuree(this.periodiciteCalculInterets,this.echeancesReportees,"M",365)>=this.dureeResteAFinancer&&this.messagesErreurNbrEcheances.push("Nombre d'échéances à reporter est supérieur ou égal à la durée résiduelle ["+this.dureeResteAFinancer+" mois]."),n.simulConvDuree(this.periodiciteCalculInterets,this.echeancesReportees,"M",365)%n.simulConvDuree(this.uniteDureePhase,1,"M",365)&&this.messagesErreurNbrEcheances.push("Nombre d'échéances de l''aménagement incompatible avec la périodicité de la phase.")},t.prototype.isErreurNbrEcheances=function(){return this.messagesErreurNbrEcheances.length>0},t.prototype.controleNouvelleEcheance=function(){this.nouvelleEcheance<this.montantInteretsOrdreMiseRecouvrement?this.messageErreurNouvelleEcheance="Le montant de la nouvelle échéance doit être supérieur au montant des intérêts.":this.messageErreurNouvelleEcheance=""},t.prototype.isErreurNouvelleEcheance=function(){return""!==this.messageErreurNouvelleEcheance},t.prototype.controleNouvelleDureeResiduelle=function(){var e=this.nouvelleDureeResiduelle-this.dureeResteAFinancer;e%n.simulConvDuree(this.uniteDureeCredit,1,"M",365)!==0?this.messageErreurNouvelleDureeResiduelle="Nouvelle durée résiduelle incompatible avec la périodicité crédit.":this.messageErreurNouvelleDureeResiduelle=""},t.prototype.isErreurNouvelleDureeResiduelle=function(){return""!==this.messageErreurNouvelleDureeResiduelle},t.prototype.isErreurChampsPopin=function(){return this.isErreurNbrEcheances()||this.isErreurNouvelleEcheance()||this.isErreurNouvelleDureeResiduelle()},t.prototype.getDureeCredit=function(e){var t;if(1===this.impactTa){var i=this.nouvelleDureeResiduelle-e.dureeResteAFinancer;t=e.dureeAjusteeCreditSuiteRecalcul+n.simulConvDuree("M",i,e.uniteDureeCredit,365)}else t=e.dureeAjusteeCreditSuiteRecalcul;return t},t.prototype.getDateFinCredit=function(t){if(1===this.impactTa){var n=this.nouvelleDureeResiduelle-t.dureeResteAFinancer;return moment(t.dateFinCredit,e.Commun.Constantes.Format.DATE_REST).add(n,"M").toDate()}return moment(t.dateFinCredit,e.Commun.Constantes.Format.DATE_REST).toDate()},t}();t.Ate=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.sommeDureePhaseOrigine=function(e,t){for(var n=0,i=0,r=e;i<r.length;i++){var a=r[i];"PF"!==a.codeTypePhase&&a.numeroPhase>t.numeroPhase&&(n+=a.dureeInitialePhaseCredit)}return n},e.ajustementDureePhase=function(e,t,n,i,r){var a=angular.copy(e),o=n-i,s=this.getNombrePhaseAMOrigine(t,r),u=e.length-1,c=s>u,l=s===u,d=r-2;if(c||l)for(var m=this.normalisationPhase(t,d),h=function(e){if(2===a[e].numeroPhase)a[e].dureeInitialePhaseCredit=2===a.length?n:o;else if(a[e].numeroPhase>2)if(e===a.length-1){for(var t=0,i=0,r=m;i<r.length;i++){var s=r[i];"AM"===s.codeTypePhase&&s.numeroPhase>=a[e].numeroPhase&&(t+=s.dureeInitialePhaseCredit)}a[e].dureeInitialePhaseCredit=t}else a[e].dureeInitialePhaseCredit=_.find(m,function(t){return t.numeroPhase===a[e].numeroPhase&&"AM"===t.codeTypePhase}).dureeInitialePhaseCredit},p=1;p<a.length;p++)h(p);return a},e.normalisationPhase=function(e,t){for(var n=[],i=0,r=e;i<r.length;i++){var a=r[i],o=angular.copy(a);o.numeroPhase-=t,n.push(o)}return n},e.getNombrePhaseAMOrigine=function(e,t){var n=0;if(null!=e)for(var i=0,r=e;i<r.length;i++){var a=r[i];"AM"===a.codeTypePhase&&a.numeroPhase>=t&&(n+=1)}return n},e}();e.CalculDureeChInit=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.PeriodiciteHelper,i=function(){function e(){}return e.getReductionMaxDuree=function(e,t){var i="";if(null!=e&&e.length>0){var r=_.find(e,function(e){return"M"===e.cdTypeButoirDuree});i=angular.isDefined(r)?""+r.nbPeriodeReductionDureeCredit+" "+n.getLibellePeriodeBase(t):"Non définie"}return i},e.getTraitementEcheanceDureeProduit=function(e){var t="";if(null!=e&&e.length>0){for(var n=null,i=0,r=0,a=e;r<a.length;r++){var o=a[r];"AM"===o.codeTypePhase&&(0===i?(i=o.noRelatifPhaseTypePhaseProduit,n=angular.copy(o)):i<o.noRelatifPhaseTypePhaseProduit&&(i=o.noRelatifPhaseTypePhaseProduit,n=angular.copy(o)))}null!==n&&(t=this.getLibelleEcheanceProduit(n.codeTypeTraitementEcheance))}return t},e.getLibelleEcheanceProduit=function(e){switch(e){case"1":return"Maintien de l'échéance en cours";case"2":return"Passage du montant de l'échéance maximum du TA";case"":return"Sans objet";default:return""}},e.getMotifCondition=function(e){var t="",n="";if(null!=e&&e.length>0)for(var i=0,r=e;i<r.length;i++){var a=r[i];t="M"===a.cdTypeButoirDuree?"Modulation ou prise d'option":"C"===a.cdTypeButoirDuree?"Sortie de compte courant":"R"===a.cdTypeButoirDuree?"Révision hors jeu d'indice":"",n=a.libelleStandard}return[t,n]},e.getDureeBornePourcentage=function(e,t){var n=[0,0],i=0,r=0;if(null!=e&&null!=t&&!_.isEmpty(t)&&e.length>0)for(var a=0,o=e;a<o.length;a++){var s=o[a];n=this.getBornes(t.dureeCredit,s.regleDeterminationDAllong,s.nbPerminiAllongementCredit,s.nbPermaxiAllongementCredit,s.nbPeriodeAllongementDureeCredit,s.prCentAllongDureeCredit),i="M"===s.cdTypeButoirDuree?t.nbMaxiPerallongPourModulation:"C"===s.cdTypeButoirDuree?t.nbMaxiPerallsortieCptCourant:"R"===s.cdTypeButoirDuree?t.nbMaxiPeriodeAllongPourRevision:999,r=s.prCentAllongDureeCredit}return[i,n[0],n[1],r]},e.getBornes=function(e,t,n,i,r,a){var o=a*e/100,s=0,u=0;switch(t){case"X01":return[n,i];case"X02":return[r,r];case"X03":return[o,o];case"X04":o>r&&(s=r),r>o&&(u=r)}return[s,u]},e}();t.ConditionsVariationDureeProduit=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.FonctionsAvenant,i=e.Commun.ToolsFunctionals.Taux,r=function(){function e(){}return e.prototype.getCreditInitChangePdt=function(e,n,r,a,o,s,u,c,l){var d=angular.copy(n);d.numeroPhase=2,d.montantEcheanceMER=0,d.cdTypeArrieresIncorporeCrd="",d.montantArrieresIncorporesCrd=0,d.montantIntcompsurCR=0,d.codeTraitementFinVersement="O",d.codeTypeRecalculTA="1",d.codeRoleCreditAvenant=null===r.codeFamilleProduit1&&null===r.numeroRelatifProduit1?"U":"P",d.uniteDureeCredit=a.uniteDureeCredit;var m=t.FonctionsChPourInit.getDureeCredit(d.uniteDureeCredit,n,a);d.dureeAjusteeCreditSuiteRecalcul=m[0],d.dureeCredit=m[1],d.codeTauxCreditDirecteur=a.codeTauxCreditDirecteur,d.codeCristallisationTauxInteret="N",d.numModaliteRemboursemntAnticipe=0,d.tauxIndemniteRA=0,d.dateFinPrefinancementReelle=null,d.tauxInteretPrefinancement=0,d.identifiantProduit=r.codeFamilleProduit+r.numeroRelatifProduit,d.libelleLongProduit=r.libelle1erProduitProfil,d.identifiantProfilRenegociation=r.identifiantProfilRenegociation,d.montantFraisGestion=0,d.codeIntegrationFraisCrd="N",d.codeTypeModificationCredit="PR",d.codeCreditSecurisable="N",d.codePresenceRevisionSurCredit="N",d.nbMaxiPerallsortieCptCourant=999,d.codeActionPourMiseAJour="C",d.dateEffetInitialeLAvenant=null,d.dateDecisionEmission=null,d.dateSignature=null,d.codeTypePretCombine=a.codeTypePretCombine,d.numeroRelatif=0,d.numeroRelatifSimulationAvenant=0;var h=this.getNbMaxiPeriodeRevisionModulation(a,d.dureeCredit,d.nbMaxiPerallsortieCptCourant);d.nbMaxiPeriodeAllongPourRevision=h[0],d.nbMaxiPerallongPourModulation=h[1],d.nbMaxiPerallsortieCptCourant=h[2];var p=t.FonctionsChPourInit.getConditionTauxProduitPourCredit(a.conditionsTauxProduit,e,d.identifiantProduit,d.dureeAjusteeCreditSuiteRecalcul);if(d.codeModeExpressionTaux=p.codeModeExpressionTaux,"O"!==d.codeTauxCreditDirecteur&&(d.tauxNominalCredit=0,d.margeAppliquerSurTauxNominal=0,d.codeIndiceNominal=""),"O"===d.codeTauxCreditDirecteur){var f=0,A="";if("3"===d.codeModeExpressionTaux||"4"===d.codeModeExpressionTaux){var P=void 0;if("INDX"===p.codeIndice||"4"===d.codeModeExpressionTaux){if(A=t.FonctionsChPourInit.getAncienCodeIndiceNominal(o,s),P=t.FonctionsChPourInit.getParametreRevision(d.identifiantProduit,e,A,a.codeProduitRevisable,a.phases,"AM",1),angular.isDefined(P)){switch(d.codeModeExpressionTaux){case"3":d.codeIndiceNominal=P.codeIndice;break;case"4":d.codeIndiceNominal=""}f="M"===P.mdExpressionValeurUtilisIndice&&angular.isDefined(o)?i.roundDecimal(o.partieFixeUnTauxComposite,4):0}}else d.codeIndiceNominal=p.codeIndice;d.margeAppliquerSurTauxNominal=t.FonctionsChPourInit.miseAJourMarge(A,d.codeModeExpressionTaux,p,s,u,c),d.tauxNominalCredit=t.FonctionsChPourInit.miseAJourTaux(d.identifiantProduit,d.codeModeExpressionTaux,l,s.tauxInteretPalier,p,angular.isDefined(P)?[P]:[],f,d.margeAppliquerSurTauxNominal,d.codeIndiceNominal,c.codeModeCalculTaux,u.codeModeCalculTaux,e,"AM",1)}"2"===d.codeModeExpressionTaux&&(d.codeIndiceNominal="",d.margeAppliquerSurTauxNominal=0,s.tauxInteretPalier<p.tauxMoyenMinimumCredit||s.tauxInteretPalier>p.tauxMoyenMaximumCredit||c.codeModeCalculTaux!==u.codeModeCalculTaux?0!==p.tauxMoyenConseilleCredit?d.tauxNominalCredit=i.roundDecimal(p.tauxMoyenConseilleCredit,4):s.tauxInteretPalier<p.tauxMoyenMinimumCredit?d.tauxNominalCredit=i.roundDecimal(p.tauxMoyenMinimumCredit,4):d.tauxNominalCredit=i.roundDecimal(p.tauxMoyenMaximumCredit,4):d.tauxNominalCredit=i.roundDecimal(s.tauxInteretPalier,4))}return d},e.prototype.getNbMaxiPeriodeRevisionModulationInit=function(e){var t=[999,999];if(e.phases.length>0){var i=_.last(_.filter(e.phases,function(e){return"AM"===e.codeTypePhase}));if(0===i.nbrMaximumPeriodeVariationDuree)t[0]=0,t[1]=0;else if(i.nbrMaximumPeriodeVariationDuree>=999)t[0]=999,t[1]=999;else{var r=n.simulConvDuree(e.uniteDureeCredit,1,"M",365),a=n.simulConvDuree(i.uniteDureePhase,1,"M",365),o=Math.round(i.nbrMaximumPeriodeVariationDuree*a/r);o>=999?(t[0]=999,t[1]=999):(t[0]=o,t[1]=o)}}return t},e.prototype.getNbMaxiPeriodeRevisionModulation=function(e,t,n){var i=this.getNbMaxiPeriodeRevisionModulationInit(e),r=[i[0],i[1],n];if(e.variationsDureeProduit.length>0)for(var a=0,o=e.variationsDureeProduit;a<o.length;a++){var s=o[a];if(s.dureeMinimumPlageConditionTaux<=t&&s.dureeMaximumPlageConditionTaux>=t){var u=this.calculBorne(s,t);"M"===s.cdTypeButoirDuree&&"X01"!==s.regleDeterminationDAllong&&(r[1]=u[0]),"C"===s.cdTypeButoirDuree&&"X01"!==s.regleDeterminationDAllong&&(r[2]=u[0]),"R"===s.cdTypeButoirDuree&&"X01"!==s.regleDeterminationDAllong&&(r[0]=u[0])}}return r},e.prototype.calculBorne=function(e,t){var n=[0,0];switch(e.regleDeterminationDAllong){case"X01":return n[0]=e.nbPerminiAllongementCredit,n[1]=e.nbPermaxiAllongementCredit,n;case"X02":return n[0]=e.nbPeriodeAllongementDureeCredit,n[1]=e.nbPeriodeAllongementDureeCredit,n;case"X03":return n[0]=e.prCentAllongDureeCredit*t/100,n[1]=e.prCentAllongDureeCredit*t/100,n;case"X04":return n[0]=e.prCentAllongDureeCredit*t/100,n[1]=e.prCentAllongDureeCredit*t/100,e.nbPeriodeAllongementDureeCredit<n[0]&&(n[0]=e.nbPeriodeAllongementDureeCredit),e.nbPermaxiAllongementCredit>n[1]&&(n[1]=e.nbPeriodeAllongementDureeCredit),n;default:return n}},e}();t.CreditChInit=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.FonctionsAvenant,i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.List,a=function(){function e(){}return e.prototype.getCreditChangementProduit=function(e,n,i,r,a,o,s,u,c){return n?i?null!=s&&null!=o?this.getCreditChangePdt(e,a,o,s,u,c):null:new t.CreditCaraFinanAdapter(r,a,n):null},e.prototype.getCreditChangePdt=function(e,n,i,r,a,o){var s=t.FonctionsChPourInit.getPhaseEnCoursCreditOrigine(n),u=t.FonctionsChPourInit.getPalierOrigineEnCours(n,s),c=t.FonctionsChPourInit.getPhaseProduitOrigineEnCours(a.phases,s),l=t.FonctionsChPourInit.getPremierePhaseAMProduit(r.phases),d=(new t.CreditChInit).getCreditInitChangePdt(e,n,i,r,s,u,c,l,o),m=this.getPhasesByProduit(e,n,d,r,s,l,u,c,o),h=this.getPalierTauxInteretByProduit(d,r,m,s,u,c,o,e),p=this.getParametresRevisionTauxByProduit(m,r,e,d),f=this.getPalierTauxAmortissementByProduit(r,m,h);return m=this.miseAJourPhasesChangePdt(m,h,p,f),d=this.miseAJourCreditChangePdt(d,m)},e.prototype.miseAJourPhasesChangePdt=function(e,t,n,i){for(var r=angular.copy(e),a=0,o=r;a<o.length;a++){var s=o[a];if(t.length>0)for(var u=0,c=t;u<c.length;u++){var l=c[u];s.numeroPhase===l.numeroPhase&&s.paliersTauxInterets.push(l),s.numeroPhase>1&&1===l.numeroRelatif&&(s.tauxNominalPhase=l.tauxInteretPalier,s.codeIndiceNominal=l.codeIndice,s.margeAppliquerSurTaux=l.margeAppliquerSurTaux)}if(n.length>0)for(var d=0,m=n;d<m.length;d++){var h=m[d];s.numeroPhase===h.numeroPhase&&s.parametresRevisionTaux.push(h)}if(i.length>0)for(var p=0,f=i;p<f.length;p++){var A=f[p];s.numeroPhase===A.numeroPhase&&s.paliersTauxAmortissement.push(A)}}return r},e.prototype.miseAJourCreditChangePdt=function(e,t){var n=angular.copy(e);if(t.length>0){if(n.phases=t,"O"!==n.codeTauxCreditDirecteur){var i=r.findOrEmpty(t,function(e){return 1===e.noRelatifPhaseTypePhaseProduit&&e.numeroPhase>1});_.isEmpty(i)||(n.tauxNominalCredit=i.tauxNominalPhase,n.codeIndiceNominal=i.codeIndiceNominal,n.margeAppliquerSurTauxNominal=i.margeAppliquerSurTaux)}}else n.phases=[];return n},e.prototype.getPhasesByProduit=function(e,n,i,r,a,s,u,c,l){var d=angular.copy(r.phases),m=_.sortBy(d,function(e){return e.noRelatifPhaseTypePhaseProduit}),h=1,p=[],f=[],A=[],P=[],v=t.FonctionsChPourInit.getConditionTauxProduitPourCredit(r.conditionsTauxProduit,e,i.identifiantProduit,i.dureeAjusteeCreditSuiteRecalcul);p.push(new t.PhaseChInit(null,i,h,a,s,0,r.codeTypePretCombine,u,null,c,r,e,l)),f.push(new o(h,p[0],null));for(var g=0,C=m;g<C.length;g++){var E=C[g];"AM"===E.codeTypePhase&&f.push(new o(2,null,E))}A=this.getDureeChgtProduit(i.uniteDureeCredit,i.dureeAjusteeCreditSuiteRecalcul,f),P=_.map(A,function(e){return e.dureeCalculee});for(var b=0,T=m;b<T.length;b++){var E=T[b];"AM"===E.codeTypePhase&&(h+=1,p.push(new t.PhaseChInit(E,i,h,a,s,P[h-1],r.codeTypePretCombine,u,v,c,r,e,l)))}var y=t.CalculDureeChInit.sommeDureePhaseOrigine(n.phases,a);return p=t.CalculDureeChInit.ajustementDureePhase(p,n.phases,n.dureeResteAFinancer,y,a.numeroPhase)},e.prototype.getPalierTauxInteretByProduit=function(e,n,i,r,a,o,u,c){var l=[],d=1,m=[],h=[],p=0,f=t.FonctionsChPourInit.getConditionTauxProduitPourCredit(n.conditionsTauxProduit,c,e.identifiantProduit,e.dureeAjusteeCreditSuiteRecalcul);l.push(new t.PalierTauxInteretChInit(e,_.find(i,function(e){return 1===e.numeroPhase}),a,d,null,null,!0,0,f,o,null,c,u,r)),d+=1,p=l[0].numeroDerniereEcheancePalier;for(var A=1,P=[],v=1;v<i.length;v++){d=0,A=1,P=[],m=[];for(var g=0,C=n.phases;g<C.length;g++){var E=C[g];if("AM"===E.codeTypePhase&&E.noRelatifPhaseTypePhaseProduit===i[v].noRelatifPhaseTypePhaseProduit)for(var b=0,T=E.paliers;b<T.length;b++){var y=T[b];P.push(y),m.push(new s(A,y,i[v])),A+=1}}h=this.getDureeChgtProduit(i[v].uniteDureePhase,i[v].dureeInitialePhaseCredit,m);for(var M=0;M<P.length;M++)d+=1,l.push(new t.PalierTauxInteretChInit(e,i[v],a,d,P[M],h[M],!1,p,f,o,n,c,u,r)),p=_.last(l).numeroDerniereEcheancePalier}return l},e.prototype.getParametresRevisionTauxByProduit=function(e,n,i,r){for(var a=[],o=function(e){if("AM"===e.codeTypePhase&&e.numeroPhase>1){var o=_.find(n.phases,function(t){return e.noRelatifPhaseTypePhaseProduit===t.noRelatifPhaseTypePhaseProduit&&"AM"===t.codeTypePhase}),u=s.getPremierParamRevTxPhaseEnCours(o.parametresRevision,i,e.codeTypePhase,e.noRelatifPhaseTypePhaseProduit,r.identifiantProduit),c=s.getParamRevPhaseEnCoursIndiceRevision(o.parametresRevision,i,e.codeTypePhase,e.noRelatifPhaseTypePhaseProduit,r.identifiantProduit);""!==o.identifiantLoiRevision&&null!==o.identifiantLoiRevision&&a.push(new t.ParametreRevisionTauxChInit(e,u,c))}},s=this,u=0,c=e;u<c.length;u++){var l=c[u];o(l)}return a},e.prototype.getPremierParamRevTxPhaseEnCours=function(e,t,n,r,a){for(var o,s=0,u=e;s<u.length;s++){var c=u[s];if(o=null!==c.dateDebutApplication?c.dateDebutApplication:"0000-00-00",c.codeFamilleProduit+c.numeroRelatifProduit===a&&c.codeTypePhase===n&&c.noRelatifPhaseTypePhaseProduit===r&&moment(o).isBefore(t)&&i.isBefore(t,c.dateFinApplication))return c}},e.prototype.getParamRevPhaseEnCoursIndiceRevision=function(e,t,n,r,a){for(var o,s=0,u=e;s<u.length;s++){var c=u[s];if(o=null!==c.dateDebutApplication?c.dateDebutApplication:"0000-00-00",c.codeFamilleProduit+c.numeroRelatifProduit===a&&c.codeTypePhase===n&&c.noRelatifPhaseTypePhaseProduit===r&&moment(o).isBefore(t)&&i.isBefore(t,c.dateFinApplication)&&0===c.numeroJeuIndicesRevision&&0===c.numeroPeriodeRevision)return c}},e.prototype.getPalierTauxAmortissementByProduit=function(e,i,r){var a=[],o=0,s=[],c=[],l=1,d=_.find(i,function(e){return 1===e.numeroPhase});("2"===d.modeCalculAmortissement||"7"===d.modeCalculAmortissement)&&a.push(new t.PalierTauxAmortissementChInit(d,!0,o,l,null,null,[])),o=d.dureeInitialePhaseCredit;for(var m=1,h=[],p=!1,f=function(d){p=!1,l=0,m=1,h=[],c=[];for(var f=0,P=e.phases;f<P.length;f++){var v=P[f];if(v.codeTypePhase===i[d].codeTypePhase&&v.noRelatifPhaseTypePhaseProduit===i[d].noRelatifPhaseTypePhaseProduit&&v.paliersProgressionAmortissement.length>0)for(var g=0,C=v.paliersProgressionAmortissement;g<C.length;g++){var E=C[g];h.push(E),c.push(new u(m,E,i[d])),m+=1}}if(h.length>0){s=A.getDureeChgtProduit(i[d].uniteDureePhase,i[d].dureeInitialePhaseCredit,c);for(var b=0;b<h.length;b++)l+=1,p=!0,a.push(new t.PalierTauxAmortissementChInit(i[d],!1,o,l,h[b],s[b],_.filter(r,function(e){return e.numeroPhase===i[d].numeroPhase}))),o=_.last(a).numeroDerniereEcheancePalier}if(!p){var T=n.simulConvDuree(i[d].uniteDureePhase,i[d].dureeInitialePhaseCredit,"M",365);o+=T%n.simulConvDuree(i[d].periodiciteCalculInterets,1,"M",365)===0?n.simulConvDuree(i[d].uniteDureePhase,i[d].dureeInitialePhaseCredit,i[d].periodiciteCalculInterets,365):1}},A=this,P=1;P<i.length;P++)f(P);return a},e.prototype.getDureeChgtProduit=function(e,t,i){for(var r=angular.copy(i),a=n.simulConvDuree(e,t,"M",365),o=0,s=0;s<r.length-1;s++)r[s].dureeCalculee<=0&&("2"===r[s].modeDuree&&r[s].duree3>0?r[s].dureeCalculee=r[s].duree3:r[s].dureeCalculee=r[s].duree1),o+=n.simulConvDuree(r[s].periodicite,r[s].dureeCalculee,"M",365);var u=a-o,c=_.last(r);return r[r.length-1].dureeCalculee=n.simulConvDuree("M",u,c.periodicite,365),r},e}();t.CreditInitBuilderChangePdt=a;var o=function(){function e(e,t,n){this.numero=e,1===e?(this.modeDuree="2",this.periodicite=t.uniteDureePhase,this.duree1=t.dureeInitialePhaseCredit,this.duree2=t.dureeInitialePhaseCredit,this.duree3=t.dureeInitialePhaseCredit,this.duree4=t.dureeInitialePhaseCredit,this.dureeCalculee=t.dureeInitialePhaseCredit):(this.modeDuree=n.modeExpressionDureePhase,this.periodicite=n.uniteDureePhase,this.duree1=n.dureePhaseProduit,this.duree2=n.dureePhaseProduit1,this.duree3=n.dureePhaseProduit2,this.duree4=n.dureeUnePhasePas,this.dureeCalculee=0)}return e}(),s=function(){function e(e,t,n){this.numero=e,this.modeDuree="2",this.periodicite=n.uniteDureePhase,this.duree1=t.dureeMiniPalierTaux,this.duree2=t.dureePalierTaux,this.duree3=0,this.duree4=t.dureePalierTaux1,this.dureeCalculee=0}return e}(),u=function(){function e(e,t,n){this.numero=e,this.modeDuree="2",this.periodicite=n.uniteDureePhase,this.duree1=t.dureeMiniPalierProgreAmort,this.duree2=t.dureeMaxiPalierProgreAmort,this.duree3=0,this.duree4=t.dureePalierProgreAmortisPas,this.dureeCalculee=0}return e}()}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=e.Commun.Tools.DateUtils,r=e.Commun.ToolsFunctionals.Taux,a=function(){function e(){}return e.getPhaseProduitOrigineEnCours=function(e,t){if(angular.isDefined(t)&&null!=t)for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r.codeTypePhase===t.codeTypePhase&&r.noRelatifPhaseTypePhaseProduit===t.noRelatifPhaseTypePhaseProduit)return r}return{}},e.getPremierePhaseAMProduit=function(e){return n.findOrEmpty(e,function(e){return"AM"===e.codeTypePhase&&1===e.noRelatifPhaseTypePhaseProduit})},e.getPalierOrigineEnCours=function(e,t){var i="AM"!==e.codeTypePhase?t.numeroPhase:e.numeroPhase,r="AM"!==e.codeTypePhase?1:e.numeroRelatif,a=n.findOrEmpty(e.phases,function(e){return e.numeroPhase===i});return n.findOrEmpty(a.paliersTauxInterets||[],function(e){return e.numeroRelatif===r})},e.getPhaseEnCoursCreditOrigine=function(e){return"AM"!==e.codeTypePhase?n.firstOrEmpty(_.filter(e.phases,function(e){return"AM"===e.codeTypePhase})):n.findOrEmpty(e.phases,function(t){return t.numeroPhase===e.numeroPhase})},e.getConditionTauxProduitPourCredit=function(e,t,r,a){return n.findOrEmpty(e,function(e){return e.codeFamilleProduit+e.numeroRelatifProduit===r&&i.isBefore(e.dateDebutApplication,t)&&i.isBefore(t,e.dateFinApplication)&&e.dureeMinimumPlageConditionTaux<=a&&a<=e.dureeMaximumPlageConditionTaux})},e.fctRecalculTaux=function(e,t,n,i,a,o,s,u,c,l,d,m,h){var p=_.find(t,function(e){return e.codeIndice===s});if("O"===h){var f=this.getParametreRevisionCalculTaux(i,e,l,c,d,m,u);if(null!==f){if("M"===f.mdExpressionValeurUtilisIndice){var A="5"===n.codeModeExpressionTaux?!1:!0;return A?[r.roundDecimal(p.valeurIndice+o,4),p.valeurIndice]:[r.roundDecimal(o+(1-f.valeurCoeffParametreRevision)*a+f.valeurCoeffParametreRevision*p.valeurIndice,4),p.valeurIndice]}return[r.roundDecimal(p.valeurIndice+o,4),p.valeurIndice]}return[0,0]}return[r.roundDecimal(p.valeurIndice+o,4),p.valeurIndice]},e.getParametreRevisionCalculTaux=function(e,t,n,i,r,a,o){var s=moment(o);if(null!==e&&e.length>0)for(var u=0,c=e;u<c.length;u++){var l=c[u],d=moment(l.dateDebutApplication),m=moment(l.dateFinApplication);if(l.codeFamilleProduit+l.numeroRelatifProduit===t&&l.codeTypePhase===i&&l.noRelatifPhaseTypePhaseProduit===n&&l.numeroJeuIndicesRevision===r&&l.codeTypeRoleIndice===a&&d.isBefore(s)&&s.isBefore(m))return l}return null},e.getAncienCodeIndiceNominal=function(e,t){var n=_.isEmpty(t)?"":t.codeIndice;return""===n&&(n=_.isEmpty(e)?"":e.codeIndiceNominal),n},e.getParametreRevision=function(e,t,n,i,r,a,o){var s,u=moment(t);if("F"===i)for(var c=0,l=r;c<l.length;c++){var d=l[c];if(null!==d.parametresRevision)for(var m=0,h=d.parametresRevision;m<h.length;m++){var p=h[m],f=moment(p.dateDebutApplication),A=moment(p.dateFinApplication);p.codeFamilleProduit+p.numeroRelatifProduit===e&&p.codeTypePhase===a&&p.noRelatifPhaseTypePhaseProduit===o&&f.isBefore(u)&&u.isBefore(A)&&"I1"===p.codeTypeRoleIndice&&(""!==n&&p.codeIndice===n&&(s=angular.copy(p)),angular.isUndefined(s)&&(s=angular.copy(p)))}}else if("P"===i)for(var P=0,v=r;P<v.length;P++){var d=v[P];if(null!==d.parametresRevision)for(var g=0,C=d.parametresRevision;g<C.length;g++){var p=C[g],f=moment(p.dateDebutApplication),A=moment(p.dateFinApplication);p.codeFamilleProduit+p.numeroRelatifProduit===e&&1===p.numeroPeriodeRevision&&f.isBefore(u)&&u.isBefore(A)&&"I1"===p.codeTypeRoleIndice&&(""!==n&&p.codeIndice===n&&(s=angular.copy(p)),angular.isUndefined(s)&&(s=angular.copy(p)))}}return s},e.miseAJourMarge=function(e,t,n,i,a,o){var s=0;return""!==e?("3"===t&&(s=i.margeAppliquerSurTaux<n.tauxMoyenMinimumCredit||i.margeAppliquerSurTaux>n.tauxMoyenMaximumCredit||o.codeModeCalculTaux!==a.codeModeCalculTaux?n.tauxMoyenConseilleCredit>=n.tauxMoyenMinimumCredit&&n.tauxMoyenConseilleCredit<=n.tauxMoyenMaximumCredit?r.roundDecimal(n.tauxMoyenConseilleCredit,4):i.margeAppliquerSurTaux<n.tauxMoyenMinimumCredit?r.roundDecimal(n.tauxMoyenMinimumCredit,4):r.roundDecimal(n.tauxMoyenMaximumCredit,4):r.roundDecimal(i.margeAppliquerSurTaux,4)),"4"===t&&(s=i.margeAppliquerSurTaux<n.margeFixePourRevision-n.variationMargeFixePourRevision||i.margeAppliquerSurTaux>100||o.codeModeCalculTaux!==a.codeModeCalculTaux?r.roundDecimal(n.margeFixePourRevision,4):r.roundDecimal(i.margeAppliquerSurTaux,4))):("3"===t&&(s=n.tauxMoyenConseilleCredit>=n.tauxMoyenMinimumCredit&&n.tauxMoyenConseilleCredit<=n.tauxMoyenMaximumCredit?r.roundDecimal(n.tauxMoyenConseilleCredit,4):r.roundDecimal(n.tauxMoyenMinimumCredit,4)),"4"===t&&(s=r.roundDecimal(n.margeFixePourRevision,4))),s},e.miseAJourTaux=function(e,n,i,a,o,s,u,c,l,d,m,h,p,f){var A=0;if("3"===n){var P=s.length>0?_.first(s).numeroJeuIndicesRevision:0,v=t.FonctionsChPourInit.fctRecalculTaux(e,i,o,s,u,c,l,h,p,f,P,"I1","INDX"===o.codeIndice?"O":"N");A=v[0]}return"4"===n&&(A=a<o.tauxMoyenMinimumCredit||a>o.tauxMoyenMaximumCredit||d!==m?0!==o.tauxMoyenConseilleCredit?r.roundDecimal(o.tauxMoyenConseilleCredit,4):a<o.tauxMoyenMinimumCredit?r.roundDecimal(o.tauxMoyenMinimumCredit,4):r.roundDecimal(o.tauxMoyenMaximumCredit,4):r.roundDecimal(a,4)),A},e.getDureeCredit=function(e,t,n){var i=this.getDureeCreditInit(e,t.uniteDureeCredit,t.dureeAjusteeCreditSuiteRecalcul),r=[i,i];return"2"===n.modeExpressionDureeCredit?(i<n.dureeCredit||i>n.dureeCredit1)&&(0!==n.dureeCredit2?(r[0]=n.dureeCredit2,r[1]=n.dureeCredit2):(i<n.dureeCredit&&(r[0]=n.dureeCredit,r[1]=n.dureeCredit),i>n.dureeCredit1&&(r[0]=n.dureeCredit1,r[1]=n.dureeCredit1))):"1"===n.modeExpressionDureeCredit&&i!==n.dureeCredit&&i!==n.dureeCredit1&&i!==n.dureeCredit2&&i!==n.dureeCredit3&&i!==n.dureeCredit4&&(r[0]=n.dureeCredit,r[1]=n.dureeCredit),r},e.getDureeCreditInit=function(e,t,n){var i=this.getValeurUniteDureeCredit(e),r=this.getValeurUniteDureeCredit(t);return Math.round(n*r/i)},e.getValeurUniteDureeCredit=function(e){switch(e){case"M":return 1;case"B":return 2;case"T":return 3;case"S":return 6;case"A":return 12;default:return 0}},e}();t.FonctionsChPourInit=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.FonctionsAvenant,i=e.Commun.ToolsFunctionals.Taux,r=function(){function e(e,t,n,i,r,a,o){t?(this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.numeroPhase=e.numeroPhase,this.numeroRelatif=i,this.numeroPremiereEcheancePalier=1,this.numeroDerniereEcheancePalier=e.dureeInitialePhaseCredit,this.tauxProgressionAmortissement=0,this.cdIndexTauxProgressionAmort="N",this.uniteDureePhase=e.uniteDureePhase,this.numeroRelatif1=e.numeroRelatif,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.noPhaseCreditProchaineRevision=this.numeroPhase,this.numeroRelatif2=this.numeroRelatif,this.elementModifiableParAvenant="N",this.codeOccurabsorbeePhasePalier=""):(this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.numeroPhase=e.numeroPhase,this.numeroRelatif=i,this.uniteDureePhase=e.uniteDureePhase,this.numeroPremiereEcheancePalier=n+1,this.elementModifiableParAvenant="O",this.codeOccurabsorbeePhasePalier="",this.numeroDerniereEcheancePalier=this.getNumeroDerniereEcheancePalier(this.numeroPremiereEcheancePalier,e,a),this.numeroRelatif1=e.numeroRelatif,this.numeroPhase=e.numeroPhase,this.cdIndexTauxProgressionAmort="3"===r.codeTypeTauxProgreAmortissement?"O":"N",this.tauxProgressionAmortissement=this.getTauxProgressionAmortissement(this.cdIndexTauxProgressionAmort,r.tauxProgressionAmortissement1,r.tauxProgressionAmortissement2,o,this.codeRoleCreditAvenant,this.numeroPremiereEcheancePalier),this.noPhaseCreditProchaineRevision=this.numeroPhase,
this.numeroRelatif2=this.numeroRelatif)}return e.prototype.getNumeroDerniereEcheancePalier=function(e,t,i){var r,a=n.simulConvDuree(i.periodicite,i.dureeCalculee,"M",365);return r=a%n.simulConvDuree(t.periodiciteCalculInterets,1,"M",365)===0?e-1+n.simulConvDuree(i.periodicite,i.dureeCalculee,t.periodiciteCalculInterets,365):e},e.prototype.getTauxProgressionAmortissement=function(e,t,n,i,r,a){return"N"===e?0!==n?n:t:this.rechercheTxIndexeProgAmor(i,r,a)},e.prototype.rechercheTxIndexeProgAmor=function(e,t,n){for(var r=0,a=null,o=0,s=e;o<s.length;o++){var u=s[o];u.codeRoleCreditAvenant===t&&u.numeroPremiereEcheancePalier<=n&&u.numeroPremiereEcheancePalier>r&&(r=u.numeroPremiereEcheancePalier,a=angular.copy(u))}return r>0&&"1"===a.codeIndice?i.roundDecimal(a.tauxInteretPalier,4):0},e}();t.PalierTauxAmortissementChInit=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.FonctionsAvenant,i=e.Commun.ToolsFunctionals.Taux,r=function(){function e(e,n,r,a,o,s,u,c,l,d,m,h,p,f){this.codeEtablissement=n.codeEtablissement,this.identifiantCredit=n.identifiantCredit,this.codeRoleCreditAvenant=n.codeRoleCreditAvenant,this.numeroPhase=n.numeroPhase,this.numeroRelatif=a,this.numeroPremiereEcheancePalier=u?1:c+1,this.numeroDerniereEcheancePalier=u?n.dureeInitialePhaseCredit:this.getNumeroDerniereEcheancePalier(s,n,this.numeroPremiereEcheancePalier),this.typeRemboursement=u?1:this.getTypeRemboursement(o),this.uniteDureePhase=u?"M":n.uniteDureePhase,this.numeroRelatif1=n.numeroRelatif,this.numeroRelatifSimulationAvenant=n.numeroRelatifSimulationAvenant,this.numeroRelatifPalierProduit=u?1:o.numeroRelatif,this.noPhaseCreditProchaineRevision=this.numeroPhase,this.numeroRelatif2=this.numeroRelatif,this.elementModifiableParAvenant=u?"N":"O",this.codeOccurabsorbeePhasePalier="",this.tauxProgressionDesEcheances=u?0:this.getTauxProgressionEcheances(o),this.periodiciteApplicProgreEcheance=u?r.periodiciteApplicProgreEcheance:o.periodiciteApplicProgreEcheance,this.cdModifCaracteristfinancieres=u?"":"1";var A=0;if(u)this.tauxInteretPalier=i.roundDecimal(r.tauxInteretPalier,4),this.codeIndice=r.codeIndice,this.margeAppliquerSurTaux=i.roundDecimal(r.margeAppliquerSurTaux,4);else{var P=this.getPhaseProduitEncours(m.phases,n);if("1"===n.codeTauxDesPaliersCalcules)this.tauxInteretPalier=i.roundDecimal(n.tauxNominalPhase,4),this.codeIndice=n.codeIndiceNominal,this.margeAppliquerSurTaux=i.roundDecimal(n.margeAppliquerSurTaux,4);else{var v="";if("1"===o.codeTypeTauxInteret&&("2"===e.codeModeExpressionTaux&&(this.codeIndice="",this.margeAppliquerSurTaux=0,r.tauxInteretPalier<l.tauxMoyenMinimumCredit||r.tauxInteretPalier>l.tauxMoyenMaximumCredit||d.codeModeCalculTaux!==P.codeModeCalculTaux?0!==l.tauxMoyenConseilleCredit?this.tauxInteretPalier=i.roundDecimal(l.tauxMoyenConseilleCredit,4):r.tauxInteretPalier<l.tauxMoyenMinimumCredit?this.tauxInteretPalier=i.roundDecimal(l.tauxMoyenMinimumCredit,4):this.tauxInteretPalier=i.roundDecimal(l.tauxMoyenMaximumCredit,4):this.tauxInteretPalier=i.roundDecimal(r.tauxInteretPalier,4)),"3"===e.codeModeExpressionTaux||"4"===e.codeModeExpressionTaux)){var g=void 0;if("INDX"===l.codeIndice||"4"===e.codeModeExpressionTaux){if(v=t.FonctionsChPourInit.getAncienCodeIndiceNominal(f,r),g=t.FonctionsChPourInit.getParametreRevision(e.identifiantProduit,h,v,m.codeProduitRevisable,m.phases,n.codeTypePhase,n.noRelatifPhaseTypePhaseProduit),angular.isDefined(g)){switch(e.codeModeExpressionTaux){case"3":this.codeIndice=g.codeIndice;break;case"4":this.codeIndice=""}A="M"===g.mdExpressionValeurUtilisIndice&&angular.isDefined(f)&&P.codeModeCalculTaux===d.codeModeCalculTaux?i.roundDecimal(f.partieFixeUnTauxComposite,4):0}}else this.codeIndice=l.codeIndice;this.margeAppliquerSurTaux=t.FonctionsChPourInit.miseAJourMarge(v,e.codeModeExpressionTaux,l,r,d,P),this.tauxInteretPalier=t.FonctionsChPourInit.miseAJourTaux(e.identifiantProduit,e.codeModeExpressionTaux,p,r.tauxInteretPalier,l,angular.isDefined(g)?[g]:[],A,this.margeAppliquerSurTaux,this.codeIndice,P.codeModeCalculTaux,d.codeModeCalculTaux,h,o.codeTypePhase,o.noRelatifPhaseTypePhaseProduit)}if("2"===o.codeTypeTauxInteret&&(this.codeIndice="",this.margeAppliquerSurTaux=0,r.tauxInteretPalier<o.tauxInteret||r.tauxInteretPalier>o.tauxInteret1||d.codeModeCalculTaux!==P.codeModeCalculTaux?r.tauxInteretPalier<o.tauxInteret?this.tauxInteretPalier=i.roundDecimal(o.tauxInteret,4):this.tauxInteretPalier=i.roundDecimal(o.tauxInteret1,4):this.tauxInteretPalier=i.roundDecimal(r.tauxInteretPalier,4)),"3"===o.codeTypeTauxInteret){var g=void 0;"INDX"===o.codeIndice?(v=t.FonctionsChPourInit.getAncienCodeIndiceNominal(f,r),g=t.FonctionsChPourInit.getParametreRevision(e.identifiantProduit,h,v,m.codeProduitRevisable,m.phases,o.codeTypePhase,o.noRelatifPhaseTypePhaseProduit),angular.isDefined(g)&&(this.codeIndice=g.codeIndice,A="M"===g.mdExpressionValeurUtilisIndice&&angular.isDefined(f)&&P.codeModeCalculTaux===d.codeModeCalculTaux?i.roundDecimal(f.partieFixeUnTauxComposite,4):0)):this.codeIndice=l.codeIndice,""!==v?r.margeAppliquerSurTaux<o.tauxInteret||r.margeAppliquerSurTaux>o.tauxInteret1||P.codeModeCalculTaux!==d.codeModeCalculTaux?r.margeAppliquerSurTaux<o.tauxInteret?this.margeAppliquerSurTaux=i.roundDecimal(o.tauxInteret,4):this.margeAppliquerSurTaux=i.roundDecimal(o.tauxInteret1,4):this.margeAppliquerSurTaux=i.roundDecimal(r.margeAppliquerSurTaux,4):this.margeAppliquerSurTaux=i.roundDecimal(o.tauxInteret,4);var C=angular.isDefined(g)?[g]:[],E=C.length>0?_.first(C).numeroJeuIndicesRevision:0,b=t.FonctionsChPourInit.fctRecalculTaux(e.identifiantProduit,p,l,C,A,this.margeAppliquerSurTaux,this.codeIndice,h,o.codeTypePhase,o.noRelatifPhaseTypePhaseProduit,E,"I1","INDX"===o.codeIndice?"O":"N");this.tauxInteretPalier=b[0]}}}}return e.prototype.getTypeRemboursement=function(e){return"P"!==e.typeRemboursement?e.typeRemboursement:"4"},e.prototype.getTauxProgressionEcheances=function(e){var t=0;return"2"===e.cdTypeTauxProgressionEcheances&&(t=0!==e.tauxProgressionDesEcheances2?e.tauxProgressionDesEcheances2:e.tauxProgressionDesEcheances),t},e.prototype.getPhaseProduitEncours=function(e,t){for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r.noRelatifPhaseTypePhaseProduit===t.noRelatifPhaseTypePhaseProduit&&r.codeTypePhase===t.codeTypePhase)return r}},e.prototype.getNumeroDerniereEcheancePalier=function(e,t,i){var r,a=n.simulConvDuree(e.periodicite,e.dureeCalculee,"M",365);return r=a%n.simulConvDuree(t.periodiciteCalculInterets,1,"M",365)===0?i-1+n.simulConvDuree(e.periodicite,e.dureeCalculee,t.periodiciteCalculInterets,365):i},e}();t.PalierTauxInteretChInit=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e,t,n){this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.numeroPhase=e.numeroPhase,this.codeTypePhase=e.codeTypePhase,this.noRelatifPhaseTypePhaseProduit=e.noRelatifPhaseTypePhaseProduit,this.partieFixeUnTauxComposite=0,this.numeroRelatif=e.numeroRelatif,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.noPhaseCreditProchaineRevision=e.numeroPhase,this.modeExpressionButoirTauxBaisse="",this.modeExpressionButoirTauxHausse="",this.valeurCoeffParametreRevision=0,this.valeurCoeffParametreRevision1=0,this.numeroJeuIndicesRevision=1,this.numeroPeriodeRevision=0,this.identifiantLoiRevision=n.identifiantLoiRevision,this.codeEcheanceRecalculeeRevision=n.codeEcheanceRecalculeeRevision,this.nmbrEcheanceAvtRecalculMontant=0,this.evenemntDeclencheurDebutPeriode="",this.codeUnitePeriodeDebutRevision="",this.nbrPeriodePrDeterminerDbtPeriod=0,this.dureePeriodeRevision=0,this.uniteDureePeriodeRevision="",this.elementModifiableParAvenant="O",this.codeTypeRoleIndice=t.codeTypeRoleIndice,this.typeIndexationTaux=" ",this.mdExpressionValeurUtilisIndice=" "}return e}();e.ParametreRevisionTauxChInit=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.FonctionsAvenant,i=e.Commun.Tools.DateUtils,r=e.Commun.ToolsFunctionals.Taux,a=function(){function a(e,n,i,a,o,s,u,c,l,d,m,h,p){this.codeEtablissement=n.codeEtablissement,this.identifiantCredit=n.identifiantCredit,this.codeRoleCreditAvenant=n.codeRoleCreditAvenant,this.numeroPhase=i,this.codeTypePhase=1===i?"AM":e.codeTypePhase,this.noRelatifPhaseTypePhaseProduit=1===i?1:e.noRelatifPhaseTypePhaseProduit,this.libelleLongTypePhase="Amortissement",this.dureeInitialePhaseCredit=1===i?this.getDureeInitialePhasePassee(n.dateMiseRecouvrementZero,n.dateEcheance):s,this.dureeResiduelleCredit=0,this.uniteDureePhase=1===i?"M":e.uniteDureePhase,this.codeTauxDesPaliersCalcules=1===i?"1":e.codeTauxDesPaliersCalcules,this.tauxMoyenPhaseCredit=1===i?a.tauxMoyenPhaseCredit:0,this.modeCalculAmortissement=1===i?o.modeCalculAmortissement:e.modeCalculAmortissement,this.quotiteCapitalAmortir=1===i?0:this.getQuotiteCapitalAmortir(this.modeCalculAmortissement,e.quotConseilleeCapitalAAmortir1),this.periodiciteMiseRecouvrInterets=1===i?"M":this.getPeriodiciteMiseRecouvrInterets(a,e,this.uniteDureePhase,this.dureeInitialePhaseCredit),this.periodiciteMERamortissement=1===i?"M":this.getPriodiciteMerAmortissement(e,a,this.uniteDureePhase,this.dureeInitialePhaseCredit,this.periodiciteMiseRecouvrInterets),this.periodiciteCalculInterets=1===i?"M":this.periodiciteMiseRecouvrInterets,this.dateFinPrefinancementInitiale=null,this.typeIndexationTaux="",this.numeroRelatif=n.numeroRelatif,this.numeroRelatifSimulationAvenant=n.numeroRelatifSimulationAvenant,this.numeroJeuIndicesRevision=0,this.noPhaseCreditProchaineRevision=1===i?i:i,this.elementModifiableParAvenant=1===i?"N":"O",this.modeCapitRecouvInterets="",this.cdModifCaracteristfinancieres=1===i?"":"1",this.codeOccurabsorbeePhasePalier="",this.partieFixeUnTauxComposite=0,this.nbJoursDansAnneeDenominateur=a.nbJoursDansAnneeDenominateur,this.nbJoursDansAnneeNumerateur=a.nbJoursDansAnneeNumerateur,this.calculInteretsEnJoursReels=a.calculInteretsEnJoursReels,this.prelevementEnFinPhase=1===i?"":this.getPrelevementEnFinPhase(e,u),this.codeTypeEcretage="",this.paliersTauxInterets=[],this.parametresRevisionTaux=[],this.paliersTauxAmortissement=[],this.pretsCombines=1===i?[]:this.getPretCombine(n,i,e,u);var f=this.getIsParametreRevisionTaux(m.codeProduitRevisable),A=0;if(1===i)this.tauxNominalPhase=a.tauxNominalPhase,this.codeIndiceNominal="",this.margeAppliquerSurTaux=0;else if("O"===n.codeTauxCreditDirecteur)this.tauxNominalPhase=n.tauxNominalCredit,this.codeIndiceNominal=n.codeIndiceNominal,this.margeAppliquerSurTaux=n.margeAppliquerSurTauxNominal;else if("1"!==this.codeTauxDesPaliersCalcules)this.tauxNominalPhase=0,this.codeIndiceNominal="",this.margeAppliquerSurTaux=0;else{var P="";if("1"===e.cdModeExpressionTauxMoyenPhase&&("2"===n.codeModeExpressionTaux&&(this.codeIndiceNominal="",this.margeAppliquerSurTaux=0,c.tauxInteretPalier<l.tauxMoyenMinimumCredit||c.tauxInteretPalier>l.tauxMoyenMaximumCredit||e.codeModeCalculTaux===d.codeModeCalculTaux?0!==l.tauxMoyenConseilleCredit?this.tauxNominalPhase=r.roundDecimal(l.tauxMoyenConseilleCredit,4):c.tauxInteretPalier<l.tauxMoyenMinimumCredit?this.tauxNominalPhase=r.roundDecimal(l.tauxMoyenMinimumCredit,4):this.tauxNominalPhase=r.roundDecimal(l.tauxMoyenMaximumCredit,4):this.tauxNominalPhase=r.roundDecimal(c.tauxInteretPalier,4)),"3"===n.codeModeExpressionTaux||"4"===n.codeModeExpressionTaux)){var v=void 0;if("INDX"===l.codeIndice||"4"===n.codeModeExpressionTaux){if(P=t.FonctionsChPourInit.getAncienCodeIndiceNominal(a,c),v=t.FonctionsChPourInit.getParametreRevision(n.identifiantProduit,h,P,m.codeProduitRevisable,m.phases,this.codeTypePhase,this.noRelatifPhaseTypePhaseProduit),f&&angular.isDefined(v)){switch(n.codeModeExpressionTaux){case"3":this.codeIndiceNominal=v.codeIndice;break;case"4":this.codeIndiceNominal=""}A="M"===v.mdExpressionValeurUtilisIndice&&angular.isDefined(a)&&e.codeModeCalculTaux===d.codeModeCalculTaux?r.roundDecimal(a.partieFixeUnTauxComposite,4):0}}else this.codeIndiceNominal=l.codeIndice;this.margeAppliquerSurTaux=t.FonctionsChPourInit.miseAJourMarge(P,n.codeModeExpressionTaux,l,c,d,e),this.tauxNominalPhase=t.FonctionsChPourInit.miseAJourTaux(n.identifiantProduit,n.codeModeExpressionTaux,p,c.tauxInteretPalier,l,f&&angular.isDefined(v)?[v]:[],A,this.margeAppliquerSurTaux,this.codeIndiceNominal,e.codeModeCalculTaux,d.codeModeCalculTaux,h,this.codeTypePhase,this.noRelatifPhaseTypePhaseProduit)}if("2"===e.cdModeExpressionTauxMoyenPhase&&(this.margeAppliquerSurTaux=0,this.codeIndiceNominal="",c.tauxInteretPalier<e.valeurMiniTauxMoyenPhase||c.tauxInteretPalier>e.valeurMaxiTauxMoyenPhase||e.codeModeCalculTaux!==d.codeModeCalculTaux?c.tauxInteretPalier<e.valeurMiniTauxMoyenPhase?this.tauxNominalPhase=r.roundDecimal(e.valeurMiniTauxMoyenPhase,4):this.tauxNominalPhase=r.roundDecimal(e.valeurMaxiTauxMoyenPhase,4):this.tauxNominalPhase=r.roundDecimal(c.tauxInteretPalier,4)),"3"===e.cdModeExpressionTauxMoyenPhase){var v=void 0;"INDX"===e.codeIndice?(P=t.FonctionsChPourInit.getAncienCodeIndiceNominal(a,c),v=t.FonctionsChPourInit.getParametreRevision(n.identifiantProduit,h,P,m.codeProduitRevisable,m.phases,this.codeTypePhase,this.noRelatifPhaseTypePhaseProduit),f&&angular.isDefined(v)&&(this.codeIndiceNominal=v.codeIndice,A="M"===v.mdExpressionValeurUtilisIndice&&angular.isDefined(a)&&e.codeModeCalculTaux===d.codeModeCalculTaux?r.roundDecimal(a.partieFixeUnTauxComposite,4):0)):this.codeIndiceNominal=l.codeIndice,""!==P?c.margeAppliquerSurTaux<e.valeurMiniTauxMoyenPhase||c.margeAppliquerSurTaux>e.valeurMaxiTauxMoyenPhase||e.codeModeCalculTaux!==d.codeModeCalculTaux?c.margeAppliquerSurTaux<e.valeurMiniTauxMoyenPhase?this.margeAppliquerSurTaux=r.roundDecimal(e.valeurMiniTauxMoyenPhase,4):this.margeAppliquerSurTaux=r.roundDecimal(e.valeurMaxiTauxMoyenPhase,4):this.margeAppliquerSurTaux=r.roundDecimal(c.margeAppliquerSurTaux,4):this.margeAppliquerSurTaux=r.roundDecimal(e.valeurMiniTauxMoyenPhase,4);var g=f&&angular.isDefined(v)?[v]:[],C=g.length>0?_.first(g).numeroJeuIndicesRevision:0,E=t.FonctionsChPourInit.fctRecalculTaux(n.identifiantProduit,p,l,g,A,this.margeAppliquerSurTaux,this.codeIndiceNominal,h,this.codeTypePhase,this.noRelatifPhaseTypePhaseProduit,C,"I1","INDX"===e.codeIndice?"O":"N");this.tauxNominalPhase=E[0]}}}return a.prototype.getIsParametreRevisionTaux=function(e){switch(e){case"F":return!0;case"P":return!1}},a.prototype.getQuotiteCapitalAmortir=function(e,t){return"7"===e?t:0},a.prototype.getPrelevementEnFinPhase=function(e,t){return 1===e.noRelatifPhaseTypePhaseProduit&&""!==t&&null!==t?"O":""},a.prototype.getPeriodiciteMiseRecouvrInterets=function(e,t,i,r){return e.periodiciteMiseRecouvrInterets===t.perioMiseRecouvrementInterets||e.periodiciteMiseRecouvrInterets===t.periodiciteMERinterets||e.periodiciteMiseRecouvrInterets===t.periodiciteMERinterets1||e.periodiciteMiseRecouvrInterets===t.periodiciteMERinterets2||e.periodiciteMiseRecouvrInterets===t.periodiciteMERinterets3&&n.simulConvDuree(i,r,"M",365)%n.simulConvDuree(e.periodiciteMiseRecouvrInterets,1,"M",365)===0?e.periodiciteMiseRecouvrInterets:t.perioMiseRecouvrementInterets},a.prototype.getPriodiciteMerAmortissement=function(e,t,i,r,a){return"O"===e.codePeriodiciteDifferenteMER?t.periodiciteMERamortissement===e.periodiciteMERamortissement||t.periodiciteMERamortissement===e.periodiciteMERamortissement1||t.periodiciteMERamortissement===e.periodiciteMERamortissement2||t.periodiciteMERamortissement===e.periodiciteMERamortissement3||t.periodiciteMERamortissement===e.periodiciteMERamortissement4&&n.simulConvDuree(i,r,"M",365)%n.simulConvDuree(t.periodiciteMERamortissement,1,"M",365)===0?t.periodiciteMERamortissement:e.periodiciteMERamortissement:a},a.prototype.getPretCombine=function(e,t,n,i){return 1===n.noRelatifPhaseTypePhaseProduit&&""!==i&&null!==i?[{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,numeroRelatif:e.numeroRelatif,codeRoleCreditAvenant:e.codeRoleCreditAvenant,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,numeroPhase:t,montantPartAmortissableCapital:0,montantPartInfine:0,modeRepartitionCapital:"M",codeAjoutIntercapSurPartAmort:"N",montantQuotiteAmortissement:0,quotiteCapitalAAmortir:0,amortissementSuppFinPhase:0}]:[]},a.prototype.getDureeInitialePhasePassee=function(t,n){var r=i.format(moment(t).set("date",moment(n).get("date")).toDate(),e.Commun.Constantes.Format.DATE_REST);return i.isBefore(r,n)?Math.ceil(moment(n).diff(moment(r),"months",!0)):0},a}();t.PhaseChInit=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function t(){}return t.getResult=function(t){return{libelleClient:t.dureeVersements.libelleTiers,libelleDossier:t.infoGeneraleCredit.libelleNatureFinancement+" ("+t.infoGeneraleCredit.identifiantDossier+")",libelleCredit:t.infoGeneraleCredit.libelleLongProduit+" ("+t.infoGeneraleCredit.identifiantCreditElementaire+")",isCreditInPrefinancement:e.CreditInfosHelper.getIsCreditInPrefinancement(t.listePhaseCredit||[]),creditHasNineOrMorePhase:e.CreditInfosHelper.getCreditHasNineOrMorePhase(t.listePhaseCredit||[]),isCreditTitrise:e.CreditInfosHelper.getIsCreditTitrise(t.infoGeneraleCredit)}},t}();e.CreditInfosBuilder=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getIsCreditInPrefinancement=function(e){var t=_.find(e,function(e){return e.alphaNumeriqueBanalisee1});return null!=t&&"PF"===t.codeTypePhase},e.getCreditHasNineOrMorePhase=function(e){return e.length>=9},e.getIsCreditTitrise=function(e){return"S"===e.typeCofinancement||"T"===e.typeCofinancement},e}();e.CreditInfosHelper=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=t.Constantes.Contractualisation,r=e.Commun.Tools.Object,a=function(){function t(t,r,a,o,s,u,c,l,d,m){var h=t.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Simulation,p=null!=s.dataEligibilite?s.dataEligibilite.getIsEligible():!1,f=this.getModeEdition(m,n.SignatureElectroniqueHelper.isEditionSedActive(t),u.isEligible,h);this._isSimulation=h,this.avenantResume=t,this.showChoixActionSimulation=l,this.dateDecision=this.getDateDecision(t),this.dateEdition=this._dateEditionInit=null!=t.dateDerniereEdition?t.dateDerniereEdition:new Date,this.dateLimiteValidite=t.dateLimiteValidite,this.dateMinimumAcceptation=t.dateMinimumAcceptation,this.dateReception=this.dateSignature=h?new Date:null,s.isMajSynchroKo&&(this.dateReception=s.dateReceptionElectronique,this.dateSignature=s.dateSignatureElectronique),this._modeEdition=f,this.isEditeEnAttenteEnvoi=this.showBlocTypeDocuments?!1:!0,this.showBtnSelectModeEdition=h||0!==f,this.showDatesEdition=!(p&&s.showBtnVoirDocument)||p&&s.isMajSynchroKo,this.libelleDateEditionOnlyReading=this.getLibelleDateEditionOnlyReading(p,s),this._isDateEditionOnlyReading=this._isSedOnSimulation||p&&s.isMajSynchroKo,this.isDateLimiteValiditeOnlyReading=p&&s.isMajSynchroKo,this.showCbAccordClient=!h&&(0!==f||null!==this.dateSignature||s.isMajSynchroKo),this.showRbTypeDocOffre=!h,this.showRbTypeDocAnnexe=!0,this.showRbTypeDocProposition=h,this.showDateReception=!h,this.showDateSignataure=!h,this.showNotationBale=!1,this.showBlocTypeDocuments=!h,this.choixDecision=this.showChoixActionSimulation?i.ChoixDecision.choixEdition:i.ChoixDecision.choixTransformer,this.isAccordClient=h,this.isAccordEtablissement=!0,this.codeAgentComposant=a,this.agentDecideur=o,this.showBlocEditDecideurAccordEtablissement=this.getShowBlocEditDecideurAccordEtablissement(o,t),this.notationBale2="8",this._listeDocEditionLocalePmm=this.getListeDocEditionPmm(h,t,!1),this.envoyerClient=!1,this.typeDocument=this.getTypeDocument(h,d),this.dataSed=s,this.dataIndus=u,this.dataJustificatif=c,this._listeDocsForAvenantIndusEditable=this.getListeDocsForAvenantEditable(u.listeDocuments,u.typeEditionPieco),this._listeDocsForAvenantSedEditable=this.getListeDocsForAvenantEditable(s.listeDocuments,e.Commun.Enum.TypeEditionPieco.Electronique,!0),this._listeDocsForSimulationSedEditable=this.getListeDocEditionPmm(h,t,!0),this._listeDocEditionLocaleLettreAvenant=this.getListeDocEditionLocaleLettreAvenant(d),this.isTypeLoiImmo="2"===r,this.isCreditRevisableAndLoiImmo=t.isCreditRevisable&&this.isTypeLoiImmo,this.isEligibleEditionLettreAssurance=d}return Object.defineProperty(t.prototype,"_isSedOnSimulation",{get:function(){return this._isSimulation&&0===this.modeEdition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"modeEdition",{get:function(){return this._modeEdition},set:function(e){this._modeEdition=e,this._isSedOnSimulation&&(this.dateEdition=this._dateEditionInit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showBlocDocuments",{get:function(){return 0===this.modeEdition?!this.dataSed.showBtnVoirDocument:1===this.modeEdition?this.showBtnSelectModeEdition:2===this.modeEdition?this._isSimulation||null!=this.typeDocument:!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listeDocSegment",{get:function(){return this._listeDocSegmentPrincipal},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listeDocSelectable",{get:function(){var e=this;return this._isSimulation||0!==this.modeEdition?1===this.modeEdition?this._listeDocsForAvenantIndusEditable:this._isSimulation?0===this.modeEdition?this._listeDocsForSimulationSedEditable:this._listeDocEditionLocalePmm:5===this.typeDocument?this._listeDocEditionLocaleLettreAvenant:_.filter(this._listeDocEditionLocalePmm,function(t){return t.type===e.typeDocument}):this._listeDocsForAvenantSedEditable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dateEditionOnlyReading",{get:function(){return this._isDateEditionOnlyReading},enumerable:!0,configurable:!0}),t.prototype.getShowBlocEditDecideurAccordEtablissement=function(e,t){return null!=e?t.libelleEtatSimulAvenant===i.Avenant.libelleAttenteDecisionEtablissement||t.libelleEtatSimulAvenant===i.Avenant.libelleAttenteAccordEtablissement:!0},t.prototype.getLibelleDateEditionOnlyReading=function(e,t){return e&&null!=t&&t.isMajSynchroKo?"Date d'edition":"L'édition sera effectuée en date du jour"},t.prototype.setDataIndus=function(e){this.dataIndus=e,this._listeDocsForAvenantIndusEditable=this.getListeDocsForAvenantEditable(e.listeDocuments,e.typeEditionPieco)},t.prototype.setDocumentsChecked=function(e){this._isSimulation&&this.setDocumentsCheckedToSimulation(e)},t.prototype.setDocumentsCheckedToSimulation=function(e){var t=_.findIndex(this._listeDocEditionLocalePmm,function(e){return e.id===i.Documents.idDocPropositionRenegociation}),n=_.findIndex(this._listeDocEditionLocalePmm,function(e){return e.id===i.Documents.idDocPropositionResiliation}),r=_.findIndex(this._listeDocEditionLocalePmm,function(e){return e.id===i.Documents.idDocMandat});e.id===i.Documents.idDocMandat?(this._listeDocEditionLocalePmm[t].disabled=e.checked||this._listeDocEditionLocalePmm[n].checked,e.checked&&(this._listeDocEditionLocalePmm[n].disabled=!1,this._listeDocEditionLocalePmm[t].checked=!1)):e.id===i.Documents.idDocPropositionRenegociation?(this._listeDocEditionLocalePmm[r].disabled=e.checked,this._listeDocEditionLocalePmm[n].disabled=e.checked,e.checked&&(this._listeDocEditionLocalePmm[r].checked=!1,this._listeDocEditionLocalePmm[n].checked=!1)):e.id===i.Documents.idDocPropositionResiliation&&(this._listeDocEditionLocalePmm[t].disabled=e.checked||this._listeDocEditionLocalePmm[r].checked,e.checked&&(this._listeDocEditionLocalePmm[r].disabled=!1,this._listeDocEditionLocalePmm[t].checked=!1))},t.prototype.getDocumentLocalChecked=function(e){var t=_.findIndex(this._listeDocEditionLocalePmm,function(t){return t.id===e});return 0>t?!1:this._listeDocEditionLocalePmm[t].checked},t.prototype.setDocumentLocalChecked=function(e,t){var n=_.findIndex(this._listeDocEditionLocalePmm,function(t){return t.id===e});0>n||(this._listeDocEditionLocalePmm[n].checked=t)},t.prototype.getDateDecision=function(e){return null!=e.dateEditionOffre?e.dateEditionOffre:e.isSaisieRetroactive?e.dateSaisieRetroactive:new Date},t.prototype.getListeDocEditionPmm=function(e,t,n){var r=this,a=_.filter(t.documentsEdition||[],function(e){return e.codeType===t.codeAvenantSimulation.toString()&&(n?e.identifiantdoc!==i.Documents.idDocPropositionRenegociation:!0)});return _.map(a,function(t){return r.getDocumentEditionLocale(e,t,n)}).concat(this.getListeDocumentAnnexeAvenant(e,t.signaturesAnnexes))},t.prototype.getDocumentEditionLocale=function(e,t,n){return{id:t.identifiantdoc,checked:n,type:this.getCodeTypeDocEdition(e,t.annexe),label:t.libelle,disabled:n,identifiantAnnexe:t.identifiantAnnexe,codeType:null,isEditionLocaleMyWay:!1}},t.prototype.getCodeTypeDocEdition=function(e,t){return t?4:e?3:1},t.prototype.getListeDocumentAnnexeAvenant=function(t,n){var i=this;return t?[]:_.map(_.filter(n||[],function(t){return t.codeTypeAnnexe===e.Commun.Enum.CodeAvenantSimulation.Avenant.toString()}),function(e){return i.getDocumentAnnexeAvenant(e)})},t.prototype.getDocumentAnnexeAvenant=function(e){return{id:"",checked:!1,type:4,label:e.libelleCourtAnnexe,disabled:!1,identifiantAnnexe:e.identifiantAnnexe,codeType:e.codeTypeAnnexe,isEditionLocaleMyWay:!1}},t.prototype.getModeEdition=function(e,t,n,i){return t?0:null!=e&&0!==e?e:!i&&n?1:2},t.prototype.getListeDocsForAvenantEditable=function(t,n,i){var a=this;return void 0===i&&(i=!1),_.map(_.filter(t||[],function(e){return r.isStringNotEmpty(e.referenceDoc)}),function(t){var r={id:a.getIdDocEditable(t,n),label:t.libelle,checked:t.checked,disabled:i,isEditionLocaleMyWay:n===e.Commun.Enum.TypeEditionPieco.IndustrielleLettreAvenant};return r})},t.prototype.getIdDocEditable=function(t,n){return n===e.Commun.Enum.TypeEditionPieco.IndustrielleLettreAvenant?t.intituleDocument+".pdf":t.referenceDoc},t.prototype.getTypeDocument=function(e,t){return e?3:t?5:1},t.prototype.getListeDocEditionLocaleLettreAvenant=function(t){return t?[{checked:!1,disabled:!1,id:e.Commun.Constantes.Editique.NomFichier.lettreAvenantAssurance,label:"Lettre avenant",nomFichierGceDoc:null,type:5,isEditionLocaleMyWay:!0},{checked:!1,disabled:!1,id:e.Commun.Constantes.Editique.NomFichier.taPlanRemboursement,label:"Tableau d'amortissement",nomFichierGceDoc:null,type:5,isEditionLocaleMyWay:!0}]:[]},t}();n.DataContractualisationForm=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function n(n){var i=this;this.idEntiteTitulaire=_.padLeft(n.caracteristiqueEntiteTitulaire.identifiantEntiteTitulaire.toString(),9,"0"),this.libelleLong=n.caracteristiqueEntiteTitulaire.designationEntiteTitulaire,this.libelleModeComposition=t.EntiteTitulaireHelper.getLibelleModeComposition(n.caracteristiqueEntiteTitulaire.modeCompositionEntiteTitulaire),this.libelleEtat=t.EntiteTitulaireHelper.getLibelleEtat(n.caracteristiqueEntiteTitulaire.codeEtatEntiteTitulaire),this.libelleUsage=t.EntiteTitulaireHelper.getLibelleUsage(n.caracteristiqueEntiteTitulaire.codeUsageEntiteTitulaire),this.listePersonne=_.map(n.compositionEntiteTitulaire.listePersonneTitulaire,function(e){return i.getPersonneDesignation(e)}),this.isCloturee=e.Commun.Tools.DateUtils.isValued(n.caracteristiqueEntiteTitulaire.dateClotureEntiteTitulaire)}return n.prototype.getPersonneDesignation=function(e){return{idPersonne:_.padLeft(e.identifiantTiers.toString(),9,"0"),libelleLong:e.designationTiers}},n}();t.EntiteTitulaireDescription=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getLibelleModeComposition=function(e){switch(e){case"1":return"Mode simple";case"2":return"Mode joint entre époux";case"3":return"Mode joint";case"4":return"Mode indivision";default:return null}},e.getLibelleEtat=function(e){switch(e){case"0":return"Actif";case"1":return"Clôturé";default:return null}},e.getLibelleUsage=function(e){switch(e){case"1":return"Usage privé";case"2":return"Usage professionnel";default:return null}},e}();e.EntiteTitulaireHelper=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function n(n){this.idEntiteTitulaire=_.padLeft(n.identifiantEntiteTitulaire.toString(),9,"0"),this.libelleLong=n.designationEntiteTitulaire,this.libelleModeComposition=t.EntiteTitulaireHelper.getLibelleModeComposition(n.modeCompositionEntiteTitulaire),this.libelleEtat=t.EntiteTitulaireHelper.getLibelleEtat(n.codeEtatEntiteTitulaire),this.libelleUsage=t.EntiteTitulaireHelper.getLibelleUsage(n.codeUsageEntiteTitulaire),this.isCloturee=e.Commun.Tools.DateUtils.isValued(n.dateFermetureEntiteTitulaire)}return n}();t.EntiteTitulaireResume=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=e.Commun.ToolsFunctionals.Dossier,r=e.Commun.ToolsFunctionals.Credit,a=e.Commun.ToolsFunctionals.Periodicite,o=e.Commun.ToolsFunctionals.Assurance,s=e.Commun.ToolsFunctionals.Accessoire,u=e.Commun.ToolsFunctionals.Garantie,c=e.Commun.ToolsFunctionals.Personne,l=e.Commun.ToolsFunctionals.RetourQr,d=function(){function e(){}return e.getHistoriqueFormate=function(e,t){var n=this;return{infosFinancieres:this.getInfosFinancieres(e,e.credit,e.produit.phases,e.produit),infosGenerales:this.getInfosGenerales(e),caracteristiquesPhase:_.map(e.credit.phases,function(t){return n.getCaracteristiquesPhase(e,t,e.credit,e.produit.phases)}),listeGaranties:_.map(e.credit.garanties,function(t){return n.getGarantie(e,t)}),listeAssurances:_.map(e.credit.assurances,function(t){return n.getAssurance(e,t)}),caracteristiquesObjet:this.getCaracteristiquesObjet(e.objetFinance),listeCaracteristiquesPayeur:_.map(e.payeurs,function(t){return n.getCaracteristiquesPayeur(t,e.motifsRecouvrement)}),listeCaracteristiquesEmprunteur:_.map(t.listePersonneEmprunteur,function(e){return n.getCaracteristiquesEmprunteur(e)}),listeInformations:l.getMessagesInformation(e.retourQR)}},e.getInfosFinancieres=function(e,t,n,i){var o=this;return{produit:t.identifiantProduit+" ( "+t.libelleLongProduit+" )",duree:t.dureeCredit,uniteDuree:a.getLibellePeriode(t.uniteDureeCredit,t.dureeCredit>0),jourEcheance:t.numeroQuantiemeDateEcheance,dateMER0:t.dateMiseRecouvrementZero,montant:t.montantOrigineCredit,codeDevise:r.getSymboleDevise(t.codeDevise),tauxNominal:t.tauxNominalCredit,indice:t.codeIndiceNominal,marge:t.margeAppliquerSurTauxNominal,modaliteRA:0!==t.numModaliteRembourAnticipe?"N° "+t.numModaliteRembourAnticipe:null,tauxIndemRA:t.tauxIndemniteRA+" %",codeModeCalculTaux:r.getLibelleModeTaux(n[0].codeModeCalculTaux),codeModeExpressionTaux:t.codeModeExpressionTaux,tauxFormat:this.getExpressionTaux(t.codeModeExpressionTaux,t),variationsDureesProduit:this.getVariationsDureesProduit(i,t),
accessoires:_.map(_.filter(t.accessoires,function(e){return 0===e.numeroPhase&&(""===e.identifiantAssurance||null==e.identifiantAssurance)}),function(t){return o.getAccessoire(t,e.reglesGestion)}),nombreEcheanceReportees:null===e.credit.accessoires?e.credit.echeancesReportees[0].nombreEcheancesAccessReport:null,echeanceReportees:_.map(_.filter(t.accessoires,function(e){return"21"===e.codeNatureAccessoire}),function(e){return o.getEcheanceReportees(e)})}},e.getEcheanceReportees=function(e){return{nombreEcheanceReportees:e.nombreEcheancesAccessReport,dateDebut:e.dateDebutApplicationElement,dateFin:e.dateFinApplicationElement,tauxReport:e.tauxElement}},e.getInfosGenerales=function(e){return{ancienNumeroDossier:e.ancienNumeroDossier,identifiantCredit:e.credit.identifiantCredit,codeEtablissement:e.credit.codeEtablissement,numeroRelatif:e.credit.numeroRelatif,titrePrincipal:"Historique du crédit n°"+e.credit.identifiantCredit+"  / "+e.credit.codeEtablissement+", avenant n°"+e.credit.numeroRelatif}},e.getCaracteristiquesPhase=function(e,t,i,r){var o=this,s=_.filter(e.credit.accessoires,function(e){return(null===e.identifiantAssurance||""===e.identifiantAssurance)&&e.numeroPhase===t.numeroPhase&&!_.contains(["21","22"],e.codeNatureAccessoire)}),u=n.findOrEmpty(r,function(e){return e.codeTypePhase===t.codeTypePhase}),c=_.filter(u.parametresRevision,function(e){return e.numRelatifPhaseParTypePhasePdt===t.numRelatifPhaseParTypePhasePdt&&e.numeroJeuIndicesRevision===t.numeroJeuIndicesRevision});return{libelleLong:"Phase n° "+t.numeroPhase+":  "+t.libelleLongTypePhase,numeroPhase:t.numeroPhase,libellePhase:t.libelleLongTypePhase,dureeInitialePhaseCredit:t.dureeInitialePhaseCredit,uniteDureeInitialePhaseCredit:a.getLibellePeriode(t.uniteDureePhase,t.dureeInitialePhaseCredit>0),dateFinPrefinancementReelle:null!=i.dateFinPrefinancementReelle&&"PF"===t.codeTypePhase?i.dateFinPrefinancementReelle:null,periodiciteMERInteret:a.getLibellePeriodicite(t.periodiciteMiseRecouvreInterets),periodiciteMERAmortissement:"PF"!==t.codeTypePhase?a.getLibellePeriodicite(t.periodiciteMERamortissement):"",tauxPhase:"PF"===t.codeTypePhase?i.tauxInteretPrefinancement:t.tauxNominalPhase,modeExpressionPhase:this.getTauxPhase(t,i,r),marge:t.margeAppliquerSurTaux+" "+t.codeIndiceNominal,quotiteCapital:t.quotiteCapitalAmortir>0?t.quotiteCapitalAmortir+" %":null,paliers:_.map(t.paliers,function(e){return o.getPalier(t,e,r,i)}),pretsCombines:_.map(t.pretsCombines,function(e){return o.getPretCombine(e)}),paliersTauxAmortissement:this.getPaliersTauxAmortissement(t.paliersTauxAmortissement,r),accessoires:_.map(s,function(t){return o.getAccessoirePhase(t,e.reglesGestion)}),revisions:_.map(c,function(e){return o.getRevision(t,e,u,t.parametresRevisionTaux,u.parametresRevision)})}},e.getGarantie=function(e,t){return{identifiantGarantie:t.identifiantGarantie,classe:u.getClasseGarantie(t.classeGarantie),nature:t.garantieP4.codeNatureGarantie===t.codeNatureGarantie?t.garantieP4.libelleNatureGarantie:null,convention:this.getConventionGarantie(t),garant:"P"===t.classeGarantie&&null!=t.garantieP2.identifiantConvention?t.garantieP2.libelleIntervenant:"",objetMisEnGarantie:"P"!==t.classeGarantie&&null!=t.garantieP2.descriptionLObjet?t.garantieP2.descriptionLObjet:null,commentaire:"P"!==t.classeGarantie&&null!=t.garantieP2.commentaireGarantie?t.garantieP2.commentaireGarantie:null,appartenance:"P"!==t.classeGarantie&&null!=t.garantieP2.libelleIntervenant?t.garantieP2.libelleIntervenant:null,pourcentageCouvert:0!==t.pourcentageCreditCouvert?t.pourcentageCreditCouvert:null,capitalCouvert:0===t.pourcentageCreditCouvert?t.capitalCouvertGarantie:null,accessoire:null!=t.garantieP3?this.getAccessoireGarantie(t.garantieP3,e.reglesGestion):null}},e.getAssurance=function(e,t){var n=this;return{identifiantAssurance:t.identifiantAssurance,personneAssuree:"("+t.identifiantPersonneEstAssure+")",convention:t.identifiantConvention,dateDebutPriseEffet:t.datePriseEffetAssurance,dateFinPriseEffet:t.dateFinEffetAssurance,montantEcheanceCouvert:t.montantEcheanceCouvertAssurance,quotiteCouverte:t.quotiteCouvertureCredit,libelleNiveauRisque:o.getLibelleRisque(t.codeTypeRisque,!0),libelleIntervenant:t.libelleIntervenant,codeReserveOuExclusion:this.getCodeReserve(t.codeReserveOuExclusionAssurance),codeAssuranceObligatoire:this.getCodeObligatoire(t.codeAssuranceObligatoire),accessoires:_.map(_.filter(e.credit.accessoires,function(e){return e.identifiantAssurance===t.identifiantAssurance}),function(t){return n.getAccessoiresAssurance(t,e.reglesGestion)})}},e.getAccessoire=function(e,t){return{libelleLong:e.codeTypeAccessoire+" "+e.libelleTypeAccessoire,codeTypeAccessoire:e.codeTypeAccessoire,libelleTypeAccessoire:e.libelleTypeAccessoire,regleApplication:this.getRegle(e.numeroRegleApplicationElement,t),regleAppel:this.getRegle(e.regleAppelAccessoireAperiodique,t),periodiciteApplication:a.getLibellePeriodicite(e.periodiciteApplicationElement),dateAppelAccessoire:e.dateAppelAccessoire,identifiantConvention:e.identifiantConvention,libelleConvention:e.libelleLongConvention,libelleTypeAssiette:s.getLibelleTypeAssiette(e.codeTypeAssietteCalculElement,e.numeroRegleApplicationElement),tauxElement:"1"===e.codeModeCalculAccessoire||"4"===e.codeModeCalculAccessoire||"7"===e.codeModeCalculAccessoire?e.tauxElement:null,montantElement:"2"===e.codeModeCalculAccessoire||"7"===e.codeModeCalculAccessoire?e.montantElement:null,tauxElementTranche1:"6"===e.codeModeCalculAccessoire?e.tauxElement:null,tauxElementTranche2:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement1?e.tauxElement1:null,tauxElementTranche3:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement2?e.tauxElement2:null,tauxElementTranche4:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement3?e.tauxElement3:null,tauxElementTranche5:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement4?e.tauxElement4:null,montantPlafondTranche1:"6"===e.codeModeCalculAccessoire?e.mtPlafondTrancheCalculAccess:null,montantPlafondTranche2:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement1?e.mtPlafondTrancheCalculAccess1:null,montantPlafondTranche3:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement2?e.mtPlafondTrancheCalculAccess2:null,montantPlafondTranche4:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement3?e.mtPlafondTrancheCalculAccess3:null,montantPlafondTranche5:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement4?e.mtPlafondTrancheCalculAccess4:null}},e.getVariationsDureesProduit=function(e,t){var n=this;if(0===e.variationsDureesProduit.length){var i={casSortieCompteCourant:"Aucun",casModulation:"Aucun",casRevision:"Aucun"};return[i]}return _.map(e.variationsDureesProduit,function(e){return n.getVariationDureeProduit(e,t)})},e.getVariationDureeProduit=function(e,t){return{casSortieCompteCourant:this.getCasSortie(e,t),casModulation:this.getCasModulation(e,t),casRevision:this.getCasRevision(e,t)}},e.getExpressionTaux=function(e,t){switch(e){case"2":return"Plage de valeur";case"3":return"Indice + Marge";case"4":return"Taux d'appel";default:return" ( "+e+" )"}},e.getCasSortie=function(e,t){return e.dureeMinimumPlageConditionTaux<=t.dureeCredit&&t.dureeCredit<=e.dureeMaximumPlageConditionTaux&&"C"===e.cdTypeButoirDuree?t.nbMaxiPerallsortieCptCourant+" "+a.getLibellePeriode(t.uniteDureeCredit,t.nbMaxiPerallsortieCptCourant>0):null},e.getCasModulation=function(e,t){return e.dureeMinimumPlageConditionTaux<=t.dureeCredit&&t.dureeCredit<=e.dureeMaximumPlageConditionTaux&&"M"===e.cdTypeButoirDuree?t.nbMaxiPerallsortieCptCourant+" "+a.getLibellePeriode(t.uniteDureeCredit,t.nbMaxiPerallsortieCptCourant>0):null},e.getCasRevision=function(e,t){return e.dureeMinimumPlageConditionTaux<=t.dureeCredit&&t.dureeCredit<=e.dureeMaximumPlageConditionTaux&&"R"===e.cdTypeButoirDuree?t.nbMaxiPerallsortieCptCourant+" "+a.getLibellePeriode(t.uniteDureeCredit,t.nbMaxiPerallsortieCptCourant>1):null},e.getAccessoirePhase=function(e,t){return{libelleLong:e.codeTypeAccessoire+" "+e.libelleTypeAccessoire,codeTypeAccessoire:e.codeTypeAccessoire,libelleTypeAccessoire:e.libelleTypeAccessoire,regleApplication:this.getRegle(e.numeroRegleApplicationElement,t),regleAppel:this.getRegle(e.regleAppelAccessoireAperiodique,t),periodiciteApplication:a.getLibellePeriodicite(e.periodiciteApplicationElement),dateAppelAccessoire:e.dateAppelAccessoire,identifiantConvention:e.identifiantConvention,libelleConvention:e.libelleLongConvention,libelleTypeAssiette:s.getLibelleTypeAssiette(e.codeTypeAssietteCalculElement,e.numeroRegleApplicationElement),tauxElement:"1"===e.codeModeCalculAccessoire||"4"===e.codeModeCalculAccessoire||"7"===e.codeModeCalculAccessoire?e.tauxElement:null,montantElement:"2"===e.codeModeCalculAccessoire||"7"===e.codeModeCalculAccessoire?e.montantElement:null,tauxElementTranche1:"6"===e.codeModeCalculAccessoire?e.tauxElement:null,tauxElementTranche2:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement1?e.tauxElement1:null,tauxElementTranche3:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement2?e.tauxElement2:null,tauxElementTranche4:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement3?e.tauxElement3:null,tauxElementTranche5:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement4?e.tauxElement4:null,montantPlafondTranche1:"6"===e.codeModeCalculAccessoire?e.mtPlafondTrancheCalculAccess:null,montantPlafondTranche2:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement1?e.mtPlafondTrancheCalculAccess1:null,montantPlafondTranche3:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement2?e.mtPlafondTrancheCalculAccess2:null,montantPlafondTranche4:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement3?e.mtPlafondTrancheCalculAccess3:null,montantPlafondTranche5:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement4?e.mtPlafondTrancheCalculAccess4:null}},e.getRevision=function(e,t,i,r,a){var o=n.findOrEmpty(r,function(t){return t.codeTypePhase===e.codeTypePhase});return"I1"===t.codeTypeRoleIndice&&r!==[]?{jeuIndice:e.numeroJeuIndicesRevision,codeIndice:""===t.codeIndice?t.codeIndice:null,libelleIndexation:null,partieFixe:"M"===t.modeExpressionValUtilisIndice?o.partieFixeUnTauxComposite:null,modeExpression:this.getModeExpressionRevision(t.modeExpressionValUtilisIndice),libelleButoir:this.getLibelleButoir(a),butoir:this.getHausseBaisse(this.getButoirRevision(a,o,e),o),modeExpressionButoir:null!=this.getButoirRevision(a,o,e)?this.getModeExpressionRevision(this.getButoirRevision(a,o,e).modeExpressionValUtilisIndice):null,libellePlancherPlafond:null}:"I2"===t.codeTypeRoleIndice&&r!==[]?{jeuIndice:e.numeroJeuIndicesRevision,codeIndice:""===t.codeIndice?t.codeIndice:null,libelleIndexation:"Indexation d'échéance",partieFixe:null,modeExpression:this.getModeExpressionRevision(t.modeExpressionValUtilisIndice),libelleButoir:null,butoir:null,modeExpressionButoir:null,libellePlancherPlafond:this.getPlafondPlancher(a,e)}:void 0},e.getLibelleButoir=function(e){return _.find(e,function(e){return"I5"===e.codeTypeRoleIndice})?"Butoir à la hausse":_.find(e,function(e){return"I6"===e.codeTypeRoleIndice})?"Butoir à la baisse":null},e.getButoirRevision=function(e,t,n){var i=_.filter(_.where(e,function(e){return"I5"===e.codeTypeRoleIndice}),function(e){return e.numeroJeuIndicesRevision===n.numeroJeuIndicesRevision&&e.numRelatifPhaseParTypePhasePdt===n.numRelatifPhaseParTypePhasePdt&&e.codeTypePhase===n.codeTypePhase}),r=_.filter(_.where(e,function(e){return"I6"===e.codeTypeRoleIndice}),function(e){return e.numeroJeuIndicesRevision===n.numeroJeuIndicesRevision&&e.numRelatifPhaseParTypePhasePdt===n.numRelatifPhaseParTypePhasePdt&&e.codeTypePhase===n.codeTypePhase});return r===[]||i===[]?null:null!=r&&r!==[]?_.findWhere(r,{codeTypeRoleIndice:"I5"}):null!=i&&i!==[]?_.findWhere(r,{codeTypeRoleIndice:"I6"}):null},e.getHausseBaisse=function(e,t){return null==e?null:"I5"===e.codeTypeRoleIndice?t.valeurCoeffParametreRevision1:"I6"===e.codeTypeRoleIndice?t.valeurCoeffParametreRevision:null},e.getPlafondPlancher=function(e,t){var n=_.filter(_.where(e,function(e){return"I3"===e.codeTypeRoleIndice}),function(e){return e.numeroJeuIndicesRevision===t.numeroJeuIndicesRevision&&e.numRelatifPhaseParTypePhasePdt===t.numRelatifPhaseParTypePhasePdt&&e.codeTypePhase===t.codeTypePhase}),i=_.filter(_.where(e,function(e){return"I4"===e.codeTypeRoleIndice}),function(e){return e.numeroJeuIndicesRevision===t.numeroJeuIndicesRevision&&e.numRelatifPhaseParTypePhasePdt===t.numRelatifPhaseParTypePhasePdt&&e.codeTypePhase===t.codeTypePhase});return null!=n||n!==[]?"Plancher d'écheance":null!=i||i!==[]?"Plafond d'écheance":void 0},e.getModeExpressionRevision=function(e){switch(e){case"T":return"Taux";case"I":return"Indice";case"Q":return"Quotient";case"D":return"Différence";default:return null}},e.getRegle=function(e,t){if(null===e)return null;var n=_.find(t,{regleAppelAccessoireAperiodique:e});return n.regleAppelAccessoireAperiodique+" "+n.libelleStandard},e.getPalier=function(e,t,n,i){return{tauxInteret:t.tauxInteretPalier,numTauxInteret:t.numeroRelatif,premiereEcheance:t.numeroPremiereEcheancePalier,derniereEcheance:t.numeroDerniereEcheancePalier,codeModeCalculTaux:e.modeCalculAmortissement,indice:t.codeIndice,marge:t.margeAppliquerSurTaux,tauxInteretPalier:this.getTauxPalier(t,i,e,n)}},e.getPretCombine=function(e){return{montantPartInfine:e.montantPartInfine,montantPartAmortissableCapital:e.montantPartAmortissableCapital,partInfine:e.montantPartInfine+" + "+e.montantPartInfine/(e.montantPartInfine+e.montantPartAmortissableCapital)+" %",partAmortissable:e.montantPartAmortissableCapital+" +"+e.montantPartAmortissableCapital/(e.montantPartInfine+e.montantPartAmortissableCapital)+" %"}},e.getTauxPhase=function(e,t,i){var a=n.findOrEmpty(i,function(t){return t.codeTypePhase===e.codeTypePhase}),o=" % "+r.getLibelleModeTaux(a.codeModeCalculTaux);return"1"===a.cdModeExpressionTauxMoyenPhase&&"2"===t.codeModeExpressionTaux?o+" (Plage de valeur)":"1"===a.cdModeExpressionTauxMoyenPhase&&"3"===t.codeModeExpressionTaux?o+" (Indice + Marge)":"1"===a.cdModeExpressionTauxMoyenPhase&&"4"===t.codeModeExpressionTaux?o+" (Taux d'appel)":"2"===a.cdModeExpressionTauxMoyenPhase?o+" (Plage de valeur)":"3"===a.cdModeExpressionTauxMoyenPhase?o+" (Indice + Marge)":""},e.getTauxPalier=function(e,t,n,i){for(var a=0,o=i;a<o.length;a++)for(var s=o[a],u="% "+r.getLibelleModeTaux(s.codeModeCalculTaux),c=0,l=s.paliersProduit;c<l.length;c++){var d=l[c];if(d.codeTypePhase===n.codeTypePhase&&d.numRelatifPhaseParTypePhasePdt===n.numRelatifPhaseParTypePhasePdt&&d.numeroRelatif===e.numRelatifPalierParProduit){if("2"===d.codeTypeTauxInteret)return u+" (Plage de valeur)";if("3"===d.codeTypeTauxInteret)return u+" (Indice + Marge)";if("1"===d.codeTypeTauxInteret&&"1"===s.cdModeExpressionTauxMoyenPhase&&"2"===t.codeModeExpressionTaux)return u+" (Plage de valeur)";if("1"===d.codeTypeTauxInteret&&"1"===s.cdModeExpressionTauxMoyenPhase&&"3"===t.codeModeExpressionTaux)return u+" (Indice + Marge)";if("1"===d.codeTypeTauxInteret&&"1"===s.cdModeExpressionTauxMoyenPhase&&"4"===t.codeModeExpressionTaux)return u+" (Taux d'appel)";if("1"===d.codeTypeTauxInteret&&"2"===s.cdModeExpressionTauxMoyenPhase)return u+" (Plage de valeur)";if("1"===d.codeTypeTauxInteret&&"3"===s.cdModeExpressionTauxMoyenPhase)return u+" (Indice + Marge)"}}return null},e.getPersonnalisable=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];return"P"===i.codeTypeTauxProgreAmortissement?"Personnalisable":"Non-personnalisable"}return null},e.getPaliersTauxAmortissement=function(e,t){var n=this,i=_.map(t,function(t){return _.map(e,function(e){return n.getPalierTauxAmortissement(e,t)})});return _.reduce(i,function(e,t){return e.concat(t)},[])},e.getPalierTauxAmortissement=function(e,t){return{numeroRelatif:e.numeroRelatif,premiereEcheancePalier:e.numeroPremiereEcheancePalier,derniereEcheancePalier:e.numeroDerniereEcheancePalier,tauxProgressionPalier:e.tauxProgressionAmortissement+" %",indexeTauxInteret:"O"===e.codeIndexTxProgressionAmort?"Oui":"Non",personalisable:this.getPersonnalisable(t.palierTxProgressAmortiCatalogue)}},e.getAccessoireGarantie=function(e,t){return{libelleLong:e.codeTypeAccessoire+" "+e.libelleTypeAccessoire,numeroPhase:0===e.numeroPhase?"Apériodique":"Phase n°"+e.numeroPhase,codeTypeAccessoire:e.codeTypeAccessoire,libelleTypeAccessoire:e.libelleTypeAccessoire,regleApplication:this.getRegle(e.numeroRegleApplicationElement,t),regleAppel:0===e.numeroPhase?this.getRegle(e.regleAppelAccessoireAperiodique,t):null,dateAppelAccessoire:0===e.numeroPhase?e.dateAppelAccessoire:null,periodiciteApplication:0!==e.numeroPhase?a.getLibellePeriodicite(e.periodiciteApplicationElement):null,libelleTypeAssiette:s.getLibelleTypeAssiette(e.codeTypeAssietteCalculElement,e.numeroRegleApplicationElement),tauxElement:"1"===e.codeModeCalculAccessoire||"4"===e.codeModeCalculAccessoire||"7"===e.codeModeCalculAccessoire?e.tauxElement:null,montantElement:"2"===e.codeModeCalculAccessoire||"7"===e.codeModeCalculAccessoire?e.montantElement:null,tauxElementTranche1:"6"===e.codeModeCalculAccessoire?e.tauxElement:null,tauxElementTranche2:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement1?e.tauxElement1:null,tauxElementTranche3:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement2?e.tauxElement2:null,tauxElementTranche4:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement3?e.tauxElement3:null,tauxElementTranche5:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement4?e.tauxElement4:null,montantPlafondTranche1:"6"===e.codeModeCalculAccessoire?e.mtPlafondTrancheCalculAcces:null,montantPlafondTranche2:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement1?e.mtPlafondTrancheCalculAcces1:null,montantPlafondTranche3:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement2?e.mtPlafondTrancheCalculAcces2:null,montantPlafondTranche4:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement3?e.mtPlafondTrancheCalculAcces3:null,montantPlafondTranche5:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement4?e.mtPlafondTrancheCalculAcces4:null}},e.getConventionGarantie=function(e){return e.garantieP2.identifiantGarantie===e.identifiantGarantie&&"P"===e.classeGarantie&&null!=e.garantieP2.identifiantConvention?e.garantieP2.identifiantConvention+" "+e.garantieP2.libelleLongConvention:null},e.getCodeObligatoire=function(e){switch(e){case"O":case"P":return"Assurance obligatoire";case"F":return"Assurance facultative"}},e.getCodeReserve=function(e){switch(e){case"0":return"Accepté sans réserve";case"1":return"Exclusion totale ITT";case"2":return"Exclusion totale IPA";case"3":return"Exclusion totale ITT + IPA";case"6":return"Ex.part.ITT affection déclarée";case"7":return"Ex.part.IPA affection déclarée";case"8":return"Ex.part.ITT + IPA affection déc.";case"9":return"Ex.part Décès + ITT + IPA affection";case"A":return"Accepté groupe 1 avec réserves";case"B":return"Accepté groupe 2 sans réserve";case"C":return"Accepté groupe 2 avec réserves";case"D":return"Accepté groupe 1 avec G.P.A";case"R":return"Avec réserves";case"4":return"Exclusion Total ITT + PTA";case"Y":return"Si Affectation declarée(AXA)";case"Z":return"Assurance Pers Agées facultative";case"5":return"Ex.part.ITT affection déclarée";default:return null}},e.getAccessoiresAssurance=function(e,t){return{libelleLong:e.codeTypeAccessoire+" "+e.libelleTypeAccessoire,numeroPhase:e.numeroPhase>0?"Phase n°"+e.numeroPhase:null,codeTypeAccessoire:e.codeTypeAccessoire,libelleTypeAccessoire:e.libelleTypeAccessoire,regleApplication:this.getRegle(e.numeroRegleApplicationElement,t),regleAppel:0===e.numeroPhase?this.getRegle(e.regleAppelAccessoireAperiodique,t):null,dateAppelAccessoire:0===e.numeroPhase?e.dateAppelAccessoire:null,periodiciteApplication:0!==e.numeroPhase?a.getLibellePeriodicite(e.periodiciteApplicationElement):null,libelleTypeAssiette:s.getLibelleTypeAssiette(e.codeTypeAssietteCalculElement,e.numeroRegleApplicationElement),tauxElement:"1"===e.codeModeCalculAccessoire||"4"===e.codeModeCalculAccessoire||"7"===e.codeModeCalculAccessoire?e.tauxElement:null,montantElement:"2"===e.codeModeCalculAccessoire||"7"===e.codeModeCalculAccessoire?e.montantElement:null,tauxElementTranche1:"6"===e.codeModeCalculAccessoire?e.tauxElement:null,tauxElementTranche2:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement1?e.tauxElement1:null,tauxElementTranche3:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement2?e.tauxElement2:null,tauxElementTranche4:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement3?e.tauxElement3:null,tauxElementTranche5:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement4?e.tauxElement4:null,montantPlafondTranche1:"6"===e.codeModeCalculAccessoire?e.mtPlafondTrancheCalculAccess:null,montantPlafondTranche2:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement1?e.mtPlafondTrancheCalculAccess1:null,montantPlafondTranche3:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement2?e.mtPlafondTrancheCalculAccess2:null,montantPlafondTranche4:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement3?e.mtPlafondTrancheCalculAccess3:null,montantPlafondTranche5:"6"===e.codeModeCalculAccessoire&&null!=e.tauxElement4?e.mtPlafondTrancheCalculAccess4:null,tranche:e.numeroTranche>0?e.numeroTranche:null,libelleTranche:1===e.numeroTranche?"Dérogation":"Tranche",libellePeriodicite:null!=e.regleAppelAccessoireAperiodique?"Apériodique":"Périodique"}},e.getCaracteristiquesEmprunteur=function(e){return"M"===e.codeTypePersonne?{codeTypePersonne:null,prenoms:null,civilite:null,nomOuRaisonSociale:"Raison sociale: "+e.nomOuRaisonSociale,dateDeNaissance:null,situationFamiliale:null,libelleTypeRole:c.getLibelleRole(e.typeRolePersonne)}:{codeTypePersonne:e.codeTypePersonne,prenoms:e.prenoms,civilite:e.codeCivilite?c.getCodeCivilite(e.codeCivilite):null,nomOuRaisonSociale:e.nomOuRaisonSociale,dateDeNaissance:e.dateDeNaissance,situationFamiliale:c.getSituationFamiliale(e.codeSituationFamiliale),libelleTypeRole:c.getLibelleRole(e.typeRolePersonne)}},e.getCaracteristiquesPayeur=function(e,t){return{identifiantPayeur:e.identifiantPersonne,modeReglement:_.some(t,function(t){return t.codeModeReglement===e.codeModeReglement})?e.codeModeReglement:null,libelleCompte:e.numDomiciliationMiseRecouvr,montantFixe:0!==e.montantFixePayeurSurEcheance?e.montantFixePayeurSurEcheance:null,quotePartInteret:0===e.montantFixePayeurSurEcheance?e.pourcentagePayeurSurInteret:null,quotePartCapital:0===e.montantFixePayeurSurEcheance?e.pourcentPayeurSurAmortissement:null,quotePartAccessoire:0===e.montantFixePayeurSurEcheance?e.pourcentagePayeurSurAssurAccess:null}},e.getCaracteristiquesObjet=function(e){return _.isEmpty(e)?null:{projet:e.libelleTypeObjetCommercialToc,libelleProjet:"F"===e.codeUtilisationObjetDansCredit?"Projet Financé":"Projet Mixte",precisionReglementaire:e.libelleTypeObjetReglementeTor,montantOperation:e.montantLOperation,destination:"B5A"===e.codeClasseBafi?u.getLibelleDestinationObjet(e.codeDestinationAutoriseeObjet):null,adresse1:e.adresseLigne1,adresse2:e.adresseLigneSuite6,adresse3:e.adresseLigne2,adresse4:e.adresseLigne3,adresse5:e.adresseLigneCodePostal4,adresse6:e.adresseLigneCommune5,occupation:"B5A"===e.codeClasseBafi?i.getLibelleOccupation(e.codeModaliteOccupation):null}},e}();t.HistoriqueBuilder=d}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=e.Commun.Tools.List,r=e.Commun.ToolsFunctionals.Garantie,a=function(){function t(t,a,o,s,u){if(this.creditObjetRest=angular.copy(a),this._isCodeClasseBafiB5A=null!=a?"B5A"===a.codeClasseBafi:!1,this.identifiantObjetInitial=null!=a?a.identifiantObjet:null,this.identifiantObjet=o===e.Commun.Enum.CodeTypeAcces.Creation?"9999999":this.identifiantObjetInitial,this.listeTypeObjetCommercials=u,this.projetFinance=this.getTypeObjetCommercial(a,u),this.projetFinanceInitial=angular.copy(this.projetFinance),this.precisionReglementaire=this.getPrecisionReglementaire(a,this.projetFinance),this.montantOperation=null!=this.projetFinance?a.montantOperation:0,this.affichageCoutObjet=null!=this.projetFinance&&"O"===this.projetFinance.codeAffectationObjet,this.coutHtObjet=this.affichageCoutObjet?a.coutHorsTaxeLObjet:null,this.coutTtcObjet=this.affichageCoutObjet?a.coutTtcLObjet:null,this.affichageFraisNotaire=null!=this.projetFinance&&"O"===this.projetFinance.codeAffectationObjet&&"B5A"===a.codeClasseBafi,this.fraisNotaire=this.affichageFraisNotaire?a.montantFraisNotaire:null,this.affichageBoutonFraisNotaire=this.affichageFraisNotaire&&null!=this.fraisNotaire&&this.fraisNotaire>0,this.boutonFraisNotaire=this.affichageFraisNotaire&&"O"===a.integrationFraisNotaire,this.fraisDivers=null!=a?a.montantFraisDivers:0,this.affichageBoutonFraisDivers=null!=this.fraisDivers&&this.fraisDivers>0,this.boutonFraisDivers=null!=a?"O"===a.integrationFraisDivers:!1,this.valeurHypotheque=this.affichageCoutObjet?this.montantOperation:null,this.listePrixMarches=this.getListePrixMarche(),this.prixMarche=this.prixMarcheInit(a,this.listePrixMarches),this.affichageOccupationObjet=this._isCodeClasseBafiB5A,this.listeOccupePars=this.getListeModaliteOccupation(),this.objetOccupePar=this.objetOccupeParInit(a,this.listeOccupePars,this.affichageOccupationObjet),this.objetDestination=null!=a&&this.affichageOccupationObjet?r.getDestinationBienByCode(a.codeDestinationAutoriseeObjet):null,this.boutonAchevementTravaux=null!=a?"O"===a.codeGarantieAchevementTravaux:!1,this.nbLogement=null!=a&&this.affichageOccupationObjet?a.nombreLogementsDansObjet:0,this.listeZoneFranches=this.getListeZoneFranche(),this.zoneFranche=this.zoneFrancheInit(a,this.listeZoneFranches),this.desactiverZoneGeographiqueRobien=this.getDesactiverZoneGeographiqueRobien(s,a),this.listeZoneGeographiques=this.getListeZoneGeographique(),this.listeZoneRobiens=this.getListeZoneRobien(),this.zoneGeographique=this.getZoneGeo(s,this.listeZoneGeographiques),this.zoneDeRobien=this.getZoneRobien(s,this.listeZoneRobiens),this.isModeEdition=!0,this.adresseObjet=this.getAdresseObjetInit(a),this.descObjet=null!=a?a.descriptionLObjet:"",this.referenceExterne=null!=a?a.referenceExterneObjet:"",this.affichageVendeur=null!=this.projetFinance&&"O"===this.projetFinance.codeAffectationObjet&&"01"===this.projetFinance.codeNatureFinancement,this.vendeur=this.affichageVendeur?a.identifiantVendeur:null,this.listeTypeMarcheBiens=this.getListeTypeMarcheBiens(),this.listeModeEstimationBienTerrains=this.getListeModeEstimationBienTerrains(t),this.listeMiseEnOeuvreBiens=this.getListeMiseEnOeuvreBiens(),null!=a){this.typeMarcheBien=this.typeMarcheBienInit(a,this.listeTypeMarcheBiens),this.valeurDuBien=this.montantOperation,this.dateEstimationBien=null!=a.dateEstimationValeurObjet?n.parse(a.dateEstimationValeurObjet):null;var c=i.findOrEmpty(t,function(e){return a.codeModaliteLEstimation===e.codeTypologie});this.modeEstimationBien=_.isEmpty(c)?null:c}this.affichageSurfaceTypeBien=this._isCodeClasseBafiB5A,this.surfaceHabitableBien=this.affichageSurfaceTypeBien?Math.floor(a.surfaceHabitableEnM2):0,this.typeLogementBien=null!=a?r.getTypeLogementByCode(a.codeTypeLogement):null,this.affichageMiseOeuvreBien=null!=a?"S"===a.codeTypeMarchePersonne:!1,this.miseOeuvreBien=this.affichageMiseOeuvreBien?this.miseOeuvreBienInit(a,this.listeMiseEnOeuvreBiens):null,this.surfaceTerrain=null!=a?a.surfaceTerrainEnM2:0;var l=null!=a?this.affichageChampTerrainInit(a,a.typeObjetReglementeTor):[!1,!1,!1];this.affichageModeAcquisitionTerrain=l[0],this.affichageAutreChampTerrain=l[1],this.affichageTerrain=l[2],this.listeModeAcquisitionTerrains=this.getListeModeAcquisitionTerrain(a),this.modeAcquisitionTerrain=this.modeAcquisitionTerrainInit(a,this.listeModeAcquisitionTerrains),this.dateAcquisitionTerrain=null!=a&&null!=a.dateAcquisitionTerrain?n.parse(a.dateAcquisitionTerrain):null,this.montantAcquisitionTerrain=null!=a?a.coutAcquisition:0,this.dateEstimationTerrain=null!=a&&null!=a.dateEstimValeurObjetPrudentiel?n.parse(a.dateEstimValeurObjetPrudentiel):null,this.modeEstimationTerrain=this.modeEstimationTerrainInit(a,t)}return t.prototype.changeProjetFinance=function(e){this.precisionReglementaire=null,this.affichageCoutObjet="O"===e.codeAffectationObjet,this.affichageVendeur="O"===e.codeAffectationObjet&&"01"===e.codeNatureFinancement},t.prototype.changeFraisNotaire=function(){this.affichageBoutonFraisNotaire=this.affichageFraisNotaire&&null!=this.fraisNotaire&&this.fraisNotaire>0},t.prototype.changeFraisDivers=function(){this.affichageBoutonFraisDivers=null!=this.fraisDivers&&this.fraisDivers>0},t.prototype.changePrecisionReglementaire=function(e){var t=this.affichageChampTerrainInit(this.creditObjetRest,e.type);this.affichageModeAcquisitionTerrain=t[0],this.affichageAutreChampTerrain=t[1],this.affichageTerrain=t[2]},t.prototype.isValid=function(){return this.isValidAdresse()},t.prototype.isValidAdresse=function(){return null!=this.adresseObjetComposant?this.adresseObjetComposant.$valid:!0},t.prototype.reportDataAdresseComposantToDataAdresse=function(){this.adresseObjet.codePaysLocalisation=this.adresseObjetComposant.pays.codePaysIsoAfnor,this.adresseObjet.adresseLigneCodePostal4=this.adresseObjetComposant.codePostal,this.adresseObjet.adresseLigneCommune5=this.adresseObjetComposant.libelleInseeLocalite,this.adresseObjet.adresseLigne1=this.adresseObjetComposant.afnor.ligne1||null,this.adresseObjet.adresseLigneSuite6=this.adresseObjetComposant.afnor.ligne2||null,this.adresseObjet.adresseLigne2=this.adresseObjetComposant.afnor.ligne4,this.adresseObjet.adresseLigne3=this.adresseObjetComposant.afnor.ligne5},t.prototype.getTypeObjetCommercial=function(e,t){return null!=e?_.find(t,function(t){return t.typeObjetFinanGaranti===e.typeObjetFinanceGaranti}):null},t.prototype.getPrecisionReglementaire=function(e,t){return null!=e?_.find((t||{}).listeTor||[],function(t){return t.type===e.typeObjetReglementeTor}):null},t.prototype.prixMarcheInit=function(e,t){return null!=e?this.prixMarcheSel(e.codePrixMarche,t):{valeur:"Sans objet",code:0}},t.prototype.prixMarcheSel=function(e,t){switch(e){case"2":return _.find(t,function(e){return 2===e.code});case"1":return _.find(t,function(e){return 1===e.code});case"3":return _.find(t,function(e){return 3===e.code});default:return _.find(t,function(e){return 0===e.code})}},t.prototype.getListePrixMarche=function(){return[{valeur:"Plus de 10% supérieur au prix du marché",code:2},{valeur:"Entre +10% et -10% sur le prix du marché",code:1},{valeur:"Plus de 10% inférieur au prix du marché",code:3},{valeur:"Sans objet",code:0}]},t.prototype.objetOccupeParInit=function(e,t,n){return null!=e&&n?this.objetOccupeParSel(e.codeModaliteOccupation,t):null},t.prototype.objetOccupeParSel=function(e,t){switch(e){case"E":return _.find(t,function(e){return"E"===e.code});case"L":return _.find(t,function(e){return"L"===e.code});case"A":return _.find(t,function(e){return"A"===e.code});case"D":return _.find(t,function(e){return"D"===e.code});default:return null}},t.prototype.getListeModaliteOccupation=function(){return[{valeur:"Emprunteur",code:"E"},{valeur:"Locataire",code:"L"},{valeur:"Ascendant",code:"A"},{valeur:"Descendant",code:"D"}]},t.prototype.zoneFrancheInit=function(e,t){return null!=e?this.zoneFrancheSel(e.codeDestinationAutoriseeObjet,t):null},t.prototype.zoneFrancheSel=function(e,t){switch(e){case"F":return _.find(t,function(e){return"F"===e.code});case"S":return _.find(t,function(e){return"S"===e.code});case"T":return _.find(t,function(e){return"T"===e.code});case"U":return _.find(t,function(e){return"U"===e.code});case"V":return _.find(t,function(e){return"V"===e.code});default:return null}},t.prototype.getListeZoneFranche=function(){return[{valeur:"",code:""},{valeur:"Franche",code:"F"},{valeur:"Urbaine Sensible",code:"S"},{valeur:"AZF Hors zones",code:"T"},{valeur:"AZF Zone Franche",code:"U"},{valeur:"AZF Urbaine Sensible",code:"V"}]},t.prototype.getListeZoneRobien=function(){return[{valeur:"",
code:0},{valeur:"Zone A",code:1},{valeur:"Zone B",code:2},{valeur:"Zone C",code:3}]},t.prototype.selectionZoneRobien=function(e,t){switch(e){case"I":return _.find(t,function(e){return 1===e.code});case"J":return _.find(t,function(e){return 2===e.code});case"K":return _.find(t,function(e){return 3===e.code});case"M":return _.find(t,function(e){return 1===e.code});case"N":return _.find(t,function(e){return 2===e.code});case"O":return _.find(t,function(e){return 3===e.code});case"P":return _.find(t,function(e){return 1===e.code});case"Q":return _.find(t,function(e){return 2===e.code});case"R":return _.find(t,function(e){return 3===e.code});case"A":return _.find(t,function(e){return 1===e.code});case"B":return _.find(t,function(e){return 2===e.code});case"C":return _.find(t,function(e){return 3===e.code});default:return null}},t.prototype.selectionZoneGeo=function(e,t){switch(e){case"I":return _.find(t,function(e){return"A"===e.code});case"J":return _.find(t,function(e){return"A"===e.code});case"K":return _.find(t,function(e){return"A"===e.code});case"M":return _.find(t,function(e){return"B"===e.code});case"N":return _.find(t,function(e){return"B"===e.code});case"O":return _.find(t,function(e){return"B"===e.code});case"P":return _.find(t,function(e){return"C"===e.code});case"Q":return _.find(t,function(e){return"C"===e.code});case"R":return _.find(t,function(e){return"C"===e.code});case"A":return _.find(t,function(e){return"S"===e.code});case"B":return _.find(t,function(e){return"S"===e.code});case"C":return _.find(t,function(e){return"S"===e.code});default:return null}},t.prototype.getListeZoneGeographique=function(){return[{valeur:"",code:""},{valeur:"Zone Plus A",code:"A"},{valeur:"Zone Plus B",code:"B"},{valeur:"Zone Plus C",code:"C"},{valeur:"Sans Objet",code:"S"}]},t.prototype.getAdresseObjetInit=function(e){return null!=e?{adresseLigne1:e.adresseLigne1,adresseLigne2:e.adresseLigne2,adresseLigne3:e.adresseLigne3,adresseLigneCodePostal4:e.adresseLigneCodePostal4,adresseLigneCommune5:e.adresseLigneCommune5,adresseLigneSuite6:e.adresseLigneSuite6,codePaysLocalisation:e.codePaysLocalisation}:{adresseLigne1:"",adresseLigne2:"",adresseLigne3:"",adresseLigneCodePostal4:"",adresseLigneCommune5:"",adresseLigneSuite6:"",codePaysLocalisation:""}},t.prototype.typeMarcheBienInit=function(e,t){return null!=e?this.typeMarcheBienSel(e.codeQualiteMarche,t):null},t.prototype.typeMarcheBienSel=function(e,t){switch(e){case"1":return _.find(t,function(e){return 1===e.code});case"2":return _.find(t,function(e){return 2===e.code});case"3":return _.find(t,function(e){return 3===e.code});default:return null}},t.prototype.getListeTypeMarcheBiens=function(){return[{valeur:"",code:0},{valeur:"Etroit",code:1},{valeur:"Standard",code:2},{valeur:"Porteur",code:3}]},t.prototype.getListeModeEstimationBienTerrains=function(e){var t=[],n={};if(n.codeTypologie="",n.intitule="",n.typeTypologie="",t.push(n),null!=e)for(var i=0,r=e;i<r.length;i++){var a=r[i];t.push(a)}return t},t.prototype.miseOeuvreBienInit=function(e,t){return null!=e?this.miseOeuvreBienSel(e.codeMiseEnOeuvreProjet,t):null},t.prototype.miseOeuvreBienSel=function(e,t){switch(e){case"1":return _.find(t,function(e){return 1===e.code});case"2":return _.find(t,function(e){return 2===e.code});case"3":return _.find(t,function(e){return 3===e.code});default:return null}},t.prototype.getListeMiseEnOeuvreBiens=function(){return[{valeur:"",code:0},{valeur:"Prix du marché de gros oeuvre non signé",code:1},{valeur:"Prix de revient prévisionnel validé par expert",code:2},{valeur:"Prix du marché gros oeuvre signé avec P.M.E.",code:3}]},t.prototype.getListeModeAcquisitionTerrain=function(e){var t=[];return t.push({valeur:" ",code:0}),t.push({valeur:"Achat",code:1}),t.push({valeur:"Don / Héritage / Donation",code:2}),t.push({valeur:"Autres - non propriétaire",code:3}),null!=e&&"04"===e.typeObjetReglementeTor&&"01"===e.codeTypologieCadreFiscal&&t.push({valeur:"Bail à construction",code:4}),t},t.prototype.modeAcquisitionTerrainInit=function(e,t){return null!=e?this.modeAcquisitionTerrainSel(e.modeAcquisition,e.codeTypologieCadreFiscal,e.typeObjetReglementeTor,t):null},t.prototype.modeAcquisitionTerrainSel=function(e,t,n,i){switch(e){case"1":return _.find(i,function(e){return 1===e.code});case"2":return _.find(i,function(e){return 2===e.code});case"3":return _.find(i,function(e){return 3===e.code});case"4":return"01"===t?_.find(i,function(e){return 4===e.code}):_.find(i,function(e){return 3===e.code})}return"04"===n&&"01"===t&&""===e?_.find(i,function(e){return 4===e.code}):{valeur:" ",code:0}},t.prototype.modeEstimationTerrainInit=function(e,t){if(null!=e)for(var n=0,i=t;n<i.length;n++){var r=i[n];if(e.modeEstimationValeurTerrain===r.codeTypologie)return r}return null},t.prototype.affichageChampTerrainInit=function(e,t){if(null!=e){var n=!0,i=!0,r=!0;return"4"===e.modeAcquisition&&"01"===e.codeTypologieCadreFiscal&&(i=!0,r=!1),"04"===t&&"01"===e.codeTypologieCadreFiscal?""===e.modeAcquisition?(i=!0,r=!1):"4"!==e.modeAcquisition&&(i=!0,r=!0):"01"!==t&&"02"!==t&&"03"!==t&&"32"!==t&&"97"!==t&&"98"!==t&&(n=!1,i=!1,r=!1),[i,r,n]}return[!1,!1,!1]},t.prototype.getZoneGeo=function(e,t){return this._isCodeClasseBafiB5A&&null!=e&&null!=e.controleCodePostal&&"0"===e.controleCodePostal.codeRetourRequeteInterdomaine&&this.controleZoneGeo(e.controleCodePostal.codeZoneGeographique)?this.selectionZoneGeo(e.controleCodePostal.codeZoneGeographique,t):null},t.prototype.getZoneRobien=function(e,t){return this._isCodeClasseBafiB5A&&null!=e&&null!=e.controleCodePostal&&"0"===e.controleCodePostal.codeRetourRequeteInterdomaine&&this.controleZoneGeo(e.controleCodePostal.codeZoneGeographique)?this.selectionZoneRobien(e.controleCodePostal.codeZoneGeographique,t):null},t.prototype.getDesactiverZoneGeographiqueRobien=function(e,t){if(null!=e&&null!=e.controleCodePostal&&"0"===e.controleCodePostal.codeRetourRequeteInterdomaine&&null!=t&&"B5A"===t.codeClasseBafi){if(this.controleZoneGeo(e.controleCodePostal.codeZoneGeographique))return!0;if(parseInt(t.adresseLigneCodePostal4)>=97500)return!0}return!1},t.prototype.getZoneFranche=function(e,t,n){var i=null;return null!=t&&null!=e&&null!=e.controleCodePostal&&"0"===e.controleCodePostal.codeRetourRequeteInterdomaine&&("B5A"===t.codeClasseBafi&&(i=t.adresseLigneCodePostal4===e.controleCodePostal.adresseLigneCodePostal4&&t.adresseLigneCommune5===e.controleCodePostal.adresseLigneCommune5?null==t.typeZoneFranche||""===t.typeZoneFranche?null==e.controleCodePostal.codeZoneFranche||""===e.controleCodePostal.codeZoneFranche?"N":e.controleCodePostal.codeZoneFranche:t.typeZoneFranche:e.controleCodePostal.codeZoneFranche),this.controleZoneGeo(e.controleCodePostal.codeZoneGeographique))?(t.codeZoneGeographique=e.controleCodePostal.codeZoneGeographique,this.selectionZoneGeo(t.codeZoneGeographique,n)):null},t.prototype.controleZoneGeo=function(e){switch(e){case"I":return!0;case"J":return!0;case"K":return!0;case"M":return!0;case"N":return!0;case"O":return!0;case"P":return!0;case"Q":return!0;case"R":return!0;case"A":return!0;case"B":return!0;case"C":return!0;default:return!1}},t.prototype.isAdressesDifferentes=function(){return this.adresseObjetComposant.afnor.ligne1!==this.adresseObjet.adresseLigne1||this.adresseObjetComposant.afnor.ligne4!==this.adresseObjet.adresseLigne2||this.adresseObjetComposant.afnor.ligne5!==this.adresseObjet.adresseLigne3||this.adresseObjetComposant.codePostal!==this.adresseObjet.adresseLigneCodePostal4||this.adresseObjetComposant.libelleInseeLocalite!==this.adresseObjet.adresseLigneCommune5||this.adresseObjetComposant.pays.codePaysIsoAfnor!==this.adresseObjet.codePaysLocalisation},t.prototype.setZones=function(e){this.zoneGeographique=null!=e?this.getZoneGeo(e,this.listeZoneGeographiques):null,this.zoneDeRobien=null!=e?this.getZoneRobien(e,this.listeZoneRobiens):null},t}();t.InfoObjet=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getCompte=function(e){var t=n.getLibelleComposition(e.modeComposition),i=n.getLibelleProduit(e.codeProduit);return{numeroCompte:e.numeroCompte,idPersonne:e.identifiantPersonne,libelleDetailCompte:this.getLibelleDetailCompte(t,i),libelleComposition:t,codeProduit:e.codeProduit,libelleProduit:i}},e.getLibelleDetailCompte=function(e,t){return null!=e&&null!=t?t+" - "+e:null!=e?e:null!=t?t:null},e}();e.CompteBuilder=t;var n=function(){function e(){}return e.getLibelleProduit=function(e){switch(e){case"00":return"Livret A";case"01":return"Livret B";case"04":return"Compte de dépôt (C.D.D.)";case"05":return"LEP";case"06":return"CODEVI";case"08":return"CEE";case"11":return"LEL";case"19":return"LEE";default:return null}},e.getLibelleComposition=function(e){switch(e){case"1":return"Mode simple";case"2":return"Mode joint entre époux";case"3":return"Mode joint";case"4":return"Mode indivision successorale";case"5":return"Mode indivision conventionnel avec solidarité";case"6":return"Mode indivision conventionnel sans solidarité";default:return null}},e}();e.CompteHelper=n}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.List,r=e.Commun.ToolsFunctionals.Personne,a=function(){function a(e,t,n,i,r,a,o,s,u,c){this._listePayeurBeforeEdit=[],this._codeTypeAcces=c,this._listeModeRecouvrement=u,this.listeCategorieEmprunteur=o,this.listeMotifChangement=s,this.categorie=_.find(o,function(t){return t.codeCategorie===e.codeCategorieEmprunteur}),this.motifChangement=this.getMotifChangement(s,e.codeMotifAvenantPersonne),this._idEntiteTitulaireInitiale=e.codeEmprunteur,this.idEntiteTitulaire=angular.copy(this._idEntiteTitulaireInitiale),this.afficherBoutonPayeur=this.getAfficherBoutonPayeur(this._codeTypeAcces,this.idEntiteTitulaire,this._idEntiteTitulaireInitiale),this.libelleLong=e.libelleTiers,this.listePersonneEmprunteur=this.getListePersonneEmprunteur(n,r,a,i),this.listePayeurStock=this.getListePayeurEmprunteurActuel(t,this.listePersonneEmprunteur,u),this.payeurSecours=this.getPayeurSecours(e,this.listePersonneEmprunteur,u)}return Object.defineProperty(a.prototype,"listePayeurAvailables",{get:function(){return _.filter(this.listePayeurStock,function(e){return e.etatManipulation!==t.Enum.EtatManipulation.ToDelete})},enumerable:!0,configurable:!0}),a.prototype.getAfficherBoutonPayeur=function(t,n,i){return t===e.Commun.Enum.CodeTypeAcces.Creation?i!==n:!0},a.prototype.addPayeur=function(){var e=_.last(this.listePayeurStock);this.listePayeurStock.push(new n.Payeur(null!=e?e.idIhm+1:0,null,null,this._listeModeRecouvrement))},a.prototype.setPayeurEdition=function(e,n){var i=_.findIndex(this.listePayeurStock,function(e){return e.idIhm===n});switch(e){case t.Enum.ActionManipulationElement.Modifier:this._listePayeurBeforeEdit.push(angular.copy(_.find(this.listePayeurStock,function(e){return e.idIhm===n}))),this.listePayeurStock[i].modeEdition=!0;break;case t.Enum.ActionManipulationElement.Annuler:var r=_.findIndex(this._listePayeurBeforeEdit,function(e){return e.idIhm===n});this.listePayeurStock[i]=this._listePayeurBeforeEdit[r],_.remove(this._listePayeurBeforeEdit,function(e){return e.idIhm===n});break;case t.Enum.ActionManipulationElement.Enregistrer:this.listePayeurStock[i].modeEdition=!1,this.listePayeurStock[i].isCreationFirstEdition&&(this.listePayeurStock[i].isCreationFirstEdition=!1),_.remove(this._listePayeurBeforeEdit,function(e){return e.idIhm===n}),this.listePayeurStock[i].etatManipulation!==t.Enum.EtatManipulation.IsCreation&&(this.listePayeurStock[i].etatManipulation=t.Enum.EtatManipulation.IsModified);break;case t.Enum.ActionManipulationElement.Supprimer:if(this.listePayeurStock[i].etatManipulation===t.Enum.EtatManipulation.IsCreation)_.remove(this.listePayeurStock,function(e){return e.idIhm===n});else{if(this.listePayeurStock[i].modeEdition){var a=_.findIndex(this._listePayeurBeforeEdit,function(e){return e.idIhm===n});this.listePayeurStock[i]=this._listePayeurBeforeEdit[a],_.remove(this._listePayeurBeforeEdit,function(e){return e.idIhm===n})}this.listePayeurStock[i].etatManipulation=t.Enum.EtatManipulation.ToDelete}}},a.prototype.setPayeurSecoursEdition=function(e){switch(e){case t.Enum.ActionManipulationElement.Modifier:this._payeurSecoursBeforeEdit=angular.copy(this.payeurSecours),this.payeurSecours.modeEdition=!0;break;case t.Enum.ActionManipulationElement.Annuler:this.payeurSecours=this._payeurSecoursBeforeEdit,this._payeurSecoursBeforeEdit=null;break;case t.Enum.ActionManipulationElement.Enregistrer:this.payeurSecours.modeEdition=!1,this._payeurSecoursBeforeEdit=null}},a.prototype.setDataEmprunteurNouveau=function(e){this.idEntiteTitulaire=e.nouvelEmprunteur.identifiantEmprunteur,this.libelleLong=e.nouvelEmprunteur.libelleTiers,this.afficherBoutonPayeur=this.getAfficherBoutonPayeur(this._codeTypeAcces,this.idEntiteTitulaire,this._idEntiteTitulaireInitiale),this.listePersonneEmprunteur=this.getListePersonneEmprunteur(e.listePersonneEmprunteurs,e.listeParticulierInformation,e.listeCorporateInformation,e.listePersonneWithComptes),this.listePayeurStock=this.getListePayeurNouvelEmprunteur(this.listePersonneEmprunteur,this._listeModeRecouvrement),this.payeurSecours=this.getPayeurSecours(null,this.listePersonneEmprunteur,this._listeModeRecouvrement)},a.prototype.getMotifChangement=function(e,t){var n=t||"MD";return _.find(e,function(e){return e.codeMotifBlocage===n})},a.prototype.getListePersonneEmprunteur=function(e,t,i,r){var a=this,o=_.map(e,function(e){var o=_.find(r||[],function(t){return e.identifiantPersonne===t.identifiantPersonne});return n.PersonneEmprunteurBuilder.getPersonneEmprunteur(a.getParticulierInformationByPersonne(e,t),a.getCorporateInformationByPersonne(e,i),o,e)});if(o.length>0){var s=_.max(o,function(e){return e.numeroOrdrePersonne}).numeroOrdrePersonne;_.each(o,function(e){0===e.numeroOrdrePersonne&&(s++,e.numeroOrdrePersonne=s)})}return _.sortBy(o,function(e){return e.numeroOrdrePersonne})},a.prototype.getParticulierInformationByPersonne=function(e,t){return"P"===e.codeTypePersonne?i.findOrEmpty(t||[],function(t){return e.identifiantPersonne===_.padLeft((t.identifiantPersonne||"").toString(),9,"0")}):null},a.prototype.getCorporateInformationByPersonne=function(e,t){return"M"===e.codeTypePersonne?i.findOrEmpty(t||[],function(t){return e.identifiantPersonne===_.padLeft((t.identifiantTiers||"").toString(),9,"0")}):null},a.prototype.getListePayeurEmprunteurActuel=function(e,t,r){var a=0;return _.map(e||[],function(e){return new n.Payeur(a++,e,i.findOrEmpty(t,function(t){return e.identifiantPersonne===t.idPersonne}),r)})},a.prototype.getListePayeurNouvelEmprunteur=function(e,t){if(e.length>0){var i=0;return[new n.Payeur(i++,null,_.first(e),t)]}return[]},a.prototype.getPayeurSecours=function(t,i,r){var a=this.getListePersonnePayeurSecours(i);return null!=t?new n.FluxFinancierPayeur(r,a,t.codeModeReglementEmprunteur,t.numDomiciliationSecoursEmp,t.referenceUniqueMandat):new n.FluxFinancierPayeur(r,a,e.Commun.Constantes.Donnees.codeModeReglementDefaut,null,null,!0)},a.prototype.getListePersonnePayeurSecours=function(t){var n=_.some(t,function(t){return t.typePersonne===e.Commun.Enum.TypePersonne.PersonneMorale&&r.isRoleEmprunteur(t.role)});return n?_.filter(t,function(t){return t.typePersonne===e.Commun.Enum.TypePersonne.PersonneMorale}):t},a}();n.EmprunteurNouveau=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(e,t,n,i,r,a){void 0===a&&(a=!1),this.listeModeRecouvrement=e,this.modeRecouvrement=_.find(this.listeModeRecouvrement,function(e){return e.codeModeReglement===n}),this.listePersonne=t,this.initDomiciliation(null!=this.modeRecouvrement?this.modeRecouvrement.codeTypeDomiciliation:null,i,r,t),this.modeEdition=a}return Object.defineProperty(t.prototype,"isInvalid",{get:function(){return!this.isCompteValid()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRumRequired",{get:function(){return"TAS"!==this.modeRecouvrement.codeModeReglement},enumerable:!0,configurable:!0}),t.prototype.isCompteValid=function(){return null!=this.modeRecouvrement&&this.modeRecouvrement.codeTypeDomiciliation===e.Commun.Constantes.Donnees.ModeFluxFinancier.codeReleveIdentiteBancaire?null!=this.compte:!0},t.prototype.initDomiciliation=function(t,n,i,r){if(this.compte=null,this.iban=null,this.bic=null,this.referenceUniqueMandat=null,this.libelleReglement=null,null!=n)switch(t){case e.Commun.Constantes.Donnees.ModeFluxFinancier.codeReleveIdentiteBancaire:var a=_.reduce(_.map(r,function(e){return e.listeCompte}),function(e,t){return _.union(e,t)},[]),o=_.find(a,function(e){return e.numeroCompte===n});this.compte=null!=o?o:{numeroCompte:n};break;case e.Commun.Constantes.Donnees.ModeFluxFinancier.codeSepaBicIban:this.bic=n.substring(0,11),this.iban=n.substring(11,n.length),this.referenceUniqueMandat=i;break;case e.Commun.Constantes.Donnees.ModeFluxFinancier.codeSaisieLibre:case e.Commun.Constantes.Donnees.ModeFluxFinancier.codeTresorerie:this.libelleReglement=n}},t}();t.FluxFinancierPayeur=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=function(n){function i(i,a,o,s){var u=null!=a;n.call(this,s,null!=o?[o]:[],u?a.codeModeReglement:e.Commun.Constantes.Donnees.codeModeReglementDefaut,u?a.numDomiciliationMisRecouvrement:null,u?a.referenceUniqueMandat:null),this.idIhm=i,this.isNouveauPayeur=null===o,this.typePersonne=null!=o?o.typePersonne:e.Commun.Enum.TypePersonne.PersonnePhysique,this.libelle=null!=o?r.getLibellePayeur(o):null,this.loadingData=!1,u?(this.moyenRepartition=(a.montantFixePayeurSurEcheance||0)>0?t.Enum.PayeurMoyenRepartition.MontantFixe:t.Enum.PayeurMoyenRepartition.QuotePart,this.montantFixe=a.montantFixePayeurSurEcheance,this.partInterets=a.pourcentagePayeurSurInteret,this.partCapital=a.pourcentagPayeurSurAmortisement,this.partAccessoires=a.pourcentagePayeurSurAssurAccess,this.isCreationFirstEdition=!1,this.etatManipulation=t.Enum.EtatManipulation.Unchanged):(this.moyenRepartition=t.Enum.PayeurMoyenRepartition.QuotePart,this.partInterets=100,this.partCapital=100,this.partAccessoires=100,this.montantFixe=0,this.modeEdition=!0,this.isCreationFirstEdition=!0,this.etatManipulation=t.Enum.EtatManipulation.IsCreation)}return __extends(i,n),Object.defineProperty(i.prototype,"isEditionCanBeCanceled",{get:function(){return this.modeEdition&&!this.isCreationFirstEdition},enumerable:!0,configurable:!0}),i}(n.FluxFinancierPayeur);n.Payeur=i;var r=function(){function e(){}return e.getLibellePayeur=function(e){return e.libelleLong+" ("+e.idPersonne+")"},e}();n.PayeurHelper=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=e.Commun.ToolsFunctionals.Personne,r=function(){function t(){}return t.getResult=function(e,t){var r=this.getEncoursPersonneAssu(t,e.identifiantPersonneEstAssure);return{identifiantPersonne:e.identifiantPersonneEstAssure,role:i.getRoleByCode(e.typeRolePersonne),libelleLong:e.libelleTiers+" - "+e.identifiantPersonneEstAssure+" "+this.getDescriptionAge(e.dateNaissance)+" - "+i.getLibelleRole(e.typeRolePersonne),libelleTiers:e.libelleTiers,estPersonnePhysique:"P"===e.codeTypePersonne,dateNaissance:n.parse(e.dateNaissance),montantEncours:null!=r?0:r.montantEncours,quotiteCouvertureCredit:null!=r?0:r.quotiteCouvertureCredit}},t.getDescriptionAge=function(e){var t=moment().diff(moment(e),"years");return isNaN(t)?"":" - "+t.toString()+" ans"},t.getResultByRecherchePersonne=function(t,i){var r=t.personneSelectionnee,a=e.Commun.Enum.RolePersonne.caution,o=r.personnePhysique?this.getLibelleTiersWithComplement(r)+" - "+r.identifiantPersonne+" "+this.getDescriptionAge(n.format(r.dateNaissance,e.Commun.Constantes.Format.DATE_REST))+" - "+a.value:r.raisonSociale+" - "+r.identifiantPersonne+" - "+r.siren,s=this.getEncoursPersonneAssu(i,r.identifiantPersonne);return{identifiantPersonne:r.identifiantPersonne,role:a,libelleLong:o,libelleTiers:r.personnePhysique?this.getLibelleTiersPersonne(r):r.raisonSociale,estPersonnePhysique:r.personnePhysique,dateNaissance:n.parse(n.format(r.dateNaissance,e.Commun.Constantes.Format.DATE_REST)),montantEncours:null!=s?0:s.montantEncours,quotiteCouvertureCredit:null!=s?0:s.quotiteCouvertureCredit}},t.getLibelleTiersPersonne=function(e){switch(e.codeCivilite){case"1":return null!=e.nomMarital?"Mme "+e.nomMarital+" "+e.prenom:"Mme "+e.nomFamille+" "+e.prenom;case"2":return"Mlle "+e.nomFamille+" "+e.prenom;case"3":return"Mr "+e.nomFamille+" "+e.prenom;default:return e.designationCourte}},t.getLibelleTiersWithComplement=function(e){return"1"===e.codeCivilite&&null!=e.nomMarital?this.getLibelleTiersPersonne(e)+" née "+e.nomFamille:this.getLibelleTiersPersonne(e)},t.getResultByPersonneEmprunteur=function(t,n){var i=null!=t.role?" - "+t.role.value:"",r=this.getEncoursPersonneAssu(n,t.idPersonne);return{identifiantPersonne:t.idPersonne,role:t.role,libelleLong:t.libelleLong+" - "+t.idPersonne+this.getDescriptionAge(t.dateNaissance)+i,libelleTiers:t.libelleTiers,estPersonnePhysique:t.typePersonne===e.Commun.Enum.TypePersonne.PersonnePhysique,dateNaissance:t.dateNaissance,montantEncours:null!=r?0:r.montantEncours,quotiteCouvertureCredit:null!=r?0:r.quotiteCouvertureCredit}},t.getEncoursPersonneAssu=function(e,t){return _.find(e||[],function(e){return e.identifiantPersonneEstAssu===t})||{codeEtablissement:0,identifiantPersonneEstAssu:t,identifiantCredit:"",montantEncours:0,quotiteCouvertureCredit:0}},t.existEncoursPersonneAssu=function(e,t){return _.some(e||[],function(e){return e.identifiantPersonneEstAssu===t})},t}();t.PersonneAssurableGarantBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.Personne,i=function(){function i(){}return i.getPersonneEmprunteur=function(t,i,r,a,o){void 0===o&&(o=[]);var s=null!=a?n.getRoleByCode(a.typeRolePersonne):null,u=null!=i?this.getPersonneEmprunteurBasePersonneMorale(i,s):this.getPersonneEmprunteurBasePersonnePhysique(t,a);return u.role=null!=s?s:e.Commun.Enum.RolePersonne.payeur,u.libelleLongWithIdAndRole=this.getLibelleLongWithIdAndRole(u.libelleLong,u.idPersonne,s),u.numeroOrdrePersonne=null!=a?a.noOrdrePersonneDansEmprunteur:0,u.listeCompte=null!=r?this.getListeCompte(r):[],u.listeEntiteTitulaireResume=o,u},i.getPersonneEmprunteurBasePersonnePhysique=function(i,r){var a=null!=r?r.typeRolePersonne:null,o=null!=a?_.contains([e.Commun.Enum.RolePersonne.emprunteur.key,e.Commun.Enum.RolePersonne.personneEmprunteur.key],a):!0;return{idPersonne:_.padLeft((i.identifiantPersonne||"").toString(),9,"0"),libelleTiers:t.PersonneEmprunteurHelper.getLibelleTiersPersonne(i),libelleLong:t.PersonneEmprunteurHelper.getLibelleLongPersonneCustom(i,!1,!1),libelleLongWithIdAndRole:null,libelleDescription:t.PersonneEmprunteurHelper.getLibelleLongPersonneCustom(i,!0,o,o?null:a),dateNaissance:e.Commun.Tools.DateUtils.parse(i.dateNaissance),genrePersonne:n.getGenre(i.codeSexe),typePersonne:e.Commun.Enum.TypePersonne.PersonnePhysique,listeCompte:null,role:null,listeEntiteTitulaireResume:null,numeroOrdrePersonne:null,raisonSociale:null}},i.getPersonneEmprunteurBasePersonneMorale=function(t,i){var r=null!=i?" - "+i.value:"";return{idPersonne:_.padLeft((t.identifiantTiers||"").toString(),9,"0"),libelleTiers:t.nomCommercial,libelleLong:t.nomCommercial,libelleLongWithIdAndRole:null,libelleDescription:""+t.nomCommercial+r,dateNaissance:null,genrePersonne:n.getGenre(null),typePersonne:e.Commun.Enum.TypePersonne.PersonneMorale,role:null,listeCompte:null,listeEntiteTitulaireResume:null,numeroOrdrePersonne:null,raisonSociale:t.raisonSociale}},i.getLibelleLongWithIdAndRole=function(e,t,n){var i=null!=n?" - "+n.value:"";return e+" ("+t+")"+i},i.getListeCompte=function(e){return _.map(_.filter(e.comptes||[],function(e){return"04"===e.codeProduit||"08"===e.codeProduit}),function(e){return t.CompteBuilder.getCompte(e)})},i}();t.PersonneEmprunteurBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=e.Commun.ToolsFunctionals.Personne,r=function(){function e(){}return e.getLibelleLongPersonneCustom=function(e,t,n,r){void 0===r&&(r=null);var a=t?" "+this.getPartLibelleCustomDateNaissance(e):"",o=n?" - "+i.getSituationFamiliale(e.codeSituationFamiliale):"",s=null!=r?" - "+i.getLibelleRole(r):"";return""+this.getLibelleLongPersonne(e)+a+o+s},e.getPartLibelleCustomDateNaissance=function(e){var t=n.format(e.dateNaissance);switch(e.codeCivilite){case"1":return null!=e.nomMarital?"le "+t:"née le "+t;case"2":return"née le "+t;case"3":return"né le "+t;default:return""}},e.getLibelleTiersPersonne=function(e){switch(e.codeCivilite){case"1":return null!=e.nomMarital?"Mme "+e.nomMarital+" "+e.prenom:"Mme "+e.nomFamillePersonnePhysique+" "+e.prenom;case"2":return"Mlle "+e.nomFamillePersonnePhysique+" "+e.prenom;case"3":return"Mr "+e.nomFamillePersonnePhysique+" "+e.prenom;default:return e.designationCourte}},e.getLibelleLongPersonne=function(e){return"1"===e.codeCivilite&&null!=e.nomMarital?this.getLibelleTiersPersonne(e)+" née "+e.nomFamillePersonnePhysique:this.getLibelleTiersPersonne(e)},e.normeBic=function(e){var t=e.trim();if(t.length<11)for(;t.length<11;)t+=" ";else t=t.substring(0,11);return t},e}();t.PersonneEmprunteurHelper=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e,t,n,i,r,a,o){var s=null!=e;this.isLastPalierOfLastPhase=i,s?(this.numeroPhase=e.numeroPhase,this.numeroRelatif=e.numeroRelatif,this.numeroEcheance=e.numeroEcheance,this.tauxRemboursementSaisi=e.tauxRemboursementSaisi,this.isMontantModifiable=this.getIsMontantModifiablePalier(a,e.numeroPremiereEcheancePalier,r,i),this.tauxProgression=e.tauxRemboursementSaisi,this.codeTypeElementSaisiSurCredit=e.codeTypeElementSaisiSurCredit,this.montantEcheanceEnCours=e.montantEcheanceEnCours,this.montantAmortissementCreditSaisi=e.montantAmortissementCreditSaisi,this.montantRemboursementSaisi=e.montantRemboursementSaisi,this.montantEcheanceMaj=this.getMontantEcheanceMaj(e,r,this.codeTypeElementSaisiSurCredit)):(this.numeroRelatif=t.numeroRelatif,this.numeroPhase=t.numeroPhase,this.numeroEcheance=t.numeroEcheance,this.codeTypeElementSaisiSurCredit=t.codeTypeElementSaisiSurCredit,this.tauxRemboursementSaisi=t.tauxRemboursementSaisi,this.montantAmortissementCreditSaisi=t.montantAmortissementCreditSaisi,this.montantRemboursementSaisi=o?t.montantRemboursementSaisi:t.montantEcheanceEnCours,this.montantEcheanceEnCours=t.montantEcheanceEnCours,this.montantEcheanceMaj=this.montantRemboursementSaisi,this.isMontantModifiable=!i&&"O"===n,this.tauxProgression=t.tauxRemboursementSaisi)}return e.prototype.getMontantEcheanceMaj=function(e,t,n){if(e.numeroPremiereEcheancePalier>t&&e.echeanceApresAjusteCalculette>0)return e.echeanceApresAjusteCalculette;switch(n){case"D":return 0!==e.montantEcheanceEnCours?e.montantEcheanceEnCours:e.montantRemboursementSaisi;case"A":return e.montantAmortissementCreditSaisi;case"E":return e.montantRemboursementSaisi}},e.prototype.getIsMontantModifiablePalier=function(e,t,n,i){var r=0===e||3===e;return r&&!i&&t>n},e}();e.EcheanceALaCarte=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.List,r=e.Commun.Tools.Object,a=function(){function n(e,n,a,o,s,u){this.palierProgAmorProduit=i.findOrEmpty(a.paliersProgressionAmortissement,function(t){return t.numeroRelatif===e.numeroRelatif});var c=i.findOrEmpty(n.phases,function(t){return t.numeroPhase===e.numeroPhase});this.codeRoleCreditAvenant=o?"U":"",this.numeroPhase=e.numeroPhase,this.numeroRelatif=this.numeroPalier=e.numeroRelatif,this.numeroPremiereEcheance=e.numeroPremiereEcheancePalier,this.numeroDerniereEcheance=e.numeroDerniereEcheancePalier,this.cdIndexTauxProgAmor=e.cdIndexTauxProgressionAmort,this.uniteDureePhase=e.uniteDureePhase,this.numeroRelatif1=n.numeroRelatif,this.numeroRelatifSimulationAvenant=n.numeroRelatifSimulationAvenant,this.numPhaseCreditProchaineRev=e.noPhaseCreditProchaineRevision,this.numeroRelatif2=e.numeroRelatif2,this.elementModifiableParAvenant=this.getElementModifiableParAvenant(s,this.numeroDerniereEcheance,n.numeroEcheance),this.codeOccurAbsorbeePhasePalier=e.codeOccurabsorbeePhasePalier,this.titrePalier="Palier ",this.isIndexeTauxInteret="O"===this.cdIndexTauxProgAmor,this.desactiverIndexationTauxInteret=!this.activerIndexationTauxInteret(o,s,this.palierProgAmorProduit),this.indexeTauxInteret=this.isIndexeTauxInteret?"Déduit du taux d'interêt":"Non déduit du taux d'interêt",this.activerTauxProgAmor=this.activerSaisieTauxProgAmor(s,this.isIndexeTauxInteret),this.tauxProgAmor=this.tauxProgAmorInitial=t.ToolsFunctionals.ModificationTauxProgAmor.getTauxProgressionAmortissement(this.isIndexeTauxInteret,e.tauxProgressionAmortissement,u,this.numeroPremiereEcheance),this.tauxProgAmorMin=this.palierProgAmorProduit.tauxProgressionAmortissement,this.tauxProgAmorMax=this.palierProgAmorProduit.tauxProgressionAmortissement1,this.libelleHelpTauxProgAmor="["+r.numberToString(this.tauxProgAmorMin,2)+" .. "+r.numberToString(this.tauxProgAmorMax,2)+"]",this.libelleErreurTauxProgAmor="Le taux de progression d'amortissement doit être dans les bornes autorisées.",this.nbEcheance=this.nbEcheanceInit=this.numeroDerniereEcheance-this.numeroPremiereEcheance+1,this.isPalierADateEffet=this.numeroPremiereEcheance<=n.numeroEcheance&&n.numeroEcheance<=this.numeroDerniereEcheance,this.isPalierApresDateEffet=this.numeroPremiereEcheance>=n.numeroEcheance,this.isAffichagePalierDateEffet=this.isPalierADateEffet||this.isPalierApresDateEffet,this.libelleErreurModifPaliers=[],this.statutAbsorptionPalier=t.ToolsFunctionals.ModificationTauxProgAmor.fctIsDureePalierProgAmorAbsorbee(n.uniteDureeCredit,n.dureeAjusteeCreditSuiteRecalcul,c.paliersTauxAmortissement,e,c.codeTypePhase,c.uniteDureePhase,c.dureeInitialePhaseCredit,c.numeroPhase,n.codeRoleCreditAvenant,c.periodiciteMERamortissement)}return Object.defineProperty(n.prototype,"isTauxProgAmorInvalid",{get:function(){return this.activerTauxProgAmor&&!this.isTauxProgAmorValid()},enumerable:!0,configurable:!0}),n.prototype.getElementModifiableParAvenant=function(t,n,i){return t===e.Commun.Enum.CodeTypeAcces.Creation?n>i?"O":"N":void 0},n.prototype.activerIndexationTauxInteret=function(t,n,i){return(n===e.Commun.Enum.CodeTypeAcces.Creation||n===e.Commun.Enum.CodeTypeAcces.Modification||n===e.Commun.Enum.CodeTypeAcces.Duplication)&&t&&"P"===i.codeTypeTauxProgreAmortissement},n.prototype.activerSaisieTauxProgAmor=function(t,n){return(t===e.Commun.Enum.CodeTypeAcces.Creation||t===e.Commun.Enum.CodeTypeAcces.Modification||t===e.Commun.Enum.CodeTypeAcces.Duplication)&&!n},n.prototype.isTauxProgAmorValid=function(){return null!=this.tauxProgAmor&&!this.isIndexeTauxInteret&&this.tauxProgAmor>=this.tauxProgAmorMin&&this.tauxProgAmor<=this.tauxProgAmorMax;
},n}();n.PalierProgAmor=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.List,r=e.Commun.Tools.Object,a=e.Commun.ToolsFunctionals.Periodicite,o=function(){function o(n,o,s,u,c,l,d,m,h,p){var f=u.numeroEcheance,A=_.first(d.paliers),P=this.getConditionTauxProduit(m,u,l,"PF"!==d.codeTypePhase),v=this.getModeCalculTaux(u,l,d,A,P,h);this.activerTauxPalier=this.getActiverTaux(v,u,d,A,l.codeTauxCreditDirecteur,h);var g=t.ToolsFunctionals.FonctionsPhasePalier.getModalite(u.numModaliteRemboursemntAnticipe,d.codeFamilleProduit,d.numeroRelatifProduit,l.modalites),C=this.getTauxMinMax(u,g,A,l);this.tauxMinimum=C[0],this.tauxMaximum=C[1],this.numeroPalier=o,this.numeroPhase=n.numeroPhase,this.periodiciteMERamortissement=c.periodiciteMERamortissement,this.periodiciteMERinteretPhase=c.periodiciteMiseRecouvrInterets,this.numeroRelatif=n.numeroRelatif,this.tauxInit=n.tauxInteretPalier,this.taux=n.tauxInteretPalier,this.marge=n.margeAppliquerSurTaux,this.margeInit=n.margeAppliquerSurTaux,this.indice=n.codeIndice,this.numeroPremiereEcheance=n.numeroPremiereEcheancePalier,this.numeroDerniereEcheance=n.numeroDerniereEcheancePalier,this.setDureePalier(n.numeroPremiereEcheancePalier,n.numeroDerniereEcheancePalier),this.libellePeriodeDuree=a.getLibellePeriode(c.periodiciteMERamortissement,this.duree>1),this.isDureeModifiable=!1,this.elementModifiableParAvenant=this.getElementModifiableParAvenant(n,c.codeTypePhase,f,h),this.isPalierModifiableParAvenant="O"===this.elementModifiableParAvenant,this.cdModifCaracteristfinancieres=h?n.cdModifCaracteristfinancieres:p===e.Commun.Enum.CodeTypeAcces.Creation?"":null,this.codeRoleCreditAvenant=h?c.codeRoleCreditAvenant:"",this.typeRemboursement=n.typeRemboursement,this.isAfterDateEffet="O"===n.elementModifiableParAvenant,this.listeEcheanceALaCarte=this.getListeEcheanceALaCarte(s,n.elementModifiableParAvenant,h),this.palierByRest=n,this.valeurTaux="Taux : "+r.numberToString(this.taux,4)+" %",this.titrePalier="Palier ",this.isPalierADateEffet=this.numeroPremiereEcheance<=f&&f<=this.numeroDerniereEcheance,this.isPalierApresDateEffet=this.numeroPremiereEcheance>=f,this.isAffichagePalierDateEffet=this.isPalierADateEffet||this.isPalierApresDateEffet,this.showIndicePalier=this.fctShowIndicePalier(v),this.activerIndicePalier=!1;var E;v===t.Enum.ModeCalculTaux.TauxIndexe&&(E=this.getParametreRevision(m,i.firstOrEmpty(c.parametresRevisionTaux),d)),this.showMargePalier=this.fctShowMargePalier(v),this.activerMargePalier=this.fctActiverMargePalier(v,u,d,l.codeTauxCreditDirecteur,h,E),this.isPalierDirecteur=this.activerTauxPalier||this.activerIndicePalier||this.activerMargePalier,this.numeroRelatif1=n.numeroRelatif1,this.statutAbsorptionPalier=t.ToolsFunctionals.FonctionsPhasePalier.fctIsDureePalierAbsorbee(u.uniteDureeCredit,u.dureeAjusteeCreditSuiteRecalcul,c.paliersTauxInterets,n,c.codeTypePhase,c.uniteDureePhase,c.dureeInitialePhaseCredit,c.numeroPhase,u.codeRoleCreditAvenant,c.periodiciteMiseRecouvrInterets),this.isDureePalierAbsorbee=this.statutAbsorptionPalier!==t.Enum.StatutAbsorption.PasAbsorbe,this.tauxProgEch=this.tauxProgEchInitial=n.tauxProgressionDesEcheances,null!=A?(this.tauxProgEchMin=A.tauxProgressionDesEcheances,this.tauxProgEchMax=A.tauxProgressionDesEcheances1,this.activerTauxProgEch=t.ToolsFunctionals.ModificationTauxProgEch.getActiverTauxProgEch(A.cdTypeTauxProgressionEcheances,this.tauxProgEchMin,this.tauxProgEchMax)):(this.tauxProgEchMin=0,this.tauxProgEchMax=0,this.activerTauxProgEch=!1,console.error("paliers inexistant dans phaseByProduit :",d)),this.libelleHelpTauxProgEch="["+r.numberToString(this.tauxProgEchMin,2)+" .. "+r.numberToString(this.tauxProgEchMax,2)+"]",this.libelleErreurTauxProgEch="Le taux de progression des échéances doit être dans les bornes autorisées.",this.libelleErreurModifPaliers=[],this.isPalierAvecTauxProgEchAZero=this.activerTauxProgEch&&0===this.tauxProgEch}return Object.defineProperty(o.prototype,"echeanceALaCarteForCalculatrice",{get:function(){return this.listeEcheanceALaCarte.length>0?_.first(this.listeEcheanceALaCarte):null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isTauxProgEchInvalid",{get:function(){return this.activerTauxProgEch&&!this.isTauxProgEchValid()},enumerable:!0,configurable:!0}),o.prototype.getElementModifiableParAvenant=function(e,t,n,i){return _.isEmpty(e)?"":i&&1===e.numeroPhase?e.elementModifiableParAvenant:"PF"!==t?e.numeroDerniereEcheancePalier>n?"O":"N":e.elementModifiableParAvenant},o.prototype.getListeEcheanceALaCarte=function(e,t,i){return 0===(e||[]).length?[]:_.map(_.sortBy(e,function(e){return e.numeroEcheance}),function(e){return new n.EcheanceALaCarte(null,e,t,!1,0,0,i)})},o.prototype.setDureePalier=function(e,t){this.duree=t-e+1},o.prototype.reportTauxFromPhase=function(e,t,n){this.taux=e,this.marge=t,this.elementModifiableParAvenant="O",this.cdModifCaracteristfinancieres="1",n&&(this.numeroRelatif+=1)},o.prototype.reportNouvelleDureeToDernierPalier=function(e){this.duree=this.getDureeConverted(e,"M",this.periodiciteMERinteretPhase),this.numeroDerniereEcheance=this.numeroPremiereEcheance+this.duree-1,this.cdModifCaracteristfinancieres="1"},o.prototype.getDureeConverted=function(t,n,i){return n===i?t:e.Commun.ToolsFunctionals.FonctionsAvenant.simulConvDuree(n,t,i,0)},o.prototype.getConditionTauxProduit=function(e,t,n,r){return i.findOrEmpty(n.conditionsTauxProduit,function(i){var a=i.codeFamilleProduit+i.numeroRelatifProduit===t.identifiantProduit&&moment(e).isBetween(i.dateDebutApplication,i.dateFinApplication,"day");return r?"O"===n.codeTauxCreditDirecteur?a:a&&i.dureeMinimumPlageConditionTaux<=t.dureeAjusteeCreditSuiteRecalcul&&t.dureeAjusteeCreditSuiteRecalcul<=i.dureeMaximumPlageConditionTaux:void 0})},o.prototype.getModeCalculTaux=function(e,n,i,r,a,o){if("PF"!==i.codeTypePhase&&"O"===n.codeTauxCreditDirecteur||"PF"!==i.codeTypePhase&&null!=r&&"1"===r.codeTypeTauxInteret&&"1"===i.cdModeExpressionTauxMoyenPhase)switch(a.codeModeExpressionTaux){case"2":return t.Enum.ModeCalculTaux.TauxFixe;case"3":return t.Enum.ModeCalculTaux.TauxIndexe;case"4":return o||"O"!==e.codePresenceRevisionSurCredit?t.Enum.ModeCalculTaux.TauxAppel:t.Enum.ModeCalculTaux.TauxIndexe}return"2"===i.cdModeExpressionTauxMoyenPhase?t.Enum.ModeCalculTaux.TauxFixe:"3"===i.cdModeExpressionTauxMoyenPhase?t.Enum.ModeCalculTaux.TauxIndexe:t.Enum.ModeCalculTaux.TauxFixe},o.prototype.getActiverTaux=function(e,n,i,r,a,o){if(e===t.Enum.ModeCalculTaux.TauxFixe){var s=t.ToolsFunctionals.FonctionsPhasePalier.getIsVariationIndice(null);if(!o&&"1"!==i.codeTauxDesPaliersCalcules&&!s&&"O"!==n.codeCristallisationTauxInteret)return!0;if(o&&"O"!==a&&"1"!==r.codeTypeTauxInteret)return!0}else if(e===t.Enum.ModeCalculTaux.TauxAppel)return!1;return!1},o.prototype.getTauxMinMax=function(e,n,i,r){var a=0,o=0;if(!_.isEmpty(i)&&(0!==i.tauxInteret1||"PZ"===r.codeFamilleControle||"ZO"===r.codeFamilleControle)){var s=t.ToolsFunctionals.FonctionsPhasePalier.getSurcoutRa(e.numModaliteRemboursemntAnticipe,n)+e.cumulBonificationsMajorations;a=i.tauxInteret+s,o=i.tauxInteret1+s}return[a,o]},o.prototype.fctShowIndicePalier=function(e){return e===t.Enum.ModeCalculTaux.TauxIndexe},o.prototype.fctShowMargePalier=function(e){return e===t.Enum.ModeCalculTaux.TauxIndexe||e===t.Enum.ModeCalculTaux.TauxAppel},o.prototype.fctActiverMargePalier=function(e,n,i,r,a,o){if(e===t.Enum.ModeCalculTaux.TauxIndexe){if(!a){var s="";if(angular.isDefined(o)&&(s="Q"===o.mdExpressionValeurUtilisIndice||"D"===o.mdExpressionValeurUtilisIndice?"O":"N"),"N"===i.codeTauxDesPaliersCalcules&&"O"!==n.codeCristallisationTauxInteret&&"O"!==s)return!0}if(a&&"O"!==r&&"N"===i.codeTauxDesPaliersCalcules)return!0}return!1},o.prototype.getParametreRevision=function(e,t,n){var i,r=moment(e);if(angular.isDefined(t)&&0!==t.numeroJeuIndicesRevision)for(var a=0,o=n.parametresRevision;a<o.length;a++){var s=o[a],u=moment(s.dateDebutApplication),c=moment(s.dateFinApplication);s.numeroJeuIndicesRevision===t.numeroJeuIndicesRevision&&u.isBefore(r)&&r.isBefore(c)&&"I1"===s.codeTypeRoleIndice&&(i=angular.copy(s))}return i},o.prototype.isTauxProgEchValid=function(){return null!=this.tauxProgEch&&this.tauxProgEch>=this.tauxProgEchMin&&this.tauxProgEch<=this.tauxProgEchMax},o}();n.Palier=o}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.numeroPhase=e.numeroPhase,this.paramRevTauxRest=e}return e}();e.ParametreRevisionTaux=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.List,r=e.Commun.Tools.DateUtils,a=e.Commun.Tools.Object,o=e.Commun.ToolsFunctionals.Credit,s=e.Commun.ToolsFunctionals.Periodicite,u=e.Commun.ToolsFunctionals.FonctionsAvenant,c=e.Commun.ToolsFunctionals.Avenant,l=function(){function l(r,u,c,l,d,m,h,p,f,A,P,v){var g=this;this.phaseByRest=r,this.isChangementProduit=p,this.isCreditDirecteur=f.isCreditDirecteur,this.statutPhase=r.numeroPhase>=u.numeroPhase?t.Enum.StatutPhase.EncoursOuFuture:t.Enum.StatutPhase.Passee,this.numRelatifPhaseTypePhaseProduit=r.noRelatifPhaseTypePhaseProduit,this.phaseByProduit=i.findOrEmpty(c.phases,function(e){return e.codeTypePhase===r.codeTypePhase&&e.noRelatifPhaseTypePhaseProduit===g.numRelatifPhaseTypePhaseProduit});var C=t.ToolsFunctionals.FonctionsPhasePalier.getModalite(u.numModaliteRemboursemntAnticipe,this.phaseByProduit.codeFamilleProduit,this.phaseByProduit.numeroRelatifProduit,c.modalites),E=this.getConditionTauxProduit(m,u,c.conditionsTauxProduit,"PF"!==this.phaseByProduit.codeTypePhase),b=this.getModeCalculTaux(u,c.codeTauxCreditDirecteur,this.phaseByProduit,E,p);this.statutAbsorptionPhase=t.ToolsFunctionals.FonctionsPhasePalier.fctIsDureePhaseAbsorbee(u.uniteDureeCredit,u.dureeAjusteeCreditSuiteRecalcul,u.phases,r,u.codeRoleCreditAvenant),this.numeroPhase=r.numeroPhase,this.numeroPhaseInitial=r.numeroPhase,this.libelleTypePhase=o.getLibelleTypePhase(r.codeTypePhase),this.isPhaseActive=r.numeroPhase===u.numeroPhase,this.isPhasePrefi="PF"===r.codeTypePhase,this.modeTaux="E"===this.phaseByProduit.codeModeCalculTaux?"Actuariel":"Proportionnel",this.listePalier=this.getListePalier(r,d,u,p,c,this.phaseByProduit,m,v),this.statutAbsorptionPhase=t.ToolsFunctionals.FonctionsPhasePalier.majStatutPhaseByPalier(this.listePalier,this.statutAbsorptionPhase),this.isDureePhaseAbsorbee=this.statutAbsorptionPhase!==t.Enum.StatutAbsorption.PasAbsorbe;var T=t.ToolsFunctionals.DureePhase.activerDureeToutePhase(u,this.phaseByProduit,this.isPhasePrefi,v,this.isDureePhaseAbsorbee,this.isChangementProduit,f.codeTypeRecalculTA,this.numeroPhase);if(this.activerDureePhase=r.numeroPhase!==u.phases.length&&(A||P&&T),this.activerDureePhaseDT=!this.activerDureePhase&&T&&("DT"===r.codeTypePhase||"DA"===r.codeTypePhase),this.duree=this.dureeTemp=this.dureeInitiale=this.dureePhaseAvantScission=r.dureeInitialePhaseCredit,this.libelleUniteDuree=s.getLibellePeriode(r.uniteDureePhase,r.dureeInitialePhaseCredit>0),"1"===this.phaseByProduit.modeExpressionDureePhase){var y=[this.phaseByProduit.dureePhaseProduit,this.phaseByProduit.dureePhaseProduit1,this.phaseByProduit.dureePhaseProduit2,this.phaseByProduit.dureeUnePhasePas].filter(function(e){return e>0}).sort();this.dureeMinPhase=this.getDureeMinPhase(r.codeRoleCreditAvenant,y[0]),this.dureeMaxPhase=_.max(y),this.libelleHelpDureePhase=e.Commun.ToolsFunctionals.Duree.getLibelleHelpDuree(y),this.libelleErreurDureePhase="La durée de la phase doit être une des valeurs autorisées."}else this.dureeMinPhase=this.getDureeMinPhase(r.codeRoleCreditAvenant,this.phaseByProduit.dureePhaseProduit),this.dureeMaxPhase=this.phaseByProduit.dureePhaseProduit1,this.libelleHelpDureePhase="["+a.numberToString(this.dureeMinPhase,0)+" .. "+a.numberToString(this.dureeMaxPhase,0)+"]",this.libelleErreurDureePhase="La durée de la phase doit être dans les bornes autorisées.";this.uniteDureePhase=r.uniteDureePhase,this.taux=this.tauxInitial=this.isPhasePrefi?u.tauxInteretPrefinancement:r.tauxNominalPhase,this.showTaux=_.contains([t.Enum.ModeCalculTaux.TauxFixe,t.Enum.ModeCalculTaux.TauxIndexe,t.Enum.ModeCalculTaux.TauxAppel],b),this.activerTaux=this.getActiverTaux(b,u,this.phaseByProduit,c.codeTauxCreditDirecteur,p),this.tauxMinimum=this.getTauxMinPhase(b,this.phaseByProduit,u,C,E),this.tauxMaximum=this.getTauxMaxPhase(b,this.phaseByProduit,u,c.codeFamilleProduit,C,E),this.libelleHelpTaux="["+a.numberToString(this.tauxMinimum,2)+" .. "+a.numberToString(this.tauxMaximum,2)+"]",this.libelleErreurTaux="(Taux + Surcôut RA + Bonification/ Majoration) de la phase doit être dans les bornes autorisées.",this.showQuotiteAmortissement="AM"===r.codeTypePhase&&r.quotiteCapitalAmortir>0,this.quotiteAmortissement=r.quotiteCapitalAmortir,this.indice=r.codeIndiceNominal,this.showIndice=b===t.Enum.ModeCalculTaux.TauxIndexe&&null!=r.codeIndiceNominal,this.activerIndice=!1,this.marge=this.margeInitiale=r.margeAppliquerSurTaux,this.showMarge=_.contains([t.Enum.ModeCalculTaux.TauxIndexe,t.Enum.ModeCalculTaux.TauxAppel],b),this.activerMarge=this.getActiverMarge(b,u,this.phaseByProduit,c.codeTauxCreditDirecteur,p);var M=this.getMargeMinMaxPhase(this.phaseByProduit,u,c.codeFamilleProduit,C,E,p);this.margeMinimum=M[0],this.margeMaximum=M[1],this.libelleHelpMarge="["+a.numberToString(this.margeMinimum,2)+" .. "+a.numberToString(this.margeMaximum,2)+"]",this.isPhaseDirectrice=this.fctIsPhaseDirectrice(r.codeTauxDesPaliersCalcules,p,this.isCreditDirecteur,this.activerTaux,this.activerIndice,this.activerMarge),this.typeFinancement=this.getLibelleTypeFinancement(r.codeTypePhase,c),this.codeTypePhase=r.codeTypePhase,this.isScission=!1,this.elementModifiableParAvenant=t.ToolsFunctionals.FonctionsPhasePalier.getElementModifiableParAvenant(r,u,h),this.cdModifCaracFinanciere=v!==e.Commun.Enum.CodeTypeAcces.Creation||p?r.cdModifCaracteristfinancieres:"",this.prelevementEnFinPhase=r.prelevementEnFinPhase,this.phaseModifieeAte=!1,this.isPhaseImpacteAte=!1,this.parametresRevisionTaux=_.map(r.parametresRevisionTaux||[],function(e){return new n.ParametreRevisionTaux(e)}),this.codeProduitRevisableProduit=c.codeProduitRevisable,this.isPhaseWithDureePalierEdit=!1,this.isPhaseWithEcheancePalierEdit=!1,this.isPalierTauxInteretDirecteur=_.some(this.listePalier,function(e){return e.isPalierDirecteur}),this.activerTauxDirecteur=this.getActiverTauxDirecteur(f.activerTauxCredit,this.activerTaux,this.listePalier,this.isDureePhaseAbsorbee),this.tauxDirecteur=this.tauxDirecteurInit=this.getTauxDirecteur(f,this.isPhaseDirectrice,this.taux,this.listePalier,v),this.tauxMinDirecteur=this.getTauxMinimumDirecteur(f,this.isPhaseDirectrice,this.tauxMinimum,this.listePalier),this.tauxMaxDirecteur=this.getTauxMaximumDirecteur(f,this.isPhaseDirectrice,this.tauxMaximum,this.listePalier),this.libelleHelpTauxDirecteur="["+a.numberToString(this.tauxMinDirecteur,2)+" .. "+a.numberToString(this.tauxMaxDirecteur,2)+"]",this.libelleErreurTauxDirecteur=this.getLibelleErreurTauxDirecteur(f,this.isPhaseDirectrice,this.libelleErreurTaux,this.listePalier),this.showIndiceDirecteur=this.fctShowIndiceDirecteur(f.showIndiceCredit,this.showIndice,this.listePalier),this.activerIndiceDirecteur=this.fctActiverIndiceDirecteur(f.activerIndiceCredit,this.activerIndice,this.listePalier),this.indiceTauxDirecteurs=this.getIndiceDirecteurs(this.isCreditDirecteur,this.isPhaseDirectrice,f.indiceTauxCredits,this.indice,this.listePalier),this.indiceTauxDirecteurSel=this.indiceTauxDirecteurs.length>0?i.firstOrEmpty(this.indiceTauxDirecteurs):"",this._indiceTauxDirecteurSel=this.indiceTauxDirecteurs.length>0?i.firstOrEmpty(this.indiceTauxDirecteurs):"",this.valeurIndice=this.getValeurIndice(this.indiceTauxDirecteurSel,l),this.showMargeDirecteur=this.fctShowMargeDirecteur(f.showMargeCredit,this.showMarge,this.listePalier),this.activerMargeDirecteur=this.fctActiverMargeDirecteur(f.activerMargeCredit,this.activerMarge,this.listePalier),this.margeDirecteur=this.getMargeDirecteur(f,this.isPhaseDirectrice,this.marge,this.listePalier),this.margeMinDirecteur=this.getMargeMinimumDirecteur(f,this.isPhaseDirectrice,this.margeMinimum,this.listePalier),this.margeMaxDirecteur=this.getMargeMaximumDirecteur(f,this.isPhaseDirectrice,this.margeMaximum,this.listePalier),this.libelleHelpMargeDirecteur="["+a.numberToString(this.margeMinDirecteur,2)+" .. "+a.numberToString(this.margeMaxDirecteur,2)+"]",this.libelleErreurMargeDirecteur=this.getLibelleErreurMargeDirecteur(f,this.isPhaseDirectrice,this.listePalier),this.isModifTauxFromModifMarge=this.fctModifTauxFromModifMarge(c.conditionsTauxProduit,this.phaseByProduit,this.marge,this.margeDirecteur,m,f.dureeTotale,p,u),this.isAnciennePhaseEnCours=v===e.Commun.Enum.CodeTypeAcces.Creation?!1:t.ToolsFunctionals.PeriodicitePhase.setIsAnciennePhaseEnCoursOuverture(u.phases,this.numeroPhase,this.codeTypePhase),this.isNouvellePhaseScission=!1,this.periodiciteCalculInterets=this.periodiciteCalculInteretsInitial={codePeriode:r.periodiciteCalculInterets,libellePeriode:s.getLibellePeriodicite(r.periodiciteCalculInterets)},this.listePeriodiciteInteret=t.ToolsFunctionals.PeriodicitePhase.getListePeriodiciteInteret(this.phaseByProduit),this.periodiciteInteret=this.periodiciteInteretInitiale=this.periodiciteInteretTemporaire={codePeriode:r.periodiciteMiseRecouvrInterets,libellePeriode:s.getLibellePeriodicite(r.periodiciteMiseRecouvrInterets)};var D=t.ToolsFunctionals.PeriodicitePhase.phaseRevisionAleatoire(this.parametresRevisionTaux,p,this.numeroPhase,u.numeroPhase,this.phaseByProduit.parametresRevision,this.numRelatifPhaseTypePhaseProduit,this.codeTypePhase);this.activerPeriodiciteInteret=t.ToolsFunctionals.PeriodicitePhase.getActiverPeriodiciteInter(this.listePeriodiciteInteret,this.codeTypePhase,v,p,this.phaseByProduit.modeCalculAmortissement,D,this.isDureePhaseAbsorbee),this.listePeriodiciteAmortissement=t.ToolsFunctionals.PeriodicitePhase.getListePeriodiciteAmortissement(this.phaseByProduit),this.periodiciteAmortissement=this.periodiciteAmortissementInitiale=this.periodiciteAmortissementTemporaire={codePeriode:r.periodiciteMERamortissement,libellePeriode:s.getLibellePeriodicite(r.periodiciteMERamortissement)},this.activerPeriodiciteAmor=t.ToolsFunctionals.PeriodicitePhase.activerPeriodiciteAmortissement(this.listePeriodiciteAmortissement,this.codeTypePhase,v,p,this.phaseByProduit.codePeriodiciteDifferenteMER,this.phaseByProduit.modeCalculAmortissement,D,this.isDureePhaseAbsorbee),this.libelleErreurPeriodiciteInt="La périodicité de M.E.R. des intérêts de la phase doit être multiple de la périodicité de calcul des intérêts.",this.libelleErreurPeriodiciteAmor="La périodicité de M.E.R. de l'amortissement de la phase doit être multiple de la périodicité de M.E.R des intérêts.",this.libelleErreurPeriodiciteIntDuree="La périodicité de M.E.R. des intérêts et la durée de la phase ne peuvent être modifiées simultanément.",this.libelleErreurPeriodiciteAmorDuree="La périodicité de M.E.R. de l'amortissement et la durée de la phase ne peuvent être modifiées simultanément.",this.libelleErreurModifPhasePaliers=[],this.palierProgAmors=this.getPalierProgAmor(u,r.paliersTauxAmortissement,this.phaseByProduit,this.isChangementProduit,v,this.listePalier),this.pretsCombinesPhases=this.getPretsCombinesPhase(r),this.showEncartPretCombinesPhase=this.pretsCombinesPhases.length>0}return Object.defineProperty(l.prototype,"libelleTypeFinancement",{get:function(){return this.typeFinancement.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"libelleLongAjustement",{get:function(){return"Phase n°"+this.numeroPhase+" - "+this.libelleTypePhase+" ("+this.duree+" "+this.libelleUniteDuree+")"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isInvalid",{get:function(){return this.activerTaux&&!this.isTauxValid()||this.activerMarge&&!this.isMargeValid()||this.activerTauxDirecteur&&!this.isTauxDirecteurValid()||this.activerMargeDirecteur&&!this.isMargeDirecteurValid()||!this.isDureePhaseValid()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isPeriodiciteInvalide",{get:function(){return this.isPeriodiciteInteretInvalid()&&this.isPeriodiciteAmortissementInvalid()||this.isPeriodiciteIntDureeInvalid()&&this.isPeriodiciteAmorDureeInvalid()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isModifPhaseInvalide",{get:function(){return this.libelleErreurModifPhasePaliers.length>0},enumerable:!0,configurable:!0}),l.prototype.fctIsPhaseDirectrice=function(e,t,n,i,r,a){return t?n?!1:"1"!==e?!1:!0:i||r||a?!0:!1},l.prototype.getListePalier=function(e,t,i,r,a,o,s,u){var c=0;return _.map(e.paliersTauxInterets,function(l){c++;var d=_.filter(t,function(e){return e.numeroPhase===l.numeroPhase&&e.numeroEcheance>=l.numeroPremiereEcheancePalier&&e.numeroEcheance<=l.numeroDerniereEcheancePalier});return new n.Palier(l,c,d,i,e,a,o,s,r,u)})},l.prototype.isTauxValid=function(){return null!=this.taux&&this.taux>=this.tauxMinimum&&this.taux<=this.tauxMaximum},l.prototype.isMargeValid=function(){return null!=this.marge&&this.marge>=this.margeMinimum&&this.marge<=this.margeMaximum},l.prototype.isMargeDirecteurValid=function(){return null!=this.margeDirecteur&&this.margeDirecteur>=this.margeMinDirecteur&&this.margeDirecteur<=this.margeMaxDirecteur},l.prototype.isTauxDirecteurValid=function(){return null!=this.tauxDirecteur&&this.tauxDirecteur>=this.tauxMinDirecteur&&this.tauxDirecteur<=this.tauxMaxDirecteur},l.prototype.isDureePhaseValid=function(){return null!=this.duree&&this.duree>=this.dureeMinPhase&&this.duree<=this.dureeMaxPhase},l.prototype.getLibelleTypeFinancement=function(e,n){switch(e){case"PF":return this.getLibelleTypeFinancementByCode(n.codePossibilitePrefinancement);case"DT":return this.getLibelleTypeFinancementByCode(n.codePossibiliteDiffereTotal);case"DA":return this.getLibelleTypeFinancementByCode(n.cdPossibiliteDiffereAmortiss);case"AM":case"MO":return t.Enum.TypeFinancement.Obligatoire;default:return t.Enum.TypeFinancement.Inconnu}},l.prototype.getLibelleTypeFinancementByCode=function(e){switch(e){case"O":return t.Enum.TypeFinancement.Obligatoire;case"F":return t.Enum.TypeFinancement.Facultatif;case"I":return t.Enum.TypeFinancement.Interdit;default:return t.Enum.TypeFinancement.Inconnu}},l.prototype.getModeCalculTaux=function(e,n,i,r,a){return"PF"!==i.codeTypePhase&&"O"===n||"1"===i.cdModeExpressionTauxMoyenPhase?this.getModeCalculTauxByConditionTaux(r.codeModeExpressionTaux,e.codePresenceRevisionSurCredit,a):"2"===i.cdModeExpressionTauxMoyenPhase?t.Enum.ModeCalculTaux.TauxFixe:"3"===i.cdModeExpressionTauxMoyenPhase?t.Enum.ModeCalculTaux.TauxIndexe:t.Enum.ModeCalculTaux.TauxFixe},l.prototype.getModeCalculTauxByConditionTaux=function(e,n,i){switch(e){case"2":return t.Enum.ModeCalculTaux.TauxFixe;case"3":return t.Enum.ModeCalculTaux.TauxIndexe;case"4":return i||"O"!==n?t.Enum.ModeCalculTaux.TauxAppel:t.Enum.ModeCalculTaux.TauxIndexe;default:return null}},l.prototype.getConditionTauxProduit=function(e,t,n,r){return i.findOrEmpty(n,function(n){var i=n.codeFamilleProduit+n.numeroRelatifProduit===t.identifiantProduit&&moment(e).isBetween(n.dateDebutApplication,n.dateFinApplication,"day");return r?i&&n.dureeMinimumPlageConditionTaux<=t.dureeAjusteeCreditSuiteRecalcul&&t.dureeAjusteeCreditSuiteRecalcul<=n.dureeMaximumPlageConditionTaux:i})},l.prototype.fctShowIndiceDirecteur=function(e,t,n){return e||t||_.some(n,function(e){return e.showIndicePalier})?!0:!1},l.prototype.fctActiverIndiceDirecteur=function(e,t,n){return e||t||_.some(n,function(e){return e.activerIndicePalier})?!0:!1},l.prototype.fctShowMargeDirecteur=function(e,t,n){return e||t||_.some(n,function(e){return e.showMargePalier})?!0:!1},l.prototype.fctActiverMargeDirecteur=function(e,t,n){return e||t||_.some(n,function(e){return e.activerMargePalier})?!0:!1},l.prototype.getActiverTauxDirecteur=function(e,t,n,i){return e||t&&!i||_.some(n,function(e){return e.activerTauxPalier})?!0:!1},l.prototype.getActiverTaux=function(e,n,i,a,o){if(e===t.Enum.ModeCalculTaux.TauxFixe||e===t.Enum.ModeCalculTaux.TauxAppel){var s=e===t.Enum.ModeCalculTaux.TauxFixe?r.isValued(r.parse(n.dateMiseRecouvrementZero)):!0;if("PF"===i.codeTypePhase)return s;var u=t.ToolsFunctionals.FonctionsPhasePalier.getIsVariationIndice(null);if(!o&&"1"===i.codeTauxDesPaliersCalcules&&!u&&"O"!==n.codeCristallisationTauxInteret&&s)return!0;if(o&&"O"!==a&&"1"===i.codeTauxDesPaliersCalcules)return!0}return!1},l.prototype.getActiverMarge=function(e,n,i,a,o){if(e===t.Enum.ModeCalculTaux.TauxIndexe||e===t.Enum.ModeCalculTaux.TauxAppel){var s=e===t.Enum.ModeCalculTaux.TauxIndexe?r.isValued(r.parse(n.dateMiseRecouvrementZero)):!0;if("PF"===i.codeTypePhase)return s;var u=t.ToolsFunctionals.FonctionsPhasePalier.getIsVariationIndice(null);if(!o&&"1"===i.codeTauxDesPaliersCalcules&&!u&&"O"!==n.codeCristallisationTauxInteret&&s)return!0;if(o&&"O"!==a&&"1"===i.codeTauxDesPaliersCalcules)return!0}return!1},l.prototype.getTauxMinPhase=function(e,n,i,r,a){if(e===t.Enum.ModeCalculTaux.TauxFixe){var o="2"===n.cdModeExpressionTauxMoyenPhase?n.valeurMiniTauxMoyenPhase:a.tauxMoyenMinimumCredit;return o+t.ToolsFunctionals.FonctionsPhasePalier.getSurcoutRa(i.numModaliteRemboursemntAnticipe,r)+i.cumulBonificationsMajorations}return 0},l.prototype.getTauxMaxPhase=function(e,n,i,r,a,o){if(e===t.Enum.ModeCalculTaux.TauxFixe){var s="2"===n.cdModeExpressionTauxMoyenPhase?n.valeurMaxiTauxMoyenPhase:o.tauxMoyenMaximumCredit;if(s>0||"PZ"===r||"ZO"===r)return s+t.ToolsFunctionals.FonctionsPhasePalier.getSurcoutRa(i.numModaliteRemboursemntAnticipe,a)+i.cumulBonificationsMajorations}return 100},l.prototype.getMargeMinMaxPhase=function(e,n,i,r,a,o){var s=0,u=100,c=t.ToolsFunctionals.FonctionsPhasePalier.getSurcoutRa(n.numModaliteRemboursemntAnticipe,r);return"1"===e.cdModeExpressionTauxMoyenPhase&&("3"!==a.codeModeExpressionTaux&&"4"!==a.codeModeExpressionTaux||o||("4"!==a.codeModeExpressionTaux?(0!==a.tauxMoyenMaximumCredit||"PZ"===i||"ZO"===i)&&(s=a.tauxMoyenMinimumCredit+c,u=a.tauxMoyenMaximumCredit+c):(s=a.margeFixePourRevision-a.variationMargeFixePourRevision+c,u=100)),"4"===a.codeModeExpressionTaux&&o&&(s=a.margeFixePourRevision-a.variationMargeFixePourRevision+c,u=100)),"3"===e.cdModeExpressionTauxMoyenPhase&&(0!==e.valeurMaxiTauxMoyenPhase||"PZ"===i||"ZO"===i)&&(s=e.valeurMiniTauxMoyenPhase+c,u=e.valeurMaxiTauxMoyenPhase+c),[s,u]},l.prototype.getValeurIndice=function(e,t){var n=_.find(t,function(t){return t.codeIndice===e});return null!=n?n.valeurIndice:0},l.prototype.reportMajTauxToPaliers=function(e,t){(this.tauxDirecteur!==this.tauxDirecteurInit||this.marge!==this.margeInitiale)&&(this.listePalier=this.getListePalierUpadated(this.listePalier,e,this.tauxDirecteur,this.marge,t))},l.prototype.getListePalierUpadated=function(e,t,n,i,r){var a=this,o=[];return _.forEach(e,function(e){if(r&&t>=e.numeroPremiereEcheance&&t<e.numeroDerniereEcheance){var s=void 0,u=void 0;s=angular.copy(e),s.numeroDerniereEcheance=t,s.setDureePalier(s.numeroPremiereEcheance,s.numeroDerniereEcheance),s.elementModifiableParAvenant="N",s.taux=s.tauxInit,s.marge=s.margeInit,u=angular.copy(e),u.numeroPalier++,u.numeroPremiereEcheance=t+1,u.setDureePalier(u.numeroPremiereEcheance,u.numeroDerniereEcheance),o.push(s,a.getPalierTauxInteretUpdated(u,t,n,i,!0))}else o.push(a.getPalierTauxInteretUpdated(e,t,n,i,!1))}),o},l.prototype.getPalierTauxInteretUpdated=function(e,t,n,i,r){return e.numeroPremiereEcheance>t&&e.reportTauxFromPhase(n,i,r),e},l.prototype.reportNouvelleDureeToDernierePhase=function(t,n){var i=this;this.duree=t;var r=e.Business.ToolsFunctionals.PeriodicitePhase.verificationDureePeriodiciteSansScission(this.uniteDureePhase,this.duree,this.periodiciteCalculInterets,this.periodiciteInteret,this.periodiciteAmortissement);if(this.libelleErreurModifPhasePaliers=r,!(r.length>0)){var a=_.reduce(_.filter(this.listePalier,function(e){return e.numeroPalier!==_.last(i.listePalier).numeroPalier}),function(e,t){return e+t.getDureeConverted(t.duree,t.periodiciteMERamortissement,"M")},0),o=t-a;n&&this.listePalier.length>1?this.setListePaliersForAmortissementALaCarte(o):_.last(this.listePalier).reportNouvelleDureeToDernierPalier(o),this.setLastPalierTauxAmortissement()}},l.prototype.setLastPalierTauxAmortissement=function(){var e=_.last(this.palierProgAmors);if(null!=e){var t=_.last(this.listePalier);null!=t&&(e.numeroDerniereEcheance=t.numeroDerniereEcheance)}},l.prototype.setListePaliersForAmortissementALaCarte=function(e){var t=angular.copy(_.last(this.listePalier));if(this.listePalier.pop(),e>1)for(var n=angular.copy(_.last(this.listePalier)),i=1;e>i;i++)this.listePalier.push(this.getPalierUpdateEcheance(angular.copy(n),n,i));else{var r=this.listePalier.length+e-1;this.listePalier.splice(r,-1*e+1)}this.listePalier.push(this.getPalierUpdateEcheance(t,_.last(this.listePalier),1))},l.prototype.getPalierUpdateEcheance=function(e,t,n){return e.numeroPalier=t.numeroPalier+n,e.numeroRelatif=t.numeroRelatif+n,e.numeroPremiereEcheance=t.numeroPremiereEcheance+n,e.numeroDerniereEcheance=t.numeroDerniereEcheance+n,e.listeEcheanceALaCarte[0].numeroEcheance=t.listeEcheanceALaCarte[0].numeroEcheance+n,e.listeEcheanceALaCarte[0].montantEcheanceMaj=0,e.cdModifCaracteristfinancieres="1",e},l.prototype.getTauxDirecteur=function(t,n,i,r,a){if(t.isCreditDirecteur)return t.tauxCredit;if(n)return i;if(_.some(r,function(e){return e.isPalierDirecteur})){var o=null;return a===e.Commun.Enum.CodeTypeAcces.Creation?o=r.length>0?_.find(r,function(e){return e.isPalierADateEffet||e.isPalierApresDateEffet}):null:(a===e.Commun.Enum.CodeTypeAcces.Modification||a===e.Commun.Enum.CodeTypeAcces.Lecture||a===e.Commun.Enum.CodeTypeAcces.Duplication)&&(o=r.length>0?_.find(r,function(e){return e.isPalierApresDateEffet}):null),null!==o&&angular.isDefined(o)?o.taux:0}},l.prototype.getTauxMinimumDirecteur=function(e,t,n,i){if(e.isCreditDirecteur)return e.tauxMinimumDirecteur;if(t)return n;if(_.some(i,function(e){return e.isPalierDirecteur})){var r=i.length>0?_.find(i,function(e){return e.isPalierADateEffet||e.isPalierApresDateEffet}):null;return null!==r&&angular.isDefined(r)?r.tauxMinimum:0}return 0},l.prototype.getTauxMaximumDirecteur=function(e,t,n,i){if(e.isCreditDirecteur)return e.tauxMaximumDirecteur;if(t)return n;if(_.some(i,function(e){return e.isPalierDirecteur})){var r=i.length>0?_.find(i,function(e){return e.isPalierADateEffet||e.isPalierApresDateEffet}):null;return null!==r&&angular.isDefined(r)?r.tauxMaximum:0}return 0},l.prototype.getLibelleErreurTauxDirecteur=function(e,t,n,i){return e.isCreditDirecteur?"(Taux + surcôut RA + Bonification/ Majoration) du crédit doit être dans les bornes autorisées.":t?n:_.some(i,function(e){return e.isPalierDirecteur})?"Le taux doit être dans les bornes autorisées.":""},l.prototype.getIndiceDirecteurs=function(e,t,n,i,r){if(e)return n;if(t)return[i];if(_.some(r,function(e){return e.isPalierDirecteur})){var a=r.length>0?_.find(r,function(e){return e.isPalierADateEffet||e.isPalierApresDateEffet}):null;return[null!==a&&angular.isDefined(a)?a.indice:""]}return[]},l.prototype.getMargeDirecteur=function(e,t,n,i){if(e.isCreditDirecteur)return e.margeTauxCredit;if(t)return n;if(_.some(i,function(e){return e.isPalierDirecteur})){var r=i.length>0?_.find(i,function(e){return e.isPalierADateEffet||e.isPalierApresDateEffet}):null;return null!==r&&angular.isDefined(r)?r.marge:0}},l.prototype.getMargeMinimumDirecteur=function(e,t,n,i){return e.isCreditDirecteur?e.margeMinimumDirecteur:t?n:(_.some(i,function(e){return e.isPalierDirecteur}),0)},l.prototype.getMargeMaximumDirecteur=function(e,t,n,i){return e.isCreditDirecteur?e.margeMaximumDirecteur:t?n:(_.some(i,function(e){return e.isPalierDirecteur}),0)},l.prototype.getLibelleErreurMargeDirecteur=function(e,t,n){
return e.isCreditDirecteur?"(Marge + surcôut RA) doit être dans les bornes autorisées.":t?"(Marge + surcôut RA) de la phase doit être dans les bornes autorisées.":_.some(n,function(e){return e.isPalierDirecteur})?"La marge doit être dans les bornes autorisées.":""},l.prototype.getDureeMinPhase=function(e,t){return c.isChangementProduit(e)?t:1},l.prototype.fctModifTauxFromModifMarge=function(e,t,n,i,a,o,s,u){if("1"===t.cdModeExpressionTauxMoyenPhase)for(var c=0,l=e;c<l.length;c++){var d=l[c];if(r.isBefore(d.dateDebutApplication,a)&&r.isBefore(a,d.dateFinApplication)&&d.dureeMinimumPlageConditionTaux<=o&&o<=d.dureeMaximumPlageConditionTaux&&("3"===d.codeModeExpressionTaux||"4"===d.codeModeExpressionTaux)&&!s&&("3"===d.codeModeExpressionTaux||"4"===d.codeModeExpressionTaux&&"O"===u.codePresenceRevisionSurCredit)&&(""!==u.codeRoleCreditAvenant||""===u.codeRoleCreditAvenant&&n!==i))return!0}return"3"===t.cdModeExpressionTauxMoyenPhase&&(""!==u.codeRoleCreditAvenant||""===u.codeRoleCreditAvenant&&n!==i)?!0:!1},l.prototype.isPeriodiciteInteretInvalid=function(){return"O"===this.phaseByProduit.cdCalculInteretsDiffRecouvrmnt&&u.simulConvDuree(this.periodiciteInteret.codePeriode,1,"M",365)%u.simulConvDuree(this.periodiciteCalculInterets.codePeriode,1,"M",365)!==0},l.prototype.isPeriodiciteAmortissementInvalid=function(){return"O"===this.phaseByProduit.codePeriodiciteDifferenteMER&&u.simulConvDuree(this.periodiciteAmortissement.codePeriode,1,"M",365)%u.simulConvDuree(this.periodiciteInteret.codePeriode,1,"M",365)!==0},l.prototype.isPeriodiciteIntDureeInvalid=function(){return!this.isChangementProduit&&!this.isPhasePrefi&&this.duree!==this.dureePhaseAvantScission&&this.periodiciteInteret.codePeriode!==this.periodiciteInteretInitiale.codePeriode},l.prototype.isPeriodiciteAmorDureeInvalid=function(){return!this.isChangementProduit&&!this.isPhasePrefi&&this.duree!==this.dureePhaseAvantScission&&this.periodiciteAmortissement.codePeriode!==this.periodiciteAmortissementInitiale.codePeriode},l.prototype.getPalierProgAmor=function(e,t,i,r,a,o){return _.isEmpty(t)?[]:_.map(t,function(t){return new n.PalierProgAmor(t,e,i,r,a,o)})},l.prototype.getPretsCombinesPhase=function(e){return _.isEmpty(e)?[]:_.map(e.pretsCombines,function(e){return new n.PretCombinePhase(e)})},l}();n.Phase=l}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.numeroRelatif=e.numeroRelatif,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.numeroPhase=e.numeroPhase,this.montantPartInfine=e.montantPartInfine,this.montantPartAmortissableCapital=e.montantPartAmortissableCapital,this.modeRepartitionCapital=e.modeRepartitionCapital,this.codeAjoutIntercapSurPartAmort=e.codeAjoutIntercapSurPartAmort,this.montantQuotiteAmortissement=e.montantQuotiteAmortissement,this.quotiteCapitalAAmortir=e.quotiteCapitalAAmortir,this.amortissementSuppFinPhase=e.amortissementSuppFinPhase}return e}();e.PretCombinePhase=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){var n=e.Commun.Tools.List,i=e.Commun.ToolsFunctionals.FonctionsAvenant,r=e.Commun.ToolsFunctionals.Periodicite,a=function(){function e(){}return e.scissionPalierProgAmorPhaseEnCours=function(e,i,r){if(_.isEmpty(r))return r;var a=angular.copy(r),o=n.findOrEmpty(a,function(e){return e.numeroPremiereEcheance<=i+1&&e.numeroDerniereEcheance>=i+1}),s=[];if(s=this.verificationScissionPalierProgAmor(e,o,i),s.length>0)return this.miseAjourErreurPalierProgAmor(a,o.numeroRelatif,s);if(!t.ScissionPalierTauxInteret.isPremiereEcheancePalierSurNumeroEcheanceS882(o.numeroPremiereEcheance,i)){var u=angular.copy(o);o=this.modificationPalierProgressionAmortissementEnCours(o,i),u=this.modificationPalierProgressionAmortissementNouveau(u,i,e.periodiciteInteret,e.periodiciteAmortissement),a=this.miseAJourPalierProgAmorSimple(a,o,u)}return a},e.verificationScissionPalierProgAmor=function(e,n,i){var r=[];if(t.ScissionPalierTauxInteret.isPremiereEcheancePalierSurNumeroEcheanceS882(n.numeroPremiereEcheance,i)){var a=n.numeroDerniereEcheance-n.numeroPremiereEcheance+1;return r=this.verficationSissionApplicablePalierProgAmor(a,e.periodiciteCalculInterets,e.periodiciteAmortissement,e.periodiciteInteret,n.palierProgAmorProduit.periodiciteApplicProgreAmort)}var o=this.getDureePalierProgAmorEnCours(n,i);if(r=this.verficationSissionPossiblePalierProgAmorEnCours(o,e.periodiciteCalculInteretsInitial,e.periodiciteAmortissementInitiale,e.periodiciteInteretInitiale,n.palierProgAmorProduit.periodiciteApplicProgreAmort),r.length>0)return r;var s=this.getDureePalierProgAmorNouveau(n,i);return r=this.verficationSissionPossiblePalierProgAmorNouveau(s,e.periodiciteCalculInterets,e.periodiciteAmortissement,e.periodiciteInteret,n.palierProgAmorProduit.periodiciteApplicProgreAmort),r.length>0?r:r},e.verficationSissionApplicablePalierProgAmor=function(e,t,n,a,o){var s=[],u="";""!==o&&null!==o?u=o:""!==n.codePeriode?u=n.codePeriode:""!==a.codePeriode?u=a.codePeriode:""!==t.codePeriode&&(u=t.codePeriode);var c=r.getLibellePeriode(t.codePeriode,e>1);return i.simulConvDuree(t.codePeriode,e,"M",365)%i.simulConvDuree(u,1,"M",365)!==0&&s.push("La périodicité "+u+" est incompatible avec la durée du palier de progression d'amortissement ("+e+" "+c+")"),s},e.getDureePalierProgAmorEnCours=function(e,t){return _.isUndefined(e)?0:t-e.numeroPremiereEcheance+1},e.getDureePalierProgAmorNouveau=function(e,t){return _.isUndefined(e)?0:e.numeroDerniereEcheance-t},e.verficationSissionPossiblePalierProgAmorEnCours=function(e,t,n,a,o){var s=[],u="";""!==o&&null!==o?u=o:""!==n.codePeriode?u=n.codePeriode:""!==a.codePeriode?u=a.codePeriode:""!==t.codePeriode&&(u=t.codePeriode);var c=r.getLibellePeriode(t.codePeriode,e>1);return i.simulConvDuree(t.codePeriode,e,"M",365)%i.simulConvDuree(u,1,"M",365)!==0&&(s.push("La scission de palier de progression d'amortissement est incompatible avec la durée déjà écoulée sur le palier ("+e+" "+c+")"),s.push("La scission de palier de progression d'amortissement est incompatible avec une des périodicités d'origine ("+r.getLibellePeriodicite(u)+")")),s},e.verficationSissionPossiblePalierProgAmorNouveau=function(e,t,n,a,o){var s=[],u="";""!==o&&null!==o?u=o:""!==n.codePeriode?u=n.codePeriode:""!==a.codePeriode?u=a.codePeriode:""!==t.codePeriode&&(u=t.codePeriode);var c=r.getLibellePeriode(t.codePeriode,e>1);return i.simulConvDuree(t.codePeriode,e,"M",365)%i.simulConvDuree(u,1,"M",365)!==0&&(s.push("La scission de palier de progression d'amortissement est incompatible avec la durée restante sur le palier ("+e+" "+c+")"),s.push("La scission de palier de progression d'amortissement est incompatible avec la périodicité ("+r.getLibellePeriodicite(u)+")")),s},e.miseAjourErreurPalierProgAmor=function(e,t,n){for(var i=0,r=e;i<r.length;i++){var a=r[i];a.numeroRelatif===t&&(a.libelleErreurModifPaliers=n)}return e},e.modificationPalierProgressionAmortissementEnCours=function(e,t){var n=angular.copy(e);return n.numeroDerniereEcheance=t,n.elementModifiableParAvenant="N",n.nbEcheance=this.getDureePalierProgAmorEnCours(n,t),n.tauxProgAmor=n.tauxProgAmorInitial,n.isPalierADateEffet=!0,n.isPalierApresDateEffet=!1,n.isAffichagePalierDateEffet=!1,n},e.modificationPalierProgressionAmortissementNouveau=function(e,t,n,i){var r=angular.copy(e);return r.numeroPremiereEcheance=t+1,r.numeroRelatif+=1,r.numeroPalier+=1,r.nbEcheance=this.getDureePalierProgAmorNouveau(r,t),r.numeroDerniereEcheance=r.nbEcheance+r.numeroPremiereEcheance-1,r.isPalierADateEffet=!1,r.isPalierApresDateEffet=!0,r.isAffichagePalierDateEffet=r.isPalierADateEffet||r.isPalierApresDateEffet,r},e.miseAJourPalierProgAmorSimple=function(e,t,n){var i=angular.copy(e);_.each(i,function(e){e.numeroRelatif>=n.numeroRelatif&&e.numeroPhase===n.numeroPhase&&(e.numeroRelatif+=1)});var r=_.findIndex(i,function(e){return e.numeroRelatif===t.numeroRelatif});return i.splice(r,1,t),i.splice(r+1,0,n),i},e.getMessageErreurPalierProgressionAmortissement=function(e){for(var t=[],n=0,i=e;n<i.length;n++){var r=i[n];if(r.libelleErreurModifPaliers.length>0)for(var a=0,o=r.libelleErreurModifPaliers;a<o.length;a++){var s=o[a];t.push(s)}}return t},e}();t.ScissionPalierProgressionAmortissement=a}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){var n=e.Commun.Tools.List,i=e.Commun.ToolsFunctionals.FonctionsAvenant,r=e.Commun.ToolsFunctionals.Periodicite,a=function(){function e(){}return e.scissionPalierPhaseEnCours=function(e,t,i){var r=angular.copy(i),a=n.findOrEmpty(r,function(e){return e.numeroPremiereEcheance<=t+1&&e.numeroDerniereEcheance>=t+1}),o=[];if("PF"===e.codeTypePhase)return r;if(o=this.verificationScissionPalier(e,a,t),o.length>0)return this.miseAjourErreurPalier(r,a.numeroRelatif,o);if(!this.isPremiereEcheancePalierSurNumeroEcheanceS882(a.numeroPremiereEcheance,t)){var s=angular.copy(a);if(a=this.modificationPalierTauxInteretEnCours(a,t),s=this.modificationPalierTauxInteretNouveau(s,t,e.periodiciteInteret,e.periodiciteAmortissement),r=this.miseAJourPalierTauxSimple(r,a,s),0!==s.tauxProgEch&&s.palierByRest.periodiciteApplicProgreEcheance!==e.periodiciteCalculInteretsInitial.codePeriode){var u=this.calculNuepPourScissionTauxProgEch(t,s.palierByRest.periodiciteApplicProgreEcheance,e.periodiciteCalculInterets.codePeriode,a.numeroPremiereEcheance),c=n.findOrEmpty(r,function(e){return e.numeroPremiereEcheance<=u&&e.numeroDerniereEcheance>=u});if(s.numeroPhase===c.numeroPhase&&s.numeroRelatif===c.numeroRelatif&&s.numeroDerniereEcheance>u){r=this.scissionPalierAte(e,r,u,a.numeroPremiereEcheance);for(var l=0,d=r;l<d.length;l++){var m=d[l];m.numeroRelatif===s.numeroRelatif&&(m.tauxProgEch=0,m.isPalierAvecTauxProgEchAZero=!0)}}}}return r},e.isPremiereEcheancePalierSurNumeroEcheanceS882=function(e,t){return e===t+1},e.scissionPalierAte=function(e,t,i,r){var a=angular.copy(t),o=angular.copy(e),s=[],u=n.findOrEmpty(a,function(e){return e.numeroPremiereEcheance<=i+1&&e.numeroDerniereEcheance>=i+1});if(!_.isEmpty(a)&&"PF"!==o.codeTypePhase&&u.numeroPremiereEcheance!==i+1){var c=i-r+1;if(s=this.verficationSissionPossiblePalierEnCours(c,o.periodiciteCalculInteretsInitial,o.periodiciteAmortissementInitiale,o.periodiciteInteretInitiale),s.length>0)return this.miseAjourErreurPalier(a,o.numeroPhase,s);var l=angular.copy(u);u=this.modificationPalierTauxInteretEnCoursAte(u,i),l=this.modificationPalierTauxInteretNouveauAte(l,i,o.periodiciteInteret,o.periodiciteAmortissement),a=this.miseAJourPalierTauxSimple(a,u,l)}return a},e.calculNuepPourScissionTauxProgEch=function(e,t,n,r){var a=0,o=1;do a=i.simulConvDuree(t,o,n,365)-1+r,o++;while(e+1>a);return a},e.getDureePalierEnCours=function(e,t){return _.isUndefined(e)?0:t-e.numeroPremiereEcheance+1},e.getDureePalierNouveau=function(e,t){return _.isUndefined(e)?0:e.numeroDerniereEcheance-t},e.verficationSissionApplicablePalier=function(e,t,n,a){var o=[],s="";""!==n.codePeriode?s=n.codePeriode:""!==a.codePeriode?s=a.codePeriode:""!==t.codePeriode&&(s=t.codePeriode);var u=r.getLibellePeriode(t.codePeriode,e>1);return i.simulConvDuree(t.codePeriode,e,"M",365)%i.simulConvDuree(s,1,"M",365)!==0&&o.push("La périodicité "+s+" est incompatible avec la durée du palier ("+e+" "+u+")"),o},e.verficationSissionPossiblePalierEnCours=function(e,t,n,a){var o=[],s="";""!==n.codePeriode?s=n.codePeriode:""!==a.codePeriode?s=a.codePeriode:""!==t.codePeriode&&(s=t.codePeriode);var u=r.getLibellePeriode(t.codePeriode,e>1);return i.simulConvDuree(t.codePeriode,e,"M",365)%i.simulConvDuree(s,1,"M",365)!==0&&(o.push("La scission de palier est incompatible avec la durée déjà écoulée sur le palier ("+e+" "+u+")"),o.push("La scission de palier est incompatible avec une des périodicités d'origine ("+r.getLibellePeriodicite(s)+")")),o},e.verficationSissionPossiblePalierNouveau=function(e,t,n,a){var o=[],s="";""!==n.codePeriode?s=n.codePeriode:""!==a.codePeriode?s=a.codePeriode:""!==t.codePeriode&&(s=t.codePeriode);var u=r.getLibellePeriode(t.codePeriode,e>1);return i.simulConvDuree(t.codePeriode,e,"M",365)%i.simulConvDuree(s,1,"M",365)!==0&&(o.push("La scission de palier est incompatible avec la durée restante sur le palier ("+e+" "+u+")"),o.push("La scission de palier est incompatible avec une des périodicités du crédit ("+r.getLibellePeriodicite(s)+")")),o},e.verificationScissionPalier=function(e,t,n){var i=[];if(this.isPremiereEcheancePalierSurNumeroEcheanceS882(t.numeroPremiereEcheance,n)){var r=t.numeroDerniereEcheance-t.numeroPremiereEcheance+1;return i=this.verficationSissionApplicablePalier(r,e.periodiciteCalculInterets,e.periodiciteAmortissement,e.periodiciteInteret)}var a=this.getDureePalierEnCours(t,n);if(i=this.verficationSissionPossiblePalierEnCours(a,e.periodiciteCalculInteretsInitial,e.periodiciteAmortissementInitiale,e.periodiciteInteretInitiale),i.length>0)return i;var o=this.getDureePalierNouveau(t,n);return i=this.verficationSissionPossiblePalierNouveau(o,e.periodiciteCalculInterets,e.periodiciteAmortissement,e.periodiciteInteret),i.length>0?i:i},e.modificationPalierTauxInteretEnCours=function(e,t){var n=angular.copy(e);return n.numeroDerniereEcheance=t,n.elementModifiableParAvenant="N",n.cdModifCaracteristfinancieres="",n.duree=this.getDureePalierEnCours(n,t),n.taux=n.tauxInit,n.tauxProgEch=n.tauxProgEchInitial,n.isPalierADateEffet=!0,n.isPalierApresDateEffet=!1,n.isAffichagePalierDateEffet=!1,n},e.modificationPalierTauxInteretNouveau=function(e,t,n,i){var r=angular.copy(e);return r.numeroPremiereEcheance=t+1,r.numeroRelatif+=1,r.numeroPalier+=1,r.duree=this.getDureePalierNouveau(r,t),r.numeroDerniereEcheance=r.duree+r.numeroPremiereEcheance-1,r.periodiciteMERamortissement=i.codePeriode,r.periodiciteMERinteretPhase=n.codePeriode,r.isPalierADateEffet=!1,r.isPalierApresDateEffet=!0,r.isAffichagePalierDateEffet=r.isPalierADateEffet||r.isPalierApresDateEffet,r},e.modificationPalierTauxInteretEnCoursAte=function(e,t){var n=angular.copy(e);return n.numeroDerniereEcheance=t,n.cdModifCaracteristfinancieres="",n.duree=n.numeroDerniereEcheance-n.numeroPremiereEcheance+1,n},e.modificationPalierTauxInteretNouveauAte=function(e,t,n,i){var r=angular.copy(e);return r.numeroPremiereEcheance=t+1,r.numeroRelatif+=1,r.numeroPalier+=1,r.duree=r.numeroDerniereEcheance-t,r.numeroDerniereEcheance=r.duree+r.numeroPremiereEcheance-1,r.periodiciteMERamortissement=i.codePeriode,r.periodiciteMERinteretPhase=n.codePeriode,r},e.miseAJourPalierTauxSimple=function(e,t,n){var i=angular.copy(e);_.each(i,function(e){e.numeroRelatif>=n.numeroRelatif&&e.numeroPhase===n.numeroPhase&&(e.numeroRelatif+=1)});var r=_.findIndex(i,function(e){return e.numeroRelatif===t.numeroRelatif});return i.splice(r,1,t),i.splice(r+1,0,n),i},e.miseAjourErreurPalier=function(e,t,n){for(var i=0,r=e;i<r.length;i++){var a=r[i];a.numeroRelatif===t&&(a.libelleErreurModifPaliers=n)}return e},e.getMessageErreurPalierTauxInteret=function(e){for(var t=[],n=0,i=e;n<i.length;n++){var r=i[n];if(r.libelleErreurModifPaliers.length>0)for(var a=0,o=r.libelleErreurModifPaliers;a<o.length;a++){var s=o[a];t.push(s)}}return t},e}();t.ScissionPalierTauxInteret=a}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){var n=e.Commun.ToolsFunctionals.FonctionsAvenant,i=e.Commun.ToolsFunctionals.Periodicite,r=function(){function r(){}return r.scissionPhaseEnCours=function(i,r,a,o,s,u,c,l){var d=angular.copy(i),m=angular.copy(r),h=[],p=this.getDateDebutFinPhase(a.numeroPhase,a),f=p[0],A=p[1],P=null,v=null;if(this.isPremiereEcheancePhaseSurNumeroEcheanceS882(o,a.numeroEcheance)){var g=s-o+1;if(h=this.verficationSissionApplicable(g,d.periodiciteCalculInterets,d.uniteDureePhase,d.periodiciteAmortissement,d.periodiciteInteret,d.periodiciteCalculInteretsInitial),h.length>0)return this.miseAjourErreurPhase(m,d.numeroPhase,h)}else{var C=angular.copy(d),E=a.numeroEcheance-o+1;if(h=this.verficationSissionPossiblePhaseEnCours(E,d.periodiciteCalculInteretsInitial,d.uniteDureePhase,d.periodiciteAmortissementInitiale,d.periodiciteInteretInitiale),h.length>0)return this.miseAjourErreurPhase(m,d.numeroPhase,h);var b=s-a.numeroEcheance;if(h=this.verficationSissionPossibleNouvellePhase(b,C.periodiciteCalculInteretsInitial,C.periodiciteCalculInterets,C.uniteDureePhase,C.periodiciteAmortissement,C.periodiciteInteret),h.length>0)return this.miseAjourErreurPhase(m,d.numeroPhase,h);A=n.simulAjoutPeriode(f,E,d.periodiciteCalculInteretsInitial.codePeriode),P=A,v=n.simulAjoutPeriode(A,b,C.periodiciteCalculInteretsInitial.codePeriode);var T=angular.copy(d.palierProgAmors);if(T=t.ScissionPalierProgressionAmortissement.scissionPalierProgAmorPhaseEnCours(d,a.numeroEcheance,d.palierProgAmors),h=t.ScissionPalierProgressionAmortissement.getMessageErreurPalierProgressionAmortissement(T),h.length>0)return this.miseAjourErreurPhase(m,d.numeroPhase,h);var y=angular.copy(d.listePalier);if(y=t.ScissionPalierTauxInteret.scissionPalierPhaseEnCours(d,a.numeroEcheance,d.listePalier),h=t.ScissionPalierTauxInteret.getMessageErreurPalierTauxInteret(y),h.length>0)return this.miseAjourErreurPhase(m,d.numeroPhase,h);var M=d.parametresRevisionTaux;if(d=this.modificationPhaseEnCours(d,E),C=this.modificationNouvellePhase(C,b),y=this.miseAJourPalierTaux(y,C.numeroPhase,a.numeroEcheance),d.listePalier=_.filter(y,function(e){return e.numeroPhase===d.numeroPhase}),C.listePalier=_.filter(y,function(e){return e.numeroPhase===C.numeroPhase}),_.isEmpty(T)||(T=this.miseAJourPalierProgressionAmortissement(T,C.numeroPhase,a.numeroEcheance),d.palierProgAmors=_.filter(T,function(e){return e.numeroPhase===d.numeroPhase}),C.palierProgAmors=_.filter(T,function(e){return e.numeroPhase===C.numeroPhase})),"F"===c){var D=angular.copy(M);_.isEmpty(D)||_.each(D,function(e){return e.numeroPhase=e.numeroPhase+1}),d.parametresRevisionTaux=M,C.parametresRevisionTaux=D}m=this.miseAJourPhases(m,d,C,c),u=this.scissionAccessoiresPhaseEnCours(d.numeroPhase,C.numeroPhase,P,v,A,u),this.scissionServicesObjet(l,d),e.Business.ToolsFunctionals.ScissionPhase.alimenterDatesPhase(l,a.dateMiseRecouvrementZero,m)}return m},r.isPremiereEcheancePhaseSurNumeroEcheanceS882=function(e,t){return e===t+1},r.miseAjourErreurPhase=function(e,t,n){for(var i=0,r=e;i<r.length;i++){var a=r[i];a.numeroPhase===t&&(a.libelleErreurModifPhasePaliers=n)}return e},r.verficationSissionApplicable=function(e,t,r,a,o,s){var u=[],c="";""!==a.codePeriode?c=a.codePeriode:""!==o.codePeriode?c=o.codePeriode:""!==t.codePeriode&&(c=t.codePeriode);var l=i.getLibellePeriode(t.codePeriode,e>1);return n.simulConvDuree(s.codePeriode,e,"M",365)%n.simulConvDuree(c,1,"M",365)!==0&&u.push("La périodicité "+c+" est incompatible avec la durée de la phase ("+e+" "+l+")"),n.simulConvDuree(t.codePeriode,e,"M",365)%n.simulConvDuree(r,1,"M",365)!==0&&u.push("La périodicité "+c+" est incompatible avec celle d'expression de la durée de la phase "+r),u},r.verficationSissionPossibleNouvellePhase=function(e,t,r,a,o,s){var u=[],c="";""!==o.codePeriode?c=o.codePeriode:""!==s.codePeriode?c=s.codePeriode:""!==r.codePeriode&&(c=r.codePeriode);var l=i.getLibellePeriode(t.codePeriode,e>1);return n.simulConvDuree(t.codePeriode,e,"M",365)%n.simulConvDuree(c,1,"M",365)!==0&&(u.push("La scission de phase est incompatible avec la durée restante sur la phase ("+e+" "+l+")"),u.push("La scission de phase est incompatible avec une des périodicités du crédit ("+i.getLibellePeriodicite(c)+")")),n.simulConvDuree(t.codePeriode,e,"M",365)%n.simulConvDuree(a,1,"M",365)!==0&&(u.push("La scission de phase est incompatible avec la durée déjà écoulée sur la phase ("+e+" "+l+")"),u.push("La scission de phase est incompatible avec la périodicité de durée ("+a+")")),u},r.verficationSissionPossiblePhaseEnCours=function(e,t,r,a,o){var s=[],u="";""!==a.codePeriode?u=a.codePeriode:""!==o.codePeriode?u=o.codePeriode:""!==t.codePeriode&&(u=t.codePeriode);var c=i.getLibellePeriode(t.codePeriode,e>1);return n.simulConvDuree(t.codePeriode,e,"M",365)%n.simulConvDuree(u,1,"M",365)!==0&&(s.push("La scission de phase est incompatible avec la durée déjà écoulée sur la phase ("+e+" "+c+")"),s.push("La scission de phase est incompatible avec une des périodicités d'origine ("+i.getLibellePeriodicite(u)+")")),n.simulConvDuree(t.codePeriode,e,"M",365)%n.simulConvDuree(r,1,"M",365)!==0&&(s.push("La scission de phase est incompatible avec la durée déjà écoulée sur la phase ("+e+" "+c+")"),s.push("La scission de phase est incompatible avec la périodicité de durée ("+r+")")),s},r.modificationPhaseEnCours=function(e,t){var i=angular.copy(e);return i.periodiciteInteret=angular.copy(i.periodiciteInteretInitiale),i.periodiciteAmortissement=angular.copy(i.periodiciteAmortissementInitiale),i.periodiciteCalculInterets=angular.copy(i.periodiciteCalculInteretsInitial),i.periodiciteAmortissementTemporaire=angular.copy(i.periodiciteAmortissement),i.periodiciteInteretTemporaire=angular.copy(i.periodiciteInteret),i.duree=n.simulConvDuree(i.periodiciteCalculInterets.codePeriode,t,i.uniteDureePhase,365),i.isScission=!0,i.elementModifiableParAvenant="N",i.cdModifCaracFinanciere="","O"===i.prelevementEnFinPhase&&(i.prelevementEnFinPhase="N"),i.dureePhaseAvantScission=i.duree,i.listePalier=[],i.isAnciennePhaseEnCours=!0,i.parametresRevisionTaux=[],i},r.modificationNouvellePhase=function(e,t){var i=angular.copy(e);return i.periodiciteAmortissementTemporaire=angular.copy(i.periodiciteAmortissement),i.periodiciteInteretTemporaire=angular.copy(i.periodiciteInteret),i.duree=n.simulConvDuree(i.periodiciteCalculInteretsInitial.codePeriode,t,i.uniteDureePhase,365),i.isPhaseActive=!1,i.isScission=!1,i.numeroPhase+=1,i.dureePhaseAvantScission=i.duree,i.listePalier=[],i.isAnciennePhaseEnCours=!1,i.isNouvellePhaseScission=!0,i.parametresRevisionTaux=[],i},r.miseAJourPalierTaux=function(e,t,n){var i=angular.copy(e);_.each(i,function(e){e.numeroPremiereEcheance>=n+1&&(e.numeroPhase+=1)});var r=0;return _.each(i,function(e){e.numeroPhase===t&&(r+=1,e.numeroRelatif=r,e.numeroPalier=r)}),i},r.miseAJourPalierProgressionAmortissement=function(e,t,n){var i=angular.copy(e);_.each(i,function(e){e.numeroPremiereEcheance>=n+1&&(e.numeroPhase+=1)});var r=0;return _.each(i,function(e){e.numeroPhase===t&&(r+=1,e.numeroRelatif=r,e.numeroPalier=r)}),i},r.miseAJourPhases=function(e,t,n,i){for(var r=angular.copy(e),a=function(e){e.numeroPhase>=n.numeroPhase&&(e.numeroPhase+=1,_.each(e.listePalier,function(t){return t.numeroPhase=e.numeroPhase}),_.isEmpty(e.palierProgAmors)||_.each(e.palierProgAmors,function(t){return t.numeroPhase=e.numeroPhase}),"F"===i&&_.each(e.parametresRevisionTaux,function(t){return t.numeroPhase=e.numeroPhase}))},o=0,s=r;o<s.length;o++){var u=s[o];a(u)}var c=_.findIndex(r,function(e){return e.numeroPhase===t.numeroPhase});return r.splice(c,1,t),r.splice(c+1,0,n),r},r.scissionAccessoiresPhaseEnCours=function(e,t,n,i,r,a){var o=angular.copy(a),s=_.filter(o,function(t){return t.numeroPhase===e});if(s.length>0){_.each(o,function(t){t.numeroPhase>e&&(t.numeroPhase=t.numeroPhase+1)});for(var u=function(a){var s=angular.copy(a);s.numeroPhase=t,"21"!==a.codeNatureAccessoire&&"22"!==a.codeNatureAccessoire&&(null!=a.dateAppelAccessoire&&(s.dateAppelAccessoire=moment(n).toString()),null!=a.dateDebutApplicationElement&&(s.dateDebutApplicationElement=moment(n).toString(),null!=a.dateFinApplicationElement&&(s.dateFinApplicationElement=moment(i).toString()),a.dateFinApplicationElement=moment(r).toString())),"21"===a.codeNatureAccessoire&&(a.dateFinApplicationElement="0000-00-00",a.dateDebutApplicationElement="0000-00-00",a.dateAppelAccessoire="0000-00-00",a.nbrEcheancesAccessoiresReport=0),"22"===a.codeNatureAccessoire&&(a.dateFinApplicationElement="0000-00-00",a.dateDebutApplicationElement="0000-00-00",a.dateAppelAccessoire="0000-00-00",a.nbrEcheancesAccessoiresReport=0);var u=_.findIndex(o,function(t){return t.numeroPhase===e&&t.codeNatureAccessoire===a.codeNatureAccessoire});o.splice(u,1,a),o.splice(u+1,0,s)},c=0,l=s;c<l.length;c++){var d=l[c];u(d)}}return o},r.scissionServicesObjet=function(e,t){var n=this;_.each(e,function(e){e.numeroPhase>t.numeroPhase&&e.numeroPhase++}),_.each(e,function(i){if(i.numeroPhase===t.numeroPhase){n.majCodeTypeAccesAccessoireModifie(i);var r=i;n.isElementModifiableParAvenant(t)&&(r=angular.copy(i)),n.majElementCalculNouvellePhase(r),n.isElementModifiableParAvenant(t)&&(i.dateFinApplicationElement=r.dateDebutApplicationElement,e.push(r))}})},r.isElementModifiableParAvenant=function(e){return"O"===e.elementModifiableParAvenant},r.majElementCalculNouvellePhase=function(e){e.numeroPhase++,e.dateDebutApplicationElement=null},r.alimenterDatesPhase=function(t,n,i){for(var r=moment(n).toDate(),a=moment(n).format(e.Commun.Constantes.Format.DATE_REST),o=null,s=null,u=_.sortByOrder(i,function(e){return e.numeroPhase}),c=function(n){"PF"!==n.codeTypePhase&&(o=e.Commun.ToolsFunctionals.FonctionsAvenant.simulAjoutPeriode(r,n.duree,n.uniteDureePhase),s=moment(o).format(e.Commun.Constantes.Format.DATE_REST),_.forEach(t,function(e){n.numeroPhase===e.numeroPhase&&(null===e.dateDebutApplicationElement&&(e.dateDebutApplicationElement=a),null===e.dateFinApplicationElement&&(e.dateFinApplicationElement=s))}),r=o,a=s)},l=0,d=u;l<d.length;l++){var m=d[l];c(m)}},r.alimenterDatesPhaseAvecDateAppelAccessoire=function(e,t,n){this.alimenterDatesPhase(e,t,n),this.alimenterDateAppelAccessoire(e)},r.alimenterDateAppelAccessoire=function(e){_.forEach(e,function(e){null===e.dateAppelAccessoire&&(e.dateAppelAccessoire=e.dateDebutApplicationElement)})},r.isServicesObjetAScinder=function(e,t){return _.any(e,function(e){return e.numeroPhase>=t&&"PH"===e.codeTypeAccessoireConvention})},r.majCodeTypeAccesAccessoireModifie=function(e){null===e.codeTypeAcces&&(e.codeTypeAcces="M")},r.getDateDebutFinPhase=function(t,n){if(null===n)return null;for(var i=moment(n.dateMiseRecouvrementZero).toDate(),r=null,a=_.sortByOrder(n.phases,function(e){return e.numeroPhase}),o=0,s=a;o<s.length;o++){var u=s[o];if("PF"!==u.codeTypePhase){if(r=e.Commun.ToolsFunctionals.FonctionsAvenant.simulAjoutPeriode(i,u.dureeInitialePhaseCredit,u.uniteDureePhase),u.numeroPhase===t)return[i,r];i=r}}return null},r}();t.ScissionPhase=r}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){var n=e.Commun.Tools.List,i=e.Commun.ToolsFunctionals.FonctionsAvenant,r=function(){function t(){}return t.activerDureeToutePhase=function(t,n,i,r,a,o,s,u){var c=this.getCodeTypeRecalculTa(s);return null==n||null==t||_.isEmpty(t)||i||"2"!==n.modeExpressionDureePhase&&"O"!==t.amenagementEchexistantSurCredit||r!==e.Commun.Enum.CodeTypeAcces.Creation&&r!==e.Commun.Enum.CodeTypeAcces.Modification&&r!==e.Commun.Enum.CodeTypeAcces.Duplication||a||!(t.phases.length>u)||!o&&(o||3!==c&&4!==c||"1"===n.modeCalculAmortissement)?!1:!0},t.getCodeTypeRecalculTa=function(e){switch(e){case"D":return 4;case"E":return 2;case"1":return 3;case"2":return 1;default:return 0}},t.controleReductionDureePhase=function(e,t,r,a,o,s,u){var c=[];if(t.isPhaseActive&&"PF"!==t.codeTypePhase&&!r){for(var l=0,d=null,m=0,h=a,p=s,f=[],A=0,P=0,v=moment(h).set("date",o).toDate(),g=null,C=v,E=h,b=null,T=0,y=0,M=!1,D=0,x=e;D<x.length;D++){var R=x[D];if("DA"===R.codeTypePhase||"DT"===R.codeTypePhase){g=C,C=i.simulAjoutPeriode(g,R.dureeInitialePhaseCredit,R.uniteDureePhase),parseInt(moment(C).format("D"))!==o&&(C=moment(C).set("date",o).toDate()),P=A+1;var S=i.simulConvDuree(R.uniteDureePhase,R.dureeInitialePhaseCredit,"M",365),I=i.simulConvDuree(R.periodiciteCalculInterets,1,"M",365),B=S%I;y=0===B?i.simulConvDuree(R.uniteDureePhase,R.dureeInitialePhaseCredit,R.periodiciteCalculInterets,365):i.simulConvDuree("M",S+I-B,R.periodiciteCalculInterets,365),A=P+y-1}if(f.push({nofafp:R.numeroPhase,nofcfp:R.noRelatifPhaseTypePhaseProduit,ctfcfp:R.codeTypePhase,dateDbtPhase:g,dateFinPhase:C,nPremEch:P,nDernEch:A}),"DA"===R.codeTypePhase||"DT"===R.codeTypePhase)for(var O=1;y>=O;){if(b=i.simulAjoutPeriode(E,1,R.periodiciteCalculInterets),parseInt(moment(b).format("D"))!==o&&(b=moment(b).set("date",o).toDate()),(moment(p).isAfter(E)||moment(p).isSame(E))&&moment(p).isBefore(b)&&!M){M=!0,l=T;break}if(moment(p).isAfter(E)&&(moment(p).isBefore(b)||moment(p).isSame(b))&&!M){M=!0,d=b,m=T+1;break}T+=1,E=b,O+=1}}if(!_.isEmpty(f)){var F=n.findOrEmpty(f,function(e){return e.nofafp===t.numeroPhase&&e.nofcfp===t.numRelatifPhaseTypePhaseProduit&&e.ctfcfp===t.codeTypePhase});if(!_.isEmpty(F)&&F.nDernEch>u&&t.dureeInitiale>t.duree){var L=t.dureeInitiale-t.duree,j=i.simulConvDuree(t.uniteDureePhase,L,"M",365),G=moment(F.dateFinPhase).subtract(j,"M").toDate();(moment(G).isBefore(d)||moment(G).isSame(d))&&c.push("Réduction de la phase antérieure à la première échéance impactée par l'avenant.")}}}return c},t}();t.DureePhase=r}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){var i=e.Commun.Tools.List,r=e.Commun.ToolsFunctionals.FonctionsAvenant,a=function(){function n(){}return n.getModalite=function(e,t,n,r){return i.findOrEmpty(r,function(i){return i.codeFamilleProduit===t&&i.numeroRelatifProduit===n&&i.numModaliteRemboursemntAnticipe===e})},n.getSurcoutRa=function(e,t){return 0===e||isNaN(t.surcoutTauxRA)||null===t.surcoutTauxRA?0:t.surcoutTauxRA},n.getIsVariationIndice=function(e){return null!=e&&0!==e.numeroJeuIndicesRevision&&e.codeFamilleProduit&&e.numeroRelatifProduit&&e.codeTypePhase&&e.numeroJeuIndicesRevision&&"I1"===e.codeTypeRoleIndice&&("Q"===e.mdExpressionValeurUtilisIndice||"D"===e.mdExpressionValeurUtilisIndice)?!0:!1},n.getElementModifiableParAvenant=function(t,n,i){return t.numeroPhase<n.numeroPhase?"N":t.numeroPhase===n.numeroPhase&&("PF"===t.codeTypePhase&&e.Commun.Tools.DateUtils.isEquals(e.Commun.Tools.DateUtils.parse(n.dateEffet),i)||"PF"!==t.codeTypePhase&&n.numeroEcheance===this.getNumeroDerniereEcheancePalier(t))?"N":"O"},n.getNumeroDerniereEcheancePalier=function(e){if(!_.isEmpty(e)){var t=_.filter(e.paliersTauxInterets,function(t){return"O"===t.codeRoleCreditAvenant&&t.numeroPhase===e.numeroPhase});if(t.length>0)return _.max(_.map(t,function(e){return e.numeroDerniereEcheancePalier}))}return 0},n.fctIsDureePhaseAbsorbee=function(e,n,i,a,o){if(""===o||"O"===o)for(var s=_.sortBy(i,function(e){return e.numeroPhase}),u=r.simulConvDuree(e,n,"M",365),c=0,l=0,d=0,m=0,h=s;m<h.length;m++){var p=h[m];if("PF"!==p.codeTypePhase){if(c=r.simulConvDuree(p.uniteDureePhase,p.dureeInitialePhaseCredit,"M",365),d=l,l+=c,u>=l||0>=c){if(a.numeroPhase===p.numeroPhase)return t.Enum.StatutAbsorption.PasAbsorbe}else if(d>=u&&a.numeroPhase===p.numeroPhase)return t.Enum.StatutAbsorption.TotalementAbsorbe}else if(a.numeroPhase===p.numeroPhase)return t.Enum.StatutAbsorption.PasAbsorbe}return t.Enum.StatutAbsorption.PasAbsorbe},n.majStatutPhaseByPalier=function(e,n){if(n===t.Enum.StatutAbsorption.TotalementAbsorbe)return t.Enum.StatutAbsorption.TotalementAbsorbe;if(n===t.Enum.StatutAbsorption.PartiellementAbsorbe)return t.Enum.StatutAbsorption.PartiellementAbsorbe;if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var a=r[i];if(a.statutAbsorptionPalier===t.Enum.StatutAbsorption.TotalementAbsorbe||a.statutAbsorptionPalier===t.Enum.StatutAbsorption.PartiellementAbsorbe)return t.Enum.StatutAbsorption.PartiellementAbsorbe}return t.Enum.StatutAbsorption.PasAbsorbe},n.fctIsDureePalierAbsorbee=function(e,n,i,a,o,s,u,c,l,d){if(""===l||"O"===l){var m=r.simulConvDuree(e,n,"M",365),h=0,p=0,f=0,A=0,P=0;
if("PF"!==o){h=r.simulConvDuree(s,u,"M",365);for(var v=0,g=i;v<g.length;v++){var C=g[v];if(C.numeroPhase===c)if(p=C.numeroDerniereEcheancePalier-C.numeroPremiereEcheancePalier+1,f=r.simulConvDuree(d,p,"M",365),A=P,P+=f,m>=P||0>=p){if(C.numeroRelatif===a.numeroRelatif)return t.Enum.StatutAbsorption.PasAbsorbe}else if(0>=h){if(C.numeroRelatif===a.numeroRelatif)return t.Enum.StatutAbsorption.PasAbsorbe}else if(A>=m)return C.numeroRelatif===a.numeroRelatif?t.Enum.StatutAbsorption.TotalementAbsorbe:t.Enum.StatutAbsorption.PartiellementAbsorbe}}}return t.Enum.StatutAbsorption.PasAbsorbe},n.isPhaseAvailable=function(e){return e.statutPhase===t.Enum.StatutPhase.EncoursOuFuture&&"O"===e.elementModifiableParAvenant},n.miseAJourCodeCaracFinancierePhasePalier=function(e){for(var t=angular.copy(e),n=0,i=t;n<i.length;n++){var r=i[n];this.isPhaseAvailable(r)&&(r.taux!==r.tauxInitial&&(r.cdModifCaracFinanciere="1"),r.listePalier=this.miseAJourCdfinPalier(r.listePalier))}return t},n.miseAJourCdfinPalier=function(e){if(!_.isEmpty(e)){for(var t=angular.copy(e),n=0,i=t;n<i.length;n++){var r=i[n];r.isAffichagePalierDateEffet&&r.taux!==r.tauxInit&&(r.cdModifCaracteristfinancieres="1")}return t}return[]},n.fctIsTypeRemboursementCinq=function(e){for(var t=[],n=0,i=e;n<i.length;n++)for(var r=i[n],a=0,o=r.listePalier;a<o.length;a++){var s=o[a];s.isAffichagePalierDateEffet&&t.push(s)}return _.some(t,function(e){return"5"===e.typeRemboursement})},n.getAvecAjustementEcheances=function(t,n,r){var a=!0,o=_.some(t,function(e){return e.numeroPhase===n}),s=_.sortBy(t,function(e){return e.numeroPhase});if(_.some(s,function(e){return"DA"===e.codeTypePhase||"DT"===e.codeTypePhase}))return!1;var u=i.findOrEmpty(s,function(e){return e.numeroPhase===n&&"PF"===e.codeTypePhase});if(!_.isEmpty(u)){var c=_.filter(s,function(e){return"AM"===e.codeTypePhase});if(1===c.length)return this.isTypeRemboursementValideCalculette(c[0].paliersTauxInterets)}for(var l=0,d=s;l<d.length;l++){var m=d[l];if(!_.isEmpty(m.paliersTauxInterets)){var h=_.filter(m.paliersTauxInterets,function(e){return e.numeroPremiereEcheancePalier<=r&&r<=e.numeroDerniereEcheancePalier||e.numeroPremiereEcheancePalier>=r});if(m.numeroPhase===_.last(s).numeroPhase)if(n!==m.numeroPhase||_.isEmpty(m.paliersTauxInterets))n===m.numeroPhase||_.isEmpty(m.paliersTauxInterets)||o||_.every(h,function(e){return"1"===e.typeRemboursement})&&(a=!1);else if(_.every(h,function(e){return"1"===e.typeRemboursement}))a=!1;else if(_.every(h,function(e){return"6"===e.typeRemboursement}))switch(m.modeCalculAmortissement){case"2":case"7":a=!1;break;case"6":a=!0}else a=e.Business.ToolsFunctionals.FonctionsPhasePalier.isTypeRemboursementValideCalculetteDernierePhase(h,_.last(h).numeroRelatif);else"6"!==m.modeCalculAmortissement&&_.some(h,function(e){return"5"!==e.typeRemboursement&&"7"!==e.typeRemboursement})&&(a=!1)}if(!a)break}return a},n.isTypeRemboursementValideCalculette=function(e){for(var t=!0,n=0,i=e;n<i.length;n++){var r=i[n];"7"!==r.typeRemboursement&&"5"!==r.typeRemboursement&&(t=!1)}return t},n.isTypeRemboursementValideCalculetteDernierePhase=function(e,t){for(var n=!0,i=0,r=e;i<r.length;i++){var a=r[i];"7"!==a.typeRemboursement&&"5"!==a.typeRemboursement&&a.numeroRelatif!==t&&(n=!1)}return n},n.sauvegardePalierTauxInteretAvantCalculette=function(e){for(var t=[],n=0,i=e;n<i.length;n++)for(var r=i[n],a=0,o=r.listePalier;a<o.length;a++){var s=o[a];t.push(s)}return t},n}();n.FonctionsPhasePalier=a}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){var i=e.Commun.ToolsFunctionals.Periodicite,r=e.Commun.Tools.List,a=e.Commun.ToolsFunctionals.FonctionsAvenant,o=function(){function o(){}return o.getListePeriodiciteInteret=function(e){var t=[];return""!==e.perioMiseRecouvrementInterets&&null!==e.perioMiseRecouvrementInterets&&t.push({codePeriode:e.perioMiseRecouvrementInterets,libellePeriode:i.getLibellePeriodicite(e.perioMiseRecouvrementInterets)}),""!==e.periodiciteMERinterets&&null!==e.periodiciteMERinterets&&t.push({codePeriode:e.periodiciteMERinterets,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERinterets)}),""!==e.periodiciteMERinterets1&&null!==e.periodiciteMERinterets1&&t.push({codePeriode:e.periodiciteMERinterets1,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERinterets1)}),""!==e.periodiciteMERinterets2&&null!==e.periodiciteMERinterets2&&t.push({codePeriode:e.periodiciteMERinterets2,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERinterets2)}),""!==e.periodiciteMERinterets3&&null!==e.periodiciteMERinterets3&&t.push({codePeriode:e.periodiciteMERinterets3,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERinterets3)}),t},o.getListePeriodiciteAmortissement=function(e){var t=[];return""!==e.periodiciteMERamortissement&&null!==e.periodiciteMERamortissement&&t.push({codePeriode:e.periodiciteMERamortissement,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERamortissement)}),""!==e.periodiciteMERamortissement1&&null!==e.periodiciteMERamortissement1&&t.push({codePeriode:e.periodiciteMERamortissement1,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERamortissement1)}),""!==e.periodiciteMERamortissement2&&null!==e.periodiciteMERamortissement2&&t.push({codePeriode:e.periodiciteMERamortissement2,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERamortissement2)}),""!==e.periodiciteMERamortissement3&&null!==e.periodiciteMERamortissement3&&t.push({codePeriode:e.periodiciteMERamortissement3,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERamortissement3)}),""!==e.periodiciteMERamortissement4&&null!==e.periodiciteMERamortissement4&&t.push({codePeriode:e.periodiciteMERamortissement4,libellePeriode:i.getLibellePeriodicite(e.periodiciteMERamortissement4)}),t},o.phaseRevisionAleatoire=function(e,t,n,i,a,o,s){if(t)return!1;if(_.isEmpty(e))return!1;var u=r.firstOrEmpty(e);if(!_.isEmpty(u)&&0!==u.paramRevTauxRest.numeroJeuIndicesRevision&&n===i)for(var c=0,l=a;c<l.length;c++){var d=l[c];if(!(d.noRelatifPhaseTypePhaseProduit!==o||d.codeTypePhase!==s||d.numeroJeuIndicesRevision!==u.paramRevTauxRest.numeroJeuIndicesRevision||"I1"!==d.codeTypeRoleIndice&&"I2"!==d.codeTypeRoleIndice||"Q02"!==d.evenDeclenchPremiereRevision1&&"Q03"!==d.evenDeclenchPremiereRevision1&&"P05"!==d.evenDeclenchPremiereRevision11&&"P04"!==d.evenDeclenchPremiereRevision11))return!0}return!1},o.activerPeriodiciteAmortissement=function(t,n,i,r,a,o,s,u){return t.length<=1?!1:"AM"===n&&(i===e.Commun.Enum.CodeTypeAcces.Creation||i===e.Commun.Enum.CodeTypeAcces.Modification||i===e.Commun.Enum.CodeTypeAcces.Duplication)&&"O"===a&&!u&&("1"!==o||r)&&!s},o.getActiverPeriodiciteInter=function(t,n,i,r,a,o,s){return t.length<=1?!1:"PF"!==n&&(i===e.Commun.Enum.CodeTypeAcces.Creation||i===e.Commun.Enum.CodeTypeAcces.Modification||i===e.Commun.Enum.CodeTypeAcces.Duplication)&&("1"!==a||r)&&!s&&!o},o.changePeriodiciteAutomatiqueUnePhase=function(e,t){"O"!==t.phaseByProduit.codePeriodiciteDifferenteMER&&(t.periodiciteAmortissement=angular.copy(e)),"O"!==t.phaseByProduit.cdCalculInteretsDiffRecouvrmnt&&(t.periodiciteCalculInterets=angular.copy(e))},o.impactPeriodicitePhase=function(e,t,i,r,a,o,s,u,c,l){for(var d=angular.copy(t),m=null,h=0,p=d;h<p.length;h++){var f=p[h];c&&f.numeroPhase!==e.numeroPhase||(f.libelleErreurModifPhasePaliers=[],f.isPhaseActive&&(m=f))}return d=this.reportPeriodicite(e,d,r,c),this.controlerReportPeriodicite(e,d,r,c)?(null==m||r||m.periodiciteInteretInitiale.codePeriode===m.periodiciteInteret.codePeriode&&m.periodiciteAmortissementInitiale.codePeriode===m.periodiciteAmortissement.codePeriode||(d=n.ScissionPhase.scissionPhaseEnCours(m,d,i,a,o,s,u,l)),d=this.reportPeriodiciteSurPalier(d,r)):d},o.controlerReportPeriodicite=function(e,i,r,a){for(var o=!1,s=0,u=i;s<u.length;s++){var c=u[s];if((!a||c.numeroPhase===e.numeroPhase)&&c.statutPhase===t.Enum.StatutPhase.EncoursOuFuture){var l=this.verificationDureePeriodiciteSansScission(e.uniteDureePhase,c.duree,e.periodiciteCalculInterets,e.periodiciteInteret,e.periodiciteAmortissement);l.length>0&&(o=!0,n.ScissionPhase.miseAjourErreurPhase(i,c.numeroPhase,l))}}return!o},o.reportPeriodicite=function(e,n,i,r){for(var a=0,o=n;a<o.length;a++){var s=o[a];r&&s.numeroPhase!==e.numeroPhase||s.statutPhase!==t.Enum.StatutPhase.EncoursOuFuture||((i||"AM"===s.codeTypePhase)&&this.reportPeriodiciteTemporairePhase(e,s),(i||!s.isPhasePrefi&&!s.isPhaseActive)&&this.reportPeriodicitePhase(e,s))}return n},o.reportPeriodicitePhase=function(e,t){t.periodiciteInteret=angular.copy(e.periodiciteInteret),t.periodiciteCalculInterets=angular.copy(e.periodiciteCalculInterets),t.periodiciteAmortissement=angular.copy(e.periodiciteAmortissement)},o.reportPeriodiciteTemporairePhase=function(t,n){return n.duree*e.Commun.ToolsFunctionals.Periodicite.getPeriodiciteByUnitePeriode(t.periodiciteAmortissement.codePeriode)%12>0?!1:(n.periodiciteInteretTemporaire=angular.copy(t.periodiciteInteret),n.periodiciteAmortissementTemporaire=angular.copy(t.periodiciteAmortissement),!0)},o.verificationDureePeriodiciteSansScission=function(e,t,n,r,o){var s=[],u=i.getLibellePeriode(e,t>1);return a.simulConvDuree(e,t,"M",365)%a.simulConvDuree(n.codePeriode,1,"M",365)!==0&&s.push("La périodicité de calcul des intérêts ("+n.libellePeriode+") est incompatible avec la durée de la phase ("+t+" "+u+")"),a.simulConvDuree(e,t,"M",365)%a.simulConvDuree(r.codePeriode,1,"M",365)!==0&&s.push("La périodicité de M.E.R des intérêts ("+r.libellePeriode+") est incompatible avec la durée de la phase ("+t+" "+u+")"),a.simulConvDuree(e,t,"M",365)%a.simulConvDuree(o.codePeriode,1,"M",365)!==0&&s.push("La périodicité de M.E.R de l'amortissement ("+o.libellePeriode+") est incompatible avec la durée de la phase ("+t+" "+u+")"),s},o.reportPeriodiciteSurPalier=function(e,t){for(var n=angular.copy(e),r={},o={},s=0,u=n;s<u.length;s++){var c=u[s];if(t&&c.numeroPhase>1||!c.isPhaseActive&&"O"===c.elementModifiableParAvenant){for(var l=0,d=c.listePalier;l<d.length;l++){var m=d[l];_.isEmpty(r)||(m.numeroPremiereEcheance=r.numeroDerniereEcheance+1),m.duree=a.simulConvDuree("M",c.duree,c.periodiciteInteret.codePeriode,365),m.numeroDerniereEcheance=m.duree+m.numeroPremiereEcheance-1,m.periodiciteMERamortissement=c.periodiciteAmortissement.codePeriode,m.periodiciteMERinteretPhase=c.periodiciteInteret.codePeriode,m.libellePeriodeDuree=i.getLibellePeriode(c.periodiciteInteret.codePeriode,m.duree>1),r=angular.copy(m)}if(!_.isEmpty(c.palierProgAmors))for(var h=0,p=c.palierProgAmors;h<p.length;h++){var f=p[h];_.isEmpty(o)?(f.nbEcheance=a.simulConvDuree("M",c.duree,c.periodiciteInteret.codePeriode,365),f.numeroDerniereEcheance=f.nbEcheance+f.numeroPremiereEcheance-1,o=angular.copy(f)):(f.nbEcheance=a.simulConvDuree("M",c.duree,c.periodiciteInteret.codePeriode,365),f.numeroPremiereEcheance=o.numeroDerniereEcheance+1,f.numeroDerniereEcheance=f.nbEcheance+f.numeroPremiereEcheance-1,o=angular.copy(f))}}}return n},o.majPeriodiciteCreditChangePdt=function(e,t){if(null!=e)for(var n=function(e){if(e.numeroPhase>1){var n=r.findOrEmpty(t,function(t){return t.numeroPhase===e.numeroPhase});e.periodiciteCalculInterets=n.periodiciteCalculInterets.codePeriode,e.periodiciteMERamortissement=n.periodiciteAmortissement.codePeriode,e.periodiciteMiseRecouvrInterets=n.periodiciteInteret.codePeriode,e.dureeInitialePhaseCredit=n.duree,null!=e.paliersTauxInterets&&e.paliersTauxInterets.length>0&&null!=n.listePalier&&n.listePalier.length>0&&(e.paliersTauxInterets[0].numeroPremiereEcheancePalier=n.listePalier[0].numeroPremiereEcheance,e.paliersTauxInterets[0].numeroDerniereEcheancePalier=n.listePalier[0].numeroDerniereEcheance)}},i=0,a=e.phases;i<a.length;i++){var o=a[i];n(o)}},o.modifAssurancesByPeriodicite=function(e,t,n,i){var r=angular.copy(n);if(r.length>0){e.isPhaseActive&&!t&&(r=this.scissionAccessoireAssurance(r,e.numeroPhase));for(var a=0,o=r;a<o.length;a++){var s=o[a];s.listeAccessoire=this.modificationAccessoiresAssuranceByPeriodicite(s.etatManipulation,s.listeAccessoire,i)}}return r},o.modificationAccessoiresAssuranceByPeriodicite=function(e,n,i){for(var a=angular.copy(n),o=function(n){if(null==n.accessoireParConvention.periodiciteApplicationAccess&&n.numeroPhase>0){var a=r.findOrEmpty(i,function(e){return e.numeroPhase===n.numeroPhase});_.isEmpty(a)||"N"===a.phaseByProduit.cdCalculInteretsDiffRecouvrmnt&&(e!==t.Enum.EtatManipulation.Unchanged?n.periodiciteApplicationElement=null:n.periodiciteApplicationElement=a.periodiciteCalculInterets.codePeriode,n.etatManipulationAccessoire===t.Enum.EtatManipulation.Unchanged&&(n.etatManipulationAccessoire=t.Enum.EtatManipulation.IsModified))}},s=0,u=a;s<u.length;s++){var c=u[s];o(c)}return a},o.scissionAccessoireAssurance=function(e,n){for(var i=angular.copy(e),r=0,a=i;r<a.length;r++){for(var o=a[r],s={},u=0,c=o.listeAccessoire;u<c.length;u++){var l=c[u];if(l.numeroPhase===n){s=l;break}}if(_.isEmpty(s))return i;var d=angular.copy(s);d.numeroPhase=n+1,d.titreNumPhase="Phase "+d.numeroPhase,d.etatManipulationAccessoire=t.Enum.EtatManipulation.IsCreation,_.each(o.listeAccessoire,function(e){e.numeroPhase>n&&(e.numeroPhase+=1,e.titreNumPhase="Phase "+e.numeroPhase,e.etatManipulationAccessoire=t.Enum.EtatManipulation.IsModified)});var m=_.findIndex(o.listeAccessoire,function(e){return e.numeroPhase===n});o.listeAccessoire.splice(m+1,0,d);var h=_.findIndex(o.listeAccessoire,function(e){return e.numeroPhase===n});o.listeAccessoire.splice(h,1),o.isAvenantPeriodicite=!0,o.isPhaseEnCoursPeriodiciteScinde=!0}return i},o.setIsAnciennePhaseEnCoursOuverture=function(e,t,n){var i=r.findOrEmpty(e,function(e){return e.numeroPhase===t});return"AM"===n&&"N"===i.elementModifiableParAvenant},o.modifGarantieByPeriodicite=function(e,n,i,r){var a=angular.copy(i);if(a.length>0){e.isPhaseActive&&!n&&(a=this.scissionAccessoireGarantie(a,e.numeroPhase));for(var o=0,s=a;o<s.length;o++){var u=s[o];u.isGarantieSuretePersonnelle&&(u.etatManipulation===t.Enum.EtatManipulation.Unchanged&&(u.etatManipulation=t.Enum.EtatManipulation.IsModified),u.garantieSuretePersonnelle.listeAccessoire=this.modificationAccessoiresGarantieByPeriodicite(u.garantieSuretePersonnelle.listeAccessoire,r))}}return a},o.modificationAccessoiresGarantieByPeriodicite=function(e,n){if(!_.isUndefined(e)){for(var i=angular.copy(e),a=function(e){var i=r.findOrEmpty(n,function(t){return t.numeroPhase===e.numeroPhase});_.isEmpty(i)||"N"===i.phaseByProduit.cdCalculInteretsDiffRecouvrmnt&&e.isPeriodique&&(e.periodiciteApplicationElement=i.periodiciteCalculInterets.codePeriode,e.etatManipulationAccessoire===t.Enum.EtatManipulation.Unchanged&&(e.etatManipulationAccessoire=t.Enum.EtatManipulation.IsModified))},o=0,s=i;o<s.length;o++){var u=s[o];a(u)}return i}return[]},o.scissionAccessoireGarantie=function(e,n){for(var i=angular.copy(e),r=0,a=i;r<a.length;r++){var o=a[r];if(o.isGarantieSuretePersonnelle&&!_.isUndefined(o.garantieSuretePersonnelle.listeAccessoire)&&_.every(o.garantieSuretePersonnelle.listeAccessoire||[],function(e){return e.isPeriodique})){for(var s={},u=0,c=o.garantieSuretePersonnelle.listeAccessoire;u<c.length;u++){var l=c[u];if(l.numeroPhase===n){s=l;break}}if(_.isEmpty(s))return i;var d=angular.copy(s);d.numeroPhase=n+1,d.titreNumPhase="Phase "+d.numeroPhase,d.etatManipulationAccessoire=t.Enum.EtatManipulation.IsCreation,_.each(o.garantieSuretePersonnelle.listeAccessoire,function(e){e.numeroPhase>n&&(e.numeroPhase+=1,e.titreNumPhase="Phase "+e.numeroPhase,e.etatManipulationAccessoire=t.Enum.EtatManipulation.IsModified)});var m=_.findIndex(o.garantieSuretePersonnelle.listeAccessoire,function(e){return e.numeroPhase===n});o.garantieSuretePersonnelle.listeAccessoire.splice(m+1,0,d);var h=_.findIndex(o.garantieSuretePersonnelle.listeAccessoire,function(e){return e.numeroPhase===n});o.garantieSuretePersonnelle.listeAccessoire.splice(h,1),o.isAvenantPeriodicite=!0,o.isPhaseEnCoursPeriodiciteScinde=!0}}return i},o}();n.PeriodicitePhase=o}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){var i=e.Commun.Tools.List,r=function(){function r(){}return r.impactModifTauxInteret=function(e,t,i,r){var a=angular.copy(t),o=angular.copy(e);if(!r&&!_.isEmpty(o)){for(var s=0,u=a;s<u.length;s++){var c=u[s];c.numeroPhase===o.numeroPhase&&(c.libelleErreurModifPhasePaliers=[],_.each(c.listePalier,function(e){return e.libelleErreurModifPaliers=[]}))}var l=n.ScissionPalierTauxInteret.scissionPalierPhaseEnCours(o,i.numeroEcheance,o.listePalier);o.libelleErreurModifPhasePaliers=n.ScissionPalierTauxInteret.getMessageErreurPalierTauxInteret(l),o.listePalier=_.filter(l,function(e){return e.numeroPhase===o.numeroPhase});var d=_.findIndex(a,function(e){return e.numeroPhase===o.numeroPhase});a.splice(d,1,o)}return a},r.reportTauxCreditDirecteurSurPhase=function(e,t){for(var i=angular.copy(e),r=0,a=i;r<a.length;r++){var o=a[r];if(n.FonctionsPhasePalier.isPhaseAvailable(o)){o.tauxDirecteur!==t&&(o.tauxDirecteur=t),o.taux=t;for(var s=0,u=o.listePalier;s<u.length;s++){var c=u[s];c.taux=t}}}return i},r.reportTauxPhaseDirectrice=function(e,r,a,o,s,u,c){var l=angular.copy(e);if(c)for(var d=0,m=l;d<m.length;d++){var h=m[d];n.FonctionsPhasePalier.isPhaseAvailable(h)&&"O"===h.elementModifiableParAvenant&&h.numeroPhase===r.numeroPhase&&this.reportTauxPhaseDirectriceSurUnePhase(r.tauxDirecteur,h,u)}else for(var p=0,f=l;p<f.length;p++){var h=f[p];n.FonctionsPhasePalier.isPhaseAvailable(h)&&"O"===h.elementModifiableParAvenant&&h.phaseByProduit.cdModeExpressionTauxMoyenPhase===r.phaseByProduit.cdModeExpressionTauxMoyenPhase&&(this.reportTauxPhaseDirectriceSurUnePhase(r.tauxDirecteur,h,u),a&&(h.activerPeriodiciteInteret=!1,h.activerPeriodiciteAmor=!1))}return l=t.ToolsFunctionals.ModificationTauxInteret.impactModifTauxInteret(i.findOrEmpty(l,function(e){return e.numeroPhase===r.numeroPhase}),l,s,o),_.isEmpty(r.palierProgAmors)||(l=t.ToolsFunctionals.ModificationTauxProgAmor.impactModifTauxInteretSurPalierProgAmor(i.findOrEmpty(l,function(e){return e.numeroPhase===r.numeroPhase}),l,s,o)),l},r.reportTauxPhaseDirectriceSurUnePhase=function(t,n,i){n.tauxDirecteur!==t&&(n.tauxDirecteur=t),n.taux=t;for(var r=0,a=n.listePalier;r<a.length;r++){var o=a[r];i===e.Commun.Enum.CodeTypeAcces.Creation&&o.isAffichagePalierDateEffet?o.taux=t:i===e.Commun.Enum.CodeTypeAcces.Modification&&o.isPalierApresDateEffet&&(o.taux=t)}},r.reportTauxPalierDirecteur=function(e,r,a,o,s,u,c,l){var d=angular.copy(e);if(a)for(var m=0,h=d;m<h.length;m++){var p=h[m];n.FonctionsPhasePalier.isPhaseAvailable(p)&&p.numeroPhase===r.numeroPhase&&this.reportTauxPalierDirecteurPhaseSelectionne(o,r.tauxDirecteur,r.codeTypePhase,r.numRelatifPhaseTypePhaseProduit,p,s,u)}else for(var f=0,A=d;f<A.length;f++){var p=A[f];n.FonctionsPhasePalier.isPhaseAvailable(p)&&(this.reportTauxPalierDirecteurPhaseSelectionne(o,r.tauxDirecteur,r.codeTypePhase,r.numRelatifPhaseTypePhaseProduit,p,s,u),l&&(p.activerPeriodiciteInteret=!1,p.activerPeriodiciteAmor=!1))}if(d=t.ToolsFunctionals.ModificationTauxInteret.impactModifTauxInteret(i.findOrEmpty(d,function(e){return e.numeroPhase===r.numeroPhase}),d,c,o),!_.isEmpty(r.palierProgAmors)){d=t.ToolsFunctionals.ModificationTauxProgAmor.impactModifTauxInteretSurPalierProgAmor(i.findOrEmpty(d,function(e){return e.numeroPhase===r.numeroPhase}),d,c,o);var P=i.findOrEmpty(d,function(e){return e.numeroPhase===r.numeroPhase});if("C"!==c.codeRoleCreditAvenant)for(var v=0,g=d;v<g.length;v++){var C=g[v];if(C.numeroPhase===P.numeroPhase)for(var E=0,b=C.palierProgAmors;E<b.length;E++){var T=b[E];"O"===T.cdIndexTauxProgAmor&&(T.tauxProgAmor=t.ToolsFunctionals.ModificationTauxProgAmor.rechercheTxIndexeProgAmor(T,C.listePalier))}}}return d},r.reportTauxPalierDirecteurPhaseSelectionne=function(e,t,n,i,r,a,o){r.tauxDirecteur!==t&&(r.tauxDirecteur=t);for(var s=0,u=r.listePalier;s<u.length;s++){var c=u[s];c.isAffichagePalierDateEffet&&(c.taux=t)}e&&this.isReportTauxDirecteurPhaseCredit(n,i,a,o)&&(r.taux=t)},r.isReportTauxDirecteurPhaseCredit=function(e,t,n,r){var a=i.findOrEmpty(n,function(n){return n.codeTypePhase===e&&n.noRelatifPhaseTypePhaseProduit===t});return _.isEmpty(a)?!1:"O"!==r&&"N"===a.codeTauxDesPaliersCalcules},r}();n.ModificationTauxInteret=r}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){var i=e.Commun.Tools.List,r=e.Commun.ToolsFunctionals.FonctionsAvenant,a=e.Commun.ToolsFunctionals.Periodicite,o=function(){function e(){}return e.afficherOngletPalierTauxProgAmor=function(e){var t=i.findOrEmpty(e,function(e){return e.isPhaseActive});return _.isEmpty(t)?!1:"PF"===t.codeTypePhase||"2"!==t.phaseByProduit.modeCalculAmortissement&&"7"!==t.phaseByProduit.modeCalculAmortissement?!1:!0},e.getTauxProgressionAmortissement=function(e,t,n,i){if(e){for(var r=0,a=0,o=n;a<o.length;a++){var s=o[a];s.numeroPremiereEcheance<=i&&r<s.taux&&(r="1"===s.cdModifCaracteristfinancieres?s.taux:t)}return r}return t},e.fctIsDureePalierProgAmorAbsorbee=function(e,n,i,a,o,s,u,c,l,d){if(""===l||"O"===l){var m=r.simulConvDuree(e,n,"M",365),h=0,p=0,f=0,A=0,P=0;if("PF"!==o){h=r.simulConvDuree(s,u,"M",365);for(var v=0,g=i;v<g.length;v++){var C=g[v];if(C.numeroPhase===c)if(p=C.numeroDerniereEcheancePalier-C.numeroPremiereEcheancePalier+1,f=r.simulConvDuree(d,p,"M",365),A=P,P+=f,m>=P||0>=p){if(C.numeroRelatif===a.numeroRelatif)return t.Enum.StatutAbsorption.PasAbsorbe}else if(0>=h){if(C.numeroRelatif===a.numeroRelatif)return t.Enum.StatutAbsorption.PasAbsorbe}else if(A>=m){if(C.numeroRelatif===a.numeroRelatif)return t.Enum.StatutAbsorption.TotalementAbsorbe}else if(C.numeroRelatif===a.numeroRelatif)return t.Enum.StatutAbsorption.PartiellementAbsorbe}}}return t.Enum.StatutAbsorption.PasAbsorbe},e.impactModifTauxProgAmor=function(e,t,n,r,a,o){for(var s=angular.copy(t),u=[],c=i.findOrEmpty(s,function(t){return t.numeroPhase===e.numeroPhase}),l=0,d=s;l<d.length;l++){var m=d[l];m.numeroPhase===e.numeroPhase&&o&&(m.activerPeriodiciteInteret=!1,m.activerPeriodiciteAmor=!1)}if(u=this.controleDureePalierProgAmor(e,r,c.uniteDureePhase,c.periodiciteCalculInterets.codePeriode,n.amenagementEchexistantSurCredit,e.nbEcheanceInit),u.length>0)return s;var h="D";return"D"===h&&(e.numeroDerniereEcheance=e.numeroPremiereEcheance+(e.nbEcheance-1)),"P"===h&&(e.numeroPremiereEcheance=e.numeroDerniereEcheance-(e.nbEcheance-1)),s=this.miseAJourPalierProgAmorToutePhase(e,s,n.codeRoleCreditAvenant,a)},e.impactModifTauxInteretSurPalierProgAmor=function(e,t,r,a){var o=angular.copy(t);o=this.impactModifDureePeriodicitePhaseSurPalierProgAmor(i.findOrEmpty(o,function(t){return t.numeroPhase===e.numeroPhase}),o,r,a);var s=i.findOrEmpty(o,function(t){return t.numeroPhase===e.numeroPhase});if(s.numeroPhase===r.numeroPhase&&"1"===s.phaseByRest.codeTauxDesPaliersCalcules&&(s.tauxInitial!==s.taux||s.margeInitiale!==s.marge)&&!a&&"AM"===s.codeTypePhase&&1===s.numRelatifPhaseTypePhaseProduit&&""!==r.codeTypePretCombine&&null!==r.codeTypePretCombine){var u=angular.copy(e.palierProgAmors);u=n.ScissionPalierProgressionAmortissement.scissionPalierProgAmorPhaseEnCours(s,r.numeroEcheance,s.palierProgAmors);var c=n.ScissionPalierProgressionAmortissement.getMessageErreurPalierProgressionAmortissement(u);if(c.length>0)return n.ScissionPhase.miseAjourErreurPhase(o,s.numeroPhase,c);s.palierProgAmors=_.filter(u,function(e){return e.numeroPhase===s.numeroPhase});var l=_.findIndex(o,function(e){return e.numeroPhase===s.numeroPhase});o.splice(l,1,s)}for(var d=0,m=s.palierProgAmors;d<m.length;d++){var h=m[d];"O"===h.cdIndexTauxProgAmor&&"1"===s.phaseByRest.codeTauxDesPaliersCalcules&&"C"!==r.codeRoleCreditAvenant&&(h.tauxProgAmor=this.rechercheTxIndexeProgAmor(h,s.listePalier))}return o},e.impactModifDureePeriodicitePhaseSurPalierProgAmor=function(e,n,a,o){var s=angular.copy(n),u=[],c=0,l={};if("C"!==a.codeRoleCreditAvenant){l=i.lastOrEmpty(e.palierProgAmors);for(var d=0,m=e.palierProgAmors;d<m.length;d++){var h=m[d];c=c+h.numeroDerniereEcheance-h.numeroPremiereEcheance+1}}if((e.duree!==e.dureeInitiale||e.periodiciteInteret.codePeriode!==e.periodiciteInteretInitiale.codePeriode)&&"PF"!==e.codeTypePhase&&!_.isEmpty(l)){c=r.simulConvDuree(e.periodiciteInteret.codePeriode,c,"M",365);var p=r.simulConvDuree(e.periodiciteInteret.codePeriode,l.numeroDerniereEcheance-l.numeroPremiereEcheance+1,"M",365),f=r.simulConvDuree(e.uniteDureePhase,e.duree,"M",365),A=f-(c-p);(e.statutAbsorptionPhase===t.Enum.StatutAbsorption.TotalementAbsorbe||e.statutAbsorptionPhase===t.Enum.StatutAbsorption.PartiellementAbsorbe)&&(A=p);var P=r.simulConvDuree("M",A,e.periodiciteInteret.codePeriode,365);return u=this.controleDureePalierProgAmor(l,o,e.uniteDureePhase,e.periodiciteCalculInterets.codePeriode,a.amenagementEchexistantSurCredit,P),u.length>0?s:s=this.miseAJourPalierProgAmorToutePhase(l,s,a.codeRoleCreditAvenant)}return s},e.controleDureePalierProgAmor=function(e,t,n,i,o,s){var u=[];if(e.nbEcheance!==s){var c=e.nbEcheance,l=0,d=0;if(t?(l=r.simulConvDuree(n,e.palierProgAmorProduit.dureeMiniPalierProgreAmort,"M",365),d=r.simulConvDuree(n,e.palierProgAmorProduit.dureeMaxiPalierProgreAmort,"M",365)):(l=r.simulConvDuree(n,1,"M",365),l<r.simulConvDuree(i,1,"M",365)&&(l=r.simulConvDuree(i,1,"M",365),""!==e.palierProgAmorProduit.periodiciteApplicProgreAmort&&null!==e.palierProgAmorProduit.periodiciteApplicProgreAmort&&l<r.simulConvDuree(e.palierProgAmorProduit.periodiciteApplicProgreAmort,1,"M",365)&&(l=r.simulConvDuree(e.palierProgAmorProduit.periodiciteApplicProgreAmort,1,"M",365))),d=r.simulConvDuree(n,e.palierProgAmorProduit.dureeMaxiPalierProgreAmort,"M",365)),"O"!==o&&(r.simulConvDuree(i,c,"M",365)<l||d<r.simulConvDuree(i,c,"M",365))){var m=a.getLibellePeriode(n,d>1);u.push("La durée du palier de progression d'amortissement doit être dans les bornes autorisées."),u.push("["+l+" ; "+d+"] "+m)}if(""!==e.palierProgAmorProduit.periodiciteApplicProgreAmort&&null!==e.palierProgAmorProduit.periodiciteApplicProgreAmort&&r.simulConvDuree(i,c,"M",365)%r.simulConvDuree(e.palierProgAmorProduit.periodiciteApplicProgreAmort,1,"M",365)!==0){var m=a.getLibellePeriodicite(e.palierProgAmorProduit.periodiciteApplicProgreAmort);u.push("La durée du palier de progression d'amortissement doit être multiple de la périodicité d'application de progression d'amortissement ("+m+")")}}return u},e.ajustementDureeDernierPalierProgAmor=function(e){},e.miseAJourPalierProgAmorToutePhase=function(e,t,n,i){void 0===i&&(i=!1);var r=angular.copy(t);if("C"!==n)for(var a=e.numeroDerniereEcheance,o=0,s=0,u=r;s<u.length;s++){for(var c=u[s],l=_.sortByOrder(c.palierProgAmors,function(e){return e.numeroRelatif}),d=_.sortByOrder(c.listePalier,function(e){return e.numeroRelatif}),m=0,h=l;m<h.length;m++){var p=h[m];p.numeroPhase===e.numeroPhase&&p.numeroRelatif===e.numeroRelatif&&(p.tauxProgAmor=e.tauxProgAmor),(p.numeroPhase>e.numeroPhase||p.numeroPhase===e.numeroPhase&&p.numeroRelatif>e.numeroRelatif)&&(o=p.numeroDerniereEcheance-p.numeroPremiereEcheance,p.numeroPremiereEcheance=a+1,p.numeroDerniereEcheance=p.numeroPremiereEcheance+o,a=p.numeroDerniereEcheance,"O"===p.cdIndexTauxProgAmor?p.tauxProgAmor=this.rechercheTxIndexeProgAmor(p,d):i&&(p.tauxProgAmor=e.tauxProgAmor))}c.palierProgAmors=angular.copy(l)}return r},e.rechercheTxIndexeProgAmor=function(e,t){for(var n=0,i={},r=0,a=t;r<a.length;r++){var o=a[r];o.codeRoleCreditAvenant===e.codeRoleCreditAvenant&&o.numeroPhase===e.numeroPhase&&o.numeroPremiereEcheance<=e.numeroPremiereEcheance&&o.numeroPremiereEcheance>n&&(n=o.numeroPremiereEcheance,i=angular.copy(o))}return _.isEmpty(i)?0:"1"===i.cdModifCaracteristfinancieres||i.isAffichagePalierDateEffet&&i.taux!==i.tauxInit?i.taux:e.tauxProgAmor},e}();n.ModificationTauxProgAmor=o}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){var n=e.Commun.Tools.List,i=function(){function e(){}return e.impactModifTauxProgEch=function(e,i,r,a,o,s){var u=angular.copy(i);if(a)for(var c=0,l=u;c<l.length;c++){var d=l[c];if(d.numeroPhase>1)for(var m=0,h=d.listePalier;m<h.length;m++){var p=h[m];p.tauxProgEch=e.tauxProgEch}}else{for(var f=0,A=u;f<A.length;f++){var d=A[f];if(d.numeroPhase===e.numeroPhase){for(var P=0,v=d.listePalier;P<v.length;P++){var p=v[P];p.isAffichagePalierDateEffet&&!p.isPalierAvecTauxProgEchAZero&&p.isPalierModifiableParAvenant&&(p.tauxProgEch=e.tauxProgEch)}s&&(d.activerPeriodiciteInteret=!1,d.activerPeriodiciteAmor=!1)}}for(var g=n.findOrEmpty(u,function(t){return t.numeroPhase===e.numeroPhase}),C=0,E=u;C<E.length;C++){var b=E[C];b.numeroPhase===g.numeroPhase&&(b.libelleErreurModifPhasePaliers=[],_.each(b.listePalier,function(e){return e.libelleErreurModifPaliers=[]}))}var T=angular.copy(g.listePalier);T=t.ScissionPalierTauxInteret.scissionPalierPhaseEnCours(g,r.numeroEcheance,T),g.libelleErreurModifPhasePaliers=t.ScissionPalierTauxInteret.getMessageErreurPalierTauxInteret(T),g.listePalier=_.filter(T,function(e){return e.numeroPhase===g.numeroPhase});var y=_.findIndex(u,function(e){return e.numeroPhase===g.numeroPhase});if(u.splice(y,1,g),_.isEmpty(g.libelleErreurModifPhasePaliers)&&o)for(var M=0,D=u;M<D.length;M++){var d=D[M];if(d.numeroPhase>g.numeroPhase)for(var x=0,R=d.listePalier;x<R.length;x++){var p=R[x];p.tauxProgEch=e.tauxProgEch}}}return u},e.getActiverTauxProgEch=function(e,t,n){return"0"!==e&&t!==n},e.afficherOngletPalierTauxProgEch=function(e){var t=n.findOrEmpty(e,function(e){return e.isPhaseActive});return _.isEmpty(t)?!1:_.some(t.listePalier,function(e){return e.activerTauxProgEch})},e}();t.ModificationTauxProgEch=i}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=e.Commun.ToolsFunctionals.Periodicite,r=function(){function t(){}return t.getResult=function(t,r,a,o,s,u){var c=_.some(a,function(e){return"21"===e.codeNatureAccessoire}),l=_.some(a,function(e){return"22"===e.codeNatureAccessoire}),d=n.findOrEmpty(a,function(e){return"21"===e.codeNatureAccessoire}),m=n.findOrEmpty(a,function(e){return"22"===e.codeNatureAccessoire}),h=this.getNbrMaxEchReportes(t);if(o===e.Commun.Enum.CodeTypeAcces.Creation)return{titre:"Nouveau report fin de prêt",creation:!0,isReportFinPretCree:!1,reportFinPretAccesValidation:!0,isSecurisationActiv:this.getSecurisationActiv(t.codeCreditSecurisable),isSecurisationOpen:!1,modeEdition:!1,isEditionCanBeCanceled:!0,isComboTaux:l?m.numeroPhase===r.numeroPhase&&"4"===m.codeModeCalculAccessoire:!1,isComboQuotite:l?m.numeroPhase===r.numeroPhase&&"4"===m.codeModeCalculAccessoire:!1,dateDebutApplication:null,dateFinApplication:null,quotite:a.length>0?100:null,quotiteMin:c?100*d.tauxMinimumAccessoire:null,quotiteMax:c?100*d.tauxMaximumAccessoire:null,quotiteConseille:c?100*d.tauxConseilleAccessoire:null,quotiteCombo:c?[{label:"Quotité minimum: "+d.tauxMinimumAccessoire,value:d.tauxMinimumAccessoire},{label:"Quotité conseillé: "+d.tauxConseilleAccessoire,value:d.tauxConseilleAccessoire},{label:"Quotité maximum: "+d.tauxMaximumAccessoire,value:d.tauxMaximumAccessoire}]:null,libelleHelpQuotite:c?"["+100*d.tauxMinimumAccessoire+".."+100*d.tauxMaximumAccessoire+"]":null,echeancesReportees:c?d.nbrEcheancesAccessoiresReport:null,phasePeriodiciteMiseRecouvrInterets:r.periodiciteMiseRecouvrInterets,periodiciteEcheanceReportees:i.getLibellePeriode(r.periodiciteMiseRecouvrInterets,!1),libelleDureeEcheancesReportees:a.length>0?r.periodiciteCalculInterets:null,tauxFrais:a.length>0?r.tauxNominalPhase:null,tauxFraisMin:l?m.tauxMinimumAccessoire:null,tauxFraisMax:l?m.tauxMaximumAccessoire:null,tauxConseille:l?m.tauxConseilleAccessoire:null,tauxCredit:r.tauxNominalPhase,tauxCombo:l?[{label:"Taux minimum: "+m.tauxMinimumAccessoire,value:m.tauxMinimumAccessoire
},{label:"Taux conseillé: "+m.tauxConseilleAccessoire,value:m.tauxConseilleAccessoire},{label:"Taux maximum: "+m.tauxMaximumAccessoire,value:m.tauxMaximumAccessoire}]:null,libelleHelpTauxFrais:l?"["+m.tauxMinimumAccessoire+".."+m.tauxMaximumAccessoire+"]":null,etatAvant:this.getEtatAvantAvenant(m),etatActuel:this.getEtatActuel(m),action:"Création",isReportFinPretPossible:a.length>0,accessoires:a,numeroPlanSecurisation:1,nbPeriodeFractionnement:1,dateDebutChomage:"",libelleHelpNbrEchReportees:"[1.."+h+"]",nbrEchReporteesMax:h};var p=n.findOrEmpty(s.accessoires,function(e){return"21"===e.codeNatureAccessoire}),f=n.findOrEmpty(s.accessoires,function(e){return"22"===e.codeNatureAccessoire}),A=n.firstOrEmpty(s.echeancesReportees);return{titre:"",isReportFinPretCree:!0,creation:!1,reportFinPretAccesValidation:!0,isSecurisationActiv:this.getSecurisationActiv(t.codeCreditSecurisable),isSecurisationOpen:"S"===A.codeTypeModificationCredit,modeEdition:!1,isEditionCanBeCanceled:!0,isComboTaux:l?m.numeroPhase===r.numeroPhase&&"4"===m.codeModeCalculAccessoire:!1,isComboQuotite:l?m.numeroPhase===r.numeroPhase&&"4"===m.codeModeCalculAccessoire:!1,dateDebutApplication:moment(p.dateDebutApplicationElement).toDate(),dateFinApplication:null,quotite:100*p.tauxElement,quotiteMin:c?100*d.tauxMinimumAccessoire:null,quotiteMax:c?100*d.tauxMaximumAccessoire:null,quotiteConseille:c?100*d.tauxConseilleAccessoire:null,quotiteCombo:c?[{label:"Quotité minimum: "+d.tauxMinimumAccessoire,value:d.tauxMinimumAccessoire},{label:"Quotité conseillé: "+d.tauxConseilleAccessoire,value:d.tauxConseilleAccessoire},{label:"Quotité maximum: "+d.tauxMaximumAccessoire,value:d.tauxMaximumAccessoire}]:null,libelleHelpQuotite:c?"["+100*d.tauxMinimumAccessoire+".."+100*d.tauxMaximumAccessoire+"]":null,echeancesReportees:A.nombreEcheancesAccessReport,phasePeriodiciteMiseRecouvrInterets:r.periodiciteMiseRecouvrInterets,periodiciteEcheanceReportees:i.getLibellePeriode(r.periodiciteMiseRecouvrInterets,!1),libelleDureeEcheancesReportees:a.length>0?r.periodiciteCalculInterets:null,tauxFrais:f.tauxElement,tauxFraisMin:l?m.tauxMinimumAccessoire:null,tauxFraisMax:l?m.tauxMaximumAccessoire:null,tauxConseille:l?m.tauxConseilleAccessoire:null,tauxCredit:r.tauxNominalPhase,tauxCombo:l?[{label:"Taux minimum: "+m.tauxMinimumAccessoire,value:m.tauxMinimumAccessoire},{label:"Taux conseillé: "+m.tauxConseilleAccessoire,value:m.tauxConseilleAccessoire},{label:"Taux maximum: "+m.tauxMaximumAccessoire,value:m.tauxMaximumAccessoire}]:null,libelleHelpTauxFrais:l?"["+m.tauxMinimumAccessoire+".."+m.tauxMaximumAccessoire+"]":null,etatAvant:this.getEtatAvantAvenant(f),etatActuel:this.getEtatActuel(f),action:"Consultation",isReportFinPretPossible:a.length>0?!0:!1,accessoires:a,numeroPlanSecurisation:A.numeroPlanSecurisation,nbPeriodeFractionnement:A.numeroPeriodeFractionneme,dateDebutChomage:A.dateDebutChomage,libelleHelpNbrEchReportees:"[1.."+h+"]",nbrEchReporteesMax:h}},t.getSecurisationActiv=function(e){return"O"!==e?!1:!0},t.getEtatAvantAvenant=function(e){return"O"===e.indicAccessoireCreeParAvenant||"2"!==e.indicateurAccessoireValide&&"O"!==e.indicateurAccessoireAnnuleAv?"Inexistant":"Existant"},t.getEtatActuel=function(e){return"O"===e.indicAccessoireCreeParAvenant?"Créé Av":"O"===e.indicateurAccessoireAnnuleAv?"Annulé Av":""},t.getNbrMaxEchReportes=function(e){for(var t=_.sortByOrder(e.phases,function(e){return e.numeroPhase}),n=0,i=0,r=t;i<r.length;i++){var a=r[i];if("PF"!==a.codeTypePhase&&(n+=a.dureeInitialePhaseCredit,a.numeroPhase===e.numeroPhase))return n-e.numeroEcheance}return n},t}();t.AvenantReportFinPretBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function t(){}return t.getTocByGarantie=function(e,t,n,i){return{typologieLObjet:null!=e?e.typologieLObjet:null,typeObjetFinanGaranti:t.typeObjetFinanceGaranti,categorieReglementaireAttrib:t.categorieReglementaireAttrib,libelleLong:t.libelleTypeObjetCommercialToc,listeTor:this.getListeTorByToc(t,n,i)}},t.getListeTorByToc=function(t,n,i){var r=_.filter(n,function(e){return e.categorieReglementaireAttrib===t.categorieReglementaireAttrib}),a=_.map(r,function(n){var r=_.find(i,function(e){return e.typeObjetReglementeTor===n.typeObjetReglementeTor});return null!=r?e.TypeObjetReglementBuilder.getTorByGaranties(r,t.typeObjetFinanceGaranti):null});return _.sortByOrder(_.compact(a),function(e){return e.libelle},!0)},t.getTocByObjet=function(t,n){return{typeObjetFinanGaranti:t.typeObjetFinanceGaranti,libelleLong:t.libelleTypeObjetCommercialToc,listeTor:_.map(_.filter(n,function(e){return e.typeObjetFinanceGaranti===t.typeObjetFinanceGaranti}),function(t){return e.TypeObjetReglementBuilder.getTorByObjet(t)}),codeNatureFinancement:t.codeNatureFinancement,codeAffectationObjet:t.codeAffectationObjet}},t}();e.TypeObjetCommercialBuilder=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getTorByGaranties=function(e,t){return{type:e.typeObjetReglementeTor,libelle:e.libelleTypeObjetReglementeTor,codeTypeObjetFinanceGaranti:t}},e.getTorByObjet=function(e){return{type:e.typeObjetReglementeTor,libelle:e.libelleTypeObjetReglementeTor,codeTypeObjetFinanceGaranti:e.typeObjetFinanceGaranti}},e}();e.TypeObjetReglementBuilder=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(){}return t.getPeriodicite=function(t){return{code:t,libelle:e.Commun.ToolsFunctionals.Periodicite.getLibellePeriodicite(t)}},t}();t.PeriodiciteBuilder=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=function(){function r(r,a){this.idIhm=r,null!=a?(this.montant=a.montantVersementAttendu,this.typeVersement=e.Commun.ToolsFunctionals.Garantie.getTypeVersementByCode(a.typeVersement),this.dateDebut=i.parse(a.dateDebutVersementAttendu),this.dateFin=null!=a.dateFinVersementAttendu?i.parse(a.dateFinVersementAttendu):null,this.periodicite=null!=a.codePeriodicite?n.PeriodiciteBuilder.getPeriodicite(a.codePeriodicite):null,this.isModeEdition=!1,this.isCreationFirstEdition=!1,this.etatManipulation=t.Enum.EtatManipulation.Unchanged):(this.typeVersement=e.Commun.Enum.TypeVersement.aperiodique,this.periodicite=n.PeriodiciteBuilder.getPeriodicite("M"),this.isModeEdition=!0,this.isCreationFirstEdition=!0,this.etatManipulation=t.Enum.EtatManipulation.IsCreation)}return Object.defineProperty(r.prototype,"isPeriodique",{get:function(){return null!=this.typeVersement&&this.typeVersement.key===e.Commun.Enum.TypeVersement.periodique.key},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isEditionCanBeCanceled",{get:function(){return this.isModeEdition&&!this.isCreationFirstEdition},enumerable:!0,configurable:!0}),r.prototype.showErreurDateFin=function(){return this.isPeriodique&&i.isValued(this.dateDebut)&&i.isValued(this.dateFin)?!i.isAfter(this.dateFin,this.dateDebut):!1},r}();n.VersementAttendu=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e,t,n){this.codeEtablissement=e.codeEtablissement,this.codeTypeAccessoire=e.codeTypeAccessoire,this.dateFinApplication=e.dateFinApplication,this.dateDebutApplication=e.dateDebutApplication,this.codeModeCalculAccessoire=e.codeModeCalculAccessoire,this.montantConseilleAccessoire=e.montantConseilleAccessoire,this.montantMinimumPlageAccessoire=e.montantMinimumPlageAccessoire,this.montantMaximumPlageAccessoire=e.montantMaximumPlageAccessoire,this.mtPlafondTrancheCalculAccess=e.mtPlafondTrancheCalculAcc,this.tauxConseilleAccessoire=e.tauxConseilleAccessoire,this.tauxMinimumAccessoire=e.tauxMinimumAccessoire,this.tauxMaximumAccessoire=e.tauxMaximumAccessoire,this.mtPlafondTrancheCalculAccess1=e.mtPlafondTrancheCalculAcc1,this.tauxElement=e.tauxElement,this.tauxMinimumAccessoire1=e.tauxMinimumAccessoire1,this.tauxMaximumAccessoire1=e.tauxMaximumAccessoire1,this.mtPlafondTrancheCalculAccess2=e.mtPlafondTrancheCalculAcc2,this.tauxElement1=e.tauxElement1,this.tauxMinimumAccessoire2=e.tauxMinimumAccessoire2,this.tauxMaximumAccessoire2=e.tauxMaximumAccessoire2,this.mtPlafondTrancheCalculAccess3=e.mtPlafondTrancheCalculAcc3,this.tauxElement2=e.tauxElement2,this.tauxMinimumAccessoire3=e.tauxMinimumAccessoire3,this.tauxMaximumAccessoire3=e.tauxMaximumAccessoire3,this.mtPlafondTrancheCalculAccess4=e.mtPlafondTrancheCalculAcc4,this.tauxElement3=e.tauxElement3,this.tauxMinimumAccessoire4=e.tauxMinimumAccessoire4,this.tauxMaximumAccessoire4=e.tauxMaximumAccessoire4,this.regleAppelAccessoireAperiodique=e.regleAppelAccessoireAperiodique,this.libelleStandard=e.libelleLongAccessoireCompl,this.codeTypeAssietteCalculAccess=e.codeTypeAssietteCalculAcc,this.dureeApplicationAccessoire=e.dureeApplicationAccessoire,this.periodiciteApplicationAccess=e.periodiciteApplicationAcc,this.numeroRegleApplicationAccess=e.numeroRegleApplicationAcc,this.uniteDureeApplicAccess=e.uniteDureeApplicAccess,this.codeTypeApplicationAccessoire=e.codeTypeApplicationAccessoire,this.cdCommissionIntervenantExterne=e.cdCommissionIntervenantExterne,this.nbJoursAnneeNumerateur=e.nbJoursAnneeNumerateur,this.nbJoursAnneeDenominateur=e.nbJoursAnneeDenominateur,this.libelleTypeAccessoire=e.libelleLongAccessoireCompl,this.mtPasMontantAccessoire=0,this.codeTypePhase=t,this.numeroPhase=n}return e}();e.AccessoireAnnexeadapter=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getPersonneEmprunteurByRestPersonneEmprunteur=function(e){return{codeEtablissement:e.codeEtablissement,codeEmprunteur:e.identifiantEmprunteur,identifiantPersonne:e.identifiantPersonne,noOrdrePersonneDansEmprunteur:e.numeroOrdrePersonne,codeTypePersonne:e.codeTypePersonne,typeRolePersonne:e.typeRolePersonne,roleLIntervenant:null}},e.getPersonneEmprunteurByRestTiersLies=function(e){return{codeEtablissement:null,codeEmprunteur:null,identifiantPersonne:_.padLeft(e.identifiantPersonne.toString(),9,"0"),noOrdrePersonneDansEmprunteur:0,codeTypePersonne:"P",typeRolePersonne:"15",roleLIntervenant:null}},e}();e.PersonneEmprunteurAdapater=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function t(e){this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.identifiantProduit=e.identifiantProduit,this.libelleLongProduit=e.libelleLongProduit,this.libelleTiers=e.libelleTiers,this.dateEffet=e.dateEffet,this.montantEcheance=e.montantEcheance,this.montantOrigineCredit=e.montantOrigineCredit,this.codeDevise=e.codeDevise,this.dureeCredit=e.dureeCredit,this.uniteDureeCredit=e.uniteDureeCredit,this.dateEcheance=e.dateEcheance,this.tauxNominalCredit=e.tauxNominalCredit,this.dateMiseRecouvrementZero=e.dateMiseRecouvrementZero,this.codeModeExpressionTaux=e.codeModeExpressionTaux,this.codeTauxCreditDirecteur=e.codeTauxCreditDirecteur,this.codeCristallisationTauxInteret=e.codeCristallisationTauxInteret,this.codeActionPourMiseAJour=e.codeActionPourMiseAJour,this.montantEcheanceMER=e.montantEcheanceMER,this.montantFraisGestion=e.montantFraisGestion,this.montantArrieresIncorporesCrd=e.montantArrieresIncorporesCrd,this.codeTraitementFinVersement=e.codeTraitementFinVersement,this.numeroQuantiemeDateEcheance=e.numeroQuantiemeDateEcheance,this.codeIndiceNominal=e.codeIndiceNominal,this.margeAppliquerSurTauxNominal=e.margeAppliquerSurTauxNominal,this.montantCapitalRestantSurCredit=e.montantCapitalRestantSurCredit,this.codeTypeRecalculTA=e.codeTypeRecalculTA,this.dateCreation=e.dateCreation,this.dateFinPrefinancementReelle=e.dateFinPrefinancementReelle,this.codeIntegrationFraisCrd=e.codeIntegrationFraisCrd,this.identifiantProfilRenegociation=e.identifiantProfilRenegociation,this.codeTypeAvenant=e.codeTypeAvenant,this.codeTypeModificationCredit=e.codeTypeModificationCredit,this.numeroRelatif=e.numeroRelatif,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.numeroModaliteRembAnticipe=e.numModaliteRemboursemntAnticipe,this.tauxIndemniteRA=e.tauxIndemniteRA,this.tauxInteretPrefinancement=e.tauxInteretPrefinancement,this.codeCreditSecurisable=e.codeCreditSecurisable,this.dateFinCredit=e.dateFinCredit,this.codePresenceRevisionSurCredit=e.codePresenceRevisionSurCredit,this.montantIntcompsurCR=e.montantIntcompsurCR,this.cdTypeArrieresIncorporeCrd=e.cdTypeArrieresIncorporeCrd,this.typeLoi=e.typeLoi,this.nbMaxiPeriodeAllongPourRevision=e.nbMaxiPeriodeAllongPourRevision,this.nbMaxiPerallsortieCptCourant=e.nbMaxiPerallsortieCptCourant,this.nbMaxiPerallongPourModulation=e.nbMaxiPerallongPourModulation,this.mtCapitalRestantSurCredit=e.mtCapitalRestantSurCredit,this.codeCategorieEmprunteur=e.codeCategorieEmprunteur,this.typeObjetFinanceGaranti=e.typeObjetFinanceGaranti,this.montantActualiseCredit=e.montantActualiseCredit,this.montantGlobalGarantiCredit=e.montantGlobalGarantiCredit,this.codeSousTypeAvenantRecouvrement=e.codeSousTypeAvenantRecouvrement,this.codeNatureFinancement=e.codeNatureFinancement,this.codeTypeMarche=e.codeTypeMarche,this.dateSignature=e.dateSignature,this.dateEffetInitialeLAvenant=e.dateEffetInitialeLAvenant,this.dateDecisionEmission=e.dateDecisionEmission,this.dureeAjusteeCreditSuiteRecalcul=e.dureeAjusteeCreditSuiteRecalcul,this.dateSaisieLEvenement=e.dateSaisieLEvenement,this.dateEmission=e.dateEmission,this.etatBrancheAccessoireEdgAvenant=e.etatBrancheAccessoireEdgAvenant,this.delaiMinimumAcceptation=e.delaiMinimumAcceptation,this.delaiRetractation=e.delaiRetractation,this.commentaireProduits=e.commentaireProduits,this.montantMAfondsDemandees=e.montantMAfondsDemandees,this.codeEcheancierVersemcontractuel=e.codeEcheancierVersemcontractuel,this.codeTypePretCombine=e.codeTypePretCombine,this.codePresenceServiceObjet=e.codePresenceServiceObjet,this.existenceAccessoireBonMajTaux=e.existenceAccessoireBonMajTaux,this.cumulDesBonifsMajorations=e.cumulBonificationsMajorations,this.codeIndicateurIntegrationCrd=e.codeIndicateurIntegrationCrd,this.tauxInteretsRetardImpaye=e.tauxInteretsRetardImpaye,this.numeroPhase=e.numeroPhase,this.codeTypePhase=e.codeTypePhase,this.dureeResteAFinancer=e.dureeResteAFinancer,this.tauxInteretPalier=e.tauxInteretPalier,this.dureeResiduelleAjusteeCredit=e.dureeResiduelleAjusteeCredit,this.numeroEcheance=e.numeroEcheance,this.montantImpayeRecouvrer=e.montantImpayeRecouvrer,this.mtARecouvrerIndemnretardImpaye=e.mtARecouvrerIndemnretardImpaye,this.mntMiseDispoFondsEffectuees=e.mntMiseDispoFondsEffectuees,this.codeGelDette=e.codeGelDette,this.montantGelCreance=e.montantGelCreance,this.numeroPeriodeRevision=e.numeroPeriodeRevision,this.mntInteretsOrdreMiseRecouvrmnt=e.mntInteretsOrdreMiseRecouvrmnt,this.amenagementEchsurPretCombine=e.amenagementEchsurPretCombine,this.amenagementEchexistantSurCredit=e.amenagementEchexistantSurCredit,this.amenagechenCoursADateEffet=e.amenagechenCoursADateEffet,this.codeCalculInteretsReportes=e.codeCalculInteretsReportes,this.montantProchaineEcheance=e.montantProchaineEcheance,this.phaseIns=this.getPhaseIns(e.phases)}return t.prototype.getPhaseIns=function(t){for(var n=[],i=0,r=t;i<r.length;i++){var a=r[i];n.push(new e.PhaseCalculetteAdapter(a))}return n},t}();e.CreditCalculetteAdapter=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.numeroPhase=e.numeroPhase,this.numeroRelatif=e.numeroRelatif,this.numeroPremiereEcheancePalier=e.numeroPremiereEcheancePalier,this.numeroDerniereEcheancePalier=e.numeroDerniereEcheancePalier,this.codeIndice=e.codeIndice,this.margeAppliquerSurTaux=e.margeAppliquerSurTaux,this.tauxInteretPalier=e.tauxInteretPalier,this.typeRemboursement=e.typeRemboursement,this.uniteDureePhase=e.uniteDureePhase,this.numeroRelatif1=e.numeroRelatif1,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.numeroRelatifPalierProduit=e.numeroRelatifPalierProduit,this.noPhaseCreditProchaineRevision=e.noPhaseCreditProchaineRevision,this.numeroRelatif2=e.numeroRelatif2,this.elementModifiableParAvenant=e.elementModifiableParAvenant,this.cdModifCaracteristfinancieres=e.cdModifCaracteristfinancieres,this.codeOccurAbsorbeePhasePalier=e.codeOccurabsorbeePhasePalier,this.tauxProgressionDesEcheances=e.tauxProgressionDesEcheances,this.periodiciteApplicProgreEcheance=e.periodiciteApplicProgreEcheance}return e}();e.PalierTauxInteretCalculetteAdapter=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function t(e){this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.numeroPhase=e.numeroPhase,this.codeTypePhase=e.codeTypePhase,this.numRelatifPhaseTypePhaseProduit=e.numeroRelatifSimulationAvenant,this.libelleLongTypePhase=e.libelleLongTypePhase,this.dureeInitialePhaseCredit=e.dureeInitialePhaseCredit,this.dureeResiduelleCredit=e.dureeResiduelleCredit,this.uniteDureePhase=e.uniteDureePhase,this.tauxNominalPhase=e.tauxNominalPhase,this.codeTauxDesPaliersCalcules=e.codeTauxDesPaliersCalcules,this.tauxMoyenPhaseCredit=e.tauxMoyenPhaseCredit,this.modeCalculAmortissement=e.modeCalculAmortissement,this.quotiteCapitalAmortir=e.quotiteCapitalAmortir,this.periodiciteMERamortissement=e.periodiciteMERamortissement,this.periodiciteCalculInterets=e.periodiciteCalculInterets,this.dateFinPrefinancementInitiale=e.dateFinPrefinancementInitiale,this.codeIndiceNominal=e.codeIndiceNominal,this.margeAppliquerSurTaux=e.margeAppliquerSurTaux,this.typeIndexationTaux=e.typeIndexationTaux,this.numeroRelatif=e.numeroRelatif,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.periodiciteMERInterets=e.periodiciteMiseRecouvrInterets,this.numeroJeuIndicesRevision=e.numeroJeuIndicesRevision,this.noPhaseCreditProchaineRevision=e.noPhaseCreditProchaineRevision,this.elementModifiableParAvenant=e.elementModifiableParAvenant,this.modeCapitRecouvInterets=e.modeCapitRecouvInterets,this.cdModifCaracteristfinancieres=e.cdModifCaracteristfinancieres,this.codeOccurAbsorbeePhasePalier=e.codeOccurabsorbeePhasePalier,this.partieFixeUnTauxComposite=e.partieFixeUnTauxComposite,this.nbJoursDansAnneeDenominateur=e.nbJoursDansAnneeDenominateur,this.nbJoursDansAnneeNumerateur=e.nbJoursDansAnneeNumerateur,this.calculInteretsEnJoursReels=e.calculInteretsEnJoursReels,this.prelevementEnFinPhase=e.prelevementEnFinPhase,this.codeTypeEcretage=e.codeTypeEcretage,this.palierTauxInterets=this.getPalierTauxInterets(e.paliersTauxInterets)}return t.prototype.getPalierTauxInterets=function(t){for(var n=[],i=0,r=t;i<r.length;i++){var a=r[i];n.push(new e.PalierTauxInteretCalculetteAdapter(a))}return n},t}();e.PhaseCalculetteAdapter=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=function(){function i(){}return i.getHistoMiseAJourForTopEligibilite=function(e){return{codeEtapeDossierCredit:"G",idGeneriqueDossierCredit:e.idCredit,idtGeneriqueSecondDossierCredit:null,identifiantPersonne:null,numeroGeneriqueDossierCredit:e.numero,codeEvenementDeclencheur:t.Constantes.SignatureElectronique.EvenementHisto.tracerEligibilite,codeOrigineHistoriqueEvenement:"SYNCH",codeTypeEvenementDossierCredit:"E",idtEntiteSaisisseuseEvenement:null,libelleCommentaireEvenement:"Avenant : "+e.eligibiliteSed.getMessageEligibilite(),libelleEvenementDeclencheur:"Eligibilité à la signature électronique (O/N)",libelleLongEntiteSaisisseuseEvt:null}},i.getHistoMiseAJourForAnnulation=function(t,i,r,a){return{codeEtapeDossierCredit:"G",idGeneriqueDossierCredit:t.idCredit,idtGeneriqueSecondDossierCredit:r,identifiantPersonne:null,numeroGeneriqueDossierCredit:t.numero,codeEvenementDeclencheur:n.SignatureElectroniqueHelper.getEvenementHisto(i,t.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Avenant),codeOrigineHistoriqueEvenement:"SIGEL",codeTypeEvenementDossierCredit:"E",idtEntiteSaisisseuseEvenement:"avenant",libelleCommentaireEvenement:null!=a?a:"ANNULATION AVENANT",libelleEvenementDeclencheur:"Abandon de signature electronique",libelleLongEntiteSaisisseuseEvt:"Synchro avenant myway"}},i}();n.RestCaracteristiqueHistoBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getPhaseForInit=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,numeroRelatif:e.numeroRelatif,codeRoleCreditAvenant:t?e.codeRoleCreditAvenant:null,numeroPhase:e.numeroPhase,codeTypePhase:e.codeTypePhase,dureeAjusteePhaseCredit:e.dureeResiduelleCredit,periodiciteCalculInterets:e.periodiciteCalculInterets,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,uniteDureePhase:e.uniteDureePhase,noRelatifPhaseTypePhaseProduit:e.noRelatifPhaseTypePhaseProduit}},e.getPhaseForInitCaraFinan=function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,numeroRelatif:e.numeroRelatif,codeRoleCreditAvenant:e.codeRoleCreditAvenant,numeroPhase:e.numeroPhase,codeTypePhase:e.codeTypePhase,dureeAjusteePhaseCredit:e.dureeResiduelleCredit,periodiciteCalculInterets:e.periodiciteCalculInterets,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,uniteDureePhase:e.uniteDureePhase,noRelatifPhaseTypePhaseProduit:e.numRelatifPhaseTypePhaseProduit}},e}();e.RestGarantiesPhaseBuilder=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=function(){function n(){}return n.getDonneeAssurance=function(e,t,n){return{identifiantAssurance:e.identifiant,listeJustificatif:[this.getJustificatifAssurance(t,n)],codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,competurMiseAJour:e.compteurMiseAJour,codeDevise:null,libelleTypeAssurance:null,datePriseEffet:null,dateFinEffet:null,dateCloture:null,dateAnnulationModification:null,identifiantEmprunteur:null,libelleTiers:null,identifiantPersonneEstAssure:null,denominationGarant:null,destinataireLettreImpaye:null,identifiantConvention:null,numeroExterneConvention:null,identifiantIntervenant:null,numeroRelatif:0,indicateurBanalise:null,codeModificationAutorise:null,retourQR:null,listeNatureJustificatif:[]}},n.getJustificatifAssurance=function(t,n){return{codeCategorieJustificatif:t.nature.codeCategorie,codeClasseJustificatif:t.nature.codeClasse,codeEntite:t.codeEntite,codeEntiteTableRefJustificatif:t.codeEntiteTableRefJustificatif,codeJustificatifObligatoire:t.codeJustificatifObligatoire,codeMAJGarantie:"8",codeNatureJustificatif:t.nature.code,codeNiveauJustification:t.nature.codeNiveauJustificatif,codeStatutJustificatif:null!=t.statut?t.statut.key:null,dateCreation:n,dateDebutValidite:t.showDateDebutEffet?i.format(t.dateDebutEffet,e.Commun.Constantes.Format.DATE_REST):null,dateDerniereMAJStatutElement:i.format(t.dateReception,e.Commun.Constantes.Format.DATE_REST),dateFinValidite:i.format(t.dateFinEffet,e.Commun.Constantes.Format.DATE_REST),dateLimiteReceptionJustificatif:i.format(t.dateLimiteReceptionJustificatif,e.Commun.Constantes.Format.DATE_REST),identifiantJustificatif:t.idJustificatif,indicateurBanalise:t.indicateurBanalise,libelleCategorieJustificatif:t.nature.libelleCategorie,libelleCodeClasse:t.nature.libelleClasse,libelleNatureJustificatif:t.nature.libelle,libelleSousClasse:t.nature.libelleSousClasse,libelleStatutJustificatif:null!=t.statut?t.statut.value:null,referenceExterneJustificatif:t.showReferenceExterne?t.referenceExterne:null,sousClassePieceJustificatif:t.nature.codeSousClasse,zoneBanalise:null}},n.getCodeAction=function(e){switch(e){case t.Enum.EtatManipulation.IsCreation:return"C";case t.Enum.EtatManipulation.IsModified:return"M";case t.Enum.EtatManipulation.ToDelete:return"S";default:return""}},n}();n.JustificatifAssuranceBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=function(){function n(){}return n.getDonneeGarantie=function(e,t,n){return{identifiantGarantie:e.idGarantie,listeJustificatif:[this.getJustificatifGarantie(t,n)],codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,compteurMiseAJour:e.compteurMiseAJour,codeEtatGarantie:e.codeEtat,codeDevise:null,codeDeviseGarantie:null,codeModificationAutorisee:null,codeNatureGarantie:null,codeValeurPacteCommissoire:null,codeVoieParee:null,dateAnnulationGarantie:null,dateClotureGarantie:null,dateFinValiditeGarantie:null,datePriseEffetGarantie:null,denominationClient:null,dureeValiditeGarantie:null,identifiantConvention:null,identifiantEmprunteur:null,identifiantGarant:null,indicateurBanalise1:null,indicateurBanalise2:null,libelleEtatGarantie:null,libelleNatureGarantie:null,libelleTiers:null,montantGarantie:null,numeroExterneConvention:null,numeroRelatif:null,retourQR:null,zoneBanaliseA:null,zoneBanaliseB:null,listeNatureJustif:[]}},n.getJustificatifGarantie=function(t,n){return{codeCategorieJustificatif:t.nature.codeCategorie,codeClasseJustificatif:t.nature.codeClasse,codeEntite:t.codeEntite,codeEntiteTableRefJustificatif:t.codeEntiteTableRefJustificatif,codeJustificatifObligatoire:t.codeJustificatifObligatoire,codeMAJGarantie:"8",codeNatureJustificatif:t.nature.code,codeNiveauJustification:t.nature.codeNiveauJustificatif,codeStatutJustificatif:null!=t.statut?t.statut.key:null,dateCreation:n,dateDebutValidite:t.showDateDebutEffet?i.format(t.dateDebutEffet,e.Commun.Constantes.Format.DATE_REST):null,dateDerniereMAJStatutElement:i.format(t.dateReception,e.Commun.Constantes.Format.DATE_REST),dateFinValidite:i.format(t.dateFinEffet,e.Commun.Constantes.Format.DATE_REST),dateLimiteReceptionJustificatif:i.format(t.dateLimiteReceptionJustificatif,e.Commun.Constantes.Format.DATE_REST),identifiantJustificatif:t.idJustificatif,indicateurBanalise:t.indicateurBanalise,libelleCategorieJustificatif:t.nature.libelleCategorie,libelleCodeClasse:t.nature.libelleClasse,libelleNatureJustificatif:t.nature.libelle,libelleSousClasse:t.nature.libelleSousClasse,libelleStatutJustificatif:null!=t.statut?t.statut.value:null,montantJustificatif:t.montantJustificatifInitial,montantVersementAutoriseJustif:t.showMontantJustificatif?t.montantJustificatif:null,referenceExterneJustificatif:t.showReferenceExterne?t.referenceExterne:null,sousClassePieceJustificatif:t.nature.codeSousClasse}},n.getCodeAction=function(e){switch(e){case t.Enum.EtatManipulation.IsCreation:return"C";case t.Enum.EtatManipulation.IsModified:return"M";case t.Enum.EtatManipulation.ToDelete:return"S";default:return""}},n}();n.JustificatifGarantieBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.Object,i=e.Commun.ToolsFunctionals.Accessoire,r=function(){function t(e,t,n){this.modeCalcul=i.getModeCalculAccessoire(e.codeModeCalculAccessoire),this.modeCalculExhaustif=i.getModeCalculAccessoireExhaustif(e.codeModeCalculAccessoire),this.libelleLong=null,this.taux=null!=t?t:e.tauxConseilleAccessoire,this._tauxDefaut=this.taux,this.showTauxMinimun=0!==e.tauxMinimumAccessoire,this.tauxMinimum=0!==e.tauxMinimumAccessoire?e.tauxMinimumAccessoire:0,this.showTauxMaximum=0!==e.tauxMaximumAccessoire,this.tauxMaximum=0!==e.tauxMaximumAccessoire?e.tauxMaximumAccessoire:100,this.showTauxConseille=0!==e.tauxConseilleAccessoire,this.tauxConseille=e.tauxConseilleAccessoire,this.showTauxPersonneAgee=0!==e.tauxAccessoirePersonnesAgees,this.tauxPersonneAgee=e.tauxAccessoirePersonnesAgees,this.showMontantPlafond=0!==e.mtPlafondTrancheCalculAccess,this.montantPlafond=e.mtPlafondTrancheCalculAccess,this.showMontantContractuel=!1,this.montantContractuel=null,this.montant=null!=n?n:e.montantConseilleAccessoire,this.montantMinimum=e.montantMinimumPlageAccessoire,this.montantMaximum=e.montantMaximumPlageAccessoire,this.montantConseille=e.montantConseilleAccessoire,this.showMontantPas=0!==e.mtPasMontantAccessoire,this.montantPas=e.mtPasMontantAccessoire,this.listeMontantChoix=this.getListeMontantChoix(e)}return Object.defineProperty(t.prototype,"isTauxEditable",{get:function(){return this.modeCalcul===e.Commun.Enum.ModeCalcul.TauxSaisissable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTauxSelectionnable",{get:function(){return this.modeCalcul===e.Commun.Enum.ModeCalcul.TauxChoix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMontantEditable",{get:function(){return this.modeCalcul===e.Commun.Enum.ModeCalcul.MontantSaisissable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMontantSelectionnable",{get:function(){return this.modeCalcul===e.Commun.Enum.ModeCalcul.MontantChoix},enumerable:!0,configurable:!0}),t.prototype.setListeTauxChoix=function(e){var t=_.uniq([this.tauxConseille,this.tauxMinimum,this.tauxMaximum]);_.contains(t,this._tauxDefaut)||t.unshift(this._tauxDefaut),e&&t.concat([this.tauxPersonneAgee]),this.listeTauxChoix=t},t.prototype.isTauxValid=function(){return this.isTauxEditable?null!=this.taux&&this.taux>=this.tauxMinimum&&this.taux<=this.tauxMaximum:this.isTauxSelectionnable?_.contains(this.listeTauxChoix,this.taux):!0},t.prototype.isMontantValid=function(){return this.isMontantEditable?null!=this.montant&&this.montant>=this.montantMinimum&&this.montant<=this.montantMaximum&&n.isModuloRespected(this.montant,this.montantPas,this.showMontantPas):this.isMontantSelectionnable?_.contains(this.listeMontantChoix,this.montant):!0},t.prototype.getListeMontantChoix=function(e){var t=[e.montantConseilleAccessoire];return e.montantMinimumPlageAccessoire>0&&t.push(e.montantMinimumPlageAccessoire),e.montantMaximumPlageAccessoire>0&&t.push(e.montantMaximumPlageAccessoire),e.mtPasMontantAccessoire>0&&t.push(e.mtPasMontantAccessoire),t},t}();t.AbstractDetailAccessoirePrincipal=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.Object,i=function(){function e(e,t,n,i,r,a){this.libelleLong=this.getLibelleLong(e,t),this.taux=null!=t&&0!==t?t:r,this.showTauxMinimun=0!==n,this.tauxMinimum=0!==n?n:0,this.showTauxMaximum=0!==i,this.tauxMaximum=0!==i?i:100,this.showTauxConseille=0!==r,this.tauxConseille=r,this.showMontantPlafond=0!==a,this.montantPlafond=a}return e.prototype.isTauxValid=function(){return this.taux>=this.tauxMinimum&&this.taux<=this.tauxMaximum;
},e.prototype.getLibelleLong=function(e,t){return null!=t&&0!==t?"Element "+e.toString()+" - Taux : "+n.numberToString(t,4)+" %":e.toString()+"ème taux élément"},e}();t.DetailAccessoireAutre=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.Object,i=function(e){function t(t,n,i){e.call(this,t,n.tauxElement,n.montantElement),this.libelleLong=this.getLibelleLong(n,t.codeModeCalculAccessoire,i),this.showMontantContractuel="05"===t.codeTypeAssietteCalculAccess,this.montantContractuel=this.showMontantContractuel?n.mtAssietteAcessFixeeContract||0:null,this.setListeTauxChoix(!1)}return __extends(t,e),t.prototype.getLibelleLong=function(e,t,i){if(null!=e.tauxElement&&0!==e.tauxElement){var r="Element 1 - Taux : "+n.numberToString(e.tauxElement,4)+" %";return"05"===e.codeTypeAssietteCalculElement?r+" - Montant contractuel "+n.numberToString(e.mtAssietteAcessFixeeContract,2)+" "+i:r}return"6"!==t?"Elément 1 - Taux":"1er taux élément"},t}(t.AbstractDetailAccessoirePrincipal);t.DetailAccessoirePrincipalAnnexe=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.Object,i=function(e){function t(t,n,i){e.call(this,t,n.tauxElement,n.montantElement),this.libelleLong=this.getLibelleLong(n,t.codeModeCalculAccessoire,i),this.showMontantContractuel="05"===t.codeTypeAssietteCalculAccess,this.montantContractuel=this.showMontantContractuel?n.mtAssietteAcessFixeeContract||0:null}return __extends(t,e),t.prototype.getLibelleLong=function(e,t,i){if(null!=e.tauxElement&&0!==e.tauxElement){var r="Element 1 - Taux : "+n.numberToString(e.tauxElement,4)+" %";return"05"===e.codeTypeAssietteCalculElement?r+" - Montant contractuel "+n.numberToString(e.mtAssietteAcessFixeeContract,2)+" "+i:r}return"6"!==t?"Elément 1 - Taux":"1er taux élément"},t}(t.AbstractDetailAccessoirePrincipal);t.DetailAccessoirePrincipalAssurance=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.Object,i=function(e){function i(n,i,r){e.call(this,new t.AccessoireConventionAdapaterCaraFinan(n),i.tauxElement,i.montantElement),this.libelleLong=this.getLibelleLong(i,n.codeModeCalculAccessoire,r)}return __extends(i,e),i.prototype.getLibelleLong=function(e,t,i){if(null!=e.tauxElement&&0!==e.tauxElement){var r="Element 1 - Taux : "+n.numberToString(e.tauxElement,4)+" %";return r}return"6"!==t?"Elément 1 - Taux":"1er taux élément"},i}(t.AbstractDetailAccessoirePrincipal);t.DetailAccessoirePrincipalGarantie=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=function(){function i(){}return i.getAssuranceResume=function(t){return{codeEtablissement:t.codeEtablissement,idCredit:t.identifiantCredit,identifiant:t.identifiantAssurance,libelleDescription:this.getLibelleDescription(t),statut:"A"===t.codeAncienneteAssuranceGarantie?e.Business.Constantes.Contractualisation.Statut.enGestion:e.Business.Constantes.Contractualisation.Statut.enElaboration,isDataCompleteLoaded:!1,listeJustificatif:[],listeNatureJustificatif:[],libelleType:null,dateDebutEffet:null,dateFinEffet:null,dateCloture:null,dateAnnulation:null,libelleTiers:null,idPersonneEstAssure:null,denominationGarant:null,destinataireLettreImpaye:null,idConvention:null,numExterne:null,idIntervenant:null,indicateurBanalise:null,codeModificationAutorise:null,compteurMiseAJour:0,devise:null}},i.getLibelleDescription=function(e){return null===e.libelleAssuranceExterne||0===e.libelleAssuranceExterne.length?"Assurance "+e.identifiantAssurance:"Assurance "+e.identifiantAssurance+" - "+e.libelleAssuranceExterne},i.getAssuranceResumeCompleted=function(i,r,a){var o=angular.copy(i),s=this.getListeNature(r.listeNatureJustificatif);return o.listeNatureJustificatif=s,o.listeJustificatif=_.map(r.listeJustificatif,function(e){return new t.JustificatifAssurance(e,s,a)}),o.identifiant=r.identifiantAssurance,o.libelleType=r.libelleTypeAssurance,o.dateDebutEffet=n.parse(r.datePriseEffet),o.dateFinEffet=n.parse(r.dateFinEffet),o.dateCloture=n.parse(r.dateCloture),o.dateAnnulation=n.parse(r.dateAnnulationModification),o.libelleTiers=r.libelleTiers,o.idPersonneEstAssure=r.identifiantPersonneEstAssure,o.denominationGarant=r.denominationGarant,o.destinataireLettreImpaye=r.destinataireLettreImpaye,o.idCredit=r.identifiantCredit,o.idConvention=r.identifiantConvention,o.numExterne=r.numeroExterneConvention,o.idIntervenant=r.identifiantIntervenant,o.indicateurBanalise=r.indicateurBanalise,o.codeModificationAutorise=r.codeModificationAutorise,o.codeEtablissement=i.codeEtablissement,o.compteurMiseAJour=r.competurMiseAJour,o.devise=e.Commun.ToolsFunctionals.Credit.getSymboleDevise(r.codeDevise),o.isDataCompleteLoaded=!0,o},i.getListeNature=function(e){return _.sortByOrder(_.map(e,function(e){return t.NatureJustificatifAssuranceBuilder.getResult(e)}),function(e){return e.libelle},!0)},i}();t.AssuranceResumeBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.List,a=function(){function e(e,n,a){void 0===a&&(a=null),null!=e?(this.idJustificatif=e.identifiantJustificatif,this.couleurTuile="3"===e.codeNiveauJustification&&e.codeStatutJustificatif===t.Enum.JustificatifStatut.attendu.key?"couleur-rouge":"couleur-sombre",this.nature=r.findOrEmpty(n,function(t){return t.code===e.codeNatureJustificatif}),this.statut=_.find(t.Enum.JustificatifStatut.list(),function(t){return t.key===e.codeStatutJustificatif}),this.dateDebutEffet=i.parse(e.dateDebutValidite),this.dateFinEffet=i.parse(e.dateFinValidite),this.dateReception=i.parse(e.dateDerniereMAJStatutElement),this.dateLimiteReceptionJustificatif=i.parse(e.dateLimiteReceptionJustificatif),this.referenceExterne=e.referenceExterneJustificatif,this.showBtnValider=this.showBtnSupprimer=this.getIsActionAvailable(e,a),this.codeEntite=e.codeEntite,this.codeEntiteTableRefJustificatif=e.codeEntiteTableRefJustificatif,this.codeJustificatifObligatoire=e.codeJustificatifObligatoire,this.indicateurBanalise=e.indicateurBanalise,this.etatManipulation=t.Enum.EtatManipulation.IsModified):(this.idJustificatif=null,this.couleurTuile="couleur-sombre",this.nature=n.length>0?_.first(n):null,this.statut=null,this.dateDebutEffet=null,this.dateFinEffet=null,this.dateReception=null,this.dateLimiteReceptionJustificatif=null,this.montantJustificatifInitial=null,this.montantJustificatif=null,this.referenceExterne=null,this.showBtnValider=!0,this.showBtnSupprimer=!1,this.codeEntite=null,this.codeEntiteTableRefJustificatif=null,this.codeJustificatifObligatoire=null,this.indicateurBanalise=null,this.etatManipulation=t.Enum.EtatManipulation.IsCreation),this.setChampVisibles(this.nature)}return e.prototype.setChampVisibles=function(e){null!=e&&(this.showDateDebutEffet="P"!==e.codeCategorie,this.showMontantJustificatif="A"!==e.codeCategorie&&"P"!==e.codeCategorie,this.showReferenceExterne="A"===e.codeCategorie)},e.prototype.getIsActionAvailable=function(e,n){return e.codeStatutJustificatif===t.Enum.JustificatifStatut.attendu.key||e.codeStatutJustificatif===t.Enum.JustificatifStatut.recu.key&&i.isEquals(e.dateCreation,n)},e}();n.JustificatifAssurance=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function t(){}return t.getResult=function(t){return{code:t.codeNatureJustificatif,libelle:t.libelleNatureJustificatif,codeClasse:t.codeClasseJustificatif,libelleClasse:t.libelleCodeClasse,codeSousClasse:t.sousClasseJustificatif,libelleSousClasse:t.libelleSousClasse,codeCategorie:t.codeCategorieJustificatif,libelleCategorie:t.libelleCategorieJustificatif,codeNiveauJustificatif:t.codeNiveauJustificatif,libelleNiveauJustificatif:e.NatureJustificatifGarantieHelper.getLibelleNiveauJustification(t.codeNiveauJustificatif)}},t}();e.NatureJustificatifAssuranceBuilder=t;var n=function(){function e(){}return e.getLibelleNiveauJustification=function(e){switch(e){case"1":return"Préliminaire";case"2":return"Préalable";case"3":return"Suspensif";case"4":return"Résolutoire";default:return null}},e}();e.NatureJustificatifAssuranceHelper=n}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(e,t,n){var i=this.isAteEnCours(t);this.alerteAvenantInits=[{isMessage:this.isAteEnCoursBloquant(e,i),isBloquant:this.isAteEnCoursBloquant(e,i),message:"Avenant impossible, aménagement temporaire d'échéance en cours"},{isMessage:this.isPersonneCreation(e,n),isBloquant:!1,message:"En création, vous devez changer d'emprunteur pour modifier les payeurs"}],this.isMessageAlerte=this.fctIsMessageAlerte(this.alerteAvenantInits),this.isMessageAlerteBloquant=this.fctIsMessageAlerteBloquant(this.alerteAvenantInits),this.messageAlertes=this.ajoutMessageAlerte(this.alerteAvenantInits)}return t.prototype.isPersonneCreation=function(t,n){return _.contains(t,e.Commun.Enum.ModificationCredit.Personne)&&n===e.Commun.Enum.CodeTypeAcces.Creation},t.prototype.isAteEnCours=function(e){return"O"===e},t.prototype.isAteEnCoursBloquant=function(t,n){return(_.contains(t,e.Commun.Enum.ModificationCredit.Financier)||_.contains(t,e.Commun.Enum.ModificationCredit.Quantieme)||_.contains(t,e.Commun.Enum.ModificationCredit.AmenagementTemporaireEcheances)||_.contains(t,e.Commun.Enum.ModificationCredit.ReportFinPret))&&n},t.prototype.fctIsMessageAlerte=function(e){return _.some(e,function(e){return e.isMessage===!0})},t.prototype.fctIsMessageAlerteBloquant=function(e){return _.some(e,function(e){return e.isBloquant===!0})},t.prototype.ajoutMessageAlerte=function(e){for(var t=[],n=0,i=e;n<i.length;n++){var r=i[n];r.isMessage&&t.push(r.message)}return t},t}();t.AlerteAvenant=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Enum.ModificationCredit,r=function(){function e(e,t){this.isPresenceStepOne=this.getInitIsPresenceStepOne(e),this.isPresenceStepTwo=this.getInitIsPresenceStepTwo(e),this.isPresenceStepThree=this.getInitIsPresenceStepThree(e),this.stepAvenant=this.getInitStepAvenant(t)}return Object.defineProperty(e.prototype,"isPresencePreviousStep",{get:function(){return this.stepAvenant===t.Enum.StepAvenant.TwoIsObjet&&this.isPresenceStepOne?!0:this.stepAvenant===t.Enum.StepAvenant.ThreeIsAutre&&(this.isPresenceStepOne||this.isPresenceStepTwo)?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPresenceNextStep",{get:function(){return this.stepAvenant===t.Enum.StepAvenant.OneIsPersonnes&&(this.isPresenceStepTwo||this.isPresenceStepThree)?!0:this.stepAvenant===t.Enum.StepAvenant.TwoIsObjet&&this.isPresenceStepThree?!0:!1},enumerable:!0,configurable:!0}),e.prototype.setToNextStep=function(){this.isPresenceNextStep&&(this.stepAvenant===t.Enum.StepAvenant.OneIsPersonnes&&this.isPresenceStepTwo?this.stepAvenant=t.Enum.StepAvenant.TwoIsObjet:this.stepAvenant=t.Enum.StepAvenant.ThreeIsAutre)},e.prototype.setToPreviousStep=function(){this.isPresencePreviousStep&&(this.stepAvenant===t.Enum.StepAvenant.ThreeIsAutre&&this.isPresenceStepTwo?this.stepAvenant=t.Enum.StepAvenant.TwoIsObjet:this.stepAvenant=t.Enum.StepAvenant.OneIsPersonnes)},e.prototype.getInitIsPresenceStepOne=function(e){return _.some(e,function(e){return e===i.Personne})},e.prototype.getInitIsPresenceStepTwo=function(e){return _.some(e,function(e){return e===i.Objet})},e.prototype.getInitIsPresenceStepThree=function(e){var t=[i.Financier,i.Assurance,i.Garantie,i.ReportFinPret,i.AmenagementTemporaireEcheances];return _.some(e,function(e){return _.some(t,function(t){return t===e})})},e.prototype.getInitStepAvenant=function(e){if(!e){if(this.isPresenceStepOne)return t.Enum.StepAvenant.OneIsPersonnes;if(this.isPresenceStepTwo)return t.Enum.StepAvenant.TwoIsObjet}return t.Enum.StepAvenant.ThreeIsAutre},e}();n.AvenantDescriptionBehavior=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=function(){function i(){}return i.prototype.getResult=function(i,r,a,o,s,u,c,l,d,m,h,p,f,A,P,v,g,C,E,b,T,y,M,D,x,R,S,I,B){var O=this,F=l===e.Commun.Enum.CodeTypeAcces.Creation?f.credit:new t.CreditCaraFinanAdapter(p.credit,null!=f?f.credit:{},b),L=null,j=null;null!==S&&(L=S.listeServicesObjet,j=S.listeElementsCalcul);var G=this.getDataRestAvenant(i,p,F,A,P,v,g,C,E,(f||{}).credit,x,L,j,I),N=new t.AvenantDescription(l,a,o,s,u,c,n.parse(r),d,m,b,M,h,T,y,null!=f?f.renegociationsProduit:[],G,p.compteurMiseJour,R,null!=f?f.credit.accessoires:[],B),q=this.getAvenantDescriptionDecoreDataAssurance(new t.AvenantCreditDecorateur(N),m),V=this.getAvenantDescriptionDecoreDataGarantie(q,m),w=this.getAvenantDescriptionDecoreDataPersonnes(V,m,M,D);return w=this.getAvenantDescriptionDecoreDataObjet(w,m,M,D),this.getAvenantDescriptionDecoreDataServicesObjet(w,m),_.each(m,function(e){w=O.getAvenantDescriptionDecore(w,e)}),M&&_.some(m,function(t){return t===e.Commun.Enum.ModificationCredit.Personne})&&w.setDataAssurancesByAvenantPersonne(),w},i.prototype.getAvenantDescriptionDecoreDataAssurance=function(n,i){return _.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Assurance})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Financier})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.AmenagementTemporaireEcheances})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Personne})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Quantieme})?new t.AvenantAssuranceDataDecorateur(n):n},i.prototype.getAvenantDescriptionDecoreDataGarantie=function(n,i){return _.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Garantie||t===e.Commun.Enum.ModificationCredit.Financier||t===e.Commun.Enum.ModificationCredit.AmenagementTemporaireEcheances})?new t.AvenantGarantieDataDecorateur(n):n},i.prototype.getAvenantDescriptionDecoreDataPersonnes=function(n,i,r,a){if(_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Personne})){if(!r)return new t.AvenantPersonneDataDecorateur(n);n.emprunteurActuel=a.emprunteurActuel,n.emprunteurNouveau=a.emprunteurNouveau}return n},i.prototype.getAvenantDescriptionDecoreDataObjet=function(n,i,r,a){if(_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Objet})){if(!r)return new t.AvenantObjetDataDecorateur(n);n.infoObjet=a.infoObjet,n.dataRestAvenant.dataObjet=a.dataRestAvenant.dataObjet}return n},i.prototype.getAvenantDescriptionDecoreDataServicesObjet=function(n,i){(_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Financier})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Garantie})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.AmenagementTemporaireEcheances})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.ChangementProduit})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.ReportFinPret})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Inconnu})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Personne})||_.some(i,function(t){return t===e.Commun.Enum.ModificationCredit.Objet}))&&t.AvenantServicesObjetDecorateur.decorate(n)},i.prototype.getAvenantDescriptionDecore=function(n,i){switch(i){case e.Commun.Enum.ModificationCredit.Assurance:return new t.AvenantAssuranceDecorateur(n);case e.Commun.Enum.ModificationCredit.Financier:return new t.AvenantTauxDecorateur(n);case e.Commun.Enum.ModificationCredit.Quantieme:return new t.AvenantQuantiemeDecorateur(n);case e.Commun.Enum.ModificationCredit.ReportFinPret:return new t.AvenantReportFinPretDecorateur(n);case e.Commun.Enum.ModificationCredit.AmenagementTemporaireEcheances:return new t.AvenantAteDecorateur(n);case e.Commun.Enum.ModificationCredit.Garantie:return new t.AvenantGarantieDecorateur(n);case e.Commun.Enum.ModificationCredit.Objet:return new t.AvenantObjetDecorateur(n);case e.Commun.Enum.ModificationCredit.Personne:return new t.AvenantPersonneDecorateur(n);default:return n}},i.prototype.getDataRestAvenant=function(e,t,n,i,r,a,o,s,u,c,l,d,m,h){var p={listeConventionAssurance:t.conventionsAssurances,listeConventionApplicableObjet:t.conventionsApplicablesObjet,listeConventionApplicableEmprunteur:t.convsApplicablesEmprunteur,listeEnCoursPersonneConvention:t.encoursPersonneConvention,listeAccessoireParConvention:t.accessoiresParConvention,listeComposantesVierges:t.composantesVierges,listeTypesSinistres:l},f=parseInt(e),A={listePersonnesAssurableOuGarant:t.personnesAssurableOuGarant.concat(t.personnesAssurableOuGarantBis),listeEncoursPersonneAssuHorsCreditEncours:h,listeMotifsReserveOuExclusion:_.filter(t.motifsReserveOuExclusion,function(e){return e.codeEtablissement===f}),listeCompagniesAssurance:_.filter(t.compagniesAssurance,function(e){return e.codeEtablissement===f}),dataForAssurance:p},P={listeServiceObjet:_.filter(d,function(e){return e.codeEtablissement===f&&e.identifiantCredit===n.identifiantCredit}),listeElementCalculServicesObjet:_.filter(m,function(e){return e.codeEtablissement===f&&e.identifiantCredit===n.identifiantCredit})};return{creditCaraFinan:t.credit,creditCurrentInfoCredit:n,creditOrigineInfoCredit:c,produitCredit:i,listeIndice:r,palierCredit:a,dataAssurances:A,dataPersonnes:o,dataObjet:s,dataGaranties:u,dataServicesObjet:P}},i}();t.AvenantDescriptionFactory=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.List,a=e.Commun.ToolsFunctionals.FonctionsAvenant,o=e.Commun.ToolsFunctionals.Credit,s=function(s){function u(t,r,a,c,l,d,m,h,p,f,A,P,v,g,C,E,b,T,y,M){s.call(this,p,A),this.dataRestAvenant=E,this.codeTypeAcces=this.getCodeTypeAcces(t,h),this.numero=null!=r?r:0,this.compteurMiseJour=b,this.codeAvenantSimulation=a,this.typeAvenant=c,this.codeSousTypeAvenant=l,this.idCredit=P.infoGeneraleCredit.identifiantCreditElementaire,this.idEmprunteur=P.dureeVersements.identifiantEmprunteur,this.libelleInfosCredit=P.infoGeneraleCredit.libelleLongProduit+" ("+P.infoGeneraleCredit.identifiantProduit+")",this.devise=o.getSymboleDevise(P.montantCredit.codeDevise),this.dateEffet=this.dateEffetModifieQuantieme=d,this.dateFinCredit=this._dateFinCreditInitiale=i.parse(E.creditCurrentInfoCredit.dateFinCredit),this.dateFinPrefinancementReelle=t===e.Commun.Enum.CodeTypeAcces.Creation?i.parse(E.creditCurrentInfoCredit.dateFinPrefinancementReelle):i.parse(E.creditCaraFinan.dateFinPrefinancementReelle),this.dateTraitement=m,this.dateEcheance=e.Commun.Tools.DateUtils.parse(P.echeance.dateEcheance),this.listeAcccessoires=this.getListeAcessoires(E.produitCredit.accessoires),this.listeAccessoiresAnnexes=this.getListeAccessoireAnnexe(y,d);var D=_.contains(p,e.Commun.Enum.ModificationCredit.Financier);this.isAvenantReportFinPret=_.contains(p,e.Commun.Enum.ModificationCredit.ReportFinPret);var x=D||this.isAvenantReportFinPret;this.dataFraisAvenant=this.getDataFraisAvenant(t,E.produitCredit.accessoires,E.creditCaraFinan.accessoires,!x),this.droitModifierEnabled=h,this.isCreditLissage=!1,this.isWithAssuranceCRDIn=!1,this.isMaintienProfilAmortissement=!1,this.jourFinMoisDateEffet=31,this.isEditionAuthorized=t===e.Commun.Enum.CodeTypeAcces.Creation||h,this.isVersementAttenduAjoutable=c===e.Commun.Enum.TypeAvenant.AvenantTechnique&&1===p.length&&_.first(p)===e.Commun.Enum.ModificationCredit.Garantie,this.isAvenantTauxDuree=!1,this.isAvenantAssurance=!1,this.isAvenantGarantie=!1,this.isAvenantQuantieme=!1,this.isAvenantReportFinPret=!1,this.isAvenantAte=!1,this.isAvenantObjet=!1,this.isAvenantPersonnes=!1,this.isAvenantRecouvrement=c===e.Commun.Enum.TypeAvenant.AvenantRecouvrement,this.isAvenantPeriodicite=!1,this.dataAssurances=null,this.listeAssurancesStock=[],this.listeAssurancesAvailables=[],this.listePhaseStock=[],this.listePhaseAvailables=[],this.listeGarantiesStock=[],this.listeGarantiesAvailables=[],this.dataGaranties=null,this.emprunteurActuel=null,this.emprunteurNouveau=null,this.ate=null,this.reportFinPret=null,this.creditAvenantFinancier=null,this.listeAssurancesAte=[],this.listeAccessoiresAte=[],this.listeElementCalculServicesObjet=[],this.infoObjet=null,this.numeroEcheance=E.creditCurrentInfoCredit.numeroEcheance;var R=u.getNumEcheanceDebutFinPhase(E.creditCurrentInfoCredit);this.numeroEcheanceDebutPhase=R[0],this.numeroEcheanceFinPhase=R[1],this.renegociationProduits=this.getRenegociationProduitFiltre(C,c),this.isEligibleChangementProduit=this.getIsEligibleChangementProduit(E.creditCurrentInfoCredit,t,E.creditCaraFinan,this.renegociationProduits),this.isAvecChangementProduit=f,this.isChangementProduitExistant=t!==e.Commun.Enum.CodeTypeAcces.Creation&&null!=E.creditCaraFinan.identifiantProfilRenegociation,this.isProduitCloture=T,this.eligibiliteRenegociationProduit=angular.copy(v),this.libelleNouveauProduit=this.getLibelleNouveauProduit(v,t,E.creditCaraFinan),this.creditChangePdt=g,this.showPopinChgtProduit=this.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Creation,this.numeroModaliteRas=f?this.getNumeroModaliteRA(E.produitCredit.modalites,E.creditCurrentInfoCredit):[],this.numeroModaliteRaDefault=this.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Creation?null:this.getNumeroModaliteRaOuverture(this.numeroModaliteRas,E.creditCaraFinan),this.tauxRa=this.getTauxRA(this.numeroModaliteRaDefault,E.creditCurrentInfoCredit,this.codeTypeAcces,E.creditCaraFinan),this.bornesTauxRa=null===this.numeroModaliteRaDefault?"[0, 0]":"["+this.numeroModaliteRaDefault.tauxMinimumAccessoire.toString()+","+this.numeroModaliteRaDefault.tauxMaximumAccessoire.toString()+"]",this.palierAbsorbe=!1,this.numeroPhaseEnCoursCreditOrigine=0,this.numeroPremiereEcheanceLastPalierPhaseO=0,this.showVariationDureeProduitForChgtProduit=!1,this.showVariationDureeProduitForProduitInitial=!1,this.reductionMaxCredit="",this.traitementEcheanceDureeProduit="",this.motifAllongementDureeProduit="",this.conditionsDureeProduit="",this.bornesVariationDureeProduit="",this.borneMinVariationDureeProduit=0,this.borneMaxVariationDureeProduit=0,this.pourcentageAllongementDureeProduit=0,this.cdTypeButoir="",this.isEditionVariationDureeProduit=!1,this.isOpenVariationDureeProduit=!1,this.nouvellePhaseAMSupOrigine=!1,this.accessoireIntegreCrd=this.getAccessoireIntegreCrd(null!=E.produitCredit?E.produitCredit.accessoires:[],null!=E.creditCaraFinan?E.creditCaraFinan.accessoires:[],this.codeTypeAcces),this.alerteAvenant=new n.AlerteAvenant(p,null!=E.creditOrigineInfoCredit?E.creditOrigineInfoCredit.amenagechenCoursADateEffet:null,t),this.isModificationTauxFirst=!1,this.isModificationPeriodicitePhaseFirst=!1,this.isAmortissementALaCarte=!1,this.typeCalculAjustementEcheances=0,this.palierTauxInteretAvantCalculettes=[],this.isPretImpact=this.getIsPretImpact(P.infoGeneraleCredit,M,t),this.detailDpeOrigine=this.getDetailDpe(P.infoGeneraleCredit),this.detailDpeAvenant=this.getDetailDpeAvenant(P.infoGeneraleCredit,M)}return __extends(u,s),u.prototype.getCreditLoadedByCaraFinan=function(){return this.dataRestAvenant.creditCaraFinan},u.prototype.getCreditLoadedByInfoCredit=function(){return this.dataRestAvenant.creditCurrentInfoCredit},u.prototype.addAssurance=function(){},u.prototype.setAssuranceEdition=function(e,t){},u.prototype.setDataAssurancesForCalculatrice=function(){},u.prototype.setListePersonnesAssurable=function(e){},u.prototype.addGarantInListPersonnesAssurable=function(e){},u.prototype.removeGarantInListPersonnesAssurable=function(e){},u.prototype.changeDateEffetQuantieme=function(){},u.prototype.getDateEffetRetenue=function(){return this.dateEffet},u.prototype.getListeModificationCredit=function(){return[]},u.prototype.getDisabledValider=function(){return this.alerteAvenant.isMessageAlerteBloquant},u.prototype.beforeSave=function(){},u.prototype.scissionPhaseAte=function(e,t,n,i){return{}},u.prototype.gestionAte=function(e,t,n,i,r,a,o){},u.prototype.addGarantie=function(){},u.prototype.getCodeTypeAcces=function(t,n){return t!==e.Commun.Enum.CodeTypeAcces.Modification||n?t:e.Commun.Enum.CodeTypeAcces.Lecture},u.prototype.getListeAcessoires=function(e){return _.filter(e,function(e){return!_.contains(["22","23"],e.codeNatureAccessoire)&&null===e.codeTypeAssietteCalculElement})},u.prototype.getListeAccessoireAnnexe=function(i,r){var a=this,o=0;return this.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Creation?_.filter(i,function(t){return null!==t.codeSousTypeAccessoireCompl&&(null===t.dateFinApplicationElement||e.Commun.Tools.DateUtils.isAfter(t.dateFinApplicationElement,r))}).map(function(e){o++;var i={taux:e.tauxElement,montant:e.montantElement,numeroRelatif:e.numeroRelatif,codeSousTypeAccessoireCompl:e.codeSousTypeAccessoireCompl,codeAppelReversementTiers:null,codeAccessoireCalculTEG:e.codeAccessDansCalculTEG,codeAppelLecheance:e.codeAppelLecheance,codeNatureAccessoire:e.codeNatureAccessoire,codeModeCalculAccessoire1:e.codeModeCalculAccessoire1,regleDateDebutApplicatAccess:e.regleDateDebutApplicatAccess,regleDateDebutAppliAccCatalogue:e.regleDateDebutAppliAccCatalogue,regleEvenementDeclench1erAppel:e.regleEvenementDeclench1erAppel,indicateurAccessoireObligatoire:e.indicateurAccessoireObligatoire,indicateurAccessoireValide:e.indicateurAccessoireValide,indicateurAccessoireAnnuleAv:e.indicateurAccessoireAnnuleAv,indicAccessoireCreeParAvenant:e.indicAccessoireCreeParAvenant,dateFin:e.dateFinApplicationElement,identifiantTiers:e.identifiantTiers};return new t.Modeles.AccessoireAnnexe(o,i,new n.AccessoireAdapterCaraFinan(e),null,!1,a.devise)}):_.filter(this.dataRestAvenant.creditCaraFinan.accessoires,function(t){return null!==t.codeSousTypeAccessoireCompl&&(null===t.dateFinApplicationElement||e.Commun.Tools.DateUtils.isAfter(t.dateFinApplicationElement,r))}).map(function(e){o++;var i={montant:e.montantElement,taux:e.tauxElement,numeroRelatif:e.numeroRelatif,codeSousTypeAccessoireCompl:e.codeSousTypeAccessoireCompl,codeAppelReversementTiers:null,codeAccessoireCalculTEG:e.codeAccessCalculTxEffectifGlob,codeAppelLecheance:e.codeAppelLecheance,codeNatureAccessoire:e.codeNatureAccessoire,codeModeCalculAccessoire1:e.codeModeCalculAccessoire1,regleDateDebutApplicatAccess:e.regleDateDebutApplicatAccess,regleDateDebutAppliAccCatalogue:e.regleDateDebutAppliAccCatalogue,regleEvenementDeclench1erAppel:e.regleEvenementDeclench1erAppel,indicateurAccessoireObligatoire:e.indicateurAccessoireObligatoire,indicateurAccessoireValide:e.indicateurAccessoireValide,indicateurAccessoireAnnuleAv:e.indicateurAccessoireAnnuleAv,indicAccessoireCreeParAvenant:e.indicAccessoireCreeParAvenant,dateFin:e.dateFinApplicationElement,identifiantTiers:e.identifiantTiers};return new t.Modeles.AccessoireAnnexe(o,i,new n.AccessoireConventionAdapterCaraFinan(e),null,!1,a.devise)})},u.prototype.findAccessoireAnnexeFantome=function(n,i){return _.find(this.listeAccessoiresAnnexes,function(r){return r.etatManipulationAccessoire!==t.Enum.EtatManipulation.ToDelete&&"AL"===r.codeSousTypeAccessoireCompl&&r.numeroPhase===i&&e.Commun.Tools.DateUtils.isEquals(r.dateFin,n)})},u.prototype.addAccessoireAnnexe=function(e){var t=_.last(this.listeAccessoiresAnnexes);e.idIhm=null!=t?t.idIhm+1:0,this.listeAccessoiresAnnexes.push(e)},u.prototype.setAccessoireAnnexeEdition=function(e,t,n){void 0===n&&(n=null),null!=n&&this.setAccessoireAnnexeEdition2(e,t,n),this.setAccessoireAnnexeEdition2(e,t,this.listeAccessoiresAnnexes)},u.prototype.setAccessoireAnnexeEdition2=function(e,n,i){var r=_.findIndex(this.listeAccessoiresAnnexes,function(t){return t.idIhm===e.idIhm});switch(n){case t.Enum.ActionManipulationElement.Modifier:i[r]=e,i[r].etatManipulationAccessoire!==t.Enum.EtatManipulation.IsCreation&&(i[r].etatManipulationAccessoire=t.Enum.EtatManipulation.IsModified);break;case t.Enum.ActionManipulationElement.Annuler:break;case t.Enum.ActionManipulationElement.Enregistrer:break;case t.Enum.ActionManipulationElement.Supprimer:i[r].etatManipulationAccessoire===t.Enum.EtatManipulation.IsCreation?_.remove(this.listeAccessoiresAnnexes,function(t){return t.idIhm===e.idIhm}):i[r].etatManipulationAccessoire=t.Enum.EtatManipulation.ToDelete}},u.prototype.getDataFraisAvenant=function(e,n,i,r){if(r)return{fraisAvenant:t.ToolsFunctionals.FraisAvenant.getFraisAvenant(e,n,i,!0),withChoix:!1,fraisAvenantPreleve:null,fraisAvenantIntegreCrd:null};var a=t.ToolsFunctionals.FraisAvenant.getFraisAvenant(e,n,i,r,!0),o=t.ToolsFunctionals.FraisAvenant.getFraisAvenant(e,n,i,r,!1),s={fraisAvenant:this.getFraisAvenantPositionneDefaut(e,a,o),withChoix:null!=a&&null!=o,fraisAvenantPreleve:a,fraisAvenantIntegreCrd:o};return s},u.prototype.getFraisAvenantPositionneDefaut=function(t,n,i){if(t===e.Commun.Enum.CodeTypeAcces.Creation){if(null===n&&null!=i)return i;if(null===i&&null!=n)return n}else{if(null!=n&&"O"===n.indicAccessoireCreeParAvenant&&"2"===n.indicateurAccessoireValide)return n;if(null!=i&&"O"===i.indicAccessoireCreeParAvenant&&"2"===i.indicateurAccessoireValide)return i}return null},u.getNumEcheanceDebutFinPhase=function(e){for(var t,n=0,i=0,r=_.sortByOrder(e.phases,function(e){return e.numeroPhase}),o=0,s=r;o<s.length;o++){var u=s[o];if("PF"!==u.codeTypePhase&&(n=i+1,t=a.simulConvDuree(u.uniteDureePhase,u.dureeInitialePhaseCredit,u.periodiciteCalculInterets,365),i=n+t-1,u.numeroPhase===e.numeroPhase))break}return[n,i]},u.prototype.majDureePalier=function(e,n){if(!isNaN(e.duree)&&e.duree>0){var i=e.numeroDerniereEcheance-e.numeroPremiereEcheance+1,r=i-e.duree,a=_.max(_.map(this.listePhaseStock,function(e){return e.numeroPhase}));this.listePhaseStock=_.map(this.listePhaseStock,function(i){return t.ToolsFunctionals.AjustementPalier.getPhaseWithPaliersAjustes(i,e,r,a,n)}),this.palierTauxInteretAvantCalculettes=t.ToolsFunctionals.FonctionsPhasePalier.sauvegardePalierTauxInteretAvantCalculette(this.listePhaseStock),this.reportModificationsDuree()}},u.prototype.majDureePalierFromPhase=function(n){var i=e.Business.ToolsFunctionals.PeriodicitePhase.verificationDureePeriodiciteSansScission(n.uniteDureePhase,n.duree,n.periodiciteCalculInterets,n.periodiciteInteret,n.periodiciteAmortissement);if(n.libelleErreurModifPhasePaliers=i,!(i.length>0)){var o=r.firstOrEmpty(n.listePalier);if(o.duree=a.simulConvDuree(n.uniteDureePhase,n.duree,n.periodiciteAmortissement.codePeriode,365),this.majDureePalier(o,!0),null!=this.creditChangePdt){t.ToolsFunctionals.PeriodicitePhase.majPeriodiciteCreditChangePdt(this.creditChangePdt,this.listePhaseStock);for(var s=function(e){if(e.numeroPhase>1){var t=r.findOrEmpty(u.listePhaseStock,function(t){return t.numeroPhase===e.numeroPhase});e.dureeInitialePhaseCredit=t.duree;var n=r.firstOrEmpty(e.paliersTauxInterets),i=r.firstOrEmpty(t.listePalier);_.isEmpty(n)||(n.numeroPremiereEcheancePalier=i.numeroPremiereEcheance,
n.numeroDerniereEcheancePalier=i.numeroDerniereEcheance)}},u=this,c=0,l=this.creditChangePdt.phases;c<l.length;c++){var d=l[c];s(d)}}}},u.prototype.reportModificationsDuree=function(){var e=this,t=this.creditAvenantFinancier.getDeltaDureeTotale();0!==t&&(this.dateFinCredit=moment(this._dateFinCreditInitiale).add(-t,"months").toDate());var n=_.reduce(_.filter(this.listePhaseStock,function(t){return!t.isPhasePrefi&&t.numeroPhase!==_.last(e.listePhaseStock).numeroPhase}),function(e,t){return e+t.duree},0),i=this.creditAvenantFinancier.dureeTotale-n;_.last(this.listePhaseStock).reportNouvelleDureeToDernierePhase(i,this.isAmortissementALaCarte),null!=this.creditChangePdt&&this.creditChangePdt.phases.length>0&&(_.last(this.creditChangePdt.phases).dureeInitialePhaseCredit=_.last(this.listePhaseStock).duree,_.last(this.creditChangePdt.phases).paliersTauxInterets.length>0&&_.last(this.listePhaseStock).listePalier.length>0&&(_.last(_.last(this.creditChangePdt.phases).paliersTauxInterets).numeroPremiereEcheancePalier=_.last(_.last(this.listePhaseStock).listePalier).numeroPremiereEcheance,_.last(_.last(this.creditChangePdt.phases).paliersTauxInterets).numeroDerniereEcheancePalier=_.last(_.last(this.listePhaseStock).listePalier).numeroDerniereEcheance))},u.prototype.impactModificationDureePhaseDT=function(e){var n=t.ToolsFunctionals.DureePhase.controleReductionDureePhase(this.dataRestAvenant.creditCurrentInfoCredit.phases,e,this.isAvecChangementProduit,moment(this.dataRestAvenant.creditCurrentInfoCredit.dateMiseRecouvrementZero).toDate(),this.dataRestAvenant.creditCurrentInfoCredit.numeroQuantiemeDateEcheance,moment(this.dataRestAvenant.creditOrigineInfoCredit.dateEffet).toDate(),this.dataRestAvenant.creditOrigineInfoCredit.numeroEcheance);if(_.isEmpty(n)){this.listePhaseStock=this.messageErreurDureePhaseDt(n,this.listePhaseStock,e),this.creditAvenantFinancier.dureeResiduelle=this.creditAvenantFinancier.majDureeResiduelleFromPhaseDT(e.duree,e.dureeInitiale),this.creditAvenantFinancier.dureeTotale=this.creditAvenantFinancier.majDureeTotaleFromPhaseDT(e.duree,e.dureeInitiale);var i=this.creditAvenantFinancier.getDeltaDureeTotale();if(0!==i&&(this.dateFinCredit=moment(this._dateFinCreditInitiale).add(-i,"months").toDate()),e.listePalier.length>0)if(1===e.listePalier.length){var o=r.firstOrEmpty(e.listePalier);o.duree=a.simulConvDuree(e.uniteDureePhase,e.duree,e.periodiciteInteret.codePeriode,365),this.majDureePalier(o,!1)}else if(e.listePalier.length>1){var o=r.lastOrEmpty(e.listePalier);o.duree=o.duree+e.duree-e.dureeInitiale,this.majDureePalier(o,!1)}for(var s=0,u=this.listePhaseStock;s<u.length;s++){var c=u[s];c.numeroPhase===e.numeroPhase&&(c.dureeTemp=e.duree)}}else this.listePhaseStock=this.messageErreurDureePhaseDt(n,this.listePhaseStock,e)},u.prototype.messageErreurDureePhaseDt=function(e,t,n){for(var i=angular.copy(t),r=0,a=i;r<a.length;r++){var o=a[r];o.numeroPhase===n.numeroPhase&&(o.libelleErreurModifPhasePaliers=e,o.dureeTemp=n.duree)}return i},u.prototype.getRenegociationProduitFiltre=function(t,n){return void 0===n&&(n=e.Commun.Enum.TypeAvenant.AvenantCommercial),n===e.Commun.Enum.TypeAvenant.AvenantRecouvrement?_.filter(t,function(e){return"R"===e.codeTypeAvenant}):n===e.Commun.Enum.TypeAvenant.AvenantTechnique?_.filter(t,function(e){return"T"===e.codeTypeAvenant}):_.filter(t,function(e){return"C"===e.codeTypeAvenant})},u.prototype.getIsEligibleChangementProduit=function(t,n,i,r){return"PF"===t.codeTypePhase?!1:n===e.Commun.Enum.CodeTypeAcces.Creation?(r||[]).length>0:null!=i.identifiantProfilRenegociation},u.prototype.getNumeroModaliteRA=function(e,t){var n=[];if(e.length>0)for(var i=0,r=e;i<r.length;i++){var a=r[i];"1"===t.typeLoi?("1"===a.codeCompatibiliteTypeLoi||"3"===a.codeCompatibiliteTypeLoi)&&n.push(a):"2"===t.typeLoi?("2"===a.codeCompatibiliteTypeLoi||"3"===a.codeCompatibiliteTypeLoi)&&n.push(a):(""===t.typeLoi||null===t.typeLoi||angular.isUndefined(t.typeLoi))&&n.push(a)}return n},u.prototype.getNumeroModaliteRaOuverture=function(e,t){if(e.length>0&&null!==t){var n=r.findOrEmpty(e,function(e){return e.numModaliteRemboursemntAnticipe===t.numeroModaliteRembAnticipe});return _.isEmpty(n)?null:n}return null},u.prototype.changeTauxRA=function(e){this.tauxRa=this.getTauxRA(e,this.dataRestAvenant.creditCurrentInfoCredit,this.codeTypeAcces,this.dataRestAvenant.creditCaraFinan),this.bornesTauxRa="["+e.tauxMinimumAccessoire.toString()+","+e.tauxMaximumAccessoire.toString()+"]",this.borneTauxRaMin=e.tauxMinimumAccessoire,this.borneTauxRaMax=e.tauxMaximumAccessoire},u.prototype.getTauxRA=function(t,n,i,r){return i===e.Commun.Enum.CodeTypeAcces.Creation?angular.isUndefined(t)||null===t?0:"3"===t.codeModeCalculIndemniteRa||"4"===t.codeModeCalculIndemniteRa||"5"===t.codeModeCalculIndemniteRa?n.tauxIndemniteRA:0:(i===e.Commun.Enum.CodeTypeAcces.Lecture||i===e.Commun.Enum.CodeTypeAcces.Modification||i===e.Commun.Enum.CodeTypeAcces.Duplication)&&null!==r?r.tauxIndemniteRA:0},u.prototype.getLibelleNouveauProduit=function(t,n,i){return n!==e.Commun.Enum.CodeTypeAcces.Creation&&null!=i.identifiantProfilRenegociation?i.libelleLongProduit:null!=t?t.libelle1erProduitProfil:null},u.prototype.getAccessoireIntegreCrd=function(t,i,r){if(r===e.Commun.Enum.CodeTypeAcces.Creation&&null!=t&&t.length>0)for(var a=0,o=t;a<o.length;a++){var s=o[a];if(null==s.codeTypePhase&&"B13"===s.regleAppelAccessoireAperiodique&&"21"!==s.codeNatureAccessoire&&"22"!==s.codeNatureAccessoire)return n.AccessoireProduitAdapaterCaraFinanBuilder.getResult(s)}else if((r===e.Commun.Enum.CodeTypeAcces.Modification||r===e.Commun.Enum.CodeTypeAcces.Duplication)&&null!=i&&i.length>0)for(var u=0,c=i;u<c.length;u++){var s=c[u];if(null==s.codeTypePhase&&"B13"===s.regleAppelAccessoireAperiodique&&"21"!==s.codeNatureAccessoire&&"22"!==s.codeNatureAccessoire)return s}return{}},u.prototype.getIsPretImpact=function(t,n,i){return t&&null!=t.codeTypeBonification&&t.codeTypeBonification.length>0&&(i===e.Commun.Enum.CodeTypeAcces.Creation||null!=n)},u.prototype.getDetailDpe=function(e){return this.isPretImpact?{codeTypeBonification:e.codeTypeBonification,montantBonusPretImpact:e.montantBonusPretImpact,pourcentageBonusPretImpact:e.pourcentageBonusPretImpact,codeEtatPretImpact:e.codeEtatPretImpact,codePerformanceEnergetique:e.codePerformanceEnergetique,indPerformanceEnergetiqueCible:e.indPerformanceEnergetiqueCible,delaiMiseEnPlacePretImpact:e.delaiMiseEnPlacePretImpact,regleCalculDateLimitePretImpact:e.regleCalculDateLimitePretImpact,indPerformanceEnergetiqueReel:e.indPerformanceEnergetiqueReel,dateRealisationSecondDPE:e.dateRealisationSecondDPE,numeroRelatifAvenantPretImpact:e.numeroRelatifAvenantPretImpact,dateSaisieSecondDPE:e.dateSaisieSecondDPE,identifiantDPE:e.identifiantDPE}:null},u.prototype.getDetailDpeAvenant=function(t,n){return this.isPretImpact?n?{dateSaisieSecondDPE:n.dateRealisationSecondDPE,indPerformanceEnergetique:n.indPerfEnergetiqueReel,dateRealisationSecondDPE:n.dateRealisationSecondDPE,identifiantDPE:n.idDiagPerformanceEnergie}:{dateSaisieSecondDPE:t.dateRealisationSecondDPE?t.dateRealisationSecondDPE:e.Commun.Tools.DateUtils.format(new Date(Date.now()),e.Commun.Constantes.Format.DATE_REST),indPerformanceEnergetique:null!=t.indPerformanceEnergetiqueReel&&t.indPerformanceEnergetiqueReel.length>0?t.indPerformanceEnergetiqueReel:t.codePerformanceEnergetique,dateRealisationSecondDPE:t.dateRealisationSecondDPE,identifiantDPE:t.identifiantDPE}:null},u.prototype.setDataObjetFinanceByObjet=function(e){},u.prototype.setDataAssurancesByAvenantPersonne=function(){},u}(n.AvenantDescriptionBehavior);n.AvenantDescription=s}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i,r=e.Commun.ToolsFunctionals.Accessoire,a=e.Commun.ToolsFunctionals.Taux,o=e.Commun.Tools.Object,s=e.Commun.Enum.ModeCalculExhaustif;!function(e){e[e.ActuarielToProportionnel=0]="ActuarielToProportionnel",e[e.ProportionnelToActuariel=1]="ProportionnelToActuariel",e[e.EquivalentToProportionnel=2]="EquivalentToProportionnel",e[e.NonGere=3]="NonGere"}(i||(i={}));var u=function(){function n(e,n){this.libelleTypeAccessoire=null!=n?n.libelleTypeAccessoire:e.libelleTypeAccessoire,this.etatManipulationAccessoire=t.Enum.EtatManipulation.Unchanged,this.accessoireInitial=e,this.modeCalculExhaustif=r.getModeCalculAccessoireExhaustif(e.codeModeCalculAccessoire1),this.indicateurAccessoireValide=null!=n?n.indicateurAccessoireValide:e.indicateurAccessoireValide,this.indicAccessoireCreeParAvenant=null!=n?n.indicAccessoireCreeParAvenant:e.indicAccessoireCreeParAvenant,this.indicateurAccessoireAnnuleAv=null!=n?n.indicateurAccessoireAnnuleAv:e.indicateurAccessoireAnnuleAv,this.isToIntegreCrd="B13"===e.regleAppelAccessoireAperiodique;var i=e.periodiciteApplicationAccess,a=null!=n?n.tauxElement:e.tauxElement;this.taux=this.isTauxEditable?this.getTauxCalcule(a,e,i):a,this.tauxConseille=e.tauxConseilleAccessoire,this.showTauxConseille=this.isTauxEditable&&0!==this.tauxConseille,this.tauxMinimum=this.isTauxEditable?this.getTauxCalcule(e.tauxMinimumAccessoire,e,i):0,this.showTauxMinimun=this.isTauxEditable&&0!==this.tauxMinimum,this.tauxMaximum=this.isTauxEditable?this.getTauxCalcule(e.tauxMaximumAccessoire,e,i):100,this.showTauxMaximum=this.isTauxEditable&&0!==this.tauxMaximum,this.listeTauxChoix=this.getListeTauxChoix(e,i),this.montant=this.getMontant(e,n),this.montantConseille=e.montantConseilleAccessoire,this.montantMinimum=e.montantMinimumPlageAccessoire,this.montantMaximum=e.montantMaximumPlageAccessoire,this.showMontantPas=e.mtPasMontantAccessoire>0,this.montantPas=e.mtPasMontantAccessoire,this.listeMontantChoix=this.getListeMontantChoix(e)}return Object.defineProperty(n.prototype,"isTauxEditable",{get:function(){return _.contains([s.TauxPlage,s.MontantFixeAvecTaux],this.modeCalculExhaustif)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isTauxSelectionnable",{get:function(){return _.contains([s.TauxFixeAssiette,s.TauxTrancheMontant],this.modeCalculExhaustif)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMontantEditable",{get:function(){return _.contains([s.MontantPlage,s.MontantFixeAvecTaux],this.modeCalculExhaustif)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMontantSelectionnable",{get:function(){return this.modeCalculExhaustif===s.MontantFixe},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"libelleHelpMontant",{get:function(){return"["+this.montantMinimum+".."+this.montantMaximum+"; "+this.montantPas+"]"},enumerable:!0,configurable:!0}),n.prototype.isTauxValid=function(){return this.isTauxEditable?null!=this.taux&&this.taux>=this.tauxMinimum&&this.taux<=this.tauxMaximum:this.isTauxSelectionnable?_.contains(this.listeTauxChoix,this.taux):!0},n.prototype.isMontantValid=function(){return this.isMontantEditable?null!=this.montant&&this.montant>=this.montantMinimum&&this.montant<=this.montantMaximum&&o.isModuloRespected(this.montant,this.montantPas,this.showMontantPas):this.isMontantSelectionnable?_.contains(this.listeMontantChoix,this.montant):!0},n.prototype.getListeTauxChoix=function(e,t){if(this.modeCalculExhaustif===s.TauxFixeAssiette){var n=this.getTauxCalcule(e.tauxElement,e,t),i=this.getTauxCalcule(e.tauxMinimumAccessoire,e,t),r=this.getTauxCalcule(e.tauxMaximumAccessoire,e,t),a=this.getTauxCalcule(e.tauxConseilleAccessoire,e,t),o=[];return n>0&&o.push(n),i>0&&o.push(i),r>0&&o.push(r),a>0&&o.push(a),o}if(this.modeCalculExhaustif===s.TauxTrancheMontant){var o=[e.tauxMinimumAccessoire,e.tauxConseilleAccessoire,e.tauxMaximumAccessoire,e.mtPlafondTrancheCalculAccess,e.tauxElement];return 0!==e.tauxMinimumAccessoire1&&0!==e.tauxMaximumAccessoire1&&o.push(e.tauxMinimumAccessoire1,e.tauxConseilleAccessoire1,e.tauxMaximumAccessoire1,e.mtPlafondTrancheCalculAccess1,e.tauxElement1),0!==e.tauxMinimumAccessoire2&&0!==e.tauxMaximumAccessoire2&&o.push(e.tauxMinimumAccessoire2,e.tauxConseilleAccessoire2,e.tauxMaximumAccessoire2,e.mtPlafondTrancheCalculAccess2,e.tauxElement2),0!==e.tauxMinimumAccessoire3&&0!==e.tauxMaximumAccessoire3&&o.push(e.tauxMinimumAccessoire3,e.tauxConseilleAccessoire3,e.tauxMaximumAccessoire3,e.mtPlafondTrancheCalculAccess3,e.tauxElement3),0!==e.tauxMinimumAccessoire4&&0!==e.tauxMaximumAccessoire4&&o.push(e.tauxMinimumAccessoire4,e.tauxConseilleAccessoire4,e.tauxMaximumAccessoire4,e.mtPlafondTrancheCalculAccess4,e.tauxElement4),o}return[]},n.prototype.getMontant=function(e,t){return null!=t?t.montantElement:null!=e.montantElement&&0!==e.montantElement?e.montantElement:e.montantConseilleAccessoire},n.prototype.getListeMontantChoix=function(e){if(this.isMontantSelectionnable){var t=[e.montantConseilleAccessoire];return e.montantMinimumPlageAccessoire>0&&t.push(e.montantMinimumPlageAccessoire),e.montantMaximumPlageAccessoire>0&&t.push(e.montantMaximumPlageAccessoire),e.mtPasMontantAccessoire>0&&t.push(e.mtPasMontantAccessoire),t}return[]},n.prototype.getTauxCalcule=function(t,n,r){if(0!==n.numeroPhase&&""!==n.codeTypePhase&&""!==n.codeModeCalculTaux)switch(this.getTypeTaux(n.codeModeCalculTaux)){case i.ActuarielToProportionnel:return a.getTauxFromModeToMode(t,r,e.Commun.Enum.ModeCalculTaux.Actuariel,e.Commun.Enum.ModeCalculTaux.Proportionnel);case i.ProportionnelToActuariel:return a.getTauxFromModeToMode(t,r,e.Commun.Enum.ModeCalculTaux.Proportionnel,e.Commun.Enum.ModeCalculTaux.Actuariel);default:return 0}return t},n.prototype.getTypeTaux=function(e){switch(e){case"E":return i.ActuarielToProportionnel;case"P":return i.ProportionnelToActuariel;case"Pas de cas":return i.EquivalentToProportionnel;default:return i.NonGere}},n}();n.FraisAvenant=u}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=function(){function e(){}return e.getDossierElectronique=function(e,i,r){var a=_.find(e,function(e){return e.codeEvenementDeclencheur===n.SignatureElectroniqueHelper.getEvenementHisto(t.Enum.EvenementHistoSED.CreationActeIDN,i)});return{idIDN:_.first(e).idtGeneriqueSecondDossierCredit,avancementSignatures:this.getListeAvancementSignatureElectroniquePersonne(_.filter(e,function(e){return null!=e.identifiantPersonne}),i,r),dateCreationActeIDN:this.getDateEvent(e,t.Enum.EvenementHistoSED.CreationActeIDN,i),dateValidationHierarchie:this.getDateEvent(e,t.Enum.EvenementHistoSED.ValidationHierarchie,i),dateRefusHierarchique:this.getDateEvent(e,t.Enum.EvenementHistoSED.RefusHierarchiqueRetourPapier,i),dateActivationEspaceSignature:this.getDateEvent(e,t.Enum.EvenementHistoSED.ActivationEspaceSignature,i),dateAnnulationCaduqueIDN:this.getDateEvent(e,t.Enum.EvenementHistoSED.AnnulerCaduqueIDN,i),dateAnomalieTraitementAutomatique:this.getDateEvent(e,t.Enum.EvenementHistoSED.AnomalieTraitementAutomatique,i),numeroCreation:null!=a?a.numeroSequenceEvenement:0}},e.getListeAvancementSignatureElectroniquePersonne=function(e,t,n){var i=this;if(0===e.length)return[];var r=_.groupBy(e,function(e){return e.identifiantPersonne});return _.map(r,function(e){return i.getAvancementSignatureElectroniquePersonne(e,t,n)})},e.getAvancementSignatureElectroniquePersonne=function(e,n,i){return{personne:this.getPersonneDesignation(_.first(e),i),dateRemiseOffre:this.getDateEvent(e,t.Enum.EvenementHistoSED.RemiseOffre,n),dateAccuseReception:this.getDateEvent(e,t.Enum.EvenementHistoSED.AccuseReceptionOffre,n),dateSignature:this.getDateEvent(e,t.Enum.EvenementHistoSED.SignatureOffreEmprunteur,n),dateAbandonSignature:this.getDateEvent(e,t.Enum.EvenementHistoSED.AbandonSignatureClient,n)}},e.getDateEvent=function(e,t,r){var a=_.find(e,function(e){return e.codeEvenementDeclencheur===n.SignatureElectroniqueHelper.getEvenementHisto(t,r)});return null!=a?i.parse(a.libelleTimestamp):null},e.getPersonneDesignation=function(e,t){var n=_.find(t,function(t){return t.idPersonne===e.identifiantPersonne});return null!=n?n:{idPersonne:e.identifiantPersonne,libelleLong:"emprunteur "+e.identifiantPersonne}},e}();n.DossierElectroniqueBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.Object,a=e.Commun.Tools.List,o=e.Commun.Constantes.Habilitation,s=function(){function s(){}return s.getResult=function(t,a,o,s,u,c){var l=a===e.Commun.Enum.CodeAvenantSimulation.Avenant,d=n.AvenantResumeHelper.getEtatDecision(t.libelleEtatSimulAvenant),m=this.getDroitModifier(o,t,l,u),h=this.getDroitConsulter(o,t,l,u),p=this.getDroitContractualiser(d,u,t.codeTypeAvenant,l),f=l?t.numeroRelatif:t.numeroRelatifSimulationAvenant,A=n.AvenantResumeHelper.getTypeAvenant(l,t.codeTypeAvenant),P=n.AvenantResumeHelper.getProcessSedIsLaunched(l,t.codeIndicSignrElect),v=this.getListePersonneSignataire(c.listePersonneSignataireAvenant,f),g=this.getHabilitationSignatureElectronique(u),C=i.parse(t.dateDerniereEdition),E=n.SignatureElectroniqueHelper.getListeHistoByElement(c.listeHisto,l,t),b=n.ModificationCreditHelper.getListeModificationCredit(t);return{type:A,libelleType:n.AvenantResumeHelper.getLibelleTypeAvenant(A),codeAvenantSimulation:a,listeModificationCredit:b,numero:f,numeroRenegociationSimulation:l?0:t.numeroRelatif,isOrigineMyway:n.AvenantResumeHelper.getIsOrigineMyway(t.codeOrigineCreditDossier),idCredit:t.identifiantCredit,devise:s,typeModif:n.AvenantResumeHelper.getLibelleTypeModification(t,b),typeModifDetail:n.AvenantResumeHelper.getLibelleDescriptionModificationCredit(b,!1),dateCreation:i.parse(t.dateCreation),dateDerniereEdition:C,dateSignature:i.parse(t.dateSignature),dateEffet:i.parse(t.dateEffet),dateEditionOffre:i.parse(t.dateEditionOffre),dateReceptionOffreClient:i.parse(t.dateReceptionOffreClient),isSaisieRetroactive:this.getIsSaisieRetroactive(t.dateSaisieLEvenement,t.dateCreation),dateSaisieRetroactive:this.getDateSaisieRetro(t),numeroQuantiemeDateEcheance:l?this.getnumeroQuantiemeDateEcheance(t):null,libelleEtatSimulAvenant:this.getLibelleEtatSimulAvenant(l,t,P,E),montantFraisGestion:t.montantFraisGestion,identifiantAgentDelegateur:t.identifiantAgentDelegateur,dateAnnulation:i.parse(t.dateAnnulationModification),motifAnnulation:r.stringToExpressionCase(this.getMotifAnnulation(l,t.codeModifAnnulationModification,c.listeRefus)),droitConsulterEnabled:h,droitModifierEnabled:m,btnOuvrirEnabled:m||h,btnHistoriqueEnabled:this.getDroitHistorique(o,t,l,u),btnDupliquerSimulationEnabled:l?!1:this.getDroitDupliquerSimulation(o,t,u),btnRefusEnabled:this.getBtnRefusEnabled(l,t,u),btnContractualiserEnabled:p,etatDecision:d,compteurMiseJour:c.credit.compteurMiseJour,dateLimiteValidite:i.parse(t.dateFinValidite),dateMinimumAcceptation:i.parse(t.dateMinimumAcceptation),listePersonneSignataire:v,idEmprunteur:c.credit.identifiantEmprunteur,agentHasHabilitationSed:g,isEtablissementEligibleSed:null,processSedIsLaunched:P,listeRefus:c.listeRefus,isAvenantQuantieme:_.some(b,function(t){return t===e.Commun.Enum.ModificationCredit.Quantieme}),simulation:l?null:t,avenant:l?t:null,documentsEdition:c.listeDocs||null,signaturesAnnexes:c.listeAnnexes||null,listeHisto:E,libelleSousType:this.getLibelleSousTypeAvenant(t.codeSousTypeAvenantRecouvrement),isCreditRevisable:n.AvenantResumeHelper.getIsCreditRevisable(l,t),statutCompatibiliteProcessSed:null,libelleAvancementSed:null,eligibiliteSed:null,listeDossierIdn:null,listeMotifsNonEligibiliteSed:null,nombreMotifsNonEligibiliteSed:0}},s.getLibelleSousTypeAvenant=function(t){if((t||"").trim().length<2)return null;var n=_.filter(e.Business.Constantes.Avenant.listeSousTypeModificationCreditCreation,function(e){return(e.type||"").toString()===t});return n.length>0?_.first(n).label:"code "+t+" inconnu"},s.getLibelleEtatSimulAvenant=function(e,a,o,s){if(o&&!r.isStringNotEmpty(a.codeModifAnnulationModification)&&!i.isValued(a.dateSignature)){var u=_.some(s,function(i){return i.codeEvenementDeclencheur===n.SignatureElectroniqueHelper.getEvenementHisto(t.Enum.EvenementHistoSED.RemiseOffre,e)});return u?"Attente signature client":"En attente d'envoi"}return r.stringToExpressionCase(a.libelleEtatSimulAvenant)},s.getBtnRefusEnabled=function(t,n,i){if(null!=n.codeModifAnnulationModification)return!1;var r=this.getHabilitationByTypeAvenant(n.codeTypeAvenant,t,i),a=null!=r&&parseInt(r.codeHabilitation)>=e.Commun.Enum.HabilitationNiveau.MiseAJour;return t?a&&"1"!==n.codeTraitementModifEffectue:a},s.getMotifAnnulation=function(e,t,n){return null!=t?a.findOrEmpty(n,function(n){return n.typeCodeMotif===t&&n.codeEntite===(e?"BH02":"NH02")}).libelleLongMotif:""},s.getDroitConsulter=function(t,n,i,r){var a=this.getIsHabilite(n,i,r,e.Commun.Enum.HabilitationNiveau.Consultation,!1)&&angular.isDefined(_.find([null,""],function(e){return e===n.codeModifAnnulationModification}))&&this.getIsChronologic(t,n.dateCreation,n.dateEffet,n.dateSaisieLEvenement);if(i){var o=n;return a&&"0"===o.codeTraitementModifEffectue&&angular.isDefined(_.find([null,"","0"],function(e){return e===o.etatBrancheDonneesVersementEdg}))&&angular.isDefined(_.find([null,"","0"],function(e){return e===o.etatBrancheEcheancierVersement}))&&angular.isDefined(_.find([null,"","0"],function(e){return e===o.etatBrancheDonneesComplem}))&&angular.isDefined(_.find([null,"","0"],function(e){return e===o.etatBrancheChoixPrescripteur}))}return a},s.getDroitContractualiser=function(n,i,r,a){var o=this.getHabilitationByTypeAvenant(r,a,i);return null!=o&&parseInt(o.codeHabilitation)>=e.Commun.Enum.HabilitationNiveau.MiseAJour&&n===t.Enum.EtatDecision.Possible},s.getDroitHistorique=function(t,n,r,a){return this.getIsHabilite(n,r,a,e.Commun.Enum.HabilitationNiveau.Consultation,!0)&&"1"===n.codeTraitementModifEffectue&&moment(n.dateSignature).isValid()&&angular.isDefined(_.find([null,""],function(e){return e===n.codeModifAnnulationModification}))&&!angular.isDefined(_.find(["HA","HI"],function(e){return e===n.codeTypeModificationCredit}))&&i.isBefore(n.dateEffet,t)},s.getDroitModifier=function(e,t,n,i){var r=this.getDroitActionAvenantSimulation(e,t,i,n)&&!moment(t.dateDerniereEdition).isValid();if(n){var a=t;return r&&"N"!==a.codeModifAvenantSimulation&&angular.isDefined(_.find([null,"","0"],function(e){return e===a.etatBrancheDonneesVersementEdg}))&&angular.isDefined(_.find([null,"","0"],function(e){return e===a.etatBrancheEcheancierVersement}))&&angular.isDefined(_.find([null,"","0"],function(e){return e===a.etatBrancheDonneesComplem}))&&angular.isDefined(_.find([null,"","0"],function(e){return e===a.etatBrancheChoixPrescripteur}))&&"HT"!==a.codeTypeModificationCredit}return r},s.getDroitDupliquerSimulation=function(e,t,n){return this.getDroitActionAvenantSimulation(e,t,n,!1)&&"0"!==t.etatBrancheFinanciere},s.getDroitActionAvenantSimulation=function(t,n,i,r){return this.getIsHabilite(n,r,i,e.Commun.Enum.HabilitationNiveau.MiseAJour,!1)&&!moment(n.dateSignature).isValid()&&angular.isDefined(_.find([null,""],function(e){return e===n.codeModifAnnulationModification}))&&"N"!==n.codeModifAvenantSimulation&&"N"!==n.codeActionPourMiseAJour&&this.getIsChronologic(t,n.dateCreation,n.dateEffet,n.dateSaisieLEvenement)},s.getIsHabilite=function(e,t,n,i,r){var a=this.getHabilitationByTypeAvenant(e.codeTypeAvenant,t,n),o=a&&parseInt(a.codeHabilitation)>=i,s=this.getHabilitationByDate(e.dateEffet,e.dateCreation,n);return r||!s?o:o&&parseInt(s.codeHabilitation)>=i},s.getHabilitationByTypeAvenant=function(e,t,n){if(!t)return this.getHabilitation(n,o.simulationAvenant);switch(e){case"R":return this.getHabilitation(n,o.avenantRecouvrement);case"T":return this.getHabilitation(n,o.avenantTechnique);case"C":case"":return this.getHabilitation(n,o.avenantCommercial);default:return null}},s.getHabilitationByDate=function(e,t,n){return i.isAfter(t,e)?this.getHabilitation(n,o.simulationAvenantSaisieRetroactve):null},s.getHabilitation=function(e,t){return a.findOrEmpty(e,function(e){return e.codeNatureTraitement===t})},s.getIsChronologic=function(e,t,n,r){return this.getIsSaisieRetroactive(r,t)||!i.isAfter(e,n)},s.getDateSaisieRetro=function(e){return this.getIsSaisieRetroactive(e.dateSaisieLEvenement,e.dateCreation)?i.parse(e.dateCreation):null},s.getIsSaisieRetroactive=function(e,t){return i.isBefore(t,e)},s.getHabilitationSignatureElectronique=function(t){var n=this.getHabilitation(t,o.signatureElectronique);return n&&parseInt(n.codeHabilitation)>=e.Commun.Enum.HabilitationNiveau.MiseAJour},s.getListePersonneSignataire=function(e,t){return _.map(_.filter(e,function(e){return e.numeroRelatif===t}),function(e){var t={idPersonne:e.identifiantPersonneEmprunteur,acceptsElecSignature:"O"===e.codeIndicPersAutorSignElect,etatAcceptsElecSignature:null,intitulePersonne:null};return t})},s.getnumeroQuantiemeDateEcheance=function(e){return e.numeroQuantiemeDateEcheance},s}();n.AvenantResumeBuilder=s}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.Object,r=e.Commun.Enum.ModificationCredit,a=function(){function n(){}return n.getTypeAvenant=function(t,n){if(!t)return e.Commun.Enum.TypeAvenant.SimulationAvenant;switch(n){case e.Commun.Enum.TypeAvenant.AvenantCommercial.toString():return e.Commun.Enum.TypeAvenant.AvenantCommercial;case e.Commun.Enum.TypeAvenant.AvenantTechnique.toString():return e.Commun.Enum.TypeAvenant.AvenantTechnique;case e.Commun.Enum.TypeAvenant.AvenantRecouvrement.toString():return e.Commun.Enum.TypeAvenant.AvenantRecouvrement;case e.Commun.Enum.TypeAvenant.SimulationAvenant.toString():return e.Commun.Enum.TypeAvenant.SimulationAvenant;default:return null}},n.getLibelleTypeAvenant=function(t){switch(t){case e.Commun.Enum.TypeAvenant.AvenantCommercial:return"Avenant Commercial";case e.Commun.Enum.TypeAvenant.AvenantTechnique:return"Avenant Technique";case e.Commun.Enum.TypeAvenant.AvenantRecouvrement:return"Avenant de Recouvrement";case e.Commun.Enum.TypeAvenant.SimulationAvenant:return"Simulation d'avenant";default:return"Non géré"}},n.getIsOrigineMyway=function(e){return"P"!==e&&"C"!==e},n.getEtatDecision=function(e){switch((e||"").toLowerCase()){case"attente décision établissement":case"attente decision etablissement":case"attente édition proposition":case"attente edition proposition":case"attente edition offre":case"attente édition offre":case"attente edition d'offre":case"attente édition d'offre":case"attente signature client":case"attente accord établissement":case"attente accord etablissement":case"attente accord client":case"attente envoi au client":return t.Enum.EtatDecision.Possible;case"pris en compte":return t.Enum.EtatDecision.Effectue;default:return t.Enum.EtatDecision.Impossible}},n.getProcessSedIsLaunched=function(e,t){return e?"O"===t:"D"===t||"T"===t||"S"===t||"M"===t},n.getLibelleTypeModification=function(e,t){if(_.some(t,function(e){return e===r.Personne}))return"Personne";if(_.some(t,function(e){return e===r.Objet}))return"Objet";if(_.some(t,function(e){return e===r.ChangementProduit}))return"Changement de produit";if(!_.contains(["C","M","P"],e.codeOrigineCreditDossier)&&1===t.length){if(_.some(t,function(e){return e===r.Financier}))return"13"===e.codeTypeModificationCredit?"Préfi + cara. financières - Taux / durée":"Cara. financières - Taux / durée";if(_.some(t,function(e){return e===r.Assurance}))return"Cara. financières - Assurance";if(_.some(t,function(e){return e===r.Garantie}))return"Cara. financières - Garantie"}return i.stringToExpressionCase(e.libelleTypeModification)},n.getLibelleDescriptionModificationCredit=function(e,t){if(!t&&1===(e||[]).length)return null;var n=[];return _.some(e,function(e){return e===r.Quantieme})&&n.push("Quantième"),_.some(e,function(e){return e===r.Personne})&&n.push("Personnes"),_.some(e,function(e){return e===r.Objet})&&n.push("Objet"),_.some(e,function(e){return e===r.Financier})&&n.push("Financières"),_.some(e,function(e){return e===r.Assurance})&&n.push("Assurances"),_.some(e,function(e){return e===r.Garantie})&&n.push("Garanties"),_.some(e,function(e){return e===r.ReportFinPret})&&n.push("Report fin de prêt"),_.some(e,function(e){return e===r.AmenagementTemporaireEcheances})&&n.push("Aménagement temporaire d'échéances"),_.some(e,function(e){return e===r.Inconnu})&&n.push("Inconnue"),i.stringToExpressionCase(n.join(", "))},n.getIsCreditRevisable=function(e,t){return e?"O"===t.codeExistenceCreditTxRevisable:"O"===t.cdExistenceCreditTauxRevisable},n}();n.AvenantResumeHelper=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=function(){function r(){}return r.getResult=function(t,n){var i=t.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Avenant,r=this.getStatutCompatibiliteProcessSed(t,i,n),a=this.getListeDossierElectronique(t.listeHisto,i?t.avenant:t.simulation,i,n.listePersonnesEmprunteur);return t.statutCompatibiliteProcessSed=r,t.libelleAvancementSed=null!==r?this.getLibelleAvancementSed(i,a,t.simulation):null,t.eligibiliteSed=n.eligibiliteSed,t.listeDossierIdn=a,t.listeMotifsNonEligibiliteSed=n.listeMotifsNonEligibiliteSed,t.nombreMotifsNonEligibiliteSed=n.listeMotifsNonEligibiliteSed.length,t},r.getStatutCompatibiliteProcessSed=function(e,i,r){if(e.processSedIsLaunched)return"Oui";if(this.getSimulationNonAssurance(i,e.listeModificationCredit))return null;if(r.eligibiliteSed&&!r.eligibiliteSed.isEtablissementEligible)return"Non autorisé sur l'établissement";if(!e.agentHasHabilitationSed)return"Non autorisé";if(!r.dossierNonEditeNonAnnuleNonSigne)return"Non";if(r.eligibiliteSed.isEmprunteurHabilite===!1)return"Non (Emprunteur non compatible)";if(i){if(r.eligibiliteSed.isAvenantWithGarantiesEligibles===!1)return"Non (Garantie non compatible)";if(r.eligibiliteSed.isDossierPiecoEligible===!1)return"Non (Dossier non compatible)";if(_.some(e.listePersonneSignataire,function(e){return!e.acceptsElecSignature}))return"Non (refus de l'emprunteur)";if(n.SignatureElectroniqueHelper.getListeHistoFiltree(e.listeHisto,!1).length>0){var a=n.SignatureElectroniqueHelper.getCommentaireEvenement(e.listeHisto,i,t.Enum.EvenementHistoSED.RefusHierarchiqueRetourPapier);return null!=a?"Abandonné ("+a+")":"Abandonné"}}return"Compatible"},r.getSimulationNonAssurance=function(t,n){return t?!1:_.every(n,function(t){return t!==e.Commun.Enum.ModificationCredit.Assurance&&t!==e.Commun.Enum.ModificationCredit.Inconnu})},r.getListeDossierElectronique=function(e,t,i,r){if(null===t.codeIndicSignrElect||"N"===t.codeIndicSignrElect)return[];var a=_.groupBy(n.SignatureElectroniqueHelper.getListeHistoFiltree(e,!1),function(e){return e.idtGeneriqueSecondDossierCredit}),o=_.map(a,function(e){return n.DossierElectroniqueBuilder.getDossierElectronique(e,i,r)});return _.sortByOrder(o,function(e){return e.numeroCreation})},r.getLibelleAvancementSed=function(e,t,n){return e?this.getLibelleAvancementSedForAvenant(t):this.getLibelleAvancementSedForSimulation(n.codeIndicSignrElect)},r.getLibelleAvancementSedForAvenant=function(e){var t=e.length>0?_.max(e,function(e){return e.numeroCreation}):null;if(null===t)return null;if(!i.isValued(t.dateCreationActeIDN))return"Dossier électronique non créé";if(i.isValued(t.dateRefusHierarchique))return"Refusé par la hiérarchie";if(!i.isValued(t.dateValidationHierarchie))return"Non envoyé au client / En attente validation hiérarchique";if(i.isValued(t.dateAnnulationCaduqueIDN))return"Dossier annulé (caduque)";if(i.isValued(t.dateAnomalieTraitementAutomatique))return"Erreur lors du traitement automatique de remise";
var n=_.map(_.filter(t.avancementSignatures,function(e){return i.isValued(e.dateAbandonSignature)}),function(e){return e.personne.libelleLong});if(1===n.length)return"Refusé par "+_.first(n);if(n.length>1)return"Refusé par "+n.join(" et ");if(_.some(t.avancementSignatures,function(e){return!i.isValued(e.dateRemiseOffre)}))return"Non envoyé";var r=_.map(_.filter(t.avancementSignatures,function(e){return!i.isValued(e.dateAccuseReception)}),function(e){return e.personne.libelleLong});if(1===r.length)return"En attente réception de "+_.first(r);if(r.length>1)return"En attente de "+r.length+" accusés de réception";var a=_.map(_.filter(t.avancementSignatures,function(e){return!i.isValued(e.dateSignature)}),function(e){return e.personne.libelleLong});if(1===a.length)return"En attente signature de "+_.first(a);if(a.length>1)return"En attente de "+a.length+" signatures";var o=_.sortByOrder(_.filter(t.avancementSignatures,function(e){return i.isValued(e.dateSignature)}),function(e){return e.dateSignature},!1);return o.length>0?"Entièrement signé le "+i.format(_.first(o).dateSignature):"Aucune donnée trouvée"},r.getLibelleAvancementSedForSimulation=function(e){switch(e){case"D":return"Mandats envoyés, SED en cours";case"T":return"Mandats abandonnés/annulés";case"S":return"Mandats tous signés";case"M":return"Mixte : 1 Mandat signé/1 Mandat abandonné ou annulé";default:return null}},r}();n.AvenantResumeWithSedBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Enum.ModificationCredit,i=function(){function e(){}return e.getListeModificationCredit=function(e){var t=e.codeTypeModificationCredit,i=e.codeOrigineCreditDossier;if(_.contains(["C","M","P","Z"],i))return this.getListeModificationCreditAncienneVersionOrSimple(t,i,e.etatBranchePersonne,e.etatBrancheObjet);var r=this.getListeModificationCreditNouvelleVersion(t,i);return(0===r.length||"Z"===i)&&r.push(n.Inconnu),r},e.getListeModificationCreditNouvelleVersion=function(e,t){switch(e){case"03":return[n.Quantieme];case"PR":return this.getListeModificationCreditChangementProduit(t);case"RE":return this.getListeModificationCreditAte(t);case"S":case"NS":return this.getListeModificationCreditReportFinPret(t);case"01":case"13":case"":case null:return this.getListeModificationCreditCaraFinancieres(t);default:return[]}},e.getListeModificationCreditChangementProduit=function(e){return _.union([n.ChangementProduit,n.Financier],this.getListeModificationCreditCaraFinancieres(e))},e.getListeModificationCreditAte=function(e){return[n.AmenagementTemporaireEcheances].concat(this.getListeModificationCreditCaraFinancieres(e))},e.getListeModificationCreditReportFinPret=function(e){return[n.ReportFinPret].concat(this.getListeModificationCreditCaraFinancieres(e))},e.getListeModificationCreditCaraFinancieres=function(e){switch(e){case"0":return[n.Assurance];case"1":return[n.Garantie];case"2":return[n.Financier];case"4":return[n.Personne];case"D":return[n.Personne,n.Assurance];case"3":return[n.Objet];case"9":return[n.Objet,n.Garantie];case"5":return[n.Assurance,n.Garantie];case"6":return[n.Financier,n.Assurance];case"7":return[n.Financier,n.Garantie];case"8":return[n.Financier,n.Assurance,n.Garantie];case"G":return[n.Personne,n.Assurance,n.Garantie];case"H":return[n.Personne,n.Assurance,n.Garantie,n.Financier];case"K":return[n.Personne,n.Objet,n.Garantie,n.Assurance];case"L":return[n.Personne,n.Objet,n.Garantie,n.Assurance,n.Financier];case"N":return[n.Objet,n.Garantie,n.Assurance];case"Q":return[n.Objet,n.Assurance];case"T":return[n.Personne,n.Garantie];case"U":return[n.Personne,n.Garantie,n.Financier];case"O":return[n.Personne,n.Assurance,n.Financier];case"V":return[n.Objet,n.Financier,n.Assurance];case"W":return[n.Objet,n.Financier,n.Garantie];case"X":return[n.Objet,n.Financier,n.Garantie,n.Assurance];default:return[]}},e.getListeModificationCreditAncienneVersionOrSimple=function(e,t,i,r){var a=this.getListeModificationCreditAncienneVersionOrSimpleByModificationCredit(e,t);"2"===i&&a.push(n.Personne),"2"===r&&a.push(n.Objet);var o=_.contains(["C","P","Z"],t)||"2"===i||"2"===r;return o&&!_.some(a,function(e){return e===n.Inconnu})&&a.push(n.Inconnu),a},e.getListeModificationCreditAncienneVersionOrSimpleByModificationCredit=function(e,t){switch(e){case"03":return[n.Quantieme];case"PR":return"P"===t?[n.Financier,n.ChangementProduit]:[n.Financier,n.ChangementProduit,n.Assurance];case"RE":return[n.AmenagementTemporaireEcheances];case"S":case"NS":return[n.ReportFinPret];case"01":case"13":return"P"===t?[n.Financier]:[n.Inconnu];default:return[n.Inconnu]}},e}();t.ModificationCreditHelper=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=function(){function n(){}return n.getAvenantForContractualiserAvenant=function(e,t,n,i,r){return void 0===i&&(i=null),void 0===r&&(r=null),2===n&&null!=r&&r.estAccordClient===!1&&r.estAccordEtablissement===!0&&null!=e.identifiantAgentDelegateur&&r.showBlocEditDecideurAccordEtablissement===!1?null:this.getAvenant(e,t,n,i,r)},n.getAvenant=function(t,n,r,a,o){void 0===a&&(a=null),void 0===o&&(o=null);var s=null!=a?a:{},u=null!=o?o:{};return{codeDevise:t.codeDevise,codeEtablissement:t.codeEtablissement,identifiantCredit:t.identifiantCredit,etatBrancheAccessoireEdgavenant:t.etatBrancheAccessoireEdgAvenant,identifiantDossierAvenantBale2:t.identifiantDossierAvenantBale2,dateDecisionEmission:2!==r&&4!==r||!i.isValued(u.dateDecision)?t.dateEditionOffre:i.format(u.dateDecision,e.Commun.Constantes.Format.DATE_REST),etatBrancheObjet:t.etatBrancheObjet,dureeApplicationElement:t.dureeApplicationElement,uniteDureeApplicElement:t.uniteDureeApplicElement,identifiantDossierCommercial:t.identifiantDossierCommercial,dateSignature:2===r&&i.isValued(u.dateSignature)?i.format(u.dateSignature,e.Commun.Constantes.Format.DATE_REST):t.dateSignature,etatCreditEdgAvenant:t.etatCreditEdgAvenant,libelleEtatSimulAvenant:t.libelleEtatSimulAvenant,dateAnnulationModification:6===r?s.dateAnnulation:t.dateAnnulationModification,etatBrancheFinanciere:t.etatBrancheFinanciere,montantFraisGestion:t.montantFraisGestion,libelleTypeModification:t.libelleTypeModification,cdOpeDemandeurNotationBale:t.cdOpeDemandeurNotationBale,etatBranchePayeur:t.etatBranchePayeur,etatBranchePersonne:t.etatBranchePersonne,codeEtatBrancheService:t.codeEtatBrancheService,identifiantAgentDelegateur:2===r||4===r?u.idAgent:t.identifiantAgentDelegateur,notationEngagementBale:t.notationEngagementBale,codeIndicSignrElect:t.codeIndicSignrElect,codeExistenceCreditTxRevisable:t.codeExistenceCreditTxRevisable,etatBrancheEcheancierVersement:t.etatBrancheEcheancierVersement,codeModifAvenantSimulation:t.codeModifAvenantSimulation,dateEffet:t.dateEffet,codeOrigineCreditDossier:t.codeOrigineCreditDossier,dateSaisieLEvenement:t.dateSaisieLEvenement,etatBrancheDonneesVersementEdg:t.etatBrancheDonneesVersementEdg,dateReceptionOffreClient:2===r&&i.isValued(u.dateReception)?i.format(u.dateReception,e.Commun.Constantes.Format.DATE_REST):t.dateReceptionOffreClient,numeroRelatif:t.numeroRelatif,identifiantProfilRenegociation:t.identifiantProfilRenegociation,libelleLongProfilRenegociation:t.libelleLongProfilRenegociation,etatBranchAccessoireSecurisatio:t.etatBrancheAccessSecurisation,etatBranchDonneesComplementairs:t.etatBrancheDonneesComplem,etatBrancheChoixPrescripteur:t.etatBrancheChoixPrescripteur,cdEtatAssurparRapportAvenant:t.cdEtatAssurparRapportAvenant,cdEtatGarantieParRapportAvenant:t.cdEtatGarantieParRapportAvenant,dateMinimumAcceptation:t.dateMinimumAcceptation,dateCreation:t.dateCreation,dateDerniereEdition:i.isValued(i.parse(t.dateDerniereEdition))?t.dateDerniereEdition:u.dateTraitement,dateFinValidite:t.dateFinValidite,dateLimiteRetractationOffre:t.dateLimiteRetractationOffre,indicateurBanalise:t.indicateurBanalise,codeSousTypeAvenantRecouvrement:t.codeSousTypeAvenantRecouvrement,cdTraitementModifEffectue:null,codeTypeAvenant:t.codeTypeAvenant,codeTypeModificationCredit:t.codeTypeModificationCredit,codeActionPourMiseAJour:this.getAvenantCodeActionPourMiseAJour(t,r,u.estAccordEtablissement,u.estAccordClient,s.typeRefus),codeModifAnnulationModification:this.getAvenantCodeModifAnnulationModification(t,r,s.typeRefus),codeConfirmationMaj:n}},n.getAvenantCodeActionPourMiseAJour=function(e,n,i,r,a){return 4===n?"AE":2===n?r?i?t.Constantes.Contractualisation.Avenant.codeAccordTotal:t.Constantes.Contractualisation.Avenant.codeClient:t.Constantes.Contractualisation.Avenant.codeEtablissement:6===n?a===t.Constantes.Contractualisation.Refus.choixRefusClient?t.Constantes.Contractualisation.MotifRefus.codeActionRefusClient:t.Constantes.Contractualisation.MotifRefus.codeActionRefusEtablissement:5===n?"EO":e.codeActionPourMiseAJour},n.getAvenantCodeModifAnnulationModification=function(e,n,r){if(6===n){var a=i.isValued(i.parse(e.dateSignature));return r===t.Constantes.Contractualisation.Refus.choixRefusClient?a?t.Constantes.Contractualisation.MotifRefus.codeRefusAvenantClientSignature:t.Constantes.Contractualisation.MotifRefus.codeRefusAvenantClientSansSignature:a?t.Constantes.Contractualisation.MotifRefus.codeRefusAvenantEtablissementSignature:t.Constantes.Contractualisation.MotifRefus.codeRefusAvenantEtablissementSansSignature}return e.codeModifAnnulationModification},n.getSimulationForContractualiserSimulation=function(n,i,r,a,o){void 0===a&&(a=null),void 0===o&&(o=null);var s=_.contains([1,5],r),u=e.Commun.Tools.Object.stringToExpressionCase(n.libelleEtatSimulAvenant),c=u===t.Constantes.Contractualisation.Avenant.libelleAttenteDecisionEtablissement||u===t.Constantes.Contractualisation.Avenant.libelleAttenteAccordEtablissement;return s&&!c?null:this.getSimulation(n,i,r,a,o)},n.getSimulation=function(t,n,r,a,o){void 0===a&&(a=null),void 0===o&&(o=null);var s=null!=a?a:{},u=null!=o?o:{},c=_.contains([1,0,5],r);return{codeModifAnnulationModification:this.getSimulationCodeModifAnnulationModification(t,r),codeActionPourMiseAJour:this.getSimulationCodeActionPourMiseAJour(t,r),cdEtatAssurparRapportAvenant:t.cdEtatAssurparRapportAvenant,etatBranchAccessoireSecurisatio:t.etatBrancheAccessSecurisation,codeConfirmationMaj:n,dateDecisionEmission:c?i.format(u.dateDecision,e.Commun.Constantes.Format.DATE_REST):t.dateEditionOffre,etatBranchDonnesComplementaires:t.etatBrancheDonneesComplem,etatBrancheObjet:t.etatBrancheObjet,dureeApplicationElement:t.dureeApplicationElement,uniteDureeApplicElement:t.uniteDureeApplicElement,identifiantDossierCommercial:t.identifiantDossierCommercial,dateSignature:c?i.format(u.dateSignature,e.Commun.Constantes.Format.DATE_REST):t.dateSignature,etatCreditEdgAvenant:t.etatCreditEdgAvenant,libelleEtatSimulAvenant:t.libelleEtatSimulAvenant,dateAnnulationModification:6===r?s.dateAnnulation:t.dateAnnulationModification,etatBrancheFinanciere:t.etatBrancheFinanciere,montantFraisGestion:t.montantFraisGestion,codeDevise:t.codeDevise,dateDerniereEdition:t.dateDerniereEdition,dateMinimumAcceptation:t.dateMinimumAcceptation,dateFinValidite:t.dateFinValidite,dateCreationDemandeRecevabilite:t.dateCreationDemandeRecevabilite,dateCreation:t.dateCreation,codeTypeAvenant:t.codeTypeAvenant,codeTypeModificationCredit:t.codeTypeModificationCredit,codeSousTypeAvenantRecouvrement:t.codeSousTypeAvenantRecouvrement,indicateurBanalise:t.indicateurBanalise,cdEtatGarantieParRapportAvenant:t.cdEtatGarantieParRapportAvenant,libelleTypeModification:t.libelleTypeModification,cdOpeDemandeurNotationBale:t.cdOpeDemandeurNotationBale,etatBranchePayeur:t.etatBranchePayeur,etatBranchePersonne:t.etatBranchePersonne,codeEtatBrancheService:t.codeEtatBrancheService,identifiantAgentDelegateur:c&&null!=u.idAgent?u.idAgent:t.identifiantAgentDelegateur,notationEngagementBale:t.notationEngagementBale,codeIndicSignrElect:t.codeIndicSignrElect,codeExistenceCreditTxRevisable:t.cdExistenceCreditTauxRevisable,etatBrancheEcheancierVersement:t.etatBrancheEcheancierVersement,codeModifAvenantSimulation:t.codeModifAvenantSimulation,dateEffet:t.dateEffet,codeOrigineCreditDossier:t.codeOrigineCreditDossier,dateSaisieLEvenement:t.dateSaisieLEvenement,etatBrancheDonneesVersementEdg:t.etatBrancheDonneesVersementEdg,dateReceptionOffreClient:c?i.format(u.dateReception,e.Commun.Constantes.Format.DATE_REST):t.dateReceptionOffreClient,numeroRelatif:t.numeroRelatif,numeroRelatifSimulationAvenant:t.numeroRelatifSimulationAvenant,identifiantProfilRenegociation:t.identifiantProfilRenegociation,libelleLongProfilRenegociation:t.libelleLongProfilRenegociation,codeEtablissement:t.codeEtablissement,identifiantCredit:t.identifiantCredit,etatBrancheAccessoireEdgavenant:t.etatBrancheAccessoireEdgAvenant,identifiantDossierAvenantBale2:t.identifiantDossierAvenantBale2}},n.getSimulationCodeModifAnnulationModification=function(e,n){return 6===n?t.Constantes.Contractualisation.MotifRefus.codeAnnulationSimulationEtablissement:1===n||0===n?null:e.codeModifAnnulationModification},n.getSimulationCodeActionPourMiseAJour=function(e,n){return 6===n?t.Constantes.Contractualisation.MotifRefus.codeActionRefusEtablissement:1===n?t.Constantes.Contractualisation.MotifRefus.codeActionAccordEtablissement:0===n?t.Constantes.Contractualisation.MotifRefus.codeActionAccordEntrepriseClient:5===n?"EO":e.codeActionPourMiseAJour},n.getPersonneSignataireAvenant=function(e,t,n,i){return{codeEtablissement:parseInt(e),identifiantCredit:t,numeroRelatif:n,identifiantPersonneEmprunteur:i.idPersonne,codeIndicPersAutorSignElect:i.acceptsElecSignature?"O":"N"}},n}();n.CaracteristiqueBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=e.Commun.Tools.Object,r=function(){function e(e,i,r){var a=this;this.libelle=_.first(e).libelleElement,this.libellePieco=this.geLibellePieco(n.findOrEmpty(i,function(t){return t.numeroRelatifBySegmentPrincipal===_.first(e).numeroRelatif})),this.listeInfosFlux=_.map(e,function(e){return a.getDocumentIndusInfosFlux(n.findOrEmpty(i,function(t){return t.numeroRelatifBySegmentPrincipal===e.numeroRelatif}))}),this.isChargeOnGde=t.DocumentPiecoBulderHelper.getIsChargeOnGde(n.firstOrEmpty(this.listeInfosFlux).type,r),this.filesInput=[]}return Object.defineProperty(e.prototype,"file",{get:function(){return _.first(this.filesInput)},enumerable:!0,configurable:!0}),e.prototype.supprimerDoc=function(){this.filesInput=[]},e.prototype.geLibellePieco=function(e){var t=a.getLibelleDocWithoutExtension(this.geLibellePiecoOrigin(e));return t+".pdf"},e.prototype.geLibellePiecoOrigin=function(e){if("BDD"!==e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara)return e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle.split("#")[1];var t=e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle.split("_");return t.splice(0,1),_.map(t,function(e){return i.stringToExpressionCase(e)}).join("")},e.prototype.getDocumentIndusInfosFlux=function(e){return{libelle:a.getLibelleDocWithoutExtension(this.getLibelleDocForFlux(e)),exemplaire:this.getExemplaire(e.codeThemeBySegmentPrincipal),type:this.getType(e),dataDocumentIndus:e}},e.prototype.getType=function(e){return"BDD"===e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara?e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle:e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle.split("#")[0]},e.prototype.getLibelleDocGenere=function(e){var t=e.split("#");return t.length>1?t[1]:t.length>0?t[0]:""},e.prototype.getLibelleDocForFlux=function(e){if(("IP"===e.codeThemeBySegmentPrincipal||"IE"===e.codeThemeBySegmentPrincipal)&&_.startsWith(e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle,"1D0280-01"))switch(e.codeThemeBySegmentPrincipal){case"IP":return"Offre_Preteur.doc";case"IE":return"Offre_Emprunteur.doc"}return this.getLibelleDoc(e)},e.prototype.getLibelleDoc=function(e){switch(e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara){case"AVT":return this.getLibelleDocGenere(e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle);case"BDD":return e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle;default:return""}},e.prototype.getExemplaire=function(e){switch(e){case"IT":return"0";case"IP":return"1";case"IE":return"2";case"IC":return"3";default:return""}},e}();t.DocumentIndus=r;var a=function(){function e(){}return e.getLibelleDocWithoutExtension=function(e){var t=e.split(".");return _.first(t)},e}();t.DocumentIndusHelper=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=function(){function t(){}return t.getResult=function(e,t,i,a){void 0===a&&(a=!1);var o=_.filter(e||[],function(e){return e.numeroRelatif===t.numeroRelatif}),s=r.getCodeTypeDocument(o),u=n.findOrEmpty(o,function(e){return 1===e.compteurInformationsGeneriques}).zoneBanaliseeAlphanumLongueur4,c=r.getValueByCode(s,u,!0);return{libelle:t.libelleElement,codeType:r.getCodeTypeDocument(o),referenceDoc:c,intituleDocument:r.getValueByCode(s,u,!1),checked:a?!0:this.getIsChecked(c,i)}},t.getIsChecked=function(t,n){return e.Commun.Tools.Object.isStringNotEmpty(t)?!r.getIsChargeOnGde(t,n):!1},t}();t.DocumentPiecoBulder=i;var r=function(){function i(){}return i.getCodeTypeDocument=function(e){return n.findOrEmpty(e,function(e){return 2===e.compteurInformationsGeneriques}).zoneBanaliseeAlphanumLongueur4},i.getValueByCode=function(e,n,i){if("BDD"===e)return n;if("AVT"===e){var r=n.split("#");if(2===r.length)return i?r[0]:t.DocumentIndusHelper.getLibelleDocWithoutExtension(r[1])}return""},i.getIsChargeOnGde=function(t,i){return 0!==i.length&&e.Commun.Tools.Object.isStringNotEmpty(t)?1===n.findOrEmpty(i,function(e){return e.type===t}).etat:!1},i}();t.DocumentPiecoBulderHelper=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=function(){function i(e,t,n,i){var r=this,a=null!=t?t.documents||[]:[];this.isEligible=!0,this.typeEditionPieco=e,this.isGDEPresent=null!=t,this.listeDocuments=this.getListeDocumentPIECO(n,a,i),this.listeDocumentsToEnvoi=this.getListeDocumentIndus(n,a,i),this.listeFlyers=_.map(n.documentsPdf||[],function(e){return r.getFlyer(e)})}return i.prototype.getFlyer=function(e){return{contenuDocument:e.contenuDocument,libelle:e.libelle}},i.prototype.getListeDocumentPIECO=function(n,i,r){if(!n)return[];var a=_.map(n.libelleRelatifDocuments,function(e){return t.DocumentPiecoBulder.getResult(n.infoGeneriques,e,i)}),o=_.filter(a,function(t){return"1D0280-04"===t.referenceDoc||"1D0280-03"===t.referenceDoc?!1:t.referenceDoc===e.Commun.Constantes.Editique.ReferenceDoc.addemdumAte&&r===!1?!1:!0});return _.uniq(o,function(e){return e.referenceDoc})},i.prototype.getListeDocumentIndus=function(n,i,r){var a=this,o=_.map(n.segmentPrincipals||[],function(e){return a.getDataDocumentIndus(e,n.infoGeneriques||[])}),s=_.groupBy(n.libelleRelatifDocuments,function(e){return e.libelleElement}),u=_.map(s,function(e){return new t.DocumentIndus(e,o,i)});return _.filter(u,function(t){return t.libellePieco===e.Commun.Constantes.Editique.NomFichier.addemdumAte&&r===!1?!1:!0})},i.prototype.getDataDocumentIndus=function(e,t){var i=n.findOrEmpty(t,function(t){return t.numeroRelatif===e.numeroRelatif&&1===t.compteurInformationsGeneriques}),r=n.findOrEmpty(t,function(t){return t.numeroRelatif===e.numeroRelatif&&2===t.compteurInformationsGeneriques});return{numeroRelatifBySegmentPrincipal:e.numeroRelatif,numeroOrdreClassementBySegmentPrincipal:e.numeroOrdreClassement,codeThemeBySegmentPrincipal:e.codeTheme,zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara:r.zoneBanaliseeAlphanumLongueur4,zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle:i.zoneBanaliseeAlphanumLongueur4}},i}();t.EditionIndustrielle=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=function(){function t(){}return t.getCodeAgentStatic=function(e){return"A"+e},t.getCreationDossier=function(t,i,r,a,o,s){return{libelle:i.idCredit+", avt "+i.numero.toString(),typeDossier:"1",caracteristiques:["LibAbregeCaisse=Caisse","LibEnveloppeLigne1=Enveloppe retour","LibEnveloppeLigne2= ","NbEnveloppesLigne1=1","NbEnveloppesLigne2=0","NbEnveloppesLigne3=0","Nom="+r.libelleTiers,"Prenom="],validationAuto:s?"False":"True",dateCreation:""+n.format(new Date,e.Commun.Constantes.Format.DATE_INDUS),agentCreateur:this.getCodeAgentStatic(o),documentImprimes:this.getListeDocumentImprime(t,a,i,r.typeLoi)}},t.getListeDocumentImprime=function(e,t,n,i){var r=this;return _.map(this.getListeSegments(e),function(e){return r.getDocumentImprime(e,t,n.idCredit,n.numero.toString(),n.listePersonneSignataire.length.toString(),i)})},t.getListeSegments=function(e){return 0===(e||[]).length?[]:this.getListeSegmentsByThemeSorted(e,"IT").concat(this.getListeSegmentsByThemeSorted(e,"IP")).concat(this.getListeSegmentsByThemeSorted(e,"IE")).concat(this.getListeSegmentsByThemeSorted(e,"IC"))},t.getListeSegmentsByThemeSorted=function(e,t){return _.sortBy(_.filter(e,function(e){return e.codeThemeBySegmentPrincipal===t}),function(e){return e.numeroOrdreClassementBySegmentPrincipal})},t.getDocumentImprime=function(t,i,r,a,o,s){var u=t.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle.split("#"),c="BDD"===t.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara?t.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle:u[0];switch(t.codeThemeBySegmentPrincipal){case"IT":case"IC":return{type:c,libelle:"BDD"===t.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara?this.getLibelleDocWithoutExtension(t.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle):this.getLibelleDocWithoutExtension(u[1]),exemplaire:"IT"===t.codeThemeBySegmentPrincipal?"0":"2",creation:""+n.format(new Date,e.Commun.Constantes.Format.DATE_INDUS),caracteristiques:["origine="+t.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara,"DocumentCommun=*"]};case"IP":case"IE":return{type:c,libelle:this.getLibelleDocWithoutExtension(this.getLibelleDocumentCree(t,u)),exemplaire:"IP"===t.codeThemeBySegmentPrincipal?"1":"2",creation:""+n.format(new Date,e.Commun.Constantes.Format.DATE_INDUS),caracteristiques:this.getCaracteristiquesDocuments(i,r,a,o,u,t.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara,t.codeThemeBySegmentPrincipal,s)};default:return null}},t.getLibelleDocumentCree=function(e,t){if("1D0280-01"===_.first(t))switch(e.codeThemeBySegmentPrincipal){case"IP":return"Offre_Preteur.doc";case"IE":return"Offre_Emprunteur.doc"}return"BDD"===e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueCara?e.zoneBanaliseeAlphanumLongueur4ByInfoGeneriqueLibelle:t[1]},t.getLibelleDocWithoutExtension=function(e){var t=e.split(".");return _.first(t)},t.getCaracteristiquesDocuments=function(e,t,n,i,r,a,o,s){return"1D0280-01"===r[0]||"1D0280-08"===r[0]?["origine="+a,"DocumentCommun=*","DataMatrixNeo="+this.getDataMatrixNeo(e,t,n,i,o,s)]:["origine="+a,"DocumentCommun=*"]},t.getDataMatrixNeo=function(e,t,n,i,r,a){var o="IP"===r?"P":"E",s="1D0280G";return e+";"+s+";"+t+";"+i+";"+o+";"+this.getTypeLoi(a)+";"+n},t.getTypeLoi=function(e){switch(e){case"1":return"C";case"2":return"I";case"":return"H";default:return"C"}},t}();t.ImpressionDossierBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=function(){function i(){}return i.getResult=function(e,t,n,i,r){var a=this.getListeGarantieResume(t,n,i),o=this.getListeAssuranceResume(r),s=this.getShowBlocJustificatifGarantie(a,e),u=this.getShowBlocJustificatifAssurance(o,e);return{showBlocJustificatif:s||u,showBlocJustificatifGarantie:s,listeGarantieResume:a,showBlocJustificatifAssurance:u,listeAssuranceResume:o}},i.getShowBlocJustificatifGarantie=function(t,i){var r=this;if(0===t.length)return!1;var a=n.findOrEmpty(i,function(e){return e.codeNatureTraitement===r.habilitationJustificatif});return a&&parseInt(a.codeHabilitation)>=e.Commun.Enum.HabilitationNiveau.MiseAJour},i.getListeGarantieResume=function(e,n,i){return _.map(n,function(n){return t.GarantieResumeBuilder.getGarantieResume(n,_.find(i||[],function(e){return e.identifiantGarantie===n.identifiantGarantie}),e)})},i.getShowBlocJustificatifAssurance=function(e,t){return!1},i.getListeAssuranceResume=function(e){return _.map(e,function(e){return t.AssuranceResumeBuilder.getAssuranceResume(e)})},i.habilitationJustificatif="KA",i}();t.DataJustificatifBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function n(n,i,r,a,o){this._processSedIsLaunched=n,this._isAvenant=i.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Avenant,this.isAgentHabilite=i.agentHasHabilitationSed,this.isEtablissementEligible=i.isEtablissementEligibleSed,this.isEmprunteurHabilite=r,this.isDossierPiecoEligible=a,this.isAvenantAbandonedElecSignature=t.SignatureElectroniqueHelper.getAvenantAbandonedElecSignature(i),this.isAvenantWithGarantiesEligibles=o,this.isRefusEmprunteur=_.some(i.listePersonneSignataire,function(e){return!e.acceptsElecSignature}),this.isAvenantWithTraceEligibilite=t.SignatureElectroniqueHelper.getListeHistoFiltree(i.listeHisto,!0).length>0}return n.prototype.getIsEligible=function(){if(this._processSedIsLaunched)return!0;var e=this.isAgentHabilite&&this.isEtablissementEligible&&this.isEmprunteurHabilite;return this._isAvenant?e&&this.isDossierPiecoEligible&&this.isAvenantWithGarantiesEligibles&&!this.isAvenantAbandonedElecSignature:e},n.prototype.getMessageEligibilite=function(){return this.getIsEligible()?"Oui":this.isAvenantAbandonedElecSignature?"Oui":this.isAgentHabilite===!1||this.isEtablissementEligible===!1?"Non (Agent/Etablissement)":this.isEmprunteurHabilite===!1&&this.isDossierPiecoEligible===!1||this.isEmprunteurHabilite===!1&&this.isAvenantWithGarantiesEligibles===!1?"Non (Emprunteur + Dossier)":this.isEmprunteurHabilite===!1?"Non (Emprunteur)":this.isDossierPiecoEligible===!1||this.isAvenantWithGarantiesEligibles===!1?"Non (Dossier)":"Non"},n}();t.EligibiliteSignatureElectronique=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Business.Constantes.SignatureElectronique.EvenementHisto,r="SIGEL",a=function(){function n(){}return n.getListeHistoByElement=function(e,t,n){var r=this;return _.filter(e,function(e){var a=(e.codeEvenementDeclencheur||"").length>0?e.codeEvenementDeclencheur[0]:"";return t?e.numeroGeneriqueDossierCredit===n.numeroRelatif&&("J"===a||e.codeEvenementDeclencheur===i.tracerEligibilite):e.numeroGeneriqueDossierCredit===r.getIdentifiantHistoSimulation(n)&&"B"===a})},n.getListeHistoFiltree=function(e,t){return _.filter(e,function(e){return t?e.codeEvenementDeclencheur===i.tracerEligibilite:e.codeEvenementDeclencheur!==i.tracerEligibilite})},n.getCommentaireEvenement=function(e,t,n){var i=this,r=_.find(e,function(e){var r=i.getEvenementHisto(n,t);return e.codeEvenementDeclencheur===r&&e.codeOrigineHistoriqueEvenement===i.getCodeOrigineHistoriqueEvenementSignatureElectronique(t)});return null!=r?r.libelleCommentaireEvenement:null},n.getEvenementHisto=function(e,n){switch(e){case t.Enum.EvenementHistoSED.CreationActeIDN:return n?i.CreationActeIDN.avenant:i.CreationActeIDN.simulation;case t.Enum.EvenementHistoSED.ValidationHierarchie:return n?i.ValidationHierarchie.avenant:i.ValidationHierarchie.simulation;case t.Enum.EvenementHistoSED.RemiseOffre:return n?i.RemiseOffre.avenant:i.RemiseOffre.simulation;case t.Enum.EvenementHistoSED.AccuseReceptionOffre:return n?i.AccuseReceptionOffre.avenant:i.AccuseReceptionOffre.simulation;case t.Enum.EvenementHistoSED.RefusHierarchiqueRetourPapier:return n?i.RefusHierarchiqueRetourPapier.avenant:i.RefusHierarchiqueRetourPapier.simulation;case t.Enum.EvenementHistoSED.ActivationEspaceSignature:return n?i.ActivationEspaceSignature.avenant:i.ActivationEspaceSignature.simulation;case t.Enum.EvenementHistoSED.SignatureOffreEmprunteur:return n?i.SignatureOffreEmprunteur.avenant:i.SignatureOffreEmprunteur.simulation;case t.Enum.EvenementHistoSED.Conclue:return n?i.Conclue.avenant:i.Conclue.simulation;case t.Enum.EvenementHistoSED.AbandonSignatureClient:return n?i.AbandonSignatureClient.avenant:i.AbandonSignatureClient.simulation;case t.Enum.EvenementHistoSED.PersonnePeutSigner:return n?i.PersonnePeutSigner.avenant:i.PersonnePeutSigner.simulation;case t.Enum.EvenementHistoSED.AnnulerCaduqueIDN:return n?i.AnnulerCaduqueIDN.avenant:i.AnnulerCaduqueIDN.simulation;case t.Enum.EvenementHistoSED.AnomalieTraitementAutomatique:return n?i.AnomalieTraitementAutomatique.avenant:i.AnomalieTraitementAutomatique.simulation;case t.Enum.EvenementHistoSED.TracerEligibilite:return i.tracerEligibilite;default:return""}},n.getCodeOrigineHistoriqueEvenementSignatureElectronique=function(e){return r},n.getIdentifiantHistoSimulation=function(e){return e.numeroRelatifSimulationAvenant+100*e.numeroRelatif},n.hasEvenement=function(e,t,n){var i=this,r=_.find(e,function(e){var r=i.getEvenementHisto(n,t);return e.codeEvenementDeclencheur===r&&e.codeOrigineHistoriqueEvenement===i.getCodeOrigineHistoriqueEvenementSignatureElectronique(t)});return angular.isUndefined(r)},n.getLibelleDateEvenement=function(e,t,n){var i=this,r=_.find(e,function(e){var r=i.getEvenementHisto(n,t);return e.codeEvenementDeclencheur===r&&e.codeOrigineHistoriqueEvenement===i.getCodeOrigineHistoriqueEvenementSignatureElectronique(t)});return r?r.libelleTimestamp:null},n.getAvenantAbandonedElecSignature=function(i){if(i.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Simulation)return!1;var a=_.find(i.listeHisto,function(e){var i=n.getEvenementHisto(t.Enum.EvenementHistoSED.RefusHierarchiqueRetourPapier,!0);return e.codeEvenementDeclencheur===i&&e.codeOrigineHistoriqueEvenement===r});return null!=a},n.isEditionSedActive=function(e){return null!=e.eligibiliteSed&&e.eligibiliteSed.getIsEligible()&&!e.eligibiliteSed.isRefusEmprunteur},n}();n.SignatureElectroniqueHelper=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.Object,a=function(){function a(t,r,a){var o=t.eligibiliteSed.getIsEligible(),s=t.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Avenant,u=n.SignatureElectroniqueHelper.getListeHistoFiltree(t.listeHisto,!1),c=this.getLibelleBtnVoirDocument(o,t,u);this.dataEligibilite=t.eligibiliteSed,this.listePersonneSignataire=s?this.getListePersonne(r,t.listePersonneSignataire):[],this.showBtnGererEmprunteur=s&&!i.isValued(t.dateDerniereEdition),this.labelBtnGererEmprunteur=this.getLabelBtnGererEmprunteur(o,s),this.classBtnGererEmprunteur=this.getClassBtnGererEmprunteur(o,s),this.listeDocuments=a,this.showBtnGenerer=this.getShowBtnGenerer(o,t,this.listePersonneSignataire),this.showBtnAnnuler=this.getShowBtnAnnuler(o,t),this.showBtnVoirDocument=null!=c,this.libelleBtnVoirDocument=c,
this.listeRefus=o?this.getMotifsAnnulation(t.listeRefus):[],this.isMajSynchroKo=null===t.dateSignature&&_.some(u,function(e){return"JQ"===e.codeEvenementDeclencheur}),this.dateReceptionElectronique=t.dateReceptionOffreClient,this.dateSignatureElectronique=t.dateSignature,this.isMajSynchroKo&&(this.dateReceptionElectronique=i.parse((_.find(u,function(e){return"JG"===e.codeEvenementDeclencheur})||{libelleCommentaireEvenement:"KOKO-KO-KO"}).libelleCommentaireEvenement.substr(0,10)),this.dateSignatureElectronique=i.parse((_.find(u,function(e){return"JL"===e.codeEvenementDeclencheur})||{libelleCommentaireEvenement:"KO/KO/KOKO"}).libelleCommentaireEvenement.substr(0,10),"DD/MM/YYYY"))}return Object.defineProperty(a.prototype,"showLineActions",{get:function(){return this.showBtnGenerer||this.showBtnAnnuler||this.showBtnVoirDocument||this.showBtnGererEmprunteur},enumerable:!0,configurable:!0}),a.prototype.getLibelleBtnVoirDocument=function(t,n,i){return t&&n.processSedIsLaunched?n.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Avenant?_.some(i,function(e){return"JD"===e.codeEvenementDeclencheur})?"Visualiser les documents envoyés":"Gérer les documents générés":_.some(i,function(e){return"BD"===e.codeEvenementDeclencheur})?"Consulter les documents du dossier":"Gérer les documents générés":null},a.prototype.getShowBtnGenerer=function(t,n,r){return t&&n.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Avenant&&!n.processSedIsLaunched&&!_.some(r,function(e){return!e.acceptsElecSignature})&&i.isValued(n.dateDerniereEdition)},a.prototype.getShowBtnAnnuler=function(t,n){return t?n.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Avenant?n.processSedIsLaunched&&!i.isValued(n.dateSignature)&&(n.listeDossierIdn||[]).length>0:"D"===(n.simulation||{}).codeIndicSignrElect:!1},a.prototype.getListePersonne=function(e,t){return _.map(e,function(e){var n=_.find(t,function(t){return t.idPersonne===e.idPersonne.toString()}),i=null!=n?n.acceptsElecSignature:!0,r={idPersonne:e.idPersonne,acceptsElecSignature:i,etatAcceptsElecSignature:i?"Oui":"Non",intitulePersonne:e.libelleLong};return r})},a.prototype.getMotifsAnnulation=function(e){var n={codeEntite:t.Constantes.Contractualisation.MotifRefus.codeIhmAutre,typeCodeMotif:t.Constantes.Contractualisation.MotifRefus.codeIhmAutre,libelleLongMotif:"Autre motif"};return _.map(_.filter(e,function(e){return"BH02"===e.codeEntite&&_.startsWith(e.typeCodeMotif,"M")}),function(e){var t={codeEntite:e.codeEntite,typeCodeMotif:e.typeCodeMotif,libelleLongMotif:r.stringToExpressionCase(e.libelleLongMotif)};return t}).concat(n)},a.prototype.getLabelBtnGererEmprunteur=function(e,t){return t?e?"Gérer l'emprunteur":"Gérer l'emprunteur et la signature électronique":null},a.prototype.getClassBtnGererEmprunteur=function(e,t){return t?e?"col-lg-3 col-md-4 col-sm-4":"col-lg-4 col-md-6 col-sm-12":null},a}();n.SignatureElectronique=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=function(){function i(n,i,r,a,o,s,u,c,l,d,m,h,p,f,A,P,v,g,C,E){void 0===v&&(v=[]),void 0===g&&(g=[]),void 0===C&&(C=[]),void 0===E&&(E=[]),this._listeGarant=p,this._listeParamModaliteMotifEstimation=u,this._listeMotifsEstimation=c,this._listeTypologiesInstruction=l,this._descriptionObjetFinance=s,this._tocObjetFinanceOrigine=a,this._dateTraitement=n,this._dateEffet=i,this._creditCurrent=o,this._devise=e.Commun.ToolsFunctionals.Credit.getSymboleDevise(o.codeDevise),this._codeTypeAcces=r,this._listeVersementAttendusGarantie=C,this._isVersementAttenduAjoutable=f,this.idIhmNouvelleGarantie=d,this.isAvenantPeriodicite=A,this.isPhaseEnCoursPeriodiciteScinde=P,null!=m?(this.etatManipulation=t.Enum.EtatManipulation.Unchanged,this._garantieAppliquee=h,this.typeDeSurete=this.getLibelleSurete(this._garantieAppliquee.codeTypeSurete),this.isGarantieSureteReelleAutre="A"===this._garantieAppliquee.codeTypeSurete||"R"===this._garantieAppliquee.codeTypeSurete,this.isGarantieSuretePersonnelle="P"===this._garantieAppliquee.codeTypeSurete,this.isFormeContratGarantieEditable="P"===this._garantieAppliquee.acteAuthentiqueSurGarantie,this.idGarantie=m.identifiantGarantie,this.titre="Garantie n°"+m.identifiantGarantie,this.isCreationFirstEdition=!1,this.statut="A"===m.codeAncienneteAssuranceGarantie?e.Business.Constantes.Contractualisation.Statut.enGestion:e.Business.Constantes.Contractualisation.Statut.enElaboration,this.formeContratGarantie=this.getFormeContratGarantie(m.acteAuthentiqueSurGarantie),this.setDataFrais(h,E),this.codeAncienneteAssuranceGarantie=m.codeAncienneteAssuranceGarantie,this.codeTypeAcces=m.codeTypeAcces,this.redacteurActe=this.getRedacteurActe(m),this.garantieSureteReelleAutre=this.getGarantieSureteReelleAutre(h,m,_.find(v,function(e){return e.identifiantCredit===m.identifiantGarantie}),s,u,c,l,a,p,n,r,this._creditCurrent.montantActualiseCredit,C,this._isVersementAttenduAjoutable),this.garantieSuretePersonnelle=this.getGarantieSuretePersonnelle(m,_.find(g,function(e){return e.identifiantGarantie===m.identifiantGarantie}),h,p,_.filter(E,function(e){return e.identifiantGarantie===m.identifiantGarantie}),this._creditCurrent,this._devise,this._dateEffet,this.isAvenantPeriodicite,this.isPhaseEnCoursPeriodiciteScinde)):(this.etatManipulation=t.Enum.EtatManipulation.IsCreation,this.statut="En élaboration",this.idGarantie=d.toString(),this.titre="Nouvelle garantie n°"+d.toString(),this.isCreationFirstEdition=!0,this.codeAncienneteAssuranceGarantie="N")}return Object.defineProperty(i.prototype,"libelleHelpMontantFrais",{get:function(){return this._libelleHelpMontantFrais},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"montantAffecteAuCredit",{get:function(){return this.isGarantieSureteReelleAutre?this.garantieSureteReelleAutre.montantGarantie:this.garantieSuretePersonnelle.showMontantGarantie?this.garantieSuretePersonnelle.montantGarantie:this._creditCurrent.montantActualiseCredit},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"garantieAppliquee",{get:function(){return this._garantieAppliquee},set:function(e){(angular.isUndefined(e)||null===e||e!==this._garantieAppliquee)&&this.resetDataGarantie(),null!=e&&e!==this._garantieAppliquee&&this.setGarantieAppliquee(e),this._garantieAppliquee=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"listeAccessoire",{get:function(){return this.isGarantieSuretePersonnelle&&null!=this.garantieSuretePersonnelle.listeAccessoire?this.garantieSuretePersonnelle.listeAccessoire:[]},set:function(e){this.isGarantieSuretePersonnelle&&(this.garantieSuretePersonnelle.listeAccessoire=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"identifiant",{get:function(){return this.idGarantie},enumerable:!0,configurable:!0}),i.prototype.validerData=function(){if(this.isCreationFirstEdition&&(this.isCreationFirstEdition=!1),this.etatManipulation===t.Enum.EtatManipulation.Unchanged&&(this.etatManipulation=t.Enum.EtatManipulation.IsModified),this.isGarantieSureteReelleAutre&&null!=this.garantieSureteReelleAutre.definitionObjetGarantie&&(this.garantieSureteReelleAutre.definitionObjetGarantie.reportDataAdresseComposantToDataAdresse(),1===this.garantieSureteReelleAutre.objetPorteGarantie)){var e=this.idGarantie.length>=6?this.idGarantie.substr(0,6):this.idGarantie.toString();this.garantieSureteReelleAutre.definitionObjetGarantie.identifiantObjet="A"+e}this.isGarantieSuretePersonnelle&&_.each(this.garantieSuretePersonnelle.listeAccessoire,function(e){e.etatManipulationAccessoire===t.Enum.EtatManipulation.Unchanged&&e.setAccessoireToModified()})},i.prototype.isValid=function(){return this.isGarantieSuretePersonnelle?this.garantieSuretePersonnelle.isValid():this.isGarantieSureteReelleAutre?this.garantieSureteReelleAutre.isValid():!0},i.prototype.getLibelleSurete=function(e){switch(e){case"A":case"R":return"Sûreté réelle ou autre";case"P":return"Sûreté personnelle";default:return e}},i.prototype.getFormeContratGarantie=function(e){switch(e){case"O":case"P":return 1;case"N":return 0}},i.prototype.getRedacteurActe=function(e){return null!=e.redacteurActe?{idPersonne:e.redacteurActe,libelleTiers:e.libelleTiers}:null},i.prototype.getGarantieSureteReelleAutre=function(e,t,i,r,a,o,s,u,c,l,d,m,h,p){return void 0===h&&(h=[]),"P"===e.codeTypeSurete?null:new n.GarantieSureteReelle(e,t,i,r,a,o,s,u,c,l,d,m,h,p)},i.prototype.getGarantieSuretePersonnelle=function(e,t,i,r,a,o,s,u,c,l){return"P"!==i.codeTypeSurete?null:new n.GarantieSuretePersonnelle(e,t,i,r,a,o,s,u,c,l)},i.prototype.resetDataGarantie=function(){this.isGarantieSureteReelleAutre=!1,this.garantieSureteReelleAutre=null,this.isGarantieSuretePersonnelle=!1,this.garantieSureteReelleAutre=null,this.formeContratGarantie=null,this.isFormeContratGarantieEditable=!1},i.prototype.setGarantieAppliquee=function(e){this.typeDeSurete=this.getLibelleSurete(e.codeTypeSurete),this.isGarantieSureteReelleAutre="A"===e.codeTypeSurete||"R"===e.codeTypeSurete,this.isGarantieSuretePersonnelle="P"===e.codeTypeSurete,this.formeContratGarantie=this.getFormeContratGarantie(e.acteAuthentiqueSurGarantie),this.isFormeContratGarantieEditable="P"===e.acteAuthentiqueSurGarantie,this.setDataFrais(e),this.garantieSureteReelleAutre=this.getGarantieSureteReelleAutre(e,null,null,this._descriptionObjetFinance,this._listeParamModaliteMotifEstimation,this._listeMotifsEstimation,this._listeTypologiesInstruction,this._tocObjetFinanceOrigine,this._listeGarant,this._dateTraitement,this._codeTypeAcces,this._creditCurrent.montantActualiseCredit,this._listeVersementAttendusGarantie,this._isVersementAttenduAjoutable),this.garantieSuretePersonnelle=this.getGarantieSuretePersonnelle(null,null,e,this._listeGarant,[],this._creditCurrent,this._devise,this._dateEffet,this.isAvenantPeriodicite,this.isPhaseEnCoursPeriodiciteScinde)},i.prototype.setDataFrais=function(e,t){if(void 0===t&&(t=[]),this.showMontantFrais=null!=e.frais,this.showMontantFrais){var n=_.find(t,function(t){return e.frais.codeTypeAccessoire===t.codeTypeAccessoire});this.montantFrais=null!=n?n.montantElement:0,this.setLibelleHelpMontantFrais(e.frais),this.isFraisRequired="O"===e.frais.codeAccessoireObligatoire}},i.prototype.setLibelleHelpMontantFrais=function(e){this._libelleHelpMontantFrais="["+e.montantMinimumPlageAccessoire+".."+e.montantMaximumPlageAccessoire+"]"},i}();n.Garantie=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=function(){function i(){}return i.getGarantieResume=function(t,n,i){return{idGarantie:t.identifiantGarantie,libelleDescription:this.getLibelleDescription(t,i),statut:"A"===t.codeAncienneteAssuranceGarantie?e.Business.Constantes.Contractualisation.Statut.enGestion:e.Business.Constantes.Contractualisation.Statut.enElaboration,isDataCompleteLoaded:!1,idCredit:t.identifiantCredit,codeEtablissement:t.codeEtablissement,referenceExterne:null!=n?n.numeroExterneGarantie:null,listeJustificatif:[],listeNatureJustificatifGarantie:[],codeEtat:null,libelleEtat:null,montant:null,devise:null,dateCloture:null,dateAnnulation:null,idConvention:null,numExterne:null,idGarant:null,libelleGarant:null,dateDebutEffet:null,dateFinEffet:null,compteurMiseAJour:null}},i.getLibelleDescription=function(t,n){var i=e.Commun.Tools.List.findOrEmpty(n,function(e){return e.codeNatureGarantie===t.codeNatureGarantie});return"Garantie "+t.identifiantGarantie+" - "+i.libelleLongNatureGarantie},i.getGarantieResumeCompleted=function(i,r,a){var o=angular.copy(i),s=this.getListeNature(r.listeNatureJustif);return o.listeNatureJustificatifGarantie=s,o.listeJustificatif=_.map(r.listeJustificatif,function(e){return new t.JustificatifGarantie(e,s,a)}),o.montant=r.montantGarantie,o.codeEtat=r.codeEtatGarantie,o.libelleEtat=r.libelleEtatGarantie,o.devise=e.Commun.ToolsFunctionals.Credit.getSymboleDevise(r.codeDevise),o.dateCloture=n.parse(r.dateClotureGarantie),o.dateAnnulation=n.parse(r.dateAnnulationGarantie),o.idConvention=r.identifiantConvention,o.numExterne=r.numeroExterneConvention,o.idGarant=r.identifiantGarant,o.libelleGarant=r.denominationClient,o.dateDebutEffet=n.parse(r.datePriseEffetGarantie),o.dateFinEffet=n.parse(r.dateFinValiditeGarantie),o.isDataCompleteLoaded=!0,o.compteurMiseAJour=r.compteurMiseAJour,o},i.getListeNature=function(e){return _.sortByOrder(_.map(e,function(e){return t.NatureJustificatifGarantieBuilder.getResult(e)}),function(e){return e.libelle},!0)},i}();t.GarantieResumeBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.List,a=function(){function e(e,n,a){void 0===a&&(a=null),null!=e?(this.idJustificatif=e.identifiantJustificatif,this.couleurTuile="3"===e.codeNiveauJustification&&e.codeStatutJustificatif===t.Enum.JustificatifStatut.attendu.key?"couleur-rouge":"couleur-sombre",this.nature=r.findOrEmpty(n,function(t){return t.code===e.codeNatureJustificatif}),this.statut=_.find(t.Enum.JustificatifStatut.list(),function(t){return t.key===e.codeStatutJustificatif}),this.dateDebutEffet=i.parse(e.dateDebutValidite),this.dateFinEffet=i.parse(e.dateFinValidite),this.dateReception=i.parse(e.dateDerniereMAJStatutElement),this.dateLimiteReceptionJustificatif=i.parse(e.dateLimiteReceptionJustificatif),this.montantJustificatifInitial=e.montantJustificatif,this.montantJustificatif=e.montantVersementAutoriseJustif,this.referenceExterne=e.referenceExterneJustificatif,this.showBtnValider=this.showBtnSupprimer=this.getIsActionAvailable(e,a),this.codeEntite=e.codeEntite,this.codeEntiteTableRefJustificatif=e.codeEntiteTableRefJustificatif,this.codeJustificatifObligatoire=e.codeJustificatifObligatoire,this.indicateurBanalise=e.indicateurBanalise,this.etatManipulation=t.Enum.EtatManipulation.IsModified):(this.idJustificatif=null,this.couleurTuile="couleur-sombre",this.nature=n.length>0?_.first(n):null,this.statut=null,this.dateDebutEffet=null,this.dateFinEffet=null,this.dateReception=null,this.dateLimiteReceptionJustificatif=null,this.montantJustificatifInitial=null,this.montantJustificatif=null,this.referenceExterne=null,this.showBtnValider=!0,this.showBtnSupprimer=!1,this.codeEntite=null,this.codeEntiteTableRefJustificatif=null,this.codeJustificatifObligatoire=null,this.indicateurBanalise=null,this.etatManipulation=t.Enum.EtatManipulation.IsCreation),this.setChampVisibles(this.nature)}return e.prototype.majByNature=function(e){this.setChampVisibles(e)},e.prototype.setChampVisibles=function(e){null!=e&&(this.showDateDebutEffet="P"!==e.codeCategorie,this.showMontantJustificatif="A"!==e.codeCategorie&&"P"!==e.codeCategorie,this.showReferenceExterne="A"===e.codeCategorie)},e.prototype.getIsActionAvailable=function(e,n){return e.codeStatutJustificatif===t.Enum.JustificatifStatut.attendu.key||e.codeStatutJustificatif===t.Enum.JustificatifStatut.recu.key&&i.isEquals(e.dateCreation,n)},e}();n.JustificatifGarantie=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getResult=function(e){return{code:e.codeNatureJustificatif,libelle:e.libelleNatureJustificatif,codeClasse:e.codeClasseJustificatif,libelleClasse:e.libelleCodeClasse,codeSousClasse:e.sousClasseJustificatif,libelleSousClasse:e.libelleSousClasse,codeCategorie:e.codeCategorieJustificatif,libelleCategorie:e.libelleCategorieJustificatif,codeNiveauJustificatif:e.codeNiveauJustificatif,libelleNiveauJustificatif:n.getLibelleNiveauJustification(e.codeNiveauJustificatif)}},e}();e.NatureJustificatifGarantieBuilder=t;var n=function(){function e(){}return e.getLibelleNiveauJustification=function(e){switch(e){case"1":return"Préliminaire";case"2":return"Préalable";case"3":return"Suspensif";case"4":return"Résolutoire";default:return null}},e}();e.NatureJustificatifGarantieHelper=n}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.prototype.getResult=function(e,t){var n=angular.copy(e);return n.dureeAjusteeCreditSuiteRecalcul=t.dureeAjusteeCreditSuiteRecalcul,n.dureeCredit=t.dureeCredit,n.dateEffet=t.dateEffet,n.dateEcheance=t.dateEcheance,n.dateFinCredit=t.dateFinCredit,n.dateMiseRecouvrementZero=t.dateMiseRecouvrementZero,n.numeroQuantiemeDateEcheance=t.numeroQuantiemeDateEcheance,n.margeAppliquerSurTauxNominal=t.margeAppliquerSurTauxNominal,n.montantCapitalRestantSurCredit=t.montantCapitalRestantSurCredit,n},e}();e.BuilderCreditCaraFinanAdapater=t;var n=function(){function t(t,n,i){var r=this;this.codeEtablissement=t.codeEtablissement,this.identifiantCredit=t.identifiantCredit,this.codeRoleCreditAvenant=t.codeRoleCreditAvenant,this.identifiantProduit=t.identifiantProduit,this.libelleLongProduit=t.libelleLongProduit,this.libelleTiers=t.libelleTiers,this.dateEffet=t.dateEffet,this.montantEcheance=t.montantEcheance,this.montantOrigineCredit=t.montantOrigineCredit,this.codeDevise=t.codeDevise,this.dureeCredit=t.dureeCredit,this.uniteDureeCredit=t.uniteDureeCredit,this.dateEcheance=t.dateEcheance,this.tauxNominalCredit=t.tauxNominalCredit,this.dateMiseRecouvrementZero=t.dateMiseRecouvrementZero,this.codeModeExpressionTaux=t.codeModeExpressionTaux,this.codeTauxCreditDirecteur=t.codeTauxCreditDirecteur,this.codeCristallisationTauxInteret=t.codeCristallisationTauxInteret,this.codeActionPourMiseAJour=t.codeActionPourMiseAJour,this.montantEcheanceMER=t.montantEcheanceMER,this.montantFraisGestion=t.montantFraisGestion,this.montantArrieresIncorporesCrd=t.montantArrieresIncorporesCrd,this.codeTraitementFinVersement=t.codeTraitementFinVersement,this.numeroQuantiemeDateEcheance=t.numeroQuantiemeDateEcheance,this.codeIndiceNominal=t.codeIndiceNominal,this.margeAppliquerSurTauxNominal=t.margeAppliquerSurTauxNominal,this.montantCapitalRestantSurCredit=t.montantCapitalRestantSurCredit,this.codeTypeRecalculTA=t.codeTypeRecalculTA,this.dateCreation=t.dateCreation,this.dateFinPrefinancementReelle=t.dateFinPrefinancementReelle,this.codeIntegrationFraisCrd=t.codeIntegrationFraisCrd,this.identifiantProfilRenegociation=t.identifiantProfilRenegociation,this.codeTypeAvenant=t.codeTypeAvenant,this.codeTypeModificationCredit=t.codeTypeModificationCredit,this.numeroRelatif=t.numeroRelatif,this.numeroRelatifSimulationAvenant=t.numeroRelatifSimulationAvenant,this.numModaliteRemboursemntAnticipe=t.numeroModaliteRembAnticipe,this.tauxIndemniteRA=t.tauxIndemniteRA,this.tauxInteretPrefinancement=t.tauxInteretPrefinancement,this.codeCreditSecurisable=t.codeCreditSecurisable,this.dateFinCredit=t.dateFinCredit,this.codePresenceRevisionSurCredit=t.codePresenceRevisionSurCredit,this.montantIntcompsurCR=t.montantIntcompsurCR,this.cdTypeArrieresIncorporeCrd=t.cdTypeArrieresIncorporeCrd,this.typeLoi=t.typeLoi,this.nbMaxiPeriodeAllongPourRevision=t.nbMaxiPeriodeAllongPourRevision,this.nbMaxiPerallsortieCptCourant=t.nbMaxiPerallsortieCptCourant,this.nbMaxiPerallongPourModulation=t.nbMaxiPerallongPourModulation,this.mtCapitalRestantSurCredit=t.mtCapitalRestantSurCredit,this.codeCategorieEmprunteur=t.codeCategorieEmprunteur,this.typeObjetFinanceGaranti=t.typeObjetFinanceGaranti,this.montantActualiseCredit=t.montantActualiseCredit,this.montantGlobalGarantiCredit=t.montantGlobalGarantiCredit,this.codeSousTypeAvenantRecouvrement=t.codeSousTypeAvenantRecouvrement,this.codeNatureFinancement=t.codeNatureFinancement,this.codeTypeMarche=t.codeTypeMarche,this.dateSignature=t.dateSignature,this.dateEffetInitialeLAvenant=t.dateEffetInitialeLAvenant,this.dateDecisionEmission=t.dateDecisionEmission,this.dureeAjusteeCreditSuiteRecalcul=t.dureeAjusteeCreditSuiteRecalcul,this.dateSaisieLEvenement=t.dateSaisieLEvenement,this.dateEmission=t.dateEmission,this.etatBrancheAccessoireEdgAvenant=t.etatBrancheAccessoireEdgAvenant,this.delaiMinimumAcceptation=t.delaiMinimumAcceptation,this.delaiRetractation=t.delaiRetractation,this.commentaireProduits=t.commentaireProduits,this.montantMAfondsDemandees=t.montantMAfondsDemandees,this.codeEcheancierVersemcontractuel=t.codeEcheancierVersemcontractuel,this.codeTypePretCombine=t.codeTypePretCombine,this.codePresenceServiceObjet=t.codePresenceServiceObjet,this.existenceAccessoireBonMajTaux=t.existenceAccessoireBonMajTaux,this.cumulBonificationsMajorations=t.cumulDesBonifsMajorations,this.codeIndicateurIntegrationCrd=t.codeIndicateurIntegrationCrd,this.tauxInteretsRetardImpaye=t.tauxInteretsRetardImpaye,this.phases=_.map(t.phases,function(t){return new e.PhaseCaraFinanAdapater(t)}),this.echeancesReportees=_.map(t.echeancesReportees,function(e){return r.getEcheanceReportee(e)}),this.accessoires=_.map(t.accessoires,function(e){return r.getAccessoire(e)}),this.numeroPhase=i?2:this.getNumeroPhase(t.phases),this.codeTypePhase=i?"AM":n.codeTypePhase,this.dureeResteAFinancer=n.dureeResteAFinancer,this.tauxInteretPalier=n.tauxInteretPalier,this.dureeResiduelleAjusteeCredit=n.dureeResiduelleAjusteeCredit,this.numeroEcheance=n.numeroEcheance,this.montantImpayeRecouvrer=n.montantImpayeRecouvrer,this.mtARecouvrerIndemnretardImpaye=n.mtARecouvrerIndemnretardImpaye,this.mntMiseDispoFondsEffectuees=n.mntMiseDispoFondsEffectuees,this.codeGelDette=n.codeGelDette,this.montantGelCreance=n.montantGelCreance,this.numeroPeriodeRevision=n.numeroPeriodeRevision,this.mntInteretsOrdreMiseRecouvrmnt=n.mntInteretsOrdreMiseRecouvrmnt,this.amenagementEchsurPretCombine=n.amenagementEchsurPretCombine,this.amenagementEchexistantSurCredit=n.amenagementEchexistantSurCredit,this.amenagechenCoursADateEffet=n.amenagechenCoursADateEffet,this.codeCalculInteretsReportes=n.codeCalculInteretsReportes,this.montantProchaineEcheance=n.montantProchaineEcheance,this.montantEcheanceMER1=n.montantEcheanceMER1}return t.prototype.getNumeroPhase=function(e){var t=_.filter(e,function(e){return"O"===e.elementModifiableParAvenant});return _.min(_.map(t,function(e){return e.numeroPhase}))},t.prototype.getEcheanceReportee=function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,dateDebutChomage:e.dateDebutChomage,numeroPlanSecurisation:e.numeroPlanSecurisation,numeroPeriodeFractionneme:e.numeroPeriodeFractionneme,nombreEcheancesAccessReport:e.nombreEcheancesAccessReport,codeTypeModificationCredit:e.codeTypeModificationCredit}},t.prototype.getAccessoire=function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantAssurance:e.identifiantAssurance,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,codeTypeAccessoire:e.codeTypeAccessoire,codeTypePhase:e.codeTypePhase,noRelatifPhaseTypePhaseProduit:e.numRelatifPhaseTypePhaseProduit,libelleTypeAccessoire:e.libelleTypeAccessoire,dureeApplicationElement:e.dureeApplicationElement,periodiciteApplicationElement:e.periodiciteApplicationElement,numeroRegleApplicationElement:e.numeroRegleApplicationElement,montantElement:e.montantElement,codeTypeAssietteCalculElement:e.codeTypeAssietteCalculElement,mtPlafondTrancheCalculAccess:e.mtPlafondTrancheCalculAccess,tauxElement:e.tauxElement,mtPlafondTrancheCalculAccess1:e.mtPlafondTrancheCalculAccess1,tauxElement1:e.tauxElement1,mtPlafondTrancheCalculAccess2:e.mtPlafondTrancheCalculAccess2,tauxElement2:e.tauxElement2,mtPlafondTrancheCalculAccess3:e.mtPlafondTrancheCalculAccess3,tauxElement3:e.tauxElement3,mtPlafondTrancheCalculAccess4:e.mtPlafondTrancheCalculAccess4,tauxElement4:e.tauxElement4,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,numeroRelatif1:e.numeroRelatif1,codeModeCalculTaux:e.codeModeCalculTaux,codeActionEcranListe:e.codeActionEcranListe,codeModeCalculAccessoire:e.codeModeCalculAccessoire,uniteDureeApplicElement:e.uniteDureeApplicElement,numRegleApplicationAccessoire:e.numeroRegleApplicationAccess,regleAppelAccessoireAperiodique:e.regleAppelAccessoireAperiodique,codeModeCalculAccessoire1:e.codeModeCalculAccessoire1,numeroRegleCalculElement:e.numeroRegleCalculElement,quotiteCouvertureCredit:e.quotiteCouvertureCredit,montantMinimumAccessoireCalcule:e.montantMinimumAccessoireCalcule,montantMaximumAccessoireCalcule:e.montantMaximumAccessoireCalcule,mtMiniAccessPourRecouvrement:e.mtMiniAccessPourRecouvrement,codeAccessDansCalculTEG:e.codeAccessCalculTxEffectifGlob,codeAppelLecheance:e.codeAppelLecheance,indicateurAccessoireObligatoire:e.indicateurAccessoireObligatoire,indicateurAccessoireValide:e.indicateurAccessoireValide,indicateurAccessoireAnnuleAv:e.indicateurAccessoireAnnuleAv,indicAccessoireCreeParAvenant:e.indicAccessoireCreeParAvenant,nbrEcheancesAccessoiresReport:e.nombreEcheancesAccessReport,codeNatureAccessoire:e.codeNatureAccessoire,identifiantConvention:e.identifiantConvention,identifiantProduit:e.identifiantProduit,libelleLongConvention:e.libelleLongConvention,tauxConseilleAccessoire:e.tauxConseilleAccessoire,montantConseilleAccessoire:e.montantConseilleAccessoire,tauxConseilleAccessoire1:e.tauxConseilleAccessoire1,tauxConseilleAccessoire2:e.tauxConseilleAccessoire2,tauxConseilleAccessoire3:e.tauxConseilleAccessoire3,tauxConseilleAccessoire4:e.tauxConseilleAccessoire4,montantMinimumPlageAccessoire:e.montantMinimumPlageAccessoire,montantMaximumPlageAccessoire:e.montantMaximumPlageAccessoire,mtPasMontantAccessoire:e.mtPasMontantAccessoire,tauxMinimumAccessoire:e.tauxMinimumAccessoire,tauxMaximumAccessoire:e.tauxMaximumAccessoire,tauxMinimumAccessoire1:e.tauxMinimumAccessoire1,tauxMaximumAccessoire1:e.tauxMaximumAccessoire1,tauxMinimumAccessoire2:e.tauxMinimumAccessoire2,tauxMaximumAccessoire2:e.tauxMaximumAccessoire2,tauxMinimumAccessoire3:e.tauxMinimumAccessoire3,tauxMaximumAccessoire3:e.tauxMaximumAccessoire3,tauxMinimumAccessoire4:e.tauxMinimumAccessoire4,tauxMaximumAccessoire4:e.tauxMaximumAccessoire4,libelleTypeAssieteCalcul:e.libelleTypeAssieteCalcul,dateDebutApplicationElement:e.dateDebutApplicationElement,dateFinApplicationElement:e.dateFinApplicationElement,dateAppelAccessoire:e.dateAppelAccessoire,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroRelatif2:e.numeroRelatif2,libelleStandard:e.libelleStandard,regleDateDebutApplicatAccess:e.regleDateDebutApplicatAccess,regleEvenementDeclench1erAppel:e.regleEvenementDech1erAppelCata,regleDateDebutAppliAccCatalogue:e.regleDateDebutAppliAccCatalogue,regleEvenementDech1erAppelCata:e.regleEvenementDech1erAppelCata,periodiciteApplicationAccess:e.periodiciteApplicationAccess,numeroTranche:e.numeroTranche,modeComptaRecouvrAccessoire:e.modeComptaRecouvrAccessoire,montantAccessoireAEtaler:e.montantAccessoireAEtaler,dureeApplicationAccessoire:e.dureeApplicationAccessoire,uniteDureeApplicAccess:e.uniteDureeApplicAccess,identifiantService:e.identifiantService,identifiantTiers:e.identifiantTiers,codeSousTypeAccessoireCompl:e.codeSousTypeAccessoireCompl,codeTypeApplicationAccessoire:e.codeTypeApplicationAccessoire,codeTypologieAccessoire:e.codeTypologieAccessoire,codeIndicateurDerogationBornes:e.codeIndicateurDerogationBornes,codeIndicateurBornesDerogees:e.codeIndicateurBornesDerogees,nbJoursAnneeNumerateur:e.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:e.nbJoursAnneeDenominateur}},t}();e.CreditCaraFinanAdapter=n}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.cdModifCaracteristfinancieres=e.cdModifCaracteristfinancieres,this.codeIndice=e.codeIndice,this.codeOccurabsorbeePhasePalier=e.codeOccurAbsorbeePhasePalier,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.elementModifiableParAvenant=e.elementModifiableParAvenant,this.identifiantCredit=e.identifiantCredit,this.margeAppliquerSurTaux=e.margeAppliquerSurTaux,this.noPhaseCreditProchaineRevision=e.noPhaseCreditProchaineRevision,this.numeroDerniereEcheancePalier=e.numeroDerniereEcheancePalier,this.numeroPhase=e.numeroPhase,this.numeroPremiereEcheancePalier=e.numeroPremiereEcheancePalier,this.numeroRelatif=e.numeroRelatif,this.numeroRelatif1=e.numeroRelatif1,this.numeroRelatif2=e.numeroRelatif2,this.numeroRelatifPalierProduit=e.numeroRelatifPalierProduit,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.periodiciteApplicProgreEcheance=e.periodiciteApplicProgreEcheance,this.tauxInteretPalier=e.tauxInteretPalier,this.tauxProgressionDesEcheances=e.tauxProgressionDesEcheances,this.typeRemboursement=e.typeRemboursement,this.uniteDureePhase=e.uniteDureePhase}return e}();e.PalierCaraFinanAdapater=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function t(t){var n=this;this.codeEtablissement=t.codeEtablissement,this.identifiantCredit=t.identifiantCredit,this.codeRoleCreditAvenant=t.codeRoleCreditAvenant,this.numeroPhase=t.numeroPhase,this.codeTypePhase=t.codeTypePhase,this.noRelatifPhaseTypePhaseProduit=t.numRelatifPhaseTypePhaseProduit,this.libelleLongTypePhase=t.libelleLongTypePhase,this.dureeInitialePhaseCredit=t.dureeInitialePhaseCredit,this.dureeResiduelleCredit=t.dureeResiduelleCredit,this.uniteDureePhase=t.uniteDureePhase,this.tauxNominalPhase=t.tauxNominalPhase,this.codeTauxDesPaliersCalcules=t.codeTauxDesPaliersCalcules,this.tauxMoyenPhaseCredit=t.tauxMoyenPhaseCredit,this.modeCalculAmortissement=t.modeCalculAmortissement,this.quotiteCapitalAmortir=t.quotiteCapitalAmortir,this.periodiciteMERamortissement=t.periodiciteMERamortissement,this.periodiciteCalculInterets=t.periodiciteCalculInterets,this.dateFinPrefinancementInitiale=t.dateFinPrefinancementInitiale,this.codeIndiceNominal=t.codeIndiceNominal,this.margeAppliquerSurTaux=t.margeAppliquerSurTaux,this.typeIndexationTaux=t.typeIndexationTaux,this.numeroRelatif=t.numeroRelatif,this.numeroRelatifSimulationAvenant=t.numeroRelatifSimulationAvenant,this.periodiciteMiseRecouvrInterets=t.periodiciteMERInterets,this.numeroJeuIndicesRevision=t.numeroJeuIndicesRevision,this.noPhaseCreditProchaineRevision=t.noPhaseCreditProchaineRevision,this.elementModifiableParAvenant=t.elementModifiableParAvenant,this.modeCapitRecouvInterets=t.modeCapitRecouvInterets,this.cdModifCaracteristfinancieres=t.cdModifCaracteristfinancieres,this.codeOccurabsorbeePhasePalier=t.codeOccurAbsorbeePhasePalier,this.partieFixeUnTauxComposite=t.partieFixeUnTauxComposite,this.nbJoursDansAnneeDenominateur=t.nbJoursDansAnneeDenominateur,this.nbJoursDansAnneeNumerateur=t.nbJoursDansAnneeNumerateur,this.calculInteretsEnJoursReels=t.calculInteretsEnJoursReels,this.prelevementEnFinPhase=t.prelevementEnFinPhase,this.codeTypeEcretage=t.codeTypeEcretage,this.paliersTauxInterets=_.map(t.paliers,function(t){return new e.PalierCaraFinanAdapater(t)}),this.parametresRevisionTaux=_.map(t.parametresRevisionTaux,function(e){return n.getParametreRevisionTaux(e)}),this.paliersTauxAmortissement=_.map(t.paliersTauxAmortissement,function(e){return n.getPalierTauxAmortissement(e)}),this.pretsCombines=t.pretsCombines}return t.prototype.getParametreRevisionTaux=function(e){
return{codeEtablissement:e.codeEtablissement,codeRoleCreditAvenant:e.codeRoleCreditAvenant,elementModifiableParAvenant:e.elementModifiableParAvenant,identifiantCredit:e.identifiantCredit,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeEcheanceRecalculeeRevision:e.codeEcheanceRecalculeeRevision,codeTypePhase:e.codeTypePhase,codeTypeRoleIndice:e.codeTypeRoleIndice,codeUnitePeriodeDebutRevision:e.codeUnitePeriodeDebutRevision,dureePeriodeRevision:e.dureePeriodeRevision,identifiantLoiRevision:e.identifiantLoiRevision,mdExpressionValeurUtilisIndice:e.modeExpressValeurUtilisIndice,modeExpressionButoirTauxBaisse:e.modeExpressionButoirTauxBaisse,modeExpressionButoirTauxHausse:e.modeExpressionButoirTauxHausse,nbrPeriodePrDeterminerDbtPeriod:e.nbPeriodePourDeterDebutPeriode,nmbrEcheanceAvtRecalculMontant:e.nbEcheanceAvantRecalculMontant,noRelatifPhaseTypePhaseProduit:e.numRelatifPhaseTypePhaseProduit,numeroJeuIndicesRevision:e.numeroJeuIndicesRevision,numeroPeriodeRevision:e.numeroPeriodeRevision,partieFixeUnTauxComposite:e.partieFixeUnTauxComposite,typeIndexationTaux:e.typeIndexationTaux,uniteDureePeriodeRevision:e.uniteDureePeriodeRevision,valeurCoeffParametreRevision:e.valeurCoeffParametreRevision,valeurCoeffParametreRevision1:e.valeurCoeffParametreRevision1,evenemntDeclencheurDebutPeriode:e.evntDeclencheurDebutPeriode}},t.prototype.getPalierTauxAmortissement=function(e){return{cdIndexTauxProgressionAmort:e.cdIndexationTauxProgressAmort,codeEtablissement:e.codeEtablissement,codeOccurabsorbeePhasePalier:e.codeOccurAbsorbeePhasePalier,codeRoleCreditAvenant:e.codeRoleCreditAvenant,elementModifiableParAvenant:e.elementModifiableParAvenant,identifiantCredit:e.identifiantCredit,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroDerniereEcheancePalier:e.numeroDerniereEcheancePalier,numeroPhase:e.numeroPhase,numeroPremiereEcheancePalier:e.numeroPremiereEcheancePalier,numeroRelatif:e.numeroRelatif,numeroRelatif1:e.numeroRelatif1,numeroRelatif2:e.numeroRelatif2,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,tauxProgressionAmortissement:e.tauxProgressionAmortissement,uniteDureePhase:e.uniteDureePhase}},t}();e.PhaseCaraFinanAdapater=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=e.Commun.ToolsFunctionals.Periodicite,a=e.Commun.Tools.List,o=function(){function o(){}return o.getListeAccessoiresAvenant=function(i,r,a){var o=this,s=r.dataFraisAvenant.fraisAvenant,u=a.dateEffet,c=[];if(r.isAvenantAte){c=_.map(r.listeAccessoiresAte,function(e){return o.getAccessoireAvenant(i,e,u,r.codeTypeAcces,a,r.isAvenantReportFinPret)});var l=this.getNouveauNumeroAccessoire(c);_.each(c,function(e){"C"===e.codeActionEcranListe&&(e.numeroRelatif=l,e.numeroRelatif2=l++)})}else c=_.map(this.getListeAccessoireProduitWithoutFraisAvenant(r.listeAcccessoires,s),function(e){return o.getAccessoireAvenant(i,e,u,r.codeTypeAcces,a,r.isAvenantReportFinPret)});if(null!=s&&c.unshift(this.getAccessoireAvenant(i,s.accessoireInitial,u,r.codeTypeAcces,a,r.isAvenantReportFinPret,s)),null!=r.reportFinPret){_.each(r.reportFinPret.accessoires,function(e){c.unshift(o.getAccessoireAvenant(i,e,u,r.codeTypeAcces,a,r.isAvenantReportFinPret,null,r.reportFinPret))});var d=_.findIndex(c,function(e){return"21"===e.codeNatureAccessoire}),m=_.findIndex(c,function(e){return"22"===e.codeNatureAccessoire});if(d>m){var h=angular.copy(c[d]),p=angular.copy(c[m]);c.splice(m,1,h),c.splice(d,1,p);var f=angular.copy(d);d=m,m=f}var A=this.getScissionAccessoireAvenant(c[d],a);if(A.length>=1){var P=angular.copy(c[m]);c.splice(m,1),c.splice(d,1);var v=moment(P.dateDebutApplicationElement);_.forEach(A,function(t){c.splice(d++,0,t);var n=moment(t.dateFinApplicationElement).diff(moment(t.dateDebutApplicationElement),"days")-1,i=angular.copy(P);i.numeroPhase=t.numeroPhase,i.dateDebutApplicationElement=v.format(e.Commun.Constantes.Format.DATE_REST),i.dateAppelAccessoire=i.dateDebutApplicationElement,v=o.quantiemeDuMois(v.add(n,"days"),a.numeroQuantiemeDateEcheance),i.dateFinApplicationElement=v.format(e.Commun.Constantes.Format.DATE_REST),i.nombreEcheancesAccessReport=t.nombreEcheancesAccessReport,c.splice(m,0,i),m+=2})}}if(0!==r.listeAccessoiresAnnexes.length){var g=this.getNouveauNumeroAccessoireAnnexe(r.listeAccessoiresAnnexes);r.listeAccessoiresAnnexes=r.listeAccessoiresAnnexes.sort(function(e){return e.numeroPhase}),_.each(r.listeAccessoiresAnnexes,function(s){if(s.etatManipulationAccessoire!==t.Enum.EtatManipulation.Unchanged&&!_.any(c,function(t){return e.Business.Modeles.AccessoireAnnexe.isAccessoiresAnnexesEqualsCaracteristiqueFinanAccessoire(s,t)})){var l=o.getGererAccessoiresAnnexesFutureAvenant(i,r.codeTypeAcces,s,r.listeAccessoiresAnnexes,a,u,g,r.listePhaseStock);_.each(l,function(e){if(!r.isAvenantAte&&"C"===e.codeActionEcranListe&&e.numeroPhase>a.numeroPhase&&n.AccessoireAnnexe.isExistAccessoiresAnnexesSurPhase(r.listeAccessoiresAnnexes,e)){var t=n.AccessoireAnnexe.FindAccessoireAnnexeSurPhase(r.listeAccessoiresAnnexes,e);null!=t&&(e.codeActionEcranListe="M",e.indicateurAccessoireValide="2",e.numeroRelatif=t.numeroRelatif)}c.unshift(e)}),s.etatManipulationAccessoire===t.Enum.EtatManipulation.IsCreation&&g++}})}if(r.isAvecChangementProduit)for(var C=0,E=c;C<E.length;C++){var b=E[C];b.codeRoleCreditAvenant=i.codeRoleCreditAvenant}return c.filter(function(e){return null!=e.codeActionEcranListe})},o.getListeAccessoireProduitWithoutFraisAvenant=function(e,t){return null!=t?_.filter(e,function(e){return e.codeTypeAccessoire!==t.accessoireInitial.codeTypeAccessoire||e.codeTypePhase!==t.accessoireInitial.codeTypePhase||e.identifiantConvention!==t.accessoireInitial.identifiantConvention||e.numRelatifPhaseTypePhaseProduit!==t.accessoireInitial.noRelatifPhaseTypePhaseProduit}):e},o.calculDatesReglesAccessoire=function(e,t,n,i,r,a){var o={regleDateDebutApplication:null,regleEvenementPremierRecouvrement:null,dateAppelAccessoire:null,dateDebutApplicationElement:null,dateFinApplicationElement:null};if(0===n)return o.dateAppelAccessoire=this.getDateAppelAccessoireAperiodique(e,i),o;var s=r?r:a;return o.regleDateDebutApplication=this.getRegleDateDebutApplicationAccessoirePeriodique(e,t,s),o.regleEvenementPremierRecouvrement=this.getRegleEvenementPremierRecouvrementAccessoirePeriodique(e,t),o.dateDebutApplicationElement=this.getDateDebutApplicationElementAccessoirePeriodique(e,t,s),o.regleEvenementPremierRecouvrement===this.regleD12DateFixe&&(o.dateAppelAccessoire=this.getDatePremireEchApresDateEffet(e,t)),o},o.getRegleDateDebutApplicationAccessoirePeriodique=function(e,t,n){return t.numeroPhase!==e.numeroPhase?this.regleD11DateDebutPhase:n===this.regleD11DateDebutPhase||n===this.regleD06Date1erVersement&&0!==e.mntMiseDispoFondsEffectuees||n===this.regleD04DateMer0&&i.isBefore(e.dateMiseRecouvrementZero,e.dateEffet)?this.regleD12DateFixe:n},o.getRegleEvenementPremierRecouvrementAccessoirePeriodique=function(e,t){return t.numeroPhase!==e.numeroPhase?this.regleD11DateDebutPhase:this.regleD12DateFixe},o.getDateDebutApplicationElementAccessoirePeriodique=function(e,t,n){return t.numeroPhase!==e.numeroPhase?null:n===this.regleD01DateEffet||n===this.regleD03DateSignatureContratAssurance||n===this.regleD12DateFixe?e.dateEffet:n===this.regleD02DateEmissionOffre?e.dateCreation:null},o.getDatePremireEchApresDateEffet=function(t,n){var r=moment(t.dateEcheance);if(r.isAfter(t.dateEffet))return t.dateEcheance;if(i.isBefore(t.dateEffet,t.dateMiseRecouvrementZero)){for(;!r.isAfter(t.dateEffet);)r=this.getEcheanceSuivante(r,n.periodiciteCalculInterets,t.numeroQuantiemeDateEcheance);return r.format(e.Commun.Constantes.Format.DATE_REST)}for(var a=moment(t.dateMiseRecouvrementZero),o=0,s=t.phases;o<s.length;o++){var u=s[o];if("PF"!==u.codeTypePhase){var c=a;if(a=this.getEcheanceSuivante(c,u.periodiciteCalculInterets,t.numeroQuantiemeDateEcheance,u.dureeInitialePhaseCredit),a.isAfter(t.dateEffet)){for(r=c;!r.isAfter(moment(t.dateEffet));)r=this.getEcheanceSuivante(r,u.periodiciteCalculInterets,t.numeroQuantiemeDateEcheance);return r.format(e.Commun.Constantes.Format.DATE_REST)}}}return console.error("getDatePremireEchApresDateEffet : Pas réussi à trouver la phase!",{phaseEnCours:n,credit:t}),r.format(e.Commun.Constantes.Format.DATE_REST)},o.getEcheanceSuivante=function(e,t,n,i){return void 0===i&&(i=1),this.quantiemeDuMois(moment(e).add(i,r.getPeriodiciteForAdd(t)),n)},o.quantiemeDuMois=function(e,t){if(5>t&&parseInt(e.format("D"))>27)return e.add(1,"month").set("date",t);e.set("date",t);var n=parseInt(e.format("D"));return n===t?e:e.set("date",1).add(-1,"days")},o.getDateAppelAccessoireAperiodique=function(e,t){return t===this.regleB10AppelDateEffet||t===this.regleB13IntegreCrdDateEffetAvenant?e.dateEffet:t===this.regleB11AppelDateSignature?e.dateCreation:null},o.getAccessoireAnnexeAvenantFutur=function(t,i,r,a,o){var s=n.AccessoireAnnexeAdapaterProduitBuilder.getResult(a),u=i===e.Commun.Enum.CodeTypeAcces.Duplication;return s.codeEtablissement=t.codeEtablissement,s.identifiantCredit=t.idCredit,s.identifiantProduit=r.identifiantProduit,s.codeRoleCreditAvenant=t.codeRoleCreditAvenant,s.numeroRelatifSimulationAvenant=t.numeroRelatifSimulationAvenant,s.numeroRelatif1=t.numeroRelatif,s.codeActionEcranListe=this.getCodeActionEcranListeAccessoireAnnexe(a.etatManipulationAccessoire),s.indicateurAccessoireObligatoire=a.indicateurAccessoireObligatoire,s.indicateurAccessoireValide=this.getIndicateurAccessoireValide(s.indicAccessoireCreeParAvenant,s.indicateurAccessoireAnnuleAv,s.indicateurAccessoireValide,u),s.indicateurAccessoireAnnuleAv=this.getIndicateurAccessoireAnnuleAv(s.indicAccessoireCreeParAvenant,s.indicateurAccessoireAnnuleAv,u),s.indicAccessoireCreeParAvenant=this.getIndicAccessoireCreeParAvenant(s.indicAccessoireCreeParAvenant,s.indicateurAccessoireAnnuleAv,u),s.dateDebutApplicationElement=this.getDateDebutApplicationElement(a,o),s.dateFinApplicationElement=this.getDateFinApplicationElement(a,o,s,r.numeroPhase),s.dateAppelAccessoire="C"===s.codeActionEcranListe?o:a.accessoireParConvention.dateDebutApplication,s.codeAppelLecheance=a.codeAppelLecheance,s.identifiantTiers=a.identifiantTiers,s},o.getDateDebutApplicationElement=function(e,n){return e.isPeriodique?e.etatManipulationAccessoire===t.Enum.EtatManipulation.IsCreation?n:e.accessoireParConvention.dateDebutApplication:null},o.getDateFinApplicationElement=function(e,n,i,r){return e.isPeriodique?e.etatManipulationAccessoire===t.Enum.EtatManipulation.ToDelete&&r===e.numeroPhase?n:null!=i.dateFinApplicationElement?i.dateFinApplicationElement:e.accessoireParConvention.dateFinApplication:null},o.getGererAccessoiresAnnexesFutureAvenant=function(e,t,n,i,r,a,o,s){var u=this.getAccessoireAnnexeAvenantFutur(e,t,r,n,a);return" "===this.getCodeActionEcranListeAccessoireAnnexe(n.etatManipulationAccessoire)?[u]:"C"===u.codeActionEcranListe?this.getCreerAccessoiresAnnexesFutureAvenant(u,o,s):this.getModifierAccessoiresAnnexesFutureAvenant(u,r,this.getAccessoiresAnnexesFuturesAvenant(e,t,r,n,a,i))},o.getNouveauNumeroAccessoireAnnexe=function(e){return _.max(_.map(e,function(e){return e.numeroRelatif}))+1},o.getNouveauNumeroAccessoire=function(e){return _.max(_.map(e,function(e){return e.numeroRelatif}))+1},o.getCreerAccessoiresAnnexesFutureAvenant=function(e,t,n){if("C"===e.codeActionEcranListe){if(e.numeroRelatif=t,"A01"===e.numeroRegleApplicationElement||"A04"===e.numeroRegleApplicationElement)return[e];for(var i=[],r=0,a=n;r<a.length;r++){var o=a[r];if("O"===o.elementModifiableParAvenant&&o.numeroPhase>=e.numeroPhase){var s=angular.copy(e);s.numeroPhase=o.numeroPhase,i.push(s)}}return i.sort(function(e,t){return e.numeroPhase-t.numeroPhase})}return console.error("getCreerAccessoiresAnnexesFutureAvenant le codeActionEcranListe de l'accessoire vaut "+e.codeActionEcranListe+' au lieu de "C"'),[e]},o.getModifierAccessoiresAnnexesFutureAvenant=function(e,t,n){e.dateFinApplicationElement===t.dateEffet&&(e.codeActionEcranListe="A");var i=[e];return _.forEach(n,function(t){t.codeActionEcranListe=e.codeActionEcranListe,"A"!==e.codeActionEcranListe&&(t.dateFinApplicationElement=e.dateFinApplicationElement),t.montantElement=e.montantElement,t.tauxElement=e.tauxElement,i.push(t)}),i.sort(function(e,t){return e.numeroPhase-t.numeroPhase})},o.getAccessoiresAnnexesFuturesAvenant=function(n,i,r,a,o,s){var u=this;return a.etatManipulationAccessoire===t.Enum.EtatManipulation.IsCreation?[]:_.map(_.filter(s,function(t){return e.Business.Modeles.AccessoireAnnexe.isAccessoiresAnnexesEquals(t,a)&&t.numeroPhase>a.numeroPhase}),function(e){return u.getAccessoireAnnexeAvenantFutur(n,i,r,e,o)})},o.getScissionAccessoireAvenant=function(t,n){var i=moment(n.dateMiseRecouvrementZero);if("22"===t.codeNatureAccessoire||null===t.dateFinApplicationElement||null===n.dateMiseRecouvrementZero||i.isAfter(t.dateFinApplicationElement))return[t];var r=[];n.phases=n.phases.sort(function(e,t){return e.numeroPhase-t.numeroPhase});for(var a=0,o=n.phases;a<o.length;a++){var s=o[a];if("PF"!==s.codeTypePhase){var u=i;if(i=this.getEcheanceSuivante(u,s.periodiciteCalculInterets,n.numeroQuantiemeDateEcheance,s.dureeInitialePhaseCredit),!i.isBefore(t.dateFinApplicationElement)){if(s.numeroPhase===t.numeroPhase)return[t];var c=angular.copy(t);return c.numeroPhase=s.numeroPhase,c.dateDebutApplicationElement=u.format(e.Commun.Constantes.Format.DATE_REST),c.dateAppelAccessoire=c.dateDebutApplicationElement,c.nombreEcheancesAccessReport=i.diff(u,s.periodiciteCalculInterets)+1,r.push(c),r}if(s.numeroPhase===t.numeroPhase){var c=angular.copy(t);c.dateFinApplicationElement=i.format(e.Commun.Constantes.Format.DATE_REST),c.nombreEcheancesAccessReport=i.diff(u,s.periodiciteCalculInterets)+1,r.push(c)}else if(s.numeroPhase>t.numeroPhase){var c=angular.copy(t);c.numeroPhase=s.numeroPhase,c.dateDebutApplicationElement=u.format(e.Commun.Constantes.Format.DATE_REST),c.dateAppelAccessoire=c.dateDebutApplicationElement,c.dateFinApplicationElement=i.format(e.Commun.Constantes.Format.DATE_REST),c.nombreEcheancesAccessReport=i.diff(u,s.periodiciteCalculInterets)+1,r.push(c)}}}return i.isBefore(t.dateFinApplicationElement)?"9999-12-31"!==t.dateFinApplicationElement&&console.error("getScissionAccessoireAvenant : l'accessoire se termine après la fin du crédit",{"Date Fin Accessoire":t.dateFinApplicationElement,"Date Fin Derniere Phase":i.format(e.Commun.Constantes.Format.DATE_REST),"Date Fin Credit":n.dateFinCredit,accessoire:t}):console.error("getScissionAccessoireAvenant : Pas réussi à découper l'accessoire!",{accessoire:t,credit:n}),r.length>0?r:[t]},o.getAccessoireAvenant=function(t,n,a,o,s,u,c,l){var d=null!=c?c.indicateurAccessoireValide:n.indicateurAccessoireValide,m=null!=c?c.indicAccessoireCreeParAvenant:n.indicAccessoireCreeParAvenant,h=null!=c?c.indicateurAccessoireAnnuleAv:n.indicateurAccessoireAnnuleAv,p=o===e.Commun.Enum.CodeTypeAcces.Duplication,f="21"===n.codeNatureAccessoire||"22"===n.codeNatureAccessoire,A=s?_.find(s.phases,function(e){return s.numeroPhase===e.numeroPhase}):null;if(null!=l&&u&&f){var P=r.getPeriodiciteForAdd(A.periodiciteCalculInterets),v=void 0;if("21"===n.codeNatureAccessoire){var g=this.calculDatesReglesAccessoire(s,A,A.numeroPhase,n.regleAppelAccessoireAperiodique,n.regleDateDebutApplicatAccess,n.regleDateDebutAppliAccCatalogue);l.dateDebutApplication=moment(g.dateAppelAccessoire).toDate(),v=l.dateDebutApplication}"22"===n.codeNatureAccessoire&&(v=this.getRealDateDebutApplication22(s.dateFinCredit,this.findLastAccessoire22CreditOrigine(s),P,s.numeroQuantiemeDateEcheance));var C=this.getDateFin(v,l.echeancesReportees,P,s.numeroQuantiemeDateEcheance);return{codeEtablissement:t.codeEtablissement,identifiantCredit:t.idCredit,codeRoleCreditAvenant:t.codeRoleCreditAvenant,identifiantAssurance:n.identifiantAssurance,numeroPhase:A.numeroPhase,numeroRelatif:n.numeroRelatif,codeTypeAccessoire:n.codeTypeAccessoire,codeTypePhase:A.codeTypePhase,libelleTypeAccessoire:n.libelleTypeAccessoire,dureeApplicationElement:0,periodiciteApplicationElement:this.getPeriodiciteApplicationElement(n,A),numeroRegleApplicationElement:n.numeroRegleApplicationElement,montantElement:0,codeTypeAssietteCalculElement:n.codeTypeAssietteCalculElement,tauxElement:"22"===n.codeNatureAccessoire&&l.isSecurisationOpen?0:this.getTauxAccessoire(n,c,l),tauxElement1:n.tauxElement1,tauxElement2:n.tauxElement2,tauxElement3:n.tauxElement3,tauxElement4:n.tauxElement4,numeroRelatifSimulationAvenant:t.numeroRelatifSimulationAvenant,numeroRelatif1:t.numeroRelatif,codeModeCalculTaux:n.codeModeCalculTaux,codeActionEcranListe:"C",codeModeCalculAccessoire:n.codeModeCalculAccessoire,uniteDureeApplicElement:n.uniteDureeApplicElement,regleAppelAccessoireAperiodique:n.regleAppelAccessoireAperiodique,codeModeCalculAccessoire1:n.codeModeCalculAccessoire1,numeroRegleCalculElement:n.numeroRegleCalculElement,quotiteCouvertureCredit:n.quotiteCouvertureCredit,montantMinimumAccessoireCalcule:n.montantMinimumAccessoireCalcule,montantMaximumAccessoireCalcule:n.montantMaximumAccessoireCalcule,codeAppelLecheance:n.codeAppelLecheance,indicateurAccessoireObligatoire:n.indicateurAccessoireObligatoire,indicateurAccessoireValide:"0",indicateurAccessoireAnnuleAv:"N",indicAccessoireCreeParAvenant:"N",codeNatureAccessoire:n.codeNatureAccessoire,identifiantConvention:n.identifiantConvention,identifiantProduit:n.identifiantProduit,libelleLongConvention:n.libelleLongConvention,tauxConseilleAccessoire:n.tauxConseilleAccessoire,montantConseilleAccessoire:n.montantConseilleAccessoire,tauxConseilleAccessoire1:n.tauxConseilleAccessoire1,tauxConseilleAccessoire2:n.tauxConseilleAccessoire2,tauxConseilleAccessoire3:n.tauxConseilleAccessoire3,tauxConseilleAccessoire4:n.tauxConseilleAccessoire4,montantMinimumPlageAccessoire:n.montantMinimumPlageAccessoire,montantMaximumPlageAccessoire:n.montantMaximumPlageAccessoire,mtPasMontantAccessoire:n.mtPasMontantAccessoire,tauxMinimumAccessoire:n.tauxMinimumAccessoire,tauxMaximumAccessoire:n.tauxMaximumAccessoire,tauxMinimumAccessoire1:n.tauxMinimumAccessoire1,tauxMaximumAccessoire1:n.tauxMaximumAccessoire1,tauxMinimumAccessoire2:n.tauxMinimumAccessoire2,tauxMaximumAccessoire2:n.tauxMaximumAccessoire2,tauxMinimumAccessoire3:n.tauxMinimumAccessoire3,tauxMaximumAccessoire3:n.tauxMaximumAccessoire3,tauxMinimumAccessoire4:n.tauxMinimumAccessoire4,tauxMaximumAccessoire4:n.tauxMaximumAccessoire4,libelleTypeAssieteCalcul:n.libelleTypeAssieteCalcul,dateDebutApplicationElement:i.format(v,e.Commun.Constantes.Format.DATE_REST),dateFinApplicationElement:i.format(C,e.Commun.Constantes.Format.DATE_REST),dateAppelAccessoire:i.format(v,e.Commun.Constantes.Format.DATE_REST),noPhaseCreditProchaineRevision:A.noPhaseCreditProchaineRevision,numeroRelatif2:n.numeroRelatif2,libelleStandard:n.libelleStandard,regleEvenementDeclench1erAppel:n.regleEvenementDeclench1erAppel,regleDateDebutAppliAccCatalogue:n.regleDateDebutAppliAccCatalogue,regleEvenementDech1erAppelCata:n.regleEvenementDech1erAppelCata,numeroTranche:n.numeroTranche,montantAccessoireAEtaler:n.montantAccessoireAEtaler,dureeApplicationAccessoire:n.dureeApplicationAccessoire,uniteDureeApplicAccess:n.uniteDureeApplicAccess,identifiantService:n.identifiantService,identifiantTiers:n.identifiantTiers,codeSousTypeAccessoireCompl:n.codeSousTypeAccessoireCompl,codeTypeApplicationAccessoire:n.codeTypeApplicationAccessoire,codeTypologieAccessoire:n.codeTypologieAccessoire,codeIndicateurDerogationBornes:n.codeIndicateurDerogationBornes,codeIndicateurBornesDerogees:n.codeIndicateurBornesDerogees,nbJoursAnneeNumerateur:n.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:n.nbJoursAnneeDenominateur,numRelatifPhaseTypePhaseProduit:n.noRelatifPhaseTypePhaseProduit,mtPlafondTrancheCalculAccess:n.mtPlafondTrancheCalculAccess,mtPlafondTrancheCalculAccess1:n.mtPlafondTrancheCalculAccess1,mtPlafondTrancheCalculAccess2:n.mtPlafondTrancheCalculAccess2,mtPlafondTrancheCalculAccess3:n.mtPlafondTrancheCalculAccess3,mtPlafondTrancheCalculAccess4:n.mtPlafondTrancheCalculAccess4,numeroRegleApplicationAccess:n.numeroRegleApplicationAccess,mtMiniAccessPourRecouvrement:n.mtMiniAccessPourRecouvrement,codeAccessCalculTxEffectifGlob:n.codeAccessoireDansCalculTEG,nombreEcheancesAccessReport:l.echeancesReportees,regleDateDebutApplicatAccess:n.regleDateDebutApplicatAccess,periodiciteApplicationAccess:n.periodiciteApplicationAccess,modeComptaRecouvrAccessoire:""}}return{codeEtablissement:t.codeEtablissement,identifiantCredit:t.idCredit,codeRoleCreditAvenant:t.codeRoleCreditAvenant,identifiantAssurance:n.identifiantAssurance,numeroPhase:n.numeroPhase,numeroRelatif:n.numeroRelatif,codeTypeAccessoire:n.codeTypeAccessoire,codeTypePhase:n.codeTypePhase,libelleTypeAccessoire:n.libelleTypeAccessoire,dureeApplicationElement:n.dureeApplicationElement,periodiciteApplicationElement:this.getPeriodiciteApplicationElement(n,A),numeroRegleApplicationElement:n.numeroRegleApplicationElement,montantElement:null!=c?c.montant:n.montantElement,codeTypeAssietteCalculElement:n.codeTypeAssietteCalculElement,tauxElement:this.getTauxAccessoire(n,c),tauxElement1:n.tauxElement1,tauxElement2:n.tauxElement2,tauxElement3:n.tauxElement3,tauxElement4:n.tauxElement4,numeroRelatifSimulationAvenant:t.numeroRelatifSimulationAvenant,numeroRelatif1:t.numeroRelatif,codeModeCalculTaux:n.codeModeCalculTaux,codeActionEcranListe:this.getCodeActionEcranListeAccessoire(m,h,d,p,n,c),codeModeCalculAccessoire:n.codeModeCalculAccessoire,uniteDureeApplicElement:n.uniteDureeApplicElement,regleAppelAccessoireAperiodique:n.regleAppelAccessoireAperiodique,codeModeCalculAccessoire1:n.codeModeCalculAccessoire1,numeroRegleCalculElement:n.numeroRegleCalculElement,quotiteCouvertureCredit:n.quotiteCouvertureCredit,montantMinimumAccessoireCalcule:n.montantMinimumAccessoireCalcule,montantMaximumAccessoireCalcule:n.montantMaximumAccessoireCalcule,codeAppelLecheance:n.codeAppelLecheance,indicateurAccessoireObligatoire:n.indicateurAccessoireObligatoire,indicateurAccessoireValide:this.getIndicateurAccessoireValide(m,h,d,p),indicateurAccessoireAnnuleAv:this.getIndicateurAccessoireAnnuleAv(m,h,p),indicAccessoireCreeParAvenant:this.getIndicAccessoireCreeParAvenant(m,h,p),codeNatureAccessoire:n.codeNatureAccessoire,identifiantConvention:n.identifiantConvention,identifiantProduit:s.identifiantProduit,libelleLongConvention:n.libelleLongConvention,tauxConseilleAccessoire:n.tauxConseilleAccessoire,montantConseilleAccessoire:n.montantConseilleAccessoire,tauxConseilleAccessoire1:n.tauxConseilleAccessoire1,tauxConseilleAccessoire2:n.tauxConseilleAccessoire2,tauxConseilleAccessoire3:n.tauxConseilleAccessoire3,tauxConseilleAccessoire4:n.tauxConseilleAccessoire4,montantMinimumPlageAccessoire:n.montantMinimumPlageAccessoire,montantMaximumPlageAccessoire:n.montantMaximumPlageAccessoire,mtPasMontantAccessoire:n.mtPasMontantAccessoire,tauxMinimumAccessoire:n.tauxMinimumAccessoire,tauxMaximumAccessoire:n.tauxMaximumAccessoire,tauxMinimumAccessoire1:n.tauxMinimumAccessoire1,tauxMaximumAccessoire1:n.tauxMaximumAccessoire1,tauxMinimumAccessoire2:n.tauxMinimumAccessoire2,tauxMaximumAccessoire2:n.tauxMaximumAccessoire2,tauxMinimumAccessoire3:n.tauxMinimumAccessoire3,tauxMaximumAccessoire3:n.tauxMaximumAccessoire3,tauxMinimumAccessoire4:n.tauxMinimumAccessoire4,tauxMaximumAccessoire4:n.tauxMaximumAccessoire4,libelleTypeAssieteCalcul:n.libelleTypeAssieteCalcul,dateDebutApplicationElement:"0000-00-00"===n.dateDebutApplicationElement?null:n.dateDebutApplicationElement,dateFinApplicationElement:"0000-00-00"===n.dateFinApplicationElement?null:n.dateFinApplicationElement,dateAppelAccessoire:"B10"===n.regleAppelAccessoireAperiodique||"B13"===n.regleAppelAccessoireAperiodique?a:"0000-00-00"===n.dateAppelAccessoire?null:n.dateAppelAccessoire,noPhaseCreditProchaineRevision:n.noPhaseCreditProchaineRevision,numeroRelatif2:n.numeroRelatif2,libelleStandard:n.libelleStandard,regleEvenementDeclench1erAppel:n.regleEvenementDeclench1erAppel,regleDateDebutAppliAccCatalogue:n.regleDateDebutAppliAccCatalogue,regleEvenementDech1erAppelCata:n.regleEvenementDech1erAppelCata,numeroTranche:n.numeroTranche,montantAccessoireAEtaler:n.montantAccessoireAEtaler,dureeApplicationAccessoire:n.dureeApplicationAccessoire,uniteDureeApplicAccess:n.uniteDureeApplicAccess,identifiantService:n.identifiantService,identifiantTiers:n.identifiantTiers,codeSousTypeAccessoireCompl:n.codeSousTypeAccessoireCompl,codeTypeApplicationAccessoire:n.codeTypeApplicationAccessoire,codeTypologieAccessoire:n.codeTypologieAccessoire,codeIndicateurDerogationBornes:n.codeIndicateurDerogationBornes,codeIndicateurBornesDerogees:n.codeIndicateurBornesDerogees,nbJoursAnneeNumerateur:n.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:n.nbJoursAnneeDenominateur,numRelatifPhaseTypePhaseProduit:n.noRelatifPhaseTypePhaseProduit,mtPlafondTrancheCalculAccess:n.mtPlafondTrancheCalculAccess,mtPlafondTrancheCalculAccess1:n.mtPlafondTrancheCalculAccess1,mtPlafondTrancheCalculAccess2:n.mtPlafondTrancheCalculAccess2,mtPlafondTrancheCalculAccess3:n.mtPlafondTrancheCalculAccess3,mtPlafondTrancheCalculAccess4:n.mtPlafondTrancheCalculAccess4,numeroRegleApplicationAccess:n.numeroRegleApplicationAccess,mtMiniAccessPourRecouvrement:n.mtMiniAccessPourRecouvrement,codeAccessCalculTxEffectifGlob:n.codeAccessoireDansCalculTEG,nombreEcheancesAccessReport:n.nbrEcheancesAccessoiresReport,regleDateDebutApplicatAccess:n.regleDateDebutApplicatAccess,periodiciteApplicationAccess:n.periodiciteApplicationAccess,modeComptaRecouvrAccessoire:n.modeComptaRecouvraccessoire}},o.getPeriodiciteApplicationElement=function(e,t){return e.periodiciteApplicationAccess?e.periodiciteApplicationAccess:t.periodiciteCalculInterets},o.getTauxAccessoire=function(e,t,n){if(n){if("21"===e.codeNatureAccessoire)return n.quotite/100;if("22"===e.codeNatureAccessoire)return n.tauxFrais}return null!=t?t.taux:e.tauxElement},o.getCodeActionEcranListeAccessoireAnnexe=function(e){switch(e){case t.Enum.EtatManipulation.IsCreation:return"C";case t.Enum.EtatManipulation.IsModified:return"M";case t.Enum.EtatManipulation.ToDelete:return"A";default:return""}},o.getCodeActionEcranListeAccessoire=function(e,n,i,r,a,o){return r&&"2"===i&&"O"!==e&&"O"!==n?"M":r&&"O"===e?"C":r&&"O"===n?"A":null!=o?t.ToolsFunctionals.CaraFinan.getCodeActionPourMiseAJour(o.etatManipulationAccessoire):a.codeActionEcranListe},o.getIndicAccessoireCreeParAvenant=function(e,t,n){return!n||"O"!==e&&"O"!==t?e:"N"},o.getIndicateurAccessoireValide=function(e,t,n,i){return i&&"O"===e?"0":i&&"O"===t?"N":n},o.getIndicateurAccessoireAnnuleAv=function(e,t,n){return n&&"O"===e?"N":n&&"O"===t?"2":t},o.getRealDateDebutApplication22=function(e,t,n,i){var r=moment(_.isEmpty(t)?e:t.dateFinApplicationElement);return this.quantiemeDuMois(r.add(1,n),i).toDate()},o.getDateFin=function(e,t,n,i){return this.quantiemeDuMois(moment(e).add(t-1,n),i).toDate()},o.findLastAccessoire22CreditOrigine=function(e){var t=_.filter(e.accessoires,function(e){return"60"===e.codeTypeAccessoire});if(0===t.length)return{};for(var n=a.firstOrEmpty(t),i=0,r=t;i<r.length;i++){var o=r[i];moment(o.dateFinApplicationElement).isAfter(moment(n.dateFinApplicationElement))&&(n=angular.copy(o))}return n},o.regleD01DateEffet="D01",o.regleD02DateEmissionOffre="D02",o.regleD03DateSignatureContratAssurance="D03",o.regleD04DateMer0="D04",o.regleD06Date1erVersement="D06",o.regleD07DateDernierVersement="D07",o.regleD11DateDebutPhase="D11",o.regleD12DateFixe="D12",o.regleD13DateFinPret="D13",o.regleD14DateDebutElementFixee="D14",o.regleD16DatePeriodeCivile="D16",o.regleB10AppelDateEffet="B10",o.regleB11AppelDateSignature="B11",o.regleB12Appel1ereEcheance="B12",o.regleB13IntegreCrdDateEffetAvenant="B13",o.regleB14AppelFinCredit="B14",o}();n.CaracteristiqueFinanAccessoireBuilder=o}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=function(){function n(){}return n.getAssuranceDefault=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantAssurance:t.identifiantAssurance,identifiantPersonneEstAssure:t.identifiantPersonneEstAssure,libelleTiers:t.libelleTiers,identifiantConvention:t.identifiantConvention,codeCouvertureTypeExtension:t.codeCouvertureTypeExtension,codeDelegationAssurance:t.codeDelegationAssurance,datePriseEffetAssurance:t.datePriseEffetAssurance,dateFinEffetAssurance:t.dateFinEffetAssurance,quotiteCouvertureCredit:t.quotiteCouvertureCredit,montantEcheanceCouvertAssurance:t.montantEcheanceCouvertAssurance,numeroDossierChezLAssureur:t.numeroDossierChezLAssureur,codeTypeRisque:t.codeTypeRisque,codeActionPourMiseAJour:t.codeActionPourMiseAJour,numeroSiren:t.numeroSiren,libelleAssuranceExterne:t.libelleAssuranceExterne,libelleIntervenant:t.libelleIntervenant,libelleLongConvention:t.libelleLongConvention,codeAssuranceObligatoire:t.codeAssuranceObligatoire,codeMotifResiliation:t.codeMotifResiliation,quotiteAccessoireInclusTeg:t.quotiteAccessoireInclusTeg,quotiteAccessNonInclusTeg:t.quotiteAccessNonInclusTeg,numRegleTarificationAssurance:t.numRegleTarificationAssurance,codeReserveExclusionAssurance:t.codeReserveExclusionAssurance,beneficiaireAssuAvantVersem:t.beneficiaireAssuAvantVersem,codeAncienneteAssuranceGarantie:t.codeAncienneteAssuranceGarantie,codeTypeAgrementAssuExterne:t.codeTypeAgrementAssuExterne,codeGrilleTarifaire:t.codeGrilleTarifaire,personneAssuree:t.personneAssuree,elementsCalculAccessoires:t.elementsCalculAccessoires,conventionAssurance:t.conventionAssurance,accessoires:t.accessoires,composantes:t.composantes,montant8AnsAssuranceExterne:t.montant8AnsAssuranceExterne,montantTotalAssuranceExterne:t.montantTotalAssuranceExterne}},n.getAssurance=function(n,r,a,o,s){var u=this;return{codeEtablissement:n.codeEtablissement,identifiantCredit:n.idCredit,numeroRelatif:n.numeroRelatif,numeroRelatifSimulationAvenant:n.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:n.codeRoleCreditAvenant,identifiantAssurance:null!=r.identifiant?r.identifiant:null,identifiantPersonneEstAssure:r.personneSelected.identifiantPersonne,libelleTiers:(r.personneSelected.libelleTiers||"").substring(0,32),identifiantConvention:r.conventionSelected.idConvention,codeCouvertureTypeExtension:r.extensionPersonnesAgees?"O":"N",codeDelegationAssurance:"N",datePriseEffetAssurance:moment(r.datePriseEnCharge).isValid()?i.format(r.datePriseEnCharge,e.Commun.Constantes.Format.DATE_REST):null,dateFinEffetAssurance:moment(r.dateFinPriseEnCharge).isValid()?i.format(r.dateFinPriseEnCharge,e.Commun.Constantes.Format.DATE_REST):null,quotiteCouvertureCredit:r.modeCalculByMontant?100:r.quotite,montantEcheanceCouvertAssurance:r.montant,numeroDossierChezLAssureur:r.refExterne,codeTypeRisque:null!=r.risque?r.risque.key:null,codeActionPourMiseAJour:t.ToolsFunctionals.CaraFinan.getCodeActionPourMiseAJour(r.etatManipulation,r.codeActionPourMiseAJour),numeroSiren:null,libelleAssuranceExterne:r.libelleAssuranceExterne,libelleIntervenant:r.compagnieSelected.libelleTiers,libelleLongConvention:null,codeAssuranceObligatoire:this.getCodeAssuranceObligatoire(r.typeAssurance,r.codeAssuranceObligatoireInit),codeMotifResiliation:null!=r.motifDeliaison?r.motifDeliaison.key:null,quotiteAccessoireInclusTeg:r.quotiteIncluseTeg,quotiteAccessNonInclusTeg:r.quotiteNonInclusTeg,numRegleTarificationAssurance:null,codeReserveExclusionAssurance:null!=r.reserveSelected?r.reserveSelected.code:null,beneficiaireAssuAvantVersem:r.beneficiaireAvantVersement,codeAncienneteAssuranceGarantie:r.codeAncienneteAssuranceGarantie,codeTypeAgrementAssuExterne:" ",codeGrilleTarifaire:r.codeGrilleTarifaire?r.codeGrilleTarifaire.key:"",
personneAssuree:this.getPersonneAssuree(r.personneSelected,a.identifiantProduit),elementsCalculAccessoires:_.map(r.listeAccessoire||[],function(e){return u.getEltCalculAccessoireAssurance(n,e,r.identifiant,o,s)}),conventionAssurance:null,accessoires:null,composantes:this.getComposanteAssurance(n,r),montant8AnsAssuranceExterne:r.coutHuitAns,montantTotalAssuranceExterne:r.coutTotal}},n.getCodeAssuranceObligatoire=function(t,n){switch(t){case e.Commun.Enum.TypeAssurance.Facultatif:return"F";case e.Commun.Enum.TypeAssurance.Obligatoire:return"P"===n?"P":"O";default:return""}},n.getPersonneAssuree=function(t,n){return{identifiantPersonneEstAssure:t.identifiantPersonne,identifiantProduit:n,typeRolePersonne:null!=t.role?t.role.key:"",categorieSocioProfessionnelle:null,codeCriteresResidence:null,dateNaissance:i.format(t.dateNaissance,e.Commun.Constantes.Format.DATE_REST)}},n.getEltCalculAccessoireAssurance=function(e,n,i,r,a){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantAssurance:null!=i?i:null,numeroPhase:n.numeroPhase,numeroRelatif:n.numeroRelatif,codeTypeAccessoire:n.codeTypeAccessoire,codeTypePhase:n.accessoireParConvention.codeTypePhase,libelleTypeAccessoire:n.libelleTypeAccessoire,dureeApplicationElement:n.accessoireParConvention.dureeApplicationAccess,periodiciteApplicationElement:n.periodiciteApplicationElement,numeroRegleApplicationElement:n.accessoireParConvention.numeroRegleApplicationAccess,montantElement:null!=n.detailAccessoire.elementUn?n.detailAccessoire.elementUn.montant:0,codeTypeAssietteCalculElement:r?n.codeTypeAssietteCalculElement:n.accessoireParConvention.codeTypeAssietteCalculAccess,tauxElement:null!=n.detailAccessoire.elementUn?n.detailAccessoire.elementUn.taux:0,tauxElement1:null!=n.detailAccessoire.elementDeux?n.detailAccessoire.elementDeux.taux:0,tauxElement2:null!=n.detailAccessoire.elementTrois?n.detailAccessoire.elementTrois.taux:0,tauxElement3:null!=n.detailAccessoire.elementQuatre?n.detailAccessoire.elementQuatre.taux:0,tauxElement4:null!=n.detailAccessoire.elementCinq?n.detailAccessoire.elementCinq.taux:0,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,numeroRelatif1:null,codeModeCalculTaux:null,codeActionEcranListe:t.ToolsFunctionals.CaraFinan.getCodeActionPourMiseAJour(n.etatManipulationAccessoire),codeModeCalculAccessoire:r||a?"":n.codeModeCalculAccessoire,numeroTranche:n.accessoireParConvention.numeroTranche,nbJoursAnneeNumerateur:n.accessoireParConvention.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:n.accessoireParConvention.nbJoursAnneeNumerateur,numRelatifPhaseTypePhaseProduit:n.accessoireParConvention.numRelatifPhaseTypePhaseProduit,mtPlafondTrancheCalculAccess:n.detailAccessoire.elementUn.montantPlafond,mtPlafondTrancheCalculAccess1:null!=n.detailAccessoire.elementDeux?n.detailAccessoire.elementDeux.montantPlafond:0,mtPlafondTrancheCalculAccess2:null!=n.detailAccessoire.elementTrois?n.detailAccessoire.elementTrois.montantPlafond:0,mtPlafondTrancheCalculAccess4:null!=n.detailAccessoire.elementQuatre?n.detailAccessoire.elementQuatre.montantPlafond:0,mtPlafondTrancheCalculAccess3:null!=n.detailAccessoire.elementCinq?n.detailAccessoire.elementCinq.montantPlafond:0,mtAssietteAcessFixeeContract:n.detailAccessoire.elementUn.showMontantContractuel?n.detailAccessoire.elementUn.montantContractuel:0,codeTypeAccessoireConvention:n.codeTypeAccessoireConvention}},n.getComposanteAssurance=function(e,t){return _.map(t.listeComposantes,function(t){return t.transformToComposanteAssurance(e)})},n}();n.CaracteristiqueFinanAssuranceBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getCaracteristiquesDpe=function(e){return e&&e.isPretImpact&&e.isNouvelleNoteDpe?{dateRealisationSecondDPE:e.detailDpeAvenant.dateRealisationSecondDPE,dateSaisieSecondDPE:e.detailDpeAvenant.dateSaisieSecondDPE,idDiagPerformanceEnergie:e.detailDpeAvenant.identifiantDPE,indPerfEnergetiqueReel:e.detailDpeAvenant.indPerformanceEnergetique,numeroRelatif:e.numero}:null},e}();e.CaracteristiqueFinanCaracteristiquesDpeBuilder=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i="0000-00-00",r=e.Commun.Tools.DateUtils,a=e.Commun.Tools.List,o=function(){function o(){}return o.getCredit=function(i,a,o){var s=a.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Creation,u=a.getCreditLoadedByCaraFinan(),c=a.isAvecChangementProduit?a.creditChangePdt:i,l=n.DataCommonCaraFinanBuilder.getResult(c,a),d=n.CaracteristiqueFinanGarantieSureteReelleBuilder.getListeGarantieSureteReelle(l,a,u.garantiesSuretesReelles),m=_.find(a.listePhaseAvailables,function(e){return"PF"===e.codeTypePhase&&e.numeroPhase===i.numeroPhase});return{codeEtablissement:l.codeEtablissement,identifiantCredit:l.idCredit,codeRoleCreditAvenant:l.codeRoleCreditAvenant,identifiantProduit:c.identifiantProduit,libelleLongProduit:c.libelleLongProduit,libelleTiers:c.libelleTiers,dateEffet:r.format(a.getDateEffetRetenue(),e.Commun.Constantes.Format.DATE_REST),montantEcheance:c.montantEcheance,montantOrigineCredit:c.montantOrigineCredit,codeDevise:c.codeDevise,dureeCredit:this.getDureeCredit(a,c),uniteDureeCredit:c.uniteDureeCredit,dateEcheance:this.getDateEcheance(s,a,c,u),tauxNominalCredit:this.getTauxNominal(s,a.creditAvenantFinancier,u,a.reportFinPret,a.listePhaseAvailables),dateMiseRecouvrementZero:c.dateMiseRecouvrementZero,codeModeExpressionTaux:c.codeModeExpressionTaux,codeTauxCreditDirecteur:c.codeTauxCreditDirecteur,codeCristallisationTauxInteret:c.codeCristallisationTauxInteret,codeActionPourMiseAJour:a.codeTypeAcces.toString(),montantEcheanceMER:a.isAvecChangementProduit?c.montantEcheanceMER:0,montantFraisGestion:a.isAvecChangementProduit?c.montantFraisGestion:0,montantArrieresIncorporesCrd:a.isAvecChangementProduit?c.montantArrieresIncorporesCrd:0,codeTraitementFinVersement:c.codeTraitementFinVersement,numeroQuantiemeDateEcheance:a.isAvenantQuantieme?a.creditAvenantFinancier.numeroQuantiemeSaisi:c.numeroQuantiemeDateEcheance,codeIndiceNominal:a.isAvecChangementProduit&&a.creditAvenantFinancier.isCreditDirecteur?a.creditAvenantFinancier.indiceTauxCredit:c.codeIndiceNominal,margeAppliquerSurTauxNominal:a.isAvecChangementProduit&&a.creditAvenantFinancier.isCreditDirecteur?a.creditAvenantFinancier.margeTauxCredit:c.margeAppliquerSurTauxNominal,montantCapitalRestantSurCredit:c.montantCapitalRestantSurCredit,codeTypeRecalculTA:a.isAvenantAte?a.ate.getCodeTypeRecalculTA():a.creditAvenantFinancier.codeTypeRecalculTA,dateCreation:o,dateFinPrefinancementReelle:a.isAvecChangementProduit?c.dateFinPrefinancementReelle:"O"===c.codeRoleCreditAvenant?c.dateFinPrefinancementReelle:null,codeIntegrationFraisCrd:null!=a.dataFraisAvenant.fraisAvenant&&a.dataFraisAvenant.fraisAvenant.isToIntegreCrd?"O":"N",identifiantProfilRenegociation:c.identifiantProfilRenegociation,codeTypeAvenant:a.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Simulation?e.Commun.Enum.TypeAvenant.AvenantCommercial.toString():a.typeAvenant.toString(),codeTypeModificationCredit:t.ToolsFunctionals.CaraFinan.getCodeTypeModificationCredit(a.getListeModificationCredit(),t.ToolsFunctionals.Avenant.getIsTopCalculatrice(a),a.isAvecChangementProduit,null!=m,a.isAvenantReportFinPret?a.reportFinPret.isSecurisationOpen:!1),numeroRelatif:l.numeroRelatif,numeroRelatifSimulationAvenant:l.numeroRelatifSimulationAvenant,tauxIndemniteRA:a.isAvecChangementProduit?a.tauxRa:c.tauxIndemniteRA,tauxInteretPrefinancement:null!=m?m.tauxDirecteur:c.tauxInteretPrefinancement,codeCreditSecurisable:c.codeCreditSecurisable,dateFinCredit:this.getDateFinCredit(a,a.ate,c),codePresenceRevisionSurCredit:c.codePresenceRevisionSurCredit,montantIntcompsurCR:a.isAvecChangementProduit?c.montantIntcompsurCR:0,cdTypeArrieresIncorporeCrd:a.isAvecChangementProduit?c.cdTypeArrieresIncorporeCrd:null,typeLoi:c.typeLoi,nbMaxiPeriodeAllongPourRevision:a.isAvecChangementProduit&&a.showVariationDureeProduitForChgtProduit&&"R"===a.cdTypeButoir?a.dureeVariationDureeProduit:c.nbMaxiPeriodeAllongPourRevision,nbMaxiPerallsortieCptCourant:a.isAvecChangementProduit&&a.showVariationDureeProduitForChgtProduit&&"C"===a.cdTypeButoir?a.dureeVariationDureeProduit:c.nbMaxiPerallsortieCptCourant,nbMaxiPerallongPourModulation:a.isAvecChangementProduit&&a.showVariationDureeProduitForChgtProduit&&"M"===a.cdTypeButoir?a.dureeVariationDureeProduit:c.nbMaxiPerallongPourModulation,mtCapitalRestantSurCredit:c.mtCapitalRestantSurCredit,codeCategorieEmprunteur:c.codeCategorieEmprunteur,montantActualiseCredit:c.montantActualiseCredit,montantGlobalGarantiCredit:c.montantGlobalGarantiCredit,codeSousTypeAvenantRecouvrement:a.codeSousTypeAvenant.toString(),codeNatureFinancement:c.codeNatureFinancement,codeTypeMarche:c.codeTypeMarche,dateSignature:a.isAvecChangementProduit?c.dateSignature:null,dateEffetInitialeLAvenant:a.isAvecChangementProduit?c.dateEffetInitialeLAvenant:null,dureeAjusteeCreditSuiteRecalcul:this.getDureeAjusteeCreditSuiteRecalcul(a,c),dateSaisieLEvenement:r.format(new Date,e.Commun.Constantes.Format.DATE_REST),dateEmission:null,delaiMinimumAcceptation:s?c.delaiMinimumAcceptation:u.delaiMinimumAcceptation,delaiRetractation:c.delaiRetractation,commentaireProduits:c.commentaireProduits,montantMAfondsDemandees:c.montantMAfondsDemandees,codeEcheancierVersemcontractuel:c.codeEcheancierVersemcontractuel,codeTypePretCombine:c.codeTypePretCombine,codePresenceServiceObjet:c.codePresenceServiceObjet,codeIndicateurIntegrationCrd:c.codeIndicateurIntegrationCrd,tauxInteretsRetardImpaye:c.tauxInteretsRetardImpaye,numeroModaliteRembAnticipe:a.isAvecChangementProduit?a.numeroModaliteRaDefault.numModaliteRemboursemntAnticipe:c.numModaliteRemboursemntAnticipe,typeObjetFinanceGaranti:c.typeObjetFinanceGaranti,dateDecisionEmission:a.isAvecChangementProduit?c.dateDecisionEmission:null,etatBrancheAccessoireEdgAvenant:"2",existenceAccessoireBonMajTaux:null,cumulDesBonifsMajorations:c.cumulBonificationsMajorations,phases:this.getListePhases(a,c,l.numeroRelatifSimulationAvenant,a.isAvecChangementProduit),echeancesReportees:this.getListeEcheancesReportees(a,c,l.numeroRelatifSimulationAvenant),echeancesAmenagees:this.getListeEcheancesAmenagees(l,u,a),assurances:this.getListeAssurances(l,a,c,u.assurances),garantiesExistantes:n.CaracteristiqueFinanGarantieExistanteBuilder.getListeGarantieExistante(l,a,u.garantiesExistantes,d),garantiesSuretesReelles:d,accessoires:n.CaracteristiqueFinanAccessoireBuilder.getListeAccessoiresAvenant(l,a,c),garantie:null,phasesBis:null,garantiesSuretesPerso:n.CaracteristiqueFinanGarantieSuretePersoBuilder.getListeGarantieSuretePerso(l,a,u.garantiesSuretesPerso),informationsEmprunteur:n.CaracteristiqueFinanEmprunteurBuilder.getInformationEmprunteur(l,a),personnePayeurs:n.CaracteristiqueFinanEmprunteurBuilder.getListePersonnePayeur(l,a),informationsMenage:null,accessoiresBis:null,garantiesApplicables:null,motifsEstimations:null,accessoiresServicesObjet:n.CaracteristiqueFinanServicesObjetBuilder.getAccessoiresServicesObjet(a),servicesObjet:n.CaracteristiqueFinanServicesObjetBuilder.getServicesObjet(a)}},o.getTauxNominal=function(e,t,n,i,r){return i?i.tauxFrais:e?t.tauxCredit:n.tauxNominalCredit},o.getDateFinCredit=function(t,n,i){if(t.isAvenantQuantieme){var a=moment(t.dateEffetModifieQuantieme).date();return r.format(moment(t.dateFinCredit).date(a).toDate(),e.Commun.Constantes.Format.DATE_REST)}return t.isAvenantAte?r.format(n.getDateFinCredit(i),e.Commun.Constantes.Format.DATE_REST):r.format(t.dateFinCredit,e.Commun.Constantes.Format.DATE_REST)},o.getDureeCredit=function(e,t){return e.isAvenantAte?e.ate.getDureeCredit(t):e.creditAvenantFinancier.getDureeAjusteeCreditSuiteRecalcul()},o.getDureeAjusteeCreditSuiteRecalcul=function(e,t){return e.isAvenantAte?e.ate.getDureeCredit(t):e.isAvenantTauxDuree?e.creditAvenantFinancier.getDureeAjusteeCreditSuiteRecalcul():t.dureeAjusteeCreditSuiteRecalcul},o.getDateEcheance=function(t,n,i,a){return t?n.isAvenantQuantieme?r.format(n.dateEffetModifieQuantieme,e.Commun.Constantes.Format.DATE_REST):i.dateEcheance:a.dateEcheance},o.getListeAssurances=function(e,t,i,r){return t.isAvenantAssurance||t.isAvenantPersonnes||t.isAvenantAte||t.isAvenantPeriodicite||t.isAvenantTauxDuree||t.isAvenantQuantieme?_.map(t.listeAssurancesStock,function(r){return n.CaracteristiqueFinanAssuranceBuilder.getAssurance(e,r,i,t.isAvenantAte,t.isAvenantQuantieme)}):_.map(r,function(t){return n.CaracteristiqueFinanAssuranceBuilder.getAssuranceDefault(e,t)})},o.getListePhases=function(e,i,r,a){var o=this,s=e.creditAvenantFinancier.isCreditDirecteur&&e.creditAvenantFinancier.activerIndiceCredit,u=e.listePhaseStock.length,c=[u,t.ToolsFunctionals.Avenant.getIsTopCalculatrice(e)];return _.map(e.listePhaseStock,function(t){return n.CaracteristiqueFinanPhaseBuilder.getPhase(t,i,r,e.dateFinPrefinancementReelle,a,s,o.getNumeroJeuIndiceRevision(e,a),c)})},o.getListeEcheancesReportees=function(e,t,n){var i=this;return e.isAvecChangementProduit?null:_.map(t.echeancesReportees||[],function(t){return i.getEcheanceReportee(t,n,e.reportFinPret)})},o.getEcheanceReportee=function(e,t,n){var r="",a=0,o=0,s="";return null!=n&&n.isSecurisationOpen?(r=""!==n.dateDebutChomage?n.dateDebutChomage:null,a=n.numeroPlanSecurisation,o=n.nbPeriodeFractionnement,s="S"):(r=e.dateDebutChomage,a=e.numeroPlanSecurisation,o=e.numeroPeriodeFractionneme,s="NS"),{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:t,codeRoleCreditAvenant:null,dateDebutChomage:"O"===e.codeRoleCreditAvenant?r:i,numeroPlanSecurisation:a,numeroPeriodeFractionneme:o,codeTypeModificationCredit:s,nombreEcheancesAccessReport:null!=n?n.echeancesReportees+e.nombreEcheancesAccessReport:null}},o.getListeEcheancesAmenagees=function(e,t,n){if(n.isAvenantAte&&!n.isAvecChangementProduit){var i={codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeTypeAction:"C",nombreEcheancesReportees:n.ate.echeancesReportees,codeTypeEcheanceAmenagee:n.ate.getCodeTypeEchAmenagee(),codeTypeCalculInterets:n.ate.getCodeTypeCalculInterets(),nouvelleDureeResiduelle:n.ate.getNouvelleDureeResiduelle(),montantRemboursementSaisi:n.ate.getMontantRemboursementSaisi()},r=[];return(t.echeancesAmenagees||[]).length>0&&Array.prototype.push.apply(r,t.echeancesAmenagees),r.push(i),r}return null},o.getNumeroJeuIndiceRevision=function(e,t){return t?this.getNumeroJeuIndiceRevisionCustom(e.dataRestAvenant.produitCredit.phases,e.creditAvenantFinancier.conditionTauxProduitSel,a.firstOrEmpty(e.listePhaseAvailables)):1},o.getNumeroJeuIndiceRevisionCustom=function(e,t,n){var i,r="";if(!_.isEmpty(n)&&(i=_.find(e,function(e){return e.codeTypePhase===n.codeTypePhase&&e.noRelatifPhaseTypePhaseProduit===n.phaseByRest.noRelatifPhaseTypePhaseProduit}),null!==i&&null!==t))for(var a=0,o=i.parametresRevision;a<o.length;a++){var s=o[a];if(r="1"===i.cdModeExpressionTauxMoyenPhase?"INDX"===t.codeIndice?"O":"N":"INDX"===i.codeIndice?"O":"N",n.indiceTauxDirecteurSel===s.codeIndice&&"O"===r||"O"!==r)return s.numeroJeuIndicesRevision}return 1},o}();n.CaracteristiqueFinanCreditBuilder=o}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=function(){function i(){}return i.getCreditObjet=function(i,r){var a=r.isAvecChangementProduit?r.creditChangePdt:i,o=t.DataCommonCaraFinanBuilder.getResult(a,r);return{codeEtablissement:o.codeEtablissement,identifiantCredit:o.idCredit,numeroRelatif:o.numeroRelatif,numeroRelatifSimulationAvenant:o.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:o.codeRoleCreditAvenant,identifiantObjet:r.infoObjet.identifiantObjet,numeroRelatifObjetDossier:r.dataRestAvenant.dataObjet.creditObjet.numeroRelatifObjetDossier,codeUsageLObjet:r.dataRestAvenant.dataObjet.creditObjet.codeUsageLObjet,typeObjetFinanceGaranti:r.infoObjet.projetFinance.typeObjetFinanGaranti,libelleTypeObjetCommercialToc:r.infoObjet.projetFinance.libelleLong,typeObjetReglementeTor:r.infoObjet.precisionReglementaire.type,libelleTypeObjetReglementeTor:r.infoObjet.precisionReglementaire.libelle,codeUtilisationObjetDansCredit:r.dataRestAvenant.dataObjet.creditObjet.codeUtilisationObjetDansCredit,montantLOperation:r.infoObjet.montantOperation,coutHorsTaxeLObjet:r.infoObjet.coutHtObjet,coutTtcLObjet:r.infoObjet.coutTtcObjet,montantFraisNotaire:r.infoObjet.fraisNotaire,integrationFraisNotaire:r.infoObjet.affichageBoutonFraisNotaire?r.infoObjet.boutonFraisNotaire?"O":"N":"",montantFraisDivers:r.infoObjet.fraisDivers,integrationFraisDivers:r.infoObjet.affichageBoutonFraisDivers?r.infoObjet.boutonFraisDivers?"O":"N":"",mtInscriptionHypothecExistantes:r.infoObjet.valeurHypotheque,codePrixMarche:this.setPrixMarche(r.infoObjet.prixMarche),codeModaliteOccupation:this.setModaliteOccupationObjet(r.infoObjet.objetOccupePar),codeDestinationAutoriseeObjet:null!=r.infoObjet.objetDestination?r.infoObjet.objetDestination.key:null,codeGarantieAchevementTravaux:r.infoObjet.boutonAchevementTravaux?"O":"N",typeZoneFranche:this.setZoneFranche(r.infoObjet.zoneFranche),codeZoneGeographique:this.setZoneGeographique(r.infoObjet.zoneGeographique,r.infoObjet.zoneDeRobien),nombreLogementsDansObjet:r.infoObjet.nbLogement,adresseLigne1:r.infoObjet.adresseObjetComposant.afnor.ligne1,adresseLigne2:r.infoObjet.adresseObjetComposant.afnor.ligne4,adresseLigne3:r.infoObjet.adresseObjetComposant.afnor.ligne5,adresseLigneCodePostal4:r.infoObjet.adresseObjetComposant.codePostal,adresseLigneCommune5:r.infoObjet.adresseObjetComposant.libelleInseeLocalite,adresseLigneSuite6:r.infoObjet.adresseObjetComposant.afnor.ligne2,codePaysLocalisation:r.infoObjet.adresseObjetComposant.pays.codePaysIsoAfnor,descriptionLObjet:r.infoObjet.descObjet,referenceExterneObjet:r.infoObjet.referenceExterne,identifiantVendeur:r.infoObjet.vendeur,codeQualiteMarche:this.setCodeQualiteMarche(r.infoObjet.typeMarcheBien),montantValeurObjet:r.infoObjet.valeurDuBien,surfaceHabitableEnM2:r.infoObjet.affichageSurfaceTypeBien?r.infoObjet.surfaceHabitableBien:0,codeMiseEnOeuvreProjet:this.setCodeMiseEnOeuvreProjet(r.infoObjet.miseOeuvreBien,r.infoObjet.affichageMiseOeuvreBien),codeTypeLogement:null!=r.infoObjet.typeLogementBien?r.infoObjet.typeLogementBien.key:null,dateEstimationValeurObjet:n.format(r.infoObjet.dateEstimationBien,e.Commun.Constantes.Format.DATE_REST),codeModaliteLEstimation:null!=r.infoObjet.modeEstimationBien?r.infoObjet.modeEstimationBien.codeTypologie:null,surfaceTerrainEnM2:r.infoObjet.surfaceTerrain,modeAcquisition:this.setModeAcquisitionTerrain(r.infoObjet.modeAcquisitionTerrain),dateAcquisitionTerrain:n.format(r.infoObjet.dateAcquisitionTerrain,e.Commun.Constantes.Format.DATE_REST),coutAcquisition:r.infoObjet.montantAcquisitionTerrain,dateEstimValeurObjetPrudentiel:n.format(r.infoObjet.dateEstimationTerrain,e.Commun.Constantes.Format.DATE_REST),modeEstimationValeurTerrain:null!=r.infoObjet.modeEstimationTerrain?r.infoObjet.modeEstimationTerrain.codeTypologie:"",codeClasseBafi:r.dataRestAvenant.dataObjet.creditObjet.codeClasseBafi,categorieReglementAttribution:r.dataRestAvenant.dataObjet.creditObjet.categorieReglementairAtribution,codeTypeMarchePersonne:r.dataRestAvenant.dataObjet.creditObjet.codeTypeMarchePersonne,codeFamilleControle:r.dataRestAvenant.dataObjet.creditObjet.codeFamilleControle,dateEffet:n.format(r.getDateEffetRetenue(),e.Commun.Constantes.Format.DATE_REST),libelleLongProduit:r.dataRestAvenant.dataObjet.creditObjet.libelleLongProduit,codeTypologieCadreFiscal:r.dataRestAvenant.dataObjet.creditObjet.codeTypologieCadreFiscal,codePresenceServiceObjet:"N",codeDevise:r.dataRestAvenant.dataObjet.creditObjet.codeDeviseIso}},i.setPrixMarche=function(e){return null==e||1!==e.code&&2!==e.code&&3!==e.code?"":e.code.toString()},i.setModaliteOccupationObjet=function(e){return null==e||"E"!==e.code&&"L"!==e.code&&"A"!==e.code&&"D"!==e.code?"":e.code},i.setZoneFranche=function(e){return null==e||"F"!==e.code&&"S"!==e.code&&"T"!==e.code&&"U"!==e.code&&"V"!==e.code?"":e.code},i.setZoneGeographique=function(e,t){if(null!=e&&null!=t)switch(e.code){case"A":switch(t.code){case 1:return"I";case 2:return"J";case 3:return"K"}break;case"B":switch(t.code){case 1:return"M";case 2:return"N";case 3:return"O"}break;case"C":switch(t.code){case 1:return"P";case 2:return"Q";case 3:return"R"}break;case"S":switch(t.code){case 1:return"A";case 2:return"B";case 3:return"C"}break;default:return""}return""},i.setCodeQualiteMarche=function(e){return null==e||1!==e.code&&2!==e.code&&3!==e.code?"":e.code.toString()},i.setCodeMiseEnOeuvreProjet=function(e,t){return!t||null==e||1!==e.code&&2!==e.code&&3!==e.code?"":e.code.toString()},i.setModeAcquisitionTerrain=function(e){return null==e||1!==e.code&&2!==e.code&&3!==e.code?"":e.code.toString()},i}();t.CaracteristiqueFinanCreditObjetBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=e.Commun.ToolsFunctionals.Personne,r=function(){function r(){}return r.getInformationEmprunteur=function(e,t){return t.isAvenantPersonnes?this.getDataInformationEmprunteur(e,t.emprunteurNouveau,t.getDateEffetRetenue()):null},r.getDataInformationEmprunteur=function(t,i,r){return{codeEtablissement:t.codeEtablissement,identifiantCredit:t.idCredit,numeroRelatif:t.numeroRelatif,numeroRelatifSimulationAvenant:t.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:t.codeRoleCreditAvenant,dateEffet:n.format(r,e.Commun.Constantes.Format.DATE_REST),codeEmprunteur:i.idEntiteTitulaire,codeCategorieEmprunteur:i.categorie.codeCategorie,libelleCategorieEmprunteur:i.categorie.libelle,codeTypeMarche:i.categorie.codeTypeMarche,cdSivraiavenantPersonne:"N",codeMotifAvenantPersonne:i.motifChangement.codeMotifBlocage,numDomicilSecoursEmprunteur:this.getDomiciliation(i.payeurSecours),codeModeReglementEmprunteur:i.payeurSecours.modeRecouvrement.codeModeReglement,libelleLongProduit:null,libelleTiers:i.libelleLong,referenceUniqueMandat:this.getRum(i.payeurSecours),personnesComposantsEmprunteur:this.getListePersonneComposantEmprunteur(t,i.idEntiteTitulaire,i.listePersonneEmprunteur)}},r.getListePersonneComposantEmprunteur=function(e,t,n){var r=this;return _.map(_.filter(n,function(e){return i.isRoleEmprunteur(e.role)}),function(n){return r.getPersonneComposantEmprunteur(e,t,n)})},r.getPersonneComposantEmprunteur=function(e,t,n){return{codeEtablissement:e.codeEtablissement,codeEmprunteur:t,identifiantPersonne:n.idPersonne,noOrdrePersonneDansEmprunteur:n.numeroOrdrePersonne,codeTypePersonne:i.getCodeTypePersonne(n.typePersonne),typeRolePersonne:null!=n.role?n.role.key:"",roleLIntervenant:null}},r.getListePersonnePayeur=function(e,t){var n=this;return t.isAvenantPersonnes?_.map(t.emprunteurNouveau.listePayeurAvailables,function(t){return n.getPersonnePayeur(e,t)}):null},r.getPersonnePayeur=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,identifiantPersonne:_.first(t.listePersonne).idPersonne,codeModeReglement:t.modeRecouvrement.codeModeReglement,numDomicilMiseRecouvrement:this.getDomiciliation(t),montantFixePayeurSurEcheance:t.montantFixe,pourcentagePayeurSurInteret:t.partInterets,prcentagePayeurSurAmortissement:t.partCapital,pourcentagePayeurSurAssurAccess:t.partAccessoires,referenceUniqueMandat:this.getRum(t)}},r.getDomiciliation=function(n){switch(n.modeRecouvrement.codeTypeDomiciliation){case e.Commun.Constantes.Donnees.ModeFluxFinancier.codeReleveIdentiteBancaire:return n.compte.numeroCompte;case e.Commun.Constantes.Donnees.ModeFluxFinancier.codeSepaBicIban:var i=t.PersonneEmprunteurHelper.normeBic(n.bic);return i+n.iban;case e.Commun.Constantes.Donnees.ModeFluxFinancier.codeSaisieLibre:case e.Commun.Constantes.Donnees.ModeFluxFinancier.codeTresorerie:return n.libelleReglement;default:return null}},r.getRum=function(t){return t.modeRecouvrement.codeTypeDomiciliation===e.Commun.Constantes.Donnees.ModeFluxFinancier.codeSepaBicIban?t.referenceUniqueMandat:null},r}();t.CaracteristiqueFinanEmprunteurBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(){}return t.getResult=function(e,t){return{codeEtablissement:e.codeEtablissement,idCredit:t.idCredit,numeroRelatif:this.getNumeroRelatif(e,t),numeroRelatifSimulationAvenant:this.getNumeroRelatifSimulationAvenant(e,t),codeRoleCreditAvenant:t.isAvecChangementProduit?e.codeRoleCreditAvenant:null}},t.getNumeroRelatif=function(t,n){return"O"!==t.codeRoleCreditAvenant?"U"===t.codeRoleCreditAvenant&&n.codeAvenantSimulation!==e.Commun.Enum.CodeAvenantSimulation.Simulation?n.numero:t.numeroRelatif:n.codeAvenantSimulation!==e.Commun.Enum.CodeAvenantSimulation.Simulation?n.numero:0},t.getNumeroRelatifSimulationAvenant=function(t,n){return"O"!==t.codeRoleCreditAvenant?"U"===t.codeRoleCreditAvenant&&n.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Simulation?n.numero:t.numeroRelatifSimulationAvenant:n.codeAvenantSimulation===e.Commun.Enum.CodeAvenantSimulation.Simulation?n.numero:0},t}();t.DataCommonCaraFinanBuilder=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(){}return t.getPhaseForInit=function(e,t,n){var i=this;return{codeEtablissement:e.codeEtablissement,codeRoleCreditAvenant:n?e.codeRoleCreditAvenant:null,numeroPhase:e.numeroPhase,codeTypePhase:e.codeTypePhase,libelleLongTypePhase:e.libelleLongTypePhase,dureeInitialePhaseCredit:e.dureeInitialePhaseCredit,dureeResiduelleCredit:e.dureeResiduelleCredit,uniteDureePhase:e.uniteDureePhase,tauxNominalPhase:e.tauxNominalPhase,codeTauxDesPaliersCalcules:e.codeTauxDesPaliersCalcules,tauxMoyenPhaseCredit:e.tauxMoyenPhaseCredit,modeCalculAmortissement:e.modeCalculAmortissement,quotiteCapitalAmortir:e.quotiteCapitalAmortir,periodiciteMERamortissement:e.periodiciteMERamortissement,periodiciteCalculInterets:e.periodiciteCalculInterets,dateFinPrefinancementInitiale:e.dateFinPrefinancementInitiale,codeIndiceNominal:e.codeIndiceNominal,margeAppliquerSurTaux:e.margeAppliquerSurTaux,typeIndexationTaux:e.typeIndexationTaux,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:t,numeroJeuIndicesRevision:e.numeroJeuIndicesRevision,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,elementModifiableParAvenant:e.elementModifiableParAvenant,modeCapitRecouvInterets:e.modeCapitRecouvInterets,cdModifCaracteristfinancieres:e.cdModifCaracteristfinancieres,partieFixeUnTauxComposite:e.partieFixeUnTauxComposite,nbJoursDansAnneeDenominateur:e.nbJoursDansAnneeDenominateur,nbJoursDansAnneeNumerateur:e.nbJoursDansAnneeNumerateur,calculInteretsEnJoursReels:e.calculInteretsEnJoursReels,prelevementEnFinPhase:e.prelevementEnFinPhase,codeTypeEcretage:e.codeTypeEcretage,codeOccurAbsorbeePhasePalier:e.codeOccurabsorbeePhasePalier,identifiantCredit:e.identifiantCredit,numRelatifPhaseTypePhaseProduit:e.noRelatifPhaseTypePhaseProduit,dureeAjusteePhaseCredit:e.dureeResiduelleCredit,paliers:_.map(e.paliersTauxInterets||[],function(e){return i.getPalierInit(e,t)}),paliersTauxAmortissement:_.map(e.paliersTauxAmortissement||[],function(e){return i.getPalierTauxAmortissementInit(e,t)}),parametresRevisionTaux:_.map(e.parametresRevisionTaux||[],function(e){return i.getParametreRevisionTauxInit(e,t)}),periodiciteMERInterets:e.periodiciteMiseRecouvrInterets,pretsCombines:e.pretsCombines,echeancesALaCarte:null}},t.getPhase=function(e,t,n,i,r,a,o,s){var u=this,c=_.map(e.listePalier,function(e){return u.getPalierV2(e,n)});return{codeEtablissement:t.codeEtablissement,codeRoleCreditAvenant:r?e.phaseByRest.codeRoleCreditAvenant:null,numeroPhase:e.numeroPhase,codeTypePhase:e.codeTypePhase,libelleLongTypePhase:e.phaseByRest.libelleLongTypePhase,dureeInitialePhaseCredit:e.duree,dureeResiduelleCredit:e.phaseByRest.dureeResiduelleCredit,uniteDureePhase:e.uniteDureePhase,tauxNominalPhase:e.taux,codeTauxDesPaliersCalcules:e.phaseByRest.codeTauxDesPaliersCalcules,tauxMoyenPhaseCredit:e.phaseByRest.tauxMoyenPhaseCredit,modeCalculAmortissement:e.phaseByRest.modeCalculAmortissement,quotiteCapitalAmortir:e.phaseByRest.quotiteCapitalAmortir,periodiciteMERamortissement:e.periodiciteAmortissement.codePeriode,periodiciteCalculInterets:e.periodiciteCalculInterets.codePeriode,dateFinPrefinancementInitiale:e.phaseByRest.dateFinPrefinancementInitiale,codeIndiceNominal:r&&e.isCreditDirecteur?e.indice:e.phaseByRest.codeIndiceNominal,margeAppliquerSurTaux:e.marge,typeIndexationTaux:e.phaseByRest.typeIndexationTaux,numeroRelatif:e.phaseByRest.numeroRelatif,numeroRelatifSimulationAvenant:n,numeroJeuIndicesRevision:e.phaseByRest.numeroJeuIndicesRevision,noPhaseCreditProchaineRevision:e.phaseByRest.noPhaseCreditProchaineRevision,elementModifiableParAvenant:this.getElementModifiableParAvenant(e,t,i),modeCapitRecouvInterets:e.phaseByRest.modeCapitRecouvInterets,cdModifCaracteristfinancieres:e.cdModifCaracFinanciere,partieFixeUnTauxComposite:e.phaseByRest.partieFixeUnTauxComposite,nbJoursDansAnneeDenominateur:e.phaseByRest.nbJoursDansAnneeDenominateur,nbJoursDansAnneeNumerateur:e.phaseByRest.nbJoursDansAnneeNumerateur,calculInteretsEnJoursReels:e.phaseByRest.calculInteretsEnJoursReels,prelevementEnFinPhase:e.phaseByRest.prelevementEnFinPhase,codeTypeEcretage:e.phaseByRest.codeTypeEcretage,codeOccurAbsorbeePhasePalier:e.phaseByRest.codeOccurabsorbeePhasePalier,identifiantCredit:e.phaseByRest.identifiantCredit,numRelatifPhaseTypePhaseProduit:e.numRelatifPhaseTypePhaseProduit,dureeAjusteePhaseCredit:e.phaseByRest.dureeResiduelleCredit,paliers:c,paliersTauxAmortissement:this.getListePalierTauxAmortissement(e,n,r),parametresRevisionTaux:this.getListeParametresRevisionTaux(e,n,r,a,o),periodiciteMERInterets:e.periodiciteInteret.codePeriode,pretsCombines:e.pretsCombinesPhases,echeancesALaCarte:this.getListeEcheancesALaCarteV2(e.listePalier,t.codeEtablissement,t.identifiantCredit,r,s)}},t.getListeEcheancesALaCarteV2=function(e,t,n,i,r){var a=this,o=_.filter(e,function(e){return(e.listeEcheanceALaCarte||[]).length>0});if(0===o.length)return null;var s=[],u=0;if(r[1]&&r[0]===_.first(o).numeroPhase){for(var c=[],l=[],d=0,m=o;d<m.length;d++)for(var h=m[d],p=0,f=h.listeEcheanceALaCarte;p<f.length;p++){var A=f[p];A.numeroEcheance>=h.numeroPremiereEcheance&&A.numeroEcheance<=h.numeroDerniereEcheance&&"1"!==h.typeRemboursement&&c.push(h)}for(var P=0;P<c.length;P++)0===P?(u=c[0].numeroPremiereEcheance,l.push(c[0])):c[P].numeroPremiereEcheance!==u&&(l.push(c[P]),u=c[P].numeroPremiereEcheance);if(_.isEmpty(l))return null;s=_.map(l,function(e){return _.map(e.listeEcheanceALaCarte,function(r){return a.getEcheanceALaCarte(e,r,t,n,i)})})}else s=_.map(o,function(e){return _.map(e.listeEcheanceALaCarte,function(r){return a.getEcheanceALaCarte(e,r,t,n,i)})});return _.reduce(s,function(e,t){return _.union(e,t)},[])},t.getEcheanceALaCarte=function(e,t,n,i,r){return{codeEtablissement:n,identifiantCredit:i,numeroRelatif:t.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:r?"U":null,numeroPhase:t.numeroPhase,numeroEcheance:t.numeroEcheance,codeTypeElementSaisiSurCredit:t.codeTypeElementSaisiSurCredit,montantRemboursementSaisi:this.getMontantRemboursementCreditSaisi(t),tauxRemboursementSaisi:t.tauxProgression,montantAmortissementCreditSaisi:this.getMontantAmortissementCreditSaisi(t),montantEcheanceEnCours:t.montantEcheanceEnCours
}},t.getMontantRemboursementCreditSaisi=function(e){switch(e.codeTypeElementSaisiSurCredit){case"A":return e.montantRemboursementSaisi;case"E":return e.montantEcheanceMaj;case"D":return e.montantEcheanceMaj;default:return e.montantEcheanceMaj}},t.getMontantAmortissementCreditSaisi=function(e){switch(e.codeTypeElementSaisiSurCredit){case"A":return e.montantEcheanceMaj;case"E":return e.montantAmortissementCreditSaisi;case"D":return e.montantAmortissementCreditSaisi;default:return e.montantAmortissementCreditSaisi}},t.getElementModifiableParAvenant=function(e,t,n){return null!=e?e.elementModifiableParAvenant:null!=t?this.getElementModifiableParAvenantByInfoCredit(e.phaseByRest,t,n):e.phaseByRest.elementModifiableParAvenant},t.getElementModifiableParAvenantByInfoCredit=function(t,n,i){return t.numeroPhase<n.numeroPhase?"N":t.numeroPhase===n.numeroPhase&&("PF"===t.codeTypePhase&&e.Commun.Tools.DateUtils.parse(n.dateEffet)===i||"PF"!==t.codeTypePhase&&n.numeroEcheance===this.getNumeroDerniereEcheancePalier(t))?"N":"O"},t.getNumeroDerniereEcheancePalier=function(e){var t=_.filter(e.paliersTauxInterets,function(t){return"O"===t.codeRoleCreditAvenant&&t.numeroPhase===e.numeroPhase});return t.length>0?_.max(_.map(t,function(e){return e.numeroDerniereEcheancePalier})):0},t.getPalierInit=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,numeroPremiereEcheancePalier:e.numeroPremiereEcheancePalier,numeroDerniereEcheancePalier:e.numeroDerniereEcheancePalier,codeIndice:e.codeIndice,margeAppliquerSurTaux:e.margeAppliquerSurTaux,tauxInteretPalier:e.tauxInteretPalier,typeRemboursement:e.typeRemboursement,uniteDureePhase:e.uniteDureePhase,numeroRelatif1:e.numeroRelatif1,numeroRelatifSimulationAvenant:t,numeroRelatifPalierProduit:e.numeroRelatifPalierProduit,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroRelatif2:e.numeroRelatif2,elementModifiableParAvenant:e.elementModifiableParAvenant,cdModifCaracteristfinancieres:e.cdModifCaracteristfinancieres,codeOccurAbsorbeePhasePalier:e.codeOccurabsorbeePhasePalier,tauxProgressionDesEcheances:e.tauxProgressionDesEcheances,periodiciteApplicProgreEcheance:e.periodiciteApplicProgreEcheance}},t.getPalierV2=function(e,t){return{codeEtablissement:e.palierByRest.codeEtablissement,identifiantCredit:e.palierByRest.identifiantCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,numeroPremiereEcheancePalier:e.numeroPremiereEcheance,numeroDerniereEcheancePalier:e.numeroDerniereEcheance,codeIndice:e.indice,margeAppliquerSurTaux:e.marge,tauxInteretPalier:e.taux,typeRemboursement:e.typeRemboursement,uniteDureePhase:e.palierByRest.uniteDureePhase,numeroRelatif1:e.numeroRelatif1,numeroRelatifSimulationAvenant:t,numeroRelatifPalierProduit:e.palierByRest.numeroRelatifPalierProduit,noPhaseCreditProchaineRevision:e.palierByRest.noPhaseCreditProchaineRevision,numeroRelatif2:e.palierByRest.numeroRelatif2,elementModifiableParAvenant:e.elementModifiableParAvenant,cdModifCaracteristfinancieres:e.cdModifCaracteristfinancieres,codeOccurAbsorbeePhasePalier:e.palierByRest.codeOccurabsorbeePhasePalier,tauxProgressionDesEcheances:e.tauxProgEch,periodiciteApplicProgreEcheance:e.palierByRest.periodiciteApplicProgreEcheance}},t.getPalierTauxAmortissementInit=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,numeroPremiereEcheancePalier:e.numeroPremiereEcheancePalier,numeroDerniereEcheancePalier:e.numeroDerniereEcheancePalier,tauxProgressionAmortissement:e.tauxProgressionAmortissement,uniteDureePhase:e.uniteDureePhase,numeroRelatif1:e.numeroRelatif1,numeroRelatifSimulationAvenant:t,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroRelatif2:e.numeroRelatif2,elementModifiableParAvenant:e.elementModifiableParAvenant,cdIndexationTauxProgressAmort:e.cdIndexTauxProgressionAmort,codeOccurAbsorbeePhasePalier:e.codeOccurabsorbeePhasePalier}},t.getListePalierTauxAmortissement=function(e,t,n){var i=this;return _.isEmpty(e.palierProgAmors)?[]:_.map(e.palierProgAmors,function(e){return i.getPalierTauxAmortissement(e,t,n)})},t.getPalierTauxAmortissement=function(e,t,n){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:n?"U":null,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,numeroPremiereEcheancePalier:e.numeroPremiereEcheance,numeroDerniereEcheancePalier:e.numeroDerniereEcheance,tauxProgressionAmortissement:e.tauxProgAmor,uniteDureePhase:e.uniteDureePhase,numeroRelatif1:e.numeroRelatif1,numeroRelatifSimulationAvenant:t,noPhaseCreditProchaineRevision:e.numPhaseCreditProchaineRev,numeroRelatif2:e.numeroRelatif2,elementModifiableParAvenant:e.elementModifiableParAvenant,cdIndexationTauxProgressAmort:e.cdIndexTauxProgAmor,codeOccurAbsorbeePhasePalier:e.codeOccurAbsorbeePhasePalier}},t.getListeParametresRevisionTaux=function(e,t,n,i,r){var a=this;return _.map(e.parametresRevisionTaux||[],function(e){return a.getParametreRevisionTaux(e,t,n,i,r)})},t.getParametreRevisionTaux=function(e,t,n,i,r){return{codeEtablissement:e.paramRevTauxRest.codeEtablissement,identifiantCredit:e.paramRevTauxRest.identifiantCredit,codeRoleCreditAvenant:n?e.paramRevTauxRest.codeRoleCreditAvenant:null,numeroPhase:0!==e.numeroPhase?e.numeroPhase:e.paramRevTauxRest.numeroPhase,codeTypePhase:e.paramRevTauxRest.codeTypePhase,partieFixeUnTauxComposite:e.paramRevTauxRest.partieFixeUnTauxComposite,valeurCoeffParametreRevision:e.paramRevTauxRest.valeurCoeffParametreRevision,valeurCoeffParametreRevision1:e.paramRevTauxRest.valeurCoeffParametreRevision1,modeExpressionButoirTauxBaisse:e.paramRevTauxRest.modeExpressionButoirTauxBaisse,modeExpressionButoirTauxHausse:e.paramRevTauxRest.modeExpressionButoirTauxHausse,numeroRelatif:e.paramRevTauxRest.numeroRelatif,numeroRelatifSimulationAvenant:t,noPhaseCreditProchaineRevision:e.paramRevTauxRest.noPhaseCreditProchaineRevision,numeroJeuIndicesRevision:n&&i?r:e.paramRevTauxRest.numeroJeuIndicesRevision,numeroPeriodeRevision:e.paramRevTauxRest.numeroPeriodeRevision,identifiantLoiRevision:e.paramRevTauxRest.identifiantLoiRevision,codeEcheanceRecalculeeRevision:e.paramRevTauxRest.codeEcheanceRecalculeeRevision,codeUnitePeriodeDebutRevision:e.paramRevTauxRest.codeUnitePeriodeDebutRevision,dureePeriodeRevision:e.paramRevTauxRest.dureePeriodeRevision,uniteDureePeriodeRevision:e.paramRevTauxRest.uniteDureePeriodeRevision,typeIndexationTaux:e.paramRevTauxRest.typeIndexationTaux,elementModifiableParAvenant:e.paramRevTauxRest.elementModifiableParAvenant,codeTypeRoleIndice:e.paramRevTauxRest.codeTypeRoleIndice,numRelatifPhaseTypePhaseProduit:e.paramRevTauxRest.noRelatifPhaseTypePhaseProduit,nbEcheanceAvantRecalculMontant:e.paramRevTauxRest.nmbrEcheanceAvtRecalculMontant,evntDeclencheurDebutPeriode:e.paramRevTauxRest.evenemntDeclencheurDebutPeriode,nbPeriodePourDeterDebutPeriode:e.paramRevTauxRest.nbrPeriodePrDeterminerDbtPeriod,modeExpressValeurUtilisIndice:e.paramRevTauxRest.mdExpressionValeurUtilisIndice}},t.getParametreRevisionTauxInit=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:null,numeroPhase:e.numeroPhase,codeTypePhase:e.codeTypePhase,partieFixeUnTauxComposite:e.partieFixeUnTauxComposite,valeurCoeffParametreRevision:e.valeurCoeffParametreRevision,valeurCoeffParametreRevision1:e.valeurCoeffParametreRevision1,modeExpressionButoirTauxBaisse:e.modeExpressionButoirTauxBaisse,modeExpressionButoirTauxHausse:e.modeExpressionButoirTauxHausse,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:t,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroJeuIndicesRevision:e.numeroJeuIndicesRevision,numeroPeriodeRevision:e.numeroPeriodeRevision,identifiantLoiRevision:e.identifiantLoiRevision,codeEcheanceRecalculeeRevision:e.codeEcheanceRecalculeeRevision,codeUnitePeriodeDebutRevision:e.codeUnitePeriodeDebutRevision,dureePeriodeRevision:e.dureePeriodeRevision,uniteDureePeriodeRevision:e.uniteDureePeriodeRevision,typeIndexationTaux:e.typeIndexationTaux,elementModifiableParAvenant:e.elementModifiableParAvenant,codeTypeRoleIndice:e.codeTypeRoleIndice,numRelatifPhaseTypePhaseProduit:e.noRelatifPhaseTypePhaseProduit,nbEcheanceAvantRecalculMontant:e.nmbrEcheanceAvtRecalculMontant,evntDeclencheurDebutPeriode:e.evenemntDeclencheurDebutPeriode,nbPeriodePourDeterDebutPeriode:e.nbrPeriodePrDeterminerDbtPeriod,modeExpressValeurUtilisIndice:e.mdExpressionValeurUtilisIndice}},t}();t.CaracteristiqueFinanPhaseBuilder=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(){}return t.getAccessoiresServicesObjet=function(t){var n=this;if(null==t||null==t.dataRestAvenant||null==t.dataRestAvenant.dataServicesObjet||null==t.listeElementCalculServicesObjet||t.listeElementCalculServicesObjet.length<1||null==t.dataRestAvenant.dataServicesObjet.listeServiceObjet||t.dataRestAvenant.dataServicesObjet.listeServiceObjet.length<1)return[];var i=e.Commun.Enum.CodeTypeAcces.Annulation.toString(),r=this.getCodeRoleCreditAvenantDefaut(t);return _.map(_.filter(t.listeElementCalculServicesObjet,function(e){return(e.codeTypeAcces!==i||parseInt(e.identifiantService)>100)&&_.any(t.dataRestAvenant.dataServicesObjet.listeServiceObjet,function(t){return e.identifiantService===t.identifiantService})}),function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:n.getCodeRoleCreditAvenant(e.codeRoleCreditAvenant,r),identifiantService:e.identifiantService,numeroPhase:e.numeroPhase,numeroTranche:e.numeroTranche,numeroRelatif1:e.numeroRelatif1,identifiantConvention:e.identifiantConvention,codeTypePhase:e.codeTypePhase,montantElement:e.montantElement,tauxElement:e.tauxElement,mtAssietteAccFixeeContract:e.mtAssietteAccFixeeContract,dateDebutApplicationElement:e.dateDebutApplicationElement,dateFinApplicationElement:e.dateFinApplicationElement,codeActionEcranListe:n.getCodeActionEcranListe(e,t),uniteDureeApplicElement:e.uniteDureeApplicElement,dureeApplicationElement:e.dureeApplicationElement,modeComptaRecouvrAccessoire:n.getModeComptaRecouvrAccessoire(e),numeroRelatif2:0,indicAccessoireCreeParAvenant:e.indicAccessoireCreeParAvenant}})},t.getServicesObjet=function(t){var n=this;if(null==t||null==t.dataRestAvenant||null==t.dataRestAvenant.dataServicesObjet||null==t.listeElementCalculServicesObjet||t.listeElementCalculServicesObjet.length<1||null==t.dataRestAvenant.dataServicesObjet.listeServiceObjet||t.dataRestAvenant.dataServicesObjet.listeServiceObjet.length<1)return[];var i=e.Commun.Enum.CodeTypeAcces.Annulation.toString(),r=this.getCodeRoleCreditAvenantDefaut(t);return _.map(_.filter(t.dataRestAvenant.dataServicesObjet.listeServiceObjet,function(e){return(e.codeTypeAcces!==i||parseInt(e.identifiantService)>100)&&_.any(t.listeElementCalculServicesObjet,function(t){return t.identifiantService===e.identifiantService})}),function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:n.getCodeRoleCreditAvenant(e.codeRoleCreditAvenant,r),identifiantService:e.identifiantService,identifiantConvention:e.identifiantConvention,identifiantObjet:e.identifiantObjet,codeUtilisationObjetDansCredit:e.codeUtilisationObjetDansCredit,dateDebutApplicationElement:e.dateDebutApplicationElement,dateFinApplicationElement:e.dateFinApplicationElement,regleDateEffetAssurParametrable:n.getRegleDateEffet(e.regleDateEffetAssurParametrable),numeroRelatif2:n.getNumeroRelatif2(e),codeActionEcranListe:n.getCodeActionEcranListe(e,t),typeObjet:e.typeObjet}})},t.getCodeRoleCreditAvenantDefaut=function(e){return e.isAvecChangementProduit?"U":" "},t.getCodeRoleCreditAvenant=function(e,t){return null===e?t:e},t.getCodeActionEcranListe=function(t,n){return null===t.dateFinApplicationElement||e.Commun.Tools.DateUtils.isBefore(n.dateEffet,t.dateFinApplicationElement)?t.codeTypeAcces:(console.warn("Le Service sur objet "+t.identifiantService+" sera annulé avec l'avenant car sa fin était au "+e.Commun.Tools.DateUtils.format(t.dateFinApplicationElement)+"."),"A")},t.getModeComptaRecouvrAccessoire=function(e){return e.dureeApplicationElement>0?"1":" "},t.getRegleDateEffet=function(e){return"G05"===e?"G01":e},t.getNumeroRelatif2=function(t){return t.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Creation.toString()?0:t.numeroRelatif1},t}();t.CaracteristiqueFinanServicesObjetBuilder=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){var i=function(){function n(){}return n.getCodeActionPourMiseAJour=function(e,n){switch(void 0===n&&(n=null),e){case t.Enum.EtatManipulation.IsCreation:return"C";case t.Enum.EtatManipulation.IsModified:return"M";case t.Enum.EtatManipulation.ToDelete:return"S";default:return n}},n.getCodeTypeModificationCredit=function(t,n,i,r,a){return i?"PR":_.some(t,function(t){return t===e.Commun.Enum.ModificationCredit.Quantieme})?"03":_.some(t,function(t){return t===e.Commun.Enum.ModificationCredit.AmenagementTemporaireEcheances})?"RE":_.some(t,function(t){return t===e.Commun.Enum.ModificationCredit.ReportFinPret})?a?"S":"NS":r&&_.some(t,function(t){return t===e.Commun.Enum.ModificationCredit.Financier})?"13":_.some(t,function(t){return t===e.Commun.Enum.ModificationCredit.Financier})||_.some(t,function(t){return t===e.Commun.Enum.ModificationCredit.Assurance})&&n?"01":null},n}();n.CaraFinan=i}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.identifiantConvention=e.identifiantConvention,this.codeTypePhase=e.codeTypePhase,this.numeroPhase=e.numeroPhase,this.numRelatifPhaseTypePhaseProduit=e.noRelatifPhaseTypePhaseProduit,this.codeTypeAccessoire=e.codeTypeAccessoire,this.libelleTypeAccessoire=e.libelleTypeAccessoire,this.dateFinApplication=e.dateFinApplication,this.dateDebutApplication=e.dateDebutApplication,this.codeModeCalculAccessoire=e.codeModeCalculAccessoire,this.montantConseilleAccessoire=e.montantConseilleAccessoire,this.montantMinimumPlageAccessoire=e.montantMinimumPlageAccessoire,this.montantMaximumPlageAccessoire=e.montantMaximumPlageAccessoire,this.mtPlafondTrancheCalculAccess=e.mtPlafondTrancheCalculAccessoi,this.tauxConseilleAccessoire=e.tauxConseilleAccessoire,this.tauxMinimumAccessoire=e.tauxMinimumAccessoire,this.tauxMaximumAccessoire=e.tauxMaximumAccessoire,this.mtPlafondTrancheCalculAccess1=e.mtPlafondTrancheCalculAccessoi1,this.tauxElement=e.tauxElement,this.tauxMinimumAccessoire1=e.tauxMinimumAccessoire1,this.tauxMaximumAccessoire1=e.tauxMaximumAccessoire1,this.mtPlafondTrancheCalculAccess2=e.mtPlafondTrancheCalculAccessoi2,this.tauxElement1=e.tauxElement1,this.tauxMinimumAccessoire2=e.tauxMinimumAccessoire2,this.tauxMaximumAccessoire2=e.tauxMaximumAccessoire2,this.mtPlafondTrancheCalculAccess3=e.mtPlafondTrancheCalculAccessoi3,this.tauxElement2=e.tauxElement2,this.tauxMinimumAccessoire3=e.tauxMinimumAccessoire3,this.tauxMaximumAccessoire3=e.tauxMaximumAccessoire3,this.mtPlafondTrancheCalculAccess4=e.mtPlafondTrancheCalculAccessoi4,this.tauxElement3=e.tauxElement3,this.tauxMinimumAccessoire4=e.tauxMinimumAccessoire4,this.tauxMaximumAccessoire4=e.tauxMaximumAccessoire4,this.montantMinimumAccessoireCalcule=e.montantMinimumAccessoireCalcule,this.montantMaximumAccessoireCalcule=e.montantMaximumAccessoireCalcule,this.tauxAccessoirePersonnesAgees=e.tauxAccessoirePersonnesAgees,this.mtPasMontantAccessoire=e.mtPasMontantAccessoire,this.regleAppelAccessoireAperiodique=e.regleAppelAccessoireAperiodique,this.libelleStandard=e.libelleStandard,this.codeTypeAssietteCalculAccess=e.codeTypeAssietteCalculAccessoi,this.dureeApplicationAccessoire=e.dureeApplicationAccessoire,this.periodiciteApplicationAccess=e.periodiciteApplicationAccessoi,this.numeroRegleApplicationAccess=e.numeroRegleApplicationAccessoi,this.indicateurBanalise=e.indicateurBanalise,this.numeroTranche=e.numeroTranche,this.ageMinimumEntreeAssurance=e.ageMinimumEntreeAssurance,this.ageMaximumEntreeAssurance=e.ageMaximumEntreeAssurance,this.dureeApplicationAccess=e.dureeApplicationAccess,this.uniteDureeApplicAccess=e.uniteDureeApplicAccess,this.codeTypeApplicationAccessoire=e.codeTypeApplicationAccessoire,this.cdCommissionIntervenantExterne=e.cdCommissionIntervenantExterne,this.nbJoursAnneeNumerateur=e.nbJoursAnneeNumerateur,this.nbJoursAnneeDenominateur=e.nbJoursAnneeDenominateur}return e}();e.AccessoireConventionAdapaterCaraFinan=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.identifiantConvention=e.identifiantConvention,this.codeTypeAssurance=e.codeTypeAssurance,this.libelleCourtTypeAssurance=e.libelleCourtTypeAssurance,this.numeroExterneConvention=e.numeroExterneConvention,this.libelleLongConvention=e.libelleLongConvention,this.datePriseEffetConvention=e.datePriseEffetConvention,this.dateFinEffetConvention=e.dateFinEffetConvention,this.ageMaximumEntreeAssurance=e.ageMaximumEntreeAssurance,this.mtMinimumCreditConvention=e.mtMinimumCreditParConvention,this.mtMaximumCreditConvention=e.mtMaximumCreditParConvention,this.unitePeriodeConditObtentionConv=e.unitePeriodeConditObtentionConv,this.dureeMiniCreditObtentionConv=e.dureeMiniCreditParObtentionConv,this.dureeMaxiCreditObtentionConv=e.dureeMaxiCreditParObtentionConv,this.cdModeExpressionGarantieAccorde=e.cdModeExpressionGaranAccordee,this.quotiteMinimumParBeneficiaire=e.quotiteMinimumParBeneficiaire,this.quotiteMaximumParBeneficiaire=e.quotiteMaximumParBeneficiaire,this.pasQuotiteParBeneficiaire=e.pasQuotiteParBeneficiaire,this.montantMinimumGarantiParTete=e.montantMinimumGarantiParTete,this.montantMaximumGarantiParTete=e.montantMaximumGarantiParTete,this.pasMontantGarantiParTete=e.pasMontantGarantiParTete,this.codeTiersGaranti=e.codeTiersGaranti,this.codeTypeObjetAutorise=e.codeTypeObjetAutorise,this.ageMinimumEntreeAssurance=e.ageMinimumEntreeAssurance,this.ageMaximumCouvertureAssurance=e.ageMaximumCouvertureAssurance,this.cdPosibiliteExtensionCouverture=e.cdPossibiliteExtensionCouv,this.montantMaximumEncoursGaranti=e.montantMaximumEncoursGaranti,this.dureeMaxiPrefiPourConvention=e.dureeMaxiPrefiPourConvention,this.dureeMaxiDifTotalPourConvention=e.dureeMaxiDifTotalPourConvention,this.dureeMaxiDifAmortPourConvention=e.dureeMaxiDifAmortPourConvention,this.dureeMaxiAmortisspourConvention=e.dureeMaxiAmortisspourConvention,this.montantPlafondEncoursDelegation=e.montantPlafondEncoursDelegation,this.regleDateEffetAssurgarantie=e.regleDateEffetAssurgarantie,this.ageMaximumCouvertureEnExtension=e.ageMaximumCouvertureEnExtension,this.codeTypeConvention=e.codeTypeConvention,this.codeNatureGarantie=e.codeNatureGarantie,this.codeNatureCautionnement=e.codeNatureCautionnement,this.identifiantIntervenant=e.identifiantIntervenant,this.cdCommissionIntervenantExterne=e.cdCommissionIntervenantExterne,this.codeFamilleProduit=e.codeFamilleProduit,this.numeroRelatifProduit=e.numeroRelatifProduit,this.codeRestitution=e.codeRestitution,this.codeTypeAccessoireConvention=e.codeTypeAccessoireConvention,this.codeIdentificationConventionJur=e.codeIdentificationConventionJur}return e}();e.ConventionApplicableCatalogueAdapater=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.numeroPhase=e.numeroPhase,this.numeroRelatif=e.numeroRelatif,this.codeTypeAccessoire=e.codeTypeAccessoire,this.libelleTypeAccessoire=e.libelleTypeAccessoire,this.dureeApplicationElement=e.dureeApplicationElement,this.periodiciteApplicationElement=e.periodiciteApplicationElement,this.numeroRegleApplicationElement=e.numeroRegleApplicationElement,this.montantElement=e.montantElement,this.codeTypeAssietteCalculElement=e.codeTypeAssietteCalculElement,this.mtPlafondTrancheCalculAccess=e.mtPlafondTrancheCalculAccessoi,this.tauxElement=e.tauxElement,this.mtPlafondTrancheCalculAccess1=e.mtPlafondTrancheCalculAccessoi1,this.tauxElement1=e.tauxElement1,this.mtPlafondTrancheCalculAccess2=e.mtPlafondTrancheCalculAccessoi2,this.tauxElement2=e.tauxElement2,this.mtPlafondTrancheCalculAccess3=e.mtPlafondTrancheCalculAccessoi3,this.tauxElement3=e.tauxElement3,this.mtPlafondTrancheCalculAccess4=e.mtPlafondTrancheCalculAccessoi4,this.tauxElement4=e.tauxElement4,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.numeroRelatif1=e.numeroRelatif1,this.codeActionEcranListe=e.codeActionEcranListe,this.codeModeCalculAccessoire=e.codeModeCalculAccessoire,this.nbJoursAnneeNumerateur=e.nbJoursAnneeNumerateur,this.nbJoursAnneeDenominateur=e.nbJoursAnneeDenominateur,this.identifiantAssurance=null,this.codeTypePhase=null,this.numRelatifPhaseTypePhaseProduit=null,this.codeModeCalculTaux=null,this.mtAssietteAcessFixeeContract=null,this.numeroTranche=null,this.codeTypeAccessoireConvention=null}return e}();e.EltCalculAdapaterCaraFinan=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.numeroCredit=e.identifiantCredit,this.numeroRelatif=e.numeroRelatif,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.identifiantPersonneEstAssure=e.identifiantPersonneEstAssure,this.libelleTiers=e.libelleTiers,this.dateNaissance=e.dateNaissance,this.typeRolePersonne=e.typeRolePersonne,this.roleLIntervenant=e.roleLIntervenant,this.codeTypePersonne=e.codeTypePersonne,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant}return e}();e.PersonneAssurableOuGarantCatalogueAdapater=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.codeTypeAccessoire=e.codeTypeAccessoire,this.codeTypePhase=e.codeTypePhase,this.numeroPhase=e.numeroPhase,this.numRelatifPhaseTypePhaseProduit=e.numRelatifPhaseTypePhaseProduit,this.dateFinApplication=e.dateFinApplicationElement,this.dateDebutApplication=e.dateDebutApplicationElement,this.codeModeCalculAccessoire=e.codeModeCalculAccessoire?e.codeModeCalculAccessoire:e.codeModeCalculAccessoire1,this.codeModeCalculAccessoire1=e.codeModeCalculAccessoire1,this.montantConseilleAccessoire=e.montantConseilleAccessoire,this.montantMinimumPlageAccessoire=e.montantMinimumPlageAccessoire,this.montantMaximumPlageAccessoire=e.montantMaximumPlageAccessoire,this.mtPlafondTrancheCalculAccess=e.mtPlafondTrancheCalculAccess,this.tauxConseilleAccessoire=e.tauxConseilleAccessoire,this.tauxMinimumAccessoire=e.tauxMinimumAccessoire,this.tauxMaximumAccessoire=e.tauxMaximumAccessoire,this.mtPlafondTrancheCalculAccess1=e.mtPlafondTrancheCalculAccess1,this.tauxElement=e.tauxElement,this.tauxMinimumAccessoire1=e.tauxMinimumAccessoire1,this.tauxMaximumAccessoire1=e.tauxMaximumAccessoire1,this.mtPlafondTrancheCalculAccess2=e.mtPlafondTrancheCalculAccess2,this.tauxElement1=e.tauxElement1,this.tauxMinimumAccessoire2=e.tauxMinimumAccessoire2,this.tauxMaximumAccessoire2=e.tauxMaximumAccessoire2,this.mtPlafondTrancheCalculAccess3=e.mtPlafondTrancheCalculAccess3,this.tauxElement2=e.tauxElement2,this.tauxMinimumAccessoire3=e.tauxMinimumAccessoire3,this.tauxMaximumAccessoire3=e.tauxMaximumAccessoire3,this.mtPlafondTrancheCalculAccess4=e.mtPlafondTrancheCalculAccess4,this.tauxElement3=e.tauxElement3,this.tauxMinimumAccessoire4=e.tauxMinimumAccessoire4,this.tauxMaximumAccessoire4=e.tauxMaximumAccessoire4,this.regleAppelAccessoireAperiodique=e.regleAppelAccessoireAperiodique,this.libelleStandard=e.libelleTypeAccessoire,this.codeTypeAssietteCalculAccess=e.codeTypeAssietteCalculElement,this.dureeApplicationAccessoire=e.dureeApplicationAccessoire,this.periodiciteApplicationAccess=e.periodiciteApplicationAccess,this.numeroRegleApplicationAccess=e.numeroRegleApplicationAccess,this.uniteDureeApplicAccess=e.uniteDureeApplicAccess,this.codeTypeApplicationAccessoire=e.codeTypeApplicationAccessoire,this.nbJoursAnneeNumerateur=e.nbJoursAnneeNumerateur,this.nbJoursAnneeDenominateur=e.nbJoursAnneeDenominateur,this.libelleTypeAccessoire=e.libelleTypeAccessoire,this.mtPasMontantAccessoire=e.mtPasMontantAccessoire}return e}();e.AccessoireConventionAdapterCaraFinan=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(){function t(){}return t.getResult=function(t){return{codeEtablissement:t.accessoireParConvention.codeEtablissement,identifiantCredit:null,codeRoleCreditAvenant:t.codeRoleCreditAvenant,identifiantAssurance:t.identifiantAssurance,numeroPhase:t.numeroPhase,numeroRelatif:t.numeroRelatif,codeTypeAccessoire:t.accessoireParConvention.codeTypeAccessoire,codeTypePhase:t.codeTypePhase,numRelatifPhaseTypePhaseProduit:null,libelleTypeAccessoire:t.libelleTypeAccessoire,dureeApplicationElement:t.accessoireParConvention.dureeApplicationAccessoire,periodiciteApplicationElement:t.periodiciteApplicationElement,numeroRegleApplicationElement:t.numeroRegleApplicationElement,montantElement:t.detailAccessoire.elementUn.montant,codeTypeAssietteCalculElement:t.codeTypeAssietteCalculElement,mtPlafondTrancheCalculAccess:t.detailAccessoire.elementUn.montantPlafond,tauxElement:t.detailAccessoire.elementUn.taux,mtPlafondTrancheCalculAccess1:t.detailAccessoire.elementDeux?t.detailAccessoire.elementDeux.montantPlafond:t.accessoireParConvention.mtPlafondTrancheCalculAccess1,tauxElement1:t.detailAccessoire.elementDeux?t.detailAccessoire.elementDeux.taux:t.accessoireParConvention.tauxElement1,mtPlafondTrancheCalculAccess2:t.detailAccessoire.elementTrois?t.detailAccessoire.elementTrois.montantPlafond:t.accessoireParConvention.mtPlafondTrancheCalculAccess2,tauxElement2:t.detailAccessoire.elementTrois?t.detailAccessoire.elementTrois.taux:t.accessoireParConvention.tauxElement2,mtPlafondTrancheCalculAccess3:t.detailAccessoire.elementQuatre?t.detailAccessoire.elementQuatre.montantPlafond:t.accessoireParConvention.mtPlafondTrancheCalculAccess3,tauxElement3:t.detailAccessoire.elementQuatre?t.detailAccessoire.elementQuatre.taux:t.accessoireParConvention.tauxElement3,mtPlafondTrancheCalculAccess4:t.detailAccessoire.elementCinq?t.detailAccessoire.elementCinq.montantPlafond:t.accessoireParConvention.mtPlafondTrancheCalculAccess4,tauxElement4:t.detailAccessoire.elementCinq?t.detailAccessoire.elementCinq.taux:t.accessoireParConvention.tauxElement3,numeroRelatifSimulationAvenant:null,numeroRelatif1:t.numeroRelatif,codeModeCalculTaux:null,codeActionEcranListe:null,codeModeCalculAccessoire:t.accessoireParConvention.codeModeCalculAccessoire,uniteDureeApplicElement:t.accessoireParConvention.uniteDureeApplicAccess,numeroRegleApplicationAccess:t.accessoireParConvention.numeroRegleApplicationAccess,regleAppelAccessoireAperiodique:t.accessoireParConvention.regleAppelAccessoireAperiodique,codeModeCalculAccessoire1:t.codeModeCalculAccessoire1,numeroRegleCalculElement:null,quotiteCouvertureCredit:null,montantMinimumAccessoireCalcule:t.accessoireParConvention.montantMinimumAccessoireCalcule,montantMaximumAccessoireCalcule:t.accessoireParConvention.montantMaximumAccessoireCalcule,mtMiniAccessPourRecouvrement:null,codeAccessCalculTxEffectifGlob:t.codeAccessoireCalculTEG,codeAppelLecheance:null,indicateurAccessoireObligatoire:t.indicateurAccessoireObligatoire,indicateurAccessoireValide:t.indicateurAccessoireValide,indicateurAccessoireAnnuleAv:t.indicateurAccessoireAnnuleAv,indicAccessoireCreeParAvenant:t.indicAccessoireCreeParAvenant,nombreEcheancesAccessReport:null,codeNatureAccessoire:t.codeNatureAccessoire,identifiantConvention:t.accessoireParConvention.identifiantConvention,identifiantProduit:null,libelleLongConvention:null,tauxConseilleAccessoire:0,montantConseilleAccessoire:0,tauxConseilleAccessoire1:0,tauxConseilleAccessoire2:0,tauxConseilleAccessoire3:0,tauxConseilleAccessoire4:0,montantMinimumPlageAccessoire:t.accessoireParConvention.montantMinimumPlageAccessoire,montantMaximumPlageAccessoire:t.accessoireParConvention.montantMaximumPlageAccessoire,mtPasMontantAccessoire:t.accessoireParConvention.mtPasMontantAccessoire,tauxMinimumAccessoire:0,tauxMaximumAccessoire:0,tauxMinimumAccessoire1:0,tauxMaximumAccessoire1:0,tauxMinimumAccessoire2:0,tauxMaximumAccessoire2:0,tauxMinimumAccessoire3:0,tauxMaximumAccessoire3:0,tauxMinimumAccessoire4:0,tauxMaximumAccessoire4:0,libelleTypeAssieteCalcul:t.libelleTypeAssiette,dateDebutApplicationElement:t.accessoireParConvention.dateDebutApplication,dateFinApplicationElement:null!=t.dateFin?e.Commun.Tools.DateUtils.format(t.dateFin,e.Commun.Constantes.Format.DATE_REST):t.accessoireParConvention.dateFinApplication,dateAppelAccessoire:null,noPhaseCreditProchaineRevision:null,numeroRelatif2:null,libelleStandard:t.libelleStandard,regleDateDebutApplicatAccess:t.regleDateDebutApplicatAccess,regleEvenementDeclench1erAppel:t.regleEvenementDeclench1erAppel,regleDateDebutAppliAccCatalogue:t.regleDateDebutAppliAccCatalogue?t.regleDateDebutAppliAccCatalogue:t.regleDateDebutApplicatAccess,regleEvenementDech1erAppelCata:t.regleEvenementDeclench1erAppel,periodiciteApplicationAccess:t.accessoireParConvention.periodiciteApplicationAccess,numeroTranche:t.accessoireParConvention.numeroTranche,modeComptaRecouvrAccessoire:null,montantAccessoireAEtaler:null,dureeApplicationAccessoire:t.accessoireParConvention.dureeApplicationAccess,uniteDureeApplicAccess:t.accessoireParConvention.uniteDureeApplicAccess,identifiantService:null,identifiantTiers:null,codeSousTypeAccessoireCompl:t.codeSousTypeAccessoireCompl,codeTypeApplicationAccessoire:t.accessoireParConvention.codeTypeApplicationAccessoire,codeTypologieAccessoire:null,codeIndicateurDerogationBornes:null,codeIndicateurBornesDerogees:null,nbJoursAnneeNumerateur:t.accessoireParConvention.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:t.accessoireParConvention.nbJoursAnneeDenominateur}},t}();t.AccessoireAnnexeAdapaterProduitBuilder=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.codeEtablissement=e.codeEtablissement,this.codeTypeAccessoire=e.codeTypeAccessoire,this.codeTypePhase=e.codeTypePhase,this.numeroPhase=e.numeroPhase,this.numRelatifPhaseTypePhaseProduit=e.noRelatifPhaseTypePhaseProduit,this.dateFinApplication=e.dateFinApplicationElement,this.dateDebutApplication=e.dateDebutApplicationElement,this.codeModeCalculAccessoire=e.codeModeCalculAccessoire1,this.montantConseilleAccessoire=e.montantConseilleAccessoire,this.montantMinimumPlageAccessoire=e.montantMinimumPlageAccessoire,this.montantMaximumPlageAccessoire=e.montantMaximumPlageAccessoire,this.mtPlafondTrancheCalculAccess=e.mtPlafondTrancheCalculAccess,
this.tauxConseilleAccessoire=e.tauxConseilleAccessoire,this.tauxMinimumAccessoire=e.tauxMinimumAccessoire,this.tauxMaximumAccessoire=e.tauxMaximumAccessoire,this.mtPlafondTrancheCalculAccess1=e.mtPlafondTrancheCalculAccess1,this.tauxElement=e.tauxElement,this.tauxMinimumAccessoire1=e.tauxMinimumAccessoire1,this.tauxMaximumAccessoire1=e.tauxMaximumAccessoire1,this.mtPlafondTrancheCalculAccess2=e.mtPlafondTrancheCalculAccess2,this.tauxElement1=e.tauxElement1,this.tauxMinimumAccessoire2=e.tauxMinimumAccessoire2,this.tauxMaximumAccessoire2=e.tauxMaximumAccessoire2,this.mtPlafondTrancheCalculAccess3=e.mtPlafondTrancheCalculAccess3,this.tauxElement2=e.tauxElement2,this.tauxMinimumAccessoire3=e.tauxMinimumAccessoire3,this.tauxMaximumAccessoire3=e.tauxMaximumAccessoire3,this.mtPlafondTrancheCalculAccess4=e.mtPlafondTrancheCalculAccess4,this.tauxElement3=e.tauxElement3,this.tauxMinimumAccessoire4=e.tauxMinimumAccessoire4,this.tauxMaximumAccessoire4=e.tauxMaximumAccessoire4,this.regleAppelAccessoireAperiodique=e.regleAppelAccessoireAperiodique,this.libelleStandard=e.libelleTypeAccessoire,this.codeTypeAssietteCalculAccess=e.codeTypeAssietteCalculElement,this.dureeApplicationAccessoire=e.dureeApplicationAccessoire,this.periodiciteApplicationAccess=e.periodiciteApplicationAccess,this.numeroRegleApplicationAccess=e.numRegleApplicationAccessoire,this.uniteDureeApplicAccess=e.uniteDureeApplicAccess,this.codeTypeApplicationAccessoire=e.codeTypeApplicationAccessoire,this.nbJoursAnneeNumerateur=e.nbJoursAnneeNumerateur,this.nbJoursAnneeDenominateur=e.nbJoursAnneeDenominateur,this.libelleTypeAccessoire=e.libelleTypeAccessoire,this.mtPasMontantAccessoire=e.mtPasMontantAccessoire}return e}();e.AccessoireAdapterCaraFinan=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function t(t){var n=this;this.codeEtablissement=t.codeEtablissement,this.identifiantCredit=t.identifiantCredit,this.codeRoleCreditAvenant=t.codeRoleCreditAvenant,this.identifiantProduit=t.identifiantProduit,this.libelleLongProduit=t.libelleLongProduit,this.libelleTiers=t.libelleTiers,this.dateEffet=t.dateEffet,this.montantEcheance=t.montantEcheance,this.montantOrigineCredit=t.montantOrigineCredit,this.codeDevise=t.codeDevise,this.dureeCredit=t.dureeCredit,this.uniteDureeCredit=t.uniteDureeCredit,this.dateEcheance=t.dateEcheance,this.tauxNominalCredit=t.tauxNominalCredit,this.dateMiseRecouvrementZero=t.dateMiseRecouvrementZero,this.codeModeExpressionTaux=t.codeModeExpressionTaux,this.codeTauxCreditDirecteur=t.codeTauxCreditDirecteur,this.codeCristallisationTauxInteret=t.codeCristallisationTauxInteret,this.codeActionPourMiseAJour=t.codeActionPourMiseAJour,this.montantEcheanceMER=t.montantEcheanceMER,this.montantFraisGestion=t.montantFraisGestion,this.montantArrieresIncorporesCrd=t.montantArrieresIncorporesCrd,this.codeTraitementFinVersement=t.codeTraitementFinVersement,this.numeroQuantiemeDateEcheance=t.numeroQuantiemeDateEcheance,this.codeIndiceNominal=t.codeIndiceNominal,this.margeAppliquerSurTauxNominal=t.margeAppliquerSurTauxNominal,this.montantCapitalRestantSurCredit=t.montantCapitalRestantSurCredit,this.codeTypeRecalculTA=t.codeTypeRecalculTA,this.dateCreation=t.dateCreation,this.dateFinPrefinancementReelle=t.dateFinPrefinancementReelle,this.codeIntegrationFraisCrd=t.codeIntegrationFraisCrd,this.identifiantProfilRenegociation=t.identifiantProfilRenegociation,this.codeTypeAvenant=t.codeTypeAvenant,this.codeTypeModificationCredit=t.codeTypeModificationCredit,this.numeroRelatif=t.numeroRelatif,this.numeroRelatifSimulationAvenant=t.numeroRelatifSimulationAvenant,this.numeroModaliteRembAnticipe=t.numModaliteRemboursemntAnticipe,this.tauxIndemniteRA=t.tauxIndemniteRA,this.tauxInteretPrefinancement=t.tauxInteretPrefinancement,this.codeCreditSecurisable=t.codeCreditSecurisable,this.dateFinCredit=t.dateFinCredit,this.codePresenceRevisionSurCredit=t.codePresenceRevisionSurCredit,this.montantIntcompsurCR=t.montantIntcompsurCR,this.cdTypeArrieresIncorporeCrd=t.cdTypeArrieresIncorporeCrd,this.typeLoi=t.typeLoi,this.nbMaxiPeriodeAllongPourRevision=t.nbMaxiPeriodeAllongPourRevision,this.nbMaxiPerallsortieCptCourant=t.nbMaxiPerallsortieCptCourant,this.nbMaxiPerallongPourModulation=t.nbMaxiPerallongPourModulation,this.mtCapitalRestantSurCredit=t.mtCapitalRestantSurCredit,this.codeCategorieEmprunteur=t.codeCategorieEmprunteur,this.typeObjetFinanceGaranti=t.typeObjetFinanceGaranti,this.montantActualiseCredit=t.montantActualiseCredit,this.montantGlobalGarantiCredit=t.montantGlobalGarantiCredit,this.codeSousTypeAvenantRecouvrement=t.codeSousTypeAvenantRecouvrement,this.codeNatureFinancement=t.codeNatureFinancement,this.codeTypeMarche=t.codeTypeMarche,this.dateSignature=t.dateSignature,this.dateEffetInitialeLAvenant=t.dateEffetInitialeLAvenant,this.dateDecisionEmission=t.dateDecisionEmission,this.dureeAjusteeCreditSuiteRecalcul=t.dureeAjusteeCreditSuiteRecalcul,this.dateSaisieLEvenement=t.dateSaisieLEvenement,this.dateEmission=t.dateEmission,this.etatBrancheAccessoireEdgAvenant=t.etatBrancheAccessoireEdgAvenant,this.delaiMinimumAcceptation=t.delaiMinimumAcceptation,this.delaiRetractation=t.delaiRetractation,this.commentaireProduits=t.commentaireProduits,this.montantMAfondsDemandees=t.montantMAfondsDemandees,this.codeEcheancierVersemcontractuel=t.codeEcheancierVersemcontractuel,this.codeTypePretCombine=t.codeTypePretCombine,this.codePresenceServiceObjet=t.codePresenceServiceObjet,this.existenceAccessoireBonMajTaux=t.existenceAccessoireBonMajTaux,this.cumulDesBonifsMajorations=t.cumulBonificationsMajorations,this.codeIndicateurIntegrationCrd=t.codeIndicateurIntegrationCrd,this.tauxInteretsRetardImpaye=t.tauxInteretsRetardImpaye,this.phases=_.map(t.phases,function(t){return new e.PhaseInfoCreditAdapaterCaraFinan(t)}),this.echeancesReportees=t.echeancesReportees,this.echeancesAmenagees=[],this.assurances=[],this.garantiesExistantes=[],this.garantiesSuretesReelles=[],this.accessoires=_.map(t.accessoires,function(e){return n.getAccessoire(e)}),this.garantie=null,this.phasesBis=[],this.garantiesSuretesPerso=[],this.informationsMenage=[],this.informationsEmprunteur=null,this.personnePayeurs=[],this.accessoiresBis=[],this.garantiesApplicables=[],this.motifsEstimations=[],this.servicesObjet=[],this.accessoiresServicesObjet=[]}return t.prototype.getAccessoire=function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantAssurance:e.identifiantAssurance,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,codeTypeAccessoire:e.codeTypeAccessoire,codeTypePhase:e.codeTypePhase,numRelatifPhaseTypePhaseProduit:e.noRelatifPhaseTypePhaseProduit,libelleTypeAccessoire:e.libelleTypeAccessoire,dureeApplicationElement:e.dureeApplicationElement,periodiciteApplicationElement:e.periodiciteApplicationElement,numeroRegleApplicationElement:e.numeroRegleApplicationElement,montantElement:e.montantElement,codeTypeAssietteCalculElement:e.codeTypeAssietteCalculElement,mtPlafondTrancheCalculAccess:e.mtPlafondTrancheCalculAccess,tauxElement:e.tauxElement,mtPlafondTrancheCalculAccess1:e.mtPlafondTrancheCalculAccess1,tauxElement1:e.tauxElement1,mtPlafondTrancheCalculAccess2:e.mtPlafondTrancheCalculAccess2,tauxElement2:e.tauxElement2,mtPlafondTrancheCalculAccess3:e.mtPlafondTrancheCalculAccess3,tauxElement3:e.tauxElement3,mtPlafondTrancheCalculAccess4:e.mtPlafondTrancheCalculAccess4,tauxElement4:e.tauxElement4,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,numeroRelatif1:e.numeroRelatif1,codeModeCalculTaux:e.codeModeCalculTaux,codeActionEcranListe:e.codeActionEcranListe,codeModeCalculAccessoire:e.codeModeCalculAccessoire,uniteDureeApplicElement:e.uniteDureeApplicElement,numeroRegleApplicationAccess:e.numRegleApplicationAccessoire,regleAppelAccessoireAperiodique:e.regleAppelAccessoireAperiodique,codeModeCalculAccessoire1:e.codeModeCalculAccessoire1,numeroRegleCalculElement:e.numeroRegleCalculElement,quotiteCouvertureCredit:e.quotiteCouvertureCredit,montantMinimumAccessoireCalcule:e.montantMinimumAccessoireCalcule,montantMaximumAccessoireCalcule:e.montantMaximumAccessoireCalcule,mtMiniAccessPourRecouvrement:e.mtMiniAccessPourRecouvrement,codeAccessCalculTxEffectifGlob:e.codeAccessDansCalculTEG,codeAppelLecheance:e.codeAppelLecheance,indicateurAccessoireObligatoire:e.indicateurAccessoireObligatoire,indicateurAccessoireValide:e.indicateurAccessoireValide,indicateurAccessoireAnnuleAv:e.indicateurAccessoireAnnuleAv,indicAccessoireCreeParAvenant:e.indicAccessoireCreeParAvenant,nombreEcheancesAccessReport:e.nbrEcheancesAccessoiresReport,codeNatureAccessoire:e.codeNatureAccessoire,identifiantConvention:e.identifiantConvention,identifiantProduit:e.identifiantProduit,libelleLongConvention:e.libelleLongConvention,tauxConseilleAccessoire:e.tauxConseilleAccessoire,montantConseilleAccessoire:e.montantConseilleAccessoire,tauxConseilleAccessoire1:e.tauxConseilleAccessoire1,tauxConseilleAccessoire2:e.tauxConseilleAccessoire2,tauxConseilleAccessoire3:e.tauxConseilleAccessoire3,tauxConseilleAccessoire4:e.tauxConseilleAccessoire4,montantMinimumPlageAccessoire:e.montantMinimumPlageAccessoire,montantMaximumPlageAccessoire:e.montantMaximumPlageAccessoire,mtPasMontantAccessoire:e.mtPasMontantAccessoire,tauxMinimumAccessoire:e.tauxMinimumAccessoire,tauxMaximumAccessoire:e.tauxMaximumAccessoire,tauxMinimumAccessoire1:e.tauxMinimumAccessoire1,tauxMaximumAccessoire1:e.tauxMaximumAccessoire1,tauxMinimumAccessoire2:e.tauxMinimumAccessoire2,tauxMaximumAccessoire2:e.tauxMaximumAccessoire2,tauxMinimumAccessoire3:e.tauxMinimumAccessoire3,tauxMaximumAccessoire3:e.tauxMaximumAccessoire3,tauxMinimumAccessoire4:e.tauxMinimumAccessoire4,tauxMaximumAccessoire4:e.tauxMaximumAccessoire4,libelleTypeAssieteCalcul:e.libelleTypeAssieteCalcul,dateDebutApplicationElement:e.dateDebutApplicationElement,dateFinApplicationElement:e.dateFinApplicationElement,dateAppelAccessoire:e.dateAppelAccessoire,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroRelatif2:e.numeroRelatif2,libelleStandard:e.libelleStandard,regleDateDebutApplicatAccess:e.regleDateDebutApplicatAccess,regleEvenementDeclench1erAppel:e.regleEvenementDech1erAppelCata,regleDateDebutAppliAccCatalogue:e.regleDateDebutAppliAccCatalogue,regleEvenementDech1erAppelCata:e.regleEvenementDech1erAppelCata,periodiciteApplicationAccess:e.periodiciteApplicationAccess,numeroTranche:e.numeroTranche,modeComptaRecouvrAccessoire:e.modeComptaRecouvrAccessoire,montantAccessoireAEtaler:e.montantAccessoireAEtaler,dureeApplicationAccessoire:e.dureeApplicationAccessoire,uniteDureeApplicAccess:e.uniteDureeApplicAccess,identifiantService:e.identifiantService,identifiantTiers:e.identifiantTiers,codeSousTypeAccessoireCompl:e.codeSousTypeAccessoireCompl,codeTypeApplicationAccessoire:e.codeTypeApplicationAccessoire,codeTypologieAccessoire:e.codeTypologieAccessoire,codeIndicateurDerogationBornes:e.codeIndicateurDerogationBornes,codeIndicateurBornesDerogees:e.codeIndicateurBornesDerogees,nbJoursAnneeNumerateur:e.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:e.nbJoursAnneeDenominateur}},t}();e.CreditInfoCreditAdapaterCaraFinan=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){var t=this;this.codeEtablissement=e.codeEtablissement,this.identifiantCredit=e.identifiantCredit,this.codeRoleCreditAvenant=e.codeRoleCreditAvenant,this.numeroPhase=e.numeroPhase,this.codeTypePhase=e.codeTypePhase,this.numRelatifPhaseTypePhaseProduit=e.noRelatifPhaseTypePhaseProduit,this.libelleLongTypePhase=e.libelleLongTypePhase,this.dureeInitialePhaseCredit=e.dureeInitialePhaseCredit,this.dureeResiduelleCredit=e.dureeResiduelleCredit,this.uniteDureePhase=e.uniteDureePhase,this.tauxNominalPhase=e.tauxNominalPhase,this.codeTauxDesPaliersCalcules=e.codeTauxDesPaliersCalcules,this.tauxMoyenPhaseCredit=e.tauxMoyenPhaseCredit,this.modeCalculAmortissement=e.modeCalculAmortissement,this.quotiteCapitalAmortir=e.quotiteCapitalAmortir,this.periodiciteMERamortissement=e.periodiciteMERamortissement,this.periodiciteCalculInterets=e.periodiciteCalculInterets,this.dateFinPrefinancementInitiale=e.dateFinPrefinancementInitiale,this.codeIndiceNominal=e.codeIndiceNominal,this.margeAppliquerSurTaux=e.margeAppliquerSurTaux,this.typeIndexationTaux=e.typeIndexationTaux,this.numeroRelatif=e.numeroRelatif,this.numeroRelatifSimulationAvenant=e.numeroRelatifSimulationAvenant,this.periodiciteMERInterets=e.periodiciteMiseRecouvrInterets,this.numeroJeuIndicesRevision=e.numeroJeuIndicesRevision,this.noPhaseCreditProchaineRevision=e.noPhaseCreditProchaineRevision,this.elementModifiableParAvenant=e.elementModifiableParAvenant,this.modeCapitRecouvInterets=e.modeCapitRecouvInterets,this.cdModifCaracteristfinancieres=e.cdModifCaracteristfinancieres,this.codeOccurAbsorbeePhasePalier=e.codeOccurabsorbeePhasePalier,this.partieFixeUnTauxComposite=e.partieFixeUnTauxComposite,this.nbJoursDansAnneeDenominateur=e.nbJoursDansAnneeDenominateur,this.nbJoursDansAnneeNumerateur=e.nbJoursDansAnneeNumerateur,this.calculInteretsEnJoursReels=e.calculInteretsEnJoursReels,this.prelevementEnFinPhase=e.prelevementEnFinPhase,this.codeTypeEcretage=e.codeTypeEcretage,this.dureeAjusteePhaseCredit=e.dureeInitialePhaseCredit,this.paliers=_.map(e.paliersTauxInterets,function(e){return t.getPalierTauxInteret(e)}),this.paliersTauxAmortissement=_.map(e.paliersTauxAmortissement,function(e){return t.getPalierTauxAmortissement(e)}),this.pretsCombines=e.pretsCombines,this.parametresRevisionTaux=_.map(e.parametresRevisionTaux,function(e){return t.getParametreRevisionTaux(e)}),this.echeancesALaCarte=[]}return e.prototype.getPalierTauxInteret=function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,numeroPremiereEcheancePalier:e.numeroPremiereEcheancePalier,numeroDerniereEcheancePalier:e.numeroDerniereEcheancePalier,codeIndice:e.codeIndice,margeAppliquerSurTaux:e.margeAppliquerSurTaux,tauxInteretPalier:e.tauxInteretPalier,typeRemboursement:e.typeRemboursement,uniteDureePhase:e.uniteDureePhase,numeroRelatif1:e.numeroRelatif1,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,numeroRelatifPalierProduit:e.numeroRelatifPalierProduit,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroRelatif2:e.numeroRelatif2,elementModifiableParAvenant:e.elementModifiableParAvenant,cdModifCaracteristfinancieres:e.cdModifCaracteristfinancieres,codeOccurAbsorbeePhasePalier:e.codeOccurabsorbeePhasePalier,tauxProgressionDesEcheances:e.tauxProgressionDesEcheances,periodiciteApplicProgreEcheance:e.periodiciteApplicProgreEcheance}},e.prototype.getParametreRevisionTaux=function(e){return{codeEtablissement:e.codeEtablissement,codeRoleCreditAvenant:e.codeRoleCreditAvenant,elementModifiableParAvenant:e.elementModifiableParAvenant,identifiantCredit:e.identifiantCredit,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeEcheanceRecalculeeRevision:e.codeEcheanceRecalculeeRevision,codeTypePhase:e.codeTypePhase,codeTypeRoleIndice:e.codeTypeRoleIndice,codeUnitePeriodeDebutRevision:e.codeUnitePeriodeDebutRevision,dureePeriodeRevision:e.dureePeriodeRevision,identifiantLoiRevision:e.identifiantLoiRevision,modeExpressValeurUtilisIndice:e.mdExpressionValeurUtilisIndice,modeExpressionButoirTauxBaisse:e.modeExpressionButoirTauxBaisse,modeExpressionButoirTauxHausse:e.modeExpressionButoirTauxHausse,nbPeriodePourDeterDebutPeriode:e.nbrPeriodePrDeterminerDbtPeriod,nbEcheanceAvantRecalculMontant:e.nmbrEcheanceAvtRecalculMontant,numRelatifPhaseTypePhaseProduit:e.noRelatifPhaseTypePhaseProduit,numeroJeuIndicesRevision:e.numeroJeuIndicesRevision,numeroPeriodeRevision:e.numeroPeriodeRevision,partieFixeUnTauxComposite:e.partieFixeUnTauxComposite,typeIndexationTaux:e.typeIndexationTaux,uniteDureePeriodeRevision:e.uniteDureePeriodeRevision,valeurCoeffParametreRevision:e.valeurCoeffParametreRevision,valeurCoeffParametreRevision1:e.valeurCoeffParametreRevision1,evntDeclencheurDebutPeriode:e.evenemntDeclencheurDebutPeriode}},e.prototype.getPalierTauxAmortissement=function(e){return{cdIndexationTauxProgressAmort:e.cdIndexTauxProgressionAmort,codeEtablissement:e.codeEtablissement,codeOccurAbsorbeePhasePalier:e.codeOccurabsorbeePhasePalier,codeRoleCreditAvenant:e.codeRoleCreditAvenant,elementModifiableParAvenant:e.elementModifiableParAvenant,identifiantCredit:e.identifiantCredit,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroDerniereEcheancePalier:e.numeroDerniereEcheancePalier,numeroPhase:e.numeroPhase,numeroPremiereEcheancePalier:e.numeroPremiereEcheancePalier,numeroRelatif:e.numeroRelatif,numeroRelatif1:e.numeroRelatif1,numeroRelatif2:e.numeroRelatif2,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,tauxProgressionAmortissement:e.tauxProgressionAmortissement,uniteDureePhase:e.uniteDureePhase}},e}();e.PhaseInfoCreditAdapaterCaraFinan=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getResult=function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantAssurance:e.identifiantAssurance,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,codeTypeAccessoire:e.codeTypeAccessoire,codeTypePhase:e.codeTypePhase,libelleTypeAccessoire:e.libelleTypeAccessoire,dureeApplicationElement:e.dureeApplicationElement,periodiciteApplicationElement:e.periodiciteApplicationElement,numeroRegleApplicationElement:e.numeroRegleApplicationElement,montantElement:e.montantElement,codeTypeAssietteCalculElement:e.codeTypeAssietteCalculElement,tauxElement:e.tauxElement,tauxElement1:e.tauxElement1,tauxElement2:e.tauxElement2,tauxElement3:e.tauxElement3,tauxElement4:e.tauxElement4,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,numeroRelatif1:e.numeroRelatif1,codeModeCalculTaux:e.codeModeCalculTaux,codeActionEcranListe:e.codeActionEcranListe,codeModeCalculAccessoire:e.codeModeCalculAccessoire,uniteDureeApplicElement:e.uniteDureeApplicElement,regleAppelAccessoireAperiodique:e.regleAppelAccessoireAperiodique,codeModeCalculAccessoire1:e.codeModeCalculAccessoire1,numeroRegleCalculElement:e.numeroRegleCalculElement,quotiteCouvertureCredit:e.quotiteCouvertureCredit,montantMinimumAccessoireCalcule:e.montantMinimumAccessoireCalcule,montantMaximumAccessoireCalcule:e.montantMaximumAccessoireCalcule,codeAppelLecheance:e.codeAppelLecheance,indicateurAccessoireObligatoire:e.indicateurAccessoireObligatoire,indicateurAccessoireValide:e.indicateurAccessoireValide,indicateurAccessoireAnnuleAv:e.indicateurAccessoireAnnuleAv,indicAccessoireCreeParAvenant:e.indicAccessoireCreeParAvenant,codeNatureAccessoire:e.codeNatureAccessoire,identifiantConvention:e.identifiantConvention,identifiantProduit:e.identifiantProduit,libelleLongConvention:e.libelleLongConvention,tauxConseilleAccessoire:e.tauxConseilleAccessoire,montantConseilleAccessoire:e.montantConseilleAccessoire,tauxConseilleAccessoire1:e.tauxConseilleAccessoire1,tauxConseilleAccessoire2:e.tauxConseilleAccessoire2,tauxConseilleAccessoire3:e.tauxConseilleAccessoire3,tauxConseilleAccessoire4:e.tauxConseilleAccessoire4,montantMinimumPlageAccessoire:e.montantMinimumPlageAccessoire,montantMaximumPlageAccessoire:e.montantMaximumPlageAccessoire,mtPasMontantAccessoire:e.mtPasMontantAccessoire,tauxMinimumAccessoire:e.tauxMinimumAccessoire,tauxMaximumAccessoire:e.tauxMaximumAccessoire,tauxMinimumAccessoire1:e.tauxMinimumAccessoire1,tauxMaximumAccessoire1:e.tauxMaximumAccessoire1,tauxMinimumAccessoire2:e.tauxMinimumAccessoire2,tauxMaximumAccessoire2:e.tauxMaximumAccessoire2,tauxMinimumAccessoire3:e.tauxMinimumAccessoire3,tauxMaximumAccessoire3:e.tauxMaximumAccessoire3,tauxMinimumAccessoire4:e.tauxMinimumAccessoire4,tauxMaximumAccessoire4:e.tauxMaximumAccessoire4,libelleTypeAssieteCalcul:e.libelleTypeAssieteCalcul,dateDebutApplicationElement:e.dateDebutApplicationElement,dateFinApplicationElement:e.dateFinApplicationElement,dateAppelAccessoire:e.dateAppelAccessoire,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroRelatif2:e.numeroRelatif2,libelleStandard:e.libelleStandard,regleEvenementDeclench1erAppel:e.regleEvenementDeclench1erAppel,regleDateDebutAppliAccCatalogue:e.regleDateDebutAppliAccCatalogue,regleEvenementDech1erAppelCata:e.regleEvenementDech1erAppelCata,numeroTranche:e.numeroTranche,montantAccessoireAEtaler:e.montantAccessoireAEtaler,dureeApplicationAccessoire:e.dureeApplicationAccessoire,uniteDureeApplicAccess:e.uniteDureeApplicAccess,identifiantService:e.identifiantService,identifiantTiers:e.identifiantTiers,codeSousTypeAccessoireCompl:e.codeSousTypeAccessoireCompl,codeTypeApplicationAccessoire:e.codeTypeApplicationAccessoire,codeTypologieAccessoire:e.codeTypologieAccessoire,codeIndicateurDerogationBornes:e.codeIndicateurDerogationBornes,codeIndicateurBornesDerogees:e.codeIndicateurBornesDerogees,nbJoursAnneeNumerateur:e.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:e.nbJoursAnneeDenominateur,noRelatifPhaseTypePhaseProduit:e.noRelatifPhaseTypePhaseProduit,mtPlafondTrancheCalculAccess:e.mtPlafondTrancheCalculAccess,mtPlafondTrancheCalculAccess1:e.mtPlafondTrancheCalculAccess1,mtPlafondTrancheCalculAccess2:e.mtPlafondTrancheCalculAccess2,mtPlafondTrancheCalculAccess3:e.mtPlafondTrancheCalculAccess3,mtPlafondTrancheCalculAccess4:e.mtPlafondTrancheCalculAccess4,numeroRegleApplicationAccess:e.numRegleApplicationAccessoire,mtMiniAccessPourRecouvrement:e.mtMiniAccessPourRecouvrement,codeAccessoireDansCalculTEG:e.codeAccessDansCalculTEG,nbrEcheancesAccessoiresReport:e.nbrEcheancesAccessoiresReport,regleDateDebutApplicatAccess:e.regleDateDebutApplicatAccess,periodiciteApplicationAccess:e.periodiciteApplicationAccess,modeComptaRecouvraccessoire:e.modeComptaRecouvrAccessoire}},e}();e.AccessoireInfoCreditAdapaterProduitBuilder=t;var n=function(){function e(){}return e.getResult=function(e){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.identifiantCredit,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantAssurance:e.identifiantAssurance,numeroPhase:e.numeroPhase,numeroRelatif:e.numeroRelatif,codeTypeAccessoire:e.codeTypeAccessoire,codeTypePhase:e.codeTypePhase,libelleTypeAccessoire:e.libelleTypeAccessoire,dureeApplicationElement:e.dureeApplicationElement,periodiciteApplicationElement:e.periodiciteApplicationElement,numeroRegleApplicationElement:e.numeroRegleApplicationElement,montantElement:e.montantElement,codeTypeAssietteCalculElement:e.codeTypeAssietteCalculElement,tauxElement:e.tauxElement,tauxElement1:e.tauxElement1,tauxElement2:e.tauxElement2,tauxElement3:e.tauxElement3,tauxElement4:e.tauxElement4,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,numeroRelatif1:e.numeroRelatif1,codeModeCalculTaux:e.codeModeCalculTaux,codeActionEcranListe:e.codeActionEcranListe,codeModeCalculAccessoire:e.codeModeCalculAccessoire,uniteDureeApplicElement:e.uniteDureeApplicElement,regleAppelAccessoireAperiodique:e.regleAppelAccessoireAperiodique,codeModeCalculAccessoire1:e.codeModeCalculAccessoire1,numeroRegleCalculElement:e.numeroRegleCalculElement,quotiteCouvertureCredit:e.quotiteCouvertureCredit,montantMinimumAccessoireCalcule:e.montantMinimumAccessoireCalcule,montantMaximumAccessoireCalcule:e.montantMaximumAccessoireCalcule,codeAppelLecheance:e.codeAppelLecheance,indicateurAccessoireObligatoire:e.indicateurAccessoireObligatoire,indicateurAccessoireValide:e.indicateurAccessoireValide,indicateurAccessoireAnnuleAv:e.indicateurAccessoireAnnuleAv,indicAccessoireCreeParAvenant:e.indicAccessoireCreeParAvenant,codeNatureAccessoire:e.codeNatureAccessoire,identifiantConvention:e.identifiantConvention,identifiantProduit:e.identifiantProduit,libelleLongConvention:e.libelleLongConvention,tauxConseilleAccessoire:e.tauxConseilleAccessoire,montantConseilleAccessoire:e.montantConseilleAccessoire,tauxConseilleAccessoire1:e.tauxConseilleAccessoire1,tauxConseilleAccessoire2:e.tauxConseilleAccessoire2,tauxConseilleAccessoire3:e.tauxConseilleAccessoire3,tauxConseilleAccessoire4:e.tauxConseilleAccessoire4,montantMinimumPlageAccessoire:e.montantMinimumPlageAccessoire,montantMaximumPlageAccessoire:e.montantMaximumPlageAccessoire,mtPasMontantAccessoire:e.mtPasMontantAccessoire,tauxMinimumAccessoire:e.tauxMinimumAccessoire,tauxMaximumAccessoire:e.tauxMaximumAccessoire,tauxMinimumAccessoire1:e.tauxMinimumAccessoire1,tauxMaximumAccessoire1:e.tauxMaximumAccessoire1,tauxMinimumAccessoire2:e.tauxMinimumAccessoire2,tauxMaximumAccessoire2:e.tauxMaximumAccessoire2,tauxMinimumAccessoire3:e.tauxMinimumAccessoire3,tauxMaximumAccessoire3:e.tauxMaximumAccessoire3,tauxMinimumAccessoire4:e.tauxMinimumAccessoire4,tauxMaximumAccessoire4:e.tauxMaximumAccessoire4,libelleTypeAssieteCalcul:e.libelleTypeAssieteCalcul,dateDebutApplicationElement:e.dateDebutApplicationElement,dateFinApplicationElement:e.dateFinApplicationElement,dateAppelAccessoire:e.dateAppelAccessoire,noPhaseCreditProchaineRevision:e.noPhaseCreditProchaineRevision,numeroRelatif2:e.numeroRelatif2,libelleStandard:e.libelleStandard,regleEvenementDeclench1erAppel:e.regleEvenementDeclench1erAppel,regleDateDebutAppliAccCatalogue:e.regleDateDebutAppliAccCatalogue,regleEvenementDech1erAppelCata:e.regleEvenementDech1erAppelCata,numeroTranche:e.numeroTranche,montantAccessoireAEtaler:e.montantAccessoireAEtaler,dureeApplicationAccessoire:e.dureeApplicationAccessoire,uniteDureeApplicAccess:e.uniteDureeApplicAccess,identifiantService:e.identifiantService,identifiantTiers:e.identifiantTiers,codeSousTypeAccessoireCompl:e.codeSousTypeAccessoireCompl,codeTypeApplicationAccessoire:e.codeTypeApplicationAccessoire,codeTypologieAccessoire:e.codeTypologieAccessoire,codeIndicateurDerogationBornes:e.codeIndicateurDerogationBornes,codeIndicateurBornesDerogees:e.codeIndicateurBornesDerogees,nbJoursAnneeNumerateur:e.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:e.nbJoursAnneeDenominateur,numRelatifPhaseTypePhaseProduit:e.noRelatifPhaseTypePhaseProduit,mtPlafondTrancheCalculAccess:e.mtPlafondTrancheCalculAccess,mtPlafondTrancheCalculAccess1:e.mtPlafondTrancheCalculAccess1,mtPlafondTrancheCalculAccess2:e.mtPlafondTrancheCalculAccess2,mtPlafondTrancheCalculAccess3:e.mtPlafondTrancheCalculAccess3,mtPlafondTrancheCalculAccess4:e.mtPlafondTrancheCalculAccess4,numeroRegleApplicationAccess:e.numeroRegleApplicationAccess,mtMiniAccessPourRecouvrement:e.mtMiniAccessPourRecouvrement,codeAccessCalculTxEffectifGlob:e.codeAccessoireDansCalculTEG,nombreEcheancesAccessReport:e.nbrEcheancesAccessoiresReport,regleDateDebutApplicatAccess:e.regleDateDebutApplicatAccess,periodiciteApplicationAccess:e.periodiciteApplicationAccess,modeComptaRecouvrAccessoire:e.modeComptaRecouvraccessoire}},e}();e.AccessoireProduitAdapaterCaraFinanBuilder=n}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){this.entreeCalculatricePret=0}return Object.defineProperty(e.prototype,"isRechercheParDuree",{get:function(){return 0===this.entreeCalculatricePret},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRechercheParEcheance",{get:function(){return 1===this.entreeCalculatricePret},enumerable:!0,configurable:!0}),e}();e.CalculatricePretNonLissage=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.Object,a=e.Commun.ToolsFunctionals.Taux,o=e.Commun.ToolsFunctionals.Credit,s=e.Commun.ToolsFunctionals.Periodicite,u=e.Commun.ToolsFunctionals.FonctionsAvenant,c=e.Commun.ToolsFunctionals.PeriodiciteConverter,l="M",d=function(){function d(e,i,a,o,u,d,m){this.identifiantProduit=e.identifiantProduit;var h=this.getConditionTaux(i,a),p=this.getPhaseReference(m);this._dureeAjusteeCreditSuiteRecalcul=e.dureeAjusteeCreditSuiteRecalcul,this.unitePeriodicite=null!=p?p.periodiciteMiseRecouvrInterets:l,this.dureeResiduelle=this._dureeResiduelleInitiale=this.getDureeResiduelle(e),this.dureeTotale=this._dureeTotaleInitiale=e.dureeAjusteeCreditSuiteRecalcul,this._deltaDuree=this.dureeTotale-this.dureeResiduelle,this.dureeResiduelleMinimum=this.getDureeMin(this._deltaDuree,i),this.dureeResiduelleMaximum=this.getDureeMax(this._deltaDuree,i),this.dureeResiduellePas=c.getPeriodiciteMensuelle(this.unitePeriodicite,1),this.libelleHelpDureeResiduelle="["+this.dureeResiduelleMinimum+" .. "+this.dureeResiduelleMaximum+" ; "+this.dureeResiduellePas+"]",this.libelleErreurDureeResiduelle=null,this.dureeTotaleMinimum=this.dureeResiduelleMinimum+this._deltaDuree,this.dureeTotaleMaximum=this.dureeResiduelleMaximum+this._deltaDuree,this.libelleHelpDureeTotale="["+this.dureeTotaleMinimum+" .. "+this.dureeTotaleMaximum+"]",this.modeCalculTaux=this.getModeCalculTaux(m,i.phases);var f=n.findOrEmpty(e.phases,function(t){return"AM"===t.codeTypePhase&&t.numeroPhase>=e.numeroPhase});this.taux=_.isEmpty(f)?e.tauxInteretPalier:f.tauxNominalPhase,this.tauxMinimum=null!=h?h.tauxMoyenMinimumCredit:0,this.tauxMaximum=null!=h?h.tauxMoyenMaximumCredit:100,this.libelleHelpTaux="["+r.numberToString(this.tauxMinimum,2)+" .. "+r.numberToString(this.tauxMaximum,2)+"]",this.marge=e.margeAppliquerSurTauxNominal,this.calculatricePretNonLissage=new t.CalculatricePretNonLissage,this.isPhaseAmortissementEnCours="AM"===e.codeTypePhase,this.montantCrd=this._montantCrdInitial=e.montantCapitalRestantSurCredit,this.montantOrigineCredit=this._montantOrigineCreditInitial=e.montantOrigineCredit,this.montantCreditAvantAvenant=e.montantActualiseCredit,this.montantGarantiAvantAvenant=e.montantGlobalGarantiCredit,this.uniteDureeCredit=e.uniteDureeCredit,this.libelleUniteDureeCredit=s.getLibellePeriode(e.uniteDureeCredit,!0),this.libellePeriodiciteAmortissement=s.getLibellePeriodicite(this.unitePeriodicite),this.libelleHelpMontantCrd="["+r.numberToString(i.montantMinimumCredit,2)+" .. "+r.numberToString(i.montantMaximumCredit,2)+"]",this.majDataFromDureeResiduelle(2,this.dureeResiduelle,this.echeanceSouhaitee,this.taux),this.echeanceOrigine=this.echeance,this.depassementCapacite=!1,this.numeroProchaineEcheance=e.numeroEcheance,this.numeroQuantiemeDateEcheance=e.numeroQuantiemeDateEcheance,this.numeroQuantiemeSaisi=e.numeroQuantiemeDateEcheance,this.conditionTauxProduitSel=t.FonctionsChPourInit.getConditionTauxProduitPourCredit(i.conditionsTauxProduit,a,this.identifiantProduit,e.dureeAjusteeCreditSuiteRecalcul),this.isCreditDirecteur=this.fctIsCreditDirecteur(o,e.codeTauxCreditDirecteur),this.activerTauxCredit=this.fctActiverTauxCredit(this.conditionTauxProduitSel,i.codeTauxCreditDirecteur,e.codeModeExpressionTaux,o,d),this.tauxCredit=o?e.tauxNominalCredit:e.tauxInteretPalier;var A=this.getModaliteDirecteur(e,i),P=this.getTauxMinMaxDirecteur(e,A,this.conditionTauxProduitSel);this.tauxMinimumDirecteur=P[0],this.tauxMaximumDirecteur=P[1],this.showIndiceCredit=this.fctShowIndiceCredit(this.conditionTauxProduitSel,e,m),this.activerIndiceCredit=this.fctActiverIndiceCredit(this.conditionTauxProduitSel,d,o),this.indiceTauxCredits=this.showIndiceCredit?this.getIndiceCredit(this.conditionTauxProduitSel,u,i.phases,e.codeRoleCreditAvenant,e.codeIndiceNominal,m.codePresenceRevisionSurCredit):[],this.indiceTauxCredit=this.indiceTauxCredits.length>0?n.firstOrEmpty(this.indiceTauxCredits):"",this.showMargeCredit=this.fctShowMargeCredit(i.codeTauxCreditDirecteur,this.conditionTauxProduitSel),
this.activerMargeCredit=this.fctActiverMarge(this.conditionTauxProduitSel,d,o,this.showMargeCredit),this.margeTauxCredit=e.margeAppliquerSurTauxNominal;var v=this.getMargeMinMaxDirecteur(A,this.conditionTauxProduitSel);if(this.margeMinimumDirecteur=v[0],this.margeMaximumDirecteur=v[1],this.isCreditDirecteur){this.phaseSel=n.findOrEmpty(e.phases,function(e){return"AM"===e.codeTypePhase&&1===e.noRelatifPhaseTypePhaseProduit&&"O"===e.elementModifiableParAvenant}),this.paramRevTauxSel=n.findOrEmpty(this.phaseSel.parametresRevisionTaux,function(e){return"I1"===e.codeTypeRoleIndice&&("I"===e.mdExpressionValeurUtilisIndice||"C"===e.mdExpressionValeurUtilisIndice||"M"===e.mdExpressionValeurUtilisIndice)}),this.phaseProduitSel=n.findOrEmpty(i.phases,function(e){return"AM"===e.codeTypePhase&&1===e.noRelatifPhaseTypePhaseProduit}),this.parametreRevisionProduits=[];for(var g=0,C=i.phases;g<C.length;g++)for(var E=C[g],b=0,T=E.parametresRevision;b<T.length;b++){var y=T[b];this.parametreRevisionProduits.push(y)}}this.isAllongementDureeLimite=!1,this.deltaDureeAllongement=0,this.codeTypeRecalculTA="1"}return d.prototype.majCapitalCrdWithFrais=function(e,t){null!=e&&e.isToIntegreCrd&&(this.isPhaseAmortissementEnCours?this.montantCrd=this._montantCrdInitial:this.montantOrigineCredit=this._montantOrigineCreditInitial),t.isToIntegreCrd&&(this.isPhaseAmortissementEnCours?this.montantCrd=this._montantCrdInitial+t.montant:this.montantOrigineCredit=this._montantOrigineCreditInitial+t.montant),this.majDataFromDureeResiduelle(3,this.dureeResiduelle,this.echeanceSouhaitee)},d.prototype.majDataFromDureeResiduelle=function(e,t,n,i){void 0===i&&(i=null),this.depassementCapacite=!1;var r=this.isPhaseAmortissementEnCours?this.montantCrd:this.montantOrigineCredit;if(2!==e||this.getIsTauxValid(i))if(0!==e||this.getIsDureeResiduelleValid(t))if(1!==e||this.getIsEcheanceValid(n)){var a=2===e?i:this.taux,o=this.getTauxEquivalent(this.modeCalculTaux,this.uniteDureeCredit,a);switch(e){case 0:this.majDureeTotaleByDureeResiduelle(t),this.echeance=this.getNewEcheance(o,t,r,this.uniteDureeCredit);break;case 1:var s=this.getNewDureeResiduelle(o,n,r);this.dureeResiduelle=isNaN(s)?0:s,this.majDureeTotaleByDureeResiduelle(this.dureeResiduelle);var u=this.echeance=this.getNewEcheance(o,this.dureeResiduelle,r,this.uniteDureeCredit);this.depassementCapacite=u===1/0,this.echeance=isNaN(u)||u===1/0?0:u;break;case 2:case 3:this.echeance=this.getNewEcheance(o,this.dureeResiduelle,r,this.uniteDureeCredit)}}else this.echeance=0,this.dureeResiduelle=0,this.dureeTotale=this._deltaDuree;else this.echeance=0,this.dureeTotale=this._deltaDuree,this.libelleErreurDureeResiduelle=isNaN(t)||this.getDureePeriodiciteIsValid(t)?"Calcul impossible":"La durée résiduelle doit être multiple de la périodicité";else this.echeance=0},d.prototype.getPhaseReference=function(e){return"PF"!==e.codeTypePhase?_.find(e.phases,function(t){return t.numeroPhase===e.numeroPhase}):_.first(_.filter(e.phases,function(e){return"PF"!==e.codeTypePhase}))},d.prototype.getModeCalculTaux=function(e,t){var n=this.getPhaseProduitReference(e,t),i=null!=n?n.codeModeCalculTaux:null;return o.getModeCalculTaux(i)},d.prototype.getPhaseProduitReference=function(e,t){if("PF"!==e.codeTypePhase){var n=_.find(e.phases,function(t){return t.numeroPhase===e.numeroPhase});return _.find(t,function(t){return t.noRelatifPhaseTypePhaseProduit===n.noRelatifPhaseTypePhaseProduit&&t.codeTypePhase===e.codeTypePhase})}return _.first(_.filter(t,function(e){return"PF"!==e.codeTypePhase}))},d.prototype.getDureeResiduelle=function(e){var t=i.parse(e.dateEffet),n=i.parse(e.dateFinCredit),r=i.parse(e.dateMiseRecouvrementZero);return i.isBefore(t,r)?moment(n).diff(moment(r),"months"):moment(n).diff(moment(t),"months")},d.prototype.getTauxEquivalent=function(t,n,i){var r=a.getTauxFromModeToMode(i,n,t,e.Commun.Enum.ModeCalculTaux.EquivalentPeriodique);return a.roundDecimal(r,4)/100},d.prototype.getNewEcheance=function(t,n,i,r){var a=e.Commun.ToolsFunctionals.FonctionsAvenant.simulConvDuree(l,n,r,0);if(0===t)return i/a;var o=1-Math.pow(1+t,-1*a),s=t/o;return i*s},d.prototype.getNewDureeResiduelle=function(e,t,n){var i;if(0===e)i=n/t;else{var r=1-n*e/t;i=-Math.log(r)/Math.log(1+e)}return Math.round(i+.5)},d.prototype.isTauxValid=function(){return this.getIsTauxValid(this.taux)},d.prototype.getIsTauxValid=function(e){return!isNaN(e)&&e>=this.tauxMinimum&&e<=this.tauxMaximum},d.prototype.isDureeResiduelleValid=function(){return this.getIsDureeResiduelleValid(this.dureeResiduelle)},d.prototype.getIsDureeResiduelleValid=function(e){return!isNaN(e)&&e>=this.dureeResiduelleMinimum&&e<=this.dureeResiduelleMaximum&&this.getDureePeriodiciteIsValid(e)},d.prototype.getDureePeriodiciteIsValid=function(e){var t=u.simulConvDuree(l,e,l,365),n=u.simulConvDuree(this.unitePeriodicite,1,l,365);return t%n===0},d.prototype.isDureeTotaleValid=function(){return!isNaN(this.dureeTotale)&&this.dureeTotale>=this.dureeTotaleMinimum&&this.dureeTotale<=this.dureeTotaleMaximum},d.prototype.isEcheanceValid=function(){return this.getIsEcheanceValid(this.echeance)},d.prototype.getIsEcheanceValid=function(e){return!isNaN(e)&&e>0},d.prototype.getConditionTaux=function(e,t){return n.findOrEmpty(e.conditionsTauxProduit,function(e){return moment(t).isBetween(e.dateDebutApplication,e.dateFinApplication,"day")})},d.prototype.getDureeMin=function(e,t){var n=this.getDureeMinCalcule(e,t);return n>0?n:1},d.prototype.getDureeMinCalcule=function(e,t){if("2"===t.modeExpressionDureeCredit)return t.dureeCredit-e;if("1"===t.modeExpressionDureeCredit){var n=t.dureeCredit-e;return this.getIsDureeMinValide(t.dureeCredit1,e,n)?t.dureeCredit1-e:this.getIsDureeMinValide(t.dureeCredit2,e,n)?t.dureeCredit2-e:this.getIsDureeMinValide(t.dureeCredit3,e,n)?t.dureeCredit3-e:this.getIsDureeMinValide(t.dureeCredit4,e,n)?t.dureeCredit4-e:n}return 0},d.prototype.getIsDureeMinValide=function(e,t,n){var i=t-e;return n>i&&i>0},d.prototype.getDureeMax=function(e,t){if("2"===t.modeExpressionDureeCredit)return t.dureeCredit1-e;if("1"===t.modeExpressionDureeCredit){var n=t.dureeCredit-e;return t.dureeCredit1-e>n?t.dureeCredit1-e:t.dureeCredit2-e>n?t.dureeCredit2-e:t.dureeCredit3-e>n?t.dureeCredit3-e:t.dureeCredit4-e>n?t.dureeCredit4-e:n}return 0},d.prototype.getDeltaDureeTotale=function(){return this._dureeTotaleInitiale-this.dureeTotale},d.prototype.getDureeAjusteeCreditSuiteRecalcul=function(){var e=this.dureeResiduelle-this._dureeResiduelleInitiale;return 0!==e?this._dureeAjusteeCreditSuiteRecalcul+u.simulConvDuree(l,e,this.uniteDureeCredit,365):this._dureeAjusteeCreditSuiteRecalcul},d.prototype.majDureeTotaleByDureeResiduelle=function(e){this.dureeTotale=e+this._deltaDuree},d.prototype.fctActiverTauxCredit=function(t,n,i,r,a){return a!==e.Commun.Enum.CodeTypeAcces.Creation&&a!==e.Commun.Enum.CodeTypeAcces.Modification&&a!==e.Commun.Enum.CodeTypeAcces.Duplication||"O"!==n||"3"===t.codeModeExpressionTaux||!r||"5"===i?!1:!0},d.prototype.fctIsCreditDirecteur=function(e,t){return e&&"O"===t?!0:!1},d.prototype.getModaliteDirecteur=function(e,t){return n.findOrEmpty(t.modalites,function(n){return n.codeFamilleProduit===t.codeFamilleProduit&&n.numeroRelatifProduit===t.numeroRelatifProduit&&n.numModaliteRemboursemntAnticipe===e.numModaliteRemboursemntAnticipe})},d.prototype.getTauxMinMaxDirecteur=function(e,t,n){var i=isNaN(t.surcoutTauxRA)?0:t.surcoutTauxRA,r=e.cumulBonificationsMajorations;return"2"===n.codeModeExpressionTaux||"4"===n.codeModeExpressionTaux&&"O"!==e.codePresenceRevisionSurCredit?[n.tauxMoyenMinimumCredit+i+r,n.tauxMoyenMaximumCredit+i+r]:"4"===n.codeModeExpressionTaux?[i,100]:[0,0]},d.prototype.fctActiverIndiceCredit=function(t,n,i){return"3"!==t.codeModeExpressionTaux&&"4"!==t.codeModeExpressionTaux||"INDX"!==t.codeIndice||n!==e.Commun.Enum.CodeTypeAcces.Creation&&n!==e.Commun.Enum.CodeTypeAcces.Modification&&n!==e.Commun.Enum.CodeTypeAcces.Duplication||!i?!1:!0},d.prototype.fctShowIndiceCredit=function(e,t,n){if("3"===e.codeModeExpressionTaux||"4"===e.codeModeExpressionTaux){if("INDX"===e.codeIndice)return!0;if("4"!==e.codeModeExpressionTaux&&("O"===n.codePresenceRevisionSurCredit||""===t.codeRoleCreditAvenant||""!==t.codeIndiceNominal))return!0}return!1},d.prototype.getIndiceCredit=function(e,t,n,i,r,a){var o=[];if("3"===e.codeModeExpressionTaux||"4"===e.codeModeExpressionTaux)if("INDX"===e.codeIndice&&t.length>0)for(var s=!1,u=0,c=t;u<c.length;u++){var l=c[u];s=!1;for(var d=0,m=n;d<m.length;d++){var h=m[d];if(s)break;for(var p=0,f=h.parametresRevision;p<f.length;p++){var A=f[p];if(A.codeIndice===l.codeIndice){o.push(l.codeIndice),s=!0;break}}}}else if("4"!==e.codeModeExpressionTaux&&("O"===a||""===i||""!==r)&&t.length>0)for(var P=0,v=t;P<v.length;P++){var l=v[P];""!==r&&(l.codeIndice===r?o.push(l.codeIndice):l.codeIndice===e.codeIndice&&o.push(l.codeIndice))}return o},d.prototype.fctShowMargeCredit=function(e,t){return"O"!==e||"3"!==t.codeModeExpressionTaux&&"4"!==t.codeModeExpressionTaux?!1:!0},d.prototype.fctActiverMarge=function(t,n,i,r){return r&&(n===e.Commun.Enum.CodeTypeAcces.Creation||n===e.Commun.Enum.CodeTypeAcces.Modification||n===e.Commun.Enum.CodeTypeAcces.Duplication)&&i?!0:!1},d.prototype.getMargeMinMaxDirecteur=function(e,t){var n=isNaN(e.surcoutTauxRA)?0:e.surcoutTauxRA;return"3"===t.codeModeExpressionTaux?[t.tauxMoyenMinimumCredit+n,t.tauxMoyenMaximumCredit+n]:[0,0]},d.prototype.majDureeResiduelleFromPhaseDT=function(e,t){return this._dureeResiduelleInitiale+(e-t)},d.prototype.majDureeTotaleFromPhaseDT=function(e,t){return this._dureeTotaleInitiale+(e-t)},d}();t.CreditAvenantFinancier=d}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){var n=e.Commun.ToolsFunctionals.FonctionsAvenant,i=function(){function e(){}return e.getPhaseWithPaliersAjustes=function(e,t,i,r,a){var o=this;if(e.numeroPhase<t.numeroPhase)return e;var s=_.max(_.map(e.listePalier,function(e){return e.numeroPalier}));return e.listePalier=_.map(e.listePalier,function(n){return e.numeroPhase>t.numeroPhase||e.numeroPhase===t.numeroPhase&&n.numeroPalier>=t.numeroPalier?o.getPalierAjuste(n,n.numeroPhase===t.numeroPhase&&n.numeroPalier===t.numeroPalier,r===n.numeroPhase&&s===n.numeroPalier,i,a):n}),a&&(e.duree=_.reduce(e.listePalier,function(t,i){return t+n.simulConvDuree(e.periodiciteCalculInterets.codePeriode,i.duree||0,e.uniteDureePhase,365)},0)),e},e.getPalierAjuste=function(e,t,n,i,r){var a=angular.copy(e);return t||(a.numeroPremiereEcheance-=i,a.listeEcheanceALaCarte.length>0&&(_.first(a.listeEcheanceALaCarte).numeroEcheance=a.numeroPremiereEcheance)),r&&n?a.duree+=i:a.numeroDerniereEcheance-=i,a},e}();t.AjustementPalier=i}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.getAssuranceContientCrdIn=function(e){var t=this;return _.some(e,function(e){return t.getAccessoiresContientCrdIn(e.listeAccessoire)})},e.getAccessoiresContientCrdIn=function(e){return _.some(e,function(e){return"33"===e.codeTypeAssietteCalculElement&&"A03"===e.numeroRegleApplicationElement})},e.estCreditLoiLemoine202311_2=function(e,t){return null!=e&&"P"===e.codeTypeMarche&&("03"===e.codeNatureFinancement&&_.contains(["001","003","004","006"],e.typeObjetFinanceGaranti)||this.estCreditTravauxAmeliorationLoiLemoine202311_2(e,t))},e.estCreditLoiLemoine202311=function(e,t,n){return null!=e&&null!==e.codeNatureFinancement&&null!=e.typeObjetFinanceGaranti?this.estCreditLoiLemoine202311_2(e,n):this.estCreditLoiLemoine202311_2(t,n)},e.estCreditTravauxAmeliorationLoiLemoine202311_2=function(e,t){return"05"===e.codeNatureFinancement&&"005"===e.typeObjetFinanceGaranti&&(null===t||void 0===t.typeObjetReglementeTor||"11"===t.typeObjetReglementeTor)},e.estCreditTravauxAmeliorationLoiLemoine202311=function(e,t,n){return null!=e&&null!==e.codeNatureFinancement&&null!=e.typeObjetFinanceGaranti?this.estCreditTravauxAmeliorationLoiLemoine202311_2(e,n):this.estCreditTravauxAmeliorationLoiLemoine202311_2(t,n)},e}();e.Assurance=t}(t=e.ToolsFunctionals||(e.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){var i=e.Commun.ToolsFunctionals.FonctionsAvenant,r=e.Commun.Tools.List,a=function(){function e(){}return e.getListePaliersWithScission=function(e,t){var n,i=angular.copy(e.listePalier),r=_.find(e.listePalier,function(e){return e.numeroPremiereEcheance<=t+1&&e.numeroDerniereEcheance>=t+1});if(null===r||void 0===r)return i;if(r.numeroPremiereEcheance===t+1)return i;n=angular.copy(r),n.listeEcheanceALaCarte=[],r.numeroDerniereEcheance=t,r.duree=r.numeroDerniereEcheance+1-r.numeroPremiereEcheance,n.numeroPremiereEcheance=t+1,n.duree=n.numeroDerniereEcheance+1-n.numeroPremiereEcheance,n.numeroRelatif=n.numeroRelatif+1,n.numeroPalier=n.numeroPalier+1,n.elementModifiableParAvenant=r.elementModifiableParAvenant,r.elementModifiableParAvenant="N",n.cdModifCaracteristfinancieres=r.cdModifCaracteristfinancieres,r.cdModifCaracteristfinancieres="",_.each(i,function(e){e.numeroRelatif>=n.numeroRelatif&&e.numeroPhase===n.numeroPhase&&(e.numeroRelatif+=1)});var a=_.findIndex(i,function(e){return e.numeroRelatif===r.numeroRelatif});return i.splice(a,1,r),i.splice(a+1,0,n),i},e.scissionPalierTauxInteretsAte=function(e,t,n){var i,r=n+t.echeancesReportees,a=angular.copy(e.listePalier),o=_.find(a,function(e){return e.numeroPremiereEcheance<=r+1&&e.numeroDerniereEcheance>=r+1});if(null===o||void 0===o)return a;if(o.numeroPremiereEcheance===r+1)return a;i=angular.copy(o),o.numeroDerniereEcheance=r,o.duree=o.numeroDerniereEcheance+1-o.numeroPremiereEcheance,i.numeroPremiereEcheance=r+1,i.duree=i.numeroDerniereEcheance+1-i.numeroPremiereEcheance,i.numeroRelatif=i.numeroRelatif+1,i.numeroPalier=i.numeroPalier+1,i.cdModifCaracteristfinancieres=o.cdModifCaracteristfinancieres,o.cdModifCaracteristfinancieres="",_.each(a,function(e){e.numeroRelatif>=i.numeroRelatif&&e.numeroPhase===i.numeroPhase&&(e.numeroRelatif+=1)});var s=_.findIndex(a,function(e){return e.numeroRelatif===o.numeroRelatif});return a.splice(s,1,o),a.splice(s+1,0,i),_.each(a,function(e){e.numeroPremiereEcheance>=n+1&&e.numeroDerniereEcheance<=r&&(e.typeRemboursement="9")}),a},e.getPalierProgAmorWithScission=function(e,t){var n=angular.copy(e.palierProgAmors),i={},a=r.findOrEmpty(e.palierProgAmors,function(e){return e.numeroPremiereEcheance<=t+1&&e.numeroDerniereEcheance>=t+1});if(_.isEmpty(a))return n;if(a.numeroPremiereEcheance===t+1)return n;i=angular.copy(a),a.numeroDerniereEcheance=t,i.numeroPremiereEcheance=t+1,i.numeroRelatif=i.numeroRelatif+1,i.numeroPalier=i.numeroPalier+1,i.elementModifiableParAvenant=a.elementModifiableParAvenant,a.elementModifiableParAvenant="N",_.each(n,function(e){e.numeroRelatif>=i.numeroRelatif&&e.numeroPhase===i.numeroPhase&&(e.numeroRelatif+=1)});var o=_.findIndex(n,function(e){return e.numeroRelatif===a.numeroRelatif});return n.splice(o,1,a),n.splice(o+1,0,i),n},e.scissionPalierProgAmorAte=function(e,t,n){var i=n+t.echeancesReportees,a=angular.copy(e.palierProgAmors),o={},s=r.findOrEmpty(a,function(e){return e.numeroPremiereEcheance<=i+1&&e.numeroDerniereEcheance>=i+1});if(_.isEmpty(s))return a;if(s.numeroPremiereEcheance===i+1)return a;o=angular.copy(s),s.numeroDerniereEcheance=i,o.numeroPremiereEcheance=i+1,o.numeroRelatif=o.numeroRelatif+1,o.numeroPalier=o.numeroPalier+1,_.each(a,function(e){e.numeroRelatif>=o.numeroRelatif&&e.numeroPhase===o.numeroPhase&&(e.numeroRelatif+=1)});var u=_.findIndex(a,function(e){return e.numeroRelatif===s.numeroRelatif});return a.splice(u,1,s),a.splice(u+1,0,o),a},e.renumerotationPalierTauxInteretNumeroPhase=function(e,t){_.each(e,function(e){e.numeroPremiereEcheance>=t+1&&(e.numeroPhase+=1)})},e.renumerotationPalierProgAmorNumeroPhase=function(e,t){_.each(e,function(e){e.numeroPremiereEcheance>=t+1&&(e.numeroPhase+=1)})},e.renumerotationPalierTauxInteretNumeroRelatif=function(e,t){var n=0;_.each(e,function(e){e.numeroPhase===t.numeroPhase&&(n+=1,e.numeroRelatif=n)})},e.renumerotationPalierProgAmorNumeroRelatif=function(e,t){var n=0;_.each(e,function(e){e.numeroPhase===t.numeroPhase&&(n+=1,e.numeroRelatif=n)})},e.scissionParametreRevisionTaux=function(e,t){var n,i=[];return 1===e.length?(n=angular.copy(e[0]),n.numeroPhase=t.numeroPhase,i.push(n),i):i},e.renumerotationParamRevTaux=function(e,t){_.each(e,function(e){_.each(e.parametresRevisionTaux||[],function(e){e.numeroPhase>t.numeroPhase&&(e.numeroPhase+=1)})})},e.scissionPhaseEnCours=function(e,t,n,r){if("PF"===e.codeTypePhase)return null;var a,o=t-n+1,s=r-t;return a=angular.copy(e),a.numeroPhase+=1,e.phaseModifieeAte=!0,a.phaseModifieeAte=!0,e.isScission=!0,a.isScission=!0,e.duree=i.simulConvDuree(e.periodiciteCalculInterets.codePeriode,o,e.uniteDureePhase,365),a.duree=i.simulConvDuree(a.periodiciteCalculInterets.codePeriode,s,a.uniteDureePhase,365),a.elementModifiableParAvenant=e.elementModifiableParAvenant,e.elementModifiableParAvenant="N",e.isPhaseActive=!1,a.isPhaseActive=!0,a.cdModifCaracFinanciere=e.cdModifCaracFinanciere,e.cdModifCaracFinanciere="","O"===e.prelevementEnFinPhase&&(e.prelevementEnFinPhase="N",a.prelevementEnFinPhase="O"),_.each(a.listePalier,function(e){return e.listeEcheanceALaCarte=[]}),a},e.dupplicationAccessoireNouvellePhase=function(e,t){var n=angular.copy(e);return n.numeroPhase=t,n.titreNumPhase="Phase "+t,n},e.scissionAccessoiresComplementaires=function(e,n,i){for(var r=e,a=i?n-1:n,o=0,s=r;o<s.length;o++){var u=s[o];u.etatManipulationAccessoire===t.Enum.EtatManipulation.Unchanged&&u.numeroPhase>=a&&(u.etatManipulationAccessoire=t.Enum.EtatManipulation.IsCreation,this.SetAccessoireAnnexeIndicateurAccessoireValide(u))}return r},e.scissionListeObjetAvecListeAccessoire=function(e,n,i,r){for(var a=angular.copy(e),o=1,s={},u=r?n-1:n,c=0,l=a;c<l.length;c++){for(var d=l[c],m={},h=0,p=d.listeAccessoire;h<p.length;h++){var f=p[h];if(f.numeroPhase===u){m=f;break}}if(!_.isEmpty(m)){_.each(d.listeAccessoire,function(e){e.numeroPhase>u&&(i&&r?e.numeroPhase+=2:e.numeroPhase+=1,e.titreNumPhase="Phase "+e.numeroPhase)}),m=this.dupplicationAccessoireNouvellePhase(m,n),i&&(s=this.dupplicationAccessoireNouvellePhase(m,n+1));var A=_.findIndex(d.listeAccessoire,function(e){return e.numeroPhase===u});if(d.listeAccessoire.splice(A,1,m),i){var P=_.findIndex(d.listeAccessoire,function(e){return e.numeroPhase===n});d.listeAccessoire.splice(P+1,0,s)}}}for(var v=0,g=a;v<g.length;v++)for(var d=g[v],C=0,E=d.listeAccessoire;C<E.length;C++){var f=E[C];f.numeroRelatif=o,o+=1}for(var b=0,T=a;b<T.length;b++)for(var d=T[b],y=0,M=d.listeAccessoire;y<M.length;y++){var D=M[y];D.etatManipulationAccessoire=t.Enum.EtatManipulation.IsModified}return a},e.SetAccessoireAnnexeIndicateurAccessoireValide=function(e){return(e.etatManipulationAccessoire===t.Enum.EtatManipulation.IsModified||e.etatManipulationAccessoire===t.Enum.EtatManipulation.IsCreation)&&(e.indicateurAccessoireValide="0"),e},e.getNuepFinPhasePourAssiette=function(e,t){for(var n=0,i=0,r=e.listePalier;i<r.length;i++){var a=r[i];a.numeroPhase===t&&n<a.numeroDerniereEcheance&&(n=a.numeroDerniereEcheance)}return n},e.modificationAssietteAccAssu=function(e,t,n,i){for(var r,a,o,s=angular.copy(e),u=!1,c={},l=0,d=i;l<d.length;l++){var m=d[l];if("O"===m.elementModifiableParAvenant&&(u="PF"!==n.codeTypePhase&&m.numeroPhase===n.numeroPhase&&n.numeroEcheance===t,!u)){a="",r="",o="";for(var h=0,p=s;h<p.length;h++)for(var f=p[h],A=0,P=f.listeAccessoire;A<P.length;A++){var v=P[A];"C"!==v.codeRoleCreditAvenant&&"O"!==v.codeRoleCreditAvenant&&""!==v.identifiantAssurance&&"AG"!==v.codeTypeAccessoireConvention&&"PE"!==v.codeTypeAccessoireConvention&&(r!==v.codeTypeAccessoire||a!==v.identifiantAssurance)&&(a=v.identifiantAssurance,r=v.codeTypeAccessoire,o=v.codeTypePhase,c=this.getElementCalculAccSpecifiqueAssiette(s,r,a,m),_.isEmpty(c)?o===m.codeTypePhase&&""!==v.codeTypePhase&&1===v.numRelatifPhaseTypePhaseProduit&&"AM"===v.codeTypePhase&&"16"===v.codeTypeAssietteCalculElement&&(v.codeTypeAssietteCalculElement="20"):1===v.numRelatifPhaseTypePhaseProduit&&"AM"===v.codeTypePhase&&"16"===v.codeTypeAssietteCalculElement&&(v.codeTypeAssietteCalculElement="20"))}}}return s},e.getElementCalculAccSpecifiqueAssiette=function(e,t,n,i){for(var r=0,a=e;r<a.length;r++){var o=a[r];if(null!=o.listeAccessoire)for(var s=0,u=o.listeAccessoire;s<u.length;s++){var c=u[s];if("C"!==c.codeRoleCreditAvenant&&"O"!==c.codeRoleCreditAvenant&&""!==c.identifiantAssurance&&"AG"!==c.codeTypeAccessoireConvention&&"PE"!==c.codeTypeAccessoireConvention&&t!==c.codeTypeAccessoire&&n!==c.identifiantAssurance&&c.codeRoleCreditAvenant===i.phaseByRest.codeRoleCreditAvenant&&c.numeroPhase===i.numeroPhase&&c.codeTypePhase===i.codeTypePhase)return c}}return{}},e.getPhaseAffichable=function(e,t,n,i){if(null!=t&&t.isAteCree)return e.isPhaseActive;if(_.some(n,function(e){return e.numeroPhase===i}))return e.isPhaseActive;var r=_.first(n);return r.numeroPhase===e.numeroPhase},e}();n.FonctionsAte=a}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.getIsTopCalculatrice=function(e){return e.isAvenantTauxDuree?e.isCreditLissage:e.isAvenantAssurance&&!e.isAvenantAte?e.isCreditLissage&&!e.isMaintienProfilAmortissement:!1},e.getDonneeIsCreditWithAjustementEcheances=function(t){return e.getIsTopCalculatrice(t)?!0:t.isAvenantAssurance&&!t.isAvenantAte?t.isCreditLissage&&t.isWithAssuranceCRDIn:!1},e}();e.Avenant=t}(t=e.ToolsFunctionals||(e.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){var i=e.Commun.Tools.List,r=function(){function n(){}return n.getFraisAvenant=function(n,i,r,a,o){var s=this.getAcessoireDefaut(i,a,o);if(null!=s){var u=n!==e.Commun.Enum.CodeTypeAcces.Creation?this.getAcessoireDefaut(r,a,o):null;return new t.Modeles.FraisAvenant(s,u)}return null},n.getAcessoireDefaut=function(e,t,n){var i=this.getListeAccessoireEvolution(e,t,n);0===i.length&&(i=this.getListeAccessoire(e,t,n));var r=_.filter(i,function(e){return"O"===e.indicateurAccessoireObligatoire});return 1===r.length?_.first(r):(r.length>1&&(i=r),i=this.getListeAcessoireByRegleAppelAccessoireAperiodique(i),1===i.length?_.first(i):(i=this.getListeAcessoireByCodeTypologieAccessoire(i),1===i.length?_.first(i):(i=this.getListeAcessoireByCodeNatureAccessoire(i),1===i.length?_.first(i):(i=this.getListeAcessoireByCodeTypeAccessoire(i),i.length>0?_.first(i):null))))},n.getListeAcessoireByRegleAppelAccessoireAperiodique=function(e){e=_.sortByOrder(e,function(e){return e.regleAppelAccessoireAperiodique},"asc");var t=i.firstOrEmpty(e).regleAppelAccessoireAperiodique;return _.filter(e,function(e){return e.regleAppelAccessoireAperiodique===t})},n.getListeAcessoireByCodeTypologieAccessoire=function(e){e=_.sortByOrder(e,function(e){return e.codeTypologieAccessoire},"desc");var t=i.firstOrEmpty(e).codeTypologieAccessoire;return _.filter(e,function(e){return e.codeTypologieAccessoire===t})},n.getListeAcessoireByCodeNatureAccessoire=function(e){e=_.sortByOrder(e,function(e){return e.codeNatureAccessoire},"desc");var t=i.firstOrEmpty(e).codeNatureAccessoire;return _.filter(e,function(e){return e.codeNatureAccessoire===t})},n.getListeAcessoireByCodeTypeAccessoire=function(e){e=_.sortByOrder(e,function(e){return e.codeTypeAccessoire},"asc");var t=i.firstOrEmpty(e).codeTypeAccessoire;return _.filter(e,function(e){return e.codeTypeAccessoire===t})},n.getListeAccessoire=function(e,t,n){if(t||!t&&n){var i=_.find(e,function(e){return"45"===e.codeTypeAccessoire});if(null!=i)return[i]}var r,a=_.filter(e,function(e){return"05"===e.codeNatureAccessoire||"15"===e.codeNatureAccessoire});return(t||!t&&n)&&(r=_.filter(a,function(e){return!("01"!==e.codeTypologieAccessoire&&"03"!==e.codeTypologieAccessoire||"B10"!==e.regleAppelAccessoireAperiodique&&"B11"!==e.regleAppelAccessoireAperiodique)}),r.length>0)?r:(t||!t&&!n)&&(r=_.filter(a,function(e){return"B13"===e.regleAppelAccessoireAperiodique&&("01"===e.codeTypologieAccessoire||"03"===e.codeTypologieAccessoire||"11"===e.codeTypologieAccessoire)}),r.length>0)?r:(t||!t&&n)&&(r=_.filter(a,function(e){return angular.isDefined(_.find(["01","03","11"],function(t){return t===e.codeTypologieAccessoire}))&&angular.isDefined(_.find(["B10","B11","B13","B14"],function(t){return t===e.regleAppelAccessoireAperiodique}))}),r.length>0)?r:[]},n.getListeAccessoireEvolution=function(e,t,n){if(t){var i=_.filter(e,function(e){return"11"!==e.codeTypologieAccessoire&&"B13"!==e.regleAppelAccessoireAperiodique}),r=_.filter(i,function(e){return"B10"===e.regleAppelAccessoireAperiodique||"B11"===e.regleAppelAccessoireAperiodique});return _.some(r,function(e){return"FR"===e.codeTypeAccessoire})?_.filter(r,function(e){return"FR"===e.codeTypeAccessoire}):[]}var i=_.filter(e,function(e){return"11"===e.codeTypologieAccessoire});return i.length>0?n?_.filter(i,function(e){return"B13"!==e.regleAppelAccessoireAperiodique}):_.filter(i,function(e){return"B13"===e.regleAppelAccessoireAperiodique}):[]},n}();n.FraisAvenant=r}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(){}return t.getListeGarant=function(t,n,i){var r=_.map(t,function(t){return e.Modeles.PersonneAssurableGarantBuilder.getResult(new e.Modeles.PersonneAssurableOuGarantCatalogueAdapater(t),i)}),a=_.filter(n,function(e){return!_.some(r,function(t){return t.identifiantPersonne===e.identifiantPersonneEstAssure})});return r.concat(_.map(a,function(t){return e.Modeles.PersonneAssurableGarantBuilder.getResult(t,i)}))},t.getTypeObjetCommercialFinanceCreditOrigine=function(t,n,i,r,a){var o=_.find(i,function(e){return e.typeObjetFinanceGaranti===t});if(null!=o){var s=_.find(n,function(e){return e.typeObjetFinanceGaranti===t});return e.Modeles.TypeObjetCommercialBuilder.getTocByGarantie(s,o,r,a)}return null},t}();t.Garantie=n}(t=e.ToolsFunctionals||(e.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){var n=function(){function t(){}return t.getTypeAcces=function(t){return t===e.Commun.Enum.CodeTypeAcces.Creation||t===e.Commun.Enum.CodeTypeAcces.Modification||t===e.Commun.Enum.CodeTypeAcces.Duplication},t.getMontantCredit=function(t,n,i,r){var a=0;return null!=t&&null!=n&&(i!==e.Commun.Enum.CodeTypeAcces.Creation&&i!==e.Commun.Enum.CodeTypeAcces.Modification&&i!==e.Commun.Enum.CodeTypeAcces.Duplication?(a=t.montantCapitalRestantSurCredit-t.montantArrieresIncorporesCrd-t.montantIntcompsurCR,null!=r&&r.isToIntegreCrd&&"O"===t.codeIntegrationFraisCrd&&"U"===t.codeRoleCreditAvenant&&(a-=r.montant)):a=n.montantCapitalRestantSurCredit),a},t.fctActiverMontantCredit=function(e,t){return null!=e&&"P"===e.codeRoleCreditAvenant&&t?!0:!1},t.getAffichageInteretCompensateur=function(e,t){return null==t||null==e||0===e.montantEcheanceMER||"C"!==t.codeRoleCreditAvenant&&"U"!==t.codeRoleCreditAvenant?!1:!0},t.isCaseInteretCompensateurCoche=function(e,t){return e&&t>0},t.getInteretCompOuReport=function(e){return null!=e?e.montantEcheanceMER:0},t.getAfficheFraisAvenant=function(e,t,n){return null!=e&&null!=t&&!_.isEmpty(n)},t.isCaseFraisAvenant=function(e,t,n){return null!=e?t&&e.isToIntegreCrd:"O"===n},t.getFraisAvenant=function(e,t,n){return e&&t?n.montant:0},t.getAfficherAutres=function(e){return null!=e&&("C"===e.codeRoleCreditAvenant||"U"===e.codeRoleCreditAvenant)},t.getCaseAutres=function(e,t){return e&&t>0},t.getTitreBoutonImpayes=function(e){return null!=e&&"O"===e.codeGelDette?"Impayés + I.R. + Créances gelées":"Impayés + I.R."},t.getCodeIndicateurIntegrationCrd=function(e,t){return t?"O":!t&&e.montantEcheanceMER>0?"N":(t||0!==e.montantEcheanceMER," ")},t.getMontantArriereIncorporeCrd=function(e,t,n,i){if(!e)return 0;switch(t){case 0:return n;case 1:return i;default:return 0}},t.getCodeTypeArrieresIncorporeCrd=function(e,t){if(!e)return"";switch(t){case 0:return"I";case 1:return"L";default:return""}},t.fctAjoutAutreMontantCrd=function(e){switch(e){case"I":return 0;case"L":return 1;default:return 2}},t.fctActiverImpayes=function(t,n){return n===e.Commun.Enum.CodeAvenantSimulation.Simulation?t.montantImpayeRecouvrer>0||t.mtARecouvrerIndemnretardImpaye>0||t.montantGelCreance>0:"O"===t.codeGelDette?!1:t.montantImpayeRecouvrer>0||t.mtARecouvrerIndemnretardImpaye>0},t}();t.ModificationCrd=n}(n=t.ToolsFunctionals||(t.ToolsFunctionals={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(e){this.avenantDescriptionBase=e}return Object.defineProperty(e.prototype,"stepAvenant",{get:function(){return this.avenantDescriptionBase.stepAvenant},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPresenceStepOne",{get:function(){return this.avenantDescriptionBase.isPresenceStepOne},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPresenceStepTwo",{get:function(){return this.avenantDescriptionBase.isPresenceStepTwo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPresenceStepThree",{get:function(){return this.avenantDescriptionBase.isPresenceStepThree},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPresenceNextStep",{get:function(){return this.avenantDescriptionBase.isPresenceNextStep},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPresencePreviousStep",{get:function(){return this.avenantDescriptionBase.isPresencePreviousStep},enumerable:!0,configurable:!0}),e.prototype.setToNextStep=function(){this.avenantDescriptionBase.setToNextStep()},e.prototype.setToPreviousStep=function(){this.avenantDescriptionBase.setToPreviousStep()},Object.defineProperty(e.prototype,"codeTypeAcces",{get:function(){return this.avenantDescriptionBase.codeTypeAcces},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numero",{get:function(){return this.avenantDescriptionBase.numero},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codeAvenantSimulation",{get:function(){return this.avenantDescriptionBase.codeAvenantSimulation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeAvenant",{get:function(){return this.avenantDescriptionBase.typeAvenant},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codeSousTypeAvenant",{get:function(){return this.avenantDescriptionBase.codeSousTypeAvenant},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compteurMiseJour",{get:function(){return this.avenantDescriptionBase.compteurMiseJour},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idCredit",{get:function(){return this.avenantDescriptionBase.idCredit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idEmprunteur",{get:function(){return this.avenantDescriptionBase.idEmprunteur},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"libelleInfosCredit",{get:function(){return this.avenantDescriptionBase.libelleInfosCredit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"devise",{get:function(){return this.avenantDescriptionBase.devise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateEffet",{get:function(){return this.avenantDescriptionBase.dateEffet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateEffetModifieQuantieme",{get:function(){return this.avenantDescriptionBase.dateEffetModifieQuantieme;
},set:function(e){this.avenantDescriptionBase.dateEffetModifieQuantieme=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateFinCredit",{get:function(){return this.avenantDescriptionBase.dateFinCredit},set:function(e){this.avenantDescriptionBase.dateFinCredit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateFinPrefinancementReelle",{get:function(){return this.avenantDescriptionBase.dateFinPrefinancementReelle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateTraitement",{get:function(){return this.avenantDescriptionBase.dateTraitement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateEcheance",{get:function(){return this.avenantDescriptionBase.dateEcheance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeAcccessoires",{get:function(){return this.avenantDescriptionBase.listeAcccessoires},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeAccessoiresAnnexes",{get:function(){return this.avenantDescriptionBase.listeAccessoiresAnnexes},set:function(e){this.avenantDescriptionBase.listeAccessoiresAnnexes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataFraisAvenant",{get:function(){return this.avenantDescriptionBase.dataFraisAvenant},set:function(e){this.avenantDescriptionBase.dataFraisAvenant=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"droitModifierEnabled",{get:function(){return this.avenantDescriptionBase.droitModifierEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEditionAuthorized",{get:function(){return this.avenantDescriptionBase.isEditionAuthorized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCreditLissage",{get:function(){return this.avenantDescriptionBase.isCreditLissage},set:function(e){this.avenantDescriptionBase.isCreditLissage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isWithAssuranceCRDIn",{get:function(){return this.avenantDescriptionBase.isWithAssuranceCRDIn},set:function(e){this.avenantDescriptionBase.isWithAssuranceCRDIn=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMaintienProfilAmortissement",{get:function(){return this.avenantDescriptionBase.isMaintienProfilAmortissement},set:function(e){this.avenantDescriptionBase.isMaintienProfilAmortissement=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVersementAttenduAjoutable",{get:function(){return this.avenantDescriptionBase.isVersementAttenduAjoutable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataRestAvenant",{get:function(){return this.avenantDescriptionBase.dataRestAvenant},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataAssurances",{get:function(){return this.avenantDescriptionBase.dataAssurances},set:function(e){this.avenantDescriptionBase.dataAssurances=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataGaranties",{get:function(){return this.avenantDescriptionBase.dataGaranties},set:function(e){this.avenantDescriptionBase.dataGaranties=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeAssurancesAvailables",{get:function(){return this.avenantDescriptionBase.listeAssurancesAvailables},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeAssurancesStock",{get:function(){return this.avenantDescriptionBase.listeAssurancesStock},set:function(e){this.avenantDescriptionBase.listeAssurancesStock=_.unique(e,function(e){return e.identifiant})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeGarantiesStock",{get:function(){return this.avenantDescriptionBase.listeGarantiesStock},set:function(e){this.avenantDescriptionBase.listeGarantiesStock=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeGarantiesAvailables",{get:function(){return this.avenantDescriptionBase.listeGarantiesAvailables},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listePhaseStock",{get:function(){return this.avenantDescriptionBase.listePhaseStock},set:function(e){this.avenantDescriptionBase.listePhaseStock=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listePhaseAvailables",{get:function(){return this.avenantDescriptionBase.listePhaseAvailables},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emprunteurActuel",{get:function(){return this.avenantDescriptionBase.emprunteurActuel},set:function(e){this.avenantDescriptionBase.emprunteurActuel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emprunteurNouveau",{get:function(){return this.avenantDescriptionBase.emprunteurNouveau},set:function(e){this.avenantDescriptionBase.emprunteurNouveau=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"creditAvenantFinancier",{get:function(){return this.avenantDescriptionBase.creditAvenantFinancier},set:function(e){this.avenantDescriptionBase.creditAvenantFinancier=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jourFinMoisDateEffet",{get:function(){return this.avenantDescriptionBase.jourFinMoisDateEffet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reportFinPret",{get:function(){return this.avenantDescriptionBase.reportFinPret},set:function(e){this.avenantDescriptionBase.reportFinPret=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ate",{get:function(){return this.avenantDescriptionBase.ate},set:function(e){this.avenantDescriptionBase.ate=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"infoObjet",{get:function(){return this.avenantDescriptionBase.infoObjet},set:function(e){this.avenantDescriptionBase.infoObjet=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numeroEcheance",{get:function(){return this.avenantDescriptionBase.numeroEcheance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numeroEcheanceDebutPhase",{get:function(){return this.avenantDescriptionBase.numeroEcheanceDebutPhase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numeroEcheanceFinPhase",{get:function(){return this.avenantDescriptionBase.numeroEcheanceFinPhase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeAccessoiresAte",{get:function(){return this.avenantDescriptionBase.listeAccessoiresAte},set:function(e){this.avenantDescriptionBase.listeAccessoiresAte=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeAssurancesAte",{get:function(){return this.avenantDescriptionBase.listeAssurancesAte},set:function(e){this.avenantDescriptionBase.listeAssurancesAte=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listeElementCalculServicesObjet",{get:function(){return this.avenantDescriptionBase.listeElementCalculServicesObjet},set:function(e){this.avenantDescriptionBase.listeElementCalculServicesObjet=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renegociationProduits",{get:function(){return this.avenantDescriptionBase.renegociationProduits},set:function(e){this.avenantDescriptionBase.renegociationProduits=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEligibleChangementProduit",{get:function(){return this.avenantDescriptionBase.isEligibleChangementProduit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChangementProduitExistant",{get:function(){return this.avenantDescriptionBase.isChangementProduitExistant},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvecChangementProduit",{get:function(){return this.avenantDescriptionBase.isAvecChangementProduit},set:function(e){this.avenantDescriptionBase.isAvecChangementProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avecChangementProduit",{set:function(e){this.avenantDescriptionBase.isAvecChangementProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eligibiliteRenegociationProduit",{get:function(){return this.avenantDescriptionBase.eligibiliteRenegociationProduit},set:function(e){this.avenantDescriptionBase.eligibiliteRenegociationProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"creditChangePdt",{get:function(){return this.avenantDescriptionBase.creditChangePdt},set:function(e){this.avenantDescriptionBase.creditChangePdt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numeroModaliteRas",{get:function(){return this.avenantDescriptionBase.numeroModaliteRas},set:function(e){this.avenantDescriptionBase.numeroModaliteRas=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tauxRa",{get:function(){return this.avenantDescriptionBase.tauxRa},set:function(e){this.avenantDescriptionBase.tauxRa=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numeroModaliteRaDefault",{get:function(){return this.avenantDescriptionBase.numeroModaliteRaDefault},set:function(e){this.avenantDescriptionBase.numeroModaliteRaDefault=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bornesTauxRa",{get:function(){return this.avenantDescriptionBase.bornesTauxRa},set:function(e){this.avenantDescriptionBase.bornesTauxRa=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"palierAbsorbe",{get:function(){return this.avenantDescriptionBase.palierAbsorbe},set:function(e){this.avenantDescriptionBase.palierAbsorbe=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numeroPhaseEnCoursCreditOrigine",{get:function(){return this.avenantDescriptionBase.numeroPhaseEnCoursCreditOrigine},set:function(e){this.avenantDescriptionBase.numeroPhaseEnCoursCreditOrigine=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numeroPremiereEcheanceLastPalierPhaseO",{get:function(){return this.avenantDescriptionBase.numeroPremiereEcheanceLastPalierPhaseO},set:function(e){this.avenantDescriptionBase.numeroPremiereEcheanceLastPalierPhaseO=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reductionMaxCredit",{get:function(){return this.avenantDescriptionBase.reductionMaxCredit},set:function(e){this.avenantDescriptionBase.reductionMaxCredit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"traitementEcheanceDureeProduit",{get:function(){return this.avenantDescriptionBase.traitementEcheanceDureeProduit},set:function(e){this.avenantDescriptionBase.traitementEcheanceDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"motifAllongementDureeProduit",{get:function(){return this.avenantDescriptionBase.motifAllongementDureeProduit},set:function(e){this.avenantDescriptionBase.motifAllongementDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conditionsDureeProduit",{get:function(){return this.avenantDescriptionBase.conditionsDureeProduit},set:function(e){this.avenantDescriptionBase.conditionsDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bornesVariationDureeProduit",{get:function(){return this.avenantDescriptionBase.bornesVariationDureeProduit},set:function(e){this.avenantDescriptionBase.bornesVariationDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dureeVariationDureeProduit",{get:function(){return this.avenantDescriptionBase.dureeVariationDureeProduit},set:function(e){this.avenantDescriptionBase.dureeVariationDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pourcentageAllongementDureeProduit",{get:function(){return this.avenantDescriptionBase.pourcentageAllongementDureeProduit},set:function(e){this.avenantDescriptionBase.pourcentageAllongementDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showVariationDureeProduitForChgtProduit",{get:function(){return this.avenantDescriptionBase.showVariationDureeProduitForChgtProduit},set:function(e){this.avenantDescriptionBase.showVariationDureeProduitForChgtProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showVariationDureeProduitForProduitInitial",{get:function(){return this.avenantDescriptionBase.showVariationDureeProduitForProduitInitial},set:function(e){this.avenantDescriptionBase.showVariationDureeProduitForProduitInitial=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borneMinVariationDureeProduit",{get:function(){return this.avenantDescriptionBase.borneMinVariationDureeProduit},set:function(e){this.avenantDescriptionBase.borneMinVariationDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borneMaxVariationDureeProduit",{get:function(){return this.avenantDescriptionBase.borneMaxVariationDureeProduit},set:function(e){this.avenantDescriptionBase.borneMaxVariationDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cdTypeButoir",{get:function(){return this.avenantDescriptionBase.cdTypeButoir},set:function(e){this.avenantDescriptionBase.cdTypeButoir=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEditionVariationDureeProduit",{get:function(){return this.avenantDescriptionBase.isEditionVariationDureeProduit},set:function(e){this.avenantDescriptionBase.isEditionVariationDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOpenVariationDureeProduit",{get:function(){return this.avenantDescriptionBase.isOpenVariationDureeProduit},set:function(e){this.avenantDescriptionBase.isOpenVariationDureeProduit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borneTauxRaMin",{get:function(){return this.avenantDescriptionBase.borneTauxRaMin},set:function(e){this.avenantDescriptionBase.borneTauxRaMin=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borneTauxRaMax",{get:function(){return this.avenantDescriptionBase.borneTauxRaMax},set:function(e){this.avenantDescriptionBase.borneTauxRaMax=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"libelleNouveauProduit",{get:function(){return this.avenantDescriptionBase.libelleNouveauProduit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showPopinChgtProduit",{get:function(){return this.avenantDescriptionBase.showPopinChgtProduit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nouvellePhaseAMSupOrigine",{get:function(){return this.avenantDescriptionBase.nouvellePhaseAMSupOrigine},set:function(e){this.avenantDescriptionBase.nouvellePhaseAMSupOrigine=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isProduitCloture",{get:function(){return this.avenantDescriptionBase.isProduitCloture},set:function(e){this.avenantDescriptionBase.isProduitCloture=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessoireIntegreCrd",{get:function(){return this.avenantDescriptionBase.accessoireIntegreCrd},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alerteAvenant",{get:function(){return this.avenantDescriptionBase.alerteAvenant},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isModificationTauxFirst",{get:function(){return this.avenantDescriptionBase.isModificationTauxFirst},set:function(e){this.avenantDescriptionBase.isModificationTauxFirst=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isModificationPeriodicitePhaseFirst",{get:function(){return this.avenantDescriptionBase.isModificationPeriodicitePhaseFirst},set:function(e){this.avenantDescriptionBase.isModificationPeriodicitePhaseFirst=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAmortissementALaCarte",{get:function(){return this.avenantDescriptionBase.isAmortissementALaCarte},set:function(e){this.avenantDescriptionBase.isAmortissementALaCarte=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeCalculAjustementEcheances",{get:function(){return this.avenantDescriptionBase.typeCalculAjustementEcheances},set:function(e){this.avenantDescriptionBase.typeCalculAjustementEcheances=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"palierTauxInteretAvantCalculettes",{get:function(){return this.avenantDescriptionBase.palierTauxInteretAvantCalculettes},set:function(e){this.avenantDescriptionBase.palierTauxInteretAvantCalculettes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"detailDpeOrigine",{get:function(){return this.avenantDescriptionBase.detailDpeOrigine},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"detailDpeAvenant",{get:function(){return this.avenantDescriptionBase.detailDpeAvenant},set:function(e){this.avenantDescriptionBase.detailDpeAvenant=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPretImpact",{get:function(){return this.avenantDescriptionBase.isPretImpact},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNouvelleNoteDpe",{get:function(){return this.avenantDescriptionBase.isNouvelleNoteDpe},set:function(e){this.avenantDescriptionBase.isNouvelleNoteDpe=e},enumerable:!0,configurable:!0}),e.prototype.getCreditLoadedByCaraFinan=function(){return this.avenantDescriptionBase.getCreditLoadedByCaraFinan()},e.prototype.getCreditLoadedByInfoCredit=function(){return this.avenantDescriptionBase.getCreditLoadedByInfoCredit()},e.prototype.findAccessoireAnnexeFantome=function(e,t){return this.avenantDescriptionBase.findAccessoireAnnexeFantome(e,t)},e.prototype.addAccessoireAnnexe=function(e){this.avenantDescriptionBase.addAccessoireAnnexe(e)},e.prototype.setAccessoireAnnexeEdition=function(e,t){this.avenantDescriptionBase.setAccessoireAnnexeEdition(e,t)},e.prototype.addAssurance=function(){this.avenantDescriptionBase.addAssurance()},e.prototype.setAssuranceEdition=function(e,t){this.avenantDescriptionBase.setAssuranceEdition(e,t)},e.prototype.setListePersonnesAssurable=function(e){this.avenantDescriptionBase.setListePersonnesAssurable(e)},e.prototype.majDureePalier=function(e,t){this.avenantDescriptionBase.majDureePalier(e,t)},e.prototype.majDureePalierFromPhase=function(e){this.avenantDescriptionBase.majDureePalierFromPhase(e)},e.prototype.reportModificationsDuree=function(){this.avenantDescriptionBase.reportModificationsDuree()},e.prototype.addGarantie=function(){this.avenantDescriptionBase.addGarantie()},e.prototype.addGarantInListPersonnesAssurable=function(e){this.avenantDescriptionBase.addGarantInListPersonnesAssurable(e)},e.prototype.impactModificationDureePhaseDT=function(e){this.avenantDescriptionBase.impactModificationDureePhaseDT(e)},Object.defineProperty(e.prototype,"isAvenantTauxDuree",{get:function(){return this.avenantDescriptionBase.isAvenantTauxDuree},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantAssurance",{get:function(){return this.avenantDescriptionBase.isAvenantAssurance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantGarantie",{get:function(){return this.avenantDescriptionBase.isAvenantGarantie},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantQuantieme",{get:function(){return this.avenantDescriptionBase.isAvenantQuantieme},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantReportFinPret",{get:function(){return this.avenantDescriptionBase.isAvenantReportFinPret},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantAte",{get:function(){return this.avenantDescriptionBase.isAvenantAte},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantObjet",{get:function(){return this.avenantDescriptionBase.isAvenantObjet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantPersonnes",{get:function(){return this.avenantDescriptionBase.isAvenantPersonnes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantRecouvrement",{get:function(){return this.avenantDescriptionBase.isAvenantRecouvrement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAvenantPeriodicite",{get:function(){return this.avenantDescriptionBase.isAvenantPeriodicite},set:function(e){this.avenantDescriptionBase.isAvenantPeriodicite=e},enumerable:!0,configurable:!0}),e.prototype.beforeSave=function(){this.avenantDescriptionBase.beforeSave()},e.prototype.setDataAssurancesForCalculatrice=function(){this.avenantDescriptionBase.setDataAssurancesForCalculatrice()},e.prototype.changeDateEffetQuantieme=function(){this.avenantDescriptionBase.changeDateEffetQuantieme()},e.prototype.getDateEffetRetenue=function(){return this.avenantDescriptionBase.getDateEffetRetenue()},e.prototype.gestionAte=function(e,t,n,i,r,a,o){return this.avenantDescriptionBase.gestionAte(e,t,n,i,r,a,o)},e.prototype.scissionPhaseAte=function(e,t,n,i){return this.avenantDescriptionBase.scissionPhaseAte(e,t,n,i)},e.prototype.changeTauxRA=function(e){return this.avenantDescriptionBase.changeTauxRA(e)},e.prototype.setDataObjetFinanceByObjet=function(e){return this.avenantDescriptionBase.setDataObjetFinanceByObjet(e)},e.prototype.setDataAssurancesByAvenantPersonne=function(){this.avenantDescriptionBase.setDataAssurancesByAvenantPersonne()},e}();e.AvenantDecorateur=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(t){function n(n){var i=this;t.call(this,n),this.dataAssurances={idNouvelleAssurance:1,listeCompagnie:this.getListeCompagnie(this.avenantDescriptionBase.dataRestAvenant.dataAssurances.listeCompagniesAssurance),listeReserveExclusion:this.getListeMotifReserve(this.avenantDescriptionBase.dataRestAvenant.dataAssurances.listeMotifsReserveOuExclusion),listePersonne:_.map(this.avenantDescriptionBase.dataRestAvenant.dataAssurances.listePersonnesAssurableOuGarant,function(t){return e.PersonneAssurableGarantBuilder.getResult(t,i.avenantDescriptionBase.dataRestAvenant.dataAssurances.listeEncoursPersonneAssuHorsCreditEncours)})};var r=0;this.listeAssurancesStock=_.map(this.avenantDescriptionBase.dataRestAvenant.creditCaraFinan.assurances,function(t){return new e.Assurance(r++,null,i.dataAssurances.listePersonne,i.dataAssurances.listeCompagnie,i.dataAssurances.listeReserveExclusion,i.avenantDescriptionBase.devise,i.avenantDescriptionBase.dateEffet,i.avenantDescriptionBase.dateTraitement,i.avenantDescriptionBase.dateFinCredit,i.avenantDescriptionBase.dataRestAvenant.dataAssurances.dataForAssurance,i.isAvecChangementProduit?i.avenantDescriptionBase.creditChangePdt:i.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,i.avenantDescriptionBase.dataRestAvenant.creditCaraFinan,i.avenantDescriptionBase.isAvecChangementProduit,_.some(i.avenantDescriptionBase.listePhaseStock,function(e){return e.isPhaseActive&&e.isScission}),i.avenantDescriptionBase.isAvenantPeriodicite,i.avenantDescriptionBase.listePhaseStock,t,i.avenantDescriptionBase.creditAvenantFinancier,i.avenantDescriptionBase.dataRestAvenant.dataAssurances.listeEncoursPersonneAssuHorsCreditEncours,null!=i.avenantDescriptionBase.dataRestAvenant.dataObjet?i.avenantDescriptionBase.dataRestAvenant.dataObjet.creditObjet:null)})}return __extends(n,t),n.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit()},n.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.getDisabledValider()},n.prototype.getListeCompagnie=function(t){var n=_.map(_.uniq(t,function(e){return e.numeroExterneConvention}),function(t){return e.AssuranceHelper.getCompagnie(t)}),i={isCompagnieExterne:!0,numeroExterneConvention:null,codeEtablissement:null,libelleLong:"Compagnie d'assurance externe",libelleTiers:"Compagnie d'assurance externe",listeConvention:[]};return[i].concat(_.sortByOrder(n,function(e){return e.libelleLong},!0))},n.prototype.getListeMotifReserve=function(t){return _.sortByOrder(_.map(t,function(t){return e.AssuranceHelper.getMotifReserve(t)}),function(e){return e.libelle},!0)},n}(e.AvenantDecorateur);e.AvenantAssuranceDataDecorateur=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.ToolsFunctionals.Taux,r=function(r){function a(e){r.call(this,e),this._listeAssurancesBeforeEdit=[],this.setDataAssurancesForCalculatrice()}return __extends(a,r),Object.defineProperty(a.prototype,"isAvenantAssurance",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"listeAssurancesAvailables",{get:function(){return _.filter(this.avenantDescriptionBase.listeAssurancesStock,function(e){return e.etatManipulation!==t.Enum.EtatManipulation.ToDelete})},enumerable:!0,configurable:!0}),a.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit().concat(e.Commun.Enum.ModificationCredit.Assurance)},a.prototype.setAssuranceEdition=function(e,n){var i=_.findIndex(this.avenantDescriptionBase.listeAssurancesStock,function(e){return e.idIhm===n});switch(e){case t.Enum.ActionManipulationElement.Modifier:this._listeAssurancesBeforeEdit.push(angular.copy(_.find(this.avenantDescriptionBase.listeAssurancesStock,function(e){return e.idIhm===n}))),this.avenantDescriptionBase.listeAssurancesStock[i].modeEdition=!0;break;case t.Enum.ActionManipulationElement.Annuler:var r=_.findIndex(this._listeAssurancesBeforeEdit,function(e){return e.idIhm===n});this.avenantDescriptionBase.listeAssurancesStock[i]=this._listeAssurancesBeforeEdit[r],_.remove(this._listeAssurancesBeforeEdit,function(e){return e.idIhm===n});break;case t.Enum.ActionManipulationElement.Enregistrer:this.setAccessoireOfAssuranceWithSaisieObligatoire(this.avenantDescriptionBase.listeAssurancesStock[i],_.find(this._listeAssurancesBeforeEdit,function(e){return e.idIhm===n})),this.avenantDescriptionBase.listeAssurancesStock[i].modeEdition=!1,this.avenantDescriptionBase.listeAssurancesStock[i].isCreationFirstEdition&&(this.avenantDescriptionBase.listeAssurancesStock[i].isCreationFirstEdition=!1),_.remove(this._listeAssurancesBeforeEdit,function(e){return e.idIhm===n}),this.avenantDescriptionBase.listeAssurancesStock[i].etatManipulation!==t.Enum.EtatManipulation.IsCreation&&(this.avenantDescriptionBase.listeAssurancesStock[i].etatManipulation=t.Enum.EtatManipulation.IsModified);break;case t.Enum.ActionManipulationElement.Supprimer:if(this.avenantDescriptionBase.listeAssurancesStock[i].etatManipulation===t.Enum.EtatManipulation.IsCreation)_.remove(this.avenantDescriptionBase.listeAssurancesStock,function(e){return e.idIhm===n});else{if(this.avenantDescriptionBase.listeAssurancesStock[i].modeEdition){var a=_.findIndex(this._listeAssurancesBeforeEdit,function(e){return e.idIhm===n});this.avenantDescriptionBase.listeAssurancesStock[i]=this._listeAssurancesBeforeEdit[a],_.remove(this._listeAssurancesBeforeEdit,function(e){return e.idIhm===n})}this.avenantDescriptionBase.listeAssurancesStock[i].etatManipulation=t.Enum.EtatManipulation.ToDelete}}(e===t.Enum.ActionManipulationElement.Enregistrer||e===t.Enum.ActionManipulationElement.Supprimer)&&this.setDataAssurancesForCalculatrice()},a.prototype.setAccessoireOfAssuranceWithSaisieObligatoire=function(e,n){(n||{}).modeEdition=!0,(e.etatManipulation===t.Enum.EtatManipulation.IsCreation||e.etatManipulation===t.Enum.EtatManipulation.Unchanged&&!_.isEqual(e,n))&&_.each(_.filter(e.listeAccessoire,function(e){return e.etatManipulationAccessoire!==t.Enum.EtatManipulation.IsModified}),function(e){return e.setAccessoireToModified()})},a.prototype.setListePersonnesAssurable=function(e){this.avenantDescriptionBase.dataAssurances.listePersonne=e},a.prototype.addGarantInListPersonnesAssurable=function(e){-1===_.findIndex(this.avenantDescriptionBase.dataAssurances.listePersonne,function(t){return t.identifiantPersonne===e.identifiantPersonne})&&this.avenantDescriptionBase.dataAssurances.listePersonne.push(e)},a.prototype.addAssurance=function(){var e=_.last(this.avenantDescriptionBase.listeAssurancesStock);this.listeAssurancesStock.push(new n.Assurance(null!=e?e.idIhm+1:0,this.avenantDescriptionBase.dataAssurances.idNouvelleAssurance++,this.avenantDescriptionBase.dataAssurances.listePersonne,this.avenantDescriptionBase.dataAssurances.listeCompagnie,this.avenantDescriptionBase.dataAssurances.listeReserveExclusion,this.avenantDescriptionBase.devise,this.avenantDescriptionBase.dateEffet,this.avenantDescriptionBase.dateTraitement,this.avenantDescriptionBase.dateFinCredit,this.avenantDescriptionBase.dataRestAvenant.dataAssurances.dataForAssurance,this.isAvecChangementProduit?this.avenantDescriptionBase.creditChangePdt:this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.dataRestAvenant.creditCaraFinan,this.avenantDescriptionBase.isAvecChangementProduit,_.some(this.avenantDescriptionBase.listePhaseStock,function(e){return e.isPhaseActive&&e.isScission}),this.avenantDescriptionBase.isAvenantPeriodicite,this.avenantDescriptionBase.listePhaseStock,null,this.avenantDescriptionBase.creditAvenantFinancier,this.avenantDescriptionBase.dataRestAvenant.dataAssurances.listeEncoursPersonneAssuHorsCreditEncours,null!=this.avenantDescriptionBase.dataRestAvenant.dataObjet?this.avenantDescriptionBase.dataRestAvenant.dataObjet.creditObjet:null))},a.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.ThreeIsAutre?this.avenantDescriptionBase.getDisabledValider()||_.some(this.listeAssurancesAvailables,function(e){return e.modeEdition}):this.avenantDescriptionBase.getDisabledValider()},a.prototype.setDataAssurancesForCalculatrice=function(){this.isWithAssuranceCRDIn=t.ToolsFunctionals.Assurance.getAssuranceContientCrdIn(this.listeAssurancesAvailables),this.isMaintienProfilAmortissement=this.getIsMaintienProfilAmortissement()},a.prototype.getIsMaintienProfilAmortissement=function(){var t=this,n=_.filter(this.listePhaseAvailables||[],function(e){return"AM"===e.codeTypePhase}).length,i=_.filter(this.listeAccessoiresAnnexes,function(n){return"A03"===n.numeroRegleApplicationElement&&"33"===n.codeTypeAssietteCalculElement&&e.Commun.Tools.DateUtils.isAfter(n.dateFin,t.dateEffet)});return this.getSommeAccessoireBeforeAvenant(n,i)===this.getSommeAccessoireAfterAvenant(n,i)},a.prototype.getSommeAccessoireBeforeAvenant=function(e,n){var r=this,a=_.reduce(this.avenantDescriptionBase.listeAssurancesStock,function(e,t){return e+t.sommeAllTauxAccessoireBeforeAvenant},0),o=_.reduce(_.filter(n,function(e){return e.etatManipulationAccessoire!==t.Enum.EtatManipulation.IsCreation}),function(t,n){return t+r.getTauxAccessoireComplementaire(n.tauxOrigine,e)},0);return i.roundDecimal(a+o,2)},a.prototype.getSommeAccessoireAfterAvenant=function(e,n){var r=this,a=_.reduce(this.listeAssurancesAvailables,function(e,t){return e+t.getSommeAllTauxAccessoire()},0),o=_.reduce(_.filter(n,function(e){return e.etatManipulationAccessoire!==t.Enum.EtatManipulation.ToDelete}),function(t,n){return t+r.getTauxAccessoireComplementaire(n.detailAccessoire.elementUn.taux,e)},0);return i.roundDecimal(a+o,2)},a.prototype.getTauxAccessoireComplementaire=function(e,t){return e*t},a}(n.AvenantDecorateur);n.AvenantAssuranceDecorateur=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.ToolsFunctionals.FonctionsAvenant,r=function(r){function a(e){r.call(this,e),this.ate=this.getAte(this.avenantDescriptionBase.codeTypeAcces,this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.dataRestAvenant.produitCredit,this.avenantDescriptionBase.dataRestAvenant.creditCaraFinan,this.avenantDescriptionBase.isAvecChangementProduit,this.avenantDescriptionBase.listePhaseStock),this.listeAccessoiresAte=this.getListeAccessoiresAte(this.avenantDescriptionBase.dataRestAvenant.produitCredit.accessoires,this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit);
}return __extends(a,r),Object.defineProperty(a.prototype,"isAvenantAte",{get:function(){return!0},enumerable:!0,configurable:!0}),a.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit().concat(e.Commun.Enum.ModificationCredit.AmenagementTemporaireEcheances)},a.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.ThreeIsAutre?this.avenantDescriptionBase.getDisabledValider()||this.ate.getValidCreationAte||this.ate.isModeConsultationModification||this.ate.isAteInit:this.avenantDescriptionBase.getDisabledValider()},a.prototype.getAte=function(e,t,i,r,a,o){return new n.Ate(e,t,i,r,a,o)},a.prototype.scissionPhaseAte=function(e,t,n,r){var a,o=t-n+1,s=r-t;return"PF"!==e.codeTypePhase?(a=angular.copy(e),a.numeroPhase+=1,e.phaseModifieeAte=!0,a.phaseModifieeAte=!0,e.isScission=!0,a.isScission=!0,e.duree=i.simulConvDuree(e.periodiciteCalculInterets.codePeriode,o,e.uniteDureePhase,365),a.duree=i.simulConvDuree(a.periodiciteCalculInterets.codePeriode,s,a.uniteDureePhase,365),a.isPhaseActive=!1,a.cdModifCaracFinanciere=e.cdModifCaracFinanciere,e.cdModifCaracFinanciere="","O"===e.prelevementEnFinPhase&&(e.prelevementEnFinPhase="N",a.prelevementEnFinPhase="O")):a={},a},a.prototype.getNumEcheanceDebutFinPhaseAte=function(e,t){for(var n,r=0,a=0,o=0,s=e;o<s.length;o++){var u=s[o];if("PF"!==u.codeTypePhase&&(r=a+1,n=i.simulConvDuree(u.uniteDureePhase,u.duree,u.periodiciteCalculInterets.codePeriode,365),a=r+n-1,t+1>=r&&a>=t+1))break}return[r,a]},a.prototype.gestionAte=function(n,r,a,o,s,u,c){var l=!_.isEmpty(n.palierProgAmors),d=[],m=t.ToolsFunctionals.FonctionsAte.getNuepFinPhasePourAssiette(n,o);this.avenantDescriptionBase.listeAssurancesStock=t.ToolsFunctionals.FonctionsAte.modificationAssietteAccAssu(this.avenantDescriptionBase.listeAssurancesStock,m,this.avenantDescriptionBase.dataRestAvenant.creditOrigineInfoCredit,r);var h={},p=e.Business.ToolsFunctionals.ScissionPhase.isServicesObjetAScinder(this.avenantDescriptionBase.listeElementCalculServicesObjet,n.numeroPhase),f=n.numeroPhase===c&&o+1>=s&&u>=o+1;if(f&&s!==o+1){var A=t.ToolsFunctionals.FonctionsAte.getListePaliersWithScission(n,o);t.ToolsFunctionals.FonctionsAte.renumerotationPalierTauxInteretNumeroPhase(A,o),l&&(d=t.ToolsFunctionals.FonctionsAte.getPalierProgAmorWithScission(n,o),t.ToolsFunctionals.FonctionsAte.renumerotationPalierProgAmorNumeroPhase(d,o)),h=t.ToolsFunctionals.FonctionsAte.scissionPhaseEnCours(n,o,s,u),t.ToolsFunctionals.FonctionsAte.renumerotationPalierTauxInteretNumeroRelatif(A,h),n.listePalier=_.filter(A,function(e){return e.numeroPhase===n.numeroPhase}),h.listePalier=_.filter(A,function(e){return e.numeroPhase===h.numeroPhase}),l&&!_.isEmpty(d)&&(t.ToolsFunctionals.FonctionsAte.renumerotationPalierProgAmorNumeroRelatif(d,h),n.palierProgAmors=_.filter(d,function(e){return e.numeroPhase===n.numeroPhase}),h.palierProgAmors=_.filter(d,function(e){return e.numeroPhase===h.numeroPhase})),"F"===n.codeProduitRevisableProduit&&(t.ToolsFunctionals.FonctionsAte.renumerotationParamRevTaux(r,n),h.parametresRevisionTaux=t.ToolsFunctionals.FonctionsAte.scissionParametreRevisionTaux(n.parametresRevisionTaux,h)),this.listeAccessoiresAte=this.scissionAccessoiresEnCours(n.numeroPhase,h.numeroPhase,this.avenantDescriptionBase.listeAccessoiresAte),p&&e.Business.ToolsFunctionals.ScissionPhase.scissionServicesObjet(this.avenantDescriptionBase.listeElementCalculServicesObjet,n),_.each(r,function(e){e.numeroPhase>n.numeroPhase&&(e.numeroPhase+=1,e.phaseModifieeAte=!0,_.each(e.listePalier,function(t){return t.numeroPhase=e.numeroPhase}),_.each(e.palierProgAmors,function(t){return t.numeroPhase=e.numeroPhase}))});var P=_.findIndex(r,function(e){return e.numeroPhase===n.numeroPhase});r.splice(P+1,0,h)}else n.isPhaseActive=!0,h=n;var v=o+a.echeancesReportees,g=this.getNumEcheanceDebutFinPhaseAte(r,v),C={},E=h;if(g[0]!==v+1){var b=[];E=_.any(h.listePalier,function(e){return e.numeroPremiereEcheance<=v&&e.numeroDerniereEcheance>=v})?h:_.find(r,function(e){return _.any(e.listePalier,function(e){return e.numeroPremiereEcheance<=v&&e.numeroDerniereEcheance>=v})});var T=t.ToolsFunctionals.FonctionsAte.scissionPalierTauxInteretsAte(E,a,o);if(_.each(T,function(e){e.numeroPremiereEcheance>=o+1&&e.numeroDerniereEcheance<=v&&(e.typeRemboursement="9")}),t.ToolsFunctionals.FonctionsAte.renumerotationPalierTauxInteretNumeroPhase(T,v),l&&(b=t.ToolsFunctionals.FonctionsAte.scissionPalierProgAmorAte(E,a,o),t.ToolsFunctionals.FonctionsAte.renumerotationPalierProgAmorNumeroPhase(b,v)),C=this.scissionPhaseAte(E,v,g[0],g[1]),t.ToolsFunctionals.FonctionsAte.renumerotationPalierTauxInteretNumeroRelatif(T,C),_.any(T,function(e){return e.numeroPhase===E.numeroPhase})&&(E.listePalier=_.filter(T,function(e){return e.numeroPhase===E.numeroPhase})),_.any(T,function(e){return e.numeroPhase===C.numeroPhase})&&(C.listePalier=_.filter(T,function(e){return e.numeroPhase===C.numeroPhase})),l&&!_.isEmpty(b)&&(t.ToolsFunctionals.FonctionsAte.renumerotationPalierProgAmorNumeroRelatif(b,C),E.palierProgAmors=_.filter(b,function(e){return e.numeroPhase===E.numeroPhase}),C.palierProgAmors=_.filter(b,function(e){return e.numeroPhase===C.numeroPhase})),"F"===E.codeProduitRevisableProduit&&(t.ToolsFunctionals.FonctionsAte.renumerotationParamRevTaux(r,E),C.parametresRevisionTaux=t.ToolsFunctionals.FonctionsAte.scissionParametreRevisionTaux(E.parametresRevisionTaux,C)),_.each(r,function(e){e.numeroPhase>E.numeroPhase&&(e.numeroPhase+=1,e.phaseModifieeAte=!0,_.each(e.listePalier,function(t){return t.numeroPhase=e.numeroPhase}),_.each(e.palierProgAmors,function(t){return t.numeroPhase=e.numeroPhase}))}),_.any(T,function(e){return e.numeroPhase!==E.numeroPhase&&e.numeroPhase!==C.numeroPhase})){var y=_.filter(T,function(e){return E.numeroPhase&&e.numeroPhase!==C.numeroPhase});_.each(r,function(e){_.any(y,function(t){return e.numeroPhase===t.numeroPhase})&&(e.phaseModifieeAte=!0,e.listePalier=_.filter(y,function(t){return e.numeroPhase===t.numeroPhase}),_.each(e.palierProgAmors,function(t){return t.numeroPhase=e.numeroPhase}))})}var M=_.findIndex(r,function(e){return e.numeroPhase===E.numeroPhase});r.splice(M+1,0,C),this.listeAccessoiresAte=this.scissionAccessoiresEnCours(E.numeroPhase,C.numeroPhase,this.avenantDescriptionBase.listeAccessoiresAte),e.Business.ToolsFunctionals.ScissionPhase.alimenterDatesPhaseAvecDateAppelAccessoire(this.listeAccessoiresAte,this.avenantDescriptionBase.dataRestAvenant.creditOrigineInfoCredit.dateMiseRecouvrementZero,r),p&&(e.Business.ToolsFunctionals.ScissionPhase.scissionServicesObjet(this.avenantDescriptionBase.listeElementCalculServicesObjet,E),e.Business.ToolsFunctionals.ScissionPhase.alimenterDatesPhase(this.avenantDescriptionBase.listeElementCalculServicesObjet,this.avenantDescriptionBase.dataRestAvenant.creditOrigineInfoCredit.dateMiseRecouvrementZero,r))}if(_.isEmpty(C)||E!==h)for(var D=0,x=r;D<x.length;D++)for(var R=x[D],S=0,I=R.listePalier;S<I.length;S++){var B=I[S];B.numeroPremiereEcheance>=o+1&&B.numeroDerniereEcheance<=v&&(B.typeRemboursement="9")}if(this.avenantDescriptionBase.listeAssurancesStock=t.ToolsFunctionals.FonctionsAte.scissionListeObjetAvecListeAccessoire(this.avenantDescriptionBase.listeAssurancesStock,h.numeroPhase,!_.isEmpty(C),f),this.avenantDescriptionBase.listeAccessoiresAnnexes=t.ToolsFunctionals.FonctionsAte.scissionAccessoiresComplementaires(this.avenantDescriptionBase.listeAccessoiresAnnexes,h.numeroPhase,f),this.avenantDescriptionBase.listeGarantiesStock=t.ToolsFunctionals.FonctionsAte.scissionListeObjetAvecListeAccessoire(this.avenantDescriptionBase.listeGarantiesStock,h.numeroPhase,!_.isEmpty(C),f),1===a.impactTa)for(var O=a.nouvelleDureeResiduelle-a.dureeResteAFinancer,F=0,L=r;F<L.length;F++){var j=L[F];j.numeroPhase===_.last(r).numeroPhase&&(j.duree=j.duree+O,j.listePalier[j.listePalier.length-1].numeroDerniereEcheance=j.listePalier[j.listePalier.length-1].numeroDerniereEcheance+i.simulConvDuree(n.uniteDureePhase,O,j.periodiciteCalculInterets.codePeriode,365),l&&(j.palierProgAmors[j.palierProgAmors.length-1].numeroDerniereEcheance=j.palierProgAmors[j.palierProgAmors.length-1].numeroDerniereEcheance+i.simulConvDuree(n.uniteDureePhase,O,j.periodiciteCalculInterets.codePeriode,365)))}var G=_.some(r,function(e){return _.some(e.listePalier,function(e){return(e.listeEcheanceALaCarte||[]).length>0})});G&&(r=this.ajoutEchALaCarteDansPhase(r,a,o)),this.listePhaseStock=r},a.prototype.scissionAccessoiresEnCours=function(e,t,n){var i=angular.copy(n),r=_.filter(i,function(t){return t.numeroPhase===e});if(r.length>0){_.each(i,function(t){t.numeroPhase>e&&(t.numeroPhase=t.numeroPhase+1)});for(var a=function(n){var r=angular.copy(n);r.numeroPhase=t,n.numeroPhase>0&&"21"!==n.codeNatureAccessoire&&"22"!==n.codeNatureAccessoire&&(null!=n.codeSousTypeAccessoireCompl||(n.dateFinApplicationElement=null),null===r.codeActionEcranListe&&(r.codeActionEcranListe="C",r.indicateurAccessoireValide="0"),r.dateDebutApplicationElement=null,r.dateAppelAccessoire=null),("21"===n.codeNatureAccessoire||"22"===n.codeNatureAccessoire)&&(n.dateFinApplicationElement="0000-00-00",n.dateDebutApplicationElement="0000-00-00",n.dateAppelAccessoire="0000-00-00",n.nbrEcheancesAccessoiresReport=0);var a=_.findIndex(i,function(t){return null!=n.codeSousTypeAccessoireCompl?t.numeroPhase===e&&t.codeNatureAccessoire===n.codeNatureAccessoire&&t.dateFinApplicationElement===n.dateFinApplicationElement:t.numeroPhase===e&&t.codeNatureAccessoire===n.codeNatureAccessoire});i.splice(a,1,n),i.splice(a+1,0,r)},o=0,s=r;o<s.length;o++){var u=s[o];a(u)}}return i},a.prototype.ajoutEchALaCarteDansPhase=function(e,t,n){var i=angular.copy(e),r=n+t.echeancesReportees,a=_.reduce(_.map(i,function(e){return e.listePalier}),function(e,t){return _.union(e,t)},[]),o=_.uniq(_.reduce(_.map(a,function(e){return e.listeEcheanceALaCarte}),function(e,t){return _.union(e,t)},[]),function(e){return e.numeroEcheance});_.each(o,function(e){e.numeroEcheance>n&&_.each(a,function(t){t.numeroPremiereEcheance<=e.numeroEcheance&&t.numeroDerniereEcheance>=e.numeroEcheance&&(e.numeroPhase=t.numeroPhase)})});var s=_.last(_.filter(o,function(e){return("D"===e.codeTypeElementSaisiSurCredit||"E"===e.codeTypeElementSaisiSurCredit)&&e.numeroEcheance<=r}));if(null!=s){var u=this.getDerniereEcheanceALaCarte(s,i,a,r),c=_.findIndex(o,function(e){return e.numeroPhase===s.numeroPhase});o.splice(c+1,0,u)}return o=_.uniq(_.sortBy(o,function(e){return e.numeroEcheance}),function(e){return e.numeroEcheance}),_.each(i,function(e){_.each(e.listePalier,function(t){t.listeEcheanceALaCarte=_.filter(o,function(n){return n.numeroPhase===e.numeroPhase&&n.numeroEcheance>=t.numeroPremiereEcheance&&n.numeroEcheance<=t.numeroDerniereEcheance})})}),i},a.prototype.getDerniereEcheanceALaCarte=function(e,t,n,i){var r=angular.copy(e),a=this.getDernierNumPhaseAte(t),o=_.find(t,function(e){return e.numeroPhase===r.numeroPhase}),s=_.find(t,function(e){return e.numeroPhase===a+1}),u=_.find(n,function(e){return e.numeroPremiereEcheance<=r.numeroEcheance&&e.numeroDerniereEcheance>=r.numeroEcheance});return o.numRelatifPhaseTypePhaseProduit!==s.numRelatifPhaseTypePhaseProduit||o.codeTypePhase!==s.codeTypePhase||"9"===u.typeRemboursement&&"O"!==u.elementModifiableParAvenant||(r.numeroPhase=a+1,r.numeroEcheance=i+1),r},a.prototype.getDernierNumPhaseAte=function(e){var t=_.filter(e,function(e){return angular.isDefined(_.find(e.listePalier,function(e){return"9"===e.typeRemboursement}))});return 0===t.length?0:_.max(_.map(t,function(e){return e.numeroPhase}))},a.prototype.getListeAccessoiresAte=function(e,t){var n=this,i=_.filter(e,function(e){return(null!==e.codeTypeAssietteCalculElement&&"00"!==e.codeTypeAssietteCalculElement||"23"===e.codeNatureAccessoire)&&("06"!==e.codeTypeAssietteCalculElement||"21"!==e.codeNatureAccessoire&&"22"!==e.codeNatureAccessoire)?!1:!0}),r=_.map(i,function(e){return n.modifAccessoireProduitFonctionOrigine(t.accessoires,e)});r.push(_.map(t.accessoires,function(e){return n.modifAccessoireSansProduit(i,e)}).filter(function(e){return null!=e&&null===e.codeSousTypeAccessoireCompl}));var a=_.reduce(r,function(e,t){return _.union(e,t)},[]),o=this.completerAccessoires(a,t.phases);return o},a.prototype.modifAccessoireProduitFonctionOrigine=function(e,t){var i,r=[];if(""!==t.codeTypeAccessoire||"B10"===t.regleAppelAccessoireAperiodique||"B11"===t.regleAppelAccessoireAperiodique||"B13"===t.regleAppelAccessoireAperiodique){i=angular.copy(t);for(var a=0,o=e;a<o.length;a++){var s=o[a];this.isAccessoiresEquals(s,t)&&""!==s.codeTypePhase&&"21"!==s.codeNatureAccessoire&&"22"!==s.codeNatureAccessoire&&(i=n.AccessoireInfoCreditAdapaterProduitBuilder.getResult(s),r.push(i))}i.codeRoleCreditAvenant=""}return r},a.prototype.isAccessoiresEquals=function(e,t){return t.codeTypeAccessoire===e.codeTypeAccessoire&&t.codeTypePhase===e.codeTypePhase&&t.identifiantConvention===e.identifiantConvention&&t.noRelatifPhaseTypePhaseProduit===e.noRelatifPhaseTypePhaseProduit},a.prototype.modifAccessoireSansProduit=function(e,t){var i=this;return"A02"!==t.numeroRegleApplicationElement&&"A03"!==t.numeroRegleApplicationElement?null:_.any(e,function(e){return i.isAccessoiresEquals(t,e)})?null:n.AccessoireInfoCreditAdapaterProduitBuilder.getResult(t)},a.prototype.completerAccessoires=function(e,t){for(var n=angular.copy(e),i=!1,r=function(e){var r=void 0;if(i=!1,null!==e.codeTypePhase&&null===e.codeSousTypeAccessoireCompl){0===e.noRelatifPhaseTypePhaseProduit&&(r=_.filter(t,function(t){return t.codeTypePhase===e.codeTypePhase})),0!==e.noRelatifPhaseTypePhaseProduit&&(r=_.filter(t,function(t){return t.codeTypePhase===e.codeTypePhase&&t.noRelatifPhaseTypePhaseProduit===e.noRelatifPhaseTypePhaseProduit}));for(var a=function(t){i=_.some(n,function(n){return n.codeTypePhase===t.codeTypePhase&&n.noRelatifPhaseTypePhaseProduit===t.noRelatifPhaseTypePhaseProduit&&n.numeroPhase===t.numeroPhase&&n.codeTypeAccessoire===e.codeTypeAccessoire}),i||(i=_.some(n,function(n){return n.codeTypePhase===t.codeTypePhase&&n.noRelatifPhaseTypePhaseProduit===t.noRelatifPhaseTypePhaseProduit&&0===n.numeroPhase&&n.codeTypeAccessoire===e.codeTypeAccessoire}),_.each(n,function(n){n.codeTypePhase===t.codeTypePhase&&n.noRelatifPhaseTypePhaseProduit===t.noRelatifPhaseTypePhaseProduit&&0===n.numeroPhase&&n.codeTypeAccessoire===e.codeTypeAccessoire&&(n.numeroPhase=t.numeroPhase,n.noPhaseCreditProchaineRevision=t.numeroPhase)})),i||(i=_.some(n,function(n){return n.codeTypePhase===t.codeTypePhase&&0===n.noRelatifPhaseTypePhaseProduit&&0===n.numeroPhase&&n.codeTypeAccessoire===e.codeTypeAccessoire}),_.each(n,function(n){n.codeTypePhase===t.codeTypePhase&&0===n.noRelatifPhaseTypePhaseProduit&&0===e.numeroPhase&&n.codeTypeAccessoire===e.codeTypeAccessoire&&(n.noRelatifPhaseTypePhaseProduit=t.numeroPhase,n.numeroPhase=t.numeroPhase,n.noPhaseCreditProchaineRevision=t.numeroPhase)}))},o=0,s=r;o<s.length;o++){var u=s[o];a(u)}}},a=0,o=n;a<o.length;a++){var s=o[a];r(s)}return n},a}(n.AvenantDecorateur);n.AvenantAteDecorateur=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Business.Modeles.ConditionsVariationDureeProduit,r=e.Commun.ToolsFunctionals.PeriodiciteHelper,a=function(a){function o(t){a.call(this,t),this.phaseOrigineEnCours=n.FonctionsChPourInit.getPhaseEnCoursCreditOrigine(this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit),this.creditAvenantFinancier=this.getCredit(this.isAvecChangementProduit,this.creditChangePdt,this.avenantDescriptionBase.dataRestAvenant.produitCredit,this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.dateTraitement,this.avenantDescriptionBase.dataRestAvenant.listeIndice,this.codeTypeAcces),this.initialisationPhases=this.initPhases(this.avenantDescriptionBase.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Creation,this.avenantDescriptionBase.isAvecChangementProduit,this.avenantDescriptionBase.dataRestAvenant.creditCaraFinan.phases,this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.creditChangePdt),this.nouvellePhaseAMSupOrigine=this.getNouvellePhaseAMSupOrigine(this.creditChangePdt,this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit.phases,this.phaseOrigineEnCours.numeroPhase,this.initialisationPhases),this.listePhaseStock=this.getPhases(this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.dataRestAvenant.produitCredit,this.avenantDescriptionBase.dataRestAvenant.listeIndice,this.avenantDescriptionBase.dataRestAvenant.palierCredit,this.avenantDescriptionBase.dateTraitement,this.avenantDescriptionBase.dateFinPrefinancementReelle,this.creditChangePdt,this.initialisationPhases,this.creditAvenantFinancier,this.nouvellePhaseAMSupOrigine,this.isAvenantRecouvrement,this.codeTypeAcces),this.isAmortissementALaCarte=this.fct_isAmortissementALaCarte(this.listePhaseAvailables,this.dataRestAvenant.creditOrigineInfoCredit.numeroPhase),this.isCreditLissage=this.isAvecChangementProduit?this.getIsCreditWithAjustementEcheances(this.creditChangePdt,2):this.getIsCreditWithAjustementEcheances(this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit.numeroPhase),null!==this.creditChangePdt&&(this.numeroPhaseEnCoursCreditOrigine=this.phaseOrigineEnCours.numeroPhase,this.numeroPremiereEcheanceLastPalierPhaseO=this.getNumeroPremiereEcheanceLastPalierPhaseO(this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit.phases));var o=null!=this.creditChangePdt?this.creditChangePdt:this.dataRestAvenant.creditCurrentInfoCredit,s=_.filter(this.avenantDescriptionBase.dataRestAvenant.produitCredit.variationsDureeProduit,function(e){return e.dureeMinimumPlageConditionTaux<=o.dureeCredit&&o.dureeCredit<=e.dureeMaximumPlageConditionTaux});if(this.showVariationDureeProduitForChgtProduit=s.length>0&&null!=this.creditChangePdt,this.showVariationDureeProduitForProduitInitial=s.length>0&&!(null!=this.creditChangePdt),this.showVariationDureeProduitForChgtProduit||this.showVariationDureeProduitForProduitInitial){this.isEditionVariationDureeProduit=this.showVariationDureeProduitForChgtProduit&&"X01"===_.first(s).regleDeterminationDAllong,this.isOpenVariationDureeProduit=this.isEditionVariationDureeProduit,this.cdTypeButoir=_.first(s).cdTypeButoirDuree,this.reductionMaxCredit=i.getReductionMaxDuree(s,o.uniteDureeCredit),this.traitementEcheanceDureeProduit=i.getTraitementEcheanceDureeProduit(this.avenantDescriptionBase.dataRestAvenant.produitCredit.phases);var u=i.getMotifCondition(s);this.motifAllongementDureeProduit=u[0],this.conditionsDureeProduit=u[1];var c=i.getDureeBornePourcentage(s,o);this.borneMinVariationDureeProduit=c[1],this.borneMaxVariationDureeProduit=c[2],this.bornesVariationDureeProduit="["+this.borneMinVariationDureeProduit+", "+this.borneMaxVariationDureeProduit+"] "+r.getLibellePeriodeBase(o.uniteDureeCredit),this.dureeVariationDureeProduit=c[0],this.pourcentageAllongementDureeProduit=c[3]}}return __extends(o,a),Object.defineProperty(o.prototype,"listePhaseAvailables",{get:function(){return _.filter(this.listePhaseStock,function(e){return t.ToolsFunctionals.FonctionsPhasePalier.isPhaseAvailable(e)})},enumerable:!0,configurable:!0}),o.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit()},o.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.getDisabledValider()},o.prototype.getIsCreditWithAjustementEcheances=function(t,n){var i=_.filter(t.phases,function(e){return e.numeroPhase>=n}),r=_.filter(i,function(n){return"O"===e.Business.ToolsFunctionals.FonctionsPhasePalier.getElementModifiableParAvenant(n,t,moment(t.dateFinPrefinancementReelle).toDate())});return e.Business.ToolsFunctionals.FonctionsPhasePalier.getAvecAjustementEcheances(r,n,t.numeroEcheance)},o.prototype.getCredit=function(e,t,i,r,a,o,s){return e?new n.CreditAvenantFinancier(t,i,a,!0,o,s,r):new n.CreditAvenantFinancier(r,i,a,!1,o,s,r)},o.prototype.initPhases=function(e,t,n,i,r){return _.sortByOrder(this.getListePhasesInfoCredit(e,t,n,i,r),function(e){return e.numeroPhase})},o.prototype.getPhases=function(e,t,i,r,a,o,s,u,c,l,d,m){return this.isAvecChangementProduit?_.map(u,function(e){return new n.Phase(e,s,t,i,null!=r?r.paliers:[],a,o,!0,c,l,d,m)}):_.map(u,function(s){return new n.Phase(s,e,t,i,null!=r?r.paliers:[],a,o,!1,c,l,d,m)})},o.prototype.getListePhasesInfoCredit=function(e,t,i,r,a){if(e)return t?null!==a?a.phases:[]:_.filter(r.phases,function(e){return e.identifiantCredit===r.identifiantCredit&&e.codeRoleCreditAvenant===r.codeRoleCreditAvenant});var o=_.filter(i,function(e){return e.identifiantCredit===r.identifiantCredit});return _.map(o,function(e){return new n.PhaseCaraFinanAdapater(e)})},o.prototype.getNumeroPremiereEcheanceLastPalierPhaseO=function(e){var t=_.sortBy(e,function(e){return e.numeroPhase}),n=_.last(t),i=null!==n?_.last(n.paliersTauxInterets):null;return null!==i?i.numeroPremiereEcheancePalier:0},o.prototype.getNouvellePhaseAMSupOrigine=function(e,t,i,r){if(null!==e){var a=n.CalculDureeChInit.getNombrePhaseAMOrigine(t,i),o=r.length-1;return o>a}return!1},o.prototype.fct_isAmortissementALaCarte=function(e,t){for(var n=!1,i=0,r=e;i<r.length;i++){var a=r[i];_.every(a.listePalier,function(e){return"6"===e.typeRemboursement})&&("6"===a.phaseByRest.modeCalculAmortissement?n=!0:("2"===a.phaseByRest.modeCalculAmortissement||"7"===a.phaseByRest.modeCalculAmortissement)&&(n=!1))}return n},o}(n.AvenantDecorateur);n.AvenantCreditDecorateur=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.List,r=function(e){function r(n){e.call(this,n),this.dataGaranties={descriptionObjetFinance:i.firstOrEmpty(this.avenantDescriptionBase.dataRestAvenant.dataGaranties.descriptionObjetFinance),tocObjetFinanceOrigine:t.ToolsFunctionals.Garantie.getTypeObjetCommercialFinanceCreditOrigine(this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit.typeObjetFinanceGaranti,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.objetNatureGaranties,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.objetsCommerciaux,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.objetReglementeParCategories,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.objetsReglementes)},this.listeGarantiesStock=this.getListeGaranties(this.dataGaranties.tocObjetFinanceOrigine,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.garantieExistante,this.dataGaranties.descriptionObjetFinance,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.garantieSureteReelle,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.garantieSuretePerso,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.elementCalculGarantie,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.paramModaliteMotifEstimation,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.motifEstimations,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.typologieInstructions,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.personneAssurableOuGarants,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.personAssurableGarantCatalogues,null!=this.avenantDescriptionBase.dataRestAvenant.dataAssurances?this.avenantDescriptionBase.dataRestAvenant.dataAssurances.listeEncoursPersonneAssuHorsCreditEncours:[],this.avenantDescriptionBase.dateTraitement,this.avenantDescriptionBase.dateEffet,this.avenantDescriptionBase.codeTypeAcces,this.avenantDescriptionBase.isAvecChangementProduit?this.avenantDescriptionBase.creditChangePdt:this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.isVersementAttenduAjoutable,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.versementAttendusGarantie,this.avenantDescriptionBase.isAvenantPeriodicite,_.some(this.avenantDescriptionBase.listePhaseStock,function(e){return e.isPhaseActive&&e.isScission}))}return __extends(r,e),r.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit()},r.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.getDisabledValider()},r.prototype.getListeGaranties=function(e,i,r,a,o,s,u,c,l,d,m,h,p,f,A,P,v,g,C,E){var b=this,T=t.ToolsFunctionals.Garantie.getListeGarant(d,m,h);return _.map(i,function(t){var i=n.GarantieApplicableBuilder.getGarantieApplicableForGarantie(t,b.avenantDescriptionBase);return new n.Garantie(p,f,A,e,P,r,u,c,l,null,t,i,T,v,C,E,a,o,g,_.filter(s,function(e){return e.identifiantGarantie===t.identifiantGarantie}))})},r}(n.AvenantDecorateur);n.AvenantGarantieDataDecorateur=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=function(i){function r(e){i.call(this,e),this._idNouvelleGarantie=1}return __extends(r,i),Object.defineProperty(r.prototype,"isAvenantGarantie",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"listeGarantiesAvailables",{get:function(){return _.filter(this.listeGarantiesStock,function(e){return e.etatManipulation!==t.Enum.EtatManipulation.ToDelete})},enumerable:!0,configurable:!0}),r.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit().concat(e.Commun.Enum.ModificationCredit.Garantie)},r.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.getDisabledValider()},r.prototype.addGarantie=function(){this.listeGarantiesStock.push(new n.Garantie(this.avenantDescriptionBase.dateTraitement,this.avenantDescriptionBase.dateEffet,this.avenantDescriptionBase.codeTypeAcces,this.avenantDescriptionBase.dataGaranties.tocObjetFinanceOrigine,this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.dataGaranties.descriptionObjetFinance,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.paramModaliteMotifEstimation,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.motifEstimations,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.typologieInstructions,this._idNouvelleGarantie++,null,null,t.ToolsFunctionals.Garantie.getListeGarant([],this.avenantDescriptionBase.dataRestAvenant.dataGaranties.personAssurableGarantCatalogues,null!=this.avenantDescriptionBase.dataRestAvenant.dataAssurances?this.avenantDescriptionBase.dataRestAvenant.dataAssurances.listeEncoursPersonneAssuHorsCreditEncours:[]),this.avenantDescriptionBase.isVersementAttenduAjoutable,this.avenantDescriptionBase.isAvenantPeriodicite,_.some(this.avenantDescriptionBase.listePhaseStock,function(e){return e.isPhaseActive&&e.isScission})))},r.prototype.setDataObjetFinanceByObjet=function(e){var n=this;e.projetFinance.typeObjetFinanGaranti!==this.avenantDescriptionBase.dataGaranties.tocObjetFinanceOrigine.typeObjetFinanGaranti&&(this.avenantDescriptionBase.dataGaranties.tocObjetFinanceOrigine=t.ToolsFunctionals.Garantie.getTypeObjetCommercialFinanceCreditOrigine(e.projetFinance.typeObjetFinanGaranti,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.objetNatureGaranties,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.objetsCommerciaux,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.objetReglementeParCategories,this.avenantDescriptionBase.dataRestAvenant.dataGaranties.objetsReglementes)),this.avenantDescriptionBase.dataGaranties.descriptionObjetFinance=this.getDescriptionObjetFinanceUpdated(this.avenantDescriptionBase.dataGaranties.descriptionObjetFinance,e),_.each(this.listeGarantiesStock,function(t){t.isGarantieSureteReelleAutre&&t.garantieSureteReelleAutre.setDataByObjet(e,n.avenantDescriptionBase.dataGaranties.tocObjetFinanceOrigine,n.avenantDescriptionBase.dataGaranties.descriptionObjetFinance)})},r.prototype.getDescriptionObjetFinanceUpdated=function(e,t){var n=angular.copy(e);return n.descriptionLObjet=t.descObjet,n.referenceExterneObjet=t.referenceExterne,n.codeTypeLogement=null!=t.typeLogementBien?t.typeLogementBien.key:null,n.codeDestinationAutoriseeObjet=null!=t.objetDestination?t.objetDestination.key:null,n.surfaceHabitableEnM2=t.surfaceHabitableBien,n.surfaceTerrainEnM2=t.surfaceTerrain,n.typeObjetReglementeTor=t.precisionReglementaire.type,n.adresseLigne1=t.adresseObjetComposant.afnor.ligne1,n.adresseLigneSuite6=t.adresseObjetComposant.afnor.ligne6,n.adresseLigne2=t.adresseObjetComposant.afnor.ligne4,n.adresseLigne3=t.adresseObjetComposant.afnor.ligne5,n.adresseLigneCodePostal4=t.adresseObjetComposant.codePostal,n.adresseLigneCommune5=t.adresseObjetComposant.libelleInseeLocaliteWithArrondissement,n.codePaysLocalisation=t.adresseObjetComposant.pays.codePaysIsoAfnor,n},r}(n.AvenantDecorateur);n.AvenantGarantieDecorateur=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(t){function n(n){t.call(this,n);var i=this.getListeToc(this.avenantDescriptionBase.dataRestAvenant.dataObjet.typeObjetCommercials,this.avenantDescriptionBase.dataRestAvenant.dataObjet.typeObjetReglementes);this.infoObjet=new e.InfoObjet(this.avenantDescriptionBase.dataRestAvenant.dataObjet.typologieInstructions,this.avenantDescriptionBase.dataRestAvenant.dataObjet.creditObjet,this.avenantDescriptionBase.codeTypeAcces,this.avenantDescriptionBase.dataRestAvenant.dataObjet.controleZonePtz,i)}return __extends(n,t),n.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit()},n.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.getDisabledValider()},n.prototype.getListeToc=function(t,n){var i=_.map(t,function(t){return e.TypeObjetCommercialBuilder.getTocByObjet(t,n)});return _.sortByOrder(i,function(e){return e.libelleLong},!0)},n}(e.AvenantDecorateur);e.AvenantObjetDataDecorateur=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=function(n){function i(e){n.call(this,e)}return __extends(i,n),Object.defineProperty(i.prototype,"isAvenantObjet",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit().concat(e.Commun.Enum.ModificationCredit.Objet)},i.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.TwoIsObjet?this.avenantDescriptionBase.getDisabledValider()||this.avenantDescriptionBase.infoObjet.loadingZones||!this.avenantDescriptionBase.infoObjet.isValid():this.avenantDescriptionBase.getDisabledValider()},i.prototype.beforeSave=function(){this.avenantDescriptionBase.beforeSave(),this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.TwoIsObjet&&(this.avenantDescriptionBase.infoObjet.reportDataAdresseComposantToDataAdresse(),this.avenantDescriptionBase.setDataObjetFinanceByObjet(this.infoObjet))},i}(n.AvenantDecorateur);n.AvenantObjetDecorateur=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=function(e){function i(n){e.call(this,n);var i=this.getListeCategorie(this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.categorieEmprunteurs);this.emprunteurActuel=this.getEmprunteurActuel(this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.emprunteur,i),this.emprunteurNouveau=new t.EmprunteurNouveau(this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.emprunteur,this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.payeurs,this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.listePersonneEmprunteurs,this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.listePersonneWithComptes,this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.listeParticulierInformation,this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.listeCorporateInformation,i,this.getListeMotifChangement(this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.motifs),this.getListeModeRecouvrement(this.avenantDescriptionBase.dataRestAvenant.dataPersonnes.motifRecouvrements),this.avenantDescriptionBase.codeTypeAcces);
}return __extends(i,e),i.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit()},i.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.getDisabledValider()},i.prototype.getEmprunteurActuel=function(e,t){return{libelleLong:e.libelleTiers,categorie:n.findOrEmpty(t,function(t){return t.codeCategorie===e.codeCategorieEmprunteur})}},i.prototype.getListeCategorie=function(e){var t=this;return _.sortBy(_.map(e||[],function(e){return t.getCategorie(e)}),function(e){return e.numeroOrdreClassement})},i.prototype.getCategorie=function(e){return{codeCategorie:e.codeCategorieEmprunteur,codeTypeMarche:e.codeTypeMarche,libelle:e.libelleCategorieEmprunteur,numeroOrdreClassement:e.numeroOrdreClassement}},i.prototype.getListeMotifChangement=function(e){var t=this;return _.map(e||[],function(e){return t.getMotifChangement(e)})},i.prototype.getMotifChangement=function(e){return{codeMotifBlocage:e.codeMotifBlocageApl,libelle:e.libelleMotifBlocageApl}},i.prototype.getListeModeRecouvrement=function(e){var t=this;return _.sortBy(_.map(e,function(e){return t.getModeRecouvrement(e)}),function(e){return e.numeroOrdreClassement})},i.prototype.getModeRecouvrement=function(e){return{codeModeReglement:e.codeModeReglement,libelleCourt:e.libelleCourtModeReglement,libelleLong:e.libelleLongModeReglement,codeTypeDomiciliation:e.codeTypeDomiciliation,numeroOrdreClassement:e.numeroOrdreClassement}},i}(t.AvenantDecorateur);t.AvenantPersonneDataDecorateur=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=function(i){function r(e){i.call(this,e)}return __extends(r,i),Object.defineProperty(r.prototype,"isAvenantPersonnes",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"idEmprunteur",{get:function(){return this.avenantDescriptionBase.emprunteurNouveau.idEntiteTitulaire},enumerable:!0,configurable:!0}),r.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit().concat(e.Commun.Enum.ModificationCredit.Personne)},r.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.OneIsPersonnes?this.avenantDescriptionBase.getDisabledValider()||this.avenantDescriptionBase.emprunteurNouveau.payeurSecours.modeEdition||_.some(this.avenantDescriptionBase.emprunteurNouveau.listePayeurAvailables,function(e){return e.modeEdition}):this.avenantDescriptionBase.getDisabledValider()},r.prototype.beforeSave=function(){this.avenantDescriptionBase.beforeSave(),this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.OneIsPersonnes&&this.setDataAssurancesByAvenantPersonne()},r.prototype.setDataAssurancesByAvenantPersonne=function(){var i=this,r=_.map(_.filter(this.avenantDescriptionBase.emprunteurNouveau.listePersonneEmprunteur,function(t){return t.typePersonne===e.Commun.Enum.TypePersonne.PersonnePhysique}),function(e){return n.PersonneAssurableGarantBuilder.getResultByPersonneEmprunteur(e,null!=i.avenantDescriptionBase.dataRestAvenant.dataAssurances?i.avenantDescriptionBase.dataRestAvenant.dataAssurances.listeEncoursPersonneAssuHorsCreditEncours:[])}),a=_.map(r,function(e){return e.identifiantPersonne});_.each(this.avenantDescriptionBase.listeAssurancesStock,function(e){var n=null!=e.personneSelected&&_.some(a,function(t){return t===e.personneSelected.identifiantPersonne});n?e.dataListePersonne=r:e.etatManipulation!==t.Enum.EtatManipulation.IsCreation?e.etatManipulation=t.Enum.EtatManipulation.ToDelete:_.remove(i.listeAssurancesStock,e)}),this.avenantDescriptionBase.setListePersonnesAssurable(r),this.avenantDescriptionBase.setDataAssurancesForCalculatrice()},r}(n.AvenantDecorateur);n.AvenantPersonneDecorateur=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(t){function n(e){t.call(this,e)}return __extends(n,t),Object.defineProperty(n.prototype,"isAvenantQuantieme",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.getDateEffetRetenue=function(){return this.dateEffetModifieQuantieme},n.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit().concat(e.Commun.Enum.ModificationCredit.Quantieme)},n.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.getDisabledValider()},n.prototype.changeDateEffetQuantieme=function(){this.dateEffetModifieQuantieme=this.getDateEffetWithSaisieQuantieme(this.avenantDescriptionBase.creditAvenantFinancier.numeroQuantiemeSaisi,this.avenantDescriptionBase.dateEffet)},n.prototype.getDateEffetWithSaisieQuantieme=function(e,t){if(isNaN(e)||1>e||e>31)return t;var n=parseInt(moment(t).format("D"));if(n>=e)return t;var i=parseInt(moment(t).endOf("month").format("D")),r=i>e?e:i;return moment(t).set("date",r).toDate()},n}(t.AvenantDecorateur);t.AvenantQuantiemeDecorateur=n}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=function(i){function r(e){i.call(this,e),this.reportFinPret=this.getReportFinPret(this.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit,this.avenantDescriptionBase.dataRestAvenant.produitCredit,this.avenantDescriptionBase.dataRestAvenant.creditCaraFinan,this.avenantDescriptionBase.codeTypeAcces,this.avenantDescriptionBase.isAvecChangementProduit)}return __extends(r,i),Object.defineProperty(r.prototype,"isAvenantReportFinPret",{get:function(){return!0},enumerable:!0,configurable:!0}),r.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit().concat(e.Commun.Enum.ModificationCredit.ReportFinPret)},r.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.ThreeIsAutre?this.avenantDescriptionBase.getDisabledValider()||this.reportFinPret.reportFinPretAccesValidation||this.avenantDescriptionBase.isAvecChangementProduit:this.avenantDescriptionBase.getDisabledValider()},r.prototype.getReportFinPret=function(e,t,i,r,a){var o=this,s=_.filter(t.accessoires||[],function(e){return"21"===e.codeNatureAccessoire||"22"===e.codeNatureAccessoire}),u=_.find(e.phases||[],function(e){return o.avenantDescriptionBase.dataRestAvenant.creditCurrentInfoCredit.numeroPhase===e.numeroPhase});return n.AvenantReportFinPretBuilder.getResult(e,u,s,r,i,a)},r}(n.AvenantDecorateur);n.AvenantReportFinPretDecorateur=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.decorate=function(e){null!=e.dataRestAvenant.dataServicesObjet&&(e.listeElementCalculServicesObjet=e.dataRestAvenant.dataServicesObjet.listeElementCalculServicesObjet)},e}();e.AvenantServicesObjetDecorateur=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.List,r=function(n){function r(e){n.call(this,e),this.isNouvelleNoteDpe=this.getIsNouvelleNoteDpe(e)}return __extends(r,n),Object.defineProperty(r.prototype,"isAvenantTauxDuree",{get:function(){return!0},enumerable:!0,configurable:!0}),r.prototype.getIsNouvelleNoteDpe=function(e){return this.isPretImpact?null!=e.detailDpeAvenant&&e.detailDpeAvenant.indPerformanceEnergetique!==e.detailDpeOrigine.codePerformanceEnergetique:!1},r.prototype.getListeModificationCredit=function(){return this.avenantDescriptionBase.getListeModificationCredit().concat(e.Commun.Enum.ModificationCredit.Financier)},r.prototype.getDisabledValider=function(){return this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.ThreeIsAutre?this.avenantDescriptionBase.getDisabledValider()||this.getDisabledValiderFinancier():this.avenantDescriptionBase.getDisabledValider()},r.prototype.beforeSave=function(){if(this.avenantDescriptionBase.beforeSave(),this.avenantDescriptionBase.stepAvenant===t.Enum.StepAvenant.ThreeIsAutre&&(this.avenantDescriptionBase.listePhaseStock=t.ToolsFunctionals.FonctionsPhasePalier.miseAJourCodeCaracFinancierePhasePalier(this.avenantDescriptionBase.listePhaseStock),t.ToolsFunctionals.Avenant.getIsTopCalculatrice(this)?3===this.avenantDescriptionBase.typeCalculAjustementEcheances&&this.avenantDescriptionBase.isAmortissementALaCarte&&(this.avenantDescriptionBase.listePhaseStock=this.miseAJourPalierTauxInteret(this.avenantDescriptionBase.listePhaseStock,this.avenantDescriptionBase.palierTauxInteretAvantCalculettes,this.avenantDescriptionBase.dataRestAvenant.creditOrigineInfoCredit.numeroPhase)):this.avenantDescriptionBase.reportModificationsDuree(),this.avenantDescriptionBase.isAvenantPeriodicite)){for(var e=0,n=this.avenantDescriptionBase.listeAssurancesStock;e<n.length;e++){var i=n[e];i.etatManipulation!==t.Enum.EtatManipulation.Unchanged&&(i.listeAccessoire=t.ToolsFunctionals.PeriodicitePhase.modificationAccessoiresAssuranceByPeriodicite(i.etatManipulation,i.listeAccessoire,this.avenantDescriptionBase.listePhaseStock))}for(var r=0,a=this.avenantDescriptionBase.listeGarantiesStock;r<a.length;r++){var o=a[r];o.isGarantieSuretePersonnelle&&o.etatManipulation!==t.Enum.EtatManipulation.Unchanged&&(o.garantieSuretePersonnelle.listeAccessoire=t.ToolsFunctionals.PeriodicitePhase.modificationAccessoiresGarantieByPeriodicite(o.garantieSuretePersonnelle.listeAccessoire,this.avenantDescriptionBase.listePhaseStock))}}},r.prototype.getDisabledValiderFinancier=function(){return _.some(this.avenantDescriptionBase.listePhaseAvailables,function(e){return e.isInvalid||e.isDureePhaseAbsorbee||e.isPeriodiciteInvalide||e.isModifPhaseInvalide})?!0:t.ToolsFunctionals.Avenant.getIsTopCalculatrice(this.avenantDescriptionBase)||this.avenantDescriptionBase.creditAvenantFinancier.isDureeTotaleValid()&&this.avenantDescriptionBase.creditAvenantFinancier.isDureeResiduelleValid()&&this.avenantDescriptionBase.creditAvenantFinancier.isEcheanceValid()?!1:!0},r.prototype.miseAJourPalierTauxInteret=function(e,t,n){var r=_.last(_.last(_.last(e).listePalier).listeEcheanceALaCarte);_.last(t).numeroDerniereEcheance=r.numeroEcheance,_.last(t).duree=_.last(t).numeroDerniereEcheance-_.last(t).numeroPremiereEcheance+1;for(var a=angular.copy(e),o=0,s=a;o<s.length;o++){var u=s[o];if(u.numeroPhase>=n){for(var c=[],l=function(e){var n=i.findOrEmpty(t,function(t){return e.numeroPhase===t.numeroPhase&&e.numeroPremiereEcheance>=t.numeroPremiereEcheance&&e.numeroDerniereEcheance<=t.numeroDerniereEcheance});(e.numeroPremiereEcheance!==n.numeroPremiereEcheance||e.numeroDerniereEcheance!==n.numeroDerniereEcheance)&&(c.push(_.first(e.listeEcheanceALaCarte)),e.listeEcheanceALaCarte=[],e.numeroPremiereEcheance!==n.numeroPremiereEcheance&&(e.numeroPremiereEcheance=n.numeroPremiereEcheance),e.numeroDerniereEcheance!==n.numeroDerniereEcheance&&(e.numeroDerniereEcheance=n.numeroDerniereEcheance),e.duree=n.duree,e.elementModifiableParAvenant=n.elementModifiableParAvenant),e.numeroPalier=n.numeroPalier,e.numeroRelatif=n.numeroRelatif},d=0,m=u.listePalier;d<m.length;d++){var h=m[d];l(h)}u.listePalier=this.modificationPaliers(u.listePalier,c)}}return a},r.prototype.modificationPaliers=function(e,t){for(var n=[],i=_.first(e).numeroPremiereEcheance,r=0;r<e.length;r++)0===r?(i=e[0].numeroPremiereEcheance,n.push(e[0])):e[r].numeroPremiereEcheance!==i&&(n.push(e[r]),i=e[r].numeroPremiereEcheance);for(var a=0,o=n;a<o.length;a++)for(var s=o[a],u=0,c=t;u<c.length;u++){var l=c[u];l.numeroEcheance>=s.numeroPremiereEcheance&&l.numeroEcheance<=s.numeroDerniereEcheance&&s.listeEcheanceALaCarte.push(l)}return n},r}(n.AvenantDecorateur);n.AvenantTauxDecorateur=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getResult=function(e,t,n){return{codeNatureGarantie:e,codeNatureCautionnement:t.codeNatureCautionnement,idConvention:t.identifiantConvention,idIntervenant:t.identifiantIntervenant,libelleLong:t.libelleLongConvention,libelleDescription:t.libelleLongConvention+" - "+t.numeroExterneConvention+" - "+t.identifiantConvention,cdModeExpressionGarantieAccorde:t.cdModeExpressionGarantieAccorde,montantMinimumGarantiParTete:t.montantMinimumGarantiParTete,montantMaximumGarantiParTete:t.montantMaximumGarantiParTete,pasMontantGarantiParTete:t.pasMontantGarantiParTete,quotiteMinimumParBeneficiaire:t.quotiteMinimumParBeneficiaire,quotiteMaximumParBeneficiaire:t.quotiteMaximumParBeneficiaire,pasQuotiteParBeneficiaire:t.pasQuotiteParBeneficiaire,listeAccessoires:n}},e}();e.ConventionGarantieApplicableBuilder=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getTypologieInstruction=function(e){return{type:e.typeTypologie,code:e.codeTypologie,libelleLong:e.intitule}},e.getMasqueDefinitionObjetGarantie=function(e){switch(e){case"01":return 2;case"07":case"13":return 1;case"10":case"11":return 0;case"14":return 3;default:return null}},e.getShowNumeroComptePopin=function(e,t){return 1===e||3===e||0===e&&t.showReferenceDeuxNumCompte?!0:!1},e.getLabelDescription=function(e){switch(e){case"00":case"01":case"04":case"09":case"10":case"13":case"14":case"99":return"Description";case"02":return"Dénomination de l'objet";case"03":return"Dénomination du fond de commerce";case"05":return"Nom marque dénomination";case"06":return"Marque et dénomination";case"08":case"12":return"Raison social du débiteur cédé";case"07":return"Dénomination";case"11":return"Nom et prénom de l'assuré";default:return"Description"}},e.getShowReferenceUn=function(e){return _.contains(["00","02","03","04","05","06","09","99"],e)},e.getShowLabelReferenceUn=function(e){return _.contains(["00","02","03","04","05","06","09"],e)},e.getLabelReferenceUn=function(e){switch(e){case"00":return"Référence 1";case"02":return"Numéro de série";case"03":return"Lieu et n° d’immat. au registre du commerce";case"04":return"Etablissement";case"05":return"Type";case"06":return"N° d'immatriculation";case"09":return"Référence au cadastre";default:return null}},e.getShowReferenceDeux=function(e){return _.contains(["00","02","03","05","06","09","99"],e)},e.getShowReferenceDeuxCompte=function(e){return _.contains(["04"],e)},e.getShowLabelReferenceDeux=function(e){return _.contains(["00","02","03","05","06","09"],e)},e.getLabelReferenceDeux=function(e){switch(e){case"00":return"Référence 2";case"02":return"N° d'immatriculation";case"03":return"Libre";case"05":return"N° de série";case"06":return"N° dans la série";case"09":return"N° de lot";case"10":return"N° de compte";case"11":return"N° de contrat";default:return null}},e.getLabelBlocAdresse=function(e){switch(e){case"00":case"01":case"02":case"03":case"05":case"06":return"Localisation du bien";case"04":case"07":case"08":case"09":case"10":case"12":case"99":return"Adresse";case"11":return"Adresse siège social";case"13":return"Nom / Adresse du locataire";case"14":return"Dépositaire";default:return"Localisation du bien"}},e.getAdresseLigne1IsRequired=function(e){return _.contains(["01","02","03","05","07","08","09"],e)},e.getShowBtnPopinDescription=function(e){return _.contains(["01","07","10","11","13","14"],e)},e}();e.DefinitionObjetGarantieHelper=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.ToolsFunctionals.Garantie,r=e.Commun.Tools.List,a=e.Commun.Tools.DateUtils,o=e.Commun.Tools.Object,s=function(){function e(e,t,r,s,u,c,l){var d=this;void 0===l&&(l=!1),this.isDefinitionObjetFinance=l,this.dataListeZoneImplantation=this.getListeTypologieInstruction(r,"02"),this.dataTypeObjetReglemente=(s||{}).listeTor||[],this.dataListTypeBien=this.getListeTypologieInstruction(r,"01"),this.showReferenceUn=n.DefinitionObjetGarantieHelper.getShowReferenceUn(s.typologieLObjet),this.showLabelReferenceUn=n.DefinitionObjetGarantieHelper.getShowLabelReferenceUn(s.typologieLObjet),this.labelReferenceUn=n.DefinitionObjetGarantieHelper.getLabelReferenceUn(s.typologieLObjet),this.showReferenceDeux=n.DefinitionObjetGarantieHelper.getShowReferenceDeux(s.typologieLObjet),this.showLabelReferenceDeux=n.DefinitionObjetGarantieHelper.getShowLabelReferenceDeux(s.typologieLObjet),this.labelReferenceDeux=n.DefinitionObjetGarantieHelper.getLabelReferenceDeux(s.typologieLObjet),this.showReferenceDeuxCompte=n.DefinitionObjetGarantieHelper.getShowReferenceDeuxCompte(s.typologieLObjet),this.labelDescription=n.DefinitionObjetGarantieHelper.getLabelDescription(s.typologieLObjet),this.labelBlocAdresse=n.DefinitionObjetGarantieHelper.getLabelBlocAdresse(s.typologieLObjet),this.adresseLigne1IsRequired=n.DefinitionObjetGarantieHelper.getAdresseLigne1IsRequired(s.typologieLObjet),this.dataAdresse=this.getDataAdresse(e,l,t),this.showBtnPopinDescription=n.DefinitionObjetGarantieHelper.getShowBtnPopinDescription(s.typologieLObjet),null!=e?this.identifiantObjet=e.identifiantObjet:l&&null!=t?this.identifiantObjet=t.identifiantObjet:this.identifiantObjet=null,this.masqueDefinitionObjet=n.DefinitionObjetGarantieHelper.getMasqueDefinitionObjetGarantie(s.typologieLObjet),this.configFsdgad=n.ConfigFsdgadBuilder.getResult(this.masqueDefinitionObjet,e,l,t),this.configFsdgac=n.ConfigFsdgacBuilder.getResult(this.masqueDefinitionObjet,e,l,t),this.configFsdga4=n.ConfigFsdga4Builder.getResult(this.masqueDefinitionObjet,s.typologieLObjet,e,l,t),this.configFsdgae=n.ConfigFsdgaeBuilder.getResult(this.masqueDefinitionObjet,s.typologieLObjet,e,l,t,null!=this.identifiantObjet?_.filter(c||[],function(e){return e.identifiantObjet===d.identifiantObjet}):[],u),this.showNumeroComptePopin=n.DefinitionObjetGarantieHelper.getShowNumeroComptePopin(this.masqueDefinitionObjet,this.configFsdgae),this.referenceDeuxIsCompte=this.showReferenceDeuxCompte||this.showNumeroComptePopin,this.typeObjetReglemente=this.getTypeObjetReglemente(s,e,l,t),null!=e?(this.description=e.descriptionLObjet,this.referenceUn=e.referenceExterneObjet,this.referenceDeux=this.referenceDeuxIsCompte?null:e.referenceTypeLot,this.numeroCompte=this.referenceDeuxIsCompte?this.getRiceByNumeroCompte(e.referenceTypeLot):null,this.typeBien=_.find(this.dataListTypeBien,function(t){return t.code===_.padLeft(e.detailLOperationImmobiliere,2,"0")}),this.surfaceHabitable=e.surfaceHabitableEnM2,this.surfaceTerrain=e.surfaceTerrainEnM2,this.qualiteEmplacement="BA"===e.codeQualiteLEmplacement?0:1,this.dateDegrevement=a.parse(e.dateDegrevement),this.dateDerniereMutation=a.parse(e.descriptionLObjet2),this.zoneImplantation=_.find(this.dataListeZoneImplantation,function(t){return t.code===e.codeZoneImplantationsituation}),this.typeLogement=i.getTypeLogementByCode(e.codeTypeLogement),this.destinationBien=i.getDestinationBienByCode(e.codeDestinationAutoriseeObjet),this.anneeConstructionRenovationLourde=o.stringToNumber(a.format(e.dateFinConstructionObjet,"YYYY"))):l&&null!=t?(this.description=t.descriptionLObjet,this.referenceUn=t.referenceExterneObjet,this.referenceDeux=this.showReferenceDeuxCompte?null:t.referenceTypeLot,this.numeroCompte=this.showReferenceDeuxCompte?this.getRiceByNumeroCompte(t.referenceTypeLot):null,this.typeBien=_.find(this.dataListTypeBien,function(e){return e.code===_.padLeft(t.detailLOperationImmobiliere,2,"0")}),this.surfaceHabitable=t.surfaceHabitableEnM2,this.surfaceTerrain=t.surfaceTerrainEnM2,this.qualiteEmplacement="BA"===t.codeQualiteLEmplacement?0:1,this.dateDegrevement=a.parse(t.dateDegrevement),this.dateDerniereMutation=a.parse(t.descriptionLObjet2),this.zoneImplantation=_.find(this.dataListeZoneImplantation,function(e){return e.code===t.codeZoneImplantParSituation}),this.typeLogement=i.getTypeLogementByCode(t.codeTypeLogement),this.destinationBien=i.getDestinationBienByCode(t.codeDestinationAutoriseeObjet),this.anneeConstructionRenovationLourde=o.stringToNumber(a.format(t.dateFinConstructionObjet,"YYYY"))):(this.description=null,this.referenceUn=null,this.referenceDeux=null,this.numeroCompte=this.getRiceByNumeroCompte(""),this.typeBien=null,this.surfaceHabitable=null,this.surfaceTerrain=null,this.qualiteEmplacement=null,this.dateDegrevement=null,this.dateDerniereMutation=null,this.zoneImplantation=_.find(this.dataListeZoneImplantation,function(e){return null===e.code}),this.typeLogement=null,this.destinationBien=null,this.anneeConstructionRenovationLourde=null),this.identifiantObjetInitial=this.identifiantObjet}return Object.defineProperty(e.prototype,"showTypeObjetReglemente",{get:function(){return this.dataTypeObjetReglemente.length>0},enumerable:!0,configurable:!0}),e.prototype.setDataByObjet=function(e){this.description=e.descObjet,this.referenceUn=e.referenceExterne,this.surfaceHabitable=e.surfaceHabitableBien,this.surfaceTerrain=e.surfaceTerrain,this.destinationBien=e.objetDestination,this.typeLogement=e.typeLogementBien,this.typeObjetReglemente=r.findOrEmpty(e.projetFinance.listeTor,function(t){return t.type===e.precisionReglementaire.type}),this.dataAdresse={adresseLigne1:e.adresseObjet.adresseLigne1,adresseLigneSuite6:e.adresseObjet.adresseLigneSuite6,adresseLigne2:e.adresseObjet.adresseLigne2,adresseLigne3:e.adresseObjet.adresseLigne3,adresseLigneCodePostal4:e.adresseObjet.adresseLigneCodePostal4,adresseLigneCommune5:e.adresseObjet.adresseLigneCommune5,codePaysLocalisation:this.getCodePays(e.adresseObjet.codePaysLocalisation,e.adresseObjet.adresseLigneCodePostal4)}},e.prototype.reportDataAdresseComposantToDataAdresse=function(){void 0!==this.dataAdresseComposant&&(this.dataAdresse.codePaysLocalisation=this.dataAdresseComposant.pays.codePaysIsoAfnor,this.dataAdresse.adresseLigneCodePostal4=this.dataAdresseComposant.codePostal,this.dataAdresse.adresseLigneCommune5=this.dataAdresseComposant.libelleInseeLocaliteWithArrondissement,this.dataAdresse.adresseLigne1=this.dataAdresseComposant.afnor.ligne1||null,this.dataAdresse.adresseLigneSuite6=this.dataAdresseComposant.afnor.ligne2||null,this.dataAdresse.adresseLigne2=this.dataAdresseComposant.afnor.ligne4,this.dataAdresse.adresseLigne3=this.dataAdresseComposant.afnor.ligne5)},e.prototype.getTypeObjetReglemente=function(e,t,n,i){if(null!=e){if(null!=t&&e.typeObjetFinanGaranti===t.typeObjetFinanceGaranti)return t.typeObjetReglementeTor?r.findOrEmpty(e.listeTor,function(e){return e.type===t.typeObjetReglementeTor}):null;if(n&&null!=i&&e.typeObjetFinanGaranti===i.typeObjetFinanceGaranti)return i.typeObjetReglementeTor?r.findOrEmpty(e.listeTor,function(e){return e.type===i.typeObjetReglementeTor}):null;if(e.listeTor.length>0)return _.first(e.listeTor)}return null},e.prototype.getListeTypologieInstruction=function(e,t){return _.map(_.filter(e,function(e){return e.typeTypologie===t}),function(e){return n.DefinitionObjetGarantieHelper.getTypologieInstruction(e)})},e.prototype.getRiceByNumeroCompte=function(e){return(e||"").length>=21?new MyWay.Model.Rice(e.substr(0,5),e.substr(5,5),e.substr(10,2),e.substr(12,7),e.substr(19,2),e.length>=23?e.substr(21,2):""):new MyWay.Model.Rice},e.prototype.getDataAdresse=function(e,t,n){return null!=e?{adresseLigne1:e.adresseLigne1,adresseLigneSuite6:e.adresseLigneSuite6,adresseLigne2:e.adresseLigne2,adresseLigne3:e.adresseLigne3,adresseLigneCodePostal4:e.adresseLigneCodePostal4,adresseLigneCommune5:e.adresseLigneCommune5,codePaysLocalisation:this.getCodePays(e.codePaysLocalisation,e.adresseLigneCodePostal4)}:t&&null!=n?{adresseLigne1:n.adresseLigne1,adresseLigneSuite6:n.adresseLigneSuite6,adresseLigne2:n.adresseLigne2,adresseLigne3:n.adresseLigne3,adresseLigneCodePostal4:n.adresseLigneCodePostal4,adresseLigneCommune5:n.adresseLigneCommune5,codePaysLocalisation:this.getCodePays(n.codePaysLocalisation,n.adresseLigneCodePostal4)}:{adresseLigne1:null,adresseLigneSuite6:null,adresseLigne2:null,adresseLigne3:null,adresseLigneCodePostal4:null,adresseLigneCommune5:null,codePaysLocalisation:null}},e.prototype.getCodePays=function(e,t){return null!=e?e:null!=t?"FR":null},e.prototype.addVersementAttendu=function(){var e=this.configFsdgae.listeVersementsAttendusStock.length>0?_.last(this.configFsdgae.listeVersementsAttendusStock).idIhm:0;this.configFsdgae.listeVersementsAttendusStock.push(new n.VersementAttendu(e+1,null))},e.prototype.setVersementAttenduEdition=function(e,n){var i=_.findIndex(this.configFsdgae.listeVersementsAttendusStock,function(e){return e.idIhm===n});switch(e){case t.Enum.ActionManipulationElement.Modifier:this.configFsdgae.listeVersementsAttendusBeforeEdit.push(angular.copy(_.find(this.configFsdgae.listeVersementsAttendusStock,function(e){return e.idIhm===n}))),this.configFsdgae.listeVersementsAttendusStock[i].isModeEdition=!0;break;case t.Enum.ActionManipulationElement.Annuler:var r=_.findIndex(this.configFsdgae.listeVersementsAttendusBeforeEdit,function(e){return e.idIhm===n});this.configFsdgae.listeVersementsAttendusStock[i]=this.configFsdgae.listeVersementsAttendusBeforeEdit[r],_.remove(this.configFsdgae.listeVersementsAttendusBeforeEdit,function(e){return e.idIhm===n});break;case t.Enum.ActionManipulationElement.Enregistrer:this.configFsdgae.listeVersementsAttendusStock[i].isModeEdition=!1,this.configFsdgae.listeVersementsAttendusStock[i].isCreationFirstEdition&&(this.configFsdgae.listeVersementsAttendusStock[i].isCreationFirstEdition=!1),_.remove(this.configFsdgae.listeVersementsAttendusBeforeEdit,function(e){return e.idIhm===n}),this.configFsdgae.listeVersementsAttendusStock[i].etatManipulation!==t.Enum.EtatManipulation.IsCreation&&(this.configFsdgae.listeVersementsAttendusStock[i].etatManipulation=t.Enum.EtatManipulation.IsModified);break;case t.Enum.ActionManipulationElement.Supprimer:if(this.configFsdgae.listeVersementsAttendusStock[i].etatManipulation===t.Enum.EtatManipulation.IsCreation)_.remove(this.configFsdgae.listeVersementsAttendusStock,function(e){return e.idIhm===n});else{if(this.configFsdgae.listeVersementsAttendusStock[i].isModeEdition){var a=_.findIndex(this.configFsdgae.listeVersementsAttendusBeforeEdit,function(e){return e.idIhm===n});this.configFsdgae.listeVersementsAttendusStock[i]=this.configFsdgae.listeVersementsAttendusBeforeEdit[a],_.remove(this.configFsdgae.listeVersementsAttendusBeforeEdit,function(e){return e.idIhm===n})}this.configFsdgae.listeVersementsAttendusStock[i].etatManipulation=t.Enum.EtatManipulation.ToDelete}}},e}();n.DefinitionObjetGarantie=s}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.DateUtils,r=function(){function e(){}return e.getGarantieApplicableForGarantie=function(e,t){var i=this.getListeGarantieApplicableActives(t,e.codeNatureGarantie),r=_.find(i,function(t){return t.codeNatureGarantie===e.codeNatureGarantie});return null!=r?new n.GarantieApplicable(r,t.dataRestAvenant.dataGaranties.fraisGarantieParNatures,t.dataRestAvenant.dataGaranties.conventionApplicableCredits,t.dataRestAvenant.dataGaranties.conventionApplicableCatalogues,t.dataRestAvenant.dataGaranties.accessoireConventionCatalogues,t.dataRestAvenant.dataGaranties.objetNatureGaranties,t.dataRestAvenant.dataGaranties.objetsCommerciaux,t.dataRestAvenant.dataGaranties.objetReglementeParCategories,t.dataRestAvenant.dataGaranties.objetsReglementes,this.getIdConventionByGarantieExistante(e.identifiantGarantie,t.dataRestAvenant.dataGaranties.garantieSuretePerso)):{}},e.getListeGarantieApplicable=function(e,t){var i=this,r=null!=({}||t.garantieAppliquee).codeNatureGarantie?t.garantieAppliquee.codeNatureGarantie:null;return _.map(this.getListeGarantieApplicableActives(e,r),function(r){return new n.GarantieApplicable(r,e.dataRestAvenant.dataGaranties.fraisGarantieParNatures,e.dataRestAvenant.dataGaranties.conventionApplicableCredits,e.dataRestAvenant.dataGaranties.conventionApplicableCatalogues,e.dataRestAvenant.dataGaranties.accessoireConventionCatalogues,e.dataRestAvenant.dataGaranties.objetNatureGaranties,e.dataRestAvenant.dataGaranties.objetsCommerciaux,e.dataRestAvenant.dataGaranties.objetReglementeParCategories,e.dataRestAvenant.dataGaranties.objetsReglementes,i.getIdConventionByGarantieLoaded(t,r))})},e.getListeGarantieApplicableActives=function(e,t){return _.filter(e.dataRestAvenant.dataGaranties.garantieApplicables,function(n){return null!=t&&n.codeNatureGarantie===t?!0:i.isBefore(e.dateEffet,n.dateDebutValidite)||i.isAfter(e.dateEffet,n.dateFinValidite)?!1:!0})},e.getIdConventionByGarantieExistante=function(e,t){var n=_.find(t,function(t){return t.identifiantGarantie===e});return null!=n?n.identifiantConvention:null},e.getIdConventionByGarantieLoaded=function(e,n){return null!=e&&e.etatManipulation!==t.Enum.EtatManipulation.IsCreation&&e.garantieAppliquee.codeNatureGarantie===n.codeNatureGarantie&&e.isGarantieSuretePersonnelle&&null!=e.garantieSuretePersonnelle.conventionCautionnement?e.garantieSuretePersonnelle.conventionCautionnement.idConvention:null},e}();n.GarantieApplicableBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function t(e,t,n,i,r,a,o,s,u,c){this.codeTypeSurete=e.codeTypeSurete,this.libelleDescription=e.libelleNatureGarantie+" - "+e.codeNatureGarantie,this.libelleLongNature=e.libelleLongNatureGarantie,this.codeNatureGarantie=e.codeNatureGarantie,this.acteAuthentiqueSurGarantie=e.codeActeAuthentiqNatureGarantie,this.codeValeurPacteCommissoire=e.codeUtilisationPacteCommissoire,this.classeGarantie=e.classeGarantie,this.codeUtilisationPacteCommissoire=e.codeUtilisationPacteCommissoire,this.codeHypothequeRechargeable=e.codeHypothequeRechargeable,this.listeConventionApplicable=this.getListeConventionGarantieApplicable(e.codeNatureGarantie,i,n,r,c),this.frais=this.getFraisGarantieApplicable(e.codeNatureGarantie,t),this.listeObjetNatureGarantie=this.getListeObjetNatureGarantie(e.codeNatureGarantie,a,o,s,u),this.listeTypeObjetCommercial=this.getListeTypeObjetCommercial(this.listeObjetNatureGarantie)}return t.prototype.getListeConventionGarantieApplicable=function(t,n,i,r,a){var o=_.filter(n||[],function(e){return e.codeNatureGarantie===t&&e.identifiantConvention!==a}),s=_.map(o,function(n){var i=_.filter(r,function(e){return n.identifiantConvention===e.identifiantConvention});return e.ConventionGarantieApplicableBuilder.getResult(t,n,i)});return this.getListeConventionGarantieApplicableForGarantiePersoExistante(t,i,r,a).concat(s)},t.prototype.getListeConventionGarantieApplicableForGarantiePersoExistante=function(t,n,i,r){if(null!=r){var a=_.find(n,function(e){return e.identifiantConvention===r});if(null!=a){var o=_.filter(i,function(e){return e.identifiantConvention===r}),s=e.ConventionGarantieApplicableBuilder.getResult(t,new e.ConventionApplicableCatalogueAdapater(a),o);return[s]}}return[]},t.prototype.getFraisGarantieApplicable=function(e,t){var n=_.find(t,function(t){return t.codeNatureGarantie===e});return null===n||void 0===n?null:{codeAccessoireObligatoire:n.codeAccessoireObligatoire,montantMinimumPlageAccessoire:n.montantMinimumPlageAccessoire,montantMaximumPlageAccessoire:n.montantMaximumPlageAccessoire,codeTypologieAccessoire:n.codeTypologieAccessoire,codeTypeAccessoire:n.codeTypeAccessoire,libelleTypeAccessoire:n.libelleTypeAccessoire,
dureeApplicationAccessoire:n.dureeApplicationAccessoire,uniteDureeApplicAccess:n.uniteDureeApplicAccess,noRegleApplicationAccessoire:n.noRegleApplicationAccessoire}},t.prototype.getListeObjetNatureGarantie=function(e,t,n,i,r){var a=this,o=_.filter(t,function(t){return t.codeNatureGarantie===e&&null!=t.typeObjetFinanceGaranti});return _.map(o,function(e){var t={typologieLObjet:e.typologieLObjet,typeObjetFinanceGaranti:e.typeObjetFinanceGaranti,listeTypeObjetCommercial:a.getListeObjetCommercial(e,n,i,r)};return t})},t.prototype.getListeObjetCommercial=function(t,n,i,r){var a=_.filter(n,function(e){return e.typeObjetFinanceGaranti===t.typeObjetFinanceGaranti}),o=_.map(a,function(n){return e.TypeObjetCommercialBuilder.getTocByGarantie(t,n,i,r)});return _.sortByOrder(o,function(e){return e.libelleLong},!0)},t.prototype.getListeTypeObjetCommercial=function(e){var t=_.reduce(_.map(e,function(e){return e.listeTypeObjetCommercial}),function(e,t){return _.union(e,t)},[]);return _.sortByOrder(t,function(e){return e.libelleLong},!0)},t}();e.GarantieApplicable=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.Garantie,i=e.Commun.Tools.List,r=e.Commun.Tools.Object,a=e.Commun.Tools.DateUtils,o=function(){function o(e,t,r,a,o,s,u,c,l,d){this._creditCurrent=s,this._devise=u,this._dateEffet=c,this.dataListeConvention=r.listeConventionApplicable,this.dataListeGarant=a,this.isAvenantPeriodicite=l,this.isPhaseEnCoursPeriodiciteScinde=d,null!=t?(this._conventionCautionnement=_.find(this.dataListeConvention,function(e){return e.idConvention===t.identifiantConvention}),this.setDataWithConventionCautionnement(this.conventionCautionnement),null!=this.conventionCautionnement&&this.setListeAccessoire(this.conventionCautionnement,o,c,s.numeroPhase,!1),this.garant=i.findOrEmpty(a,function(t){return t.identifiantPersonne===e.identifiantGarant}),this.finValidite=t.dureeValiditeGarantie,this.referenceExterne=t.numeroExterneGarantie,this.cautionnement=n.getCautionnementByCode(t.codeNatureCautionnement),this.quotite=e.pourcentageCreditCouvert,0===e.pourcentageCreditCouvert&&e.capitalCouvertGarantie>0&&(this._montantGarantie=e.capitalCouvertGarantie,this._showMontantGarantie=!0,this.quotite=100*e.capitalCouvertGarantie/s.montantActualiseCredit)):(this.conventionCautionnement=null,this.cautionnement=null,this.referenceExterne=null,this.garant=null,this.montantGarantie=null,this.listeAccessoire=[]),this.dureeEngagement=null,this.isCautionnementModifiable=!(null!=this.conventionCautionnement)}return Object.defineProperty(o.prototype,"showQuotite",{get:function(){return null!=this.conventionCautionnement?"Q"===this.conventionCautionnement.cdModeExpressionGarantieAccorde:null!=this.cautionnement},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isMontantModifiable",{get:function(){return this.showMontantGarantie?this.showQuotite&&null!=this.quotite&&this.quotite>0?!1:!this.conventionCautionnement||"Q"!==this.conventionCautionnement.cdModeExpressionGarantieAccorde:!1},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"showConvention",{get:function(){return(this.dataListeConvention||[]).length>0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isGarantModifiable",{get:function(){return 0===(this.dataListeConvention||[]).length},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"conventionCautionnement",{get:function(){return this._conventionCautionnement},set:function(e){(angular.isUndefined(e)||null===e||e!==this._conventionCautionnement)&&this.resetDataConvention(),null!=e&&e!==this._conventionCautionnement&&this.setDataWithNewConventionCautionnement(e),this._conventionCautionnement=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"cautionnement",{get:function(){return this._cautionnement},set:function(t){this._cautionnement=t,this.setQuotiteModifiable(this.conventionCautionnement,t),this.setShowMontantGarantie(this.conventionCautionnement,t),t===e.Commun.Enum.CautionnementGarantie.solidaire?this.quotite=null!=this.conventionCautionnement?this.conventionCautionnement.quotiteMaximumParBeneficiaire:100:(this.quotite=null,this.montantGarantie=null)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"quotite",{get:function(){return this._quotite},set:function(e){this._quotite=e,this.showMontantGarantie&&(this._montantGarantie=null!=e&&this.isQuotiteValid()?this.quotite*this._creditCurrent.montantActualiseCredit/100:null)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isQuotiteModifiable",{get:function(){return this.showQuotite?this._isQuotiteModifiable:!1},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"montantGarantie",{get:function(){return this._montantGarantie},set:function(e){this._montantGarantie=e,this.showQuotite&&this.isQuotiteModifiable&&(this.disabledQuotite=null!=this.montantGarantie)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"showMontantGarantie",{get:function(){return this._showMontantGarantie},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"libelleHelpMontantGarantie",{get:function(){return this._libelleHelpMontantGarantie},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"showLibelleHelpMontantGarantie",{get:function(){return this._showLibelleHelpMontantGarantie},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"libelleHelpQuotite",{get:function(){return this._libelleHelpQuotite},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"showLibelleHelpQuotite",{get:function(){return this._showLibelleHelpQuotite},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"infosLevel1Valid",{get:function(){return this.showConvention?null!=this.conventionCautionnement:!0},enumerable:!0,configurable:!0}),o.prototype.isQuotiteValid=function(){if(this.showQuotite&&!this.disabledQuotite){if(null!=this.conventionCautionnement)return null!=this.quotite&&this.quotite>=this.conventionCautionnement.quotiteMinimumParBeneficiaire&&this.quotite<=this.conventionCautionnement.quotiteMaximumParBeneficiaire&&r.isModuloRespected(this.quotite,this.conventionCautionnement.pasQuotiteParBeneficiaire);if(this.isQuotiteModifiable&&!this.isMontantModifiable)return null!=this.quotite&&this.quotite>0&&this.quotite<=100}return!0},o.prototype.isValid=function(){return null!=this.garant&&this.isQuotiteValid()},o.prototype.setCautionnementByBugCmposant=function(){null!=this.cautionnement&&(this._cautionnement=n.getCautionnementByCode(this.cautionnement.key))},o.prototype.getQuotite=function(t,n,i){return null!=i?i:n===e.Commun.Enum.CautionnementGarantie.solidaire?100:_.contains(["M","K"],t)?0:100},o.prototype.resetDataConvention=function(){this.cautionnement=null,this.referenceExterne=null,this.garant=null,this.isCautionnementModifiable=!0},o.prototype.setDataWithConventionCautionnement=function(e){this.setQuotiteModifiable(e,this.cautionnement),this.setShowMontantGarantie(e,this.cautionnement),null!=e&&(this.quotite=null!=e?this.getQuotite(e.cdModeExpressionGarantieAccorde,this.cautionnement):null,this.setHelpQuotite(e),this.setHelpMontantGarantie(e))},o.prototype.setDataWithNewConventionCautionnement=function(e){this.setDataWithConventionCautionnement(e),this.garant=_.find(this.dataListeGarant,function(t){return t.identifiantPersonne===e.idIntervenant}),this.cautionnement=n.getCautionnementByCode(e.codeNatureCautionnement),this.isCautionnementModifiable=!1,this.setListeAccessoire(e,[],this._dateEffet,this._creditCurrent.numeroPhase,!0)},o.prototype.setListeAccessoire=function(e,t,n,i,r){if(this.listeAccessoire=_.sortBy(this.getListeAccessoire(e.listeAccessoires,t,n,i,r),function(e){return e.numeroPhase}),this.isAvenantPeriodicite&&this.isPhaseEnCoursPeriodiciteScinde)for(var a=0,o=this.listeAccessoire;a<o.length;a++){var s=o[a];s.numeroPhase+=1,s.titreNumPhase="Phase "+s.numeroPhase}},o.prototype.getListeAccessoire=function(e,n,a,o,s){var u=this,c=this.getListeAccessoiresConventionActif(e,o,a),l=0;return _.map(c,function(e){var a=_.find(n||[],function(t){return r.isStringNotEmpty(e.codeTypePhase)?e.codeTypeAccessoire===t.codeTypeAccessoire&&e.numeroPhase===t.numeroPhase:e.codeTypeAccessoire===t.codeTypeAccessoire}),o=i.findOrEmpty(u._creditCurrent.phases,function(t){return t.numeroPhase===e.numeroPhase});return new t.AccessoireGarantie(l++,e,a,o.periodiciteCalculInterets,u._devise,s)})},o.prototype.getListeAccessoiresConventionActif=function(e,t,n){return _.filter(e||[],function(e){return a.isBefore(n,e.dateDebutApplication)||a.isAfter(n,e.dateFinApplication)?!1:!r.isStringNotEmpty(e.regleAppelAccessoireAperiodique)&&e.numeroPhase<t?!1:!0})},o.prototype.setQuotiteModifiable=function(e,t){this._isQuotiteModifiable=this.getIsQuotiteModifiable(e,t)},o.prototype.getIsQuotiteModifiable=function(e,t){return null!=t&&(!e||"Q"===e.cdModeExpressionGarantieAccorde)},o.prototype.setShowMontantGarantie=function(e,t){this._showMontantGarantie=null!=t},o.prototype.setHelpMontantGarantie=function(e){this._libelleHelpMontantGarantie="["+e.montantMinimumGarantiParTete+".."+e.montantMaximumGarantiParTete+"; "+e.pasMontantGarantiParTete+"]",this._showLibelleHelpMontantGarantie=this.isValueNumeriqueNotZero(e.montantMinimumGarantiParTete)||this.isValueNumeriqueNotZero(e.montantMaximumGarantiParTete)||this.isValueNumeriqueNotZero(e.pasMontantGarantiParTete)},o.prototype.setHelpQuotite=function(e){this._libelleHelpQuotite="["+e.quotiteMinimumParBeneficiaire+".."+e.quotiteMaximumParBeneficiaire+"; "+e.pasQuotiteParBeneficiaire+"]",this._showLibelleHelpQuotite=this.isValueNumeriqueNotZero(e.quotiteMinimumParBeneficiaire)||this.isValueNumeriqueNotZero(e.quotiteMinimumParBeneficiaire)||this.isValueNumeriqueNotZero(e.quotiteMinimumParBeneficiaire)},o.prototype.isValueNumeriqueNotZero=function(e){return null!=e&&0!==e},o}();t.GarantieSuretePersonnelle=o}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.ToolsFunctionals.Garantie,i=e.Commun.Tools.DateUtils,r=e.Commun.Tools.List,a="O09",o="DE",s=function(){function s(i,a,o,s,u,c,l,d,m,h,p,f,A,P){this._garantieSureteReelle=o,this._descriptionObjetFinance=s,this._listeTypologiesInstruction=l,this._listeVersementAttendusGarantie=A,this._isVersementsAttendusToAjoutable=P,this._dateTraitement=h,this._isCreationInit=p===e.Commun.Enum.CodeTypeAcces.Creation,this.dataListeObjetCommercial=i.listeTypeObjetCommercial,this.dataListemodalitesEstimationVenale=this.getListeModaliteEstimation("V",u,l,c),this.dataListemodalitesEstimationPrudentielle=this.getListeModaliteEstimation("P",u,l,c);var v=null!=o&&null!=d&&d.typeObjetFinanGaranti===o.typeObjetFinanceGaranti;this.disabledRbObjetCommercialFinancement=this.getDisabledRbObjetCommercialFinancement(this.dataListeObjetCommercial,d),this.showRbObjetCommercialSans=!_.contains(["1","2","3","5","B","R"],i.classeGarantie)&&"R"!==i.codeTypeSurete,this.objetCommercialFinancement=d,this._definitionObjetGarantieForFinancement=null!=s?new t.DefinitionObjetGarantie(o,s,l,d,this._isVersementsAttendusToAjoutable,this._listeVersementAttendusGarantie,!0):null,this._objetPorteGarantie=this.getObjetPorteGarantie(p,o,v,this.disabledRbObjetCommercialFinancement,this.showRbObjetCommercialSans),this._objetCommercialAutre=this.getObjetCommercialAutre(this.objetPorteGarantie,this.dataListeObjetCommercial,o),this.setDataEstimation(this._objetPorteGarantie,!0,this._isCreationInit,o,s),this.definitionObjetGarantie=this.getDefinitionObjetGarantie(this.objetPorteGarantie,o,s,l,this.objetCommercialAutre),this.isCommentaireRequired="A"===i.codeTypeSurete,this.showRangInscriptionHypotheque=_.contains(["1","2","3","5","B","R"],i.classeGarantie),this.isRangInscriptionHypothequeModifiable="18"!==i.codeNatureGarantie,this.showPacteCommissoire="1"===i.classeGarantie,this.isPacteCommissoireModifiable=this.getIsPacteCommissoireModifiable(i),this.showDureeInscriptionHypothecaire="1"===i.classeGarantie&&null!=i.codeHypothequeRechargeable,this.dataPassePlat=this.getDataPassePlat(o),null!=o?(this.commentaire=o.commentaireGarantie,this.pacteCommissoire=this.getPacteComissoireSelected(o.codeValeurPacteCommissoire),this._rangInscriptionHypotheque=o.rangHypotheque,this.setDataListeCessionRang(this.rangInscriptionHypotheque),this.showMontantHypothequeRangAnterieur=this._rangInscriptionHypotheque>1,this.montantHypothequeRangAnterieur=this.showMontantHypothequeRangAnterieur?o.mtHypothequeRangAnterieur:null,this.cessionRang=n.getCessionRangByCode(o.codeCessionRangHypotheque),this.montantGarantie=this.getMontantGarantie(a.capitalCouvertGarantie,a.pourcentageCreditCouvert,f),this.dureeInscriptionHypothecaire=o.dureeValiditeGarantie,this.garant=null!=a.identifiantGarant?r.findOrEmpty(m,function(e){return e.identifiantPersonne===a.identifiantGarant}):null):(this.commentaire=null,this.pacteCommissoire=this.getPacteComissoireSelected(i.codeValeurPacteCommissoire),this.rangInscriptionHypotheque=this.showRangInscriptionHypotheque?1:null,this.dureeInscriptionHypothecaire=null)}return Object.defineProperty(s.prototype,"objetPorteGarantie",{get:function(){return this._objetPorteGarantie},set:function(e){1!==e&&(this.objetCommercialAutre=null),this._objetPorteGarantie=e,this.definitionObjetGarantie=0===e?this._definitionObjetGarantieForFinancement:null,this.setDataEstimation(e,!1,this._isCreationInit,this._garantieSureteReelle,this._descriptionObjetFinance)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"objetCommercialAutre",{get:function(){return this._objetCommercialAutre},set:function(e){(angular.isUndefined(e)||null===e)&&(this.definitionObjetGarantie=null),null!=e&&e!==this._objetCommercialAutre&&(this.definitionObjetGarantie=new t.DefinitionObjetGarantie(null,this._descriptionObjetFinance,this._listeTypologiesInstruction,e,this._isVersementsAttendusToAjoutable,this._listeVersementAttendusGarantie,!1)),this._objetCommercialAutre=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"rangInscriptionHypotheque",{get:function(){return this._rangInscriptionHypotheque},set:function(e){(angular.isUndefined(e)||null===e||e!==this._rangInscriptionHypotheque)&&(this.showMontantHypothequeRangAnterieur=!1,this.showCessionRang=!1),null!=e&&e!==this._rangInscriptionHypotheque&&(e>1?this.showMontantHypothequeRangAnterieur=!0:this.montantHypothequeRangAnterieur=null,this.setDataCessionRangWithNewRangInscription(e)),this._rangInscriptionHypotheque=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"showGarant",{get:function(){return 0!==this.objetPorteGarantie},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"showListeObjetCommercialAutre",{get:function(){return 1===this.objetPorteGarantie},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dataListeCessionRang",{get:function(){return this._dataListeCessionRang},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"showEstimationObjet",{get:function(){return 2!==this.objetPorteGarantie},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"disabledEstimationObjet",{get:function(){return 1===this.objetPorteGarantie?null===this.objetCommercialAutre:!1},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"modalitesEstimationVenale",{get:function(){return this._modalitesEstimationVenale},set:function(e){e!==this._modalitesEstimationVenale&&(this.motifEstimationVenale=null!=e&&1===e.listeMotifEstimation.length?_.first(e.listeMotifEstimation):null),this._modalitesEstimationVenale=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"modalitesEstimationPrudentielle",{get:function(){return this._modalitesEstimationPrudentielle},set:function(e){(angular.isUndefined(e)||null===e||null!=e&&e!==this._modalitesEstimationPrudentielle)&&(this.motifEstimationPrudentielle=null),this._modalitesEstimationPrudentielle=e},enumerable:!0,configurable:!0}),s.prototype.isValid=function(){return null!=this.definitionObjetGarantie?this.isValidNumeroCompte()&&this.isValidAdresse():!0},s.prototype.isValidNumeroCompte=function(){return this.definitionObjetGarantie.showReferenceDeuxCompte?this.definitionObjetGarantie.numeroCompte.isComplete()&&this.definitionObjetGarantie.numeroCompte.$valid:!0},s.prototype.isValidAdresse=function(){return null!=this.definitionObjetGarantie.dataAdresseComposant?this.definitionObjetGarantie.dataAdresseComposant.$valid:!0},s.prototype.setDataByObjet=function(e,n,i){this.dateEstimationVenale=e.dateEstimationBien,this.modalitesEstimationVenale=null!=e.modeEstimationBien?this.getModalitesEstimation(this.dataListemodalitesEstimationVenale,e.modeEstimationBien.codeTypologie):null,this.objetCommercialFinancement=n,this.disabledRbObjetCommercialFinancement=this.getDisabledRbObjetCommercialFinancement(this.dataListeObjetCommercial,n),this._objetPorteGarantie=this.getObjetPorteGarantieByMajObjet(0===this.objetPorteGarantie,this.disabledRbObjetCommercialFinancement,this.showRbObjetCommercialSans),this._descriptionObjetFinance=i,null!=this._definitionObjetGarantieForFinancement&&(this._definitionObjetGarantieForFinancement=new t.DefinitionObjetGarantie(null,i,this._listeTypologiesInstruction,n,this._isVersementsAttendusToAjoutable,this._listeVersementAttendusGarantie,!0),0===this.objetPorteGarantie&&(this.definitionObjetGarantie=this._definitionObjetGarantieForFinancement)),null!=this.definitionObjetGarantie&&this.definitionObjetGarantie.identifiantObjetInitial===e.identifiantObjetInitial&&this.definitionObjetGarantie.setDataByObjet(e)},s.prototype.setDataCessionRangWithNewRangInscription=function(e){this.setDataListeCessionRang(e),this.cessionRang=_.first(this._dataListeCessionRang)},s.prototype.setDataListeCessionRang=function(e){this._dataListeCessionRang=this.getListeCessionRang(e),this.showCessionRang=e>0},s.prototype.getListeCessionRang=function(t){return null!=t&&t>0?1===t?e.Commun.Enum.CessionRangGarantie.list():[e.Commun.Enum.CessionRangGarantie.pasCessionRang,e.Commun.Enum.CessionRangGarantie.cessionRang]:this._dataListeCessionRang},s.prototype.getIsPacteCommissoireModifiable=function(e){return"1"===e.classeGarantie&&null!=e.codeHypothequeRechargeable&&_.contains(["P","Q",null],e.codeUtilisationPacteCommissoire)},s.prototype.getPacteComissoireSelected=function(e){return _.contains(["C","O"],e)},s.prototype.getDisabledRbObjetCommercialFinancement=function(e,t){return _.some(e,function(e){return e.typeObjetFinanGaranti===t.typeObjetFinanGaranti})?!1:!0},s.prototype.getObjetPorteGarantie=function(t,n,i,r,a){return i||null===n&&t===e.Commun.Enum.CodeTypeAcces.Creation&&!r?0:null!=n&&null!=n.typeObjetFinanceGaranti?1:a?2:1},s.prototype.getObjetPorteGarantieByMajObjet=function(e,t,n){return e&&!t?0:n?2:1},s.prototype.getMontantGarantie=function(e,t,n){return 0!==e?e:t*n/100},s.prototype.getListeModaliteEstimation=function(e,n,i,r){var a=_.filter(i,function(e){return"06"===e.typeTypologie}),o=_.groupBy(_.filter(n,function(t){return t.typeEstimation===e}),function(e){return e.codeModaliteLEstimation}),s=_.map(o,function(e){return t.ModalitesEstimationGarantieBuilder.getResult(e,a,r)});return _.sortBy(s,function(e){return e.libelleLong})},s.prototype.getModalitesEstimation=function(e,t){var n=_.find(e,function(e){return e.code===t});return null!=n?n:null},s.prototype.getMotifEstimation=function(e,t){var n=_.find(e,function(e){return e.code===t});return null!=n?n:null},s.prototype.getObjetCommercialAutre=function(e,t,n){return 1===e&&null!=n?_.find(t,function(e){return e.typeObjetFinanGaranti===n.typeObjetFinanceGaranti}):null},s.prototype.getDefinitionObjetGarantie=function(e,n,i,r,a){return 0===e?this._definitionObjetGarantieForFinancement:1===e&&null!=a?new t.DefinitionObjetGarantie(n,i,r,a,this._isVersementsAttendusToAjoutable,this._listeVersementAttendusGarantie,!1):null},s.prototype.getDataPassePlat=function(e){return null!=e?{descriptionLObjet7:e.descriptionLObjet7,identifiantGarantie1:e.identifiantGarantie1,libelleLongVilleConservHypo:e.libelleLongVilleConservatHypo,datePublication:e.datePublication,libelleLongReferenceVolume:e.libelleLongReferenceVolume,numeroVolume:e.numeroVolume,mtHypothequeDisponible:e.mtHypothequeDisponible,dateMontantHypoDisponible:e.dateMontantHypoDisponible,codeGarantieRechargeableExterne:e.codeGarantieRechargeableExterne,codePresenceServiceObjet:e.codePresenceServiceObjet,codeDevise:e.codeDevise,codeDeviseGarantie:e.codeDeviseGarantie,typologieLObjet:e.typologieLObjet}:{descriptionLObjet7:null,identifiantGarantie1:null,libelleLongVilleConservHypo:null,datePublication:null,libelleLongReferenceVolume:null,numeroVolume:null,mtHypothequeDisponible:null,dateMontantHypoDisponible:null,codeGarantieRechargeableExterne:null,codePresenceServiceObjet:null,codeDevise:null,codeDeviseGarantie:null,typologieLObjet:null}},s.prototype.setDataEstimation=function(e,t,n,r,s){t&&null!=r?(this.montantEstimationVenale=r.montantValeurObjet,this.dateEstimationVenale=i.parse(r.dateEstimationValeurObjet),this.modalitesEstimationVenale=this.getModalitesEstimation(this.dataListemodalitesEstimationVenale,n?o:r.codeModaliteLEstimation),this.motifEstimationVenale=this.getMotifEstimation((this.modalitesEstimationVenale||{}).listeMotifEstimation||[],n?a:r.codeMotifReEstimation),this.montantEstimationPrudentielle=r.montantValeurObjetPrud,this.dateEstimationPrudentielle=i.parse(r.dateEstimValeurObjetPrud),this.modalitesEstimationPrudentielle=this.getModalitesEstimation(this.dataListemodalitesEstimationPrudentielle,n?o:r.codeModaliteLEstimationPrud),this.motifEstimationPrudentielle=this.getMotifEstimation((this.modalitesEstimationPrudentielle||{}).listeMotifEstimation,n?a:r.codeMotifReEstimationPrud)):0===e&&null!=s?(this.montantEstimationVenale=s.montantValeurObjet,this.dateEstimationVenale=i.parse(s.dateEstimationValeurObjet),this.modalitesEstimationVenale=this.getModalitesEstimation(this.dataListemodalitesEstimationVenale,n?o:s.codeModaliteLEstimation),this.motifEstimationVenale=this.getMotifEstimation((this.modalitesEstimationVenale||{}).listeMotifEstimation||[],n?a:s.codeMotifReEstimation),null!=s.montantValeurObjetPrud&&s.montantValeurObjetPrud>0&&i.isValued(s.dateEstimValeurObjetPrud)?(this.montantEstimationPrudentielle=s.montantValeurObjetPrud,this.dateEstimationPrudentielle=i.parse(s.dateEstimValeurObjetPrud),this.modalitesEstimationPrudentielle=this.getModalitesEstimation(this.dataListemodalitesEstimationPrudentielle,n?o:s.codeModaliteLEstimationPrud),this.motifEstimationPrudentielle=this.getMotifEstimation((this.modalitesEstimationPrudentielle||{}).listeMotifEstimation,n?a:s.codeMotifReEstimationPrud)):(this.montantEstimationPrudentielle=null,this.dateEstimationPrudentielle=null,this.modalitesEstimationPrudentielle=null,this.motifEstimationPrudentielle=null)):2===e?(this.montantEstimationVenale=null,this.dateEstimationVenale=null,this.modalitesEstimationVenale=null,this.motifEstimationVenale=null,this.montantEstimationPrudentielle=null,this.dateEstimationPrudentielle=null,this.modalitesEstimationPrudentielle=null,this.motifEstimationPrudentielle=null):(this.montantEstimationVenale=null,this.dateEstimationVenale=this._dateTraitement,this.modalitesEstimationVenale=this.getModalitesEstimation(this.dataListemodalitesEstimationVenale,o),this.motifEstimationVenale=this.getMotifEstimation((this.modalitesEstimationVenale||{}).listeMotifEstimation||[],a),this.montantEstimationPrudentielle=null,this.dateEstimationPrudentielle=null,this.modalitesEstimationPrudentielle=null,this.motifEstimationPrudentielle=null)},s}();t.GarantieSureteReelle=s}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict"}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.List,i=function(){function e(){}return e.getResult=function(e,t,i){var r=n.findOrEmpty(t,function(t){return t.codeTypologie===n.firstOrEmpty(e).codeModaliteLEstimation});return{type:r.typeTypologie,code:r.codeTypologie,libelleLong:r.intitule,listeMotifEstimation:this.getListeMotifEstimation(e,i)}},e.getListeMotifEstimation=function(e,t){var i=this,r=_.map(e,function(e){return i.getMotifEstimation(n.findOrEmpty(t,function(t){return t.codeMotifReEstimation===e.codeMotifReEstimation}))});return _.sortBy(r,function(e){return e.libelleLong})},e.getMotifEstimation=function(e){return{code:e.codeMotifReEstimation,libelleLong:e.libelleLongMotif}},e}();t.ModalitesEstimationGarantieBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(n){"use strict";var i=e.Commun.Tools.List,r=function(){function n(){}return n.getListeGarantieExistante=function(t,n,r,a){var o=this.getListeGarantieExistanteForAvenantGaranties(t,n,r);if(n.isAvenantObjet&&n.isAvenantGarantie){var s=i.firstOrEmpty(n.dataRestAvenant.dataGaranties.descriptionObjetFinance);if(n.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Creation&&!_.isEmpty(s))for(var u=0,c=a;u<c.length;u++){var l=c[u];if(""!==l.identifiantObjet&&"A"!==l.identifiantObjet&&l.identifiantObjet===s.identifiantObjet)for(var d=0,m=o;d<m.length;d++){var h=m[d];l.identifiantGarantie!==h.identifiantGarantie||""!==h.codeTypeAcces&&null!=h.codeTypeAcces||(h.codeTypeAcces="M")}}}return o},n.getListeGarantieExistanteForAvenantGaranties=function(e,t,n){var i=this;return t.isAvenantGarantie||t.isAvenantPeriodicite||t.isAvenantAte?_.map(t.listeGarantiesStock||[],function(n){return i.getGarantieExistante(e,n,t.isAvenantAte)}):_.map(n||[],function(t){return i.getGarantieExistanteDefault(e,t)})},n.getGarantieExistanteDefault=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantGarantie:t.identifiantGarantie,codeNatureGarantie:t.codeNatureGarantie,acteAuthentiqueSurGarantie:t.acteAuthentiqueSurGarantie,redacteurActe:t.redacteurActe,libelleTiers:t.libelleTiers,identifiantGarant:t.identifiantGarant,capitalCouvertGarantie:t.capitalCouvertGarantie,pourcentageCreditCouvert:t.pourcentageCreditCouvert,codeTypeSurete:t.codeTypeSurete,codeTypeAcces:t.codeTypeAcces,dateEnvoiDossierGarantie:t.dateEnvoiDossierGarantie,classeGarantie:t.classeGarantie,codeHypothequeRechargeable:t.codeHypothequeRechargeable,codeAncienneteAssuranceGarantie:t.codeAncienneteAssuranceGarantie,elementCalculGaranties:t.elementCalculGaranties}},n.getGarantieExistante=function(e,t,n){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantGarantie:t.idGarantie,codeNatureGarantie:t.garantieAppliquee.codeNatureGarantie,acteAuthentiqueSurGarantie:1===t.formeContratGarantie?"O":"N",redacteurActe:this.withRedacteurActe(t)?t.redacteurActe.idPersonne:null,libelleTiers:this.withRedacteurActe(t)?t.redacteurActe.libelleTiers:null,identifiantGarant:this.getIdGarant(t),capitalCouvertGarantie:this.getCapitalCouvertGarantie(t),pourcentageCreditCouvert:this.getPourcentageCreditCouvert(t),codeTypeSurete:t.garantieAppliquee.codeTypeSurete,codeTypeAcces:this.getCodeTypeAcces(t.etatManipulation,n&&this.isGarantieModifieParAte(t)?"M":t.codeTypeAcces),dateEnvoiDossierGarantie:null,classeGarantie:t.garantieAppliquee.classeGarantie,codeHypothequeRechargeable:t.garantieAppliquee.codeHypothequeRechargeable,codeAncienneteAssuranceGarantie:t.codeAncienneteAssuranceGarantie,elementCalculGaranties:this.getListeCompleteElementCalculGarantie(e,t,n)}},n.isGarantieModifieParAte=function(e){return _.some(e.listeAccessoire,function(e){return e.numeroPhase>0})},n.withRedacteurActe=function(e){return 1===e.formeContratGarantie&&null!=e.redacteurActe},n.getCapitalCouvertGarantie=function(e){return e.isGarantieSureteReelleAutre?e.garantieSureteReelleAutre.montantGarantie:e.isGarantieSuretePersonnelle&&e.garantieSuretePersonnelle.showMontantGarantie&&e.garantieSuretePersonnelle.isMontantModifiable?e.garantieSuretePersonnelle.montantGarantie:0},n.getPourcentageCreditCouvert=function(e){return e.isGarantieSureteReelleAutre?0:e.isGarantieSuretePersonnelle&&e.garantieSuretePersonnelle.showQuotite&&!e.garantieSuretePersonnelle.disabledQuotite&&null!=e.garantieSuretePersonnelle.garant?e.garantieSuretePersonnelle.quotite:null},n.getIdGarant=function(e){return e.etatManipulation===t.Enum.EtatManipulation.ToDelete?null:e.isGarantieSuretePersonnelle&&null!=e.garantieSuretePersonnelle.garant?e.garantieSuretePersonnelle.garant.identifiantPersonne:e.isGarantieSureteReelleAutre&&null!=e.garantieSureteReelleAutre.garant?e.garantieSureteReelleAutre.garant.identifiantPersonne:null},n.getCodeTypeAcces=function(n,i){switch(n){case t.Enum.EtatManipulation.IsCreation:return e.Commun.Enum.CodeTypeAcces.Creation.toString();case t.Enum.EtatManipulation.IsModified:return e.Commun.Enum.CodeTypeAcces.Modification.toString();case t.Enum.EtatManipulation.ToDelete:return e.Commun.Enum.CodeTypeAcces.Annulation.toString();default:return i}},n.getListeCompleteElementCalculGarantie=function(e,t,n){var i=this.getListeElementCalculGarantie(e,t,n);return t.showMontantFrais?[this.getElementCalculGarantieByFrais(e,t)].concat(i):i},n.getListeElementCalculGarantie=function(e,t,n){var i=this;return t.isGarantieSuretePersonnelle?_.map(_.filter(t.garantieSuretePersonnelle.listeAccessoire,function(e){return n||i.getToInjectAccessorieInFlux(e,t.etatManipulation)}),function(n){return i.getElementCalculGarantie(e,n,t.idGarantie,t.etatManipulation)}):[]},n.getToInjectAccessorieInFlux=function(n,i){return n.detailAccessoire.elementUn.modeCalculExhaustif===e.Commun.Enum.ModeCalculExhaustif.MontantFixe||n.detailAccessoire.elementUn.modeCalculExhaustif===e.Commun.Enum.ModeCalculExhaustif.TauxFixeAssiette?!1:n.isElementCalculPresentInFlux||i!==t.Enum.EtatManipulation.ToDelete&&n.etatManipulationAccessoire!==t.Enum.EtatManipulation.Unchanged?!0:!1},n.getElementCalculGarantieByFrais=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantGarantie:t.idGarantie,numeroPhase:null,numeroRelatif1:null,codeTypeAccessoire:t.garantieAppliquee.frais.codeTypeAccessoire,libelleTypeAccessoire:t.garantieAppliquee.frais.libelleTypeAccessoire,dureeApplicationElement:t.garantieAppliquee.frais.dureeApplicationAccessoire,periodiciteApplicationElement:null,numeroRegleApplicationElement:null,montantElement:t.montantFrais,codeTypeAssietteCalculElement:null,mtPlafondTrancheCalculAccess:null,tauxElement:null,mtPlafondTrancheCalculAccess1:null,tauxElement1:null,mtPlafondTrancheCalculAccess2:null,tauxElement2:null,mtPlafondTrancheCalculAccess3:null,tauxElement3:null,mtPlafondTrancheCalculAccess4:null,tauxElement4:null,codeActionEcranListe:this.getCodeActionEcranListe(t.etatManipulation),codeModeCalculAccessoire:null,regleAppelAccessoireAperiodique:null,
dateAppelAccessoire:null,codeTypologieAccessoire:t.garantieAppliquee.frais.codeTypologieAccessoire,uniteDureeApplicElement:null,modeComptaRecouvraccessoire:null,montantAccessoireAEtaler:null,indicAccessoireCreeParAvenant:null,codeTypeApplicationAccessoire:null,nbJoursAnneeNumerateur:null,nbJoursAnneeDenominateur:null}},n.getElementCalculGarantie=function(e,t,n,i){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantGarantie:n,numeroPhase:t.numeroPhase,numeroRelatif1:t.numeroRelatif,codeTypeAccessoire:t.accessoireParConvention.codeTypeAccessoire,libelleTypeAccessoire:t.libelleTypeAccessoire,dureeApplicationElement:t.accessoireParConvention.dureeApplicationAccess,periodiciteApplicationElement:t.periodiciteApplicationElement,numeroRegleApplicationElement:t.numeroRegleApplicationElement,montantElement:null!=t.detailAccessoire.elementUn?t.detailAccessoire.elementUn.montant:0,codeTypeAssietteCalculElement:t.codeTypeAssietteCalculElement,mtPlafondTrancheCalculAccess:t.detailAccessoire.elementUn.montantPlafond,tauxElement:null!=t.detailAccessoire.elementUn?t.detailAccessoire.elementUn.taux:0,mtPlafondTrancheCalculAccess1:null!=t.detailAccessoire.elementDeux?t.detailAccessoire.elementDeux.montantPlafond:0,tauxElement1:null!=t.detailAccessoire.elementDeux?t.detailAccessoire.elementDeux.taux:0,mtPlafondTrancheCalculAccess2:null!=t.detailAccessoire.elementTrois?t.detailAccessoire.elementTrois.montantPlafond:0,tauxElement2:null!=t.detailAccessoire.elementTrois?t.detailAccessoire.elementTrois.taux:0,mtPlafondTrancheCalculAccess3:null!=t.detailAccessoire.elementQuatre?t.detailAccessoire.elementQuatre.montantPlafond:0,tauxElement3:null!=t.detailAccessoire.elementQuatre?t.detailAccessoire.elementQuatre.taux:0,mtPlafondTrancheCalculAccess4:null!=t.detailAccessoire.elementCinq?t.detailAccessoire.elementCinq.montantPlafond:0,tauxElement4:null!=t.detailAccessoire.elementCinq?t.detailAccessoire.elementCinq.taux:0,codeActionEcranListe:this.getCodeActionEcranListeForAccessoire(i,t),codeModeCalculAccessoire:t.accessoireParConvention.codeModeCalculAccessoire,regleAppelAccessoireAperiodique:t.regleAppelAccessoireAperiodique,dateAppelAccessoire:null,codeTypologieAccessoire:t.codeTypologieAccessoire,uniteDureeApplicElement:t.accessoireParConvention.uniteDureeApplicAccess,modeComptaRecouvraccessoire:t.modeComptaRecouvraccessoire,montantAccessoireAEtaler:0,indicAccessoireCreeParAvenant:t.indicAccessoireCreeParAvenant,codeTypeApplicationAccessoire:t.accessoireParConvention.codeTypeApplicationAccessoire,nbJoursAnneeNumerateur:t.accessoireParConvention.nbJoursAnneeNumerateur,nbJoursAnneeDenominateur:t.accessoireParConvention.nbJoursAnneeDenominateur}},n.getCodeActionEcranListeForAccessoire=function(e,n){return e===t.Enum.EtatManipulation.ToDelete?"A":n.isElementCalculPresentInFlux?this.getCodeActionEcranListe(n.etatManipulationAccessoire):"C"},n.getCodeActionEcranListe=function(e){switch(e){case t.Enum.EtatManipulation.IsCreation:return"C";case t.Enum.EtatManipulation.IsModified:return"M";case t.Enum.EtatManipulation.ToDelete:return"A";default:return""}},n}();n.CaracteristiqueFinanGarantieExistanteBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e.getListeGarantieSuretePerso=function(e,t,n){var i=this;return t.isAvenantGarantie||t.isAvenantPeriodicite?_.map(_.filter(t.listeGarantiesStock||[],function(e){return e.isGarantieSuretePersonnelle}),function(t){return i.getGarantieSuretePerso(e,t)}):_.map(n||[],function(t){return i.getGarantieSuretePersoDefault(e,t)})},e.getGarantieSuretePersoDefault=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantGarantie:t.identifiantGarantie,identifiantConvention:t.identifiantConvention,dureeValiditeGarantie:t.dureeValiditeGarantie,codeNatureCautionnement:t.codeNatureCautionnement,numeroExterneGarantie:t.numeroExterneGarantie}},e.getGarantieSuretePerso=function(e,t){var n=t.garantieSuretePersonnelle;return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantGarantie:t.idGarantie,identifiantConvention:null!=n.conventionCautionnement?n.conventionCautionnement.idConvention:null,dureeValiditeGarantie:n.finValidite,codeNatureCautionnement:null!=n.cautionnement?n.cautionnement.key:null,numeroExterneGarantie:n.referenceExterne}},e}();e.CaracteristiqueFinanGarantieSuretePersoBuilder=t}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=e.Commun.Tools.List,r=e.Commun.Tools.Object,a=function(){function t(){}return t.getListeGarantieSureteReelle=function(t,n,a){var o=this.getListeGarantieSureteReelleForAvenantGaranties(t,n,a);if(n.isAvenantObjet&&!n.isAvenantGarantie){for(var s=0,u=o;s<u.length;s++){var c=u[s];r.isStringNotEmpty(c.identifiantObjet)&&c.identifiantObjet&&n.infoObjet.identifiantObjetInitial&&(c.typeObjetFinanceGaranti=n.infoObjet.projetFinance.typeObjetFinanGaranti,c.typeObjetReglemente=n.infoObjet.precisionReglementaire.type)}if(n.codeTypeAcces===e.Commun.Enum.CodeTypeAcces.Creation&&null!=n.dataRestAvenant.dataGaranties){var l=i.firstOrEmpty(n.dataRestAvenant.dataGaranties.descriptionObjetFinance);if(!_.isEmpty(l))for(var d=0,m=o;d<m.length;d++){var c=m[d];r.isStringNotEmpty(c.identifiantObjet)&&"A"!==c.identifiantObjet&&c.identifiantObjet===l.identifiantObjet&&(c.identifiantObjet="9999999")}}}return o},t.getListeGarantieSureteReelleForAvenantGaranties=function(e,t,n){var i=this;return t.isAvenantGarantie||t.isAvenantPeriodicite?_.map(_.filter(t.listeGarantiesStock||[],function(e){return e.isGarantieSureteReelleAutre}),function(t){return i.getGarantieSureteReelle(e,t)}):_.map(n||[],function(t){return i.getGarantieSureteReelleDefault(e,t)})},t.getGarantieSureteReelleDefault=function(e,t){return{codeEtablissement:e.codeEtablissement,identifiantCredit:e.idCredit,numeroRelatif:e.numeroRelatif,numeroRelatifSimulationAvenant:e.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:e.codeRoleCreditAvenant,identifiantGarantie:t.identifiantGarantie,commentaireGarantie:t.commentaireGarantie,identifiantObjet:t.identifiantObjet,rangHypotheque:t.rangHypotheque,mtCouvertHypothequeRangAnte:t.mtCouvertHypothequeRangAnte,montantValeurObjet:t.montantValeurObjet,dateEstimationValeurObjet:t.dateEstimationValeurObjet,typeObjetFinanceGaranti:t.typeObjetFinanceGaranti,typeObjetReglemente:t.typeObjetReglemente,descriptionLObjet:t.descriptionLObjet,adresseLigne1:t.adresseLigne1,adresseLigneSuite6:t.adresseLigneSuite6,adresseLigne2:t.adresseLigne2,adresseLigne3:t.adresseLigne3,adresseLigneCodePostal4:t.adresseLigneCodePostal4,adresseLigneCommune5:t.adresseLigneCommune5,codePaysLocalisation:t.codePaysLocalisation,referenceExterneObjet:t.referenceExterneObjet,referenceTypeLot:t.referenceTypeLot,detailLOperationImmobiliere:t.detailLOperationImmobiliere,codeTypeLogement:t.codeTypeLogement,codeDestinationAutoriseeObjet:t.codeDestinationAutoriseeObjet,surfaceHabitableEnM2:t.surfaceHabitableEnM2,surfaceTerrainEnM2:t.surfaceTerrainEnM2,dateFinConstructionObjet:t.dateFinConstructionObjet,codeZoneImplantationSituation:t.codeZoneImplantationSituation,codeQualiteLEmplacement:t.codeQualiteLEmplacement,descriptionLObjet1:t.descriptionLObjet1,descriptionLObjet2:t.descriptionLObjet2,descriptionLObjet3:t.descriptionLObjet3,descriptionLObjet4:t.descriptionLObjet4,descriptionLObjet5:t.descriptionLObjet5,descriptionLObjet6:t.descriptionLObjet6,descriptionLObjet7:t.descriptionLObjet7,codeVersementAttendu:t.codeVersementAttendu,dateDegrevement:t.dateDegrevement,codeModaliteLEstimation:t.codeModaliteLEstimation,codeModaliteLEstimationPrud:t.codeModaliteLEstimationPrud,codeMotifReEstimation:t.codeMotifReEstimation,codeMotifReEstimationPrudentiel:t.codeMotifReEstimationPrudentiel,dateEstimValeurObjPrudentielle:t.dateEstimValeurObjPrudentielle,montantValeurObjetPru:t.montantValeurObjetPru,codeCessionRangHypotheque:t.codeCessionRangHypotheque,identifiantGarantie1:t.identifiantGarantie1,dureeValiditeGarantie:t.dureeValiditeGarantie,codeValeurPacteCommissoire:t.codeValeurPacteCommissoire,numSecondrangLHypotheque:t.numSecondrangLHypotheque,libelleLongVilleConservHypo:t.libelleLongVilleConservHypo,datePublication:t.datePublication,libelleLongReferenceVolume:t.libelleLongReferenceVolume,numeroVolume:t.numeroVolume,mtHypothequeDisponible:t.mtHypothequeDisponible,dateMontantHypoDisponible:t.dateMontantHypoDisponible,codeGarantieRechargeableExterne:t.codeGarantieRechargeableExterne,codePresenceServiceObjet:t.codePresenceServiceObjet,codeDevise:t.codeDevise,codeDeviseGarantie:t.codeDeviseGarantie,typologieLObjet:t.typologieLObjet}},t.getGarantieSureteReelle=function(t,i){var r=i.garantieSureteReelleAutre,a=i.garantieSureteReelleAutre.definitionObjetGarantie||{},o=a.dataAdresse||{};return{codeEtablissement:t.codeEtablissement,identifiantCredit:t.idCredit,numeroRelatif:t.numeroRelatif,numeroRelatifSimulationAvenant:t.numeroRelatifSimulationAvenant,codeRoleCreditAvenant:t.codeRoleCreditAvenant,identifiantGarantie:i.idGarantie,commentaireGarantie:r.commentaire,identifiantObjet:a.identifiantObjet,rangHypotheque:r.rangInscriptionHypotheque,mtCouvertHypothequeRangAnte:r.montantHypothequeRangAnterieur,montantValeurObjet:r.montantEstimationVenale,dateEstimationValeurObjet:n.format(r.dateEstimationVenale,e.Commun.Constantes.Format.DATE_REST),typeObjetFinanceGaranti:this.getTypeObjetFinanceGaranti(r),typeObjetReglemente:null!=a.typeObjetReglemente?a.typeObjetReglemente.type:null,descriptionLObjet:a.description,adresseLigne1:o.adresseLigne1,adresseLigneSuite6:o.adresseLigneSuite6,adresseLigne2:o.adresseLigne2,adresseLigne3:o.adresseLigne3,adresseLigneCodePostal4:o.adresseLigneCodePostal4,adresseLigneCommune5:o.adresseLigneCommune5,codePaysLocalisation:o.codePaysLocalisation,referenceExterneObjet:this.getReferenceExterneObjet(a),referenceTypeLot:this.getReferenceReferenceTypeLot(a),detailLOperationImmobiliere:null!=a.typeBien?a.typeBien.code[1]:null,codeTypeLogement:null!=a.typeLogement?a.typeLogement.key:null,codeDestinationAutoriseeObjet:null!=a.destinationBien?a.destinationBien.key:null,surfaceHabitableEnM2:a.surfaceHabitable,surfaceTerrainEnM2:a.surfaceTerrain,dateFinConstructionObjet:null!=a.anneeConstructionRenovationLourde?a.anneeConstructionRenovationLourde.toString()+"-01-01":null,codeZoneImplantationSituation:null!=a.zoneImplantation?a.zoneImplantation.code:null,codeQualiteLEmplacement:this.getCodeQualiteLEmplacement(a.qualiteEmplacement),descriptionLObjet1:this.getDescriptionLObjet1(a),descriptionLObjet2:this.getDescriptionLObjet2(a),descriptionLObjet3:this.getDescriptionLObjet3(a),descriptionLObjet4:this.getDescriptionLObjet4(a),descriptionLObjet5:this.getDescriptionLObjet5(a),descriptionLObjet6:this.getDescriptionLObjet6(a),descriptionLObjet7:r.dataPassePlat.descriptionLObjet7,codeVersementAttendu:this.getCodeVersementAttendu(a),dateDegrevement:n.isValued(a.dateDegrevement)?n.format(a.dateDegrevement,e.Commun.Constantes.Format.DATE_REST):null,codeModaliteLEstimation:null!=r.modalitesEstimationVenale?r.modalitesEstimationVenale.code:null,codeModaliteLEstimationPrud:null!=r.modalitesEstimationPrudentielle?r.modalitesEstimationPrudentielle.code:null,codeMotifReEstimation:null!=r.motifEstimationVenale?r.motifEstimationVenale.code:null,codeMotifReEstimationPrudentiel:null!=r.motifEstimationPrudentielle?r.motifEstimationPrudentielle.code:null,dateEstimValeurObjPrudentielle:n.isValued(r.dateEstimationPrudentielle)?n.format(r.dateEstimationPrudentielle,e.Commun.Constantes.Format.DATE_REST):null,montantValeurObjetPru:r.montantEstimationPrudentielle,codeCessionRangHypotheque:null!=r.cessionRang?r.cessionRang.key:null,identifiantGarantie1:r.dataPassePlat.identifiantGarantie1,dureeValiditeGarantie:r.dureeInscriptionHypothecaire,codeValeurPacteCommissoire:r.pacteCommissoire?"O":"N",numSecondrangLHypotheque:null,libelleLongVilleConservHypo:r.dataPassePlat.libelleLongVilleConservHypo,datePublication:r.dataPassePlat.datePublication,libelleLongReferenceVolume:r.dataPassePlat.libelleLongReferenceVolume,numeroVolume:r.dataPassePlat.numeroVolume,mtHypothequeDisponible:r.dataPassePlat.mtHypothequeDisponible,dateMontantHypoDisponible:r.dataPassePlat.dateMontantHypoDisponible,codeGarantieRechargeableExterne:r.dataPassePlat.codeGarantieRechargeableExterne,codePresenceServiceObjet:r.dataPassePlat.codePresenceServiceObjet,codeDevise:r.dataPassePlat.codeDevise,codeDeviseGarantie:r.dataPassePlat.codeDeviseGarantie,typologieLObjet:r.dataPassePlat.typologieLObjet}},t.getTypeObjetFinanceGaranti=function(e){switch(e.objetPorteGarantie){case 0:return e.objetCommercialFinancement.typeObjetFinanGaranti;case 1:return e.objetCommercialAutre.typeObjetFinanGaranti;default:return null}},t.getCodeQualiteLEmplacement=function(e){switch(e){case 0:return"BA";case 1:return"RE";default:return null}},t.getReferenceExterneObjet=function(t){if(0===t.masqueDefinitionObjet){if(t.configFsdgae.showReferenceUnEtablissement)return t.configFsdgae.etablissement;if(t.configFsdgae.showReferenceUnDateNaissance)return n.format(t.configFsdgae.dateNaissance,e.Commun.Constantes.Format.DATE_REST)}return t.referenceUn},t.getReferenceReferenceTypeLot=function(e){return e.referenceDeuxIsCompte?null!=e.numeroCompte?e.numeroCompte.formatRicePourStructureEchange():null:0===e.masqueDefinitionObjet&&e.configFsdgae.showReferenceDeuxNumeroContrat?e.configFsdgae.numeroContrat:e.referenceDeux},t.getDescriptionLObjet1=function(t){if(3===t.masqueDefinitionObjet)return t.configFsdgac.sirenEtablissement;if(2===t.masqueDefinitionObjet)return null!=t.configFsdgad.montantDerniereMutation?t.configFsdgad.montantDerniereMutation.toString():null;if(0===t.masqueDefinitionObjet){if(t.configFsdgae.showDescriptionUnDeuxCompagnieAssurance)return t.configFsdgae.nomCompagnieAssurance}else if(1===t.masqueDefinitionObjet){if(t.configFsdga4.showDescriptionUnDate)return n.format(t.configFsdga4.dateExtinctionBail,e.Commun.Constantes.Format.DATE_REST);if(t.configFsdga4.showDescriptionUnGestionTitre)return t.configFsdga4.titreGereEtablissement?"O":"N"}return null},t.getDescriptionLObjet2=function(e){if(3===e.masqueDefinitionObjet)return null!=e.configFsdgac.valeurBonOrigine?e.configFsdgac.valeurBonOrigine.toString():null;if(1===e.masqueDefinitionObjet){if(e.configFsdga4.showDescriptionDeuxNomGerant)return e.configFsdga4.nomGerant}else if(0===e.masqueDefinitionObjet&&e.configFsdgae.showDescriptionUnDeuxCompagnieAssurance)return e.configFsdgae.sirenCompagnieAssurance;return null},t.getDescriptionLObjet3=function(e){return 3===e.masqueDefinitionObjet?e.configFsdgac.numContratTitre:2===e.masqueDefinitionObjet&&null!=e.configFsdgad.montantAnnuelLoyerOrigine?e.configFsdgad.montantAnnuelLoyerOrigine.toString():null},t.getDescriptionLObjet4=function(e){return 3===e.masqueDefinitionObjet?0===e.configFsdgac.natureBon?"O":"N":null},t.getDescriptionLObjet5=function(t){return 3===t.masqueDefinitionObjet?n.format(t.configFsdgac.dateEcheance,e.Commun.Constantes.Format.DATE_REST):0===t.masqueDefinitionObjet&&t.configFsdgae.showDescriptionCinqNomContrat?t.configFsdgae.nomContrat:null},t.getDescriptionLObjet6=function(e){return 3===e.masqueDefinitionObjet?e.configFsdgac.intituleDepositaire:null},t.getCodeVersementAttendu=function(e){return 0===e.masqueDefinitionObjet?e.configFsdgae.isWithVersementsAttendusAutorises?"O":"N":null},t}();t.CaracteristiqueFinanGarantieSureteReelleBuilder=a}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=function(){function e(){}return e.getResult=function(e,t,n,i,a){if(1!==e)return null;var o="07"===t,s="13"===t;return{showReferenceUnNumEnregistrement:o,showReferenceUnMontant:s,showDescriptionUnDate:s,dateExtinctionBail:s?r.getDateExtinctionBail(n,i,a):null,showDescriptionUnGestionTitre:o,titreGereEtablissement:o?r.getTitreGereEtablissement(n,i,a):null,showDescriptionDeuxNomGerant:s,nomGerant:s?r.getNomGerant(n,i,a):null}},e}();t.ConfigFsdga4Builder=i;var r=function(){function e(){}return e.getDateExtinctionBail=function(e,t,i){return null!=e?n.parse(e.descriptionLObjet1):t&&null!=i?n.parse(i.descriptionLObjet1):null},e.getTitreGereEtablissement=function(e,t,n){return null!=e?"O"===e.descriptionLObjet1:t&&null!=n?"O"===n.descriptionLObjet1:null},e.getNomGerant=function(e,t,n){return null!=e?e.descriptionLObjet2:t&&null!=n?n.descriptionLObjet2:null},e}();t.ConfigFsdga4Helper=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=e.Commun.Tools.Object,r=function(){function e(){}return e.getResult=function(e,t,r,a){return 3!==e?null:null!=t?{sirenEtablissement:t.descriptionLObjet1,valeurBonOrigine:i.stringToNumber(t.descriptionLObjet2),numContratTitre:t.descriptionLObjet3,natureBon:"O"===t.descriptionLObjet4?0:1,dateEcheance:n.parse(t.descriptionLObjet5),intituleDepositaire:t.descriptionLObjet6}:r&&null!=a?{sirenEtablissement:a.descriptionLObjet1,valeurBonOrigine:i.stringToNumber(a.descriptionLObjet2),numContratTitre:a.descriptionLObjet3,natureBon:"O"===a.descriptionLObjet4?0:1,dateEcheance:n.parse(a.descriptionLObjet5),intituleDepositaire:a.descriptionLObjet6}:{sirenEtablissement:null,valeurBonOrigine:null,numContratTitre:null,natureBon:null,dateEcheance:null,intituleDepositaire:null}},e}();t.ConfigFsdgacBuilder=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.Object,i=function(){function e(){}return e.getResult=function(e,t,i,r){return 2!==e?null:null!=t?{montantDerniereMutation:n.stringToNumber(t.descriptionLObjet1),montantAnnuelLoyerOrigine:n.stringToNumber(t.descriptionLObjet3)}:i&&null!=r?{montantDerniereMutation:n.stringToNumber(r.descriptionLObjet1),montantAnnuelLoyerOrigine:n.stringToNumber(r.descriptionLObjet3)}:{montantDerniereMutation:null,montantAnnuelLoyerOrigine:null}},e}();t.ConfigFsdgadBuilder=i}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=e.Commun.Tools.DateUtils,i=function(){function e(){}return e.getResult=function(e,n,i,r,a,o,s){return 0!==e?null:new t.ConfigFsdgae(n,i,r,a,o,s)},e}();t.ConfigFsdgaeBuilder=i;var r=function(){function e(){}return e.getEtablissement=function(e,t,n){return null!=e?e.referenceExterneObjet:t&&null!=n?n.referenceExterneObjet:null},e.getDateNaissance=function(e,t,i){return null!=e?n.parse(e.referenceExterneObjet):t&&null!=i?n.parse(i.referenceExterneObjet):null},e.getNomCompagnieAssurance=function(e,t,n){return null!=e?e.descriptionLObjet1:t&&null!=n?n.descriptionLObjet1:null},e.getSirenCompagnieAssurance=function(e,t,n){return null!=e?e.descriptionLObjet2:t&&null!=n?n.descriptionLObjet2:null},e.getNumeroContrat=function(e,t,n){return null!=e?e.referenceTypeLot:t&&null!=n?n.referenceTypeLot:null},e.getNomContrat=function(e,t,n){return null!=e?e.descriptionLObjet5:t&&null!=n?n.descriptionLObjet5:null},e.getIsWithVersementsAttendusAutorises=function(e,t,n){return null!=e?"O"===e.codeVersementAttendu:t&&null!=n?"O"===n.codeVersementAttendu:!1},e}();t.ConfigFsdgaeHelper=r}(n=t.Modeles||(t.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));var Avenants;!function(e){var t;!function(e){var t;!function(t){"use strict";var n=function(){function n(e,n,i,r,a,o){var s="10"===e,u="11"===e;this.showReferenceUnEtablissement=s,this.etablissement=s?t.ConfigFsdgaeHelper.getEtablissement(n,i,r):null,this.showReferenceUnDateNaissance=u,this.dateNaissance=u?t.ConfigFsdgaeHelper.getDateNaissance(n,i,r):null,this.showReferenceDeuxNumCompte=s,this.showReferenceDeuxNumeroContrat=u,this.numeroContrat=u?t.ConfigFsdgaeHelper.getNumeroContrat(n,i,r):null,this.showDescriptionCinqNomContrat=u,this.nomContrat=u?t.ConfigFsdgaeHelper.getNomContrat(n,i,r):null,this.showDescriptionUnDeuxCompagnieAssurance=u,this.nomCompagnieAssurance=u?t.ConfigFsdgaeHelper.getNomCompagnieAssurance(n,i,r):null,this.sirenCompagnieAssurance=u?t.ConfigFsdgaeHelper.getSirenCompagnieAssurance(n,i,r):null,this.isWithVersementsAttendusAutorises=t.ConfigFsdgaeHelper.getIsWithVersementsAttendusAutorises(n,i,r),this.isVersementsAttendusToAjoutable=o,this.listeVersementsAttendusStock=_.map(a||[],function(e){return new t.VersementAttendu(1,e)}),this.listeVersementsAttendusBeforeEdit=[]}return Object.defineProperty(n.prototype,"listeVersementsAttendusAvailables",{get:function(){return _.filter(this.listeVersementsAttendusStock,function(t){return t.etatManipulation!==e.Enum.EtatManipulation.ToDelete})},enumerable:!0,configurable:!0}),n}();t.ConfigFsdgae=n}(t=e.Modeles||(e.Modeles={}))}(t=e.Business||(e.Business={}))}(Avenants||(Avenants={}));