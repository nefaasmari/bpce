/**
 * Généré par : SIGCESIE\ct-tfsbuild
 * Changeset TFS : C635270
 * Etiquette TFS : Com-adresse-dqe-v22.01_20211203.7
 * Déclenchement : IndividualCI
 */
"use strict";var myway;!function(e){var t;!function(e){e.app=angular.module("myway.comAdresseDqe",["ui.bootstrap","moduleAgent","myway.ui","myway.comInterdomaine","ngSanitize"])}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function t(t,s,i,r,n,o,a,c,l,d,u){var h=this;this.$element=t,this.$timeout=s,this.$q=i,this.$parse=r,this.$scope=n,this.serviceAgentExtended=o,this.adresseService=a,this.paysService=c,this.dqeService=l,this.inseeService=d,this.logger=u,this.paysService.getAllPays().then(function(e){h.paysList=e}),this.$timeout(function(){h.formulaire=h.$scope[h.id]});var m=this.settings&&this.settings.type===e.AdresseTypeEnum.PROFESSIONNEL?e.adresseProfessionnelDefaultSettings:e.adresseParticulierDefaultSettings;this.settings=_.merge({},m,this.settings),this.dqeService.setServiceActive(this.settings.dqeServices),this.ngModelOptions={updateOn:"blur"},this.loadingAdresses=!1,this.loadingLocalites=!1,this.loadingModel=!!this.loadingModel,this.erreurRecherche=!1,this.resultatVide=!1,this.forcage=!1,this.watchAdresseReferenceChange()}return t.prototype.isDisabled=function(e){var t="boolean"==typeof this.disabled?this.disabled:this.settings.readOnly;return e&&!t&&(t=e.readOnly),t},t.prototype.reinitialiser=function(){this.adresse.afnor.ligne1="",this.adresse.afnor.ligne2="",this.adresse.afnor.ligne3="",this.adresse.afnor.ligne4="",this.adresse.afnor.ligne5="",this.adresse.afnor.ligne6="",this.adresse.updateCPVilleFromLigne6(),this.adresse.pays=e.PaysConstantes.FRANCE,this.initAdresse(),"function"==typeof this.onResetFunction&&this.onResetFunction()},t.prototype.onFieldChange=function(t){var s=this;switch(t){case"ligne1":this.settings.champs.ligne1.requis&&(this.postValidationProcess(),this.callChangeFunction(!0));break;case"ligne3":if(this.adresse.afnor.ligne3!==this.adressePreviousState.afnor.ligne3&&this.adresse.$codeRNVP!==e.CodeDqeEnum.LOCALITE_NON_VALIDE)return this.etatValidationDqe=0,this.valider(e.DQEOutputActionEnum.SUGGEST);break;case"ligne4":case"ligne5":this.adresse.$codeRNVP===e.CodeDqeEnum.LOCALITE_NON_VALIDE?this.postValidationProcess():(this.etatValidationDqe=0,this.valider(e.DQEOutputActionEnum.OVERWRITE_OR_SUGGEST));break;case"ligne6":this.adresse.afnor.ligne6&&(console.log("test"),this.adresse.updateCPVilleFromLigne6(),this.etatValidationDqe=0,this.controlerLocalite(e.DQEOutputActionEnum.SUGGEST).then(function(){return s.adresse.$codeRNVP===e.CodeDqeEnum.LOCALITE_VALIDE?s.valider(e.DQEOutputActionEnum.SUGGEST):void s.postValidationProcess()}));break;case"adresseHorsFrance":this.adresse.pays=this.adresseHorsFrance?null:this.paysService.getFrance(),this.isPaysGere=this.dqeService.isPaysGere(this.adresse.pays),!this.showAdresse&&this.adresseHorsFrance&&(this.showAdresse=!0),this.isFrance=this.adresse.pays&&this.adresse.pays.codePaysIso===e.AdresseConstantes.PAYS_FRANCE,this.isFrance||(this.adresse.afnor.ligne5=""),this.isPaysGere||(this.adresseRecherche=""),this.dqeService.setServiceActive(!this.adresseHorsFrance),this.etatValidationDqe=0,this.valider(e.DQEOutputActionEnum.OVERWRITE_OR_SUGGEST);break;case"pays":this.isPaysGere=this.dqeService.isPaysGere(this.adresse.pays),this.isFrance=this.adresse.pays&&this.adresse.pays.codePaysIso===e.AdresseConstantes.PAYS_FRANCE,this.adresseHorsFrance=!this.isFrance,this.isFrance?this.dqeService.setServiceActive(!this.adresseHorsFrance):this.adresse.afnor.ligne5="",this.isPaysGere||(this.adresseRecherche=""),this.verifieTerritoire(this.adresse.pays.codePaysIsoAfnor).then(function(e){console.log("Est territoire :",e),s.estTerritoire=e[0],e[0]===!0&&(s.territoireLibelle=e[1])}),this.etatValidationDqe=0,this.valider(e.DQEOutputActionEnum.OVERWRITE_OR_SUGGEST);break;case"codeInseeLocalite":for(var i=0;i<this.inseeList.listeCommunesInsee.length;i++)this.inseeList.listeCommunesInsee[i].codeInseeLocalite===this.adresse.codeInseeLocalite&&(this.adresse.libelleInseeLocalite=this.inseeList.listeCommunesInsee[i].libelleInseeLocalite,this.adresse.updateLigne6FromCPVille());this.reduireControle=!0,this.postValidationProcess(),this.callChangeFunction(!0);break;default:this.callChangeFunction(!0)}},t.prototype.getAdresses=function(e){var t=this;return this.adresseService.rechercherAdresses(this.adresse.pays,e,this.settings).then(function(s){return t.erreurRecherche=!1,t.resultatVide=s&&0===s.length,t.derniereAdresseRecherche=e,s})["catch"](function(e){return t.showAdresse=!0,t.erreurRecherche=!0,t.resultatVide=!1,[]})},t.prototype.getComplements=function(e){return(this.complements||[]).filter(function(t){return-1!==t.indexOf(e)})},t.prototype.getLocalites=function(e){var t,s,i=/(\d{3,5})?\s*(.+)?/g.exec(e);if(t=_.trim(i[1]),s=_.trim(i[2]),t&&t.length<5)return this.$q.when([]);var r,n=t,o=s;if(n||!o)r=t;else{if(!o)return this.$q.when([]);r=s}return this.adresseService.getLocalites(this.adresse.pays,r,this.settings)["catch"](function(e){return[]})},t.prototype.selectAdresse=function(t){this.suggestionVoie=null,this.complements=t.complements,this.adresse.afnor.ligne3="",this.adresse.afnor.ligne4=t.getLigne4Afnor(),this.adresse.afnor.ligne5=t.lieuDit,this.adresse.codePostal=t.codePostal,this.adresse.libelleInseeLocalite=t.localite,this.adresse.codeInseeLocalite=t.idLocalite,this.adresse.numeroVoiePTT=t.numero,this.adresse.updateLigne6FromCPVille(),this.adresseRecherche="",this.showAdresse=!0,this.valider(e.DQEOutputActionEnum.OVERWRITE_OR_SUGGEST)},t.prototype.selectLocalite=function(t){this.adresse.codePostal=t.codePostal,this.adresse.libelleInseeLocalite=t.localite,this.adresse.codeInseeLocalite=t.idLocalite,this.adresse.afnor.ligne5=t.lieuDit,this.adresse.updateLigne6FromCPVille(),this.etatValidationDqe=1,this.valider(e.DQEOutputActionEnum.OVERWRITE_OR_SUGGEST)},t.prototype.valider=function(e){var t=this;this.controlerAdresseRNVP(e)["catch"](function(){return 1!==t.etatValidationDqe?t.controlerLocalite(e):t.$q.when(!0)})["finally"](function(){return t.postValidationProcess()})},t.prototype.callChangeFunction=function(e){"function"==typeof this.onChangeFunction&&this.onChangeFunction({adresse:this.adresse,changed:e})},t.prototype.forcer=function(){return this.adresse.$codeRNVP=e.CodeDqeEnum.VALIDE,this.suggestionVoie=null,this.postValidationProcess(!1)},t.prototype.validerSuggestionVoie=function(){this.adresse.setRNVPAdresse(this.suggestionVoie),this.suggestionVoie=null,this.adresse.$codeRNVP=e.CodeDqeEnum.VALIDE,this.postValidationProcess(!0)},t.prototype.verifieTerritoire=function(e){var t,s,i=this;return s=[],this.serviceAgentExtended.getListDonneesDelocalisees("DU8M").then(function(r){return t=_.find(r,{CTDGI2:e}),t&&"N"===t.CIDCPP?(s.push(!0),s.push(t.LCEDPF)):s.push(!1),i.$q.when(s)})["catch"](function(e){return i.serviceAgentExtended.Trace.warning("Récuperation Pays ---- Une erreur est survenue lors de la DU8M","verifieTerritoire",e),i.$q.when(s.push(!1))})},t.prototype.setValidityDQE=function(){this.formulaire.$setValidity("numeroInexistant",this.adresse.$codeRNVP!==e.CodeDqeEnum.NUMERO_INEXISTANT,null),this.formulaire.$setValidity("rueNonTrouvee",this.adresse.$codeRNVP!==e.CodeDqeEnum.NON_TROUVE,null),this.formulaire.$setValidity("localiteNonTrouvee",this.adresse.$codeRNVP!==e.CodeDqeEnum.LOCALITE_NON_TROUVEE,null),this.formulaire.$setValidity("localiteNonValide",this.adresse.$codeRNVP!==e.CodeDqeEnum.LOCALITE_NON_VALIDE,null),this.formulaire.$setValidity("localiteIncomplete",this.adresse.$codeRNVP!==e.CodeDqeEnum.LOCALITE_INCOMPLETE,null),this.reduireControle&&(this.formulaire.$setValidity("localiteNonTrouvee",!0,null),this.formulaire.$setValidity("localiteNonValide",!0,null),this.formulaire.$setValidity("localiteIncomplete",!0,null)),this.formulaire.$setValidity("erreurTechniqueDQE",this.adresse.$codeRNVP!==e.CodeDqeEnum.SERVICE_INDISPONIBLE,null),this.forcage=!1,(this.adresse.$codeRNVP===e.CodeDqeEnum.NUMERO_INEXISTANT||this.adresse.$codeRNVP===e.CodeDqeEnum.NON_TROUVE||this.adresse.$codeRNVP===e.CodeDqeEnum.ADRESSE_SUGGEREE||this.adresse.$codeRNVP===e.CodeDqeEnum.SERVICE_INDISPONIBLE)&&this.activerForcage(),console.log("setValiditySQE() reduireControle:",this.reduireControle),console.log("setValiditySQE() adresse:",this.adresse.$codeRNVP),console.log("setValiditySQE() formulaire:",this.formulaire.$setValidity)},t.prototype.controlerAdresseRNVP=function(t){var s=this;return this.adresseService.controlerAdresseRNVP(this.adresse,this.settings).then(function(i){return s.etatValidationDqe=2,s.adresse.$codeRNVP=i.codeErreur,(s.adresse.$codeRNVP===e.CodeDqeEnum.VALIDE||s.adresse.$codeRNVP===e.CodeDqeEnum.NUMERO_INEXISTANT)&&(s.complements=i.bestMatch.complements,t===e.DQEOutputActionEnum.OVERWRITE||t===e.DQEOutputActionEnum.OVERWRITE_OR_SUGGEST&&s.adresse.isAdresseEmpty()?s.adresse.setRNVPAdresse(i.bestMatch):s.adresse.$codeRNVP===e.CodeDqeEnum.NUMERO_INEXISTANT||s.adresse.afnor.ligne4===i.bestMatch.adresse&&s.adresse.libelleInseeLocalite===i.bestMatch.localite&&s.adresse.codePostal===i.bestMatch.codePostal?s.adresse.$codeRNVP===e.CodeDqeEnum.NUMERO_INEXISTANT&&(s.suggestionVoie=null):(s.suggestionVoie=i.bestMatch,s.adresse.$codeRNVP=e.CodeDqeEnum.ADRESSE_SUGGEREE)),s.$q.when(!0)},function(t){return s.adresse.$codeRNVP=t,t===e.CodeDqeEnum.ADRESSE_INCOMPLETE?s.$q.reject(!0):s.$q.when(!0)})},t.prototype.controlerLocalite=function(t){var s=this;return void 0===t&&(t=e.DQEOutputActionEnum.OVERWRITE),t===e.DQEOutputActionEnum.OVERWRITE_OR_SUGGEST&&(t=e.DQEOutputActionEnum.OVERWRITE),this.adresseService.controlerLocalite(this.adresse,this.settings).then(function(i){s.etatValidationDqe=1,s.adresse.$codeRNVP=i.codeErreur,i.codeErreur===e.CodeDqeEnum.LOCALITE_VALIDE?t===e.DQEOutputActionEnum.OVERWRITE?(s.adresse.codePostal=i.bestMatch.codePostal,s.adresse.libelleInseeLocalite=i.bestMatch.localite,s.adresse.codeInseeLocalite=i.bestMatch.idLocalite,s.adresse.updateLigne6FromCPVille()):s.adresse.codeInseeLocalite!==i.bestMatch.idLocalite&&s.adresse.codePostal===i.bestMatch.codePostal&&s.adresse.libelleInseeLocalite===i.bestMatch.localite&&(s.adresse.codeInseeLocalite=i.bestMatch.idLocalite):t===e.DQEOutputActionEnum.OVERWRITE&&(s.adresse.codeInseeLocalite=null)},function(e){s.adresse.$codeRNVP=e})["finally"](function(){return s.$q.when(!0)})},t.prototype.watchAdresseReferenceChange=function(){var e=this;this.$scope.$watch(function(){return e.adresse},function(t,s){e.adresse?e.adresse.codePostal||e.adresse.libelleInseeLocalite?e.adresse.updateLigne6FromCPVille():e.adresse.updateCPVilleFromLigne6():e.loadingModel||(e.adresse=e.adresseService.getNewAdresseFrance()),e.initAdresse()})},t.prototype.initAdresse=function(){var t=this;return this.adresse&&(this.isPaysGere=this.dqeService.isPaysGere(this.adresse.pays),this.isFrance=this.adresse.pays&&this.adresse.pays.codePaysIso===e.AdresseConstantes.PAYS_FRANCE,this.adresseHorsFrance=!this.isFrance,this.settings.readOnly===!1&&this.adresse.setLibelleInseeLocalite(this.adresse.libelleInseeLocaliteWithoutArrondissement),this.adresse.$codeRNVP=e.CodeDqeEnum.VALIDE,this.adresseService.getTerritoire().then(function(e){e?(t.codeTerritoireAdresse=e,t.verifieTerritoire(t.codeTerritoireAdresse).then(function(e){t.estTerritoire=e[0],e[0]===!0&&(t.territoireLibelle=e[1])})):t.estTerritoire=!1})),this.showAdresse=this.settings.alwaysExpand||!this.settings.recherche.afficher||!this.loadingModel&&(!this.adresse.isEmpty()||null!=this.adresse.pays&&!this.isPaysGere),this.suggestionVoie=null,this.etatValidationDqe=0,this.adresse?this.postValidationProcess(!1):this.$q.when()},t.prototype.activerForcage=function(){var e=this;this.habilitationForcagePromise||(this.habilitationForcagePromise=this.$q.when(this.settings.codeHabilitationForcage?this.serviceAgentExtended.Habilitation.EstHabilite(this.settings.codeHabilitationForcage):!0)),this.habilitationForcagePromise.then(function(t){e.forcage=t})},t.prototype.postValidationProcess=function(t){var s=this;void 0===t&&(t=!0),this.formulaire=this.$scope[this.id],this.adresse.afnor.flagImport&&this.forcage===!1&&this.controlerLocalite(e.DQEOutputActionEnum.SUGGEST).then(function(){console.log("code RNVP :",s.adresse.$codeRNVP)}),this.setValidityDQE(),console.log("Etat du formulaire: ",this.formulaire.$error);var i=t?this.adresseService.tronquerAdresse(this.adresse,this.settings):this.$q.when();return i.then(function(){return s.adressePreviousState=angular.copy(s.adresse),s.adresse.codeInseeLocalite&&s.adresse.codeInseeLocalite.length>5&&(s.adresse.codeInseeLocalite=s.adresse.codeInseeLocalite.substr(0,5)),s.$timeout(function(){s.adresse.$valid=s.formulaire.$valid,s.callChangeFunction(t)})})},t.$inject=["$element","$timeout","$q","$parse","$scope","serviceAgentExtended","mwsfAdresseService","mwsfPaysService","mwsfDqeService","adresseLoggerService","mwsfInseeService"],t}();e.SaisieAdresseController=t,e.app.controller("mwsfSaisieAdresseController",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){return{restrict:"E",priority:0,templateUrl:"typescript/adresse/saisie-adresse-view.html",controller:"mwsfSaisieAdresseController",controllerAs:"ctrl",bindToController:!0,scope:{id:"@",adresse:"=value",settings:"=?",disabled:"=?ngDisabled",loadingModel:"=?loading",onChangeFunction:"&?mwChange",onResetFunction:"&?reset"},link:function(e,t,s){if(!("id"in s))throw new Error("directive mwsfAdresse: l'attribut id est obligatoire !");if(!("value"in s))throw new Error("directive mwsfAdresse: l'attribut value est obligatoire !")}}};t.$inject=[],e.app.directive("mwsfAdresse",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function e(){}return e.PAYS_FRANCE="FRA",e.AFNOR_DEFAULT_SIZE=32,e.CODE_HABILITATION_FORCAGE="SHDA28",e}();e.AdresseConstantes=t,function(e){e[e.PARTICULIER="PART"]="PARTICULIER",e[e.PROFESSIONNEL="PRO"]="PROFESSIONNEL"}(e.AdresseTypeEnum||(e.AdresseTypeEnum={}));var s=e.AdresseTypeEnum,i={type:s.PARTICULIER,readOnly:!1,dqeServices:!0,alwaysExpand:!1,maxSize:t.AFNOR_DEFAULT_SIZE,codeHabilitationForcage:t.CODE_HABILITATION_FORCAGE,adresseHorsFranceCheckbox:!0,recherche:{afficher:!0,libelle:"Rechercher adresse",debounce:500,minLength:5,placeholder:"Assistance à la saisie? Consulter l'aide ci-contre"},champs:{ligne1:{afficher:!0,requis:!1,readOnly:!1,libelle:"Destinataire"},ligne2:{afficher:!0,requis:!1,readOnly:!1},ligne3:{afficher:!0,requis:!1,readOnly:!1,libelle:"Bâtiment"},ligne4:{afficher:!0,requis:!0,readOnly:!1,libelle:"Voie ou rue"},ligne5:{afficher:!0,requis:!1,readOnly:!1,libelle:"Lieu dit"},ligne6:{afficher:!0,requis:!0,readOnly:!1,libelle:"Code postal et ville"},pays:{afficher:!0,requis:!0,readOnly:!1,libelle:"Pays"},codeInseeLocalite:{readOnly:!1}},boutonReinitialiser:{enabled:!1,libelle:"Réinitialiser",icone:"itce-trash"}};e.adresseParticulierDefaultSettings=_.merge({champs:{ligne2:{libelle:"Etage / Appartement"}}},i),e.adresseProfessionnelDefaultSettings=_.merge({champs:{ligne2:{libelle:"Complément destinataire"}}},i),e.adresseSansInseeDefaultSettings=_.merge({champs:{codeInseeLocalite:{afficher:!0,requis:!0,readOnly:!1,libelle:"Code insee"}}},i),e.desactiverAdresseSansInseeDefaultSettings=_.merge({champs:{codeInseeLocalite:{afficher:!1,requis:!1,readOnly:!1,libelle:"Code insee"}}},i)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function e(){}return e.REGEXP_CP_INSEE_VILLE=/(\d{5})?\s*(\((?:2[AB]|[0-9]{2})[0-9]{3}\))?\s*(.+)?/g,e.REGEXP_CP_INCOMPLET=/(\d{3,5})?\s*(.+)?/gi,e.REGEXP_CODE_INSEE=/^(?:2[AB]|[0-9]{2})[0-9]{3}$/gi,e.REGEXP_CP_VILLE_MATCHES_LENGTH=4,e.REGEXP_CP_INCOMPLET_MATCHES_LENGTH=3,e.REGEXP_CP_VILLE_MATCH_CP_INDEX=1,e.REGEXP_CP_VILLE_MATCH_INSEE_INDEX=2,e.REGEXP_CP_VILLE_MATCH_VILLE_INDEX=3,e.REGEXP_CP_INCOMPLET_MATCH_CP_INDEX=1,e.CODE_POSTAL_LENGTH=5,e.SAISIE_MIN_LENGTH=3,e.LOGS_ACTIFS=!1,e}();e.ComAdresseDqeConstantes=t}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(t){var s=function(){function s(e,s,i,r){this.$q=e,this.$scope=s,this.adresseService=i,this.traceService=r,this.settings=_.merge({},t.communeDefaultSettings,this.settings),this.validerSaisie()}return s.prototype.getCommunes=function(e){var s=this;if(console.log("getCommunes",e),this.errorDQE="",!this.settings.autocompletion)return null;if(this.traceService.debug("getCommunes",e),e.length<4)return this.$q.when([]);var i=/(\d{3,5})?\s*(.+)?/g.exec(e),r=_.trim(i[1]);if(r&&r.length<5)return this.traceService.debug("CP incomplet"),this.$q.when([]);var n;return n=this.settings.lieuxDits?this.adresseService.getLocalitesAvecLieuDit(t.PaysConstantes.FRANCE,e,this.settings):this.adresseService.getLocalites(t.PaysConstantes.FRANCE,e,this.settings).then(function(e){return s.supprimerLesLieuxDits(e),e}),console.log("serviceDQE",e),n.then(function(e){return s.traceService.debug("résultat recherche dqe",e),s.errorDQE="",s.settings.onChange&&s.settings.onChange(e),e})["catch"](function(e){return s.isSaisieValide=!1,s.errorDQE="Une erreur est survenue lors de la vérification du Code Postal. <br> Vous avez la possibilité de forcer en entrant un code Commune INSEE (5 chiffres) et un code Département (2 chiffres) ci-dessous.",console.error(e),[]})},s.prototype.supprimerLesLieuxDits=function(e){for(var t in e){var s=e[t];s.lieuDit&&e.splice(parseInt(t),1)}},s.prototype.inputFormatter=function(e){return this.traceService.debug("commune inputFormatter",e?e.toString():""),e&&e.toString()},s.prototype.onSelect=function(e,t,s,i){this.isSaisieValide=!0,console.log("onSelect"),this.onChangeFunction&&this.onChangeFunction(e,t,s,i)},s.prototype.validerSaisie=function(){var e=this;if(this.isSaisieValide=!1,this.listeCommunesAvecArrondissements=[],this.listeCommunesAvecArrondissements.push(this.creerObjetCommune("","13055","MARSEILLE")),this.listeCommunesAvecArrondissements.push(this.creerObjetCommune("","75056","PARIS")),this.listeCommunesAvecArrondissements.push(this.creerObjetCommune("","69123","LYON")),this.commune){var s=_.find(this.listeCommunesAvecArrondissements,{idLocalite:this.commune.toString()});this.adresseService.getLocaliteFromInsee(t.PaysConstantes.FRANCE,this.commune.toString(),this.settings).then(function(t){t?angular.isDefined(s)?(e.commune=s,e.isSaisieValide=!0,e.errorDQE='Une anomalie a été détectée lors de la vérification du code postal du lieu de naissance.<br>Merci de préciser la localité de naissance en tapant "'+e.commune.localite+'" dans le champ de saisie.'):(e.isSaisieValide=!0,e.initialiserCommune(t.codePostal,t.idLocalite,t.localite)):(e.isSaisieValide=!1,e.errorDQE='Une anomalie a été détectée lors de la vérification du code postal du lieu de naissance.<br>Merci de préciser la localité de naissance en tapant "'+e.commune.localite+'" dans le champ de saisie.',e.initialiserCommune("","",""))})["catch"](function(t){e.initialiserCommune("","",""),e.errorDQE="Une erreur est survenue lors de la vérification de la localité de naissance en raison d’une interruption de service momentanée.<br>Vous pouvez la saisir à nouveau ou la forcer en remplissant les deux champs ci-dessous si l’interruption de service perdure.",console.error(t)})}},s.prototype.initialiserCommune=function(t,s,i){this.commune=new e.comAdresseDqe.CPAdresse({CodePostal:t?t:"",IDLocalite:s,IDVoie:"",LieuDit:"",ListeNumero:[],Localite:i?i:"",NbNumero:"",Numero:"",Voie:void 0})},s.prototype.creerObjetCommune=function(t,s,i){return new e.comAdresseDqe.CPAdresse({CodePostal:t?t:"",IDLocalite:s,IDVoie:"",LieuDit:"",ListeNumero:[],Localite:i?i:"",NbNumero:"",Numero:"",Voie:void 0})},s.$inject=["$q","$scope","mwsfAdresseService","traceService","mwsfInseeService"],s}();t.SaisieCommuneController=s,t.app.controller("mwsfSaisieCommuneController",s)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){return{restrict:"E",templateUrl:"typescript/commune/saisie-commune-view.html",controller:"mwsfSaisieCommuneController",controllerAs:"ctrl",bindToController:!0,scope:{id:"@",commune:"=value",settings:"=?",errorDQE:"=?errorDqe",onChangeFunction:"&?mwChange"},link:function(e,t,s){}}};t.$inject=[],e.app.directive("mwsfCommune",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){e.communeDefaultSettings={readOnly:!1,dqeServices:!0,lieuxDits:!0}}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){!function(e){e[e.AUCUNE=0]="AUCUNE",e[e.DATE_NAISSANCE_INVALIDE=1]="DATE_NAISSANCE_INVALIDE",e[e.CODE_POSTAL_INCOMPLET=2]="CODE_POSTAL_INCOMPLET",e[e.SAISIE_MINIMUM_NON_ATTEINTE=3]="SAISIE_MINIMUM_NON_ATTEINTE",e[e.ERREUR_DQE=4]="ERREUR_DQE",e[e.CODE_INSEE_INCORRECT=5]="CODE_INSEE_INCORRECT",e[e.COMMUNE_INCONNUE_A_LA_DATE=6]="COMMUNE_INCONNUE_A_LA_DATE"}(e.TypeErreurCommuneNaissance||(e.TypeErreurCommuneNaissance={}));var t=e.TypeErreurCommuneNaissance,s=function(){function s(s,i,r,n,o){this.$q=s,this.$scope=i,this.$timeout=r,this.adresseService=n,this.traceService=o,this.typeErreur=t.AUCUNE,this.settings=_.merge({},e.communeNaissanceDefaultSettings,this.settings)}return s.prototype.getCommunes=function(e){var s,i,r=this;if(this.reinitialiserErreurDqe(),!this.settings.autocompletion)return this.$q.when(null);var n=this.adresseService.getCPFromSaisie(e),o=this.checkInput(e,this.dateNaissance,n);return o!==t.AUCUNE?(this.typeErreur=o,this.$q.when([])):(i=function(e){return r.typeErreur=t.ERREUR_DQE,console.error(e),[]},s=function(s){r.traceService.debug("Résultat de la recherche DQE :",s);var i=_.sortByOrder(s,["localite"],["asc"]),n=e.length>0,o=0===s.length;return n&&o&&(r.typeErreur=t.COMMUNE_INCONNUE_A_LA_DATE),i},this.adresseService.getCommunesNaissance(this.dateNaissance,"",e,this.settings).then(s)["catch"](i))},s.prototype.checkInput=function(s,i,r){var n=t.AUCUNE,o=i?!0:!1,a=s?s.length>=e.ComAdresseDqeConstantes.SAISIE_MIN_LENGTH:!0,c=r?r.length>=e.ComAdresseDqeConstantes.CODE_POSTAL_LENGTH:!0;return o?a?c||(n=t.CODE_POSTAL_INCOMPLET,this.traceService.debug("Code postal incomplet ("+e.ComAdresseDqeConstantes.CODE_POSTAL_LENGTH+" chiffres)",r)):(n=t.SAISIE_MINIMUM_NON_ATTEINTE,this.traceService.debug("Saisie trop courte ("+e.ComAdresseDqeConstantes.SAISIE_MIN_LENGTH+" caractères minimum)",s)):(n=t.DATE_NAISSANCE_INVALIDE,this.traceService.debug("Date de naissance non renseignée")),n},s.prototype.toString=function(e){return e&&e.toString()},s.prototype.onSelectCommune=function(e){this.onSelect&&this.onSelect({communeNaissance:e})},s.prototype.onBlur=function(){var e=this;this.$timeout(function(){e.settings.autocompletion&&"string"==typeof e.commune&&(e.commune="")},100)},s.prototype.reinitialiserErreurDqe=function(){this.typeErreur=t.AUCUNE},s.$inject=["$q","$scope","$timeout","mwsfAdresseService","traceService"],s}();e.SaisieCommuneNaissanceController=s,e.app.controller("mwsfSaisieCommuneNaissanceController",s)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){return{restrict:"E",templateUrl:"typescript/commune-naissance/saisie-commune-naissance-view.html",controller:"mwsfSaisieCommuneNaissanceController",controllerAs:"ctrl",bindToController:!0,scope:{id:"@",commune:"=value",dateNaissance:"=dateNaissance",insee:"=?insee",settings:"=?",typeErreur:"=?typeErreur",onSelect:"&?onSelect"},link:function(e,t,s){}}};t.$inject=[],e.app.directive("mwsfCommuneNaissance",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){e.communeNaissanceDefaultSettings={readOnly:!1,dqeServices:!0,autocompletion:!0}}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function t(){this.$valid=!1,this.$codeRNVP=e.CodeDqeEnum.SERVICE_PAS_APPELLE,this.afnor={}}return t.prototype.isEmpty=function(){return!this.afnor.ligne1&&!this.afnor.ligne2&&this.isAdresseEmpty()},t.prototype.isAdresseEmpty=function(){return!(this.afnor.ligne3||this.afnor.ligne4||this.afnor.ligne5||this.afnor.ligne6)},Object.defineProperty(t.prototype,"libelleInseeLocaliteWithArrondissement",{get:function(){return e.Tools.ajouterArrondissementLocalite(this.libelleInseeLocalite,this.codePostal)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"libelleInseeLocaliteWithoutArrondissement",{get:function(){return e.Tools.supprimerArrondissementLocalite(this.libelleInseeLocalite,this.codePostal)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFrance",{get:function(){return null!=this.pays&&this.pays.codePaysIsoAfnor===e.PaysConstantes.FRANCE.codePaysIsoAfnor},enumerable:!0,configurable:!0}),t.prototype.setRNVPAdresse=function(e){this.afnor.ligne4=e.adresse,e.lieuDit&&(this.afnor.ligne5=e.lieuDit),this.numeroVoiePTT=e.numero,this.codePostal=e.codePostal,this.codeInseeLocalite=e.idLocalite,this.libelleInseeLocalite=e.localite,this.updateLigne6FromCPVille()},t.prototype.setCodePostal=function(e){this.codePostal=e,this.updateLigne6FromCPVille()},t.prototype.setLibelleInseeLocalite=function(e){this.libelleInseeLocalite=e,this.updateLigne6FromCPVille()},t.prototype.setLigne6=function(e){this.afnor.ligne6=e,this.updateCPVilleFromLigne6()},t.prototype.setFlagImport=function(e){e?this.afnor.flagImport=e:this.afnor.flagImport=!1},t.prototype.updateCPVilleFromLigne6=function(){var e=/(\d{5})?\s*(.+)?/g.exec(this.afnor.ligne6);this.afnor.ligne6&&3===e.length?(this.codePostal=_.trim(e[1]),this.libelleInseeLocalite=_.trim(e[2])):(this.codePostal=null,this.libelleInseeLocalite=null)},t.prototype.updateLigne6FromCPVille=function(){this.afnor.ligne6=[this.codePostal,this.libelleInseeLocalite].join(" ").trim()},t.prototype.toString=function(){return[this.afnor.ligne2,this.afnor.ligne3,this.afnor.ligne4,this.afnor.ligne5,this.codePostal,this.libelleInseeLocalite].join(" ")},t}();e.Adresse=t}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function e(){}return e.FRANCE={codeInseePays:"99000",codePaysIsoAfnor:"FR",codePaysIso:"FRA",libelleInseePays:"FRANCE"},e}();e.PaysConstantes=t}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function e(e){var t=this;this.paysService=e,e.getAllPays().then(function(e){t.paysList=e})}return e.$inject=["mwsfPaysService"],e}();e.SaisiePaysController=t,e.app.controller("mwsfSaisiePaysController",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){return{restrict:"E",priority:1,require:"ngModel",templateUrl:"typescript/pays/saisie-pays-view.html",controller:"mwsfSaisiePaysController",controllerAs:"mwsfPays",bindToController:!0,scope:{ngDisabled:"=?"},link:function(){}}};t.$inject=[],e.app.directive("mwsfPays",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function t(e,t,s,i,r,n,o){this.$q=e,this.$parse=t,this.paysService=s,this.dqeService=i,this.logger=r,this.serviceAgent=n,this.inseeService=o}return t.prototype.getNewAdresse=function(t){return this.paysService.getPaysByCodeIso(t).then(function(t){var s=new e.Adresse;return s.pays=t,s})},t.prototype.getNewAdresseFrance=function(){var t=new e.Adresse;return t.pays=e.PaysConstantes.FRANCE,t},t.prototype.controlerAdresseRNVP=function(t,s){var i=this,r=this.dqeService.preparerAppelService(t.pays,s);if(r!==e.CodeDqeEnum.VALIDE)return this.$q.reject(r);if(!t.afnor.ligne4||!t.codePostal&&!t.libelleInseeLocalite)return this.$q.reject(e.CodeDqeEnum.ADRESSE_INCOMPLETE);var n=e.Tools.formatRnvpInput(t.afnor.ligne3,t.afnor.ligne4,t.afnor.ligne5,t.codePostal,t.libelleInseeLocalite);return this.dqeService.getRNVP(t.pays.codePaysIso,n,s).then(function(t){return t.codeErreur===e.CodeDqeEnum.NON_TROUVE?i.$q.reject(t.codeErreur):t})},t.prototype.controlerLocalite=function(t,s){var i=this,r=this.dqeService.preparerAppelService(t.pays,s);return r!==e.CodeDqeEnum.VALIDE?this.$q.reject(r):t.codePostal&&t.libelleInseeLocalite?this.dqeService.getCP(t.pays.codePaysIso,t.codePostal||t.libelleInseeLocalite,!t.codePostal).then(function(s){if(s.codeErreur===e.CodeDqeEnum.LOCALITE_NON_TROUVEE)return i.$q.reject(s.codeErreur);if(t.codePostal&&t.libelleInseeLocalite){var r=/^[^ ]+/m,n=_.find(s.adresses,function(e){return e.codePostal===t.codePostal&&e.localite===t.libelleInseeLocalite});if(n||(n=_.find(s.adresses,function(e){return e.codePostal===t.codePostal&&e.localite.replace(r,r.exec(e.localite)[0][0])===t.libelleInseeLocalite})),!n)return i.$q.reject(e.CodeDqeEnum.LOCALITE_NON_VALIDE);s.bestMatch=n,s.codeErreur=e.CodeDqeEnum.LOCALITE_VALIDE}else s.codeErreur=1===s.nbAdresse?e.CodeDqeEnum.LOCALITE_VALIDE:e.CodeDqeEnum.LOCALITES_MULTIPLES;return s}):this.$q.reject(e.CodeDqeEnum.LOCALITE_INCOMPLETE)},t.prototype.getLocalites=function(t,s,i){var r=this,n=this.dqeService.preparerAppelService(t,i);if(n!==e.CodeDqeEnum.VALIDE)return this.$q.reject(n);var o,a,c=/(\d{5})?\s*(.+)?/g.exec(s);return s&&3===c.length&&(o=_.trim(c[1]),a=_.trim(c[2])),this.dqeService.getCP(t.codePaysIso,o||a,!o).then(function(t){var s=t.adresses,i=_.filter(t.adresses,function(e){return-1!==e.codePostal.indexOf("-")});return i.length&&(s=_.difference(s,i),i.forEach(function(t){var i=t.codePostal.split("-"),r=t.idLocalite.split("-");angular.forEach(i,function(i,n){s.push(new e.CPAdresse({CodePostal:i,IDLocalite:r[n],IDVoie:t.idVoie,LieuDit:t.lieuDit,ListeNumero:t.listeNumero,Localite:t.localite,NbNumero:t.nbNumero,Numero:t.numero,Voie:t.voie}))})})),s=_.sortBy(s,function(e){return e.codePostal}),o&&a&&(s=_.filter(s,function(e){return-1!==e.localite.indexOf(a)})),r.suppressionDoublonLocalite(s)})},t.prototype.suppressionDoublonLocalite=function(e){return e.forEach(function(e){e.idVoie="",e.listeNumero=[],e.nbNumero="",e.nbNumero="",e.numero="",e.voie=""}),_.uniq(e,function(e){return[e.codePostal,e.idLocalite,e.localite].join()})},t.prototype.getLocalitesAvecLieuDit=function(t,s,i){var r=this,n=this.dqeService.preparerAppelService(t,i);if(n!==e.CodeDqeEnum.VALIDE)return this.$q.reject(n);var o,a,c,l=/(\d{5})?\s*(.+)?/g.exec(s);return s&&3===l.length&&(o=_.trim(l[1]),a=_.trim(l[2]),-1!==a.indexOf("(")&&a.indexOf("(")<a.indexOf(")")&&(c=a.substring(a.indexOf("(")+1,a.indexOf(")")),a=_.trim(a.substr(0,a.indexOf("("))))),this.dqeService.getCP(t.codePaysIso,o||a,!o).then(function(t){var s=t.adresses,i=_.filter(t.adresses,function(e){return-1!==e.codePostal.indexOf("-")});return i.length&&(s=_.difference(s,i),i.forEach(function(t){var i=t.codePostal.split("-"),r=t.idLocalite.split("-");angular.forEach(i,function(i,n){s.push(new e.CPAdresse({CodePostal:i,IDLocalite:r[n],IDVoie:t.idVoie,LieuDit:t.lieuDit,ListeNumero:t.listeNumero,Localite:t.localite,NbNumero:t.nbNumero,Numero:t.numero,Voie:t.voie}))})})),s=_.sortBy(s,function(e){return e.codePostal}),o&&a&&(s=c?_.filter(s,function(e){return-1!==e.localite.indexOf(a)&&-1!==e.lieuDit.indexOf(c)}):_.filter(s,function(e){return-1!==e.localite.indexOf(a)})),r.suppressionDoublonLocalite(s)})},t.prototype.getLocaliteFromInsee=function(t,s,i){var r=this.dqeService.preparerAppelService(t,i);return r!==e.CodeDqeEnum.VALIDE?this.$q.reject(r):this.dqeService.getVille(t.codePaysIso,s,!1).then(function(e){var t=e.adresses;return t&&0!==t.length?t[0]:null})},t.prototype.getCommunesNaissance=function(t,s,i,r){var n,o,a=this.$q.defer(),c=this.dqeService.preparerAppelService(e.PaysConstantes.FRANCE,r);if(c!==e.CodeDqeEnum.VALIDE)return this.$q.reject(c);var l=this.extractCPInseeVilleFromSaisie(i),d=s||l.insee.substr(1,5);return o=function(e){console.error(e),a.reject(e)},n=function(e){a.resolve(e.adresses)},this.dqeService.getCommuneNaissance(t,d,l.codePostal,l.ville).then(n)["catch"](o),
a.promise},t.prototype.extractCPInseeVilleFromSaisie=function(t){var s={codePostal:"",insee:"",ville:""},i=e.ComAdresseDqeConstantes.REGEXP_CP_INSEE_VILLE.exec(t);return e.ComAdresseDqeConstantes.REGEXP_CP_INSEE_VILLE.lastIndex=0,t&&i.length===e.ComAdresseDqeConstantes.REGEXP_CP_VILLE_MATCHES_LENGTH&&(s.codePostal=_.trim(i[e.ComAdresseDqeConstantes.REGEXP_CP_VILLE_MATCH_CP_INDEX]),s.insee=_.trim(i[e.ComAdresseDqeConstantes.REGEXP_CP_VILLE_MATCH_INSEE_INDEX]),s.ville=_.trim(i[e.ComAdresseDqeConstantes.REGEXP_CP_VILLE_MATCH_VILLE_INDEX])),s},t.prototype.getCPFromSaisie=function(t){var s="",i=e.ComAdresseDqeConstantes.REGEXP_CP_INCOMPLET.exec(t);return e.ComAdresseDqeConstantes.REGEXP_CP_INCOMPLET.lastIndex=0,t&&i.length===e.ComAdresseDqeConstantes.REGEXP_CP_INCOMPLET_MATCHES_LENGTH&&(s=_.trim(i[e.ComAdresseDqeConstantes.REGEXP_CP_INCOMPLET_MATCH_CP_INDEX])),s},t.prototype.tronquerAdresse=function(t,s){var i=this.dqeService.preparerAppelService(t.pays,s);if(i!==e.CodeDqeEnum.VALIDE)return this.$q.when();if((!t.afnor.ligne4||t.afnor.ligne4.length<=s.maxSize)&&(!t.afnor.ligne6||t.afnor.ligne6.length<=s.maxSize))return this.$q.when();var r={L3:t.afnor.ligne3,L4:t.afnor.ligne4,L5:t.afnor.ligne5,L6:t.afnor.ligne6};return this.dqeService.getAdresseNormalisee(t.pays.codePaysIso,r,s).then(function(e){e.DQE_L3&&(t.afnor.ligne3=e.DQE_L3),e.DQE_L4&&(t.afnor.ligne4=e.DQE_L4),e.DQE_L5&&(t.afnor.ligne5=e.DQE_L5),e.DQE_L6&&(t.afnor.ligne6=e.DQE_L6),t.updateCPVilleFromLigne6()})},t.prototype.rechercherAdresses=function(t,s,i){return this.dqeService.getSingle(t.codePaysIso,e.Tools.formatSingleInput(s),i).then(function(e){var t=_.chain(e).filter(function(e){return""!==e.idLocalite}).sortBy(function(e){return e.codePostal}).value();return t})},t.prototype.getCodeInsee=function(e,s){return(null===s||""===s)&&(s=""),this.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/"+t.SERVICE_RECUPERATION_INSEE+"/rechCommuneInsee",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:{codePostal:e,libelleLocalite:s}}).then(function(e){return e})["catch"](function(e){return e})},t.prototype.getTerritoire=function(){var e=this;return this.serviceAgent.getFromContext("identifiantPersonne").then(function(s){return s&&"0"!==s?e.serviceAgent.Context.GetAuthentificationInfo().then(function(i){return e.serviceAgent.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/"+t.SERVICE_RECUPERATION_TERRITOIRE+"/adresse",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:{codeEtablissement:i.codeEtablissement,idPersonne:s}}).then(function(e){return e[0].codeTerritoire})["catch"](function(e){return e})}):void 0})},t.$inject=["$q","$parse","mwsfPaysService","mwsfDqeService","adresseLoggerService","serviceAgentExtended","mwsfInseeService"],t.SERVICE_RECUPERATION_INSEE="tiersparametre/v1",t.SERVICE_RECUPERATION_TERRITOIRE="tiers-v1",t}();e.AdresseService=t,e.app.service("mwsfAdresseService",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function t(e,t,s){this.$http=e,this.$q=t,this.logger=s,this.failedCalls=0,this.serviceActive=!0}return t.prototype.setServiceActive=function(e){this.serviceActive=e},t.prototype.isServiceActive=function(){return this.serviceActive},t.prototype.isPaysGere=function(t){return t&&t.codePaysIsoAfnor===e.PaysConstantes.FRANCE.codePaysIsoAfnor},t.prototype.preparerAppelService=function(t,s){return s.dqeServices&&this.isServiceActive()?t?this.isPaysGere(t)?e.CodeDqeEnum.VALIDE:e.CodeDqeEnum.PAYS_NON_GERE:e.CodeDqeEnum.ADRESSE_INCOMPLETE:e.CodeDqeEnum.SERVICE_DESACTIVE},t.prototype.getRNVP=function(t,s,i){var r=this;return this.callService(e.ServiceDQEConstantes.RNVP2_URL,{Pays:t,Adresse:s,Taille:i.maxSize}).then(function(t){return r.logger.trace("getRNVP",s,t),new e.RNVPResponse(t)})},t.prototype.getSingle=function(t,s,i){var r=this;return this.callService(e.ServiceDQEConstantes.SINGLE_URL,{Pays:t,Adresse:s,Taille:i.maxSize}).then(function(t){return r.logger.trace("getSingle",s,t),_.reduce(t,function(t,s){return t.push(new e.SingleResponseAdresse(s)),t},[])})},t.prototype.getCP=function(t,s,i){var r=this;return this.callService(e.ServiceDQEConstantes.CP_URL,{Pays:t,CodePostal:s,Alpha:i}).then(function(t){return r.logger.trace("getCP",s,i,t),new e.CPResponse(t)})},t.prototype.getCommuneNaissance=function(t,s,i,r){var n=this;return this.callService(e.ServiceDQEConstantes.COMMUNE_NAISSANCE_URL,{DDN:t,INSEE:s,CP:i,Localite:r},!1).then(function(o){return n.logger.trace("getCommuneNaissance",t,s,i,r,o),new e.CommuneNaissanceResponse(o)})},t.prototype.getVille=function(t,s,i){var r=this;return this.callService(e.ServiceDQEConstantes.CP_URL,{Pays:t,IDLocalite:s,CodePostal:"",Alpha:i}).then(function(t){return r.logger.trace("getVille",s,i,t),new e.CPResponse(t)})},t.prototype.getAdresseNormalisee=function(t,s,i){var r=this;return this.callService(e.ServiceDQEConstantes.NORMALISATION_URL,angular.extend({Pays:t,Taille:i.maxSize},s),!1).then(function(e){return r.logger.trace("getAdresseNormalisee",s,e),e})},t.prototype.callService=function(t,s,i){var r=this;return void 0===i&&(i=!0),this.serviceActive?(_.forEach(s,function(e,t){"string"==typeof e&&(s[t]=e.replace(/;/g,"%3B"))}),s.Licence=e.ServiceDQEConstantes.LICENCE,i&&(s.Instance=1),this.$http({url:t,method:"GET",timeout:e.ServiceDQEConstantes.TIMEOUT,params:s}).then(function(e){return e.data},function(t){return r.failedCalls++,r.failedCalls>=e.ServiceDQEConstantes.FAILED_CALL_LIMIT&&r.setServiceActive(!1),r.$q.reject(e.CodeDqeEnum.SERVICE_INDISPONIBLE)})):this.$q.reject(e.CodeDqeEnum.SERVICE_DESACTIVE)},t.$inject=["$http","$q","adresseLoggerService"],t}();e.DqeService=t,e.app.service("mwsfDqeService",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function e(e){this.serviceAgentExtended=e}return e.prototype.getCodeInsee=function(t,s){var i=this,r=null!==s&&""!==s?s:"";return this.serviceAgentExtended.sendRequest({url:"http://myway-ressources-dua.sigcesie.caisse-epargne.fr:6083/"+e.SERVICE_RECUPERATION_INSEE+"/rechCommuneInsse",withHeaders:!0,method:MyWay.Services.MethodEnum.GET,params:{codePostal:t,libelle:r}}).then(function(e){return console.log("Liste CodeInsee :",e),_.chain(e).map(_.partialRight(_.pick,["codeInsee","libelle"])).value()})["catch"](function(e){return i.serviceAgentExtended.Trace.info("Une erreur c'est produite lors de la requête de recherche cummune insee, erreur : ",e),e})},e.$inject=["serviceAgentExtended"],e.SERVICE_RECUPERATION_INSEE="v1/tiersparametre",e}();e.InseeService=t,e.app.service("mwsfInseeService",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function e(e,t,s,i){this._messages=[e],angular.isArray(t)&&t.length&&[].push.apply(this._messages,t),this.prefix=!!i&&!s,this.prefix&&this._messages.unshift(i)}return Object.defineProperty(e.prototype,"messages",{get:function(){return this._messages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"messagesFramework",{get:function(){return this.prefix?this._messages.slice(1):this._messages},enumerable:!0,configurable:!0}),e}(),s=function(){function e(e,t,s,i){this.logLevel=e,this.bufferCapacity=t,this.consolePrefix=s,this.consoleAppender=i,this.buffer=[]}return e.prototype.trace=function(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];this.log(console.log.bind(console),!1,3,e,t)},e.prototype.info=function(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];this.log(console.info.bind(console),!1,2,e,t)},e.prototype.warn=function(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];this.log(console.warn.bind(console),!1,1,e,t)},e.prototype.error=function(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];this.log(console.error.bind(console),!1,0,e,t)},e.prototype.flush=function(){var e=this;this.buffer.forEach(function(t){e.log(t.func,!0,t.level,t.message,t.args)}),this.buffer=[]},e.prototype.log=function(e,s,i,r,n){if(!(this.logLevel<i||null==r)){var o=new t(r,n,s,this.consolePrefix);(this.consoleAppender||s)&&e.apply(null,o.messages),this.handleBuffer(e,s,i,r,n)}},e.prototype.handleBuffer=function(e,t,s,i,r){if(this.bufferCapacity&&!t){"object"==typeof i&&(i=JSON.stringify(i));for(var n=0;n<r.length;n++)"object"==typeof r[n]&&(r[n]=JSON.stringify(r[n]));this.buffer.push({date:new Date,func:e,level:s,message:i,args:r}),this.buffer.length>this.bufferCapacity&&this.buffer.shift()}},e}();e.LoggerService=s;var i=function(){function e(){this.level=2,this.bufferCapacity=0,this.consolePrefix="",this.consoleAppender=!0}return e.prototype.$get=function(){return new s(this.level,this.bufferCapacity,this.consolePrefix,this.consoleAppender)},e.prototype.setLoggerLevel=function(e){this.level=e},e.prototype.setConsolePrefix=function(e){this.consolePrefix=e},e.prototype.setBufferCapacity=function(e){this.bufferCapacity=e},e.prototype.setAppenderConsole=function(e){this.consoleAppender=e},e}();e.LoggerServiceProvider=i,e.app.provider("adresseLoggerService",i)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function t(e){this.serviceAgentExtended=e}return t.prototype.getAllPays=function(){var e=this;return this.serviceAgentExtended.getListDonneesDelocalisees("DU8M").then(function(t){var s,i;return i={CTDGI2:"codePaysIsoAfnor",CTDGIP:"codeInseePays",LCEDPF:"libelleInseePays",CTDGI1:"codePaysIso"},s=e.renameDu8m(t,i)})},t.prototype.renameDu8m=function(e,t){var s,i;return s=[],i={codePaysIsoAfnor:"",codeInseePays:"",libelleInseePays:"",codePaysIso:""},e.forEach(function(e){for(var r in e)"codeInseePays"===t[r]&&(i.codeInseePays=e[r]),"codePaysIsoAfnor"===t[r]&&(i.codePaysIsoAfnor=e[r]),"codePaysIso"===t[r]&&(i.codePaysIso=e[r]),"libelleInseePays"===t[r]&&(i.libelleInseePays=e[r]);s.push(i),i={codePaysIsoAfnor:"",codeInseePays:"",libelleInseePays:"",codePaysIso:""}}),s},t.prototype.getPaysByCodeIso=function(e){return this.getAllPays().then(function(t){return _.find(t,{codePaysIsoAfnor:e})})},t.prototype.getPaysByCodeInsee=function(e){return this.getAllPays().then(function(t){return _.find(t,{codeInseePays:e})})},t.prototype.getFrance=function(){return e.PaysConstantes.FRANCE},t.$inject=["serviceAgentExtended"],t}();e.PaysService=t,e.app.service("mwsfPaysService",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function e(){}return e.formatLocalite=function(e){var t=_.trim(e.replace(/([^(]+).*/g,"$1"));return t},e.ajouterArrondissementLocalite=function(e,t){var s=this.supprimerArrondissementLocalite(e,t);if("13090"!==t){var i=(t||"").match(/(750|130|690)(\d{2})/);i&&(s+=" "+i[2])}return s},e.supprimerArrondissementLocalite=function(e,t){var s=e;if("13090"!==t){var i=(t||"").match(/(750|130|690)(\d{2})/);i&&_.endsWith(s," "+i[2])&&(s=s.substring(0,s.length-3))}return s},e.creerLigne4=function(e,t,s,i){var r;return r="97500"===i?[t,s,e]:[e,t,s],_.compact(r).join(" ")},e.formatSingleInput=function(e){return e=e.replace(/\s*(97500)\s+(B\s*P|B\.\s*P|B\.\s*P\.)\s*(\d+)\s*(.*)/g,"$1 $3 $2 $4")},e.formatRnvpInput=function(e,t,s,i,r){"97500"===i&&(t=t.replace(/\s*(B\s*P|B\.\s*P|B\.\s*P\.)\s*(\d+)\s*(.*)/g,"$2 $1 $3"));var n=[e,t,s,i,r].join("|");return n},e}();e.Tools=t}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function t(e,t){this.$q=e,this.$timeout=t,this.historiqueLog="",this.colors={debug:"#283B82",error:"#C74F0C",info:"#336924",warning:"#9E0808"}}return t.prototype.log=function(e,t,s){if(void 0===e&&(e=""),window.console&&console.log){var i=-1!==navigator.userAgent.indexOf("Trident"),r="\n",n="***",o="padding:2px 10px; background-color:"+this.colors[this.logType]+"; color: white;";console.log(r),i?console.log(n+" "+s.toUpperCase()+" "+n+" --> "+e+" ("+this.getTime()+")"):console.log("%c "+e+" ("+this.getTime()+")",o),angular.isDefined(t)&&console.log(t),console.log(r)}},t.prototype.debug=function(e,t,s){void 0===s&&(s=!1),this.traceServiceLogger("debug",e,t,s)},t.prototype.error=function(e,t,s){void 0===s&&(s=!1),this.traceServiceLogger("error",e,t,s)},t.prototype.info=function(e,t,s){void 0===s&&(s=!1),this.traceServiceLogger("info",e,t,s)},t.prototype.warning=function(e,t,s){void 0===s&&(s=!1),this.traceServiceLogger("warning",e,t,s)},t.prototype.traceServiceLogger=function(s,i,r,n){if(void 0===n&&(n=!1),e.ComAdresseDqeConstantes.LOGS_ACTIFS){var o=null,a=void 0;if(this.logType=s,this.log(i,r,s),n&&angular.isDefined(r))try{this.historiqueLog+="<span style='padding:2px 10px; background-color:"+this.colors[this.logType]+"; color: white;'><strong>"+this.getTime()+"</strong> : "+i+"</span><pre>"+JSON.stringify(r)+"</pre > <br>"}catch(c){console.log("\n\n\n*************************************************************************\n"),console.log("Trace Service ERROR in this.historiqueLog JSON.stringify(object)\n"),console.log(r),console.log(c),console.log("*************************************************************************\n\n\n")}switch(this.logType){case"debug":try{t.logger.debug(i+" : %1",r)}catch(c){o="debug",a=c}break;case"info":try{t.logger.info(i+" : %1",r)}catch(c){o="info",a=c}break;case"error":try{t.logger.error(i+" : %1",r)}catch(c){o="error",a=c}break;case"warn":try{t.logger.warn(i+" : %1",r)}catch(c){o="warn",a=c}}null!==o&&(this.logType="error",this.log("TraceService Error : ServiceTrace.logger."+o,a))}},t.prototype.getTime=function(){var e=new Date;return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds()},t.prototype.clearHistoriqueLog=function(){this.historiqueLog=""},Object.defineProperty(t.prototype,"logType",{get:function(){return this._logType},set:function(e){this._logType=e},enumerable:!0,configurable:!0}),t.CLASS_NAME="Agenda.Service.TraceService",t.logger=MyWay.Services.Loggers.LoggerFactory.INSTANCE.getClass(t.CLASS_NAME),t.$inject=["$q","$timeout"],t}();e.TraceService=t,e.app.service("traceService",t)}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function e(){}return e.RNVP2_URL="http://cntladr-dua.sie.caisse-epargne.fr:9081/V1/verifrnvp/RNVP2/",e.CP_URL="http://cntladr-dua.sie.caisse-epargne.fr:9080/V1/verifmatch/CP/",e.COMMUNE_NAISSANCE_URL="http://cntladr-dua.sie.caisse-epargne.fr:9080/V1/verifmatch/CPFRA/",e.NORMALISATION_URL="http://cntladr-dua.sie.caisse-epargne.fr:9080/NormaliseADR/",e.SINGLE_URL="http://cntladr-dua.sie.caisse-epargne.fr:9080/V1/verifmatch/SINGLE/",e.LICENCE="IT-CE",e.TIMEOUT=4e4,e.FAILED_CALL_LIMIT=50,e.SEPARATEUR_COMPLEMENT=/\s*;\s*/,e.STATUT_REPONSE_OK="OK",e}();e.ServiceDQEConstantes=t,function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.SUGGEST=1]="SUGGEST",e[e.OVERWRITE_OR_SUGGEST=2]="OVERWRITE_OR_SUGGEST"}(e.DQEOutputActionEnum||(e.DQEOutputActionEnum={}));e.DQEOutputActionEnum;!function(e){e[e.VALIDE=0]="VALIDE",e[e.NON_TROUVE=1]="NON_TROUVE",e[e.LOCALITE_NON_TROUVEE=14]="LOCALITE_NON_TROUVEE",e[e.NUMERO_INEXISTANT=2]="NUMERO_INEXISTANT",e[e.BATIMENT_INEXISTANT=3]="BATIMENT_INEXISTANT",e[e.ADRESSE_INCOMPLETE=4]="ADRESSE_INCOMPLETE",e[e.LOCALITE_VALIDE=5]="LOCALITE_VALIDE",e[e.LOCALITE_NON_VALIDE=6]="LOCALITE_NON_VALIDE",e[e.LOCALITES_MULTIPLES=7]="LOCALITES_MULTIPLES",e[e.LOCALITE_INCOMPLETE=8]="LOCALITE_INCOMPLETE",e[e.PAYS_NON_GERE=9]="PAYS_NON_GERE",e[e.SERVICE_PAS_APPELLE=10]="SERVICE_PAS_APPELLE",e[e.SERVICE_INDISPONIBLE=11]="SERVICE_INDISPONIBLE",e[e.SERVICE_DESACTIVE=12]="SERVICE_DESACTIVE",e[e.ADRESSE_SUGGEREE=13]="ADRESSE_SUGGEREE"}(e.CodeDqeEnum||(e.CodeDqeEnum={}));e.CodeDqeEnum}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function t(t){this.codePostal=t.CodePostal,this.idLocalite=t.IDLocalite,this.idVoie=t.IDVoie,this.lieuDit=_.trim(t.LieuDit),this.listeNumero=t.ListeNumero,this.localite=e.Tools.formatLocalite(t.Localite),this.nbNumero=t.NbNumero,this.numero=t.Numero,this.voie=t.Voie}return t.prototype.toString=function(){var e=[this.codePostal,this.localite];return this.lieuDit&&e.push("("+this.lieuDit+")"),e.join(" ")},t}();e.CPAdresse=t;var s=function(){function s(s){this.reponse=s,this.nbAdresse=_.size(s),this.adresses=_.map(_.values(s),function(e){return new t(e)}),this.nbAdresse?(this.bestMatch=new t(_.min(s,function(e,t){return t})),1!==this.nbAdresse||this.bestMatch.localite||(this.nbAdresse=0,this.bestMatch=null,this.codeErreur=e.CodeDqeEnum.LOCALITE_NON_TROUVEE)):this.codeErreur=e.CodeDqeEnum.LOCALITE_NON_TROUVEE}return s}();e.CPResponse=s;var i=function(){function t(t){this.localite=t.Localite,this.pays=t.Pays,this.insee=t.Insee,this.codePostal=t.CodePostal,this.status=t.Status===e.ServiceDQEConstantes.STATUT_REPONSE_OK}return t.prototype.toString=function(){var e=_.trim(this.codePostal),t=[this.localite];return e?t.unshift(e):t.unshift("("+this.insee+")"),_.trim(t.join(" "))},t}();e.CommuneNaissance=i;var r=function(){function t(t){this.reponse=t,this.nbAdresse=_.size(t),this.adresses=this.filterAndFormatCommunesNaissance(t),this.nbAdresse?(this.bestMatch=new i(_.min(t,function(e,t){return t})),1!==this.nbAdresse||this.bestMatch.localite||(this.nbAdresse=0,this.bestMatch=null,this.codeErreur=e.CodeDqeEnum.LOCALITE_NON_TROUVEE)):this.codeErreur=e.CodeDqeEnum.LOCALITE_NON_TROUVEE}return t.prototype.filterAndFormatCommunesNaissance=function(e){var t=_.map(_.values(e),this.mapCommunesNaissance.bind(this)),s=_.filter(t,this.filterCommunesNaissance.bind(this));return s},t.prototype.mapCommunesNaissance=function(e){return new i(e)},t.prototype.filterCommunesNaissance=function(e,t,s){return e?e.status:!1},t}();e.CommuneNaissanceResponse=r}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){!function(e){e[e.VALIDE=0]="VALIDE",e[e.NON_TROUVE=1]="NON_TROUVE",e[e.VERIFICATION_MANUELLE=3]="VERIFICATION_MANUELLE",e[e.NUMERO_INEXISTANT=4]="NUMERO_INEXISTANT",e[e.SAISIE_INCOMPLETE=5]="SAISIE_INCOMPLETE"}(e.DQECodeErreurRNVPEnum||(e.DQECodeErreurRNVPEnum={}));var t=e.DQECodeErreurRNVPEnum,s=function(){function t(t){this.idVoie=t.IDVoie,this.voie=t.Voie,this.nbNumero=t.NbNumero,this.numero=t.Numero,this.listeNumero=t.ListeNumero,this.typeVoie=t.TypeVoie,this.adresse=t.Adresse,this.complement=t.Complement,this.cedex=t.Cedex,this.idLocalite=t.IDLocalite,this.codePostal=t.CodePostal,this.localite=e.Tools.formatLocalite(t.Localite),this.lieuDit=t.LieuDit,this.complement&&(this.complements=this.complement.split(e.ServiceDQEConstantes.SEPARATEUR_COMPLEMENT)),this.adresse=e.Tools.creerLigne4(this.numero,this.typeVoie,this.voie,this.codePostal)}return t.prototype.toString=function(){return[this.numero,this.typeVoie,this.voie,this.codePostal,this.localite,this.lieuDit].join(" ")},t}();e.RNVPAdresse=s;var i=function(){function i(t,i){if(this.reponse=t,this.nbAdresse=_.size(t),this.adresses=_.map(_.values(t),function(e){return new s(e)}),this.nbAdresse){var r=_.min(t,function(e,t){return t});this.bestMatch=new s(r),this.setCodeErreur(parseInt(r.DQECodeErreur,10))}else this.codeErreur=e.CodeDqeEnum.NON_TROUVE}return i.prototype.setCodeErreur=function(s){switch(s){case t.VALIDE:this.codeErreur=e.CodeDqeEnum.VALIDE;break;case t.NON_TROUVE:this.codeErreur=e.CodeDqeEnum.NON_TROUVE;break;case t.NUMERO_INEXISTANT:this.codeErreur=e.CodeDqeEnum.NUMERO_INEXISTANT;break;case t.SAISIE_INCOMPLETE:this.codeErreur=e.CodeDqeEnum.ADRESSE_INCOMPLETE;break;default:this.codeErreur=e.CodeDqeEnum.NON_TROUVE}},i}();e.RNVPResponse=i}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={}));var myway;!function(e){var t;!function(e){var t=function(){function t(t){this.idLocalite=t.IDLocalite,this.codePostal=t.CodePostal,this.localite=e.Tools.formatLocalite(t.Localite),this.lieuDit=t.LieuDit,this.idVoie=t.IDVoie,this.voie=t.Voie,this.nbNumero=t.NbNumero,this.numero=t.Numero,this.listeNumero=t.ListeNumero,this.typeVoie=t.TypeVoie,this.complement=t.Complement,this.complement&&(this.complements=this.complement.split(e.ServiceDQEConstantes.SEPARATEUR_COMPLEMENT))}return t.prototype.getLigne4Afnor=function(){return e.Tools.creerLigne4(this.numero,this.typeVoie,this.voie,this.codePostal)},t.prototype.toString=function(){var e=[this.getLigne4Afnor(),this.codePostal,this.localite];return this.lieuDit&&e.push("("+this.lieuDit+")"),e.join(" ")},t}();e.SingleResponseAdresse=t}(t=e.comAdresseDqe||(e.comAdresseDqe={}))}(myway||(myway={})),angular.module("myway.comAdresseDqe").run(["$templateCache",function(e){e.put("typescript/adresse/saisie-adresse-view.html",'<ng-form ng-attr-name="{{::ctrl.id}}" class="mwsf-adresse">\r\n    <div class="form-horizontal">\r\n        <div class="form-group" ng-show="!ctrl.isDisabled() && ctrl.settings.adresseHorsFranceCheckbox">\r\n            <div class="col-md-offset-3 col-md-7">\r\n                <div class="btn itce-checkbox" btn-checkbox ng-change="ctrl.onFieldChange(\'adresseHorsFrance\')" ng-model="ctrl.adresseHorsFrance">\r\n                    Adresse hors France et DOM-TOM\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="form-group" ng-show="ctrl.settings.recherche.afficher && !ctrl.isDisabled()">\r\n            <label for="{{::ctrl.id}}-rechercher" class="control-label col-md-3" ng-bind="::ctrl.settings.recherche.libelle"></label>\r\n            <div class="col-md-7" ng-class="{\'has-feedback\' : !ctrl.showAdresse}">\r\n                <mw-infobulle-aide id="aide-recherche-adresse" id-champ="rechercher_adresse" processus="false" flottante="true">\r\n                    <input type="text" class="form-control" ng-model="ctrl.adresseRecherche" mw-uppercase autocomplete="off" ng-disabled="!ctrl.isPaysGere || ctrl.loadingModel" typeahead="address for address in ctrl.getAdresses($viewValue)" typeahead-wait-ms="{{ctrl.settings.recherche.debounce}}" typeahead-min-length="ctrl.settings.recherche.minLength" typeahead-on-select="ctrl.selectAdresse($item)" typeahead-loading="ctrl.loadingAdresses" mw-input-loader="ctrl.loadingAdresses" placeholder="{{::ctrl.settings.recherche.placeholder}}" ng-attr-id="{{::ctrl.id}}-rechercher" name="rechercher">\r\n                    <span class="btn btn-success form-control-feedback icon itce-plus" aria-hidden="true" ng-click="ctrl.showAdresse = true" ng-show="!ctrl.showAdresse"></span>\r\n                </mw-infobulle-aide>\r\n                <span class="error-msg col-md-12" ng-show="ctrl.erreurRecherche">Service de validation d\'adresse indisponible. Merci de saisir l\'adresse manuellement.</span>\r\n                <span class="error-msg col-md-12" ng-show="ctrl.resultatVide && ctrl.adresseRecherche.length >= ctrl.settings.recherche.minLength && ctrl.adresseRecherche === ctrl.derniereAdresseRecherche">Je n’ai pas trouvé l’adresse.</span>\r\n            </div>  \r\n        </div>\r\n        <div ng-show="ctrl.showAdresse">\r\n            <div class="form-group" ng-if="::ctrl.settings.champs.ligne1.afficher">\r\n                <label for="{{::ctrl.id}}-ligne1" class="control-label col-md-3" ng-bind="::ctrl.settings.champs.ligne1.libelle"></label>\r\n                <div class="col-md-5">\r\n                    <input type="text" class="form-control" ng-if="!ctrl.isDisabled(ctrl.settings.champs.ligne1)" ng-model="ctrl.adresse.afnor.ligne1" ng-model-options="::ctrl.ngModelOptions" ng-required="::ctrl.settings.champs.ligne1.requis" ng-change="ctrl.onFieldChange(\'ligne1\')" ng-trim="true" ng-disabled="ctrl.loadingModel" mw-uppercase autocomplete="off" ng-attr-id="{{::ctrl.id}}-ligne1" name="ligne1">\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.afnor.ligne1" ng-if="ctrl.isDisabled(ctrl.settings.champs.ligne1)"></p>\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-if="::ctrl.settings.champs.ligne2.afficher">\r\n                <label for="{{::ctrl.id}}-ligne2" class="control-label col-md-3" ng-bind="::ctrl.settings.champs.ligne2.libelle"></label>\r\n                <div class="col-md-5">\r\n                    <input type="text" maxlength="32" class="form-control" ng-if="!ctrl.isDisabled(ctrl.settings.champs.ligne2)" ng-model="ctrl.adresse.afnor.ligne2" ng-model-options="::ctrl.ngModelOptions" ng-required="::ctrl.settings.champs.ligne2.requis" ng-change="ctrl.onFieldChange(\'ligne2\')" ng-trim="true" ng-disabled="ctrl.loadingModel" mw-uppercase autocomplete="off" ng-attr-id="{{::ctrl.id}}-ligne2" name="ligne2">\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.afnor.ligne2" ng-if="ctrl.isDisabled(ctrl.settings.champs.ligne2)"></p>\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-if="::ctrl.settings.champs.ligne3.afficher">\r\n                <label for="{{::ctrl.id}}-ligne3" class="control-label col-md-3" ng-bind="::ctrl.settings.champs.ligne3.libelle"></label>\r\n                <div class="col-md-5">\r\n                    <input type="text" maxlength="32" class="form-control" ng-if="!ctrl.isDisabled(ctrl.settings.champs.ligne3)" ng-model="ctrl.adresse.afnor.ligne3" ng-required="::ctrl.settings.champs.ligne3.requis" ng-blur="ctrl.onFieldChange(\'ligne3\')" ng-trim="true" ng-disabled="ctrl.loadingModel" typeahead="complement for complement in ctrl.getComplements($viewValue)" typeahead-focus-first="true" typeahead-min-length="0" mw-uppercase autocomplete="off" ng-attr-id="{{::ctrl.id}}-ligne3" name="ligne3">\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.afnor.ligne3" ng-if="ctrl.isDisabled(ctrl.settings.champs.ligne3)"></p>\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-if="::ctrl.settings.champs.ligne4.afficher">\r\n                <label for="{{::ctrl.id}}-ligne4" class="control-label col-md-3" ng-bind="::ctrl.settings.champs.ligne4.libelle"></label>\r\n                <div class="col-md-5">\r\n                    <input type="text" maxlength="32" class="form-control" ng-if="!ctrl.isDisabled(ctrl.settings.champs.ligne4)" ng-model="ctrl.adresse.afnor.ligne4" ng-model-options="::ctrl.ngModelOptions" ng-required="::ctrl.settings.champs.ligne4.requis" ng-change="ctrl.onFieldChange(\'ligne4\')" ng-trim="true" ng-disabled="ctrl.loadingModel" mw-uppercase autocomplete="off" ng-attr-id="{{::ctrl.id}}-ligne4" name="ligne4">\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.afnor.ligne4" ng-if="ctrl.isDisabled(ctrl.settings.champs.ligne4)"></p>\r\n\r\n                    <span class="error-msg col-md-12" ng-show="ctrl.formulaire.$error.numeroInexistant">Numéro inexistant dans la voie</span>\r\n                    <span class="error-msg col-md-12" ng-show="ctrl.formulaire.$error.rueNonTrouvee">Voie ou rue non trouvée</span>\r\n                    <span class="error-msg col-md-12" ng-show="ctrl.formulaire.$error.erreurTechniqueDQE">Erreur technique du service de validation</span>\r\n\r\n                    <div ng-show="ctrl.suggestionVoie && !ctrl.loadingModel" ng-click="ctrl.validerSuggestionVoie()" class="validation-msg col-md-12">\r\n                        Adresse proposée:\r\n                        <div ng-bind="ctrl.suggestionVoie.adresse"></div>\r\n                        <div>\r\n                            <span ng-bind="ctrl.suggestionVoie.codePostal"></span>\r\n                            <span ng-bind="ctrl.suggestionVoie.localite"></span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-2">\r\n                    <button ng-show="ctrl.forcage && !ctrl.loadingModel" id="bouton-forcer" ng-click="ctrl.forcer()" class="btn btn-block btn-default">Forcer</button>\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-if="::ctrl.settings.champs.ligne5.afficher" ng-show="ctrl.isFrance">\r\n                <label for="{{::ctrl.id}}-ligne5" class="control-label col-md-3" ng-bind="::ctrl.settings.champs.ligne5.libelle"></label>\r\n                <div class="col-md-5">\r\n                    <input type="text" maxlength="32" class="form-control" ng-if="!ctrl.isDisabled(ctrl.settings.champs.ligne5)" ng-model="ctrl.adresse.afnor.ligne5" ng-model-options="::ctrl.ngModelOptions" ng-required="::ctrl.settings.champs.ligne5.requis" ng-change="ctrl.onFieldChange(\'ligne5\')" ng-trim="true" ng-disabled="ctrl.loadingModel" mw-uppercase autocomplete="off" ng-attr-id="{{::ctrl.id}}-ligne5" name="ligne5">\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.afnor.ligne5" ng-if="ctrl.isDisabled(ctrl.settings.champs.ligne5)"></p>\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-if="::ctrl.settings.champs.ligne6.afficher">\r\n                <label for="{{::ctrl.id}}-ligne6" class="control-label col-md-3" ng-bind="::ctrl.settings.champs.ligne6.libelle"></label>\r\n                <div class="col-md-5">\r\n                    <input type="text" maxlength="32" class="form-control" ng-if="!ctrl.isDisabled(ctrl.settings.champs.ligne6)" ng-model="ctrl.adresse.afnor.ligne6" ng-required="::ctrl.settings.champs.ligne6.requis" ng-change="ctrl.onFieldChange(\'ligne6\')" ng-trim="true" ng-disabled="ctrl.loadingModel" mw-uppercase autocomplete="off" typeahead="localite for localite in ctrl.getLocalites($viewValue)" typeahead-wait-ms="{{ctrl.settings.recherche.debounce}}" typeahead-min-length="3" typeahead-on-select="ctrl.selectLocalite($item)" typeahead-select-on-blur="true" typeahead-loading="ctrl.loadingLocalites" mw-input-loader="ctrl.loadingLocalites" ng-attr-id="{{::ctrl.id}}-ligne6" name="ligne6">\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.afnor.ligne6" ng-if="ctrl.isDisabled(ctrl.settings.champs.ligne6)"></p>\r\n\r\n                    <span class="error-msg col-md-12" ng-show="ctrl.formulaire.$error.localiteNonTrouvee">Localité non trouvée</span>\r\n                    <span class="error-msg col-md-12" ng-show="ctrl.formulaire.$error.localiteNonValide">Localité non valide</span>\r\n                    <span class="error-msg col-md-12" ng-show="ctrl.formulaire.$error.localiteIncomplete">Code postal ou ville non renseigné</span>\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-if="::ctrl.settings.champs.codeInseeLocalite.afficher">\r\n                <label for="{{::ctrl.id}}-codeInseeLocalite" class="control-label col-md-3" ng-bind="::ctrl.settings.champs.codeInseeLocalite.libelle"></label>\r\n                <div class="col-md-5"> \r\n                    <ui-select ng-attr-id="{{::ctrl.id}}-codeInseeLocalite" name="codeInseeLocalite" ng-if="!ctrl.isDisabled(ctrl.settings.champs.codeInseeLocalite)" ng-disabled="ctrl.loadingModel" ng-required="ctrl.settings.champs.codeInseeLocalite.requis" ng-model="ctrl.adresse.codeInseeLocalite" ng-change="ctrl.onFieldChange(\'codeInseeLocalite\')">\r\n                        <ui-select-match title="{{$select.selected.codeInseeLocalite}}">\r\n                            <span ng-bind="$select.selected.codeInseeLocalite"></span>\r\n                        </ui-select-match>\r\n                        <ui-select-choices repeat="code.codeInseeLocalite as code in ctrl.inseeList.listeCommunesInsee">\r\n                            <span ng-bind="::code.codeInseeLocalite + \' - \' + code.libelleInseeLocalite"></span>\r\n                        </ui-select-choices>\r\n                    </ui-select>\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.codeInseeLocalite" ng-if="ctrl.isDisabled(ctrl.settings.champs.codeInseeLocalite)"></p>\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-if="::ctrl.settings.champs.pays.afficher">\r\n                <label for="{{::ctrl.id}}-pays" class="control-label col-md-3" ng-bind="::ctrl.settings.champs.pays.libelle"></label>\r\n                <div class="col-md-5" ng-if="!ctrl.estTerritoire">\r\n                    <ui-select ng-attr-id="{{::ctrl.id}}-pays" name="pays" ng-if="!ctrl.isDisabled(ctrl.settings.champs.pays)" ng-disabled="ctrl.loadingModel" ng-required="ctrl.settings.champs.pays.requis" ng-model="ctrl.adresse.pays" ng-change="ctrl.onFieldChange(\'pays\')">\r\n\r\n                        <ui-select-match title="{{$select.selected.libelleInseePays}}">\r\n                            <span ng-bind="$select.selected.libelleInseePays"></span>\r\n                        </ui-select-match>\r\n                        <ui-select-choices repeat="pays in ctrl.paysList | mwOrFilter: { libelleInseePays: $select.search, codePaysIsoAfnor: $select.search }">\r\n                            <span ng-bind="::pays.libelleInseePays + \' - \' + pays.codePaysIsoAfnor"></span>\r\n                        </ui-select-choices>\r\n                    </ui-select>\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.pays.libelleInseePays" ng-if="ctrl.isDisabled(ctrl.settings.champs.pays)"></p>\r\n                </div>\r\n                <div class="col-md-3" ng-if="ctrl.estTerritoire">\r\n                    <ui-select ng-attr-id="{{::ctrl.id}}-pays" name="pays" ng-if="!ctrl.isDisabled(ctrl.settings.champs.pays)" ng-disabled="ctrl.loadingModel" ng-required="ctrl.settings.champs.pays.requis" ng-model="ctrl.adresse.pays" ng-change="ctrl.onFieldChange(\'pays\')">\r\n\r\n                        <ui-select-match title="{{$select.selected.libelleInseePays}}">\r\n                            <span ng-bind="$select.selected.libelleInseePays"></span>\r\n                        </ui-select-match>\r\n                        <ui-select-choices repeat="pays in ctrl.paysList | mwOrFilter: { libelleInseePays: $select.search, codePaysIsoAfnor: $select.search }">\r\n                            <span ng-bind="::pays.libelleInseePays + \' - \' + pays.codePaysIsoAfnor"></span>\r\n                        </ui-select-choices>\r\n                    </ui-select>\r\n                    <p class="form-control-static" ng-bind="ctrl.adresse.pays.libelleInseePays" ng-if="ctrl.isDisabled(ctrl.settings.champs.pays)"></p>\r\n                </div>\r\n                <div class="col-md-2" ng-if="ctrl.estTerritoire">\r\n                    <input class="form-control" type="text" ng-model="::ctrl.territoireLibelle" readonly="readonly">\r\n                </div>\r\n            </div>\r\n            <div class="form-group" ng-show="::ctrl.settings.boutonReinitialiser.enabled">\r\n                <div class="col-md-offset-3 col-md-3">\r\n                    <button id="btn-reset" class="btn btn-block btn-default" ng-click="ctrl.reinitialiser()">\r\n                        <span ng-if="ctrl.settings.boutonReinitialiser.icone" ng-attr-class="icon {{::ctrl.settings.boutonReinitialiser.icone}}" aria-hidden="true"></span>\r\n                        <span ng-bind="ctrl.settings.boutonReinitialiser.libelle"></span>                        \r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</ng-form>'),
e.put("typescript/commune/saisie-commune-view.html",'<!--<input type="text" class="form-control" autocomplete="off" \r\n       ng-attr-id="{{::ctrl.id}}" \r\n       ng-model="ctrl.commune"\r\n       ng-disabled="ctrl.settings.readOnly"\r\n       typeahead="commune for commune in ctrl.getCommunes($viewValue)"\r\n       typeahead-wait-ms="500"\r\n       typeahead-min-length="3" />-->\r\n\r\n<input type="text" class="form-control" autocomplete="off" placeholder="Saisir un code postal ou une commune" ng-attr-id="{{::ctrl.id}}" ng-model="ctrl.commune" ng-disabled="ctrl.settings.readOnly" mw-uppercase mw-combobox="commune for commune in ctrl.getCommunes($viewValue)" mw-combobox-editable="true" mw-combobox-input-formatter="ctrl.inputFormatter($model)" mw-combobox-min-length="3" mw-combobox-on-select="ctrl.onSelect($item, $model, $label, $event)">\r\n       <!--mw-combobox-wait-ms="500"-->'),e.put("typescript/commune-naissance/saisie-commune-naissance-view.html",'<input type="text" class="form-control" autocomplete="off" placeholder="Saisir une commune" ng-attr-id="{{::ctrl.id}}" ng-model="ctrl.commune" ng-disabled="ctrl.settings.readOnly" mw-uppercase mw-combobox="commune as \'(\'+commune.insee+\') \' + commune.localite for commune in ctrl.getCommunes($viewValue)" mw-combobox-editable="true" mw-combobox-input-formatter="ctrl.toString($model)" mw-combobox-min-length="3" mw-combobox-on-select="ctrl.onSelectCommune(ctrl.commune)" ng-blur="ctrl.onBlur()">'),e.put("typescript/pays/saisie-pays-view.html",'<ui-select id="pays" ng-disabled="mwsfPays.ngDisabled">\r\n    <ui-select-match title="{{$select.selected.libelleInseePays}}">\r\n        <span ng-bind="$select.selected.libelleInseePays"></span>\r\n    </ui-select-match>\r\n    <ui-select-choices repeat="pays in mwsfPays.paysList | mwOrFilter: { libelleInseePays: $select.search, codePaysIsoAfnor: $select.search }">\r\n        <span ng-bind="::pays.libelleInseePays + \' - \' + pays.codePaysIsoAfnor"></span>                       \r\n    </ui-select-choices>\r\n</ui-select>')}]);